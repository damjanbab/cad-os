(function(){"use strict";var tl=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(s,a){n=s,o=a});var i=Object.assign({},r),u="./this.program",l=(s,a)=>{throw a},f=typeof window=="object",p=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function m(s){return r.locateFile?r.locateFile(s,y):y+s}var _,T,x;function C(s){if(s instanceof Bi)return;$("exiting due to exception: "+s)}var A,M,F;d?(p?y=require("path").dirname(y)+"/":y=__dirname+"/",F=()=>{M||(A=require("fs"),M=require("path"))},_=function(a,c){return F(),a=M.normalize(a),A.readFileSync(a,c?void 0:"utf8")},x=s=>{var a=_(s,!0);return a.buffer||(a=new Uint8Array(a)),a},T=(s,a,c)=>{F(),s=M.normalize(s),A.readFile(s,function(h,v){h?c(h):a(v.buffer)})},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof Bi))throw s}),process.on("unhandledRejection",function(s){throw s}),l=(s,a)=>{if(Cu())throw process.exitCode=s,a;C(a),process.exit(s)},r.inspect=function(){return"[Emscripten Module object]"}):(f||p)&&(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),t&&(y=t),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",_=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.send(null),a.responseText},p&&(x=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),T=(s,a,c)=>{var h=new XMLHttpRequest;h.open("GET",s,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){a(h.response);return}c()},h.onerror=c,h.send(null)});var X=r.print||console.log.bind(console),$=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(u=r.thisProgram),r.quit&&(l=r.quit);var ie=4,oe;r.wasmBinary&&(oe=r.wasmBinary);var re=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Xt("no native wasm support detected");var he,Oe=!1;function Le(s,a){s||Xt(a)}var we=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function pe(s,a,c){for(var h=a+c,v=a;s[v]&&!(v>=h);)++v;if(v-a>16&&s.buffer&&we)return we.decode(s.subarray(a,v));for(var w="";a<v;){var b=s[a++];if(!(b&128)){w+=String.fromCharCode(b);continue}var S=s[a++]&63;if((b&224)==192){w+=String.fromCharCode((b&31)<<6|S);continue}var E=s[a++]&63;if((b&240)==224?b=(b&15)<<12|S<<6|E:b=(b&7)<<18|S<<12|E<<6|s[a++]&63,b<65536)w+=String.fromCharCode(b);else{var P=b-65536;w+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return w}function J(s,a){return s?pe($e,s,a):""}function be(s,a,c,h){if(!(h>0))return 0;for(var v=c,w=c+h-1,b=0;b<s.length;++b){var S=s.charCodeAt(b);if(S>=55296&&S<=57343){var E=s.charCodeAt(++b);S=65536+((S&1023)<<10)|E&1023}if(S<=127){if(c>=w)break;a[c++]=S}else if(S<=2047){if(c+1>=w)break;a[c++]=192|S>>6,a[c++]=128|S&63}else if(S<=65535){if(c+2>=w)break;a[c++]=224|S>>12,a[c++]=128|S>>6&63,a[c++]=128|S&63}else{if(c+3>=w)break;a[c++]=240|S>>18,a[c++]=128|S>>12&63,a[c++]=128|S>>6&63,a[c++]=128|S&63}}return a[c]=0,c-v}function Te(s,a,c){return be(s,$e,a,c)}function fe(s){for(var a=0,c=0;c<s.length;++c){var h=s.charCodeAt(c);h>=55296&&h<=57343&&(h=65536+((h&1023)<<10)|s.charCodeAt(++c)&1023),h<=127?++a:h<=2047?a+=2:h<=65535?a+=3:a+=4}return a}var me=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function De(s,a){for(var c=s,h=c>>1,v=h+a/2;!(h>=v)&&on[h];)++h;if(c=h<<1,c-s>32&&me)return me.decode($e.subarray(s,c));for(var w="",b=0;!(b>=a/2);++b){var S=Yt[s+b*2>>1];if(S==0)break;w+=String.fromCharCode(S)}return w}function Ge(s,a,c){if(c===void 0&&(c=2147483647),c<2)return 0;c-=2;for(var h=a,v=c<s.length*2?c/2:s.length,w=0;w<v;++w){var b=s.charCodeAt(w);Yt[a>>1]=b,a+=2}return Yt[a>>1]=0,a-h}function Se(s){return s.length*2}function Ue(s,a){for(var c=0,h="";!(c>=a/4);){var v=U[s+c*4>>2];if(v==0)break;if(++c,v>=65536){var w=v-65536;h+=String.fromCharCode(55296|w>>10,56320|w&1023)}else h+=String.fromCharCode(v)}return h}function rn(s,a,c){if(c===void 0&&(c=2147483647),c<4)return 0;for(var h=a,v=h+c-4,w=0;w<s.length;++w){var b=s.charCodeAt(w);if(b>=55296&&b<=57343){var S=s.charCodeAt(++w);b=65536+((b&1023)<<10)|S&1023}if(U[a>>2]=b,a+=4,a+4>v)break}return U[a>>2]=0,a-h}function mi(s){for(var a=0,c=0;c<s.length;++c){var h=s.charCodeAt(c);h>=55296&&h<=57343&&++c,a+=4}return a}function Jn(s){var a=fe(s)+1,c=Ft(a);return c&&be(s,He,c,a),c}function nn(s,a){He.set(s,a)}function eo(s,a,c){for(var h=0;h<s.length;++h)He[a++>>0]=s.charCodeAt(h);c||(He[a>>0]=0)}var Pt,He,$e,Yt,on,U,ne,ut,bu;function Su(s){Pt=s,r.HEAP8=He=new Int8Array(s),r.HEAP16=Yt=new Int16Array(s),r.HEAP32=U=new Int32Array(s),r.HEAPU8=$e=new Uint8Array(s),r.HEAPU16=on=new Uint16Array(s),r.HEAPU32=ne=new Uint32Array(s),r.HEAPF32=ut=new Float32Array(s),r.HEAPF64=bu=new Float64Array(s)}r.INITIAL_MEMORY;var _u,Tu=[],Eu=[],xu=[];function Cu(){return re}function iv(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)uv(r.preRun.shift());wi(Tu)}function sv(){!r.noFSInit&&!g.init.initialized&&g.init(),g.ignorePermissions=!1,wi(Eu)}function av(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)cv(r.postRun.shift());wi(xu)}function uv(s){Tu.unshift(s)}function lv(s){Eu.unshift(s)}function cv(s){xu.unshift(s)}var ar=0,sn=null;function Vm(s){return s}function yi(s){ar++,r.monitorRunDependencies&&r.monitorRunDependencies(ar)}function to(s){if(ar--,r.monitorRunDependencies&&r.monitorRunDependencies(ar),ar==0&&sn){var a=sn;sn=null,a()}}function Xt(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",$(s),Oe=!0,s+=". Build with -sASSERTIONS for more info.";var a=new WebAssembly.RuntimeError(s);throw o(a),a}var fv="data:application/octet-stream;base64,";function ku(s){return s.startsWith(fv)}function Pu(s){return s.startsWith("file://")}var qe;qe="replicad_single.wasm",ku(qe)||(qe=m(qe));function Au(s){try{if(s==qe&&oe)return new Uint8Array(oe);if(x)return x(s);throw"both async and sync fetching of the wasm failed"}catch(a){Xt(a)}}function hv(){if(!oe&&(f||p)){if(typeof fetch=="function"&&!Pu(qe))return fetch(qe,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+qe+"'";return s.arrayBuffer()}).catch(function(){return Au(qe)});if(T)return new Promise(function(s,a){T(qe,function(c){s(new Uint8Array(c))},a)})}return Promise.resolve().then(function(){return Au(qe)})}function pv(){var s={a:Um};function a(b,S){var E=b.exports;r.asm=E,he=r.asm.oa,Su(he.buffer),_u=r.asm.va,lv(r.asm.pa),to()}yi();function c(b){a(b.instance)}function h(b){return hv().then(function(S){return WebAssembly.instantiate(S,s)}).then(function(S){return S}).then(b,function(S){$("failed to asynchronously prepare wasm: "+S),Xt(S)})}function v(){return!oe&&typeof WebAssembly.instantiateStreaming=="function"&&!ku(qe)&&!Pu(qe)&&!d&&typeof fetch=="function"?fetch(qe,{credentials:"same-origin"}).then(function(b){var S=WebAssembly.instantiateStreaming(b,s);return S.then(c,function(E){return $("wasm streaming compile failed: "+E),$("falling back to ArrayBuffer instantiation"),h(c)})}):h(c)}if(r.instantiateWasm)try{var w=r.instantiateWasm(s,a);return w}catch(b){return $("Module.instantiateWasm callback failed with error: "+b),!1}return v().catch(o),{}}var Ne,At;function dv(){return r.HEAP8.length}function wi(s){for(;s.length>0;){var a=s.shift();if(typeof a=="function"){a(r);continue}var c=a.func;typeof c=="number"?a.arg===void 0?no(c)():no(c)(a.arg):c(a.arg===void 0?null:a.arg)}}var ro=[];function no(s){var a=ro[s];return a||(s>=ro.length&&(ro.length=s+1),ro[s]=a=_u.get(s)),a}function vv(s,a,c,h){Xt("Assertion failed: "+J(s)+", at: "+[a?J(a):"unknown filename",c,h?J(h):"unknown function"])}function gv(s){return Ft(s+24)+24}function mv(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(a){ne[this.ptr+4>>2]=a},this.get_type=function(){return ne[this.ptr+4>>2]},this.set_destructor=function(a){ne[this.ptr+8>>2]=a},this.get_destructor=function(){return ne[this.ptr+8>>2]},this.set_refcount=function(a){U[this.ptr>>2]=a},this.set_caught=function(a){a=a?1:0,He[this.ptr+12>>0]=a},this.get_caught=function(){return He[this.ptr+12>>0]!=0},this.set_rethrown=function(a){a=a?1:0,He[this.ptr+13>>0]=a},this.get_rethrown=function(){return He[this.ptr+13>>0]!=0},this.init=function(a,c){this.set_adjusted_ptr(0),this.set_type(a),this.set_destructor(c),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var a=U[this.ptr>>2];U[this.ptr>>2]=a+1},this.release_ref=function(){var a=U[this.ptr>>2];return U[this.ptr>>2]=a-1,a===1},this.set_adjusted_ptr=function(a){ne[this.ptr+16>>2]=a},this.get_adjusted_ptr=function(){return ne[this.ptr+16>>2]},this.get_exception_ptr=function(){var a=el(this.get_type());if(a)return ne[this.excPtr>>2];var c=this.get_adjusted_ptr();return c!==0?c:this.excPtr}}function yv(s,a,c){var h=new mv(s);throw h.init(a,c),s}var se={isAbs:s=>s.charAt(0)==="/",splitPath:s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return a.exec(s).slice(1)},normalizeArray:(s,a)=>{for(var c=0,h=s.length-1;h>=0;h--){var v=s[h];v==="."?s.splice(h,1):v===".."?(s.splice(h,1),c++):c&&(s.splice(h,1),c--)}if(a)for(;c;c--)s.unshift("..");return s},normalize:s=>{var a=se.isAbs(s),c=s.substr(-1)==="/";return s=se.normalizeArray(s.split("/").filter(h=>!!h),!a).join("/"),!s&&!a&&(s="."),s&&c&&(s+="/"),(a?"/":"")+s},dirname:s=>{var a=se.splitPath(s),c=a[0],h=a[1];return!c&&!h?".":(h&&(h=h.substr(0,h.length-1)),c+h)},basename:s=>{if(s==="/")return"/";s=se.normalize(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},join:function(){var s=Array.prototype.slice.call(arguments,0);return se.normalize(s.join("/"))},join2:(s,a)=>se.normalize(s+"/"+a)};function wv(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var s=new Uint8Array(1);return function(){return crypto.getRandomValues(s),s[0]}}else if(d)try{var a=require("crypto");return function(){return a.randomBytes(1)[0]}}catch{}return function(){Xt("randomDevice")}}var Ot={resolve:function(){for(var s="",a=!1,c=arguments.length-1;c>=-1&&!a;c--){var h=c>=0?arguments[c]:g.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";s=h+"/"+s,a=se.isAbs(h)}return s=se.normalizeArray(s.split("/").filter(v=>!!v),!a).join("/"),(a?"/":"")+s||"."},relative:(s,a)=>{s=Ot.resolve(s).substr(1),a=Ot.resolve(a).substr(1);function c(P){for(var B=0;B<P.length&&P[B]==="";B++);for(var L=P.length-1;L>=0&&P[L]==="";L--);return B>L?[]:P.slice(B,L-B+1)}for(var h=c(s.split("/")),v=c(a.split("/")),w=Math.min(h.length,v.length),b=w,S=0;S<w;S++)if(h[S]!==v[S]){b=S;break}for(var E=[],S=b;S<h.length;S++)E.push("..");return E=E.concat(v.slice(b)),E.join("/")}},ur={ttys:[],init:function(){},shutdown:function(){},register:function(s,a){ur.ttys[s]={input:[],output:[],ops:a},g.registerDevice(s,ur.stream_ops)},stream_ops:{open:function(s){var a=ur.ttys[s.node.rdev];if(!a)throw new g.ErrnoError(43);s.tty=a,s.seekable=!1},close:function(s){s.tty.ops.flush(s.tty)},flush:function(s){s.tty.ops.flush(s.tty)},read:function(s,a,c,h,v){if(!s.tty||!s.tty.ops.get_char)throw new g.ErrnoError(60);for(var w=0,b=0;b<h;b++){var S;try{S=s.tty.ops.get_char(s.tty)}catch{throw new g.ErrnoError(29)}if(S===void 0&&w===0)throw new g.ErrnoError(6);if(S==null)break;w++,a[c+b]=S}return w&&(s.node.timestamp=Date.now()),w},write:function(s,a,c,h,v){if(!s.tty||!s.tty.ops.put_char)throw new g.ErrnoError(60);try{for(var w=0;w<h;w++)s.tty.ops.put_char(s.tty,a[c+w])}catch{throw new g.ErrnoError(29)}return h&&(s.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(s){if(!s.input.length){var a=null;if(d){var c=256,h=Buffer.alloc(c),v=0;try{v=A.readSync(process.stdin.fd,h,0,c,-1)}catch(w){if(w.toString().includes("EOF"))v=0;else throw w}v>0?a=h.slice(0,v).toString("utf-8"):a=null}else typeof window<"u"&&typeof window.prompt=="function"?(a=window.prompt("Input: "),a!==null&&(a+=`
`)):typeof readline=="function"&&(a=readline(),a!==null&&(a+=`
`));if(!a)return null;s.input=wo(a,!0)}return s.input.shift()},put_char:function(s,a){a===null||a===10?(X(pe(s.output,0)),s.output=[]):a!=0&&s.output.push(a)},flush:function(s){s.output&&s.output.length>0&&(X(pe(s.output,0)),s.output=[])}},default_tty1_ops:{put_char:function(s,a){a===null||a===10?($(pe(s.output,0)),s.output=[]):a!=0&&s.output.push(a)},flush:function(s){s.output&&s.output.length>0&&($(pe(s.output,0)),s.output=[])}}};function bv(s,a){$e.fill(0,s,s+a)}function Sv(s,a){return Math.ceil(s/a)*a}function Ou(s){s=Sv(s,65536);var a=Ju(65536,s);return a?(bv(a,s),a):0}var K={ops_table:null,mount:function(s){return K.createNode(null,"/",16895,0)},createNode:function(s,a,c,h){if(g.isBlkdev(c)||g.isFIFO(c))throw new g.ErrnoError(63);K.ops_table||(K.ops_table={dir:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,lookup:K.node_ops.lookup,mknod:K.node_ops.mknod,rename:K.node_ops.rename,unlink:K.node_ops.unlink,rmdir:K.node_ops.rmdir,readdir:K.node_ops.readdir,symlink:K.node_ops.symlink},stream:{llseek:K.stream_ops.llseek}},file:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:{llseek:K.stream_ops.llseek,read:K.stream_ops.read,write:K.stream_ops.write,allocate:K.stream_ops.allocate,mmap:K.stream_ops.mmap,msync:K.stream_ops.msync}},link:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,readlink:K.node_ops.readlink},stream:{}},chrdev:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:g.chrdev_stream_ops}});var v=g.createNode(s,a,c,h);return g.isDir(v.mode)?(v.node_ops=K.ops_table.dir.node,v.stream_ops=K.ops_table.dir.stream,v.contents={}):g.isFile(v.mode)?(v.node_ops=K.ops_table.file.node,v.stream_ops=K.ops_table.file.stream,v.usedBytes=0,v.contents=null):g.isLink(v.mode)?(v.node_ops=K.ops_table.link.node,v.stream_ops=K.ops_table.link.stream):g.isChrdev(v.mode)&&(v.node_ops=K.ops_table.chrdev.node,v.stream_ops=K.ops_table.chrdev.stream),v.timestamp=Date.now(),s&&(s.contents[a]=v,s.timestamp=v.timestamp),v},getFileDataAsTypedArray:function(s){return s.contents?s.contents.subarray?s.contents.subarray(0,s.usedBytes):new Uint8Array(s.contents):new Uint8Array(0)},expandFileStorage:function(s,a){var c=s.contents?s.contents.length:0;if(!(c>=a)){var h=1024*1024;a=Math.max(a,c*(c<h?2:1.125)>>>0),c!=0&&(a=Math.max(a,256));var v=s.contents;s.contents=new Uint8Array(a),s.usedBytes>0&&s.contents.set(v.subarray(0,s.usedBytes),0)}},resizeFileStorage:function(s,a){if(s.usedBytes!=a)if(a==0)s.contents=null,s.usedBytes=0;else{var c=s.contents;s.contents=new Uint8Array(a),c&&s.contents.set(c.subarray(0,Math.min(a,s.usedBytes))),s.usedBytes=a}},node_ops:{getattr:function(s){var a={};return a.dev=g.isChrdev(s.mode)?s.id:1,a.ino=s.id,a.mode=s.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=s.rdev,g.isDir(s.mode)?a.size=4096:g.isFile(s.mode)?a.size=s.usedBytes:g.isLink(s.mode)?a.size=s.link.length:a.size=0,a.atime=new Date(s.timestamp),a.mtime=new Date(s.timestamp),a.ctime=new Date(s.timestamp),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},setattr:function(s,a){a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&K.resizeFileStorage(s,a.size)},lookup:function(s,a){throw g.genericErrors[44]},mknod:function(s,a,c,h){return K.createNode(s,a,c,h)},rename:function(s,a,c){if(g.isDir(s.mode)){var h;try{h=g.lookupNode(a,c)}catch{}if(h)for(var v in h.contents)throw new g.ErrnoError(55)}delete s.parent.contents[s.name],s.parent.timestamp=Date.now(),s.name=c,a.contents[c]=s,a.timestamp=s.parent.timestamp,s.parent=a},unlink:function(s,a){delete s.contents[a],s.timestamp=Date.now()},rmdir:function(s,a){var c=g.lookupNode(s,a);for(var h in c.contents)throw new g.ErrnoError(55);delete s.contents[a],s.timestamp=Date.now()},readdir:function(s){var a=[".",".."];for(var c in s.contents)s.contents.hasOwnProperty(c)&&a.push(c);return a},symlink:function(s,a,c){var h=K.createNode(s,a,41471,0);return h.link=c,h},readlink:function(s){if(!g.isLink(s.mode))throw new g.ErrnoError(28);return s.link}},stream_ops:{read:function(s,a,c,h,v){var w=s.node.contents;if(v>=s.node.usedBytes)return 0;var b=Math.min(s.node.usedBytes-v,h);if(b>8&&w.subarray)a.set(w.subarray(v,v+b),c);else for(var S=0;S<b;S++)a[c+S]=w[v+S];return b},write:function(s,a,c,h,v,w){if(a.buffer===He.buffer&&(w=!1),!h)return 0;var b=s.node;if(b.timestamp=Date.now(),a.subarray&&(!b.contents||b.contents.subarray)){if(w)return b.contents=a.subarray(c,c+h),b.usedBytes=h,h;if(b.usedBytes===0&&v===0)return b.contents=a.slice(c,c+h),b.usedBytes=h,h;if(v+h<=b.usedBytes)return b.contents.set(a.subarray(c,c+h),v),h}if(K.expandFileStorage(b,v+h),b.contents.subarray&&a.subarray)b.contents.set(a.subarray(c,c+h),v);else for(var S=0;S<h;S++)b.contents[v+S]=a[c+S];return b.usedBytes=Math.max(b.usedBytes,v+h),h},llseek:function(s,a,c){var h=a;if(c===1?h+=s.position:c===2&&g.isFile(s.node.mode)&&(h+=s.node.usedBytes),h<0)throw new g.ErrnoError(28);return h},allocate:function(s,a,c){K.expandFileStorage(s.node,a+c),s.node.usedBytes=Math.max(s.node.usedBytes,a+c)},mmap:function(s,a,c,h,v){if(!g.isFile(s.node.mode))throw new g.ErrnoError(43);var w,b,S=s.node.contents;if(!(v&2)&&S.buffer===Pt)b=!1,w=S.byteOffset;else{if((c>0||c+a<S.length)&&(S.subarray?S=S.subarray(c,c+a):S=Array.prototype.slice.call(S,c,c+a)),b=!0,w=Ou(a),!w)throw new g.ErrnoError(48);He.set(S,w)}return{ptr:w,allocated:b}},msync:function(s,a,c,h,v){if(!g.isFile(s.node.mode))throw new g.ErrnoError(43);return v&2||K.stream_ops.write(s,a,0,h,c,!1),0}}};function _v(s,a,c,h){var v=h?"":"al "+s;T(s,function(w){Le(w,'Loading data file "'+s+'" failed (no arrayBuffer).'),a(new Uint8Array(w)),v&&to()},function(w){if(c)c();else throw'Loading data file "'+s+'" failed.'}),v&&yi()}var g={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(s,a={})=>{if(s=Ot.resolve(g.cwd(),s),!s)return{path:"",node:null};var c={follow_mount:!0,recurse_count:0};if(a=Object.assign(c,a),a.recurse_count>8)throw new g.ErrnoError(32);for(var h=se.normalizeArray(s.split("/").filter(L=>!!L),!1),v=g.root,w="/",b=0;b<h.length;b++){var S=b===h.length-1;if(S&&a.parent)break;if(v=g.lookupNode(v,h[b]),w=se.join2(w,h[b]),g.isMountpoint(v)&&(!S||S&&a.follow_mount)&&(v=v.mounted.root),!S||a.follow)for(var E=0;g.isLink(v.mode);){var P=g.readlink(w);w=Ot.resolve(se.dirname(w),P);var B=g.lookupPath(w,{recurse_count:a.recurse_count+1});if(v=B.node,E++>40)throw new g.ErrnoError(32)}}return{path:w,node:v}},getPath:s=>{for(var a;;){if(g.isRoot(s)){var c=s.mount.mountpoint;return a?c[c.length-1]!=="/"?c+"/"+a:c+a:c}a=a?s.name+"/"+a:s.name,s=s.parent}},hashName:(s,a)=>{for(var c=0,h=0;h<a.length;h++)c=(c<<5)-c+a.charCodeAt(h)|0;return(s+c>>>0)%g.nameTable.length},hashAddNode:s=>{var a=g.hashName(s.parent.id,s.name);s.name_next=g.nameTable[a],g.nameTable[a]=s},hashRemoveNode:s=>{var a=g.hashName(s.parent.id,s.name);if(g.nameTable[a]===s)g.nameTable[a]=s.name_next;else for(var c=g.nameTable[a];c;){if(c.name_next===s){c.name_next=s.name_next;break}c=c.name_next}},lookupNode:(s,a)=>{var c=g.mayLookup(s);if(c)throw new g.ErrnoError(c,s);for(var h=g.hashName(s.id,a),v=g.nameTable[h];v;v=v.name_next){var w=v.name;if(v.parent.id===s.id&&w===a)return v}return g.lookup(s,a)},createNode:(s,a,c,h)=>{var v=new g.FSNode(s,a,c,h);return g.hashAddNode(v),v},destroyNode:s=>{g.hashRemoveNode(s)},isRoot:s=>s===s.parent,isMountpoint:s=>!!s.mounted,isFile:s=>(s&61440)===32768,isDir:s=>(s&61440)===16384,isLink:s=>(s&61440)===40960,isChrdev:s=>(s&61440)===8192,isBlkdev:s=>(s&61440)===24576,isFIFO:s=>(s&61440)===4096,isSocket:s=>(s&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:s=>{var a=g.flagModes[s];if(typeof a>"u")throw new Error("Unknown file open mode: "+s);return a},flagsToPermissionString:s=>{var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a},nodePermissions:(s,a)=>g.ignorePermissions?0:a.includes("r")&&!(s.mode&292)||a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73)?2:0,mayLookup:s=>{var a=g.nodePermissions(s,"x");return a||(s.node_ops.lookup?0:2)},mayCreate:(s,a)=>{try{var c=g.lookupNode(s,a);return 20}catch{}return g.nodePermissions(s,"wx")},mayDelete:(s,a,c)=>{var h;try{h=g.lookupNode(s,a)}catch(w){return w.errno}var v=g.nodePermissions(s,"wx");if(v)return v;if(c){if(!g.isDir(h.mode))return 54;if(g.isRoot(h)||g.getPath(h)===g.cwd())return 10}else if(g.isDir(h.mode))return 31;return 0},mayOpen:(s,a)=>s?g.isLink(s.mode)?32:g.isDir(s.mode)&&(g.flagsToPermissionString(a)!=="r"||a&512)?31:g.nodePermissions(s,g.flagsToPermissionString(a)):44,MAX_OPEN_FDS:4096,nextfd:(s=0,a=g.MAX_OPEN_FDS)=>{for(var c=s;c<=a;c++)if(!g.streams[c])return c;throw new g.ErrnoError(33)},getStream:s=>g.streams[s],createStream:(s,a,c)=>{g.FSStream||(g.FSStream=function(){this.shared={}},g.FSStream.prototype={},Object.defineProperties(g.FSStream.prototype,{object:{get:function(){return this.node},set:function(v){this.node=v}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(v){this.shared.flags=v}},position:{get:function(){return this.shared.position},set:function(v){this.shared.position=v}}})),s=Object.assign(new g.FSStream,s);var h=g.nextfd(a,c);return s.fd=h,g.streams[h]=s,s},closeStream:s=>{g.streams[s]=null},chrdev_stream_ops:{open:s=>{var a=g.getDevice(s.node.rdev);s.stream_ops=a.stream_ops,s.stream_ops.open&&s.stream_ops.open(s)},llseek:()=>{throw new g.ErrnoError(70)}},major:s=>s>>8,minor:s=>s&255,makedev:(s,a)=>s<<8|a,registerDevice:(s,a)=>{g.devices[s]={stream_ops:a}},getDevice:s=>g.devices[s],getMounts:s=>{for(var a=[],c=[s];c.length;){var h=c.pop();a.push(h),c.push.apply(c,h.mounts)}return a},syncfs:(s,a)=>{typeof s=="function"&&(a=s,s=!1),g.syncFSRequests++,g.syncFSRequests>1&&$("warning: "+g.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var c=g.getMounts(g.root.mount),h=0;function v(b){return g.syncFSRequests--,a(b)}function w(b){if(b)return w.errored?void 0:(w.errored=!0,v(b));++h>=c.length&&v(null)}c.forEach(b=>{if(!b.type.syncfs)return w(null);b.type.syncfs(b,s,w)})},mount:(s,a,c)=>{var h=c==="/",v=!c,w;if(h&&g.root)throw new g.ErrnoError(10);if(!h&&!v){var b=g.lookupPath(c,{follow_mount:!1});if(c=b.path,w=b.node,g.isMountpoint(w))throw new g.ErrnoError(10);if(!g.isDir(w.mode))throw new g.ErrnoError(54)}var S={type:s,opts:a,mountpoint:c,mounts:[]},E=s.mount(S);return E.mount=S,S.root=E,h?g.root=E:w&&(w.mounted=S,w.mount&&w.mount.mounts.push(S)),E},unmount:s=>{var a=g.lookupPath(s,{follow_mount:!1});if(!g.isMountpoint(a.node))throw new g.ErrnoError(28);var c=a.node,h=c.mounted,v=g.getMounts(h);Object.keys(g.nameTable).forEach(b=>{for(var S=g.nameTable[b];S;){var E=S.name_next;v.includes(S.mount)&&g.destroyNode(S),S=E}}),c.mounted=null;var w=c.mount.mounts.indexOf(h);c.mount.mounts.splice(w,1)},lookup:(s,a)=>s.node_ops.lookup(s,a),mknod:(s,a,c)=>{var h=g.lookupPath(s,{parent:!0}),v=h.node,w=se.basename(s);if(!w||w==="."||w==="..")throw new g.ErrnoError(28);var b=g.mayCreate(v,w);if(b)throw new g.ErrnoError(b);if(!v.node_ops.mknod)throw new g.ErrnoError(63);return v.node_ops.mknod(v,w,a,c)},create:(s,a)=>(a=a!==void 0?a:438,a&=4095,a|=32768,g.mknod(s,a,0)),mkdir:(s,a)=>(a=a!==void 0?a:511,a&=1023,a|=16384,g.mknod(s,a,0)),mkdirTree:(s,a)=>{for(var c=s.split("/"),h="",v=0;v<c.length;++v)if(c[v]){h+="/"+c[v];try{g.mkdir(h,a)}catch(w){if(w.errno!=20)throw w}}},mkdev:(s,a,c)=>(typeof c>"u"&&(c=a,a=438),a|=8192,g.mknod(s,a,c)),symlink:(s,a)=>{if(!Ot.resolve(s))throw new g.ErrnoError(44);var c=g.lookupPath(a,{parent:!0}),h=c.node;if(!h)throw new g.ErrnoError(44);var v=se.basename(a),w=g.mayCreate(h,v);if(w)throw new g.ErrnoError(w);if(!h.node_ops.symlink)throw new g.ErrnoError(63);return h.node_ops.symlink(h,v,s)},rename:(s,a)=>{var c=se.dirname(s),h=se.dirname(a),v=se.basename(s),w=se.basename(a),b,S,E;if(b=g.lookupPath(s,{parent:!0}),S=b.node,b=g.lookupPath(a,{parent:!0}),E=b.node,!S||!E)throw new g.ErrnoError(44);if(S.mount!==E.mount)throw new g.ErrnoError(75);var P=g.lookupNode(S,v),B=Ot.relative(s,h);if(B.charAt(0)!==".")throw new g.ErrnoError(28);if(B=Ot.relative(a,c),B.charAt(0)!==".")throw new g.ErrnoError(55);var L;try{L=g.lookupNode(E,w)}catch{}if(P!==L){var D=g.isDir(P.mode),G=g.mayDelete(S,v,D);if(G)throw new g.ErrnoError(G);if(G=L?g.mayDelete(E,w,D):g.mayCreate(E,w),G)throw new g.ErrnoError(G);if(!S.node_ops.rename)throw new g.ErrnoError(63);if(g.isMountpoint(P)||L&&g.isMountpoint(L))throw new g.ErrnoError(10);if(E!==S&&(G=g.nodePermissions(S,"w"),G))throw new g.ErrnoError(G);g.hashRemoveNode(P);try{S.node_ops.rename(P,E,w)}catch(W){throw W}finally{g.hashAddNode(P)}}},rmdir:s=>{var a=g.lookupPath(s,{parent:!0}),c=a.node,h=se.basename(s),v=g.lookupNode(c,h),w=g.mayDelete(c,h,!0);if(w)throw new g.ErrnoError(w);if(!c.node_ops.rmdir)throw new g.ErrnoError(63);if(g.isMountpoint(v))throw new g.ErrnoError(10);c.node_ops.rmdir(c,h),g.destroyNode(v)},readdir:s=>{var a=g.lookupPath(s,{follow:!0}),c=a.node;if(!c.node_ops.readdir)throw new g.ErrnoError(54);return c.node_ops.readdir(c)},unlink:s=>{var a=g.lookupPath(s,{parent:!0}),c=a.node;if(!c)throw new g.ErrnoError(44);var h=se.basename(s),v=g.lookupNode(c,h),w=g.mayDelete(c,h,!1);if(w)throw new g.ErrnoError(w);if(!c.node_ops.unlink)throw new g.ErrnoError(63);if(g.isMountpoint(v))throw new g.ErrnoError(10);c.node_ops.unlink(c,h),g.destroyNode(v)},readlink:s=>{var a=g.lookupPath(s),c=a.node;if(!c)throw new g.ErrnoError(44);if(!c.node_ops.readlink)throw new g.ErrnoError(28);return Ot.resolve(g.getPath(c.parent),c.node_ops.readlink(c))},stat:(s,a)=>{var c=g.lookupPath(s,{follow:!a}),h=c.node;if(!h)throw new g.ErrnoError(44);if(!h.node_ops.getattr)throw new g.ErrnoError(63);return h.node_ops.getattr(h)},lstat:s=>g.stat(s,!0),chmod:(s,a,c)=>{var h;if(typeof s=="string"){var v=g.lookupPath(s,{follow:!c});h=v.node}else h=s;if(!h.node_ops.setattr)throw new g.ErrnoError(63);h.node_ops.setattr(h,{mode:a&4095|h.mode&-4096,timestamp:Date.now()})},lchmod:(s,a)=>{g.chmod(s,a,!0)},fchmod:(s,a)=>{var c=g.getStream(s);if(!c)throw new g.ErrnoError(8);g.chmod(c.node,a)},chown:(s,a,c,h)=>{var v;if(typeof s=="string"){var w=g.lookupPath(s,{follow:!h});v=w.node}else v=s;if(!v.node_ops.setattr)throw new g.ErrnoError(63);v.node_ops.setattr(v,{timestamp:Date.now()})},lchown:(s,a,c)=>{g.chown(s,a,c,!0)},fchown:(s,a,c)=>{var h=g.getStream(s);if(!h)throw new g.ErrnoError(8);g.chown(h.node,a,c)},truncate:(s,a)=>{if(a<0)throw new g.ErrnoError(28);var c;if(typeof s=="string"){var h=g.lookupPath(s,{follow:!0});c=h.node}else c=s;if(!c.node_ops.setattr)throw new g.ErrnoError(63);if(g.isDir(c.mode))throw new g.ErrnoError(31);if(!g.isFile(c.mode))throw new g.ErrnoError(28);var v=g.nodePermissions(c,"w");if(v)throw new g.ErrnoError(v);c.node_ops.setattr(c,{size:a,timestamp:Date.now()})},ftruncate:(s,a)=>{var c=g.getStream(s);if(!c)throw new g.ErrnoError(8);if(!(c.flags&2097155))throw new g.ErrnoError(28);g.truncate(c.node,a)},utime:(s,a,c)=>{var h=g.lookupPath(s,{follow:!0}),v=h.node;v.node_ops.setattr(v,{timestamp:Math.max(a,c)})},open:(s,a,c)=>{if(s==="")throw new g.ErrnoError(44);a=typeof a=="string"?g.modeStringToFlags(a):a,c=typeof c>"u"?438:c,a&64?c=c&4095|32768:c=0;var h;if(typeof s=="object")h=s;else{s=se.normalize(s);try{var v=g.lookupPath(s,{follow:!(a&131072)});h=v.node}catch{}}var w=!1;if(a&64)if(h){if(a&128)throw new g.ErrnoError(20)}else h=g.mknod(s,c,0),w=!0;if(!h)throw new g.ErrnoError(44);if(g.isChrdev(h.mode)&&(a&=-513),a&65536&&!g.isDir(h.mode))throw new g.ErrnoError(54);if(!w){var b=g.mayOpen(h,a);if(b)throw new g.ErrnoError(b)}a&512&&!w&&g.truncate(h,0),a&=-131713;var S=g.createStream({node:h,path:g.getPath(h),flags:a,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),r.logReadFiles&&!(a&1)&&(g.readFiles||(g.readFiles={}),s in g.readFiles||(g.readFiles[s]=1)),S},close:s=>{if(g.isClosed(s))throw new g.ErrnoError(8);s.getdents&&(s.getdents=null);try{s.stream_ops.close&&s.stream_ops.close(s)}catch(a){throw a}finally{g.closeStream(s.fd)}s.fd=null},isClosed:s=>s.fd===null,llseek:(s,a,c)=>{if(g.isClosed(s))throw new g.ErrnoError(8);if(!s.seekable||!s.stream_ops.llseek)throw new g.ErrnoError(70);if(c!=0&&c!=1&&c!=2)throw new g.ErrnoError(28);return s.position=s.stream_ops.llseek(s,a,c),s.ungotten=[],s.position},read:(s,a,c,h,v)=>{if(h<0||v<0)throw new g.ErrnoError(28);if(g.isClosed(s))throw new g.ErrnoError(8);if((s.flags&2097155)===1)throw new g.ErrnoError(8);if(g.isDir(s.node.mode))throw new g.ErrnoError(31);if(!s.stream_ops.read)throw new g.ErrnoError(28);var w=typeof v<"u";if(!w)v=s.position;else if(!s.seekable)throw new g.ErrnoError(70);var b=s.stream_ops.read(s,a,c,h,v);return w||(s.position+=b),b},write:(s,a,c,h,v,w)=>{if(h<0||v<0)throw new g.ErrnoError(28);if(g.isClosed(s))throw new g.ErrnoError(8);if(!(s.flags&2097155))throw new g.ErrnoError(8);if(g.isDir(s.node.mode))throw new g.ErrnoError(31);if(!s.stream_ops.write)throw new g.ErrnoError(28);s.seekable&&s.flags&1024&&g.llseek(s,0,2);var b=typeof v<"u";if(!b)v=s.position;else if(!s.seekable)throw new g.ErrnoError(70);var S=s.stream_ops.write(s,a,c,h,v,w);return b||(s.position+=S),S},allocate:(s,a,c)=>{if(g.isClosed(s))throw new g.ErrnoError(8);if(a<0||c<=0)throw new g.ErrnoError(28);if(!(s.flags&2097155))throw new g.ErrnoError(8);if(!g.isFile(s.node.mode)&&!g.isDir(s.node.mode))throw new g.ErrnoError(43);if(!s.stream_ops.allocate)throw new g.ErrnoError(138);s.stream_ops.allocate(s,a,c)},mmap:(s,a,c,h,v)=>{if(h&2&&!(v&2)&&(s.flags&2097155)!==2)throw new g.ErrnoError(2);if((s.flags&2097155)===1)throw new g.ErrnoError(2);if(!s.stream_ops.mmap)throw new g.ErrnoError(43);return s.stream_ops.mmap(s,a,c,h,v)},msync:(s,a,c,h,v)=>!s||!s.stream_ops.msync?0:s.stream_ops.msync(s,a,c,h,v),munmap:s=>0,ioctl:(s,a,c)=>{if(!s.stream_ops.ioctl)throw new g.ErrnoError(59);return s.stream_ops.ioctl(s,a,c)},readFile:(s,a={})=>{if(a.flags=a.flags||0,a.encoding=a.encoding||"binary",a.encoding!=="utf8"&&a.encoding!=="binary")throw new Error('Invalid encoding type "'+a.encoding+'"');var c,h=g.open(s,a.flags),v=g.stat(s),w=v.size,b=new Uint8Array(w);return g.read(h,b,0,w,0),a.encoding==="utf8"?c=pe(b,0):a.encoding==="binary"&&(c=b),g.close(h),c},writeFile:(s,a,c={})=>{c.flags=c.flags||577;var h=g.open(s,c.flags,c.mode);if(typeof a=="string"){var v=new Uint8Array(fe(a)+1),w=be(a,v,0,v.length);g.write(h,v,0,w,void 0,c.canOwn)}else if(ArrayBuffer.isView(a))g.write(h,a,0,a.byteLength,void 0,c.canOwn);else throw new Error("Unsupported data type");g.close(h)},cwd:()=>g.currentPath,chdir:s=>{var a=g.lookupPath(s,{follow:!0});if(a.node===null)throw new g.ErrnoError(44);if(!g.isDir(a.node.mode))throw new g.ErrnoError(54);var c=g.nodePermissions(a.node,"x");if(c)throw new g.ErrnoError(c);g.currentPath=a.path},createDefaultDirectories:()=>{g.mkdir("/tmp"),g.mkdir("/home"),g.mkdir("/home/web_user")},createDefaultDevices:()=>{g.mkdir("/dev"),g.registerDevice(g.makedev(1,3),{read:()=>0,write:(a,c,h,v,w)=>v}),g.mkdev("/dev/null",g.makedev(1,3)),ur.register(g.makedev(5,0),ur.default_tty_ops),ur.register(g.makedev(6,0),ur.default_tty1_ops),g.mkdev("/dev/tty",g.makedev(5,0)),g.mkdev("/dev/tty1",g.makedev(6,0));var s=wv();g.createDevice("/dev","random",s),g.createDevice("/dev","urandom",s),g.mkdir("/dev/shm"),g.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{g.mkdir("/proc");var s=g.mkdir("/proc/self");g.mkdir("/proc/self/fd"),g.mount({mount:()=>{var a=g.createNode(s,"fd",16895,73);return a.node_ops={lookup:(c,h)=>{var v=+h,w=g.getStream(v);if(!w)throw new g.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return b.parent=b,b}},a}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?g.createDevice("/dev","stdin",r.stdin):g.symlink("/dev/tty","/dev/stdin"),r.stdout?g.createDevice("/dev","stdout",null,r.stdout):g.symlink("/dev/tty","/dev/stdout"),r.stderr?g.createDevice("/dev","stderr",null,r.stderr):g.symlink("/dev/tty1","/dev/stderr"),g.open("/dev/stdin",0),g.open("/dev/stdout",1),g.open("/dev/stderr",1)},ensureErrnoError:()=>{g.ErrnoError||(g.ErrnoError=function(a,c){this.node=c,this.setErrno=function(h){this.errno=h},this.setErrno(a),this.message="FS error"},g.ErrnoError.prototype=new Error,g.ErrnoError.prototype.constructor=g.ErrnoError,[44].forEach(s=>{g.genericErrors[s]=new g.ErrnoError(s),g.genericErrors[s].stack="<generic error, no stack>"}))},staticInit:()=>{g.ensureErrnoError(),g.nameTable=new Array(4096),g.mount(K,{},"/"),g.createDefaultDirectories(),g.createDefaultDevices(),g.createSpecialDirectories(),g.filesystems={MEMFS:K}},init:(s,a,c)=>{g.init.initialized=!0,g.ensureErrnoError(),r.stdin=s||r.stdin,r.stdout=a||r.stdout,r.stderr=c||r.stderr,g.createStandardStreams()},quit:()=>{g.init.initialized=!1;for(var s=0;s<g.streams.length;s++){var a=g.streams[s];a&&g.close(a)}},getMode:(s,a)=>{var c=0;return s&&(c|=365),a&&(c|=146),c},findObject:(s,a)=>{var c=g.analyzePath(s,a);return c.exists?c.object:null},analyzePath:(s,a)=>{try{var c=g.lookupPath(s,{follow:!a});s=c.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var c=g.lookupPath(s,{parent:!0});h.parentExists=!0,h.parentPath=c.path,h.parentObject=c.node,h.name=se.basename(s),c=g.lookupPath(s,{follow:!a}),h.exists=!0,h.path=c.path,h.object=c.node,h.name=c.node.name,h.isRoot=c.path==="/"}catch(v){h.error=v.errno}return h},createPath:(s,a,c,h)=>{s=typeof s=="string"?s:g.getPath(s);for(var v=a.split("/").reverse();v.length;){var w=v.pop();if(w){var b=se.join2(s,w);try{g.mkdir(b)}catch{}s=b}}return b},createFile:(s,a,c,h,v)=>{var w=se.join2(typeof s=="string"?s:g.getPath(s),a),b=g.getMode(h,v);return g.create(w,b)},createDataFile:(s,a,c,h,v,w)=>{var b=a;s&&(s=typeof s=="string"?s:g.getPath(s),b=a?se.join2(s,a):s);var S=g.getMode(h,v),E=g.create(b,S);if(c){if(typeof c=="string"){for(var P=new Array(c.length),B=0,L=c.length;B<L;++B)P[B]=c.charCodeAt(B);c=P}g.chmod(E,S|146);var D=g.open(E,577);g.write(D,c,0,c.length,0,w),g.close(D),g.chmod(E,S)}return E},createDevice:(s,a,c,h)=>{var v=se.join2(typeof s=="string"?s:g.getPath(s),a),w=g.getMode(!!c,!!h);g.createDevice.major||(g.createDevice.major=64);var b=g.makedev(g.createDevice.major++,0);return g.registerDevice(b,{open:S=>{S.seekable=!1},close:S=>{h&&h.buffer&&h.buffer.length&&h(10)},read:(S,E,P,B,L)=>{for(var D=0,G=0;G<B;G++){var W;try{W=c()}catch{throw new g.ErrnoError(29)}if(W===void 0&&D===0)throw new g.ErrnoError(6);if(W==null)break;D++,E[P+G]=W}return D&&(S.node.timestamp=Date.now()),D},write:(S,E,P,B,L)=>{for(var D=0;D<B;D++)try{h(E[P+D])}catch{throw new g.ErrnoError(29)}return B&&(S.node.timestamp=Date.now()),D}}),g.mkdev(v,w,b)},forceLoadFile:s=>{if(s.isDevice||s.isFolder||s.link||s.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(_)try{s.contents=wo(_(s.url),!0),s.usedBytes=s.contents.length}catch{throw new g.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(s,a,c,h,v)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(G){if(!(G>this.length-1||G<0)){var W=G%this.chunkSize,le=G/this.chunkSize|0;return this.getter(le)[W]}},w.prototype.setDataGetter=function(G){this.getter=G},w.prototype.cacheLength=function(){var G=new XMLHttpRequest;if(G.open("HEAD",c,!1),G.send(null),!(G.status>=200&&G.status<300||G.status===304))throw new Error("Couldn't load "+c+". Status: "+G.status);var W=Number(G.getResponseHeader("Content-length")),le,Ce=(le=G.getResponseHeader("Accept-Ranges"))&&le==="bytes",Pe=(le=G.getResponseHeader("Content-Encoding"))&&le==="gzip",R=1024*1024;Ce||(R=W);var z=(de,Ze)=>{if(de>Ze)throw new Error("invalid range ("+de+", "+Ze+") or no bytes requested!");if(Ze>W-1)throw new Error("only "+W+" bytes available! programmer error!");var Ae=new XMLHttpRequest;if(Ae.open("GET",c,!1),W!==R&&Ae.setRequestHeader("Range","bytes="+de+"-"+Ze),Ae.responseType="arraybuffer",Ae.overrideMimeType&&Ae.overrideMimeType("text/plain; charset=x-user-defined"),Ae.send(null),!(Ae.status>=200&&Ae.status<300||Ae.status===304))throw new Error("Couldn't load "+c+". Status: "+Ae.status);return Ae.response!==void 0?new Uint8Array(Ae.response||[]):wo(Ae.responseText||"",!0)},Me=this;Me.setDataGetter(de=>{var Ze=de*R,Ae=(de+1)*R-1;if(Ae=Math.min(Ae,W-1),typeof Me.chunks[de]>"u"&&(Me.chunks[de]=z(Ze,Ae)),typeof Me.chunks[de]>"u")throw new Error("doXHR failed!");return Me.chunks[de]}),(Pe||!W)&&(R=W=1,W=this.getter(0).length,R=W,X("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=W,this._chunkSize=R,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new w;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:b}}else var S={isDevice:!1,url:c};var E=g.createFile(s,a,S,h,v);S.contents?E.contents=S.contents:S.url&&(E.contents=null,E.url=S.url),Object.defineProperties(E,{usedBytes:{get:function(){return this.contents.length}}});var P={},B=Object.keys(E.stream_ops);B.forEach(D=>{var G=E.stream_ops[D];P[D]=function(){return g.forceLoadFile(E),G.apply(null,arguments)}});function L(D,G,W,le,Ce){var Pe=D.node.contents;if(Ce>=Pe.length)return 0;var R=Math.min(Pe.length-Ce,le);if(Pe.slice)for(var z=0;z<R;z++)G[W+z]=Pe[Ce+z];else for(var z=0;z<R;z++)G[W+z]=Pe.get(Ce+z);return R}return P.read=(D,G,W,le,Ce)=>(g.forceLoadFile(E),L(D,G,W,le,Ce)),P.mmap=(D,G,W,le,Ce)=>{g.forceLoadFile(E);var Pe=Ou(G);if(!Pe)throw new g.ErrnoError(48);return L(D,He,Pe,G,W),{ptr:Pe,allocated:!0}},E.stream_ops=P,E},createPreloadedFile:(s,a,c,h,v,w,b,S,E,P)=>{var B=a?Ot.resolve(se.join2(s,a)):s;function L(D){function G(W){P&&P(),S||g.createDataFile(s,a,W,h,v,E),w&&w(),to()}Browser.handledByPreloadPlugin(D,B,G,()=>{b&&b(),to()})||G(D)}yi(),typeof c=="string"?_v(c,D=>L(D),b):L(c)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,a,c)=>{a=a||(()=>{}),c=c||(()=>{});var h=g.indexedDB();try{var v=h.open(g.DB_NAME(),g.DB_VERSION)}catch(w){return c(w)}v.onupgradeneeded=()=>{X("creating db");var w=v.result;w.createObjectStore(g.DB_STORE_NAME)},v.onsuccess=()=>{var w=v.result,b=w.transaction([g.DB_STORE_NAME],"readwrite"),S=b.objectStore(g.DB_STORE_NAME),E=0,P=0,B=s.length;function L(){P==0?a():c()}s.forEach(D=>{var G=S.put(g.analyzePath(D).object.contents,D);G.onsuccess=()=>{E++,E+P==B&&L()},G.onerror=()=>{P++,E+P==B&&L()}}),b.onerror=c},v.onerror=c},loadFilesFromDB:(s,a,c)=>{a=a||(()=>{}),c=c||(()=>{});var h=g.indexedDB();try{var v=h.open(g.DB_NAME(),g.DB_VERSION)}catch(w){return c(w)}v.onupgradeneeded=c,v.onsuccess=()=>{var w=v.result;try{var b=w.transaction([g.DB_STORE_NAME],"readonly")}catch(D){c(D);return}var S=b.objectStore(g.DB_STORE_NAME),E=0,P=0,B=s.length;function L(){P==0?a():c()}s.forEach(D=>{var G=S.get(D);G.onsuccess=()=>{g.analyzePath(D).exists&&g.unlink(D),g.createDataFile(se.dirname(D),se.basename(D),G.result,!0,!0,!0),E++,E+P==B&&L()},G.onerror=()=>{P++,E+P==B&&L()}}),b.onerror=c},v.onerror=c}},ae={DEFAULT_POLLMASK:5,calculateAt:function(s,a,c){if(se.isAbs(a))return a;var h;if(s===-100)h=g.cwd();else{var v=g.getStream(s);if(!v)throw new g.ErrnoError(8);h=v.path}if(a.length==0){if(!c)throw new g.ErrnoError(44);return h}return se.join2(h,a)},doStat:function(s,a,c){try{var h=s(a)}catch(v){if(v&&v.node&&se.normalize(a)!==se.normalize(g.getPath(v.node)))return-54;throw v}return U[c>>2]=h.dev,U[c+4>>2]=0,U[c+8>>2]=h.ino,U[c+12>>2]=h.mode,U[c+16>>2]=h.nlink,U[c+20>>2]=h.uid,U[c+24>>2]=h.gid,U[c+28>>2]=h.rdev,U[c+32>>2]=0,At=[h.size>>>0,(Ne=h.size,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],U[c+40>>2]=At[0],U[c+44>>2]=At[1],U[c+48>>2]=4096,U[c+52>>2]=h.blocks,U[c+56>>2]=h.atime.getTime()/1e3|0,U[c+60>>2]=0,U[c+64>>2]=h.mtime.getTime()/1e3|0,U[c+68>>2]=0,U[c+72>>2]=h.ctime.getTime()/1e3|0,U[c+76>>2]=0,At=[h.ino>>>0,(Ne=h.ino,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],U[c+80>>2]=At[0],U[c+84>>2]=At[1],0},doMsync:function(s,a,c,h,v){var w=$e.slice(s,s+c);g.msync(a,w,v,c,h)},varargs:void 0,get:function(){ae.varargs+=4;var s=U[ae.varargs-4>>2];return s},getStr:function(s){var a=J(s);return a},getStreamFromFD:function(s){var a=g.getStream(s);if(!a)throw new g.ErrnoError(8);return a}};function Tv(s,a){try{return s=ae.getStr(s),g.chmod(s,a),0}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function Ev(s,a,c,h){try{if(a=ae.getStr(a),a=ae.calculateAt(s,a),c&-8)return-28;var v=g.lookupPath(a,{follow:!0}),w=v.node;if(!w)return-44;var b="";return c&4&&(b+="r"),c&2&&(b+="w"),c&1&&(b+="x"),b&&g.nodePermissions(w,b)?-2:0}catch(S){if(typeof g>"u"||!(S instanceof g.ErrnoError))throw S;return-S.errno}}function xv(s){return U[Zu()>>2]=s,s}function Cv(s,a,c){ae.varargs=c;try{var h=ae.getStreamFromFD(s);switch(a){case 0:{var v=ae.get();if(v<0)return-28;var w;return w=g.createStream(h,v),w.fd}case 1:case 2:return 0;case 3:return h.flags;case 4:{var v=ae.get();return h.flags|=v,0}case 5:{var v=ae.get(),b=0;return Yt[v+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return xv(28),-1;default:return-28}}catch(S){if(typeof g>"u"||!(S instanceof g.ErrnoError))throw S;return-S.errno}}function kv(s,a){try{var c=ae.getStreamFromFD(s);return ae.doStat(g.stat,c.path,a)}catch(h){if(typeof g>"u"||!(h instanceof g.ErrnoError))throw h;return-h.errno}}function Pv(s,a,c){ae.varargs=c;try{var h=ae.getStreamFromFD(s);switch(a){case 21509:case 21505:return h.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return h.tty?0:-59;case 21519:{if(!h.tty)return-59;var v=ae.get();return U[v>>2]=0,0}case 21520:return h.tty?-28:-59;case 21531:{var v=ae.get();return g.ioctl(h,a,v)}case 21523:return h.tty?0:-59;case 21524:return h.tty?0:-59;default:Xt("bad ioctl syscall "+a)}}catch(w){if(typeof g>"u"||!(w instanceof g.ErrnoError))throw w;return-w.errno}}function Av(s,a){try{return s=ae.getStr(s),ae.doStat(g.lstat,s,a)}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function Ov(s,a,c,h){try{a=ae.getStr(a);var v=h&256,w=h&4096;return h=h&-4353,a=ae.calculateAt(s,a,w),ae.doStat(v?g.lstat:g.stat,a,c)}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return-b.errno}}function Rv(s,a,c,h){ae.varargs=h;try{a=ae.getStr(a),a=ae.calculateAt(s,a);var v=h?ae.get():0;return g.open(a,c,v).fd}catch(w){if(typeof g>"u"||!(w instanceof g.ErrnoError))throw w;return-w.errno}}function Dv(s,a){try{return s=ae.getStr(s),ae.doStat(g.stat,s,a)}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function Fv(s,a,c,h,v){}function oo(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function Mv(){for(var s=new Array(256),a=0;a<256;++a)s[a]=String.fromCharCode(a);Ru=s}var Ru=void 0;function Ye(s){for(var a="",c=s;$e[c];)a+=Ru[$e[c++]];return a}var Cr={},lr={},io={},Bv=48,Lv=57;function so(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return a>=Bv&&a<=Lv?"_"+s:s}function ao(s,a){return s=so(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(a)}function bi(s,a){var c=ao(a,function(h){this.name=a,this.message=h;var v=new Error(h).stack;v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(s.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},c}var kr=void 0;function ue(s){throw new kr(s)}var Du=void 0;function uo(s){throw new Du(s)}function cr(s,a,c){s.forEach(function(S){io[S]=a});function h(S){var E=c(S);E.length!==s.length&&uo("Mismatched type converter count");for(var P=0;P<s.length;++P)mt(s[P],E[P])}var v=new Array(a.length),w=[],b=0;a.forEach((S,E)=>{lr.hasOwnProperty(S)?v[E]=lr[S]:(w.push(S),Cr.hasOwnProperty(S)||(Cr[S]=[]),Cr[S].push(()=>{v[E]=lr[S],++b,b===w.length&&h(v)}))}),w.length===0&&h(v)}function mt(s,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var h=a.name;if(s||ue('type "'+h+'" must have a positive integer typeid pointer'),lr.hasOwnProperty(s)){if(c.ignoreDuplicateRegistrations)return;ue("Cannot register type '"+h+"' twice")}if(lr[s]=a,delete io[s],Cr.hasOwnProperty(s)){var v=Cr[s];delete Cr[s],v.forEach(w=>w())}}function Uv(s,a,c,h,v){var w=oo(c);a=Ye(a),mt(s,{name:a,fromWireType:function(b){return!!b},toWireType:function(b,S){return S?h:v},argPackAdvance:8,readValueFromPointer:function(b){var S;if(c===1)S=He;else if(c===2)S=Yt;else if(c===4)S=U;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(S[b>>w])},destructorFunction:null})}function Iv(s){if(!(this instanceof jt)||!(s instanceof jt))return!1;for(var a=this.$$.ptrType.registeredClass,c=this.$$.ptr,h=s.$$.ptrType.registeredClass,v=s.$$.ptr;a.baseClass;)c=a.upcast(c),a=a.baseClass;for(;h.baseClass;)v=h.upcast(v),h=h.baseClass;return a===h&&c===v}function Gv(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function Si(s){function a(c){return c.$$.ptrType.registeredClass.name}ue(a(s)+" instance already deleted")}var _i=!1;function Fu(s){}function Nv(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function Mu(s){s.count.value-=1;var a=s.count.value===0;a&&Nv(s)}function Bu(s,a,c){if(a===c)return s;if(c.baseClass===void 0)return null;var h=Bu(s,a,c.baseClass);return h===null?null:c.downcast(h)}var Lu={};function Vv(){return Object.keys(ln).length}function Hv(){var s=[];for(var a in ln)ln.hasOwnProperty(a)&&s.push(ln[a]);return s}var an=[];function Ti(){for(;an.length;){var s=an.pop();s.$$.deleteScheduled=!1,s.delete()}}var un=void 0;function zv(s){un=s,an.length&&un&&un(Ti)}function Wv(){r.getInheritedInstanceCount=Vv,r.getLiveInheritedInstances=Hv,r.flushPendingDeletes=Ti,r.setDelayFunction=zv}var ln={};function $v(s,a){for(a===void 0&&ue("ptr should not be undefined");s.baseClass;)a=s.upcast(a),s=s.baseClass;return a}function Yv(s,a){return a=$v(s,a),ln[a]}function lo(s,a){(!a.ptrType||!a.ptr)&&uo("makeClassHandle requires ptr and ptrType");var c=!!a.smartPtrType,h=!!a.smartPtr;return c!==h&&uo("Both smartPtrType and smartPtr must be specified"),a.count={value:1},cn(Object.create(s,{$$:{value:a}}))}function Xv(s){var a=this.getPointee(s);if(!a)return this.destructor(s),null;var c=Yv(this.registeredClass,a);if(c!==void 0){if(c.$$.count.value===0)return c.$$.ptr=a,c.$$.smartPtr=s,c.clone();var h=c.clone();return this.destructor(s),h}function v(){return this.isSmartPointer?lo(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:a,smartPtrType:this,smartPtr:s}):lo(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var w=this.registeredClass.getActualType(a),b=Lu[w];if(!b)return v.call(this);var S;this.isConst?S=b.constPointerType:S=b.pointerType;var E=Bu(a,this.registeredClass,S.registeredClass);return E===null?v.call(this):this.isSmartPointer?lo(S.registeredClass.instancePrototype,{ptrType:S,ptr:E,smartPtrType:this,smartPtr:s}):lo(S.registeredClass.instancePrototype,{ptrType:S,ptr:E})}function cn(s){return typeof FinalizationRegistry>"u"?(cn=a=>a,s):(_i=new FinalizationRegistry(a=>{Mu(a.$$)}),cn=a=>{var c=a.$$,h=!!c.smartPtr;if(h){var v={$$:c};_i.register(a,v,a)}return a},Fu=a=>_i.unregister(a),cn(s))}function jv(){if(this.$$.ptr||Si(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=cn(Object.create(Object.getPrototypeOf(this),{$$:{value:Gv(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function qv(){this.$$.ptr||Si(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ue("Object already scheduled for deletion"),Fu(this),Mu(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Zv(){return!this.$$.ptr}function Kv(){return this.$$.ptr||Si(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ue("Object already scheduled for deletion"),an.push(this),an.length===1&&un&&un(Ti),this.$$.deleteScheduled=!0,this}function Qv(){jt.prototype.isAliasOf=Iv,jt.prototype.clone=jv,jt.prototype.delete=qv,jt.prototype.isDeleted=Zv,jt.prototype.deleteLater=Kv}function jt(){}function Ei(s,a,c){if(s[a].overloadTable===void 0){var h=s[a];s[a]=function(){return s[a].overloadTable.hasOwnProperty(arguments.length)||ue("Function '"+c+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[a].overloadTable+")!"),s[a].overloadTable[arguments.length].apply(this,arguments)},s[a].overloadTable=[],s[a].overloadTable[h.argCount]=h}}function Uu(s,a,c){r.hasOwnProperty(s)?((c===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[c]!==void 0)&&ue("Cannot register public name '"+s+"' twice"),Ei(r,s,s),r.hasOwnProperty(c)&&ue("Cannot register multiple overloads of a function with the same number of arguments ("+c+")!"),r[s].overloadTable[c]=a):(r[s]=a,c!==void 0&&(r[s].numArguments=c))}function Jv(s,a,c,h,v,w,b,S){this.name=s,this.constructor=a,this.instancePrototype=c,this.rawDestructor=h,this.baseClass=v,this.getActualType=w,this.upcast=b,this.downcast=S,this.pureVirtualFunctions=[]}function xi(s,a,c){for(;a!==c;)a.upcast||ue("Expected null or instance of "+c.name+", got an instance of "+a.name),s=a.upcast(s),a=a.baseClass;return s}function eg(s,a){if(a===null)return this.isReference&&ue("null is not a valid "+this.name),0;a.$$||ue('Cannot pass "'+Oi(a)+'" as a '+this.name),a.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name);var c=a.$$.ptrType.registeredClass,h=xi(a.$$.ptr,c,this.registeredClass);return h}function tg(s,a){var c;if(a===null)return this.isReference&&ue("null is not a valid "+this.name),this.isSmartPointer?(c=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,c),c):0;a.$$||ue('Cannot pass "'+Oi(a)+'" as a '+this.name),a.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&a.$$.ptrType.isConst&&ue("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);var h=a.$$.ptrType.registeredClass;if(c=xi(a.$$.ptr,h,this.registeredClass),this.isSmartPointer)switch(a.$$.smartPtr===void 0&&ue("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:a.$$.smartPtrType===this?c=a.$$.smartPtr:ue("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:c=a.$$.smartPtr;break;case 2:if(a.$$.smartPtrType===this)c=a.$$.smartPtr;else{var v=a.clone();c=this.rawShare(c,Fe.toHandle(function(){v.delete()})),s!==null&&s.push(this.rawDestructor,c)}break;default:ue("Unsupporting sharing policy")}return c}function rg(s,a){if(a===null)return this.isReference&&ue("null is not a valid "+this.name),0;a.$$||ue('Cannot pass "'+Oi(a)+'" as a '+this.name),a.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name),a.$$.ptrType.isConst&&ue("Cannot convert argument of type "+a.$$.ptrType.name+" to parameter type "+this.name);var c=a.$$.ptrType.registeredClass,h=xi(a.$$.ptr,c,this.registeredClass);return h}function co(s){return this.fromWireType(ne[s>>2])}function ng(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function og(s){this.rawDestructor&&this.rawDestructor(s)}function ig(s){s!==null&&s.delete()}function sg(){Rt.prototype.getPointee=ng,Rt.prototype.destructor=og,Rt.prototype.argPackAdvance=8,Rt.prototype.readValueFromPointer=co,Rt.prototype.deleteObject=ig,Rt.prototype.fromWireType=Xv}function Rt(s,a,c,h,v,w,b,S,E,P,B){this.name=s,this.registeredClass=a,this.isReference=c,this.isConst=h,this.isSmartPointer=v,this.pointeeType=w,this.sharingPolicy=b,this.rawGetPointee=S,this.rawConstructor=E,this.rawShare=P,this.rawDestructor=B,!v&&a.baseClass===void 0?h?(this.toWireType=eg,this.destructorFunction=null):(this.toWireType=rg,this.destructorFunction=null):this.toWireType=tg}function ag(s,a,c){r.hasOwnProperty(s)||uo("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&c!==void 0?r[s].overloadTable[c]=a:(r[s]=a,r[s].argCount=c)}function ug(s,a,c){var h=r["dynCall_"+s];return c&&c.length?h.apply(null,[a].concat(c)):h.call(null,a)}function lg(s,a,c){return s.includes("j")?ug(s,a,c):no(a).apply(null,c)}function cg(s,a){var c=[];return function(){return c.length=0,Object.assign(c,arguments),lg(s,a,c)}}function fr(s,a){s=Ye(s);function c(){return s.includes("j")?cg(s,a):no(a)}var h=c();return typeof h!="function"&&ue("unknown function pointer with signature "+s+": "+a),h}var Iu=void 0;function Gu(s){var a=Ku(s),c=Ye(a);return Mt(a),c}function fo(s,a){var c=[],h={};function v(w){if(!h[w]&&!lr[w]){if(io[w]){io[w].forEach(v);return}c.push(w),h[w]=!0}}throw a.forEach(v),new Iu(s+": "+c.map(Gu).join([", "]))}function fg(s,a,c,h,v,w,b,S,E,P,B,L,D){B=Ye(B),w=fr(v,w),S&&(S=fr(b,S)),P&&(P=fr(E,P)),D=fr(L,D);var G=so(B);Uu(G,function(){fo("Cannot construct "+B+" due to unbound types",[h])}),cr([s,a,c],h?[h]:[],function(W){W=W[0];var le,Ce;h?(le=W.registeredClass,Ce=le.instancePrototype):Ce=jt.prototype;var Pe=ao(G,function(){if(Object.getPrototypeOf(this)!==R)throw new kr("Use 'new' to construct "+B);if(z.constructor_body===void 0)throw new kr(B+" has no accessible constructor");var Ae=z.constructor_body[arguments.length];if(Ae===void 0)throw new kr("Tried to invoke ctor of "+B+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(z.constructor_body).toString()+") parameters instead!");return Ae.apply(this,arguments)}),R=Object.create(Ce,{constructor:{value:Pe}});Pe.prototype=R;var z=new Jv(B,Pe,R,D,le,w,S,P),Me=new Rt(B,z,!0,!1,!1),de=new Rt(B+"*",z,!1,!1,!1),Ze=new Rt(B+" const*",z,!1,!0,!1);return Lu[s]={pointerType:de,constPointerType:Ze},ag(G,Pe),[Me,de,Ze]})}function Nu(s,a){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var c=ao(s.name||"unknownFunctionName",function(){});c.prototype=s.prototype;var h=new c,v=s.apply(h,a);return v instanceof Object?v:h}function Vu(s){for(;s.length;){var a=s.pop(),c=s.pop();c(a)}}function Ci(s,a,c,h,v){var w=a.length;w<2&&ue("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var b=a[1]!==null&&c!==null,S=!1,E=1;E<a.length;++E)if(a[E]!==null&&a[E].destructorFunction===void 0){S=!0;break}for(var P=a[0].name!=="void",B="",L="",E=0;E<w-2;++E)B+=(E!==0?", ":"")+"arg"+E,L+=(E!==0?", ":"")+"arg"+E+"Wired";var D="return function "+so(s)+"("+B+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;S&&(D+=`var destructors = [];
`);var G=S?"destructors":"null",W=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],le=[ue,h,v,Vu,a[0],a[1]];b&&(D+="var thisWired = classParam.toWireType("+G+`, this);
`);for(var E=0;E<w-2;++E)D+="var arg"+E+"Wired = argType"+E+".toWireType("+G+", arg"+E+"); // "+a[E+2].name+`
`,W.push("argType"+E),le.push(a[E+2]);if(b&&(L="thisWired"+(L.length>0?", ":"")+L),D+=(P?"var rv = ":"")+"invoker(fn"+(L.length>0?", ":"")+L+`);
`,S)D+=`runDestructors(destructors);
`;else for(var E=b?1:2;E<a.length;++E){var Ce=E===1?"thisWired":"arg"+(E-2)+"Wired";a[E].destructorFunction!==null&&(D+=Ce+"_dtor("+Ce+"); // "+a[E].name+`
`,W.push(Ce+"_dtor"),le.push(a[E].destructorFunction))}P&&(D+=`var ret = retType.fromWireType(rv);
return ret;
`),D+=`}
`,W.push(D);var Pe=Nu(Function,W).apply(null,le);return Pe}function ki(s,a){for(var c=[],h=0;h<s;h++)c.push(U[(a>>2)+h]);return c}function hg(s,a,c,h,v,w,b){var S=ki(c,h);a=Ye(a),w=fr(v,w),cr([],[s],function(E){E=E[0];var P=E.name+"."+a;function B(){fo("Cannot call "+P+" due to unbound types",S)}a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var L=E.registeredClass.constructor;return L[a]===void 0?(B.argCount=c-1,L[a]=B):(Ei(L,a,P),L[a].overloadTable[c-1]=B),cr([],S,function(D){var G=[D[0],null].concat(D.slice(1)),W=Ci(P,G,null,w,b);return L[a].overloadTable===void 0?(W.argCount=c-1,L[a]=W):L[a].overloadTable[c-1]=W,[]}),[]})}function pg(s,a,c,h,v,w){Le(a>0);var b=ki(a,c);v=fr(h,v),cr([],[s],function(S){S=S[0];var E="constructor "+S.name;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[a-1]!==void 0)throw new kr("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+S.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return S.registeredClass.constructor_body[a-1]=()=>{fo("Cannot construct "+S.name+" due to unbound types",b)},cr([],b,function(P){return P.splice(1,0,null),S.registeredClass.constructor_body[a-1]=Ci(E,P,null,v,w),[]}),[]})}function dg(s,a,c,h,v,w,b,S){var E=ki(c,h);a=Ye(a),w=fr(v,w),cr([],[s],function(P){P=P[0];var B=P.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),S&&P.registeredClass.pureVirtualFunctions.push(a);function L(){fo("Cannot call "+B+" due to unbound types",E)}var D=P.registeredClass.instancePrototype,G=D[a];return G===void 0||G.overloadTable===void 0&&G.className!==P.name&&G.argCount===c-2?(L.argCount=c-2,L.className=P.name,D[a]=L):(Ei(D,a,B),D[a].overloadTable[c-2]=L),cr([],E,function(W){var le=Ci(B,W,P,w,b);return D[a].overloadTable===void 0?(le.argCount=c-2,D[a]=le):D[a].overloadTable[c-2]=le,[]}),[]})}var Pi=[],lt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ai(s){s>4&&--lt[s].refcount===0&&(lt[s]=void 0,Pi.push(s))}function vg(){for(var s=0,a=5;a<lt.length;++a)lt[a]!==void 0&&++s;return s}function gg(){for(var s=5;s<lt.length;++s)if(lt[s]!==void 0)return lt[s];return null}function mg(){r.count_emval_handles=vg,r.get_first_emval=gg}var Fe={toValue:s=>(s||ue("Cannot use deleted val. handle = "+s),lt[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var a=Pi.length?Pi.pop():lt.length;return lt[a]={refcount:1,value:s},a}}}};function yg(s,a){a=Ye(a),mt(s,{name:a,fromWireType:function(c){var h=Fe.toValue(c);return Ai(c),h},toWireType:function(c,h){return Fe.toHandle(h)},argPackAdvance:8,readValueFromPointer:co,destructorFunction:null})}function wg(s,a,c){switch(a){case 0:return function(h){var v=c?He:$e;return this.fromWireType(v[h])};case 1:return function(h){var v=c?Yt:on;return this.fromWireType(v[h>>1])};case 2:return function(h){var v=c?U:ne;return this.fromWireType(v[h>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function bg(s,a,c,h){var v=oo(c);a=Ye(a);function w(){}w.values={},mt(s,{name:a,constructor:w,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,S){return S.value},argPackAdvance:8,readValueFromPointer:wg(a,v,h),destructorFunction:null}),Uu(a,w)}function ho(s,a){var c=lr[s];return c===void 0&&ue(a+" has unknown type "+Gu(s)),c}function Sg(s,a,c){var h=ho(s,"enum");a=Ye(a);var v=h.constructor,w=Object.create(h.constructor.prototype,{value:{value:c},constructor:{value:ao(h.name+"_"+a,function(){})}});v.values[c]=w,v[a]=w}function Oi(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function _g(s,a){switch(a){case 2:return function(c){return this.fromWireType(ut[c>>2])};case 3:return function(c){return this.fromWireType(bu[c>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Tg(s,a,c){var h=oo(c);a=Ye(a),mt(s,{name:a,fromWireType:function(v){return v},toWireType:function(v,w){return w},argPackAdvance:8,readValueFromPointer:_g(a,h),destructorFunction:null})}function Eg(s,a,c){switch(a){case 0:return c?function(v){return He[v]}:function(v){return $e[v]};case 1:return c?function(v){return Yt[v>>1]}:function(v){return on[v>>1]};case 2:return c?function(v){return U[v>>2]}:function(v){return ne[v>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function xg(s,a,c,h,v){a=Ye(a);var w=oo(c),b=L=>L;if(h===0){var S=32-8*c;b=L=>L<<S>>>S}var E=a.includes("unsigned"),P=(L,D)=>{},B;E?B=function(L,D){return P(D,this.name),D>>>0}:B=function(L,D){return P(D,this.name),D},mt(s,{name:a,fromWireType:b,toWireType:B,argPackAdvance:8,readValueFromPointer:Eg(a,w,h!==0),destructorFunction:null})}function Cg(s,a,c){var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],v=h[a];function w(b){b=b>>2;var S=ne,E=S[b],P=S[b+1];return new v(Pt,P,E)}c=Ye(c),mt(s,{name:c,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function kg(s,a){a=Ye(a);var c=a==="std::string";mt(s,{name:a,fromWireType:function(h){var v=ne[h>>2],w;if(c)for(var b=h+4,S=0;S<=v;++S){var E=h+4+S;if(S==v||$e[E]==0){var P=E-b,B=J(b,P);w===void 0?w=B:(w+=String.fromCharCode(0),w+=B),b=E+1}}else{for(var L=new Array(v),S=0;S<v;++S)L[S]=String.fromCharCode($e[h+4+S]);w=L.join("")}return Mt(h),w},toWireType:function(h,v){v instanceof ArrayBuffer&&(v=new Uint8Array(v));var w,b=typeof v=="string";b||v instanceof Uint8Array||v instanceof Uint8ClampedArray||v instanceof Int8Array||ue("Cannot pass non-string to std::string"),c&&b?w=()=>fe(v):w=()=>v.length;var S=w(),E=Ft(4+S+1);if(ne[E>>2]=S,c&&b)Te(v,E+4,S+1);else if(b)for(var P=0;P<S;++P){var B=v.charCodeAt(P);B>255&&(Mt(E),ue("String has UTF-16 code units that do not fit in 8 bits")),$e[E+4+P]=B}else for(var P=0;P<S;++P)$e[E+4+P]=v[P];return h!==null&&h.push(Mt,E),E},argPackAdvance:8,readValueFromPointer:co,destructorFunction:function(h){Mt(h)}})}function Pg(s,a,c){c=Ye(c);var h,v,w,b,S;a===2?(h=De,v=Ge,b=Se,w=()=>on,S=1):a===4&&(h=Ue,v=rn,b=mi,w=()=>ne,S=2),mt(s,{name:c,fromWireType:function(E){for(var P=ne[E>>2],B=w(),L,D=E+4,G=0;G<=P;++G){var W=E+4+G*a;if(G==P||B[W>>S]==0){var le=W-D,Ce=h(D,le);L===void 0?L=Ce:(L+=String.fromCharCode(0),L+=Ce),D=W+a}}return Mt(E),L},toWireType:function(E,P){typeof P!="string"&&ue("Cannot pass non-string to C++ string type "+c);var B=b(P),L=Ft(4+B+a);return ne[L>>2]=B>>S,v(P,L+4,B+a),E!==null&&E.push(Mt,L),L},argPackAdvance:8,readValueFromPointer:co,destructorFunction:function(E){Mt(E)}})}function Ag(s,a){a=Ye(a),mt(s,{isVoid:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(c,h){}})}function Og(){return Date.now()}var Rg=!0;function Dg(){return Rg}function Fg(s,a,c){s=Fe.toValue(s),a=ho(a,"emval::as");var h=[],v=Fe.toHandle(h);return U[c>>2]=v,a.toWireType(h,s)}function Mg(s){var a=[];return U[s>>2]=Fe.toHandle(a),a}var Bg={};function Ri(s){var a=Bg[s];return a===void 0?Ye(s):a}var Di=[];function Lg(s,a,c,h,v){return s=Di[s],a=Fe.toValue(a),c=Ri(c),s(a,c,Mg(h),v)}function Hu(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Ug(s){return s===0?Fe.toHandle(Hu()):(s=Ri(s),Fe.toHandle(Hu()[s]))}function Ig(s){var a=Di.length;return Di.push(s),a}function Gg(s,a){for(var c=new Array(s),h=0;h<s;++h)c[h]=ho(ne[a+h*ie>>2],"parameter "+h);return c}var zu=[];function Ng(s,a){var c=Gg(s,a),h=c[0],v=h.name+"_$"+c.slice(1).map(function(W){return W.name}).join("_")+"$",w=zu[v];if(w!==void 0)return w;for(var b=["retType"],S=[h],E="",P=0;P<s-1;++P)E+=(P!==0?", ":"")+"arg"+P,b.push("argType"+P),S.push(c[1+P]);for(var B=so("methodCaller_"+v),L="return function "+B+`(handle, name, destructors, args) {
`,D=0,P=0;P<s-1;++P)L+="    var arg"+P+" = argType"+P+".readValueFromPointer(args"+(D?"+"+D:"")+`);
`,D+=c[P+1].argPackAdvance;L+="    var rv = handle[name]("+E+`);
`;for(var P=0;P<s-1;++P)c[P+1].deleteObject&&(L+="    argType"+P+".deleteObject(arg"+P+`);
`);h.isVoid||(L+=`    return retType.toWireType(destructors, rv);
`),L+=`};
`,b.push(L);var G=Nu(Function,b).apply(null,S);return w=Ig(G),zu[v]=w,w}function Vg(s,a){return s=Fe.toValue(s),a=Fe.toValue(a),Fe.toHandle(s[a])}function Hg(s){s>4&&(lt[s].refcount+=1)}function zg(s){return Fe.toHandle(Ri(s))}function Wg(s){var a=Fe.toValue(s);Vu(a),Ai(s)}function $g(s,a,c){s=Fe.toValue(s),a=Fe.toValue(a),c=Fe.toValue(c),s[a]=c}function Yg(s,a){s=ho(s,"_emval_take_value");var c=s.readValueFromPointer(a);return Fe.toHandle(c)}function Xg(s){return s=Fe.toValue(s),Fe.toHandle(typeof s)}function jg(s,a){var c=new Date(U[s>>2]*1e3);U[a>>2]=c.getSeconds(),U[a+4>>2]=c.getMinutes(),U[a+8>>2]=c.getHours(),U[a+12>>2]=c.getDate(),U[a+16>>2]=c.getMonth(),U[a+20>>2]=c.getFullYear()-1900,U[a+24>>2]=c.getDay();var h=new Date(c.getFullYear(),0,1),v=(c.getTime()-h.getTime())/(1e3*60*60*24)|0;U[a+28>>2]=v,U[a+36>>2]=-(c.getTimezoneOffset()*60);var w=new Date(c.getFullYear(),6,1).getTimezoneOffset(),b=h.getTimezoneOffset(),S=(w!=b&&c.getTimezoneOffset()==Math.min(b,w))|0;U[a+32>>2]=S}function qg(s,a,c,h,v,w){try{var b=g.getStream(v);b&&(c&2&&ae.doMsync(s,b,a,h,w),g.munmap(b))}catch(S){if(typeof g>"u"||!(S instanceof g.ErrnoError))throw S;return-S.errno}}function Zg(s,a,c){var h=new Date().getFullYear(),v=new Date(h,0,1),w=new Date(h,6,1),b=v.getTimezoneOffset(),S=w.getTimezoneOffset(),E=Math.max(b,S);U[s>>2]=E*60,U[a>>2]=Number(b!=S);function P(W){var le=W.toTimeString().match(/\(([A-Za-z ]+)\)$/);return le?le[1]:"GMT"}var B=P(v),L=P(w),D=Jn(B),G=Jn(L);S<b?(ne[c>>2]=D,ne[c+4>>2]=G):(ne[c>>2]=G,ne[c+4>>2]=D)}function Fi(s,a,c){Fi.called||(Fi.called=!0,Zg(s,a,c))}function Kg(){Xt("")}function Wu(){return 2147483648}function Qg(){return Wu()}function Jg(s,a,c){$e.copyWithin(s,a,a+c)}function em(s){try{return he.grow(s-Pt.byteLength+65535>>>16),Su(he.buffer),1}catch{}}function tm(s){var a=$e.length;s=s>>>0;var c=Wu();if(s>c)return!1;let h=(E,P)=>E+(P-E%P)%P;for(var v=1;v<=4;v*=2){var w=a*(1+.2/v);w=Math.min(w,s+100663296);var b=Math.min(c,h(Math.max(s,w),65536)),S=em(b);if(S)return!0}return!1}var Mi={};function rm(){return u||"./this.program"}function fn(){if(!fn.strings){var s=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:s,_:rm()};for(var c in Mi)Mi[c]===void 0?delete a[c]:a[c]=Mi[c];var h=[];for(var c in a)h.push(c+"="+a[c]);fn.strings=h}return fn.strings}function nm(s,a){var c=0;return fn().forEach(function(h,v){var w=a+c;ne[s+v*4>>2]=w,eo(h,w),c+=h.length+1}),0}function om(s,a){var c=fn();ne[s>>2]=c.length;var h=0;return c.forEach(function(v){h+=v.length+1}),ne[a>>2]=h,0}function im(s){Im(s)}function sm(s){try{var a=ae.getStreamFromFD(s);return g.close(a),0}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return c.errno}}function am(s,a,c,h){for(var v=0,w=0;w<c;w++){var b=ne[a>>2],S=ne[a+4>>2];a+=8;var E=g.read(s,He,b,S,h);if(E<0)return-1;if(v+=E,E<S)break}return v}function um(s,a,c,h){try{var v=ae.getStreamFromFD(s),w=am(v,a,c);return U[h>>2]=w,0}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return b.errno}}function lm(s,a){return a+2097152>>>0<4194305-!!s?(s>>>0)+a*4294967296:NaN}function cm(s,a,c,h,v){try{var w=lm(a,c);if(isNaN(w))return 61;var b=ae.getStreamFromFD(s);return g.llseek(b,w,h),At=[b.position>>>0,(Ne=b.position,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],U[v>>2]=At[0],U[v+4>>2]=At[1],b.getdents&&w===0&&h===0&&(b.getdents=null),0}catch(S){if(typeof g>"u"||!(S instanceof g.ErrnoError))throw S;return S.errno}}function fm(s,a,c,h){for(var v=0,w=0;w<c;w++){var b=ne[a>>2],S=ne[a+4>>2];a+=8;var E=g.write(s,He,b,S,h);if(E<0)return-1;v+=E}return v}function hm(s,a,c,h){try{var v=ae.getStreamFromFD(s),w=fm(v,a,c);return ne[h>>2]=w,0}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return b.errno}}function $u(s){for(var a=s.split("."),c=0;c<4;c++){var h=Number(a[c]);if(isNaN(h))return null;a[c]=h}return(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)>>>0}function hn(s){return parseInt(s)}function pm(s){var a,c,h,v,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,b=[];if(!w.test(s))return null;if(s==="::")return[0,0,0,0,0,0,0,0];for(s.startsWith("::")?s=s.replace("::","Z:"):s=s.replace("::",":Z:"),s.indexOf(".")>0?(s=s.replace(new RegExp("[.]","g"),":"),a=s.split(":"),a[a.length-4]=hn(a[a.length-4])+hn(a[a.length-3])*256,a[a.length-3]=hn(a[a.length-2])+hn(a[a.length-1])*256,a=a.slice(0,a.length-2)):a=s.split(":"),h=0,v=0,c=0;c<a.length;c++)if(typeof a[c]=="string")if(a[c]==="Z"){for(v=0;v<8-a.length+1;v++)b[c+v]=0;h=v-1}else b[c+h]=Qu(parseInt(a[c],16));else b[c+h]=a[c];return[b[1]<<16|b[0],b[3]<<16|b[2],b[5]<<16|b[4],b[7]<<16|b[6]]}var qt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(s){var a=$u(s);if(a!==null||(a=pm(s),a!==null))return s;var c;if(qt.address_map.addrs[s])c=qt.address_map.addrs[s];else{var h=qt.address_map.id++;Le(h<65535,"exceeded max address mappings of 65535"),c="172.29."+(h&255)+"."+(h&65280),qt.address_map.names[c]=s,qt.address_map.addrs[s]=c}return c},lookup_addr:function(s){return qt.address_map.names[s]?qt.address_map.names[s]:null}};function dm(s){var a=Ft(20),c=Ft(s.length+1);Te(s,c,s.length+1),ne[a>>2]=c;var h=Ft(4);ne[h>>2]=0,ne[a+4>>2]=h;var v=2;U[a+8>>2]=v,U[a+12>>2]=4;var w=Ft(12);return ne[w>>2]=w+8,ne[w+4>>2]=0,U[w+8>>2]=$u(qt.lookup_name(s)),ne[a+16>>2]=w,a}function vm(s){return dm(J(s))}function gm(s){var a=s.getExtension("ANGLE_instanced_arrays");if(a)return s.vertexAttribDivisor=function(c,h){a.vertexAttribDivisorANGLE(c,h)},s.drawArraysInstanced=function(c,h,v,w){a.drawArraysInstancedANGLE(c,h,v,w)},s.drawElementsInstanced=function(c,h,v,w,b){a.drawElementsInstancedANGLE(c,h,v,w,b)},1}function mm(s){var a=s.getExtension("OES_vertex_array_object");if(a)return s.createVertexArray=function(){return a.createVertexArrayOES()},s.deleteVertexArray=function(c){a.deleteVertexArrayOES(c)},s.bindVertexArray=function(c){a.bindVertexArrayOES(c)},s.isVertexArray=function(c){return a.isVertexArrayOES(c)},1}function ym(s){var a=s.getExtension("WEBGL_draw_buffers");if(a)return s.drawBuffers=function(c,h){a.drawBuffersWEBGL(c,h)},1}function wm(s){return!!(s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw"))}var _e={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(a){_e.lastError||(_e.lastError=a)},getNewId:function(s){for(var a=_e.counter++,c=s.length;c<a;c++)s[c]=null;return a},getSource:function(s,a,c,h){for(var v="",w=0;w<a;++w){var b=h?U[h+w*4>>2]:-1;v+=J(U[c+w*4>>2],b<0?void 0:b)}return v},createContext:function(s,a){if(!s.getContextSafariWebGL2Fixed){let v=function(w,b){var S=s.getContextSafariWebGL2Fixed(w,b);return w=="webgl"==S instanceof WebGLRenderingContext?S:null};s.getContextSafariWebGL2Fixed=s.getContext,s.getContext=v}var c=s.getContext("webgl",a);if(!c)return 0;var h=_e.registerContext(c,a);return h},registerContext:function(s,a){var c=_e.getNewId(_e.contexts),h={handle:c,attributes:a,version:a.majorVersion,GLctx:s};return s.canvas&&(s.canvas.GLctxObject=h),_e.contexts[c]=h,(typeof a.enableExtensionsByDefault>"u"||a.enableExtensionsByDefault)&&_e.initExtensions(h),c},makeContextCurrent:function(s){return _e.currentContext=_e.contexts[s],r.ctx=je=_e.currentContext&&_e.currentContext.GLctx,!(s&&!je)},getContext:function(s){return _e.contexts[s]},deleteContext:function(s){_e.currentContext===_e.contexts[s]&&(_e.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(_e.contexts[s].GLctx.canvas),_e.contexts[s]&&_e.contexts[s].GLctx.canvas&&(_e.contexts[s].GLctx.canvas.GLctxObject=void 0),_e.contexts[s]=null},initExtensions:function(s){if(s||(s=_e.currentContext),!s.initExtensionsDone){s.initExtensionsDone=!0;var a=s.GLctx;gm(a),mm(a),ym(a),a.disjointTimerQueryExt=a.getExtension("EXT_disjoint_timer_query"),wm(a);var c=a.getSupportedExtensions()||[];c.forEach(function(h){!h.includes("lose_context")&&!h.includes("debug")&&a.getExtension(h)})}}};function Yu(s){return s.slice(-1)=="]"&&s.lastIndexOf("[")}function bm(s){var a=s.uniformLocsById,c=s.uniformSizeAndIdsByName,h,v;if(!a)for(s.uniformLocsById=a={},s.uniformArrayNamesById={},h=0;h<je.getProgramParameter(s,35718);++h){var w=je.getActiveUniform(s,h),b=w.name,S=w.size,E=Yu(b),P=E>0?b.slice(0,E):b,B=s.uniformIdCounter;for(s.uniformIdCounter+=S,c[P]=[S,B],v=0;v<S;++v)a[B]=v,s.uniformArrayNamesById[B++]=P}}function Sm(s,a){if(a=J(a),s=_e.programs[s]){bm(s);var c=s.uniformLocsById,h=0,v=a,w=Yu(a);w>0&&(h=hn(a.slice(w+1))>>>0,v=a.slice(0,w));var b=s.uniformSizeAndIdsByName[v];if(b&&h<b[0]&&(h+=b[1],c[h]=c[h]||je.getUniformLocation(s,a)))return h}else _e.recordError(1281);return-1}function Zt(s){var a=je.currentProgram;if(a){var c=a.uniformLocsById[s];return typeof c=="number"&&(a.uniformLocsById[s]=c=je.getUniformLocation(a,a.uniformArrayNamesById[s]+(c>0?"["+c+"]":""))),c}else _e.recordError(1282)}function _m(s,a){je.uniform1f(Zt(s),a)}function Tm(s,a){je.uniform1i(Zt(s),a)}var po=[];function Em(s,a,c){if(a<=144)for(var h=po[2*a-1],v=0;v<2*a;v+=2)h[v]=ut[c+4*v>>2],h[v+1]=ut[c+(4*v+4)>>2];else var h=ut.subarray(c>>2,c+a*8>>2);je.uniform2fv(Zt(s),h)}var vo=[];function xm(s,a,c){if(a<=144)for(var h=vo[2*a-1],v=0;v<2*a;v+=2)h[v]=U[c+4*v>>2],h[v+1]=U[c+(4*v+4)>>2];else var h=U.subarray(c>>2,c+a*8>>2);je.uniform2iv(Zt(s),h)}function Cm(s,a,c){if(a<=96)for(var h=po[3*a-1],v=0;v<3*a;v+=3)h[v]=ut[c+4*v>>2],h[v+1]=ut[c+(4*v+4)>>2],h[v+2]=ut[c+(4*v+8)>>2];else var h=ut.subarray(c>>2,c+a*12>>2);je.uniform3fv(Zt(s),h)}function km(s,a,c){if(a<=96)for(var h=vo[3*a-1],v=0;v<3*a;v+=3)h[v]=U[c+4*v>>2],h[v+1]=U[c+(4*v+4)>>2],h[v+2]=U[c+(4*v+8)>>2];else var h=U.subarray(c>>2,c+a*12>>2);je.uniform3iv(Zt(s),h)}function Pm(s,a,c){if(a<=72){var h=po[4*a-1],v=ut;c>>=2;for(var w=0;w<4*a;w+=4){var b=c+w;h[w]=v[b],h[w+1]=v[b+1],h[w+2]=v[b+2],h[w+3]=v[b+3]}}else var h=ut.subarray(c>>2,c+a*16>>2);je.uniform4fv(Zt(s),h)}function Am(s,a,c){if(a<=72)for(var h=vo[4*a-1],v=0;v<4*a;v+=4)h[v]=U[c+4*v>>2],h[v+1]=U[c+(4*v+4)>>2],h[v+2]=U[c+(4*v+8)>>2],h[v+3]=U[c+(4*v+12)>>2];else var h=U.subarray(c>>2,c+a*16>>2);je.uniform4iv(Zt(s),h)}function Om(s){}function go(s){return s%4===0&&(s%100!==0||s%400===0)}function Rm(s,a){for(var c=0,h=0;h<=a;c+=s[h++]);return c}var Xu=[31,29,31,30,31,30,31,31,30,31,30,31],ju=[31,28,31,30,31,30,31,31,30,31,30,31];function Dm(s,a){for(var c=new Date(s.getTime());a>0;){var h=go(c.getFullYear()),v=c.getMonth(),w=(h?Xu:ju)[v];if(a>w-c.getDate())a-=w-c.getDate()+1,c.setDate(1),v<11?c.setMonth(v+1):(c.setMonth(0),c.setFullYear(c.getFullYear()+1));else return c.setDate(c.getDate()+a),c}return c}function Fm(s,a,c,h){var v=U[h+40>>2],w={tm_sec:U[h>>2],tm_min:U[h+4>>2],tm_hour:U[h+8>>2],tm_mday:U[h+12>>2],tm_mon:U[h+16>>2],tm_year:U[h+20>>2],tm_wday:U[h+24>>2],tm_yday:U[h+28>>2],tm_isdst:U[h+32>>2],tm_gmtoff:U[h+36>>2],tm_zone:v?J(v):""},b=J(c),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var E in S)b=b.replace(new RegExp(E,"g"),S[E]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=["January","February","March","April","May","June","July","August","September","October","November","December"];function L(R,z,Me){for(var de=typeof R=="number"?R.toString():R||"";de.length<z;)de=Me[0]+de;return de}function D(R,z){return L(R,z,"0")}function G(R,z){function Me(Ze){return Ze<0?-1:Ze>0?1:0}var de;return(de=Me(R.getFullYear()-z.getFullYear()))===0&&(de=Me(R.getMonth()-z.getMonth()))===0&&(de=Me(R.getDate()-z.getDate())),de}function W(R){switch(R.getDay()){case 0:return new Date(R.getFullYear()-1,11,29);case 1:return R;case 2:return new Date(R.getFullYear(),0,3);case 3:return new Date(R.getFullYear(),0,2);case 4:return new Date(R.getFullYear(),0,1);case 5:return new Date(R.getFullYear()-1,11,31);case 6:return new Date(R.getFullYear()-1,11,30)}}function le(R){var z=Dm(new Date(R.tm_year+1900,0,1),R.tm_yday),Me=new Date(z.getFullYear(),0,4),de=new Date(z.getFullYear()+1,0,4),Ze=W(Me),Ae=W(de);return G(Ze,z)<=0?G(Ae,z)<=0?z.getFullYear()+1:z.getFullYear():z.getFullYear()-1}var Ce={"%a":function(R){return P[R.tm_wday].substring(0,3)},"%A":function(R){return P[R.tm_wday]},"%b":function(R){return B[R.tm_mon].substring(0,3)},"%B":function(R){return B[R.tm_mon]},"%C":function(R){var z=R.tm_year+1900;return D(z/100|0,2)},"%d":function(R){return D(R.tm_mday,2)},"%e":function(R){return L(R.tm_mday,2," ")},"%g":function(R){return le(R).toString().substring(2)},"%G":function(R){return le(R)},"%H":function(R){return D(R.tm_hour,2)},"%I":function(R){var z=R.tm_hour;return z==0?z=12:z>12&&(z-=12),D(z,2)},"%j":function(R){return D(R.tm_mday+Rm(go(R.tm_year+1900)?Xu:ju,R.tm_mon-1),3)},"%m":function(R){return D(R.tm_mon+1,2)},"%M":function(R){return D(R.tm_min,2)},"%n":function(){return`
`},"%p":function(R){return R.tm_hour>=0&&R.tm_hour<12?"AM":"PM"},"%S":function(R){return D(R.tm_sec,2)},"%t":function(){return"	"},"%u":function(R){return R.tm_wday||7},"%U":function(R){var z=R.tm_yday+7-R.tm_wday;return D(Math.floor(z/7),2)},"%V":function(R){var z=Math.floor((R.tm_yday+7-(R.tm_wday+6)%7)/7);if((R.tm_wday+371-R.tm_yday-2)%7<=2&&z++,z){if(z==53){var de=(R.tm_wday+371-R.tm_yday)%7;de!=4&&(de!=3||!go(R.tm_year))&&(z=1)}}else{z=52;var Me=(R.tm_wday+7-R.tm_yday-1)%7;(Me==4||Me==5&&go(R.tm_year%400-1))&&z++}return D(z,2)},"%w":function(R){return R.tm_wday},"%W":function(R){var z=R.tm_yday+7-(R.tm_wday+6)%7;return D(Math.floor(z/7),2)},"%y":function(R){return(R.tm_year+1900).toString().substring(2)},"%Y":function(R){return R.tm_year+1900},"%z":function(R){var z=R.tm_gmtoff,Me=z>=0;return z=Math.abs(z)/60,z=z/60*100+z%60,(Me?"+":"-")+String("0000"+z).slice(-4)},"%Z":function(R){return R.tm_zone},"%%":function(){return"%"}};b=b.replace(/%%/g,"\0\0");for(var E in Ce)b.includes(E)&&(b=b.replace(new RegExp(E,"g"),Ce[E](w)));b=b.replace(/\0\0/g,"%");var Pe=wo(b,!1);return Pe.length>a?0:(nn(Pe,s),Pe.length-1)}function Mm(s,a,c,h){return Fm(s,a,c,h)}var qu=function(s,a,c,h){s||(s=this),this.parent=s,this.mount=s.mount,this.mounted=null,this.id=g.nextInode++,this.name=a,this.mode=c,this.node_ops={},this.stream_ops={},this.rdev=h},mo=365,yo=146;Object.defineProperties(qu.prototype,{read:{get:function(){return(this.mode&mo)===mo},set:function(s){s?this.mode|=mo:this.mode&=~mo}},write:{get:function(){return(this.mode&yo)===yo},set:function(s){s?this.mode|=yo:this.mode&=~yo}},isFolder:{get:function(){return g.isDir(this.mode)}},isDevice:{get:function(){return g.isChrdev(this.mode)}}}),g.FSNode=qu,g.staticInit(),Mv(),kr=r.BindingError=bi(Error,"BindingError"),Du=r.InternalError=bi(Error,"InternalError"),Qv(),Wv(),sg(),Iu=r.UnboundTypeError=bi(Error,"UnboundTypeError"),mg();for(var je,Bm=new Float32Array(288),Dt=0;Dt<288;++Dt)po[Dt]=Bm.subarray(0,Dt+1);for(var Lm=new Int32Array(288),Dt=0;Dt<288;++Dt)vo[Dt]=Lm.subarray(0,Dt+1);function wo(s,a,c){var h=c>0?c:fe(s)+1,v=new Array(h),w=be(s,v,0,v.length);return a&&(v.length=w),v}var Um={ga:dv,k:vv,b:gv,c:yv,Q:Tv,R:Ev,q:Cv,K:kv,U:Pv,I:Av,H:Ov,u:Rv,J:Dv,z:Fv,W:Uv,d:fg,f:hg,e:pg,a:dg,V:yg,g:bg,h:Sg,v:Tg,j:xg,i:Cg,w:kg,r:Pg,X:Ag,N:Og,M:Dg,m:Fg,ka:Lg,x:Ai,la:Ug,ja:Ng,s:Vg,E:Hg,ia:zg,ma:Wg,n:$g,l:Yg,na:Xg,O:jg,D:qg,P:Fi,t:Kg,C:Qg,L:Jg,o:tm,F:nm,G:om,fa:im,p:sm,T:um,y:cm,S:hm,ha:vm,ea:Sm,ca:_m,da:Tm,_:Em,ba:xm,Z:Cm,aa:km,Y:Pm,$:Am,A:Om,B:Mm};pv(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Ft=r._malloc=function(){return(Ft=r._malloc=r.asm.qa).apply(null,arguments)},Mt=r._free=function(){return(Mt=r._free=r.asm.ra).apply(null,arguments)},Zu=r.___errno_location=function(){return(Zu=r.___errno_location=r.asm.sa).apply(null,arguments)},Ku=r.___getTypeName=function(){return(Ku=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var Qu=r._htons=function(){return(Qu=r._htons=r.asm.wa).apply(null,arguments)},Ju=r._emscripten_builtin_memalign=function(){return(Ju=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},el=r.___cxa_is_pointer_type=function(){return(el=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=g;var bo;function Bi(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}sn=function s(){bo||Li(),bo||(sn=s)};function Li(s){if(ar>0||(iv(),ar>0))return;function a(){bo||(bo=!0,r.calledRun=!0,!Oe&&(sv(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),av()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),a()},1)):a()}r.run=Li;function Im(s,a){Gm(s)}function Gm(s){Cu()||(r.onExit&&r.onExit(s),Oe=!0),l(s,new Bi(s))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Li(),r.ready}})(),rl="/cad-os/assets/replicad_single-b4564eab.wasm";const So={library:null},nl=t=>{So.library=t},I=()=>{if(!So.library)throw new Error("oppencascade has not been loaded");return So.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const Pr=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class Ke{constructor(e){this.oc=I(),e&&Pr.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(Pr.unregister(this._wrapped),this._wrapped.delete()),Pr.register(this,e,e),this._wrapped=e}delete(){var e;Pr.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const ve=()=>{function t(e){return Pr.register(t,e),e}return t},Re=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},Ui=2147483647,rt=Math.PI/180,Ar=180/Math.PI,_o=t=>Math.round(t*1e3)/1e3,Or=(t,e,r)=>{const n=I(),o=Qe(t),i=yt(e);let u;if(r){const l=yt(r);u=new n.gp_Ax3_3(o,i,l),l.delete()}else u=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),u},Rr=(t,e,r)=>{const n=I(),o=Qe(t),i=yt(e);let u;if(r){const l=yt(r);u=new n.gp_Ax2_2(o,i,l),l.delete()}else u=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),u},Dr=(t,e)=>{const r=I(),n=Qe(t),o=yt(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},ol=(t=[0,0,0])=>{const e=I();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof O)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class O extends Ke{constructor(e=[0,0,0]){super(ol(e))}get repr(){return`x: ${_o(this.x)}, y: ${_o(this.y)}, z: ${_o(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new O(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new O(this.wrapped.Subtracted(e.wrapped))}add(e){return new O(this.wrapped.Added(e.wrapped))}multiply(e){return new O(this.wrapped.Multiplied(e))}normalized(){return new O(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*Ar}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),u=this.sub(i);return o.delete(),i.delete(),u}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Dr(r,n);return this.wrapped.Rotate(o,e*rt),o.delete(),this}}const il={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function sl(t){return t==="X"||t==="Y"||t==="Z"?il[t]:t}function Qe(t){const e=new O(t),r=e.toPnt();return e.delete(),r}function yt(t){const e=new O(t),r=e.toDir();return e.delete(),r}class Kt extends Ke{constructor(e){const r=I();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new O(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=yt(n),i=Qe(r),u=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(u,e*rt),u.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=ve();let o,i;if(typeof e=="string"){const l=n(Ii(e,r));o=l.origin,i=l.zDir}else e instanceof Xe?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const u=n(Rr(o,i));return this.wrapped.SetMirror_3(u),this}scale(e,r){const n=Qe(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=ve(),o=n(e==="reference"?new this.oc.gp_Ax3_1:Or(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:Or(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=Qe(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Xe{constructor(e,r=null,n=[0,0,1]){this.oc=I();const o=new O(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new O(r);else{const u=Or(e,o);i=new O(u.XDirection()),u.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new O(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Xe(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new O(e),r}translate(e,r=0,n=0){const o=new O(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=sl(r),o=new O(this.zDir).rotate(e,[0,0,0],n),i=new O(this.xDir).rotate(e,[0,0,0],n);return new Xe(this.origin,i,o)}rotate2DAxes(e){const r=new O(this.xDir).rotate(e,[0,0,0],this.zDir);return new Xe(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=Or(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new Kt,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new Kt,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new O(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new O(r);return r.delete(),n}}const al={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},Ii=(t,e=[0,0,0])=>{const r=al[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new Xe(n,r.xDir,r.normal)};let ul=class extends Ke{constructor(e){const r=I();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new O(e).repr} - ${new O(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},u={current:0};return this.wrapped.Get(e,r,n,o,i,u),[[e.current,r.current,n.current],[o.current,i.current,u.current]]}get center(){const[[e,r,n],[o,i,u]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(u-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function Bt(t="XY",e=[0,0,0]){return t instanceof Xe?t.clone():Ii(t,e)}function ll(t,e,r=[0,0,0],n=[0,0,1]){const o=new Kt;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function cl(t,e){const r=new Kt;r.translate(e);const n=r.transform(t);return r.delete(),n}function fl(t,e,r){const n=new Kt;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function hl(t,e,r){const n=new Kt;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function pn(t){return Array.isArray(t)&&t.length===2}let dn=null;const Gi=t=>{if(dn&&!t)return dn;const r=I().GeomAbs_CurveType;return dn=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),dn},Fr=t=>{let e=Gi().get(t);if(e||(e=Gi(!0).get(t)),!e)throw new Error("unknown type");return e};function pl(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function dl(t){return Array.from(Array(t).keys())}function hr(t){const e=Math.min(...t.map(r=>r.length));return dl(e).map(r=>t.map(n=>n[r]))}function vn(t){return Math.round(t*100)/100}const Mr=([t,e])=>`(${vn(t)},${vn(e)})`,Ni=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Vi=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${Ni(r,e)},${Ni(n,e)}]`,[r,n]])).values()),Ve=([t,e])=>{const r=I();return new r.gp_Pnt2d_3(t,e)},vl=([t,e])=>{const r=I();return new r.gp_Dir2d_4(t,e)},Hi=([t,e])=>{const r=I();return new r.gp_Vec2d_4(t,e)},pr=(t,e)=>{const r=I(),[n,o]=Re(),i=new r.gp_Ax2d_2(n(Ve(t)),n(vl(e)));return o(),i};class Br extends Ke{constructor(e){const r=I();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${Mr(e)} - ${Mr(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=ve()(Ve(e));return!this.wrapped.IsOut_1(n)}}const ze=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,dr=([t,e],[r,n])=>[t+r,e+n],To=([t,e],[r,n])=>[t-r,e-n],Eo=([t,e],r)=>[t*r,e*r],ct=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),gl=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function ml([t,e],[r,n]){return t*n-e*r}const yl=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),wl=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),Lt=([t,e])=>{const r=ct([t,e]);return[t/r,e/r]},bl=(t,e,r=[0,0])=>{const[n,o]=t,[i,u]=r,l=n-i,f=o-u,p=Math.sin(e),d=Math.cos(e),y=l*d-f*p,m=l*p+f*d;return[y+i,m+u]},vr=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},Sl=([t,e])=>{const r=ct([t,e]),n=Math.atan2(e,t);return[r,n]};class Ee extends Ke{constructor(e){const r=I(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=I(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new Br(r),this._boundingBox}get repr(){return`${this.geomType} ${Mr(this.firstPoint)} - ${Mr(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=I();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=Fr(e.GetType());return e.delete(),r}clone(){return new Ee(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=I(),n=ve(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(Ve(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,ct(e,this.firstPoint),ct(e,this.lastPoint))}distanceFromCurve(e){const r=I(),n=ve();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return pn(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=I(),o=ve();let i,u;try{const l=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(Ve(e)),this.wrapped));i=l.LowerDistance(),u=l.LowerDistanceParameter()}catch{if(ze(e,this.firstPoint,r))return this.firstParameter;if(ze(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${Mr(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return u}tangentAt(e){const r=I(),[n,o]=Re();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const u=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,u,l);const f=[l.X(),l.Y()];return o(),f}splitAt(e,r=1e-9){const n=I(),o=ve();let i=e.map(f=>pn(f)?this.parameter(f,r):f);i=Array.from(new Map(i.map(f=>[pl(f,-Math.log10(r)),f])).values()).sort((f,p)=>f-p);const u=this.firstParameter,l=this.lastParameter;return u>l&&i.reverse(),Math.abs(i[0]-u)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-l)<r*100&&(i=i.slice(0,-1)),i.length?hr([[u,...i],[...i,l]]).map(([f,p])=>{try{if(this.geomType==="BEZIER_CURVE"){const y=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return y.Segment(f,p),new Ee(new n.Handle_Geom2d_Curve_2(y))}if(this.geomType==="BSPLINE_CURVE"){const y=o(this.adaptor()).BSpline().get(),m=new n.Geom2d_BSplineCurve_1(y.Poles_2(),y.Knots_2(),y.Multiplicities_2(),y.Degree(),y.IsPeriodic());return m.Segment(f,p,r),new Ee(new n.Handle_Geom2d_Curve_2(m))}const d=new n.Geom2d_TrimmedCurve(this.wrapped,f,p,!0,!0);return new Ee(new n.Handle_Geom2d_Curve_2(d))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const zi=(t,e=1e-4,r="C0",n=200)=>{const o=I(),i=ve(),u={C0:o.GeomAbs_Shape.GeomAbs_C0,C1:o.GeomAbs_Shape.GeomAbs_C1,C2:o.GeomAbs_Shape.GeomAbs_C2,C3:o.GeomAbs_Shape.GeomAbs_C3},l=i(new o.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,u[r],n,3));return new Ee(l.Curve())},Wi=t=>{if(Fr(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=I(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const u=n.NbArcs();if(u)for(let l=1;l<=u;l++){const f=n.Arc(l);yield new Ee(f)}}const i=Array.from(o());return n.delete(),i};function gn(t,e={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=ve();return t.flatMap(n=>{const o=r(n.adaptor()),i=Fr(o.GetType());if(i==="ELLIPSE"||i==="CIRCLE"&&ze(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(i))return n;if(i==="BEZIER_CURVE"){const f=o.Bezier().get().Degree();if([1,2,3].includes(f))return n}if(i==="BSPLINE_CURVE"){const l=Wi(o);return gn(l,e)}const u=zi(o,e.tolerance,e.continuity,e.maxSegments);return gn(Wi(r(u.adaptor())),e)})}function*$i(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*_l(t){const e=t.NbSegments();if(!e)return;const r=I();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new Ee(o),i.delete()}}const Lr=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=I(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,u;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from($i(o)),u=Array.from(_l(o))}catch(p){throw console.error(t,e,p),new Error("Intersections failed between curves")}finally{o.delete()}const l=u.filter(p=>ze(p.firstPoint,p.lastPoint,r)).map(p=>p.firstPoint);l.length&&(i.push(...l),u=u.filter(p=>!ze(p.firstPoint,p.lastPoint,r)));const f=u.flatMap(p=>[p.firstPoint,p.lastPoint]);return{intersections:i,commonSegments:u,commonSegmentsPoints:f}},Tl=(t,e=1e-9)=>{const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from($i(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},Ur=(t,e)=>{const r=I(),[n,o]=Re(),i=n(new r.GCE2d_MakeSegment_1(n(Ve(t)),n(Ve(e)))).Value(),u=new Ee(i);return ze(u.firstPoint,t)||u.reverse(),o(),u},xo=(t,e,r)=>{const n=I(),[o,i]=Re(),u=o(new n.GCE2d_MakeArcOfCircle_4(o(Ve(t)),o(Ve(e)),o(Ve(r)))).Value();i();const l=new Ee(u);return ze(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},El=(t,e,r)=>{const n=I(),[o,i]=Re(),u=o(new n.GCE2d_MakeArcOfCircle_5(o(Ve(t)),o(Hi(e)),o(Ve(r)))).Value();i();const l=new Ee(u);return ze(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},xl=(t,e,r,n,o=[0,0],i,u=!0)=>{const l=I(),[f,p]=Re(),d=f(new l.gp_Elips2d_2(f(pr(o,i)),t,e,!0)),y=f(new l.GCE2d_MakeArcOfEllipse_1(d,r,n,u)).Value();return p(),new Ee(y)},Cl=(t,e,r)=>{const n=I(),[o,i]=Re(),u=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));u.SetValue(1,o(Ve(t))),e.forEach((f,p)=>{u.SetValue(p+2,o(Ve(f)))}),u.SetValue(e.length+2,o(Ve(r)));const l=new n.Geom2d_BezierCurve_1(u);return i(),new Ee(new n.Handle_Geom2d_Curve_2(l))},Yi=(t,e,r)=>{const n=Eo(dr(t,e),.5),o=ct(r,t),i=Lt(To(n,r));return xo(t,dr(Eo(i,o),r),e)},kl=(t,e,r)=>{const n=Lt(To(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:dr(t,i),lastPoint:dr(e,i)}},Co=(t,e)=>{const r=ve(),n=t.geomType;if(n==="CIRCLE"){const f=r(r(t.adaptor()).Circle()),p=f.Radius(),d=f.IsDirect()?1:-1,y=e*d,m=p+y;if(m<1e-10){const A=r(f.Location()),M=[A.X(),A.Y()],F=X=>{const[$,ie]=Lt(To(X,M));return dr(X,[y*$,y*ie])};return{collapsed:!0,firstPoint:F(t.firstPoint),lastPoint:F(t.lastPoint)}}const _=I(),T=new _.gp_Circ2d_3(f.Axis(),m),x=new _.Geom2d_Circle_1(T),C=new _.Geom2d_TrimmedCurve(new _.Handle_Geom2d_Curve_2(x),t.firstParameter,t.lastParameter,!0,!0);return new Ee(new _.Handle_Geom2d_Curve_2(C))}if(n==="LINE"){const{firstPoint:f,lastPoint:p}=kl(t.firstPoint,t.lastPoint,e);return Ur(f,p)}const o=I(),i=new Ee(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),u=zi(i.adaptor());return Tl(u).length?{collapsed:!0,firstPoint:u.firstPoint,lastPoint:u.lastPoint}:u};function Xi(t,e,r){const n=ml(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,u=Co(t,i),l=Co(e,i);if(!(u instanceof Ee)||!(l instanceof Ee))return null;let f;try{const{intersections:_}=Lr(u,l,1e-9);f=_.at(-1)}catch{return null}if(!pn(f))return null;const p=f,d=(_,T)=>{const[x,C]=T.tangentAt(p),A=Lt([-C,x]),M=dr(p,Eo(A,i)),F=_.parameter(M,1e-6);return _.splitAt([F])},[y]=d(t,u),[,m]=d(e,l);return{first:y,second:m,center:p}}function ko(t,e,r){const n=Xi(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:u}=n;return[o,Yi(o.lastPoint,i.firstPoint,u),i]}function Po(t,e,r){const n=Xi(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,Ur(o.lastPoint,i.firstPoint),i]}class Pl{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let u=(i<<1)+1;const l=u+1;let f=this.ids[u],p=this.values[u];const d=this.values[l];if(l<this.length&&d<p&&(u=l,f=this.ids[l],p=d),p>=n)break;this.ids[i]=f,this.values[i]=p,i=u}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const ji=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Ao=3;class Oo{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==Ao)throw new Error(`Got v${n>>4} data when expected v${Ao}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Oo(i,o,ji[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,u=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),u+=i,this._levelBounds.push(u*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const l=ji.indexOf(this.ArrayType),f=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+f+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Ao<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new Pl}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let u=4*i;const l=this._boxes[u++],f=this._boxes[u++],p=this._boxes[u++],d=this._boxes[u++],y=Math.floor(o*((l+p)/2-this.minX)/e),m=Math.floor(o*((f+d)/2-this.minY)/r);n[i]=Ol(y,m)}Ro(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,u=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;u<l;){const f=u;let p=1/0,d=1/0,y=-1/0,m=-1/0;for(let _=0;_<this.nodeSize&&u<l;_++)p=Math.min(p,this._boxes[u++]),d=Math.min(d,this._boxes[u++]),y=Math.max(y,this._boxes[u++]),m=Math.max(m,this._boxes[u++]);this._indices[this._pos>>2]=f,this._boxes[this._pos++]=p,this._boxes[this._pos++]=d,this._boxes[this._pos++]=y,this._boxes[this._pos++]=m}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const l=[],f=[];for(;u!==void 0;){const p=Math.min(u+this.nodeSize*4,Zi(u,this._levelBounds));for(let d=u;d<p;d+=4){if(n<this._boxes[d]||o<this._boxes[d+1]||e>this._boxes[d+2]||r>this._boxes[d+3])continue;const y=this._indices[d>>2]|0;u<this.numItems*4?(i===void 0||i(y))&&f.push(y):l.push(y)}u=l.pop()}return f}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const l=this._queue,f=[],p=o*o;for(;u!==void 0;){const d=Math.min(u+this.nodeSize*4,Zi(u,this._levelBounds));for(let y=u;y<d;y+=4){const m=this._indices[y>>2]|0,_=qi(e,this._boxes[y],this._boxes[y+2]),T=qi(r,this._boxes[y+1],this._boxes[y+3]),x=_*_+T*T;u<this.numItems*4?(i===void 0||i(m))&&l.push((m<<1)+1,x):l.push(m<<1,x)}for(;l.length&&l.peek()&1;)if(l.peekValue()>p||(f.push(l.pop()>>1),f.length===n))return l.clear(),f;u=l.pop()>>1}return l.clear(),f}}function qi(t,e,r){return t<e?e-t:t<=r?0:t-r}function Zi(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function Ro(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const u=t[n+o>>1];let l=n-1,f=o+1;for(;;){do l++;while(t[l]<u);do f--;while(t[f]>u);if(l>=f)break;Al(t,e,r,l,f)}Ro(t,e,r,n,f,i),Ro(t,e,r,f+1,o,i)}function Al(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const u=4*n,l=4*o,f=e[u],p=e[u+1],d=e[u+2],y=e[u+3];e[u]=e[l],e[u+1]=e[l+1],e[u+2]=e[l+2],e[u+3]=e[l+3],e[l]=f,e[l+1]=p,e[l+2]=d,e[l+3]=y;const m=r[n];r[n]=r[o],r[o]=m}function Ol(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),u=r|n>>1,l=r>>1^r,f=o>>1^n&i>>1^o,p=r&o>>1^i>>1^i;r=u,n=l,o=f,i=p,u=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,f^=r&o>>2^n&i>>2,p^=n&o>>2^(r^n)&i>>2,r=u,n=l,o=f,i=p,u=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,f^=r&o>>4^n&i>>4,p^=n&o>>4^(r^n)&i>>4,r=u,n=l,o=f,i=p,f^=r&o>>8^n&i>>8,p^=n&o>>8^(r^n)&i>>8,r=f^f>>1,n=p^p>>1;let d=t^e,y=n|65535^(d|r);return d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|d)>>>0}const Ki=(t,e=1e-7)=>{const r=new Oo(t.length);t.forEach(i=>{const[u,l]=i.firstPoint;r.add(u-e,l-e,u+e,l+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,u)=>{if(o.has(u))return;const l=[i];let f=u;o.add(u);let p=t.length;for(;;){if(p--<0)throw new Error("Infinite loop detected");const d=l[l.length-1].lastPoint,[y,m]=d,_=r.search(y-e,m-e,y+e,m+e),T=M=>Math.abs((f-M)%t.length),x=_.filter(M=>!o.has(M)).map(M=>[t[M],M,T(M)]).sort(([,,M],[,,F])=>T(M)-T(F));if(x.length===0){n.push(l);break}const[C,A]=x[0];l.push(C),o.add(A),f=A}}),n};function nt(t){return Math.round(t*1e5)/1e5}const Do=t=>`${vn(t.X())} ${vn(t.Y())}`,Rl=(t,e)=>{const r=I(),n=Fr(t.GetType()),[o,i]=e,u=`${nt(o)} ${nt(i)}`;if(n==="LINE")return`L ${u}`;if(n==="BEZIER_CURVE"){const l=t.Bezier().get(),f=l.Degree();if(f===1)return`L ${u}`;if(f===2)return`Q ${Do(l.Pole(2))} ${u}`;if(f===3){const p=Do(l.Pole(2)),d=Do(l.Pole(3));return`C ${p} ${d} ${u}`}}if(n==="CIRCLE"){const l=t.Circle(),f=l.Radius(),p=t.FirstParameter(),y=(t.LastParameter()-p)*Ar,m=y!==360?u:`${nt(o)} ${nt(i+1e-4)}`;return`A ${f} ${f} 0 ${Math.abs(y)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${m}`}if(n==="ELLIPSE"){const l=t.Ellipse(),f=l.MajorRadius(),p=l.MinorRadius(),d=t.FirstParameter(),m=(t.LastParameter()-d)*Ar,_=m!==360?u:`${nt(o)} ${nt(i+1e-4)}`,T=new r.gp_Dir2d_1,x=180-l.XAxis().Direction().Angle(T)*Ar;return T.delete(),`A ${nt(f)} ${nt(p)} ${nt(x)} ${Math.abs(m)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${_}`}throw new Error(`Unsupported curve type: ${n}`)},Dl={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},mn={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Qi{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Fl extends Ke{constructor(){const e=I();super(new e.Message_ProgressRange_1)}}class Fo extends Ke{constructor(e){const r=I();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(e.wrapped)}distanceTo(e){this.wrapped.LoadS2(e.wrapped);const r=new Fl;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class Ji extends Qi{when(e){return this.filters.push(e),this}inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new O(Dl[e]):n=new O(e);const o=({normal:i})=>{if(!i)return!1;const u=Math.acos(Math.abs(i.dot(n)));return Math.abs(u-rt*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=Tn(r),o=new Fo(n),i=({element:u})=>Math.abs(o.distanceTo(u)-e)<1e-6;return this.filters.push(i),this}containsPoint(e){return this.atDistance(0,e)}withinDistance(e,r=[0,0,0]){const n=Tn(r),o=new Fo(n),i=({element:u})=>o.distanceTo(u)-e<1e-6;return this.filters.push(i),this}inBox(e,r){const n=Gr(e,r);return this.inShape(n)}inShape(e){const r=new Fo(e),n=({element:o})=>r.distanceTo(o)<1e-6;return this.filters.push(n),this}}class yn extends Ji{clone(){const e=new yn;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&mn[e])return this.atAngleWith(mn[e],90);if(typeof e!="string"&&e instanceof Xe)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Xe?Bt(e):Bt(e,r);this.parallelTo(n);const o=({element:i})=>{const u=i.startPoint,l=u.projectToPlane(n);return u.equals(l)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class Mo extends Ji{clone(){const e=new Mo;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&mn[e])return this.atAngleWith(mn[e]);if(typeof e!="string"&&e instanceof Xe)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Xe?Bt(e):Bt(e,r);this.parallelTo(n);const o=({element:i})=>{const u=i.center,l=u.projectToPlane(n);return u.equals(l)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const Ml=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},Bo=2*Math.PI,es=t=>{const e=t%Bo,r=e<0?e+Bo:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-Bo)};class wn extends Qi{clone(){const e=new wn;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>ze(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(ct(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return ze(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,u]=r,l=Math.min(n,i),f=Math.max(n,i),p=Math.min(o,u),d=Math.max(o,u);function y({element:m}){const[_,T]=m.point;return _>=l&&_<=f&&T>=p&&T<=d}return this.filters.push(y),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(es(yl(o,i))-es(rt*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return Ml(e).filter(r=>this.shouldKeep(r))}}const ts=t=>{const e=I();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},Bl=function*(e,r){const n=I(),o=new n.TopExp_Explorer_2(e,ts(r),ts("shape")),i=new Map;for(;o.More();){const u=o.Current(),l=u.HashCode(Ui);i.get(l)||(i.set(l,!0),yield u),o.Next()}o.delete()},rs=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class bn extends Ke{constructor(e){super(e)}clone(){return new this.constructor(Jt(this.wrapped))}get hashCode(){return this.wrapped.HashCode(Ui)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=I(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=ye(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=ye(cl(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=ye(ll(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=ye(fl(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=ye(hl(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return Bl(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>Jt(r))}get edges(){return this._listTopo("edge").map(e=>new Ut(e))}get faces(){return this._listTopo("face").map(e=>new gr(e))}get wires(){return this._listTopo("wire").map(e=>new wt(e))}get boundingBox(){const e=new ul;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const u=[];for(const l of this.faces){const f=l.triangulation(o.length/3);if(!f)continue;const{trianglesIndexes:p,vertices:d,verticesNormals:y}=f;u.push({start:n.length,count:p.length,faceId:l.hashCode}),n=n.concat(p),o=o.concat(d),i=i.concat(y)}return{triangles:n,vertices:o,normals:i,faceGroups:u}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=ve(),i=new Set,u=[],l=[],f=()=>{const d=u.length;let y=null;return[m=>{y?(u.push(...y),y=[m.X(),m.Y(),m.Z()],u.push(...y)):y=[m.X(),m.Y(),m.Z()]},m=>{l.push({start:d/3,count:(u.length-d)/3,edgeId:m}),i.add(m)}]},p=o(new this.oc.TopLoc_Location_1);for(const d of this.faces){const y=o(this.oc.BRep_Tool.Triangulation(d.wrapped,p,0));if(y.IsNull())continue;const m=y.get();for(const _ of d.edges){if(o(_),i.has(_.hashCode))continue;const T=o(new this.oc.TopLoc_Location_1),x=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(_.wrapped,y,T)),C=(n=x==null?void 0:x.get())==null?void 0:n.Nodes();if(!C)continue;o(C);const[A,M]=f();for(let F=C.Lower();F<=C.Upper();F++){const X=o(o(m.Node(C.Value(F))).Transformed(T.Transformation()));A(X)}M(_.hashCode)}}for(const d of this.edges){o(d);const y=d.hashCode;if(i.has(y))continue;const m=o(new this.oc.BRepAdaptor_Curve_2(d.wrapped)),_=o(new this.oc.GCPnts_TangentialDeflection_2(m,e,r,2,1e-9,1e-7)),[T,x]=f();for(let C=0;C<_.NbPoints();C++){const A=o(_.Value(C+1).Transformed(p.Transformation()));T(A)}x(y)}return{lines:u,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const u=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([u],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class ns extends bn{}class os extends bn{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new Ll(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(e=0){return this.curve.tangentAt(e)}pointAt(e=0){return this.curve.pointAt(e)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Ll extends Ke{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return Fr(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new O(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new O(e)}_mapParameter(e){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*e}pointAt(e=.5){return new O(this.wrapped.Value(this._mapParameter(e)))}tangentAt(e=.5){const r=this._mapParameter(e),n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new O(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Ut extends os{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class wt extends os{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=ye(o.Shape());if(o.delete(),this.delete(),!(i instanceof wt))throw new Error("Could not offset with a wire");return i}}class Ul extends Ke{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class gr extends bn{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Ul(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:u}=this.UVBounds,l=this._geomAdaptor(),f=new this.oc.gp_Pnt_1,p=e*(o-n)+n,d=r*(u-i)+i;l.D0(p,d,f);const y=new O(f);return l.delete(),f.delete(),y}normalAt(e){let r=0,n=0;const o=ve();if(e){const p=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),d=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(Qe(e)),p,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),y={current:0},m={current:0};d.LowerDistanceParameters(y,m),r=y.current,n=m.current}else{const{uMin:p,uMax:d,vMin:y,vMax:m}=this.UVBounds;r=.5*(p+d),n=.5*(y+m)}const i=o(new this.oc.gp_Pnt_1),u=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,u),new O(u)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new O(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new wt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=ve(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),u={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=o.get(),f=l.NbNodes();u.vertices=new Array(f*3);for(let T=1;T<=f;T++){const x=r(r(l.Node(T)).Transformed(i));u.vertices[(T-1)*3+0]=x.X(),u.vertices[(T-1)*3+1]=x.Y(),u.vertices[(T-1)*3+2]=x.Z()}const p=r(new this.oc.TColgp_Array1OfDir_2(1,f)),d=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,d,p),u.verticesNormals=new Array(p.Length()*3);for(let T=p.Lower();T<=p.Upper();T++){const x=r(r(p.Value(T)).Transformed(i));u.verticesNormals[(T-1)*3+0]=x.X(),u.verticesNormals[(T-1)*3+1]=x.Y(),u.verticesNormals[(T-1)*3+2]=x.Z()}const y=this.orientation,m=l.NbTriangles();u.trianglesIndexes=new Array(m*3);let _=0;for(let T=1;T<=m;T++){const x=r(l.Triangle(T));let C=x.Value(1),A=x.Value(2);const M=x.Value(3);if(y==="backward"){const F=C;C=A,A=F}u.trianglesIndexes[_*3+0]=C-1+e,u.trianglesIndexes[_*3+1]=A-1+e,u.trianglesIndexes[_*3+2]=M-1+e,_++}return u}}class Sn extends bn{fuse(e,{optimisation:r="none"}={}){const n=ve(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const u=ye(i.Shape());if(!bt(u))throw new Error("Could not fuse as a 3d shape");return u}cut(e,{optimisation:r="none"}={}){const n=ve(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const u=ye(i.Shape());if(!bt(u))throw new Error("Could not cut as a 3d shape");return u}intersect(e){const r=ve(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=ye(o.Shape());if(!bt(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,u;if(typeof e=="number"){u=e;const _=new Mo;i=typeof r=="function"?r(_):_}else u=e.thickness,i=e.filter;const l=ve(),f=i.find(this),p=l(new this.oc.TopTools_ListOfShape_1);f.forEach(_=>{p.Append_1(_.wrapped)});const d=l(new this.oc.Message_ProgressRange_1),y=l(new this.oc.BRepOffsetAPI_MakeThickSolid);y.MakeThickSolidByJoin(this.wrapped,p,-u,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,d);const m=ye(y.Shape());if(!bt(m))throw new Error("Could not shell as a 3d shape");return m}_builderIter(e,r){if(typeof e=="number"){let u=0;for(const l of this._iterTopo("edge"))r(e,Jt(l)),u+=1;return u}let n,o=null;typeof e=="function"?n=e:(n=u=>e.filter.shouldKeep(u)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const u of this._iterTopo("edge")){const l=Jt(u),f=new Ut(l),p=n(f);p&&(r(p,l),i+=1),f.delete()}return o&&o(),i}fillet(e,r){const o=ve()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new yn)}),!this._builderIter(i,(f,p)=>o.Add_2(f,p)))throw new Error("Could not fillet, no edge was selected");const l=ye(o.Shape());if(!bt(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const o=ve()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new yn)}),!this._builderIter(i,(f,p)=>o.Add_2(f,p)))throw new Error("Could not chamfer, no edge was selected");const l=ye(o.Shape());if(!bt(l))throw new Error("Could not chamfer as a 3d shape");return l}}class is extends Sn{}class Qt extends Sn{}class ss extends Sn{}class as extends Sn{}function bt(t){return t instanceof is||t instanceof Qt||t instanceof ss||t instanceof as}function us(t){return t instanceof wt}function Jt(t){const e=I(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=rs(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function ye(t){const r=I().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,ns],[r.TopAbs_EDGE,Ut],[r.TopAbs_WIRE,wt],[r.TopAbs_FACE,gr],[r.TopAbs_SHELL,is],[r.TopAbs_SOLID,Qt],[r.TopAbs_COMPSOLID,ss],[r.TopAbs_COMPOUND,as]]).get(rs(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(Jt(t))}const ls=(t,e)=>{const r=I();return new Ut(new r.BRepBuilderAPI_MakeEdge_3(Qe(t),Qe(e)).Edge())},Il=(t,e=[0,0,0],r=[0,0,1])=>{const n=I(),[o,i]=Re(),u=o(Rr(e,r)),l=o(new n.gp_Circ_2(u,t)),f=o(new n.BRepBuilderAPI_MakeEdge_8(l)),p=new Ut(f.Edge());return i(),p},Gl=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const u=I(),[l,f]=Re();let p=2*Math.PI;i&&(p=-2*Math.PI);const d=l(new u.Geom2d_Line_3(l(new u.gp_Pnt2d_3(0,0)),l(new u.gp_Dir2d_4(p,t)))),y=e/t,m=d.Value(0),_=d.Value(y*Math.sqrt((2*Math.PI)**2+t**2)),T=l(new u.GCE2d_MakeSegment_1(m,_)),x=new u.Geom_CylindricalSurface_1(l(Or(n,o)),r),C=l(new u.BRepBuilderAPI_MakeEdge_30(l(new u.Handle_Geom2d_Curve_2(T.Value().get())),l(new u.Handle_Geom_Surface_2(x)))).Edge(),A=l(new u.BRepBuilderAPI_MakeWire_2(C)).Wire();return u.BRepLib.BuildCurves3d_2(A),f(),new wt(A)},Ir=t=>{const e=I(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(u=>{u instanceof Ut&&r.Add_1(u.wrapped),u instanceof wt&&r.Add_2(u.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const u=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${u.get(o)||"unknown error"}`)}const i=new wt(r.Wire());return r.delete(),n.delete(),i},_n=(t,e)=>{const r=I(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new gr(o)},Nl=(t,e)=>{const r=I(),[n,o]=Re(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new gr(l)},cs=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=I(),i=Rr(r,n),u=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),l=new Qt(u.Shape());return i.delete(),u.delete(),l},Vl=t=>{const e=I(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new Qt(r.Shape());return r.delete(),n};class Hl extends Ke{constructor(e,r,n){const o=I(),i=ve(),u=Math.sqrt(e*r/n),l=e/u,f=r/u,p=new o.gp_GTrsf_1;p.SetAffinity_1(Dr([0,0,0],[0,1,0]),l);const d=i(new o.gp_GTrsf_1);d.SetAffinity_1(Dr([0,0,0],[0,0,1]),u);const y=i(new o.gp_GTrsf_1);y.SetAffinity_1(Dr([0,0,0],[1,0,0]),f),p.Multiply(d),p.Multiply(y),super(p)}applyToPoint(e){const r=I(),o=ve()(e.XYZ());return this.wrapped.Transforms_1(o),new r.gp_Pnt_2(o)}}function zl(t){const e=[];for(let r=t.LowerRow();r<=t.UpperRow();r++){const n=[];e.push(n);for(let o=t.LowerCol();o<=t.UpperCol();o++){const i=t.Value(r,o);n.push(i)}}return e}const Wl=(t,e,r)=>{const n=I(),o=ve(),i=o(new n.gp_Sphere_1);i.SetRadius(1);const u=o(new n.Geom_SphericalSurface_2(i)),l=n.GeomConvert.SurfaceToBSplineSurface(u.UReversed()).get(),f=zl(l.Poles_2()),p=new Hl(t,e,r);f.forEach((y,m)=>{y.forEach((_,T)=>{const x=p.applyToPoint(_);l.SetPole_1(m+1,T+1,x)})});const d=ye(o(new n.BRepBuilderAPI_MakeShell_2(l.UReversed(),!1)).Shell());return Lo([d])},Gr=(t,e)=>{const r=I(),n=new r.BRepPrimAPI_MakeBox_4(Qe(t),Qe(e)),o=new Qt(n.Solid());return n.delete(),o},Tn=t=>{const e=I(),r=Qe(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new ns(o)},St=t=>{const e=I(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),ye(n)};function $l(t){const e=I(),r=ve(),n=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return t.forEach(({wrapped:o})=>{n.Add(o)}),n.Perform(r(new e.Message_ProgressRange_1)),ye(Jt(n.SewedShape()))}function Lo(t){const e=ve(),r=I(),n=$l(t),o=ye(e(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(o instanceof Qt))throw new Error("Could not make a solid of faces and shells");return o}const fs=(t,e)=>{const r=I(),[n,o]=Re(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(p=>{i.Add(p.wrapped)});const u=n(i.Face()),l=n(new r.ShapeFix_Face_2(u));l.FixOrientation_1();const f=l.Face();return o(),new gr(f)},Yl=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Xl=t=>{let e;t?Yl(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let u;typeof r=="number"?u=vr(1,r*rt):u=r;let l;return typeof i=="number"?l=vr(1,i*rt):l=i,{endTangent:u,startFactor:n,endFactor:o,startTangent:l}};function hs(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let u=Math.acos(o/i);return t*n-e*r<0&&(u=-u),u}function jl([t,e],[r,n],o,i,u,l,f){const p=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const d=Math.sin(u),y=Math.cos(u),m=(t-r)/2,_=(e-n)/2,T=(t+r)/2,x=(e+n)/2,C=y*m+d*_,A=y*_-d*m,M=C*C/(o*o)+A*A/(i*i);M>1&&(o=o*Math.sqrt(M),i=i*Math.sqrt(M));const F=o*i,X=o*A,$=i*C,ie=X*X+$*$;if(!ie)throw Error("start point can not be same as end point");let oe=Math.sqrt(Math.abs((F*F-ie)/ie));l==f&&(oe=-oe);const re=oe*X/i,he=-oe*$/o,Oe=y*re-d*he+T,Le=d*re+y*he+x,we=(C-re)/o,pe=(C+re)/o,J=(A-he)/i,be=(A+he)/i,Te=hs(1,0,we,J);let fe=hs(we,J,-pe,-be);for(;fe>p;)fe-=p;for(;fe<0;)fe+=p;f||(fe-=p);let me=Te+fe;for(;me>p;)me-=p;for(;me<0;)me+=p;return{cx:Oe,cy:Le,startAngle:Te,deltaAngle:fe,endAngle:me,clockwise:!!f,rx:o,ry:i}}const ps=(t,e)=>{const r=I(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new Qt(Jt(n.Shape()));return n.delete(),o},ds=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=I(),i=Dr(e,r),u=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*rt,!1),l=ye(u.Shape());if(i.delete(),u.delete(),!bt(l))throw new Error("Could not revolve to a 3d shape");return l};function Nr(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:u,support:l,forceProfileSpineOthogonality:f}={},p=!1){const d=I(),y=i==="round"?!0:!!f,m=new d.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const x={transformed:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];x&&m.SetTransitionMode(x)}l?m.SetMode_4(l):r&&m.SetMode_1(r),n&&m.SetMode_5(n.wrapped,!1,d.BRepFill_TypeOfContact.BRepFill_NoContact),o?m.SetLaw_1(t.wrapped,o,!!u,y):m.Add_1(t.wrapped,!!u,y);const _=new d.Message_ProgressRange_1;m.Build(_),p||m.MakeSolid();const T=ye(m.Shape());if(!bt(T))throw new Error("Could not sweep to a 3d shape");if(p){const x=ye(m.FirstShape()),C=ye(m.LastShape());if(!us(x))throw new Error("Could not sweep with one start wire");if(!us(C))throw new Error("Could not sweep with one end wire");return m.delete(),[T,x,C]}return m.delete(),_.delete(),T}const vs=(t,{profile:e,endFactor:r=1})=>{let n;const o=I();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function gs(t,e,r,n,o=!1){const i=new O(e),u=new O(r),l=ls(i,i.add(u)),f=Ir([l]),p=n?vs(u.Length,n):null;return o?Nr(t,f,{law:p},o):Nr(t,f,{law:p},o)}function ms(t,e,r,n,o,i=!1){const u=new O(r),l=new O(n),f=ls(u,u.add(l)),p=Ir([f]),d=360/e*l.Length,y=1,m=Gl(d,l.Length,y,r,n),_=o?vs(l.Length,o):null;return i?Nr(t,p,{auxiliarySpine:m,law:_},i):Nr(t,p,{auxiliarySpine:m,law:_},i)}const ql=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=I(),[u,l]=Re(),f=u(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&f.AddVertex(u(Tn(r)).wrapped),t.forEach(y=>f.AddWire(y.wrapped)),n&&f.AddVertex(u(Tn(n)).wrapped);const p=u(new i.Message_ProgressRange_1);f.Build(p);const d=ye(f.Shape());if(l(),!bt(d))throw new Error("Could not loft to a 3d shape");return d};class mr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new mr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new O(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new O(e)}face(){let e;return this.baseFace?e=Nl(this.baseFace,this.wire):e=_n(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=_n(this.wire),o=ds(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[u,l]=Re(),f=u(new O(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const y=gs(this.wire,i||this.defaultOrigin,f,n);return l(),this.delete(),y}if(o){const y=ms(this.wire,o,i||this.defaultOrigin,f,n);return l(),this.delete(),y}const p=_n(this.wire),d=ps(p,f);return l(),this.delete(),d}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),u=e(new Xe(n,i,o),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const f=Nr(u.wire,this.wire,l);return this.delete(),f}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=ql(o.map(u=>u.wire),r,n);return o.forEach(u=>u.delete()),i}}const Zl=t=>{const e=I(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new Br(r)};function Kl(t,e){const[r,n]=Re(),o=r(Rr(e.origin,e.zDir,e.xDir)),i=I(),u=t.map(l=>{const f=i.GeomLib.To3d(o,l.wrapped);return new Ut(new i.BRepBuilderAPI_MakeEdge_24(f).Edge())});return n(),u}const Ql=(t,e)=>{const[r,n]=Re(),o=I(),i=t.map(u=>{const l=r(new o.BRepBuilderAPI_MakeEdge_30(u.wrapped,e));return new Ut(l.Edge())});return n(),i},ys=(t,e)=>{const r=I();return t.map(o=>e?new Ee(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class Vr extends Ke{transformCurves(e){return ys(e,this.wrapped)}}const ws=(t,e,r=[0,0])=>{const n=I(),o=pr(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new Vr(i)},Jl=t=>{const e=I(),[r,n]=Re(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(Hi(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new Vr(i)},ec=(t,e=[0,0],r="center")=>{const n=I(),[o,i]=Re(),u=new n.gp_Trsf2d_1;r==="center"?u.SetMirror_1(o(Ve(t))):u.SetMirror_2(o(pr(e,t)));const l=new n.gp_GTrsf2d_2(u);return i(),new Vr(l)},tc=(t,e=[0,0])=>{const r=I(),[n,o]=Re(),i=new r.gp_Trsf2d_1;i.SetRotation(n(Ve(e)),t);const u=new r.gp_GTrsf2d_2(i);return o(),new Vr(u)},rc=(t,e=[0,0])=>{const r=I(),[n,o]=Re(),i=new r.gp_Trsf2d_1;i.SetScale(n(Ve(e)),t);const u=new r.gp_GTrsf2d_2(i);return o(),new Vr(u)};function nc(t,e,r="original"){const[n,o]=Re(),i=I();let u=n(i.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let f=null;const p=n(pr([0,0],[0,1])),d=n(pr([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const _=n(u.get().Cylinder());_.Direct()||(u=u.get().UReversed());const T=_.Radius();f=ws(1/T,[0,1]).wrapped}if(r==="bounds"){if(f=n(new i.gp_GTrsf2d_1),f.SetAffinity(p,l.uMax-l.uMin),l.uMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(new i.gp_XY_2(0,-l.uMin)),f.Multiply(T)}const _=n(new i.gp_GTrsf2d_1);if(_.SetAffinity(d,l.vMax-l.vMin),f.Multiply(_),l.vMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(n(new i.gp_XY_2(0,-l.vMin))),f.Multiply(T)}}const y=ys(t,f),m=Ql(y,u);return o(),m}function oc(t,e){const r=I(),o=ve()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),i=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&i.Reverse(),new Ee(new r.Handle_Geom2d_Curve_2(i))}const En=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},Uo=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${En(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class ee{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new ee(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=Zl(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=ws(e,r,n).transformCurves(this.curves);return new ee(o)}scale(e,r){const n=r||this.boundingBox.center,o=rc(e,n).transformCurves(this.curves);return new ee(o)}rotate(e,r){const n=tc(e*rt,r).transformCurves(this.curves);return new ee(n)}translate(e,r=0){const n=pn(e)?e:[e,r],o=Jl(n).transformCurves(this.curves);return new ee(o)}mirror(e,r=[0,0],n="center"){const o=ec(e,r,n).transformCurves(this.curves);return new ee(o)}sketchOnPlane(e,r){const n=e instanceof Xe?Bt(e):Bt(e,r),o=Kl(this.curves,n),i=Ir(o);return new mr(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=I(),o=nc(this.curves,e,r),i=Ir(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const u=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);u.FixEdgeCurves(),u.delete();const l=new mr(i);if(i.isClosed){const f=l.clone().face();l.defaultOrigin=f.pointOnSurface(.5,.5),l.defaultDirection=f.normalAt(),f.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const f=i.startPoint;l.defaultOrigin=f,l.defaultDirection=e.normalAt(f),l.baseFace=e}return l}toSVGPathD(){const e=ve(),r=this.clone().mirror([1,0],[0,0],"plane"),o=gn(r.curves).flatMap(l=>Rl(e(l.adaptor()),l.lastPoint)),[i,u]=r.curves[0].firstPoint;return`M ${nt(i)} ${nt(u)} ${o.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return En(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return Uo(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1,o=Ur(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,l.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return ze(this.firstPoint,this.lastPoint)}intersects(e){const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class ic{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?Po:ko;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=Ur(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*rt,o=vr(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*rt,[o,i]=vr(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=Lt(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(xo(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,u]=this.pointer;return this.threePointsArcTo([i+e,u+r],[i+n,u+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,u]=e,l=[(n+i)/2,(o+u)/2],f=[-(u-o),i-n],p=Math.sqrt(f[0]**2+f[1]**2),d=[l[0]+f[0]/p*r,l[1]+f[1]/p*r];return this.saveCurve(xo(this._convertToUV(this.pointer),this._convertToUV(d),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=ct(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(El(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,u=!1){let l=o,f=r,p=n;r<n&&(l=o+90,f=n,p=r);const d=l*rt,y=re=>ct(this._convertToUV(re)),m=y(vr(f,d)),_=y(vr(p,d+Math.PI/2)),T=Lt(this._convertToUV(bl([1,0],d))),[,x]=Sl(T),{cx:C,cy:A,startAngle:M,endAngle:F,clockwise:X,rx:$,ry:ie}=jl(this._convertToUV(this.pointer),this._convertToUV(e),m,_,x,i,u),oe=xl($,ie,X?M:F,X?F:M,[C,A],T);return X||oe.reverse(),this.saveCurve(oe),this.pointer=e,this}ellipse(e,r,n,o,i=0,u=!1,l=!1){const[f,p]=this.pointer;return this.ellipseTo([e+f,r+p],n,o,i,u,l)}halfEllipseTo(e,r,n=!1){const o=wl(e,this.pointer),i=ct(e,this.pointer);return this.ellipseTo(e,i/2,r,o*Ar,!0,n)}halfEllipse(e,r,n,o=!1){const[i,u]=this.pointer;return this.halfEllipseTo([i+e,u+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(Cl(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:u}=Xl(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,f=ct(this.pointer,e)*.25;let p;o?p=o:l?p=this._convertFromUV(l.tangentAt(1)):p=[1,0],p=Lt(p);const d=[this.pointer[0]+p[0]*i*f,this.pointer[1]+p[1]*i*f];let y;n==="symmetric"?y=[-p[0],-p[1]]:y=n,y=Lt(y);const m=[e[0]-y[0]*u*f,e[1]-y[1]*u*f];return this.cubicBezierCurveTo(e,d,m)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?Po:ko;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){ze(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(ze(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=pr(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new Ee(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class sc extends ic{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new ee(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const ac=t=>{const e=I(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,u)=>{i.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,u===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=ye(r.Shape());if(r.delete(),!(o instanceof gr))throw new Error("Failed to create a face");return o},uc=(t,e)=>{const r=I(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},bs=t=>{let e,r;try{e=_n(t[0]),r=t.slice(1)}catch{e=ac(t),r=t.slice(1).map(o=>uc(o,e))}return fs(e,r)},Ss=(t,e)=>{const r=[],n=[],o=[];t.forEach(f=>{const[p,d,y]=e(f);r.push(p),n.push(d),o.push(y)});const i=bs(n),u=bs(o);return Lo([i,...r,u])};class _s{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return St(e)}face(){const e=this.outerSketch.face();return fs(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const u=new O(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?Ss(this.sketches,p=>gs(p.wire,i||this.outerSketch.defaultOrigin,u,n,!0)):o?Ss(this.sketches,p=>ms(p.wire,o,i||this.outerSketch.defaultOrigin,u,n,!0)):ps(this.face(),u)}revolve(e,{origin:r}={}){return ds(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,u)=>{const l=e.sketches[u];return i.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),Lo(n)}}class ce{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new ce(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Br;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new ce(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new ce(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new ce(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new ce(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new ce(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new _s(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new _s(n)}toSVGViewBox(e=1){return En(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return Uo(this.toSVGGroup(),this.boundingBox,e)}}class Ts{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof mr?r.wire:r.wires);return St(e)}faces(){const e=this.sketches.map(r=>r.face());return St(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return St(n)}revolve(e,r){return St(this.sketches.map(n=>n.revolve(e,r)))}}class j{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new j(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Br;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new j(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new j(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new j(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new j(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new j(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new Ts(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new Ts(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return En(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof ee?n.toSVGPath():n.toSVGGroup());return Uo(r.join(`
    `),this.boundingBox,e)}}const lc=t=>{const e=t.map((o,i)=>t.slice(i+1).map((u,l)=>[l+i+1,u]).filter(([,u])=>!o.boundingBox.isOut(u.boundingBox)).map(([u])=>u)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let u=n[i];u||(u=[],r.push(u)),u.push(t[i]),o.length&&o.forEach(l=>{n[l]=u})}),r},Es=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((u,l)=>r===l?!1:u.isInside(o));return{blueprint:e,isIn:i}}),cc=(t,e)=>t.flatMap(({blueprint:r})=>Io(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),fc=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=Io(Es(t.map(({blueprint:o})=>o)));return[r,...n]},Io=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?cc(e,t):fc(r,t)},Hr=t=>{const e=lc(t).map(Es);return new j(e.flatMap(Io).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new ce(r.map(({blueprint:n})=>n)))))},hc=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let i=Math.min(n,t/2),u=Math.min(o,e/2);const l=i&&u;l||(i=0,u=0);const f=i===u,p=new sc([Math.min(0,-(t/2-i)),-e/2]),d=(y,m)=>{l&&(f?p.tangentArc(y,m):p.ellipse(y,m,i,u,0,!1,!0))};return i<t/2&&p.hLine(t-2*i),d(i,u),u<e/2&&p.vLine(e-2*u),d(-i,u),i<t/2&&p.hLine(-(t-2*i)),d(-i,-u),u<e/2&&p.vLine(-(e-2*u)),d(i,-u),p.close()},xn=1e-9,We=(t,e)=>ze(t,e,xn),zr=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},xs=(t,e)=>{const r=t.findIndex(i=>We(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},Cs=(t,e)=>{const r=u=>We(e.firstPoint,u.firstPoint)&&We(e.lastPoint,u.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=No(t),n=t.findIndex(r),n===-1))throw console.error(t.map(u=>u.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*ks(t,e,r){const n=u=>!!e.find(l=>We(l,u.lastPoint)),o=u=>!!r.find(l=>We(l.firstPoint,u.firstPoint)&&We(l.lastPoint,u.lastPoint)||We(l.firstPoint,u.lastPoint)&&We(l.lastPoint,u.firstPoint));let i=[];for(const u of t)n(u)?(i.push(u),yield i,i=[]):o(u)?(i.length&&(yield i,i=[]),yield[u]):i.push(u);i.length&&(yield i)}const pc=t=>t[0].firstPoint,Go=t=>t[t.length-1].lastPoint,No=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),dc=t=>(t.reverse(),t.map(No));function vc(t,e,r){return t.filter(n=>{const o=e.filter(l=>We(l.firstPoint,n)||We(l.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(l=>r.isInside(zr(l)));return!(i.every(l=>l)||!i.some(l=>l))})}function gc(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((m,_)=>{e.curves.forEach((T,x)=>{const{intersections:C,commonSegments:A,commonSegmentsPoints:M}=Lr(m,T,xn/100);r.push(...C),o[_].push(...C),i[x].push(...C),n.push(...A),r.push(...M),o[_].push(...M),i[x].push(...M)})}),r=Vi(r,xn),!r.length||r.length===1)return null;const u=([m,_])=>_.length?m.splitAt(_,xn/100):[m];let l=hr([t.curves,o]).flatMap(u),f=hr([e.curves,i]).flatMap(u);const p=n.map(m=>[m.firstPoint,m.lastPoint]);if(r=vc(r,l,e),!r.length&&!n.length)return null;if(n.length){const m=n[0];l=Cs(l,m),f=Cs(f,m)}else{const m=r[0];l=xs(l,m),f=xs(f,m)}const d=Array.from(ks(l,r,n));let y=Array.from(ks(f,r,n));return(!We(Go(y[0]),Go(d[0]))||n.length>0&&y[0].length!==1)&&(y=dc(y)),hr([d,y]).map(([m,_])=>{const T=pc(m),x=Go(m);return p.find(([C,A])=>We(C,T)&&We(A,x)||We(C,x)&&We(C,T))?[m,"same"]:[m,_]})}const mc=t=>{const e=t.map(u=>u.firstPoint);let r=t.map(u=>u.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=hr([e,r]).map(([u,l],f)=>We(u,l)?null:f).filter(u=>u!==null);if(!n.length)return[t];const o=hr([n.slice(0,-1),n.slice(1)]).map(([u,l])=>t.slice(u,l));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function Vo(t,e,{firstInside:r,secondInside:n}){const o=gc(t,e);if(!o){const p=zr(t.curves[0]),d=e.isInside(p),y=zr(e.curves[0]),m=t.isInside(y);return{identical:!1,firstCurveInSecond:d,secondCurveInFirst:m}}if(o.every(([,p])=>p==="same"))return{identical:!0};let i=null,u=null;const l=o.flatMap(([p,d])=>{let y=[],m=0;if(d==="same")return u===1?(u=1,[...p]):u===2||u===0?(u=null,[]):u===null?(i?i=[...i,...p]:i=p,[]):(console.error("weird situation"),[]);const _=zr(p[0]),T=e.isInside(_);(r==="keep"&&T||r==="remove"&&!T)&&(m+=1,y.push(...p));const x=zr(d[0]),C=t.isInside(x);if(n==="keep"&&C||n==="remove"&&!C){let A=d;m===1&&(A=No(d)),m+=1,y.push(...A)}return u===null&&m===1&&i&&(y=[...i,...y]),m===1&&(u=m,i=null),y}),f=mc(l).filter(p=>p.length).map(p=>new ee(p));return f.length===0?null:f.length===1?f[0]:Hr(f)}const Cn=(t,e)=>{const r=Vo(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof ee||r instanceof j?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new j([t,e])},Wr=(t,e)=>{const r=Vo(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof ee||r instanceof j?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new j([new ce([t,e])]):t.clone()},Ho=(t,e)=>{const r=Vo(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof ee||r instanceof j?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},zo=(t,e)=>{if(t instanceof ee&&e instanceof ee){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:u}=Lr(n,o);r.push(...i),r.push(...u)})}),r=Vi(r),r.length>1}if(t instanceof ce||t instanceof j)return t.blueprints.some(r=>zo(r,e));if(e instanceof ce||e instanceof j)return e.blueprints.some(r=>zo(t,r));throw new Error("Bug in the generic intersects algorithm")},yc=(t,e)=>{if(t instanceof ce){if(e instanceof ee)return kn(e,t);if(e instanceof ce)return Pn(t,e)}if(e instanceof ce){if(t instanceof ee)return kn(t,e);if(t instanceof ce)return Pn(t,e)}if(t instanceof ee&&e instanceof ee)return Cn(t,e);throw new Error("Bug in the generic fuse algorithm")},Ps=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((u,l)=>{const f=i.current,p=o+l+1;if(i.fusedWith.has(p))return;let d=u,y=!1;if(e.has(p)&&(d=e.get(p).current,y=!0),f.boundingBox.isOut(d.boundingBox)||!zo(f,d))return;let m;if(f instanceof j||d instanceof j?m=Tt(f,d):m=yc(f,d),!(m instanceof ee||m instanceof ce)){if(m instanceof j&&m.blueprints.length===2)return;if(m instanceof j&&m.blueprints.length===1)m=m.blueprints[0];else if(!(m instanceof j))throw console.error(m),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(p),i.current=m,y||e.set(p,i)})}),Hr(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>_t(n)))},_t=t=>t instanceof ee?[t]:t instanceof ce?t.blueprints:t instanceof j?t.blueprints.flatMap(e=>_t(e)):[],kn=(t,e)=>{const r=Cn(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>Wr(o,t));return Hr([..._t(r),...n.flatMap(o=>_t(o))])};function wc(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const Pn=(t,e)=>{const r=Cn(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(u=>Wr(u,t.blueprints[0])),o=t.blueprints.slice(1).map(u=>Wr(u,e.blueprints[0])),i=wc(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([u,l])=>_t(Ho(u,l)));return Hr([..._t(r),...n.flatMap(u=>_t(u)),...o.flatMap(u=>_t(u)),...i])},Tt=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof j)&&e instanceof j)return Ps([t,...e.blueprints]);if(!(e instanceof j)&&t instanceof j)return Ps([e,...t.blueprints]);if(t instanceof j&&e instanceof j){let r=Tt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=Tt(n,r)}),r}if(t instanceof ce){if(e instanceof j)return Tt(e,t);if(e instanceof ee)return kn(e,t);if(e instanceof ce)return Pn(t,e)}if(e instanceof ce){if(t instanceof j)return Tt(t,e);if(t instanceof ee)return kn(t,e);if(t instanceof ce)return Pn(t,e)}return t instanceof ee&&e instanceof ee?Cn(t,e):null},An=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof j?r.blueprints:r);return e.length===1?e[0]:new j(e)},It=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof j)return An(t.blueprints.map(n=>It(n,e)));if(t instanceof ce){const n=t.blueprints[0];if(e instanceof ee&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=Tt(e,new j(t.blueprints.slice(1)));return Hr([n,..._t(o)])}else{let o=It(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=It(o,i)}),o}}if(e instanceof j)return An(e.blueprints.map(n=>It(t,n)));if(e instanceof ce){let n=Wr(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=Tt(n,Ho(o,t))}),n}return Wr(t,e)};function $r(t,e){if(t===null||e===null)return null;if(t instanceof ee&&e instanceof ee)return Ho(t,e);if(t instanceof j)return An(t.blueprints.map(r=>$r(r,e)));if(t instanceof ce){const r=t.blueprints[0],n=t.blueprints[1];return It($r(r,e),n)}if(e instanceof j)return An(e.blueprints.map(r=>$r(t,r)));if(e instanceof ce){const r=e.blueprints[0],n=e.blueprints[1];return It($r(r,t),n)}throw new Error("intersct 2D algorithm error")}const As=(t,e={})=>{const r=e.plane instanceof Xe?Bt(e.plane):Bt(e.plane,e.origin),n=Ir([Il(t,r.origin,r.zDir)]),o=new mr(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var u=n.charCodeAt(i),l;return u>=55296&&u<=56319&&o>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(u-55296)*1024+l-56320+65536:u}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function Os(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var bc=new Os,Sc=new Os,Rs=new Uint8Array(30),Ds=new Uint16Array(30),_c=new Uint8Array(30),Tc=new Uint16Array(30);function Fs(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function Ec(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}Ec(bc,Sc),Fs(Rs,Ds,4,3),Fs(_c,Tc,2,1),Rs[28]=0,Ds[28]=258;function yr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function Gt(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Gt.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Gt.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},Gt.prototype.addX=function(t){this.addPoint(t,null)},Gt.prototype.addY=function(t){this.addPoint(null,t)},Gt.prototype.addBezier=function(t,e,r,n,o,i,u,l){var f=[t,e],p=[r,n],d=[o,i],y=[u,l];this.addPoint(t,e),this.addPoint(u,l);for(var m=0;m<=1;m++){var _=6*f[m]-12*p[m]+6*d[m],T=-3*f[m]+9*p[m]-9*d[m]+3*y[m],x=3*p[m]-3*f[m];if(T===0){if(_===0)continue;var C=-x/_;0<C&&C<1&&(m===0&&this.addX(yr(f[m],p[m],d[m],y[m],C)),m===1&&this.addY(yr(f[m],p[m],d[m],y[m],C)));continue}var A=Math.pow(_,2)-4*x*T;if(!(A<0)){var M=(-_+Math.sqrt(A))/(2*T);0<M&&M<1&&(m===0&&this.addX(yr(f[m],p[m],d[m],y[m],M)),m===1&&this.addY(yr(f[m],p[m],d[m],y[m],M)));var F=(-_-Math.sqrt(A))/(2*T);0<F&&F<1&&(m===0&&this.addX(yr(f[m],p[m],d[m],y[m],F)),m===1&&this.addY(yr(f[m],p[m],d[m],y[m],F)))}}},Gt.prototype.addQuad=function(t,e,r,n,o,i){var u=t+.6666666666666666*(r-t),l=e+2/3*(n-e),f=u+1/3*(o-t),p=l+1/3*(i-e);this.addBezier(t,e,u,l,f,p,o,i)};function Be(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Be.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},Be.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},Be.prototype.curveTo=Be.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})},Be.prototype.quadTo=Be.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})},Be.prototype.close=Be.prototype.closePath=function(){this.commands.push({type:"Z"})},Be.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof Gt){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)},Be.prototype.getBoundingBox=function(){for(var t=new Gt,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var u=this.commands[i];switch(u.type){case"M":t.addPoint(u.x,u.y),e=n=u.x,r=o=u.y;break;case"L":t.addPoint(u.x,u.y),n=u.x,o=u.y;break;case"Q":t.addQuad(n,o,u.x1,u.y1,u.x,u.y),n=u.x,o=u.y;break;case"C":t.addBezier(n,o,u.x1,u.y1,u.x2,u.y2,u.x,u.y),n=u.x,o=u.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+u.type)}}return t.isEmpty()&&t.addPoint(0,0),t},Be.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},Be.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(t)}function r(){for(var u=arguments,l="",f=0;f<arguments.length;f+=1){var p=u[f];p>=0&&f>0&&(l+=" "),l+=e(p)}return l}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n},Be.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Be.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function Ms(t){throw new Error(t)}function Bs(t,e){t||Ms(e)}var q={fail:Ms,argument:Bs,assert:Bs},Ls=32768,Us=2147483648,wr={},N={},Y={};function ot(t){return function(){return t}}N.BYTE=function(t){return q.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},Y.BYTE=ot(1),N.CHAR=function(t){return[t.charCodeAt(0)]},Y.CHAR=ot(1),N.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e},Y.CHARARRAY=function(t){return typeof t>"u"?0:t.length},N.USHORT=function(t){return[t>>8&255,t&255]},Y.USHORT=ot(2),N.SHORT=function(t){return t>=Ls&&(t=-(2*Ls-t)),[t>>8&255,t&255]},Y.SHORT=ot(2),N.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]},Y.UINT24=ot(3),N.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]},Y.ULONG=ot(4),N.LONG=function(t){return t>=Us&&(t=-(2*Us-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]},Y.LONG=ot(4),N.FIXED=N.ULONG,Y.FIXED=Y.ULONG,N.FWORD=N.SHORT,Y.FWORD=Y.SHORT,N.UFWORD=N.USHORT,Y.UFWORD=Y.USHORT,N.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]},Y.LONGDATETIME=ot(8),N.TAG=function(t){return q.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},Y.TAG=ot(4),N.Card8=N.BYTE,Y.Card8=Y.BYTE,N.Card16=N.USHORT,Y.Card16=Y.USHORT,N.OffSize=N.BYTE,Y.OffSize=Y.BYTE,N.SID=N.USHORT,Y.SID=Y.USHORT,N.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?N.NUMBER16(t):N.NUMBER32(t)},Y.NUMBER=function(t){return N.NUMBER(t).length},N.NUMBER16=function(t){return[28,t>>8&255,t&255]},Y.NUMBER16=ot(3),N.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]},Y.NUMBER32=ot(5),N.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,u=e.length;i<u;i+=1){var l=e[i];l==="e"?o+=e[++i]==="-"?"c":"b":l==="."?o+="a":l==="-"?o+="e":o+=l}o+=o.length&1?"f":"ff";for(var f=[30],p=0,d=o.length;p<d;p+=2)f.push(parseInt(o.substr(p,2),16));return f},Y.REAL=function(t){return N.REAL(t).length},N.NAME=N.CHARARRAY,Y.NAME=Y.CHARARRAY,N.STRING=N.CHARARRAY,Y.STRING=Y.CHARARRAY,wr.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)},wr.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)},N.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e},Y.UTF16=function(t){return t.length*2};var Wo={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};wr.MACSTRING=function(t,e,r,n){var o=Wo[n];if(o!==void 0){for(var i="",u=0;u<r;u++){var l=t.getUint8(e+u);l<=127?i+=String.fromCharCode(l):i+=o[l&127]}return i}};var On=typeof WeakMap=="function"&&new WeakMap,Rn,xc=function(t){if(!Rn){Rn={};for(var e in Wo)Rn[e]=new String(e)}var r=Rn[t];if(r!==void 0){if(On){var n=On.get(r);if(n!==void 0)return n}var o=Wo[t];if(o!==void 0){for(var i={},u=0;u<o.length;u++)i[o.charCodeAt(u)]=u+128;return On&&On.set(r,i),i}}};N.MACSTRING=function(t,e){var r=xc(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}},Y.MACSTRING=function(t,e){var r=N.MACSTRING(t,e);return r!==void 0?r.length:0};function $o(t){return t>=-128&&t<=127}function Cc(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function kc(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var u=t[i];if(!$o(u)||u===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var l=e;l<i;++l)r.push(t[l]+256&255);return i}function Pc(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var u=t[i];if(u===0||$o(u)&&i+1<o&&$o(t[i+1]))break;++i,++n}r.push(64|n-1);for(var l=e;l<i;++l){var f=t[l];r.push(f+65536>>8&255,f+256&255)}return i}N.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=Cc(t,e,r):n>=-128&&n<=127?e=kc(t,e,r):e=Pc(t,e,r)}return r},N.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=N.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var u=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,N.BYTE,N.USHORT,N.UINT24,N.ULONG][l],p=0;p<r.length;p+=1){var d=f(r[p]);Array.prototype.push.apply(u,d)}return Array.prototype.concat(N.Card16(t.length),N.OffSize(l),u,n)},Y.INDEX=function(t){return N.INDEX(t).length},N.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),u=t[i];e=e.concat(N.OPERAND(u.value,u.type)),e=e.concat(N.OPERATOR(i))}return e},Y.DICT=function(t){return N.DICT(t).length},N.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},N.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)q.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(N.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(N.NUMBER(t));else if(e==="offset")r=r.concat(N.NUMBER32(t));else if(e==="number")r=r.concat(N.NUMBER(t));else if(e==="real")r=r.concat(N.REAL(t));else throw new Error("Unknown operand type "+e);return r},N.OP=N.BYTE,Y.OP=Y.BYTE;var Dn=typeof WeakMap=="function"&&new WeakMap;N.CHARSTRING=function(t){if(Dn){var e=Dn.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(N[i.type](i.value))}return Dn&&Dn.set(t,r),r},Y.CHARSTRING=function(t){return N.CHARSTRING(t).length},N.OBJECT=function(t){var e=N[t.type];return q.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)},Y.OBJECT=function(t){var e=Y[t.type];return q.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)},N.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var u=t.fields[i],l=N[u.type];q.argument(l!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var f=t[u.name];f===void 0&&(f=u.value);var p=l(f);u.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(p)):e=e.concat(p)}for(var d=0;d<n.length;d+=1){var y=o[d],m=e.length;q.argument(m<65536,"Table "+t.tableName+" too big."),e[y]=m>>8,e[y+1]=m&255,e=e.concat(n[d])}return e},Y.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=Y[o.type];q.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var u=t[o.name];u===void 0&&(u=o.value),e+=i(u),o.type==="TABLE"&&(e+=2)}return e},N.RECORD=N.TABLE,Y.RECORD=Y.TABLE,N.LITERAL=function(t){return t},Y.LITERAL=function(t){return t.length};function Ie(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),u=0;u<i.length;u+=1){var l=i[u],f=r[l];this[l]!==void 0&&(this[l]=f)}}Ie.prototype.encode=function(){return N.TABLE(this)},Ie.prototype.sizeOf=function(){return Y.TABLE(this)};function Yr(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function Yo(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function Xr(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function Fn(t){t.format===1?Ie.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Yr("glyph",t.glyphs))):t.format===2?Ie.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Xr("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):q.assert(!1,"Coverage format must be 1 or 2.")}Fn.prototype=Object.create(Ie.prototype),Fn.prototype.constructor=Fn;function Mn(t){Ie.call(this,"scriptListTable",Xr("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return q.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Ie("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Ie("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Yr("featureIndex",o.featureIndexes)))}].concat(Xr("langSys",n.langSysRecords,function(i,u){var l=i.langSys;return[{name:"langSysTag"+u,type:"TAG",value:i.tag},{name:"langSys"+u,type:"TABLE",value:new Ie("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(Yr("featureIndex",l.featureIndexes)))}]})))}]}))}Mn.prototype=Object.create(Ie.prototype),Mn.prototype.constructor=Mn;function Bn(t){Ie.call(this,"featureListTable",Xr("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Ie("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Yr("lookupListIndex",n.lookupListIndexes)))}]}))}Bn.prototype=Object.create(Ie.prototype),Bn.prototype.constructor=Bn;function Ln(t,e){Ie.call(this,"lookupListTable",Yo("lookup",t,function(r){var n=e[r.lookupType];return q.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Ie("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Yo("subtable",r.subtables,n)))}))}Ln.prototype=Object.create(Ie.prototype),Ln.prototype.constructor=Ln;var H={Table:Ie,Record:Ie,Coverage:Fn,ScriptList:Mn,FeatureList:Bn,LookupList:Ln,ushortList:Yr,tableList:Yo,recordList:Xr};function Is(t,e){return t.getUint8(e)}function Un(t,e){return t.getUint16(e,!1)}function Ac(t,e){return t.getInt16(e,!1)}function Xo(t,e){return t.getUint32(e,!1)}function Gs(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function Oc(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function Rc(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Dc(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function Fc(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Mc={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function k(t,e){this.data=t,this.offset=e,this.relativeOffset=0}k.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},k.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},k.prototype.parseCard8=k.prototype.parseByte,k.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},k.prototype.parseCard16=k.prototype.parseUShort,k.prototype.parseSID=k.prototype.parseUShort,k.prototype.parseOffset16=k.prototype.parseUShort,k.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},k.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},k.prototype.parseULong=function(){var t=Xo(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},k.prototype.parseOffset32=k.prototype.parseULong,k.prototype.parseFixed=function(){var t=Gs(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},k.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n},k.prototype.parseTag=function(){return this.parseString(4)},k.prototype.parseLongDateTime=function(){var t=Xo(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},k.prototype.parseVersion=function(t){var e=Un(this.data,this.offset+this.relativeOffset),r=Un(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10},k.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Mc[t]*e},k.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e},k.prototype.parseOffset16List=k.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e},k.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e},k.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e},k.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},k.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},k.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},u=0;u<n.length;u++){var l=n[u],f=e[l];i[l]=f.call(this)}r[o]=i}return r},k.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},u=0;u<n.length;u++){var l=n[u],f=e[l];i[l]=f.call(this)}r[o]=i}return r},k.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r},k.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},k.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r},k.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new k(this.data,this.offset+e).parseStruct(t)},k.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new k(this.data,this.offset+e).parseStruct(t)},k.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var u=e[i];if(u===0){o[i]=void 0;continue}if(this.relativeOffset=u,t){for(var l=this.parseOffset16List(),f=new Array(l.length),p=0;p<l.length;p++)this.relativeOffset=u+l[p],f[p]=t.call(this);o[i]=f}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o},k.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},k.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:k.uShort,end:k.uShort,classId:k.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},k.list=function(t,e){return function(){return this.parseList(t,e)}},k.list32=function(t,e){return function(){return this.parseList32(t,e)}},k.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},k.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},k.pointer=function(t){return function(){return this.parsePointer(t)}},k.pointer32=function(t){return function(){return this.parsePointer32(t)}},k.tag=k.prototype.parseTag,k.byte=k.prototype.parseByte,k.uShort=k.offset16=k.prototype.parseUShort,k.uShortList=k.prototype.parseUShortList,k.uLong=k.offset32=k.prototype.parseULong,k.uLongList=k.prototype.parseULongList,k.struct=k.prototype.parseStruct,k.coverage=k.prototype.parseCoverage,k.classDef=k.prototype.parseClassDef;var Ns={reserved:k.uShort,reqFeatureIndex:k.uShort,featureIndexes:k.uShortList};k.prototype.parseScriptList=function(){return this.parsePointer(k.recordList({tag:k.tag,script:k.pointer({defaultLangSys:k.pointer(Ns),langSysRecords:k.recordList({tag:k.tag,langSys:k.pointer(Ns)})})}))||[]},k.prototype.parseFeatureList=function(){return this.parsePointer(k.recordList({tag:k.tag,feature:k.pointer({featureParams:k.offset16,lookupListIndexes:k.uShortList})}))||[]},k.prototype.parseLookupList=function(t){return this.parsePointer(k.list(k.pointer(function(){var e=this.parseUShort();q.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(k.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},k.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();q.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:k.offset32,featureTableSubstitutionOffset:k.offset32});return r})||[]};var Z={getByte:Is,getCard8:Is,getUShort:Un,getCard16:Un,getShort:Ac,getULong:Xo,getFixed:Gs,getTag:Oc,getOffset:Rc,getBytes:Dc,bytesToString:Fc,Parser:k};function Bc(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),u=e.parseULong(),l=o;l<=i;l+=1)t.glyphIndexMap[l]=u,u++}function Lc(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var u=new Z.Parser(r,n+o+14),l=new Z.Parser(r,n+o+16+i*2),f=new Z.Parser(r,n+o+16+i*4),p=new Z.Parser(r,n+o+16+i*6),d=n+o+16+i*8,y=0;y<i-1;y+=1)for(var m=void 0,_=u.parseUShort(),T=l.parseUShort(),x=f.parseShort(),C=p.parseUShort(),A=T;A<=_;A+=1)C!==0?(d=p.offset+p.relativeOffset-2,d+=C,d+=(A-T)*2,m=Z.getUShort(r,d),m!==0&&(m=m+x&65535)):m=A+x&65535,t.glyphIndexMap[A]=m}function Uc(t,e){var r={};r.version=Z.getUShort(t,e),q.argument(r.version===0,"cmap table version should be 0."),r.numTables=Z.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=Z.getUShort(t,e+4+o*8),u=Z.getUShort(t,e+4+o*8+2);if(i===3&&(u===0||u===1||u===10)||i===0&&(u===0||u===1||u===2||u===3||u===4)){n=Z.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new Z.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)Bc(r,l);else if(r.format===4)Lc(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function Ic(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Gc(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Nc(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new H.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var u=t.get(r),l=0;l<u.unicodes.length;l+=1)Ic(i,u.unicodes[l],r);i.segments=i.segments.sort(function(M,F){return M.start-F.start})}Gc(i);var f=i.segments.length,p=0,d=[],y=[],m=[],_=[],T=[],x=[];for(r=0;r<f;r+=1){var C=i.segments[r];C.end<=65535&&C.start<=65535?(d=d.concat({name:"end_"+r,type:"USHORT",value:C.end}),y=y.concat({name:"start_"+r,type:"USHORT",value:C.start}),m=m.concat({name:"idDelta_"+r,type:"SHORT",value:C.delta}),_=_.concat({name:"idRangeOffset_"+r,type:"USHORT",value:C.offset}),C.glyphId!==void 0&&(T=T.concat({name:"glyph_"+r,type:"USHORT",value:C.glyphId}))):p+=1,!e&&C.glyphIndex!==void 0&&(x=x.concat({name:"cmap12Start_"+r,type:"ULONG",value:C.start}),x=x.concat({name:"cmap12End_"+r,type:"ULONG",value:C.end}),x=x.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:C.glyphIndex}))}if(i.segCountX2=(f-p)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(f-p)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(d),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(y),i.fields=i.fields.concat(m),i.fields=i.fields.concat(_),i.fields=i.fields.concat(T),i.cmap4Length=14+d.length*2+2+y.length*2+m.length*2+_.length*2+T.length*2,!e){var A=16+x.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:A},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:x.length/3}]),i.fields=i.fields.concat(x)}return i}var Vc={parse:Uc,make:Nc},In=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Hc=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],zc=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Vs=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Hs(t){this.font=t}Hs.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function Gn(t,e){this.encoding=t,this.charset=e}Gn.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function Wc(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var er={line:Wc};function $c(t,e){var r=e||new Be;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function tt(t){this.bindConstructorValues(t)}tt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",$c(this,t.path))},tt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)},tt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},tt.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,u;n||(n={});var l=n.xScale,f=n.yScale;if(n.hinting&&o&&o.hinting&&(u=this.path&&o.hinting.exec(this,r)),u)i=o.hinting.getCommands(u),t=Math.round(t),e=Math.round(e),l=f=1;else{i=this.path.commands;var p=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=p),f===void 0&&(f=p)}for(var d=new Be,y=0;y<i.length;y+=1){var m=i[y];m.type==="M"?d.moveTo(t+m.x*l,e+-m.y*f):m.type==="L"?d.lineTo(t+m.x*l,e+-m.y*f):m.type==="Q"?d.quadraticCurveTo(t+m.x1*l,e+-m.y1*f,t+m.x*l,e+-m.y*f):m.type==="C"?d.curveTo(t+m.x1*l,e+-m.y1*f,t+m.x2*l,e+-m.y2*f,t+m.x*l,e+-m.y*f):m.type==="Z"&&d.closePath()}return d},tt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return q.argument(e.length===0,"There are still points left in the current contour."),t},tt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i},tt.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)},tt.prototype.drawPoints=function(t,e,r,n){function o(y,m,_,T){t.beginPath();for(var x=0;x<y.length;x+=1)t.moveTo(m+y[x].x*T,_+y[x].y*T),t.arc(m+y[x].x*T,_+y[x].y*T,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,u=[],l=[],f=this.path,p=0;p<f.commands.length;p+=1){var d=f.commands[p];d.x!==void 0&&u.push({x:d.x,y:-d.y}),d.x1!==void 0&&l.push({x:d.x1,y:-d.y1}),d.x2!==void 0&&l.push({x:d.x2,y:-d.y2})}t.fillStyle="blue",o(u,e,r,i),t.fillStyle="red",o(l,e,r,i)},tt.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",er.line(t,e,-1e4,e,1e4),er.line(t,-1e4,r,1e4,r);var i=this.xMin||0,u=this.yMin||0,l=this.xMax||0,f=this.yMax||0,p=this.advanceWidth||0;t.strokeStyle="blue",er.line(t,e+i*o,-1e4,e+i*o,1e4),er.line(t,e+l*o,-1e4,e+l*o,1e4),er.line(t,-1e4,r+-u*o,1e4,r+-u*o),er.line(t,-1e4,r+-f*o,1e4,r+-f*o),t.strokeStyle="green",er.line(t,e+p*o,-1e4,e+p*o,1e4)};function Nn(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function jo(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}jo.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},jo.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function Yc(t,e){return new tt({index:e,font:t})}function Xc(t,e,r,n,o,i){return function(){var u=new tt({index:e,font:t});return u.path=function(){r(u,n,o);var l=i(t.glyphs,u);return l.unitsPerEm=t.unitsPerEm,l},Nn(u,"xMin","_xMin"),Nn(u,"xMax","_xMax"),Nn(u,"yMin","_yMin"),Nn(u,"yMax","_yMax"),u}}function jc(t,e,r,n){return function(){var o=new tt({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var ft={GlyphSet:jo,glyphLoader:Yc,ttfGlyphLoader:Xc,cffGlyphLoader:jc};function zs(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!zs(t[r],e[r]))return!1;return!0}else return!1}function qo(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Nt(t,e,r){var n=[],o=[],i=Z.getCard16(t,e),u,l;if(i!==0){var f=Z.getByte(t,e+2);u=e+(i+1)*f+2;for(var p=e+3,d=0;d<i+1;d+=1)n.push(Z.getOffset(t,p,f)),p+=f;l=u+n[i]}else l=e+2;for(var y=0;y<n.length-1;y+=1){var m=Z.getBytes(t,u+n[y],u+n[y+1]);r&&(m=r(m)),o.push(m)}return{objects:o,startOffset:e,endOffset:l}}function qc(t,e){var r=[],n=Z.getCard16(t,e),o,i;if(n!==0){var u=Z.getByte(t,e+2);o=e+(n+1)*u+2;for(var l=e+3,f=0;f<n+1;f+=1)r.push(Z.getOffset(t,l,u)),l+=u;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function Zc(t,e,r,n,o){var i=Z.getCard16(r,n),u=0;if(i!==0){var l=Z.getByte(r,n+2);u=n+(i+1)*l+2}var f=Z.getBytes(r,u+e[t],u+e[t+1]);return o&&(f=o(f)),f}function Kc(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,u=o&15;if(i===r||(e+=n[i],u===r))break;e+=n[u]}return parseFloat(e)}function Qc(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return Kc(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function Jc(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Ws(t,e,r){e=e!==void 0?e:0;var n=new Z.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var u=n.parseByte();u<=21?(u===12&&(u=1200+n.parseByte()),o.push([u,i]),i=[]):i.push(Qc(n,u))}return Jc(o)}function jr(t,e){return e<=390?e=In[e]:e=t[e-391],e}function $s(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var u=e[i];if(Array.isArray(u.type)){var l=[];l.length=u.type.length;for(var f=0;f<u.type.length;f++)o=t[u.op]!==void 0?t[u.op][f]:void 0,o===void 0&&(o=u.value!==void 0&&u.value[f]!==void 0?u.value[f]:null),u.type[f]==="SID"&&(o=jr(r,o)),l[f]=o;n[u.name]=l}else o=t[u.op],o===void 0&&(o=u.value!==void 0?u.value:null),u.type==="SID"&&(o=jr(r,o)),n[u.name]=o}return n}function ef(t,e){var r={};return r.formatMajor=Z.getCard8(t,e),r.formatMinor=Z.getCard8(t,e+1),r.size=Z.getCard8(t,e+2),r.offsetSize=Z.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Ys=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Xs=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function tf(t,e){var r=Ws(t,0,t.byteLength);return $s(r,Ys,e)}function js(t,e,r,n){var o=Ws(t,e,r);return $s(o,Xs,n)}function qs(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var u=new DataView(new Uint8Array(r[i]).buffer),l=tf(u,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var f=l.private[0],p=l.private[1];if(f!==0&&p!==0){var d=js(t,p+e,f,n);if(l._defaultWidthX=d.defaultWidthX,l._nominalWidthX=d.nominalWidthX,d.subrs!==0){var y=p+d.subrs,m=Nt(t,y+e);l._subrs=m.objects,l._subrsBias=qo(l._subrs)}l._privateDict=d}o.push(l)}return o}function rf(t,e,r,n){var o,i,u=new Z.Parser(t,e);r-=1;var l=[".notdef"],f=u.parseCard8();if(f===0)for(var p=0;p<r;p+=1)o=u.parseSID(),l.push(jr(n,o));else if(f===1)for(;l.length<=r;){o=u.parseSID(),i=u.parseCard8();for(var d=0;d<=i;d+=1)l.push(jr(n,o)),o+=1}else if(f===2)for(;l.length<=r;){o=u.parseSID(),i=u.parseCard16();for(var y=0;y<=i;y+=1)l.push(jr(n,o)),o+=1}else throw new Error("Unknown charset format "+f);return l}function nf(t,e,r){var n,o={},i=new Z.Parser(t,e),u=i.parseCard8();if(u===0)for(var l=i.parseCard8(),f=0;f<l;f+=1)n=i.parseCard8(),o[n]=f;else if(u===1){var p=i.parseCard8();n=1;for(var d=0;d<p;d+=1)for(var y=i.parseCard8(),m=i.parseCard8(),_=y;_<=y+m;_+=1)o[_]=n,n+=1}else throw new Error("Unknown encoding format "+u);return new Gn(o,r)}function Zs(t,e,r){var n,o,i,u,l=new Be,f=[],p=0,d=!1,y=!1,m=0,_=0,T,x,C,A;if(t.isCIDFont){var M=t.tables.cff.topDict._fdSelect[e.index],F=t.tables.cff.topDict._fdArray[M];T=F._subrs,x=F._subrsBias,C=F._defaultWidthX,A=F._nominalWidthX}else T=t.tables.cff.topDict._subrs,x=t.tables.cff.topDict._subrsBias,C=t.tables.cff.topDict._defaultWidthX,A=t.tables.cff.topDict._nominalWidthX;var X=C;function $(re,he){y&&l.closePath(),l.moveTo(re,he),y=!0}function ie(){var re;re=f.length%2!==0,re&&!d&&(X=f.shift()+A),p+=f.length>>1,f.length=0,d=!0}function oe(re){for(var he,Oe,Le,we,pe,J,be,Te,fe,me,De,Ge,Se=0;Se<re.length;){var Ue=re[Se];switch(Se+=1,Ue){case 1:ie();break;case 3:ie();break;case 4:f.length>1&&!d&&(X=f.shift()+A,d=!0),_+=f.pop(),$(m,_);break;case 5:for(;f.length>0;)m+=f.shift(),_+=f.shift(),l.lineTo(m,_);break;case 6:for(;f.length>0&&(m+=f.shift(),l.lineTo(m,_),f.length!==0);)_+=f.shift(),l.lineTo(m,_);break;case 7:for(;f.length>0&&(_+=f.shift(),l.lineTo(m,_),f.length!==0);)m+=f.shift(),l.lineTo(m,_);break;case 8:for(;f.length>0;)n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+f.shift(),l.curveTo(n,o,i,u,m,_);break;case 10:pe=f.pop()+x,J=T[pe],J&&oe(J);break;case 11:return;case 12:switch(Ue=re[Se],Se+=1,Ue){case 35:n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),be=i+f.shift(),Te=u+f.shift(),fe=be+f.shift(),me=Te+f.shift(),De=fe+f.shift(),Ge=me+f.shift(),m=De+f.shift(),_=Ge+f.shift(),f.shift(),l.curveTo(n,o,i,u,be,Te),l.curveTo(fe,me,De,Ge,m,_);break;case 34:n=m+f.shift(),o=_,i=n+f.shift(),u=o+f.shift(),be=i+f.shift(),Te=u,fe=be+f.shift(),me=u,De=fe+f.shift(),Ge=_,m=De+f.shift(),l.curveTo(n,o,i,u,be,Te),l.curveTo(fe,me,De,Ge,m,_);break;case 36:n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),be=i+f.shift(),Te=u,fe=be+f.shift(),me=u,De=fe+f.shift(),Ge=me+f.shift(),m=De+f.shift(),l.curveTo(n,o,i,u,be,Te),l.curveTo(fe,me,De,Ge,m,_);break;case 37:n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),be=i+f.shift(),Te=u+f.shift(),fe=be+f.shift(),me=Te+f.shift(),De=fe+f.shift(),Ge=me+f.shift(),Math.abs(De-m)>Math.abs(Ge-_)?m=De+f.shift():_=Ge+f.shift(),l.curveTo(n,o,i,u,be,Te),l.curveTo(fe,me,De,Ge,m,_);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+Ue),f.length=0}break;case 14:f.length>0&&!d&&(X=f.shift()+A,d=!0),y&&(l.closePath(),y=!1);break;case 18:ie();break;case 19:case 20:ie(),Se+=p+7>>3;break;case 21:f.length>2&&!d&&(X=f.shift()+A,d=!0),_+=f.pop(),m+=f.pop(),$(m,_);break;case 22:f.length>1&&!d&&(X=f.shift()+A,d=!0),m+=f.pop(),$(m,_);break;case 23:ie();break;case 24:for(;f.length>2;)n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+f.shift(),l.curveTo(n,o,i,u,m,_);m+=f.shift(),_+=f.shift(),l.lineTo(m,_);break;case 25:for(;f.length>6;)m+=f.shift(),_+=f.shift(),l.lineTo(m,_);n=m+f.shift(),o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+f.shift(),l.curveTo(n,o,i,u,m,_);break;case 26:for(f.length%2&&(m+=f.shift());f.length>0;)n=m,o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i,_=u+f.shift(),l.curveTo(n,o,i,u,m,_);break;case 27:for(f.length%2&&(_+=f.shift());f.length>0;)n=m+f.shift(),o=_,i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u,l.curveTo(n,o,i,u,m,_);break;case 28:he=re[Se],Oe=re[Se+1],f.push((he<<24|Oe<<16)>>16),Se+=2;break;case 29:pe=f.pop()+t.gsubrsBias,J=t.gsubrs[pe],J&&oe(J);break;case 30:for(;f.length>0&&(n=m,o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,_),f.length!==0);)n=m+f.shift(),o=_,i=n+f.shift(),u=o+f.shift(),_=u+f.shift(),m=i+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,_);break;case 31:for(;f.length>0&&(n=m+f.shift(),o=_,i=n+f.shift(),u=o+f.shift(),_=u+f.shift(),m=i+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,_),f.length!==0);)n=m,o=_+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),_=u+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,_);break;default:Ue<32?console.log("Glyph "+e.index+": unknown operator "+Ue):Ue<247?f.push(Ue-139):Ue<251?(he=re[Se],Se+=1,f.push((Ue-247)*256+he+108)):Ue<255?(he=re[Se],Se+=1,f.push(-(Ue-251)*256-he-108)):(he=re[Se],Oe=re[Se+1],Le=re[Se+2],we=re[Se+3],Se+=4,f.push((he<<24|Oe<<16|Le<<8|we)/65536))}}}return oe(r),e.advanceWidth=X,l}function of(t,e,r,n){var o=[],i,u=new Z.Parser(t,e),l=u.parseCard8();if(l===0)for(var f=0;f<r;f++){if(i=u.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(l===3){var p=u.parseCard16(),d=u.parseCard16();if(d!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+d);for(var y,m=0;m<p;m++){if(i=u.parseCard8(),y=u.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(y>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+y);for(;d<y;d++)o.push(i);d=y}if(y!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+y)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return o}function sf(t,e,r,n){r.tables.cff={};var o=ef(t,e),i=Nt(t,o.endOffset,Z.bytesToString),u=Nt(t,i.endOffset),l=Nt(t,u.endOffset,Z.bytesToString),f=Nt(t,l.endOffset);r.gsubrs=f.objects,r.gsubrsBias=qo(r.gsubrs);var p=qs(t,e,u.objects,l.objects);if(p.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+p.length);var d=p[0];if(r.tables.cff.topDict=d,d._privateDict&&(r.defaultWidthX=d._privateDict.defaultWidthX,r.nominalWidthX=d._privateDict.nominalWidthX),d.ros[0]!==void 0&&d.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var y=d.fdArray,m=d.fdSelect;if(y===0||m===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");y+=e;var _=Nt(t,y),T=qs(t,e,_.objects,l.objects);d._fdArray=T,m+=e,d._fdSelect=of(t,m,r.numGlyphs,T.length)}var x=e+d.private[1],C=js(t,x,d.private[0],l.objects);if(r.defaultWidthX=C.defaultWidthX,r.nominalWidthX=C.nominalWidthX,C.subrs!==0){var A=x+C.subrs,M=Nt(t,A);r.subrs=M.objects,r.subrsBias=qo(r.subrs)}else r.subrs=[],r.subrsBias=0;var F;n.lowMemory?(F=qc(t,e+d.charStrings),r.nGlyphs=F.offsets.length):(F=Nt(t,e+d.charStrings),r.nGlyphs=F.objects.length);var X=rf(t,e+d.charset,r.nGlyphs,l.objects);if(d.encoding===0?r.cffEncoding=new Gn(Hc,X):d.encoding===1?r.cffEncoding=new Gn(zc,X):r.cffEncoding=nf(t,e+d.encoding,X),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new ft.GlyphSet(r),n.lowMemory)r._push=function(oe){var re=Zc(oe,F.offsets,t,e+d.charStrings);r.glyphs.push(oe,ft.cffGlyphLoader(r,oe,Zs,re))};else for(var $=0;$<r.nGlyphs;$+=1){var ie=F.objects[$];r.glyphs.push($,ft.cffGlyphLoader(r,$,Zs,ie))}}function Ks(t,e){var r,n=In.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+In.length:(r=In.length+e.length,e.push(t)),r}function af(){return new H.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function uf(t){var e=new H.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function Qs(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],u=e[i.name];u!==void 0&&!zs(u,i.value)&&(i.type==="SID"&&(u=Ks(u,r)),n[i.op]={name:i.name,type:i.type,value:u})}return n}function Js(t,e){var r=new H.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Qs(Ys,t,e),r}function ea(t){var e=new H.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function lf(t){var e=new H.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function cf(){return new H.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function ff(t,e){for(var r=new H.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=Ks(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function hf(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var u=void 0,l=void 0,f=r.commands[i];if(f.type==="Q"){var p=.3333333333333333,d=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(p*n+d*f.x1),y1:Math.round(p*o+d*f.y1),x2:Math.round(p*f.x+d*f.x1),y2:Math.round(p*f.y+d*f.y1)}}if(f.type==="M")u=Math.round(f.x-n),l=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="L")u=Math.round(f.x-n),l=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="C"){var y=Math.round(f.x1-n),m=Math.round(f.y1-o),_=Math.round(f.x2-f.x1),T=Math.round(f.y2-f.y1);u=Math.round(f.x-f.x2),l=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:y}),e.push({name:"dy1",type:"NUMBER",value:m}),e.push({name:"dx2",type:"NUMBER",value:_}),e.push({name:"dy2",type:"NUMBER",value:T}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(f.x),o=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function pf(t){for(var e=new H.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=hf(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function df(t,e){var r=new H.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Qs(Xs,t,e),r}function vf(t,e){for(var r=new H.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},u=[],l,f=1;f<t.length;f+=1)l=t.get(f),u.push(l.name);var p=[];r.header=af(),r.nameIndex=uf([e.postScriptName]);var d=Js(o,p);r.topDictIndex=ea(d),r.globalSubrIndex=cf(),r.charsets=ff(u,p),r.charStringsIndex=pf(t),r.privateDict=df(i,p),r.stringIndex=lf(p);var y=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=y,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),d=Js(o,p),r.topDictIndex=ea(d),r}var gf={parse:sf,make:vf};function mf(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),q.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function yf(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new H.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var wf={parse:mf,make:yf};function bf(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function Sf(t){return new H.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var _f={parse:bf,make:Sf};function Tf(t,e,r,n,o){for(var i,u,l=new Z.Parser(t,e),f=0;f<n;f+=1){f<r&&(i=l.parseUShort(),u=l.parseShort());var p=o.get(f);p.advanceWidth=i,p.leftSideBearing=u}}function Ef(t,e,r,n,o){t._hmtxTableData={};for(var i,u,l=new Z.Parser(e,r),f=0;f<o;f+=1)f<n&&(i=l.parseUShort(),u=l.parseShort()),t._hmtxTableData[f]={advanceWidth:i,leftSideBearing:u}}function xf(t,e,r,n,o,i,u){u.lowMemory?Ef(t,e,r,n,o):Tf(e,r,n,o,i)}function Cf(t){for(var e=new H.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var kf={parse:xf,make:Cf};function Pf(t){for(var e=new H.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function Af(t,e){var r=new Z.Parser(t,e),n=r.parseULong();q.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],u=0;u<o;u++){for(var l="",f=e+r.parseUShort(),p=r.parseUShort(),d=f;d<f+p;++d)l+=String.fromCharCode(t.getInt8(d));i.push(l)}return i}var Of={make:Pf,parse:Af};function Rf(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function Df(t){return new H.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Ff={parse:Rf,make:Df},ta=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],ra={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Mf={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},na={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Bf(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return ra[e];case 3:return na[e]}}var Zo="utf-16",Lf={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Uf={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function oa(t,e,r){switch(t){case 0:return Zo;case 1:return Uf[r]||Lf[e];case 3:if(e===1||e===10)return Zo;break}}function If(t,e,r){for(var n={},o=new Z.Parser(t,e),i=o.parseUShort(),u=o.parseUShort(),l=o.offset+o.parseUShort(),f=0;f<u;f++){var p=o.parseUShort(),d=o.parseUShort(),y=o.parseUShort(),m=o.parseUShort(),_=ta[m]||m,T=o.parseUShort(),x=o.parseUShort(),C=Bf(p,y,r),A=oa(p,d,y);if(A!==void 0&&C!==void 0){var M=void 0;if(A===Zo?M=wr.UTF16(t,l+x,T):M=wr.MACSTRING(t,l+x,T,A),M){var F=n[_];F===void 0&&(F=n[_]={}),F[C]=M}}}return i===1&&o.parseUShort(),n}function Ko(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function ia(t,e,r,n,o,i){return new H.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function Gf(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function sa(t,e){var r=Gf(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function Nf(t,e){var r,n=[],o={},i=Ko(ta);for(var u in t){var l=i[u];if(l===void 0&&(l=u),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');o[r]=t[u],n.push(r)}for(var f=Ko(ra),p=Ko(na),d=[],y=[],m=0;m<n.length;m++){r=n[m];var _=o[r];for(var T in _){var x=_[T],C=1,A=f[T],M=Mf[A],F=oa(C,M,A),X=N.MACSTRING(x,F);X===void 0&&(C=0,A=e.indexOf(T),A<0&&(A=e.length,e.push(T)),M=4,X=N.UTF16(x));var $=sa(X,y);d.push(ia(C,M,A,r,X.length,$));var ie=p[T];if(ie!==void 0){var oe=N.UTF16(x),re=sa(oe,y);d.push(ia(3,1,ie,r,oe.length,re))}}}d.sort(function(Le,we){return Le.platformID-we.platformID||Le.encodingID-we.encodingID||Le.languageID-we.languageID||Le.nameID-we.nameID});for(var he=new H.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:d.length},{name:"stringOffset",type:"USHORT",value:6+d.length*12}]),Oe=0;Oe<d.length;Oe++)he.fields.push({name:"record_"+Oe,type:"RECORD",value:d[Oe]});return he.fields.push({name:"strings",type:"LITERAL",value:y}),he}var Vf={parse:If,make:Nf},Qo=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Hf(t){for(var e=0;e<Qo.length;e+=1){var r=Qo[e];if(t>=r.begin&&t<r.end)return e}return-1}function zf(t,e){var r={},n=new Z.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Wf(t){return new H.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var aa={parse:zf,make:Wf,unicodeRanges:Qo,getUnicodeRange:Hf};function $f(t,e){var r={},n=new Z.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Vs.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=Vs.length){var u=n.parseChar();r.names.push(n.parseString(u))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function Yf(){return new H.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Xf={parse:$f,make:Yf},it=new Array(9);it[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(k.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(k.coverage),substitute:this.parseOffset16List()};q.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},it[2]=function(){var e=this.parseUShort();return q.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),sequences:this.parseListOfLists()}},it[3]=function(){var e=this.parseUShort();return q.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),alternateSets:this.parseListOfLists()}},it[4]=function(){var e=this.parseUShort();return q.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var br={sequenceIndex:k.uShort,lookupListIndex:k.uShort};it[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(k.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(u,br)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(k.coverage),classDef:this.parsePointer(k.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(u,br)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,k.pointer(k.coverage)),lookupRecords:this.parseRecordList(o,br)}}q.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},it[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(k.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(br)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(k.coverage),backtrackClassDef:this.parsePointer(k.classDef),inputClassDef:this.parsePointer(k.classDef),lookaheadClassDef:this.parsePointer(k.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(br)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(k.pointer(k.coverage)),inputCoverage:this.parseList(k.pointer(k.coverage)),lookaheadCoverage:this.parseList(k.pointer(k.coverage)),lookupRecords:this.parseRecordList(br)};q.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},it[7]=function(){var e=this.parseUShort();q.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new k(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:it[r].call(n)}},it[8]=function(){var e=this.parseUShort();return q.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),backtrackCoverage:this.parseList(k.pointer(k.coverage)),lookaheadCoverage:this.parseList(k.pointer(k.coverage)),substitutes:this.parseUShortList()}};function jf(t,e){e=e||0;var r=new k(t,e),n=r.parseVersion(1);return q.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(it)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(it),variations:r.parseFeatureVariationsList()}}var Sr=new Array(9);Sr[1]=function(e){return e.substFormat===1?new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.ushortList("substitute",e.substitute)))},Sr[2]=function(e){return q.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("seqSet",e.sequences,function(r){return new H.Table("sequenceSetTable",H.ushortList("sequence",r))})))},Sr[3]=function(e){return q.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("altSet",e.alternateSets,function(r){return new H.Table("alternateSetTable",H.ushortList("alternate",r))})))},Sr[4]=function(e){return q.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("ligSet",e.ligatureSets,function(r){return new H.Table("ligatureSetTable",H.tableList("ligature",r,function(n){return new H.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(H.ushortList("component",n.components,n.components.length+1)))}))})))},Sr[6]=function(e){if(e.substFormat===1){var r=new H.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("chainRuleSet",e.chainRuleSets,function(i){return new H.Table("chainRuleSetTable",H.tableList("chainRule",i,function(u){var l=H.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(H.ushortList("inputGlyph",u.input,u.input.length+1)).concat(H.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(H.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(f,p){l=l.concat({name:"sequenceIndex"+p,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+p,type:"USHORT",value:f.lookupListIndex})}),new H.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)q.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,u){n.push({name:"backtrackCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,u){n.push({name:"inputCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,u){n.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,u){n=n.concat({name:"sequenceIndex"+u,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:i.lookupListIndex})});var o=new H.Table("chainContextTable",n);return o}q.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function qf(t){return new H.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new H.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new H.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new H.LookupList(t.lookups,Sr)}])}var Zf={parse:jf,make:qf};function Kf(t,e){var r=new Z.Parser(t,e),n=r.parseULong();q.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},u=0;u<o;u++){var l=r.parseTag(),f=r.parseULong(),p=r.parseULong(),d=wr.UTF8(t,e+f,p);i[l]=d}return i}function Qf(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new H.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var u=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+u}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var Jf={parse:Kf,make:Qf};function ua(t){return Math.log(t)/Math.log(2)|0}function Jo(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function la(t,e,r,n){return new H.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function ca(t){var e=new H.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,ua(e.numTables));e.searchRange=16*r,e.entrySelector=ua(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+la().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<t.length;u+=1){var l=t[u];q.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var f=l.sizeOf(),p=la(l.tableName,Jo(l.encode()),i,f);for(n.push({name:p.tag+" Table Record",type:"RECORD",value:p}),o.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=f,q.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(d,y){return d.value.tag>y.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function fa(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function eh(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function th(t){for(var e=[],r=[],n=[],o=[],i=[],u=[],l=[],f,p=0,d=0,y=0,m=0,_=0,T=0;T<t.glyphs.length;T+=1){var x=t.glyphs.get(T),C=x.unicode|0;if(isNaN(x.advanceWidth))throw new Error("Glyph "+x.name+" ("+T+"): advanceWidth is not a number.");(f>C||f===void 0)&&C>0&&(f=C),p<C&&(p=C);var A=aa.getUnicodeRange(C);if(A<32)d|=1<<A;else if(A<64)y|=1<<A-32;else if(A<96)m|=1<<A-64;else if(A<123)_|=1<<A-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(x.name!==".notdef"){var M=x.getMetrics();e.push(M.xMin),r.push(M.yMin),n.push(M.xMax),o.push(M.yMax),u.push(M.leftSideBearing),l.push(M.rightSideBearing),i.push(x.advanceWidth)}}var F={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:eh(i),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,l)};F.ascender=t.ascender,F.descender=t.descender;var X=wf.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:F.xMin,yMin:F.yMin,xMax:F.xMax,yMax:F.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),$=_f.make({ascender:F.ascender,descender:F.descender,advanceWidthMax:F.advanceWidthMax,minLeftSideBearing:F.minLeftSideBearing,minRightSideBearing:F.minRightSideBearing,xMaxExtent:F.maxLeftSideBearing+(F.xMax-F.xMin),numberOfHMetrics:t.glyphs.length}),ie=Ff.make(t.glyphs.length),oe=aa.make(Object.assign({xAvgCharWidth:Math.round(F.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:p,ulUnicodeRange1:d,ulUnicodeRange2:y,ulUnicodeRange3:m,ulUnicodeRange4:_,sTypoAscender:F.ascender,sTypoDescender:F.descender,sTypoLineGap:0,usWinAscent:F.yMax,usWinDescent:Math.abs(F.yMin),ulCodePageRange1:1,sxHeight:fa(t,"xyvw",{yMax:Math.round(F.ascender/2)}).yMax,sCapHeight:fa(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",F).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),re=kf.make(t.glyphs),he=Vc.make(t.glyphs),Oe=t.getEnglishName("fontFamily"),Le=t.getEnglishName("fontSubfamily"),we=Oe+" "+Le,pe=t.getEnglishName("postScriptName");pe||(pe=Oe.replace(/\s/g,"")+"-"+Le);var J={};for(var be in t.names)J[be]=t.names[be];J.uniqueID||(J.uniqueID={en:t.getEnglishName("manufacturer")+":"+we}),J.postScriptName||(J.postScriptName={en:pe}),J.preferredFamily||(J.preferredFamily=t.names.fontFamily),J.preferredSubfamily||(J.preferredSubfamily=t.names.fontSubfamily);var Te=[],fe=Vf.make(J,Te),me=Te.length>0?Of.make(Te):void 0,De=Xf.make(),Ge=gf.make(t.glyphs,{version:t.getEnglishName("version"),fullName:we,familyName:Oe,weightName:Le,postScriptName:pe,unitsPerEm:t.unitsPerEm,fontBBox:[0,F.yMin,F.ascender,F.advanceWidthMax]}),Se=t.metas&&Object.keys(t.metas).length>0?Jf.make(t.metas):void 0,Ue=[X,$,ie,oe,fe,he,De,Ge,re];me&&Ue.push(me),t.tables.gsub&&Ue.push(Zf.make(t.tables.gsub)),Se&&Ue.push(Se);for(var rn=ca(Ue),mi=rn.encode(),Jn=Jo(mi),nn=rn.fields,eo=!1,Pt=0;Pt<nn.length;Pt+=1)if(nn[Pt].name==="head table"){nn[Pt].value.checkSumAdjustment=2981146554-Jn,eo=!0;break}if(!eo)throw new Error("Could not find head table with checkSum to adjust.");return rn}var rh={make:ca,fontToTable:th,computeCheckSum:Jo};function ei(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function ha(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function pa(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var u=r.start;if(u===e)return r;u<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function qr(t,e){this.font=t,this.tableName=e}qr.prototype={searchTag:ei,binSearch:ha,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=ei(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=ei(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,u=o.featureIndexes,l=this.font.tables[this.tableName].features,f=0;f<u.length;f++)if(i=l[u[f]],i.tag===r)return i.feature;if(n){var p=l.length;return q.assert(p===0||r>=l[p-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(i),u.push(p),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),u=[];if(i){for(var l,f=i.lookupListIndexes,p=this.font.tables[this.tableName].lookups,d=0;d<f.length;d++)l=p[f[d]],l.lookupType===n&&u.push(l);if(u.length===0&&o){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var y=p.length;return p.push(l),f.push(y),[l]}}return u},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=pa(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=ha(t.glyphs,e);return r>=0?r:-1;case 2:var n=pa(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,u=o.end,l=i;l<=u;l++)e.push(l);return e}};function Zr(t){qr.call(this,t,"gpos")}Zr.prototype=qr.prototype,Zr.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},Zr.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var u=o[i],l=this.getCoverageIndex(u.coverage,e);if(!(l<0))switch(u.posFormat){case 1:for(var f=u.pairSets[l],p=0;p<f.length;p++){var d=f[p];if(d.secondGlyph===r)return d.value1&&d.value1.xAdvance||0}break;case 2:var y=this.getGlyphClass(u.classDef1,e),m=this.getGlyphClass(u.classDef2,r),_=u.classRecords[y][m];return _.value1&&_.value1.xAdvance||0}}return 0},Zr.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function Je(t){qr.call(this,t,"gsub")}function nh(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function ti(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}Je.prototype=qr.prototype,Je.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Je.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++){var f=u[l],p=this.expandCoverage(f.coverage),d=void 0;if(f.substFormat===1){var y=f.deltaGlyphId;for(d=0;d<p.length;d++){var m=p[d];n.push({sub:m,by:m+y})}}else{var _=f.substitute;for(d=0;d<p.length;d++)n.push({sub:p[d],by:_[d]})}}return n},Je.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++){var f=u[l],p=this.expandCoverage(f.coverage),d=void 0;for(d=0;d<p.length;d++){var y=p[d],m=f.sequences[d];n.push({sub:y,by:m})}}return n},Je.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++)for(var f=u[l],p=this.expandCoverage(f.coverage),d=f.alternateSets,y=0;y<p.length;y++)n.push({sub:p[y],by:d[y]});return n},Je.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++)for(var f=u[l],p=this.expandCoverage(f.coverage),d=f.ligatureSets,y=0;y<p.length;y++)for(var m=p[y],_=d[y],T=0;T<_.length;T++){var x=_[T];n.push({sub:[m].concat(x.components),by:x.ligGlyph})}return n},Je.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=ti(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});q.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.substitute.splice(l,0,0)),i.substitute[l]=e.by},Je.prototype.addMultiple=function(t,e,r,n){q.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=ti(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});q.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.sequences.splice(l,0,0)),i.sequences[l]=e.by},Je.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=ti(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});q.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by},Je.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),q.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var u=e.sub[0],l=e.sub.slice(1),f={ligGlyph:e.by,components:l},p=this.binSearch(i.coverage.glyphs,u);if(p>=0){for(var d=i.ligatureSets[p],y=0;y<d.length;y++)if(nh(d[y].components,l))return;d.push(f)}else p=-1-p,i.coverage.glyphs.splice(p,0,u),i.ligatureSets.splice(p,0,[f])},Je.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}},Je.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function oh(){return typeof window<"u"}function ih(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Kr(t,e){if(!t)throw e}function da(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),e&o||(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function va(t,e,r){var n=new Z.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var u=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)u.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var f=0;f<t.instructionLength;f+=1)t.instructions.push(n.parseByte());var p=u[u.length-1]+1;o=[];for(var d=0;d<p;d+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var y=n.parseByte(),m=0;m<y;m+=1)o.push(i),d+=1;if(q.argument(o.length===p,"Bad flags."),u.length>0){var _=[],T;if(p>0){for(var x=0;x<p;x+=1)i=o[x],T={},T.onCurve=!!(i&1),T.lastPointOfContour=u.indexOf(x)>=0,_.push(T);for(var C=0,A=0;A<p;A+=1)i=o[A],T=_[A],T.x=da(n,i,C,2,16),C=T.x;for(var M=0,F=0;F<p;F+=1)i=o[F],T=_[F],T.y=da(n,i,M,4,32),M=T.y}t.points=_}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var X=!0;X;){o=n.parseUShort();var $={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?($.dx=n.parseShort(),$.dy=n.parseShort()):$.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?($.dx=n.parseChar(),$.dy=n.parseChar()):$.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?$.xScale=$.yScale=n.parseF2Dot14():(o&64)>0?($.xScale=n.parseF2Dot14(),$.yScale=n.parseF2Dot14()):(o&128)>0&&($.xScale=n.parseF2Dot14(),$.scale01=n.parseF2Dot14(),$.scale10=n.parseF2Dot14(),$.yScale=n.parseF2Dot14()),t.components.push($),X=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var ie=0;ie<t.instructionLength;ie+=1)t.instructions.push(n.parseByte())}}}function ri(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function sh(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return q.argument(r.length===0,"There are still points left in the current contour."),e}function ga(t){var e=new Be;if(!t)return e;for(var r=sh(t),n=0;n<r.length;++n){var o=r[n],i=null,u=o[o.length-1],l=o[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var f={x:(u.x+l.x)*.5,y:(u.y+l.y)*.5};e.moveTo(f.x,f.y)}for(var p=0;p<o.length;++p)if(i=u,u=l,l=o[(p+1)%o.length],u.onCurve)e.lineTo(u.x,u.y);else{var d=l;i.onCurve||((u.x+i.x)*.5,(u.y+i.y)*.5),l.onCurve||(d={x:(u.x+l.x)*.5,y:(u.y+l.y)*.5}),e.quadraticCurveTo(u.x,u.y,d.x,d.y)}e.closePath()}return e}function ma(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=ri(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[n.matchedPoints[0]],l=o.points[n.matchedPoints[1]],f={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=ri([l],f)[0],f.dx=u.x-l.x,f.dy=u.y-l.y,i=ri(o.points,f)}e.points=e.points.concat(i)}}return ga(e.points)}function ah(t,e,r,n){for(var o=new ft.GlyphSet(n),i=0;i<r.length-1;i+=1){var u=r[i],l=r[i+1];u!==l?o.push(i,ft.ttfGlyphLoader(n,i,va,t,e+u,ma)):o.push(i,ft.glyphLoader(n,i))}return o}function uh(t,e,r,n){var o=new ft.GlyphSet(n);return n._push=function(i){var u=r[i],l=r[i+1];u!==l?o.push(i,ft.ttfGlyphLoader(n,i,va,t,e+u,ma)):o.push(i,ft.glyphLoader(n,i))},o}function lh(t,e,r,n,o){return o.lowMemory?uh(t,e,r,n):ah(t,e,r,n)}var ch={getPath:ga,parse:lh},ya,tr,wa,ni;function ba(t){this.font=t,this.getCommands=function(e){return ch.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function fh(t){return t}function Sa(t){return Math.sign(t)*Math.round(Math.abs(t))}function hh(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function ph(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function dh(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function vh(t){return Math.sign(t)*Math.floor(Math.abs(t))}var _a=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},ht={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,u,l,f,p,d;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,f=e.x-e.xo,p=r.x-r.xo,u=Math.abs(o),l=Math.abs(i),d=u+l,d===0){t.x=t.xo+(f+p)/2;return}t.x=t.xo+(f*l+p*u)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),l=Math.abs(i),d=u+l,d===0){ht.setRelative(t,t,(f+p)/2,n,!0);return}ht.setRelative(t,t,(f*l+p*u)/d,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y;t.x=l+(t.y-f)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},Et={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,u,l,f,p,d;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,f=e.y-e.yo,p=r.y-r.yo,u=Math.abs(o),l=Math.abs(i),d=u+l,d===0){t.y=t.yo+(f+p)/2;return}t.y=t.yo+(f*l+p*u)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),l=Math.abs(i),d=u+l,d===0){Et.setRelative(t,t,(f+p)/2,n,!0);return}Et.setRelative(t,t,(f*l+p*u)/d,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y;t.y=f+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(ht),Object.freeze(Et);function Qr(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}Qr.prototype.distance=function(t,e,r,n){return this.x*ht.distance(t,e,r,n)+this.y*Et.distance(t,e,r,n)},Qr.prototype.interpolate=function(t,e,r,n){var o,i,u,l,f,p,d;if(u=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),f=Math.abs(u),p=Math.abs(l),d=f+p,d===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*p+i*f)/d,n,!0)},Qr.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y,p=n.normalSlope,d=this.slope,y=t.x,m=t.y;t.x=(d*y-p*l+f-m)/(d-p),t.y=d*(t.x-y)+m},Qr.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function Jr(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?ht:t===0&&e===1?Et:new Qr(t,e)}function xt(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}xt.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},xt.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var en=Object.freeze(new xt(0,0)),gh={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Vt(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=ht,this.round=Sa}}ba.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){Vt.prototype=gh,o=this._fpgmState=new Vt("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{tr(o)}catch(p){console.log("Hinting error in FPGM:"+p),this._errorState=3;return}}Vt.prototype=o,n=this._prepState=new Vt("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var u=n.cvt=new Array(i.length),l=e/r.unitsPerEm,f=0;f<i.length;f++)u[f]=i[f]*l;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{tr(n)}catch(p){this._errorState<2&&console.log("Hinting error in PREP:"+p),this._errorState=2}}if(!(this._errorState>1))try{return wa(t,n)}catch(p){this._errorState<1&&(console.log("Hinting error:"+p),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},wa=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,u,l;if(Vt.prototype=e,!o)l=new Vt("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),ni(t,l,r,n),u=l.gZone;else{var f=e.font;u=[],i=[];for(var p=0;p<o.length;p++){var d=o[p],y=f.glyphs.get(d.glyphIndex);l=new Vt("glyf",y.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+p+"---"),l.step=-1),ni(y,l,r,n);for(var m=Math.round(d.dx*r),_=Math.round(d.dy*n),T=l.gZone,x=l.contours,C=0;C<T.length;C++){var A=T[C];A.xTouched=A.yTouched=!1,A.xo=A.x=A.x+m,A.yo=A.y=A.y+_}var M=u.length;u.push.apply(u,T);for(var F=0;F<x.length;F++)i.push(x[F]+M)}t.instructions&&!l.inhibitGridFit&&(l=new Vt("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=u,l.contours=i,u.push(new xt(0,0),new xt(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),tr(l),u.length-=2)}return u},ni=function(t,e,r,n){for(var o=t.points||[],i=o.length,u=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],f,p=0;p<i;p++)f=o[p],u[p]=new xt(f.x*r,f.y*n,f.lastPointOfContour,f.onCurve);for(var d,y,m=0;m<i;m++)f=u[m],d||(d=f,l.push(m)),f.lastPointOfContour?(f.nextPointOnContour=d,d.prevPointOnContour=f,d=void 0):(y=u[m+1],f.nextPointOnContour=y,y.prevPointOnContour=f);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var _=0;_<i;_++)console.log(_,u[_].x,u[_].y)}if(u.push(new xt(0,0),new xt(Math.round(t.advanceWidth*r),0)),tr(e),u.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var T=0;T<i;T++)console.log(T,u[T].x,u[T].y)}}},tr=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=ya[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function Vn(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new xt(0,0)}function Ta(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function Ea(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function xa(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function Ca(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function ka(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SPVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.pv=e.dpv=Jr(l,f)}function Pa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SFVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.fv=Jr(l,f)}function mh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=Jr(n,r)}function yh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=Jr(n,r)}function wh(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function bh(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Sh(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function _h(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),u=e.pop(),l=t.z0,f=t.z1,p=l[r],d=l[n],y=f[o],m=f[i],_=t.z2[u];exports.DEBUG&&console.log("ISECT[], ",r,n,o,i,u);var T=p.x,x=p.y,C=d.x,A=d.y,M=y.x,F=y.y,X=m.x,$=m.y,ie=(T-C)*(F-$)-(x-A)*(M-X),oe=T*A-x*C,re=M*$-F*X;_.x=(oe*(M-X)-re*(T-C))/ie,_.y=(oe*(F-$)-re*(x-A))/ie}function Th(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Eh(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function xh(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Ch(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||Vn(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function kh(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||Vn(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Ph(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||Vn(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Ah(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||Vn(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Oh(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Rh(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=Sa}function Dh(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=ph}function Fh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Mh(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),Ta(t,!1)}function Bh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Lh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function Uh(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function oi(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function Ih(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function Gh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function Nh(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function Vh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var u=0;u<n;u++)tr(t),exports.DEBUG&&console.log(++t.step,u+1<n?"next loopcall":"done loopcall",u);t.ip=o,t.prog=i}function Hh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],tr(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function zh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function Wh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function $h(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function Aa(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var u=i.distance(n,en);t&&(u=e.round(u)),o.setRelative(n,en,u,i),o.touch(n),e.rp0=e.rp1=r}function Oa(t,e){var r=e.z2,n=r.length-2,o,i,u;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)o=r[l],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(u=o.nextTouched(t),i===u&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,u,t)))}function Ra(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=e.loop,f=e.z2;l--;){var p=r.pop(),d=f[p],y=u.distance(o,o,!1,!0);i.setRelative(d,d,y,u),i.touch(d),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",p)}e.loop=1}function Da(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=r.pop(),f=e.z2[e.contours[l]],p=f;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var d=u.distance(o,o,!1,!0);do p!==o&&i.setRelative(p,p,d,u),p=p.nextPointOnContour;while(p!==f)}function Fa(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var f;switch(l){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var p,d=u.distance(o,o,!1,!0),y=f.length-2,m=0;m<y;m++)p=f[m],i.setRelative(p,p,d,u)}function Yh(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var u=e.pop(),l=i[u];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",u,o),n.setRelative(l,l,o),n.touch(l)}t.loop=1}function Xh(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],u=t.z1[n],l=t.fv,f=t.dpv,p=t.z2;o--;){var d=e.pop(),y=p[d];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",d,r,"<->",n),l.interpolate(y,i,u,f),l.touch(y)}t.loop=1}function Ma(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],u=e.z0[e.rp0],l=e.fv,f=e.pv;l.setRelative(i,u,n,f),l.touch(i),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function jh(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,u=t.pv,l=t.z1;o--;){var f=e.pop(),p=l[f];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",f),i.setRelative(p,n,0,u),i.touch(p)}t.loop=1}function qh(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=hh}function Ba(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],u=e.fv,l=e.pv,f=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",f,")",o);var p=l.distance(i,en);t&&(Math.abs(p-f)<e.cvCutIn&&(p=f),p=e.round(p)),u.setRelative(i,en,p,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),u.touch(i),e.rp0=e.rp1=o}function Zh(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function Kh(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var u=r[++e]<<8|r[++e];u&32768&&(u=-((u^65535)+1)),n.push(u)}t.ip=e}function Qh(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function Jh(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function ep(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function tp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function La(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,en,t,!1)*64)}function Ua(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],u=e.z0[o],l=e.dpv.distance(u,i,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",l),e.stack.push(Math.round(l*64))}function rp(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function np(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function op(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function ip(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function sp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function ap(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function up(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function lp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function cp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function fp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function hp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(Ta(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function pp(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function dp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function vp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function gp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function ii(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,u=e.ppem,l=e.deltaBase+(t-1)*16,f=e.deltaShift,p=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var d=0;d<n;d++){var y=r.pop(),m=r.pop(),_=l+((m&240)>>4);if(_===u){var T=(m&15)-8;T>=0&&T++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",y,"by",T*f);var x=p[y];o.setRelative(x,x,T*f,i)}}}function mp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function yp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function wp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function bp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function Sp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function _p(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function Tp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function Ep(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function xp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function Cp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Hn(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function kp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function si(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,u=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var f=r.pop(),p=r.pop(),d=i+((p&240)>>4);if(d===o){var y=(p&15)-8;y>=0&&y++;var m=y*u;exports.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",m),e.cvt[f]+=m}}}function Pp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=_a;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Ap(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=_a;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Op(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=fh}function Rp(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=dh}function Dp(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=vh}function Fp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function Ia(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.dpv=Jr(l,f)}function Mp(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Bp(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function Lp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function Up(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function Ip(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function Gp(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Ht(t,e){var r=e.stack,n=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function zt(t,e){var r=e.ip,n=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var u=n[++r]<<8|n[++r];u&32768&&(u=-((u^65535)+1)),o.push(u)}e.ip=r}function V(t,e,r,n,o,i){var u=i.stack,l=t&&u.pop(),f=u.pop(),p=i.rp0,d=i.z0[p],y=i.z1[f],m=i.minDis,_=i.fv,T=i.dpv,x,C,A,M;C=x=T.distance(y,d,!0,!0),A=C>=0?1:-1,C=Math.abs(C),t&&(M=i.cvt[l],n&&Math.abs(C-M)<i.cvCutIn&&(C=M)),r&&C<m&&(C=m),n&&(C=i.round(C)),_.setRelative(y,d,A*C,T),_.touch(y),exports.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?l+"("+i.cvt[l]+","+M+")":"",f,"(d =",x,"->",A*C,")"),i.rp1=i.rp0,i.rp2=f,e&&(i.rp0=f)}ya=[Ea.bind(void 0,Et),Ea.bind(void 0,ht),xa.bind(void 0,Et),xa.bind(void 0,ht),Ca.bind(void 0,Et),Ca.bind(void 0,ht),ka.bind(void 0,0),ka.bind(void 0,1),Pa.bind(void 0,0),Pa.bind(void 0,1),mh,yh,wh,bh,Sh,_h,Th,Eh,xh,Ch,kh,Ph,Ah,Oh,Rh,Dh,Fh,Mh,Bh,Lh,void 0,void 0,Uh,oi,Ih,Gh,Nh,zh,Wh,void 0,void 0,void 0,Vh,Hh,$h,void 0,Aa.bind(void 0,0),Aa.bind(void 0,1),Oa.bind(void 0,Et),Oa.bind(void 0,ht),Ra.bind(void 0,0),Ra.bind(void 0,1),Da.bind(void 0,0),Da.bind(void 0,1),Fa.bind(void 0,0),Fa.bind(void 0,1),Yh,Xh,Ma.bind(void 0,0),Ma.bind(void 0,1),jh,qh,Ba.bind(void 0,0),Ba.bind(void 0,1),Zh,Kh,Qh,Jh,ep,tp,La.bind(void 0,0),La.bind(void 0,1),void 0,Ua.bind(void 0,0),Ua.bind(void 0,1),rp,void 0,np,void 0,void 0,op,ip,sp,ap,up,lp,cp,fp,hp,pp,dp,vp,gp,ii.bind(void 0,1),mp,yp,wp,bp,Sp,_p,Tp,Ep,xp,Cp,Hn.bind(void 0,0),Hn.bind(void 0,1),Hn.bind(void 0,2),Hn.bind(void 0,3),void 0,void 0,void 0,void 0,kp,ii.bind(void 0,2),ii.bind(void 0,3),si.bind(void 0,1),si.bind(void 0,2),si.bind(void 0,3),Pp,Ap,void 0,void 0,Op,void 0,Rp,Dp,oi,oi,void 0,void 0,void 0,void 0,void 0,Fp,Ia.bind(void 0,0),Ia.bind(void 0,1),Mp,void 0,Bp,Lp,Up,Ip,Gp,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ht.bind(void 0,1),Ht.bind(void 0,2),Ht.bind(void 0,3),Ht.bind(void 0,4),Ht.bind(void 0,5),Ht.bind(void 0,6),Ht.bind(void 0,7),Ht.bind(void 0,8),zt.bind(void 0,1),zt.bind(void 0,2),zt.bind(void 0,3),zt.bind(void 0,4),zt.bind(void 0,5),zt.bind(void 0,6),zt.bind(void 0,7),zt.bind(void 0,8),V.bind(void 0,0,0,0,0,0),V.bind(void 0,0,0,0,0,1),V.bind(void 0,0,0,0,0,2),V.bind(void 0,0,0,0,0,3),V.bind(void 0,0,0,0,1,0),V.bind(void 0,0,0,0,1,1),V.bind(void 0,0,0,0,1,2),V.bind(void 0,0,0,0,1,3),V.bind(void 0,0,0,1,0,0),V.bind(void 0,0,0,1,0,1),V.bind(void 0,0,0,1,0,2),V.bind(void 0,0,0,1,0,3),V.bind(void 0,0,0,1,1,0),V.bind(void 0,0,0,1,1,1),V.bind(void 0,0,0,1,1,2),V.bind(void 0,0,0,1,1,3),V.bind(void 0,0,1,0,0,0),V.bind(void 0,0,1,0,0,1),V.bind(void 0,0,1,0,0,2),V.bind(void 0,0,1,0,0,3),V.bind(void 0,0,1,0,1,0),V.bind(void 0,0,1,0,1,1),V.bind(void 0,0,1,0,1,2),V.bind(void 0,0,1,0,1,3),V.bind(void 0,0,1,1,0,0),V.bind(void 0,0,1,1,0,1),V.bind(void 0,0,1,1,0,2),V.bind(void 0,0,1,1,0,3),V.bind(void 0,0,1,1,1,0),V.bind(void 0,0,1,1,1,1),V.bind(void 0,0,1,1,1,2),V.bind(void 0,0,1,1,1,3),V.bind(void 0,1,0,0,0,0),V.bind(void 0,1,0,0,0,1),V.bind(void 0,1,0,0,0,2),V.bind(void 0,1,0,0,0,3),V.bind(void 0,1,0,0,1,0),V.bind(void 0,1,0,0,1,1),V.bind(void 0,1,0,0,1,2),V.bind(void 0,1,0,0,1,3),V.bind(void 0,1,0,1,0,0),V.bind(void 0,1,0,1,0,1),V.bind(void 0,1,0,1,0,2),V.bind(void 0,1,0,1,0,3),V.bind(void 0,1,0,1,1,0),V.bind(void 0,1,0,1,1,1),V.bind(void 0,1,0,1,1,2),V.bind(void 0,1,0,1,1,3),V.bind(void 0,1,1,0,0,0),V.bind(void 0,1,1,0,0,1),V.bind(void 0,1,1,0,0,2),V.bind(void 0,1,1,0,0,3),V.bind(void 0,1,1,0,1,0),V.bind(void 0,1,1,0,1,1),V.bind(void 0,1,1,0,1,2),V.bind(void 0,1,1,0,1,3),V.bind(void 0,1,1,1,0,0),V.bind(void 0,1,1,1,0,1),V.bind(void 0,1,1,1,0,2),V.bind(void 0,1,1,1,0,3),V.bind(void 0,1,1,1,1,0),V.bind(void 0,1,1,1,1,1),V.bind(void 0,1,1,1,1,2),V.bind(void 0,1,1,1,1,3)];function _r(t){this.char=t,this.state={},this.activeState=null}function ai(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function Np(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function st(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function zn(t){this.eventId=t,this.subscribers=[]}function Vp(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new zn(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function ke(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Vp.call(this,t)}_r.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},_r.prototype.getState=function(t){return this.state[t]||null},ke.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},ke.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])},ke.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(u){return u instanceof _r});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},ke.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof _r){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},ke.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n},ke.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}},ke.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof _r});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},ke.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],u=e===null||e.apply(this,i)===!0,l=[n,o];if(u){var f=r.apply(this,l);n.setState(t,f)}}),this.registeredModifiers.push(t)},zn.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},zn.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},st.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},st.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}},ke.prototype.rangeToText=function(t){if(t instanceof ai)return this.getRangeTokens(t).map(function(e){return e.char}).join("")},ke.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},ke.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null},ke.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null},ke.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof zn&&n.subscribers.forEach(function(o){o.apply(r,e||[])})},ke.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new Np(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},ke.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},ke.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},ke.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}},ke.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new st(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},ke.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new ai(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n},ke.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new ai(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),i&&n.checkEnd(t)){var u=r-i.startIndex+1,l=e.setEndOffset(u,o);e.dispatch("contextEnd",[o,l])}})},ke.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new st(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new _r(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function Wt(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Ga(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function $t(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Wn(t){return/[A-z]/.test(t)}function Hp(t){return/\s/.test(t)}function et(t){this.font=t,this.features={}}function rr(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function tn(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function zp(t,e){var r=tn(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function Wp(t,e){var r=tn(t,e.coverage);return r===-1?null:e.substitute[r]}function ui(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var u=tn(i,o);u!==-1&&r.push(u)}return r.length!==t.length?-1:r}function $p(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=ui(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&$t(i[0].char);)i.shift();var u=new st(i,0),l=ui(e.lookaheadCoverage,u),f=[].concat(t.backtrack);for(f.reverse();f.length&&$t(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var p=new st(f,0),d=ui(e.backtrackCoverage,p),y=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&d.length===e.backtrackCoverage.length,m=[];if(y)for(var _=0;_<e.lookupRecords.length;_++)for(var T=e.lookupRecords[_],x=T.lookupListIndex,C=this.getLookupByIndex(x),A=0;A<C.subtables.length;A++){var M=C.subtables[A],F=this.getLookupMethod(C,M),X=this.getSubstitutionType(C,M);if(X==="12")for(var $=0;$<n.length;$++){var ie=t.get($),oe=F(ie);oe&&m.push(oe)}}return m}function Yp(t,e){var r=t.current,n=tn(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],u=0;u<i.length;u++){o=i[u];for(var l=0;l<o.components.length;l++){var f=t.lookahead[l],p=o.components[l];if(f!==p)break;if(l===o.components.length-1)return o}}return null}function Xp(t,e){var r=tn(t,e.coverage);return r===-1?null:e.sequences[r]}et.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},et.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var u=0;u<i.length;u++){var l=i[u];if(l.tag===t){var f=l.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},et.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r},et.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},et.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n},et.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return zp.apply(r,[o,e])};case"12":return function(o){return Wp.apply(r,[o,e])};case"63":return function(o){return $p.apply(r,[o,e])};case"41":return function(o){return Yp.apply(r,[o,e])};case"21":return function(o){return Xp.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},et.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),u=0;u<o.length;u++)for(var l=o[u],f=this.getLookupSubtables(l),p=0;p<f.length;p++){var d=f[p],y=this.getSubstitutionType(l,d),m=this.getLookupMethod(l,d),_=void 0;switch(y){case"11":_=m(e.current),_&&i.splice(r,1,new rr({id:11,tag:t.tag,substitution:_}));break;case"12":_=m(e.current),_&&i.splice(r,1,new rr({id:12,tag:t.tag,substitution:_}));break;case"63":_=m(e),Array.isArray(_)&&_.length&&i.splice(r,1,new rr({id:63,tag:t.tag,substitution:_}));break;case"41":_=m(e),_&&i.splice(r,1,new rr({id:41,tag:t.tag,substitution:_}));break;case"21":_=m(e.current),_&&i.splice(r,1,new rr({id:21,tag:t.tag,substitution:_}));break}e=new st(i,r),!(Array.isArray(_)&&!_.length)&&(_=null)}return i.length?i:null},et.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r},et.prototype.getLookupSubtables=function(t){return t.subtables||null},et.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null},et.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},et.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function jp(t){var e=t.current,r=t.get(-1);return r===null&&Wt(e)||!Wt(r)&&Wt(e)}function qp(t){var e=t.get(1);return e===null||!Wt(e)}var Zp={startCheck:jp,endCheck:qp};function Kp(t){var e=t.current,r=t.get(-1);return(Wt(e)||$t(e))&&!Wt(r)}function Qp(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Wt(e)&&!$t(e)):var r=Hp(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return Wt(o)||$t(o)}),!n)return!0}break;default:return!1}}var Jp={startCheck:Kp,endCheck:Qp};function ed(t,e,r){e[r].setState(t.tag,t.substitution)}function td(t,e,r){e[r].setState(t.tag,t.substitution)}function rd(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function nd(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var Na={11:ed,12:td,63:rd,41:nd};function li(t,e,r){t instanceof rr&&Na[t.id]&&Na[t.id](t,e,r)}function od(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=Ga(n),i=$t(n);if(!o&&!i)return!0;if(o)return!1}return!1}function id(t){if(Ga(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=$t(r);if(!n)return!0}return!1}function sd(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new st(o.map(function(l){return l.getState("glyphIndex")}),0),u=new st(o.map(function(l){return l.char}),0);o.forEach(function(l,f){if(!$t(l.char)){i.setCurrentIndex(f),u.setCurrentIndex(f);var p=0;od(u)&&(p|=1),id(u)&&(p|=2);var d;switch(p){case 1:d="fina";break;case 2:d="init";break;case 3:d="medi";break}if(n.indexOf(d)!==-1){var y=e.query.lookupFeature({tag:d,script:r,contextParams:i});if(y instanceof Error)return console.info(y.message);y.forEach(function(m,_){m instanceof rr&&(li(m,o,_),i.context[_]=m.substitution)})}}})}}function Va(t,e){var r=t.map(function(n){return n.activeState.value});return new st(r,e||0)}function ad(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=Va(n);o.context.forEach(function(i,u){o.setCurrentIndex(u);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});l.length&&(l.forEach(function(f){return li(f,n,u)}),o=Va(n))})}function ud(t){var e=t.current,r=t.get(-1);return r===null&&Wn(e)||!Wn(r)&&Wn(e)}function ld(t){var e=t.get(1);return e===null||!Wn(e)}var cd={startCheck:ud,endCheck:ld};function Ha(t,e){var r=t.map(function(n){return n.activeState.value});return new st(r,e||0)}function fd(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=Ha(n);o.context.forEach(function(i,u){o.setCurrentIndex(u);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});l.length&&(l.forEach(function(f){return li(f,n,u)}),o=Ha(n))})}function at(t){this.baseDir=t||"ltr",this.tokenizer=new ke,this.featuresTags={}}at.prototype.setText=function(t){this.text=t},at.prototype.contextChecks={latinWordCheck:cd,arabicWordCheck:Zp,arabicSentenceCheck:Jp};function ci(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function hd(){return ci.call(this,"latinWord"),ci.call(this,"arabicWord"),ci.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function pd(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}at.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},at.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new et(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},at.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function fi(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function dd(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){fi.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){sd.call(t,n)})}}function vd(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){fi.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){ad.call(t,o)})}}}function gd(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){fi.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){fd.call(t,o)})}}}at.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},at.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(dd.call(this),vd.call(this)),this.checkContextReady("latinWord")&&gd.call(this),this.checkContextReady("arabicSentence")&&pd.call(this)},at.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),hd.call(this),this.applyFeaturesToContexts())},at.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},at.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function ge(t){t=t||{},t.tables=t.tables||{},t.empty||(Kr(t.familyName,"When creating a new Font object, familyName is required."),Kr(t.styleName,"When creating a new Font object, styleName is required."),Kr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Kr(t.ascender,"When creating a new Font object, ascender is required."),Kr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new ft.GlyphSet(this,t.glyphs||[]),this.encoding=new Hs(this),this.position=new Zr(this),this.substitution=new Je(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new ba(this)}})}ge.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null},ge.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},ge.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},ge.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})},ge.prototype.stringToGlyphs=function(t,e){var r=this,n=new at,o=function(y){return r.charToGlyphIndex(y.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var u=n.getTextGlyphs(t),l=u.length,f=new Array(l),p=this.glyphs.get(0),d=0;d<l;d+=1)f[d]=this.glyphs.get(u[d])||p;return f},ge.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},ge.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},ge.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},ge.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0},ge.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},ge.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var u=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,o),f;if(o.kerning){var p=o.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(p,o.language)}for(var d=0;d<l.length;d+=1){var y=l[d];if(i.call(this,y,e,r,n,o),y.advanceWidth&&(e+=y.advanceWidth*u),o.kerning&&d<l.length-1){var m=f?this.position.getKerningValue(f,y.index,l[d+1].index):this.getKerningValue(y,l[d+1]);e+=m*u}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e},ge.prototype.getPath=function(t,e,r,n,o){var i=new Be;return this.forEachGlyph(t,e,r,n,o,function(u,l,f,p){var d=u.getPath(l,f,p,o,this);i.extend(d)}),i},ge.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(u,l,f,p){var d=u.getPath(l,f,p,o,this);i.push(d)}),i},ge.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})},ge.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)},ge.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(u,l,f,p){u.drawPoints(t,l,f,p)})},ge.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(u,l,f,p){u.drawMetrics(t,l,f,p)})},ge.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},ge.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},ge.prototype.toTables=function(){return rh.fontToTable(this)},ge.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},ge.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r},ge.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(oh())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(i),u.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),u.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),p=ih(n);f.writeFileSync(t,p)}},ge.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},ge.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},ge.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Ct=new Array(10);Ct[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(k.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(k.coverage),values:this.parseValueRecordList()};q.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Ct[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();q.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(k.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(k.pointer(k.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var u=this.parsePointer(k.classDef),l=this.parsePointer(k.classDef),f=this.parseUShort(),p=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:u,classDef2:l,class1Count:f,class2Count:p,classRecords:this.parseList(f,k.list(p,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}},Ct[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Ct[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Ct[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Ct[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Ct[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Ct[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Ct[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);const md={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function yd(t){const{dir:e,xAxis:r}=md[t];return new Wa([0,0,0],e,r)}function za(t){const e=new O(t);let r=new O([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new O([0,1,0]),n=r.cross(e)),n.normalize()}class Wa extends Ke{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new O(n):za(r),i=Rr(e,r,o);super(i)}get position(){return new O(this.wrapped.Location())}get direction(){return new O(this.wrapped.Direction())}get xAxis(){return new O(this.wrapped.XDirection())}get yAxis(){return new O(this.wrapped.YDirection())}autoAxes(){const e=za(this.direction);this.wrapped.SetXDirection(yt(e))}setPosition(e){return this.wrapped.SetLocation(Qe(e)),this}setXAxis(e){return this.wrapped.SetYDirection(yt(e)),this}setYAxis(e){return this.wrapped.SetYDirection(yt(e)),this}lookAt(e){const r=new O("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const Tr=t=>t.IsNull()?[]:ye(t).edges;function wd(t,e,r=!0){const n=I(),o=ve(),i=o(new n.HLRBRep_Algo_1);i.Add_2(t.wrapped,0);const u=o(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(u),i.Update(),i.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),f=[...Tr(l.VCompound_1()),...Tr(l.Rg1LineVCompound_1()),...Tr(l.OutLineVCompound_1())];f.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped));const p=r?[...Tr(l.HCompound_1()),...Tr(l.Rg1LineHCompound_1()),...Tr(l.OutLineHCompound_1())]:[];return p.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped)),{visible:f,hidden:p}}const nr=1e-8,Er=(t,e)=>ze(t,e,nr*10);function bd(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(p=>({offset:Co(p,r),original:p})),o=[];let i=null,u=n.at(-1);if(!u)return[];if(o.length===1)return o;const l=p=>{i?p.offset instanceof Ee?o.push(p.offset):Er(p.offset.firstPoint,p.offset.lastPoint)||o.push(Ur(p.offset.firstPoint,p.offset.lastPoint)):i=p},f=function*(){for(const p of n.slice(0,-1))yield p;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const p of f()){const d=u.offset.lastPoint,y=p.offset.firstPoint;if(Er(d,y)){l(u),u=p;continue}let m=[];if(u.offset instanceof Ee&&p.offset instanceof Ee){const{intersections:T,commonSegmentsPoints:x}=Lr(u.offset,p.offset,nr/100);m=[...T,...x]}if(m.length>0){let T=m[0];if(m.length>1){const A=u==null?void 0:u.original.lastPoint,M=m.map(F=>gl(F,A));T=m[M.indexOf(Math.min(...M))]}const x=u.offset.splitAt([T],nr)[0],C=p.offset.splitAt([T],nr).at(-1);if(!C)throw new Error("Bug in the splitting algo in offset");l({offset:x,original:u.original}),u={offset:C,original:p.original};continue}const _=Yi(d,y,u.original.lastPoint);l(u),o.push(_),u=p}return l(u),o}function Sd(t,e){const r=bd(t,e);if(r.length<2)return null;const n=new Map,o=(p,d)=>{const y=n.get(p)||[];n.set(p,[...y,...d])};if(r.forEach((p,d)=>{r.slice(d+1).forEach((y,m)=>{const{intersections:_,commonSegmentsPoints:T}=Lr(p,y,nr),x=[..._,...T].filter(C=>{const A=Er(C,p.firstPoint)||Er(C,p.lastPoint),M=Er(C,y.firstPoint)||Er(C,y.lastPoint);return!(A&&M)});x.length&&(o(d,x),o(m+d+1,x))})}),!n.size){const p=new ee(r);return t.intersects(p)?null:p}const u=r.flatMap((p,d)=>{if(!n.has(d))return p;const y=n.get(d)||[];return p.splitAt(y,nr*100)}).filter(p=>!t.curves.find(y=>y.distanceFrom(p)<Math.abs(e)-nr));if(!u.length)return null;const f=Ki(u).filter(p=>p.length>1).map(p=>new ee(p)).filter(p=>p.isClosed());return f.length?f.length===1?f[0]:new j(f):null}const $a=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=Tt(e,t[r]);return e};function $n(t,e){if(t instanceof ee)return Sd(t,e);if(t instanceof j)return $a(t.blueprints.map(r=>$n(r,e)));if(t instanceof ce){const r=$a(t.blueprints.slice(1).map(n=>$n(n,e)));return It($n(t.blueprints[0],e),r)}return null}function Ya(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],u=(f,p)=>{o({firstCurve:f,secondCurve:p,point:f.lastPoint})?i.push(...t(f,p,r)):i.push(f,p)};e.curves.slice(1).forEach(f=>{const p=i.pop();if(!p)throw new Error("Bug in the blueprint filletting algo");u(p,f)});const l=i.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(ze(i[0].firstPoint,l.lastPoint)&&i.length>1){const f=i.pop(),p=i.shift();if(!f||!p)throw new Error("Bug in the blueprint filletting algo");u(f,p)}return new ee(i)}function hi(t,e,r,n){if(e instanceof ee)return Ya(t,e,r,n);if(e instanceof ce)return new ce(e.blueprints.map(o=>Ya(t,o,r,n)));if(e instanceof j){const o=e.blueprints.map(i=>hi(t,i,r,n)).filter(i=>i!==null);return new j(o)}return null}function _d(t,e,r){return hi(ko,t,e,r)}function Td(t,e,r){return hi(Po,t,e,r)}function pi(t,e){return t instanceof ee?new ee(gn(t.curves,e)):t instanceof ce?new ce(t.blueprints.map(r=>pi(r,e))):t instanceof j?new j(t.blueprints.map(r=>pi(r,e))):t}class xe{constructor(e=null){this.innerShape=e}clone(){var e;return new xe(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new Br}stretch(e,r,n){return this.innerShape?new xe(this.innerShape.stretch(e,r,n)):new xe}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new xe(this.innerShape.rotate(e,r)):new xe}translate(e,r=0){return this.innerShape?new xe(this.innerShape.translate(e,r)):new xe}scale(e,r){return this.innerShape?new xe(this.innerShape.scale(e,r)):new xe}mirror(e,r,n){return this.innerShape?new xe(this.innerShape.mirror(e,r,n)):new xe}cut(e){return new xe(It(this.innerShape,e.innerShape))}fuse(e){return new xe(Tt(this.innerShape,e.innerShape))}intersect(e){return new xe($r(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new wn);return new xe(_d(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new wn);return new xe(Td(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new xe($n(this.innerShape,e))}approximate(e,r={}){if(e!=="svg")throw new Error("Only 'svg' is supported for now");return new xe(pi(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof ee)){if(this.innerShape instanceof j&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof ee)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}function Ed(t,e,r=0){return new xe(hc(t,e,r))}const xd=Ed,Xa=t=>{const e=xd(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>oc(o,e)),n=Ki(r).map(o=>new ee(o));return n.length===0?new xe:n.length===1?new xe(n[0]):new xe(new j(n))};function kt(t,e="front"){let r;e instanceof Wa?r=e:r=yd(e);const{visible:n,hidden:o}=wd(t,r);return{visible:Xa(n),hidden:Xa(o)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ja=Symbol("Comlink.proxy"),Cd=Symbol("Comlink.endpoint"),kd=Symbol("Comlink.releaseProxy"),di=Symbol("Comlink.finalizer"),Yn=Symbol("Comlink.thrown"),qa=t=>typeof t=="object"&&t!==null||typeof t=="function",Pd={canHandle:t=>qa(t)&&t[ja],serialize(t){const{port1:e,port2:r}=new MessageChannel;return vi(t,e),[r,[r]]},deserialize(t){return t.start(),Dd(t)}},Ad={canHandle:t=>qa(t)&&Yn in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Za=new Map([["proxy",Pd],["throw",Ad]]);function Od(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function vi(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!Od(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:u,path:l}=Object.assign({path:[]},o.data),f=(o.data.argumentList||[]).map(or);let p;try{const d=l.slice(0,-1).reduce((m,_)=>m[_],t),y=l.reduce((m,_)=>m[_],t);switch(u){case"GET":p=y;break;case"SET":d[l.slice(-1)[0]]=or(o.data.value),p=!0;break;case"APPLY":p=y.apply(d,f);break;case"CONSTRUCT":{const m=new y(...f);p=Ud(m)}break;case"ENDPOINT":{const{port1:m,port2:_}=new MessageChannel;vi(t,_),p=Ld(m,[m])}break;case"RELEASE":p=void 0;break;default:return}}catch(d){p={value:d,[Yn]:0}}Promise.resolve(p).catch(d=>({value:d,[Yn]:0})).then(d=>{const[y,m]=Zn(d);e.postMessage(Object.assign(Object.assign({},y),{id:i}),m),u==="RELEASE"&&(e.removeEventListener("message",n),Ka(e),di in t&&typeof t[di]=="function"&&t[di]())}).catch(d=>{const[y,m]=Zn({value:new TypeError("Unserializable return value"),[Yn]:0});e.postMessage(Object.assign(Object.assign({},y),{id:i}),m)})}),e.start&&e.start()}function Rd(t){return t.constructor.name==="MessagePort"}function Ka(t){Rd(t)&&t.close()}function Dd(t,e){const r=new Map;return t.addEventListener("message",function(o){const{data:i}=o;if(!i||!i.id)return;const u=r.get(i.id);if(u)try{u(i)}finally{r.delete(i.id)}}),gi(t,r,[],e)}function Xn(t){if(t)throw new Error("Proxy has been released and is not useable")}function Qa(t){return xr(t,new Map,{type:"RELEASE"}).then(()=>{Ka(t)})}const jn=new WeakMap,qn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(jn.get(t)||0)-1;jn.set(t,e),e===0&&Qa(t)});function Fd(t,e){const r=(jn.get(e)||0)+1;jn.set(e,r),qn&&qn.register(t,e,t)}function Md(t){qn&&qn.unregister(t)}function gi(t,e,r=[],n=function(){}){let o=!1;const i=new Proxy(n,{get(u,l){if(Xn(o),l===kd)return()=>{Md(i),Qa(t),e.clear(),o=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const f=xr(t,e,{type:"GET",path:r.map(p=>p.toString())}).then(or);return f.then.bind(f)}return gi(t,e,[...r,l])},set(u,l,f){Xn(o);const[p,d]=Zn(f);return xr(t,e,{type:"SET",path:[...r,l].map(y=>y.toString()),value:p},d).then(or)},apply(u,l,f){Xn(o);const p=r[r.length-1];if(p===Cd)return xr(t,e,{type:"ENDPOINT"}).then(or);if(p==="bind")return gi(t,e,r.slice(0,-1));const[d,y]=Ja(f);return xr(t,e,{type:"APPLY",path:r.map(m=>m.toString()),argumentList:d},y).then(or)},construct(u,l){Xn(o);const[f,p]=Ja(l);return xr(t,e,{type:"CONSTRUCT",path:r.map(d=>d.toString()),argumentList:f},p).then(or)}});return Fd(i,t),i}function Bd(t){return Array.prototype.concat.apply([],t)}function Ja(t){const e=t.map(Zn);return[e.map(r=>r[0]),Bd(e.map(r=>r[1]))]}const eu=new WeakMap;function Ld(t,e){return eu.set(t,e),t}function Ud(t){return Object.assign(t,{[ja]:!0})}function Zn(t){for(const[e,r]of Za)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},eu.get(t)||[]]}function or(t){switch(t.type){case"HANDLER":return Za.get(t.name).deserialize(t.value);case"RAW":return t.value}}function xr(t,e,r,n){return new Promise(o=>{const i=Id();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function Id(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function ir(t=100,e=100,r=100){if(t===0&&e===0&&r===0)return Gr([0,0,0],[1e-7,1e-7,1e-7]);const n=t/2,o=e/2;return Gr([-n,-o,0],[n,o,r])}function Gd(t=50){return Vl(t)}function tu(t=50,e=100){return cs(t,e,[0,0,0],[0,0,-1])}function Nd(t=80,e=50,r=30){return Wl(t,e,r)}const ru=t=>t.boundingBox.center;function nu(t,e,r){return r.map(({position:n,direction:o,orientation:i})=>{const u=t(),l=e(u);let f=u.translate([n[0]-l[0],n[1]-l[1],n[2]-l[2]]);const p=[0,0,1],d=new O(i||o);if(d.Length>0){const y=new O(p).cross(d);if(y.Length>1e-10){const m=new O(p).getAngle(d);f=f.rotate(m,n,y)}else d.dot(new O(p))<0&&(f=f.rotate(180,n,[1,0,0]))}return f})}function ou(t,e,r,n,o,i=0,u=0,l=1){const f=new O([i,u,l]).normalized();return Array.from({length:e*r},(p,d)=>{const y=Math.floor(d/r),_=d%r*n,T=y*o,C=new Xe(new O(t.origin),new O(t.xDirection).normalized(),new O(t.normal).normalized()).toWorldCoords([_,T,0]);return{position:[C.x,C.y,C.z],direction:[t.normal[0],t.normal[1],t.normal[2]],orientation:[f.x,f.y,f.z]}})}function Vd(t,e,r,n=0,o=0,i=1){return ou({origin:t,xDirection:e,normal:(()=>{const u=new O(e),l=new O([0,0,1]),f=Math.abs(u.normalized().dot(l))>.99?new O([1,0,0]):u.cross(l).normalized();return[f.x,f.y,f.z]})()},1,r,r>1?new O(e).Length/(r-1):0,0,n,o,i)}function Hd(t=5,e=0,r=50,n=50,o=0,i=0,u=0,l=10,f=10,p=10,d=0,y=0,m=1){return St(nu(()=>ir(l,f,p),ru,Vd([o,i,u],[e,r,n],t,d,y,m)))}function zd(t=0,e=0,r=0,n=1,o=0,i=0,u=0,l=0,f=1,p=3,d=3,y=30,m=30,_=10,T=10,x=10,C=0,A=0,M=1){return St(nu(()=>ir(_,T,x),ru,ou({origin:[t,e,r],xDirection:[n,o,i],normal:[u,l,f]},p,d,y,m,C,A,M)))}function iu(t=100,e=50,r=50,n=5){const o=Gr([0,-t/2,0],[e,t/2,n]),i=Gr([0,-t/2,0],[n,t/2,r]);return o.fuse(i)}function su(t=50,e=25,r=100){return As(t,{plane:"XY",origin:[0,0,0]}).loftWith(As(e,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}function au(t=50,e=25,r=80,n=40){return su(t,e,r).fuse(cs(e,n,[0,0,-r],[0,0,-1]))}function uu(t,e){return{main:t,helperSpaces:e}}function Wd(t){return t.main||t}const Q={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},te={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function Kn(t){let e;switch(t){case Q.FRONT:e=new O([0,-1,0]);break;case Q.BACK:e=new O([0,1,0]);break;case Q.LEFT:e=new O([-1,0,0]);break;case Q.RIGHT:e=new O([1,0,0]);break;case Q.TOP:e=new O([0,0,1]);break;case Q.BOTTOM:e=new O([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return e}function lu(t,e){const[[r,n,o],[i,u,l]]=t.bounds;let f;switch(e){case te.FRONT_TOP:f=new O([r,n,l]);break;case te.FRONT_BOTTOM:f=new O([r,n,o]);break;case te.BACK_TOP:f=new O([r,u,l]);break;case te.BACK_BOTTOM:f=new O([r,u,o]);break;case te.LEFT_TOP:f=new O([r,n,l]);break;case te.LEFT_BOTTOM:f=new O([r,n,o]);break;case te.RIGHT_TOP:f=new O([i,n,l]);break;case te.RIGHT_BOTTOM:f=new O([i,n,o]);break;case te.FRONT_LEFT:f=new O([r,n,o]);break;case te.FRONT_RIGHT:f=new O([i,n,o]);break;case te.BACK_LEFT:f=new O([r,u,o]);break;case te.BACK_RIGHT:f=new O([i,u,o]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return f}function cu(t,e){const[[r,n,o],[i,u,l]]=t.bounds;let f;switch(e){case te.FRONT_TOP:f=new O([i,n,l]);break;case te.FRONT_BOTTOM:f=new O([i,n,o]);break;case te.BACK_TOP:f=new O([i,u,l]);break;case te.BACK_BOTTOM:f=new O([i,u,o]);break;case te.LEFT_TOP:f=new O([r,u,l]);break;case te.LEFT_BOTTOM:f=new O([r,u,o]);break;case te.RIGHT_TOP:f=new O([i,u,l]);break;case te.RIGHT_BOTTOM:f=new O([i,u,o]);break;case te.FRONT_LEFT:f=new O([r,n,l]);break;case te.FRONT_RIGHT:f=new O([i,n,l]);break;case te.BACK_LEFT:f=new O([r,u,l]);break;case te.BACK_RIGHT:f=new O([i,u,l]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return f}function $d(t){switch(t){case te.FRONT_LEFT:return[Q.FRONT,Q.LEFT];case te.FRONT_RIGHT:return[Q.FRONT,Q.RIGHT];case te.FRONT_TOP:return[Q.FRONT,Q.TOP];case te.FRONT_BOTTOM:return[Q.FRONT,Q.BOTTOM];case te.BACK_LEFT:return[Q.BACK,Q.LEFT];case te.BACK_RIGHT:return[Q.BACK,Q.RIGHT];case te.BACK_TOP:return[Q.BACK,Q.TOP];case te.BACK_BOTTOM:return[Q.BACK,Q.BOTTOM];case te.LEFT_TOP:return[Q.LEFT,Q.TOP];case te.LEFT_BOTTOM:return[Q.LEFT,Q.BOTTOM];case te.RIGHT_TOP:return[Q.RIGHT,Q.TOP];case te.RIGHT_BOTTOM:return[Q.RIGHT,Q.BOTTOM];default:throw new Error(`Unknown edge identifier: ${t}`)}}function Yd(t,e,r=.5,n=.5){const[[o,i,u],[l,f,p]]=t.bounds,d=Math.max(0,Math.min(1,r)),y=Math.max(0,Math.min(1,n));let m;switch(e){case Q.FRONT:m=new O([o+(l-o)*d,i,u+(p-u)*y]);break;case Q.BACK:m=new O([o+(l-o)*d,f,u+(p-u)*y]);break;case Q.LEFT:m=new O([o,i+(f-i)*d,u+(p-u)*y]);break;case Q.RIGHT:m=new O([l,i+(f-i)*d,u+(p-u)*y]);break;case Q.TOP:m=new O([o+(l-o)*d,i+(f-i)*y,p]);break;case Q.BOTTOM:m=new O([o+(l-o)*d,i+(f-i)*y,u]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return m}function Xd(t,e,r=.5){const n=Math.max(0,Math.min(1,r)),o=lu(t,e),i=cu(t,e);return new O([o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n,o.z+(i.z-o.z)*n])}function jd(t,e){const{type:r,element:n,params:o={}}=e;switch(r){case"face":return Yd(t,n,o.u,o.v);case"edge":return Xd(t,n,o.t);case"corner":if(n.includes("START")){const i=n.replace("_START","");return lu(t,i)}else if(n.includes("END")){const i=n.replace("_END","");return cu(t,i)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new O(t.center);default:throw new Error(`Unknown position type: ${r}`)}}function qd(t){const e=t.normalized(),r=Math.abs(e.x),n=Math.abs(e.y),o=Math.abs(e.z);let i;return r<=n&&r<=o?i=new O([0,e.z,-e.y]):n<=r&&n<=o?i=new O([e.z,0,-e.x]):i=new O([e.y,-e.x,0]),i.normalized()}function Qn(t,e,r,n={}){const o=jd(t.boundingBox,e);let i;n.normal?i=new O(n.normal):i=Zd(t,e,n);let u;n.xDir?u=new O(n.xDir):u=qd(i);const l=new Kt;l.coordSystemChange({origin:o.toTuple(),zDir:i.toTuple(),xDir:u.toTuple()},"reference");const f=ye(l.transform(r.wrapped));return l.delete(),i.delete(),u.delete(),o.delete(),f}function Zd(t,e,r={}){const{type:n,element:o}=e;switch(n){case"face":return Kn(o);case"edge":if(r.faceForEdge)return Kn(r.faceForEdge);{const i=$d(o);return Kn(i[0])}case"corner":return r.faceForCorner?Kn(r.faceForCorner):new O([0,0,1]);case"center":default:return new O([0,0,1])}}function sr(t,e,r,n=!1){return n?ye(t.wrapped).mirror(e,r):t.mirror(e,r)}function Kd(t=50,e=100,r=200,n=!0,o=0){const i=()=>{const we=ir(t-1,20,.5),pe=we.boundingBox.center,J=Qn(we,{type:"face",element:Q.TOP,params:{u:1.5/(t-1),v:2.25/20}},au(1.2,.8,.5*.8,.5*.2)),be=we.cut(J).cut(sr(J,"XZ",pe,!0)).cut(sr(J,"YZ",pe,!0)).cut(sr(sr(J,"XZ",pe,!0),"YZ",pe,!0)),Te=iu(20,4.5,4.5,.5),fe=Te.boundingBox.center,me=Qn(Te,{type:"face",element:Q.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},tu(.800001,.5)),De=Te.cut(me).cut(sr(me,"XZ",fe,!0)),Ge=Qn(be,{type:"edge",element:te.LEFT_BOTTOM,params:{t:.5}},De,{normal:[0,0,-1],xDir:[1,0,0]}),Se=sr(Ge,"YZ",pe,!0);return{cuboid:be,lProfile1:Ge,lProfile2:Se}},u=ir(t,e,r),l=Math.round(r/17.5)-1;if(l<=0){const we=ir(t,e,r);return uu(St([]),n?[we]:[])}const f=r/(l+1),p=l>1?(e-28)/(l-1):0,d=i(),y=d.cuboid.boundingBox.bounds[1][2]-d.cuboid.boundingBox.bounds[0][2],m=[];let _=0,T=-e/2+14,x=f-y;for(let we=0;we<l;we++){const pe=i(),J=o*15;m.push(pe.cuboid.clone().translate([_,T,x])),m.push(pe.lProfile1.clone().translate([_-J,T,x])),m.push(pe.lProfile2.clone().translate([_+J,T,x])),T+=p,x+=f}const C=ir(600,20,.5),A=p,M=f,F=Math.sqrt(A*A+M*M),X=F>.001?[0,A/F,M/F]:[1,0,0],ie=Qn(u,{type:"face",element:Q.RIGHT},C,{normal:[-1,0,0],xDir:X}).intersect(u),oe=u.boundingBox.center,re=sr(ie,"YZ",oe,!0),he=o*30,Oe=o*30;m.push(ie.translate([he,0,0])),m.push(re.translate([-Oe,0,0]));const Le=St(m);return uu(Le,n?[u]:[])}const fu={Cuboid:{params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],hasExplosion:!1},Sphere:{params:[{name:"radius",defaultValue:50}],hasExplosion:!1},Cylinder:{params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],hasExplosion:!1},Ellipsoid:{params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],hasExplosion:!1},DiagonalCuboidPattern:{params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],hasExplosion:!1},RectangularCuboidGrid:{params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],hasExplosion:!1},LProfile:{params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],hasExplosion:!1},Frustum:{params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],hasExplosion:!1},Drill:{params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],hasExplosion:!1},HelperCuboid:{params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],hasExplosion:!0}};function hu(t,e){return typeof t[e]!="number"||isNaN(t[e])?{valid:!1,message:`Parameter '${e}' must be a number`}:{valid:!0}}function Qd(t,e){return t[e]<=0?{valid:!1,message:`Parameter '${e}' must be positive`}:{valid:!0}}function Jd(t,e,r){const n=t[e];return n>=r?{valid:!1,message:`${e} (${n}) must be less than ${r}`}:{valid:!0}}function pt(t,...e){return r=>{for(const n of e){const o=t(r,n);if(!o.valid)return o}return{valid:!0}}}function pu(...t){return e=>{for(const r of t){const n=r(e);if(!n.valid)return n}return{valid:!0}}}const dt=(t,e)=>pu(r=>hu(r,e),r=>Qd(r,e))(t),du=(t,e,r)=>pu(n=>hu(n,e),n=>Jd(n,e,r))(t);function ev(t,e){let r=!0;const n=[];for(const o of e){const i=o(t);i.valid||(r=!1,n.push(i.message))}return{valid:r,errors:n}}function vt(t,e,r){const n=(...o)=>{const i=fu[r].params,u={};i.forEach((f,p)=>{u[f.name]=o[p]});const l=ev(u,e);return l.valid?t(...o):{validationErrors:l.errors}};return n.original=t,n}const gt={Cuboid:[pt(dt,"width","depth","height")],Sphere:[pt(dt,"radius")],Cylinder:[pt(dt,"radius","height")],Ellipsoid:[pt(dt,"aLength","bLength","cLength")],DiagonalCuboidPattern:[pt(dt,"count")],RectangularCuboidGrid:[pt(dt,"rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight")],LProfile:[pt(dt,"depth","flangeXLenght","flangeYLenght","thickness"),t=>du(t,"thickness",t.flange1Width),t=>du(t,"thickness",t.flange2Width)],Frustum:[pt(dt,"bottomRadius","topRadius","height")],Drill:[pt(dt,"bottomRadius","topRadius","frustumHeight","cylinderHeight")],HelperCuboid:[pt(dt,"width","depth","height")]},vu={Cuboid:vt(ir,gt.Cuboid,"Cuboid"),Sphere:vt(Gd,gt.Sphere,"Sphere"),Cylinder:vt(tu,gt.Cylinder,"Cylinder"),Ellipsoid:vt(Nd,gt.Ellipsoid,"Ellipsoid"),DiagonalCuboidPattern:vt(Hd,gt.DiagonalCuboidPattern,"DiagonalCuboidPattern"),RectangularCuboidGrid:vt(zd,gt.RectangularCuboidGrid,"RectangularCuboidGrid"),LProfile:vt(iu,gt.LProfile,"LProfile"),Frustum:vt(su,gt.Frustum,"Frustum"),HelperCuboid:vt(Kd,gt.HelperCuboid,"HelperCuboid"),Drill:vt(au,gt.Drill,"Drill")};function tv(t){const e=Wd(t),r=kt(e,"front"),n=kt(e,"top"),o=kt(e,"right");let i=[];return t&&t.main&&Array.isArray(t.helperSpaces)&&(i=[{name:"Main Component",views:{front:kt(t.main,"front"),top:kt(t.main,"top"),right:kt(t.main,"right")}}],t.helperSpaces.forEach((u,l)=>{i.push({name:`Helper Space ${l+1}`,views:{front:kt(u,"front"),top:kt(u,"top"),right:kt(u,"right")}})})),{standard:{frontView:r,topView:n,rightView:o},parts:i}}function rv(t){const e={};for(const[n,o]of Object.entries(t.standard))e[n]={visible:{paths:o.visible.toSVGPaths(),viewBox:o.visible.toSVGViewBox(2)},hidden:{paths:o.hidden.toSVGPaths(),viewBox:o.hidden.toSVGViewBox(2)},combinedViewBox:gu(o.visible.toSVGViewBox(2),o.hidden.toSVGViewBox(2))};const r=[];for(const n of t.parts){const o={};for(const[i,u]of Object.entries(n.views))o[i]={visible:{paths:u.visible.toSVGPaths(),viewBox:u.visible.toSVGViewBox(2)},hidden:{paths:u.hidden.toSVGPaths(),viewBox:u.hidden.toSVGViewBox(2)},combinedViewBox:gu(u.visible.toSVGViewBox(2),u.hidden.toSVGViewBox(2))};r.push({name:n.name,views:o})}return{standard:e,parts:r}}function gu(t,e){const r="0 0 100 100",n=d=>{if(!d)return null;const y=d.split(" ").map(parseFloat);return y.length!==4?null:{x:y[0],y:y[1],width:y[2],height:y[3]}},o=n(t)||n(r),i=n(e)||n(r);if(!o&&!i)return r;if(!o)return e||r;if(!i)return t||r;const u=Math.min(o.x,i.x),l=Math.min(o.y,i.y),f=Math.max(o.x+o.width,i.x+i.width),p=Math.max(o.y+o.height,i.y+i.height);return`${u} ${l} ${f-u} ${p-l}`}let mu=!1;const yu=(async()=>{if(mu)return Promise.resolve(!0);const t=await tl({locateFile:()=>rl});return mu=!0,nl(t),!0})();function wu(t,e){return fu[t].params.map(n=>n.name).map(n=>e[n])}function nv(t,e){return console.time(`[PERF] Total ${t} creation`),yu.then(()=>{const r=vu[t];console.time(`[PERF] ${t} model function`);const n=wu(t,e),o=r(...n);if(console.timeEnd(`[PERF] ${t} model function`),o&&o.validationErrors)return{error:!0,validationErrors:o.validationErrors};if(o&&o.main&&Array.isArray(o.helperSpaces)){const f=o.main,p=o.helperSpaces,d={tolerance:.1,angularTolerance:15};console.time(`[PERF] ${t} main model generation`);const y=f.mesh(d),m=f.meshEdges(d);console.timeEnd(`[PERF] ${t} main model generation`),console.time(`[PERF] ${t} helper spaces generation`);const _=p.map(T=>({faces:T.mesh(d),edges:T.meshEdges(d)}));return console.timeEnd(`[PERF] ${t} helper spaces generation`),console.timeEnd(`[PERF] Total ${t} creation`),{faces:y,edges:m,helperSpaces:_}}const i={tolerance:.1,angularTolerance:15};console.time(`[PERF] ${t} faces generation`);const u=o.mesh(i);console.timeEnd(`[PERF] ${t} faces generation`),u&&u.triangles&&console.log(`[INFO] ${t} triangles: ${u.triangles.length/3}, vertices: ${u.vertices.length/3}`),console.time(`[PERF] ${t} edges generation`);const l=o.meshEdges(i);return console.timeEnd(`[PERF] ${t} edges generation`),console.timeEnd(`[PERF] Total ${t} creation`),{faces:u,edges:l}})}function ov(t,e){return console.time(`[PERF] Total ${t} projections creation`),yu.then(()=>{const r=vu[t],n=wu(t,e),o=r(...n);if(o&&o.validationErrors)return{error:!0,validationErrors:o.validationErrors};console.time(`[PERF] ${t} projections generation`);const i=tv(o);console.timeEnd(`[PERF] ${t} projections generation`),console.time(`[PERF] ${t} projections processing`);const u=rv(i);return console.timeEnd(`[PERF] ${t} projections processing`),console.timeEnd(`[PERF] Total ${t} projections creation`),u})}vi({createMesh:nv,createProjections:ov})})();
