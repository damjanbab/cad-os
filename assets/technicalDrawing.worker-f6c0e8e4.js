var Xf=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var w0=Xf(R=>{var Yf=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(s,u){n=s,o=u});var i=Object.assign({},r),a="./this.program",l=(s,u)=>{throw u},c=typeof window=="object",h=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function v(s){return r.locateFile?r.locateFile(s,g):g+s}var w,E,T;function C(s){if(s instanceof ri)return;N("exiting due to exception: "+s)}var k,D,O;d?(h?g=require("path").dirname(g)+"/":g=__dirname+"/",O=()=>{D||(k=require("fs"),D=require("path"))},w=function(u,f){return O(),u=D.normalize(u),k.readFileSync(u,f?void 0:"utf8")},T=s=>{var u=w(s,!0);return u.buffer||(u=new Uint8Array(u)),u},E=(s,u,f)=>{O(),s=D.normalize(s),k.readFile(s,function(p,m){p?f(p):u(m.buffer)})},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof ri))throw s}),process.on("unhandledRejection",function(s){throw s}),l=(s,u)=>{if(Pr())throw process.exitCode=s,u;C(u),process.exit(s)},r.inspect=function(){return"[Emscripten Module object]"}):(c||h)&&(h?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",w=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.send(null),u.responseText},h&&(T=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),E=(s,u,f)=>{var p=new XMLHttpRequest;p.open("GET",s,!0),p.responseType="arraybuffer",p.onload=()=>{if(p.status==200||p.status==0&&p.response){u(p.response);return}f()},p.onerror=f,p.send(null)});var $=r.print||console.log.bind(console),N=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(a=r.thisProgram),r.quit&&(l=r.quit);var Z=4,Y;r.wasmBinary&&(Y=r.wasmBinary);var q=r.noExitRuntime||!0;typeof WebAssembly!="object"&&qt("no native wasm support detected");var re,he=!1;function de(s,u){s||qt(u)}var Ee=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Te(s,u,f){for(var p=u+f,m=u;s[m]&&!(m>=p);)++m;if(m-u>16&&s.buffer&&Ee)return Ee.decode(s.subarray(u,m));for(var b="";u<m;){var _=s[u++];if(!(_&128)){b+=String.fromCharCode(_);continue}var S=s[u++]&63;if((_&224)==192){b+=String.fromCharCode((_&31)<<6|S);continue}var x=s[u++]&63;if((_&240)==224?_=(_&15)<<12|S<<6|x:_=(_&7)<<18|S<<12|x<<6|s[u++]&63,_<65536)b+=String.fromCharCode(_);else{var A=_-65536;b+=String.fromCharCode(55296|A>>10,56320|A&1023)}}return b}function ne(s,u){return s?Te(Oe,s,u):""}function pe(s,u,f,p){if(!(p>0))return 0;for(var m=f,b=f+p-1,_=0;_<s.length;++_){var S=s.charCodeAt(_);if(S>=55296&&S<=57343){var x=s.charCodeAt(++_);S=65536+((S&1023)<<10)|x&1023}if(S<=127){if(f>=b)break;u[f++]=S}else if(S<=2047){if(f+1>=b)break;u[f++]=192|S>>6,u[f++]=128|S&63}else if(S<=65535){if(f+2>=b)break;u[f++]=224|S>>12,u[f++]=128|S>>6&63,u[f++]=128|S&63}else{if(f+3>=b)break;u[f++]=240|S>>18,u[f++]=128|S>>12&63,u[f++]=128|S>>6&63,u[f++]=128|S&63}}return u[f]=0,f-m}function me(s,u,f){return pe(s,Oe,u,f)}function J(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&(p=65536+((p&1023)<<10)|s.charCodeAt(++f)&1023),p<=127?++u:p<=2047?u+=2:p<=65535?u+=3:u+=4}return u}var Q=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ce(s,u){for(var f=s,p=f>>1,m=p+u/2;!(p>=m)&&ot[p];)++p;if(f=p<<1,f-s>32&&Q)return Q.decode(Oe.subarray(s,f));for(var b="",_=0;!(_>=u/2);++_){var S=Ae[s+_*2>>1];if(S==0)break;b+=String.fromCharCode(S)}return b}function ke(s,u,f){if(f===void 0&&(f=2147483647),f<2)return 0;f-=2;for(var p=u,m=f<s.length*2?f/2:s.length,b=0;b<m;++b){var _=s.charCodeAt(b);Ae[u>>1]=_,u+=2}return Ae[u>>1]=0,u-p}function ve(s){return s.length*2}function De(s,u){for(var f=0,p="";!(f>=u/4);){var m=B[s+f*4>>2];if(m==0)break;if(++f,m>=65536){var b=m-65536;p+=String.fromCharCode(55296|b>>10,56320|b&1023)}else p+=String.fromCharCode(m)}return p}function mt(s,u,f){if(f===void 0&&(f=2147483647),f<4)return 0;for(var p=u,m=p+f-4,b=0;b<s.length;++b){var _=s.charCodeAt(b);if(_>=55296&&_<=57343){var S=s.charCodeAt(++b);_=65536+((_&1023)<<10)|S&1023}if(B[u>>2]=_,u+=4,u+4>m)break}return B[u>>2]=0,u-p}function qe(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&++f,u+=4}return u}function Xe(s){var u=J(s)+1,f=Ut(u);return f&&pe(s,ge,f,u),f}function nt(s,u){ge.set(s,u)}function jt(s,u,f){for(var p=0;p<s.length;++p)ge[u++>>0]=s.charCodeAt(p);f||(ge[u>>0]=0)}var at,ge,Oe,Ae,ot,B,se,ut,Rn;function On(s){at=s,r.HEAP8=ge=new Int8Array(s),r.HEAP16=Ae=new Int16Array(s),r.HEAP32=B=new Int32Array(s),r.HEAPU8=Oe=new Uint8Array(s),r.HEAPU16=ot=new Uint16Array(s),r.HEAPU32=se=new Uint32Array(s),r.HEAPF32=ut=new Float32Array(s),r.HEAPF64=Rn=new Float64Array(s)}r.INITIAL_MEMORY;var Mn,Cr=[],ae=[],ye=[];function Pr(){return q}function cl(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)pl(r.preRun.shift());No(Cr)}function fl(){!r.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,No(ae)}function hl(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)vl(r.postRun.shift());No(ye)}function pl(s){Cr.unshift(s)}function dl(s){ae.unshift(s)}function vl(s){ye.unshift(s)}var fr=0,Xr=null;function b0(s){return s}function Go(s){fr++,r.monitorRunDependencies&&r.monitorRunDependencies(fr)}function Dn(s){if(fr--,r.monitorRunDependencies&&r.monitorRunDependencies(fr),fr==0&&Xr){var u=Xr;Xr=null,u()}}function qt(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",N(s),he=!0,s+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(s);throw o(u),u}var gl="data:application/octet-stream;base64,";function es(s){return s.startsWith(gl)}function ts(s){return s.startsWith("file://")}var it;it="replicad_single.wasm",es(it)||(it=v(it));function rs(s){try{if(s==it&&Y)return new Uint8Array(Y);if(T)return T(s);throw"both async and sync fetching of the wasm failed"}catch(u){qt(u)}}function ml(){if(!Y&&(c||h)){if(typeof fetch=="function"&&!ts(it))return fetch(it,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+it+"'";return s.arrayBuffer()}).catch(function(){return rs(it)});if(E)return new Promise(function(s,u){E(it,function(f){s(new Uint8Array(f))},u)})}return Promise.resolve().then(function(){return rs(it)})}function yl(){var s={a:Wf};function u(_,S){var x=_.exports;r.asm=x,re=r.asm.oa,On(re.buffer),Mn=r.asm.va,dl(r.asm.pa),Dn()}Go();function f(_){u(_.instance)}function p(_){return ml().then(function(S){return WebAssembly.instantiate(S,s)}).then(function(S){return S}).then(_,function(S){N("failed to asynchronously prepare wasm: "+S),qt(S)})}function m(){return!Y&&typeof WebAssembly.instantiateStreaming=="function"&&!es(it)&&!ts(it)&&!d&&typeof fetch=="function"?fetch(it,{credentials:"same-origin"}).then(function(_){var S=WebAssembly.instantiateStreaming(_,s);return S.then(f,function(x){return N("wasm streaming compile failed: "+x),N("falling back to ArrayBuffer instantiation"),p(f)})}):p(f)}if(r.instantiateWasm)try{var b=r.instantiateWasm(s,u);return b}catch(_){return N("Module.instantiateWasm callback failed with error: "+_),!1}return m().catch(o),{}}var Ye,Dt;function wl(){return r.HEAP8.length}function No(s){for(;s.length>0;){var u=s.shift();if(typeof u=="function"){u(r);continue}var f=u.func;typeof f=="number"?u.arg===void 0?Ln(f)():Ln(f)(u.arg):f(u.arg===void 0?null:u.arg)}}var Fn=[];function Ln(s){var u=Fn[s];return u||(s>=Fn.length&&(Fn.length=s+1),Fn[s]=u=Mn.get(s)),u}function bl(s,u,f,p){qt("Assertion failed: "+ne(s)+", at: "+[u?ne(u):"unknown filename",f,p?ne(p):"unknown function"])}function _l(s){return Ut(s+24)+24}function Sl(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(u){se[this.ptr+4>>2]=u},this.get_type=function(){return se[this.ptr+4>>2]},this.set_destructor=function(u){se[this.ptr+8>>2]=u},this.get_destructor=function(){return se[this.ptr+8>>2]},this.set_refcount=function(u){B[this.ptr>>2]=u},this.set_caught=function(u){u=u?1:0,ge[this.ptr+12>>0]=u},this.get_caught=function(){return ge[this.ptr+12>>0]!=0},this.set_rethrown=function(u){u=u?1:0,ge[this.ptr+13>>0]=u},this.get_rethrown=function(){return ge[this.ptr+13>>0]!=0},this.init=function(u,f){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(f),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var u=B[this.ptr>>2];B[this.ptr>>2]=u+1},this.release_ref=function(){var u=B[this.ptr>>2];return B[this.ptr>>2]=u-1,u===1},this.set_adjusted_ptr=function(u){se[this.ptr+16>>2]=u},this.get_adjusted_ptr=function(){return se[this.ptr+16>>2]},this.get_exception_ptr=function(){var u=Ps(this.get_type());if(u)return se[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}function El(s,u,f){var p=new Sl(s);throw p.init(u,f),s}var we={isAbs:s=>s.charAt(0)==="/",splitPath:s=>{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return u.exec(s).slice(1)},normalizeArray:(s,u)=>{for(var f=0,p=s.length-1;p>=0;p--){var m=s[p];m==="."?s.splice(p,1):m===".."?(s.splice(p,1),f++):f&&(s.splice(p,1),f--)}if(u)for(;f;f--)s.unshift("..");return s},normalize:s=>{var u=we.isAbs(s),f=s.substr(-1)==="/";return s=we.normalizeArray(s.split("/").filter(p=>!!p),!u).join("/"),!s&&!u&&(s="."),s&&f&&(s+="/"),(u?"/":"")+s},dirname:s=>{var u=we.splitPath(s),f=u[0],p=u[1];return!f&&!p?".":(p&&(p=p.substr(0,p.length-1)),f+p)},basename:s=>{if(s==="/")return"/";s=we.normalize(s),s=s.replace(/\/$/,"");var u=s.lastIndexOf("/");return u===-1?s:s.substr(u+1)},join:function(){var s=Array.prototype.slice.call(arguments,0);return we.normalize(s.join("/"))},join2:(s,u)=>we.normalize(s+"/"+u)};function Tl(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var s=new Uint8Array(1);return function(){return crypto.getRandomValues(s),s[0]}}else if(d)try{var u=require("crypto");return function(){return u.randomBytes(1)[0]}}catch{}return function(){qt("randomDevice")}}var Ft={resolve:function(){for(var s="",u=!1,f=arguments.length-1;f>=-1&&!u;f--){var p=f>=0?arguments[f]:y.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)return"";s=p+"/"+s,u=we.isAbs(p)}return s=we.normalizeArray(s.split("/").filter(m=>!!m),!u).join("/"),(u?"/":"")+s||"."},relative:(s,u)=>{s=Ft.resolve(s).substr(1),u=Ft.resolve(u).substr(1);function f(A){for(var U=0;U<A.length&&A[U]==="";U++);for(var I=A.length-1;I>=0&&A[I]==="";I--);return U>I?[]:A.slice(U,I-U+1)}for(var p=f(s.split("/")),m=f(u.split("/")),b=Math.min(p.length,m.length),_=b,S=0;S<b;S++)if(p[S]!==m[S]){_=S;break}for(var x=[],S=_;S<p.length;S++)x.push("..");return x=x.concat(m.slice(_)),x.join("/")}},hr={ttys:[],init:function(){},shutdown:function(){},register:function(s,u){hr.ttys[s]={input:[],output:[],ops:u},y.registerDevice(s,hr.stream_ops)},stream_ops:{open:function(s){var u=hr.ttys[s.node.rdev];if(!u)throw new y.ErrnoError(43);s.tty=u,s.seekable=!1},close:function(s){s.tty.ops.flush(s.tty)},flush:function(s){s.tty.ops.flush(s.tty)},read:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.get_char)throw new y.ErrnoError(60);for(var b=0,_=0;_<p;_++){var S;try{S=s.tty.ops.get_char(s.tty)}catch{throw new y.ErrnoError(29)}if(S===void 0&&b===0)throw new y.ErrnoError(6);if(S==null)break;b++,u[f+_]=S}return b&&(s.node.timestamp=Date.now()),b},write:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var b=0;b<p;b++)s.tty.ops.put_char(s.tty,u[f+b])}catch{throw new y.ErrnoError(29)}return p&&(s.node.timestamp=Date.now()),b}},default_tty_ops:{get_char:function(s){if(!s.input.length){var u=null;if(d){var f=256,p=Buffer.alloc(f),m=0;try{m=k.readSync(process.stdin.fd,p,0,f,-1)}catch(b){if(b.toString().includes("EOF"))m=0;else throw b}m>0?u=p.slice(0,m).toString("utf-8"):u=null}else typeof window<"u"&&typeof window.prompt=="function"?(u=window.prompt("Input: "),u!==null&&(u+=`
`)):typeof readline=="function"&&(u=readline(),u!==null&&(u+=`
`));if(!u)return null;s.input=Zn(u,!0)}return s.input.shift()},put_char:function(s,u){u===null||u===10?($(Te(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&($(Te(s.output,0)),s.output=[])}},default_tty1_ops:{put_char:function(s,u){u===null||u===10?(N(Te(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&(N(Te(s.output,0)),s.output=[])}}};function xl(s,u){Oe.fill(0,s,s+u)}function Cl(s,u){return Math.ceil(s/u)*u}function ns(s){s=Cl(s,65536);var u=Cs(65536,s);return u?(xl(u,s),u):0}var oe={ops_table:null,mount:function(s){return oe.createNode(null,"/",16895,0)},createNode:function(s,u,f,p){if(y.isBlkdev(f)||y.isFIFO(f))throw new y.ErrnoError(63);oe.ops_table||(oe.ops_table={dir:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr,lookup:oe.node_ops.lookup,mknod:oe.node_ops.mknod,rename:oe.node_ops.rename,unlink:oe.node_ops.unlink,rmdir:oe.node_ops.rmdir,readdir:oe.node_ops.readdir,symlink:oe.node_ops.symlink},stream:{llseek:oe.stream_ops.llseek}},file:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr},stream:{llseek:oe.stream_ops.llseek,read:oe.stream_ops.read,write:oe.stream_ops.write,allocate:oe.stream_ops.allocate,mmap:oe.stream_ops.mmap,msync:oe.stream_ops.msync}},link:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr,readlink:oe.node_ops.readlink},stream:{}},chrdev:{node:{getattr:oe.node_ops.getattr,setattr:oe.node_ops.setattr},stream:y.chrdev_stream_ops}});var m=y.createNode(s,u,f,p);return y.isDir(m.mode)?(m.node_ops=oe.ops_table.dir.node,m.stream_ops=oe.ops_table.dir.stream,m.contents={}):y.isFile(m.mode)?(m.node_ops=oe.ops_table.file.node,m.stream_ops=oe.ops_table.file.stream,m.usedBytes=0,m.contents=null):y.isLink(m.mode)?(m.node_ops=oe.ops_table.link.node,m.stream_ops=oe.ops_table.link.stream):y.isChrdev(m.mode)&&(m.node_ops=oe.ops_table.chrdev.node,m.stream_ops=oe.ops_table.chrdev.stream),m.timestamp=Date.now(),s&&(s.contents[u]=m,s.timestamp=m.timestamp),m},getFileDataAsTypedArray:function(s){return s.contents?s.contents.subarray?s.contents.subarray(0,s.usedBytes):new Uint8Array(s.contents):new Uint8Array(0)},expandFileStorage:function(s,u){var f=s.contents?s.contents.length:0;if(!(f>=u)){var p=1024*1024;u=Math.max(u,f*(f<p?2:1.125)>>>0),f!=0&&(u=Math.max(u,256));var m=s.contents;s.contents=new Uint8Array(u),s.usedBytes>0&&s.contents.set(m.subarray(0,s.usedBytes),0)}},resizeFileStorage:function(s,u){if(s.usedBytes!=u)if(u==0)s.contents=null,s.usedBytes=0;else{var f=s.contents;s.contents=new Uint8Array(u),f&&s.contents.set(f.subarray(0,Math.min(u,s.usedBytes))),s.usedBytes=u}},node_ops:{getattr:function(s){var u={};return u.dev=y.isChrdev(s.mode)?s.id:1,u.ino=s.id,u.mode=s.mode,u.nlink=1,u.uid=0,u.gid=0,u.rdev=s.rdev,y.isDir(s.mode)?u.size=4096:y.isFile(s.mode)?u.size=s.usedBytes:y.isLink(s.mode)?u.size=s.link.length:u.size=0,u.atime=new Date(s.timestamp),u.mtime=new Date(s.timestamp),u.ctime=new Date(s.timestamp),u.blksize=4096,u.blocks=Math.ceil(u.size/u.blksize),u},setattr:function(s,u){u.mode!==void 0&&(s.mode=u.mode),u.timestamp!==void 0&&(s.timestamp=u.timestamp),u.size!==void 0&&oe.resizeFileStorage(s,u.size)},lookup:function(s,u){throw y.genericErrors[44]},mknod:function(s,u,f,p){return oe.createNode(s,u,f,p)},rename:function(s,u,f){if(y.isDir(s.mode)){var p;try{p=y.lookupNode(u,f)}catch{}if(p)for(var m in p.contents)throw new y.ErrnoError(55)}delete s.parent.contents[s.name],s.parent.timestamp=Date.now(),s.name=f,u.contents[f]=s,u.timestamp=s.parent.timestamp,s.parent=u},unlink:function(s,u){delete s.contents[u],s.timestamp=Date.now()},rmdir:function(s,u){var f=y.lookupNode(s,u);for(var p in f.contents)throw new y.ErrnoError(55);delete s.contents[u],s.timestamp=Date.now()},readdir:function(s){var u=[".",".."];for(var f in s.contents)s.contents.hasOwnProperty(f)&&u.push(f);return u},symlink:function(s,u,f){var p=oe.createNode(s,u,41471,0);return p.link=f,p},readlink:function(s){if(!y.isLink(s.mode))throw new y.ErrnoError(28);return s.link}},stream_ops:{read:function(s,u,f,p,m){var b=s.node.contents;if(m>=s.node.usedBytes)return 0;var _=Math.min(s.node.usedBytes-m,p);if(_>8&&b.subarray)u.set(b.subarray(m,m+_),f);else for(var S=0;S<_;S++)u[f+S]=b[m+S];return _},write:function(s,u,f,p,m,b){if(u.buffer===ge.buffer&&(b=!1),!p)return 0;var _=s.node;if(_.timestamp=Date.now(),u.subarray&&(!_.contents||_.contents.subarray)){if(b)return _.contents=u.subarray(f,f+p),_.usedBytes=p,p;if(_.usedBytes===0&&m===0)return _.contents=u.slice(f,f+p),_.usedBytes=p,p;if(m+p<=_.usedBytes)return _.contents.set(u.subarray(f,f+p),m),p}if(oe.expandFileStorage(_,m+p),_.contents.subarray&&u.subarray)_.contents.set(u.subarray(f,f+p),m);else for(var S=0;S<p;S++)_.contents[m+S]=u[f+S];return _.usedBytes=Math.max(_.usedBytes,m+p),p},llseek:function(s,u,f){var p=u;if(f===1?p+=s.position:f===2&&y.isFile(s.node.mode)&&(p+=s.node.usedBytes),p<0)throw new y.ErrnoError(28);return p},allocate:function(s,u,f){oe.expandFileStorage(s.node,u+f),s.node.usedBytes=Math.max(s.node.usedBytes,u+f)},mmap:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);var b,_,S=s.node.contents;if(!(m&2)&&S.buffer===at)_=!1,b=S.byteOffset;else{if((f>0||f+u<S.length)&&(S.subarray?S=S.subarray(f,f+u):S=Array.prototype.slice.call(S,f,f+u)),_=!0,b=ns(u),!b)throw new y.ErrnoError(48);ge.set(S,b)}return{ptr:b,allocated:_}},msync:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);return m&2||oe.stream_ops.write(s,u,0,p,f,!1),0}}};function Pl(s,u,f,p){var m=p?"":"al "+s;E(s,function(b){de(b,'Loading data file "'+s+'" failed (no arrayBuffer).'),u(new Uint8Array(b)),m&&Dn()},function(b){if(f)f();else throw'Loading data file "'+s+'" failed.'}),m&&Go()}var y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(s,u={})=>{if(s=Ft.resolve(y.cwd(),s),!s)return{path:"",node:null};var f={follow_mount:!0,recurse_count:0};if(u=Object.assign(f,u),u.recurse_count>8)throw new y.ErrnoError(32);for(var p=we.normalizeArray(s.split("/").filter(I=>!!I),!1),m=y.root,b="/",_=0;_<p.length;_++){var S=_===p.length-1;if(S&&u.parent)break;if(m=y.lookupNode(m,p[_]),b=we.join2(b,p[_]),y.isMountpoint(m)&&(!S||S&&u.follow_mount)&&(m=m.mounted.root),!S||u.follow)for(var x=0;y.isLink(m.mode);){var A=y.readlink(b);b=Ft.resolve(we.dirname(b),A);var U=y.lookupPath(b,{recurse_count:u.recurse_count+1});if(m=U.node,x++>40)throw new y.ErrnoError(32)}}return{path:b,node:m}},getPath:s=>{for(var u;;){if(y.isRoot(s)){var f=s.mount.mountpoint;return u?f[f.length-1]!=="/"?f+"/"+u:f+u:f}u=u?s.name+"/"+u:s.name,s=s.parent}},hashName:(s,u)=>{for(var f=0,p=0;p<u.length;p++)f=(f<<5)-f+u.charCodeAt(p)|0;return(s+f>>>0)%y.nameTable.length},hashAddNode:s=>{var u=y.hashName(s.parent.id,s.name);s.name_next=y.nameTable[u],y.nameTable[u]=s},hashRemoveNode:s=>{var u=y.hashName(s.parent.id,s.name);if(y.nameTable[u]===s)y.nameTable[u]=s.name_next;else for(var f=y.nameTable[u];f;){if(f.name_next===s){f.name_next=s.name_next;break}f=f.name_next}},lookupNode:(s,u)=>{var f=y.mayLookup(s);if(f)throw new y.ErrnoError(f,s);for(var p=y.hashName(s.id,u),m=y.nameTable[p];m;m=m.name_next){var b=m.name;if(m.parent.id===s.id&&b===u)return m}return y.lookup(s,u)},createNode:(s,u,f,p)=>{var m=new y.FSNode(s,u,f,p);return y.hashAddNode(m),m},destroyNode:s=>{y.hashRemoveNode(s)},isRoot:s=>s===s.parent,isMountpoint:s=>!!s.mounted,isFile:s=>(s&61440)===32768,isDir:s=>(s&61440)===16384,isLink:s=>(s&61440)===40960,isChrdev:s=>(s&61440)===8192,isBlkdev:s=>(s&61440)===24576,isFIFO:s=>(s&61440)===4096,isSocket:s=>(s&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:s=>{var u=y.flagModes[s];if(typeof u>"u")throw new Error("Unknown file open mode: "+s);return u},flagsToPermissionString:s=>{var u=["r","w","rw"][s&3];return s&512&&(u+="w"),u},nodePermissions:(s,u)=>y.ignorePermissions?0:u.includes("r")&&!(s.mode&292)||u.includes("w")&&!(s.mode&146)||u.includes("x")&&!(s.mode&73)?2:0,mayLookup:s=>{var u=y.nodePermissions(s,"x");return u||(s.node_ops.lookup?0:2)},mayCreate:(s,u)=>{try{var f=y.lookupNode(s,u);return 20}catch{}return y.nodePermissions(s,"wx")},mayDelete:(s,u,f)=>{var p;try{p=y.lookupNode(s,u)}catch(b){return b.errno}var m=y.nodePermissions(s,"wx");if(m)return m;if(f){if(!y.isDir(p.mode))return 54;if(y.isRoot(p)||y.getPath(p)===y.cwd())return 10}else if(y.isDir(p.mode))return 31;return 0},mayOpen:(s,u)=>s?y.isLink(s.mode)?32:y.isDir(s.mode)&&(y.flagsToPermissionString(u)!=="r"||u&512)?31:y.nodePermissions(s,y.flagsToPermissionString(u)):44,MAX_OPEN_FDS:4096,nextfd:(s=0,u=y.MAX_OPEN_FDS)=>{for(var f=s;f<=u;f++)if(!y.streams[f])return f;throw new y.ErrnoError(33)},getStream:s=>y.streams[s],createStream:(s,u,f)=>{y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get:function(){return this.node},set:function(m){this.node=m}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(m){this.shared.flags=m}},position:{get:function(){return this.shared.position},set:function(m){this.shared.position=m}}})),s=Object.assign(new y.FSStream,s);var p=y.nextfd(u,f);return s.fd=p,y.streams[p]=s,s},closeStream:s=>{y.streams[s]=null},chrdev_stream_ops:{open:s=>{var u=y.getDevice(s.node.rdev);s.stream_ops=u.stream_ops,s.stream_ops.open&&s.stream_ops.open(s)},llseek:()=>{throw new y.ErrnoError(70)}},major:s=>s>>8,minor:s=>s&255,makedev:(s,u)=>s<<8|u,registerDevice:(s,u)=>{y.devices[s]={stream_ops:u}},getDevice:s=>y.devices[s],getMounts:s=>{for(var u=[],f=[s];f.length;){var p=f.pop();u.push(p),f.push.apply(f,p.mounts)}return u},syncfs:(s,u)=>{typeof s=="function"&&(u=s,s=!1),y.syncFSRequests++,y.syncFSRequests>1&&N("warning: "+y.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var f=y.getMounts(y.root.mount),p=0;function m(_){return y.syncFSRequests--,u(_)}function b(_){if(_)return b.errored?void 0:(b.errored=!0,m(_));++p>=f.length&&m(null)}f.forEach(_=>{if(!_.type.syncfs)return b(null);_.type.syncfs(_,s,b)})},mount:(s,u,f)=>{var p=f==="/",m=!f,b;if(p&&y.root)throw new y.ErrnoError(10);if(!p&&!m){var _=y.lookupPath(f,{follow_mount:!1});if(f=_.path,b=_.node,y.isMountpoint(b))throw new y.ErrnoError(10);if(!y.isDir(b.mode))throw new y.ErrnoError(54)}var S={type:s,opts:u,mountpoint:f,mounts:[]},x=s.mount(S);return x.mount=S,S.root=x,p?y.root=x:b&&(b.mounted=S,b.mount&&b.mount.mounts.push(S)),x},unmount:s=>{var u=y.lookupPath(s,{follow_mount:!1});if(!y.isMountpoint(u.node))throw new y.ErrnoError(28);var f=u.node,p=f.mounted,m=y.getMounts(p);Object.keys(y.nameTable).forEach(_=>{for(var S=y.nameTable[_];S;){var x=S.name_next;m.includes(S.mount)&&y.destroyNode(S),S=x}}),f.mounted=null;var b=f.mount.mounts.indexOf(p);f.mount.mounts.splice(b,1)},lookup:(s,u)=>s.node_ops.lookup(s,u),mknod:(s,u,f)=>{var p=y.lookupPath(s,{parent:!0}),m=p.node,b=we.basename(s);if(!b||b==="."||b==="..")throw new y.ErrnoError(28);var _=y.mayCreate(m,b);if(_)throw new y.ErrnoError(_);if(!m.node_ops.mknod)throw new y.ErrnoError(63);return m.node_ops.mknod(m,b,u,f)},create:(s,u)=>(u=u!==void 0?u:438,u&=4095,u|=32768,y.mknod(s,u,0)),mkdir:(s,u)=>(u=u!==void 0?u:511,u&=1023,u|=16384,y.mknod(s,u,0)),mkdirTree:(s,u)=>{for(var f=s.split("/"),p="",m=0;m<f.length;++m)if(f[m]){p+="/"+f[m];try{y.mkdir(p,u)}catch(b){if(b.errno!=20)throw b}}},mkdev:(s,u,f)=>(typeof f>"u"&&(f=u,u=438),u|=8192,y.mknod(s,u,f)),symlink:(s,u)=>{if(!Ft.resolve(s))throw new y.ErrnoError(44);var f=y.lookupPath(u,{parent:!0}),p=f.node;if(!p)throw new y.ErrnoError(44);var m=we.basename(u),b=y.mayCreate(p,m);if(b)throw new y.ErrnoError(b);if(!p.node_ops.symlink)throw new y.ErrnoError(63);return p.node_ops.symlink(p,m,s)},rename:(s,u)=>{var f=we.dirname(s),p=we.dirname(u),m=we.basename(s),b=we.basename(u),_,S,x;if(_=y.lookupPath(s,{parent:!0}),S=_.node,_=y.lookupPath(u,{parent:!0}),x=_.node,!S||!x)throw new y.ErrnoError(44);if(S.mount!==x.mount)throw new y.ErrnoError(75);var A=y.lookupNode(S,m),U=Ft.relative(s,p);if(U.charAt(0)!==".")throw new y.ErrnoError(28);if(U=Ft.relative(u,f),U.charAt(0)!==".")throw new y.ErrnoError(55);var I;try{I=y.lookupNode(x,b)}catch{}if(A!==I){var L=y.isDir(A.mode),V=y.mayDelete(S,m,L);if(V)throw new y.ErrnoError(V);if(V=I?y.mayDelete(x,b,L):y.mayCreate(x,b),V)throw new y.ErrnoError(V);if(!S.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(A)||I&&y.isMountpoint(I))throw new y.ErrnoError(10);if(x!==S&&(V=y.nodePermissions(S,"w"),V))throw new y.ErrnoError(V);y.hashRemoveNode(A);try{S.node_ops.rename(A,x,b)}catch(j){throw j}finally{y.hashAddNode(A)}}},rmdir:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node,p=we.basename(s),m=y.lookupNode(f,p),b=y.mayDelete(f,p,!0);if(b)throw new y.ErrnoError(b);if(!f.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.rmdir(f,p),y.destroyNode(m)},readdir:s=>{var u=y.lookupPath(s,{follow:!0}),f=u.node;if(!f.node_ops.readdir)throw new y.ErrnoError(54);return f.node_ops.readdir(f)},unlink:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node;if(!f)throw new y.ErrnoError(44);var p=we.basename(s),m=y.lookupNode(f,p),b=y.mayDelete(f,p,!1);if(b)throw new y.ErrnoError(b);if(!f.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.unlink(f,p),y.destroyNode(m)},readlink:s=>{var u=y.lookupPath(s),f=u.node;if(!f)throw new y.ErrnoError(44);if(!f.node_ops.readlink)throw new y.ErrnoError(28);return Ft.resolve(y.getPath(f.parent),f.node_ops.readlink(f))},stat:(s,u)=>{var f=y.lookupPath(s,{follow:!u}),p=f.node;if(!p)throw new y.ErrnoError(44);if(!p.node_ops.getattr)throw new y.ErrnoError(63);return p.node_ops.getattr(p)},lstat:s=>y.stat(s,!0),chmod:(s,u,f)=>{var p;if(typeof s=="string"){var m=y.lookupPath(s,{follow:!f});p=m.node}else p=s;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{mode:u&4095|p.mode&-4096,timestamp:Date.now()})},lchmod:(s,u)=>{y.chmod(s,u,!0)},fchmod:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);y.chmod(f.node,u)},chown:(s,u,f,p)=>{var m;if(typeof s=="string"){var b=y.lookupPath(s,{follow:!p});m=b.node}else m=s;if(!m.node_ops.setattr)throw new y.ErrnoError(63);m.node_ops.setattr(m,{timestamp:Date.now()})},lchown:(s,u,f)=>{y.chown(s,u,f,!0)},fchown:(s,u,f)=>{var p=y.getStream(s);if(!p)throw new y.ErrnoError(8);y.chown(p.node,u,f)},truncate:(s,u)=>{if(u<0)throw new y.ErrnoError(28);var f;if(typeof s=="string"){var p=y.lookupPath(s,{follow:!0});f=p.node}else f=s;if(!f.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(f.mode))throw new y.ErrnoError(31);if(!y.isFile(f.mode))throw new y.ErrnoError(28);var m=y.nodePermissions(f,"w");if(m)throw new y.ErrnoError(m);f.node_ops.setattr(f,{size:u,timestamp:Date.now()})},ftruncate:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);if(!(f.flags&2097155))throw new y.ErrnoError(28);y.truncate(f.node,u)},utime:(s,u,f)=>{var p=y.lookupPath(s,{follow:!0}),m=p.node;m.node_ops.setattr(m,{timestamp:Math.max(u,f)})},open:(s,u,f)=>{if(s==="")throw new y.ErrnoError(44);u=typeof u=="string"?y.modeStringToFlags(u):u,f=typeof f>"u"?438:f,u&64?f=f&4095|32768:f=0;var p;if(typeof s=="object")p=s;else{s=we.normalize(s);try{var m=y.lookupPath(s,{follow:!(u&131072)});p=m.node}catch{}}var b=!1;if(u&64)if(p){if(u&128)throw new y.ErrnoError(20)}else p=y.mknod(s,f,0),b=!0;if(!p)throw new y.ErrnoError(44);if(y.isChrdev(p.mode)&&(u&=-513),u&65536&&!y.isDir(p.mode))throw new y.ErrnoError(54);if(!b){var _=y.mayOpen(p,u);if(_)throw new y.ErrnoError(_)}u&512&&!b&&y.truncate(p,0),u&=-131713;var S=y.createStream({node:p,path:y.getPath(p),flags:u,seekable:!0,position:0,stream_ops:p.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),r.logReadFiles&&!(u&1)&&(y.readFiles||(y.readFiles={}),s in y.readFiles||(y.readFiles[s]=1)),S},close:s=>{if(y.isClosed(s))throw new y.ErrnoError(8);s.getdents&&(s.getdents=null);try{s.stream_ops.close&&s.stream_ops.close(s)}catch(u){throw u}finally{y.closeStream(s.fd)}s.fd=null},isClosed:s=>s.fd===null,llseek:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(!s.seekable||!s.stream_ops.llseek)throw new y.ErrnoError(70);if(f!=0&&f!=1&&f!=2)throw new y.ErrnoError(28);return s.position=s.stream_ops.llseek(s,u,f),s.ungotten=[],s.position},read:(s,u,f,p,m)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if((s.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.read)throw new y.ErrnoError(28);var b=typeof m<"u";if(!b)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var _=s.stream_ops.read(s,u,f,p,m);return b||(s.position+=_),_},write:(s,u,f,p,m,b)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.write)throw new y.ErrnoError(28);s.seekable&&s.flags&1024&&y.llseek(s,0,2);var _=typeof m<"u";if(!_)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var S=s.stream_ops.write(s,u,f,p,m,b);return _||(s.position+=S),S},allocate:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(u<0||f<=0)throw new y.ErrnoError(28);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(s.node.mode)&&!y.isDir(s.node.mode))throw new y.ErrnoError(43);if(!s.stream_ops.allocate)throw new y.ErrnoError(138);s.stream_ops.allocate(s,u,f)},mmap:(s,u,f,p,m)=>{if(p&2&&!(m&2)&&(s.flags&2097155)!==2)throw new y.ErrnoError(2);if((s.flags&2097155)===1)throw new y.ErrnoError(2);if(!s.stream_ops.mmap)throw new y.ErrnoError(43);return s.stream_ops.mmap(s,u,f,p,m)},msync:(s,u,f,p,m)=>!s||!s.stream_ops.msync?0:s.stream_ops.msync(s,u,f,p,m),munmap:s=>0,ioctl:(s,u,f)=>{if(!s.stream_ops.ioctl)throw new y.ErrnoError(59);return s.stream_ops.ioctl(s,u,f)},readFile:(s,u={})=>{if(u.flags=u.flags||0,u.encoding=u.encoding||"binary",u.encoding!=="utf8"&&u.encoding!=="binary")throw new Error('Invalid encoding type "'+u.encoding+'"');var f,p=y.open(s,u.flags),m=y.stat(s),b=m.size,_=new Uint8Array(b);return y.read(p,_,0,b,0),u.encoding==="utf8"?f=Te(_,0):u.encoding==="binary"&&(f=_),y.close(p),f},writeFile:(s,u,f={})=>{f.flags=f.flags||577;var p=y.open(s,f.flags,f.mode);if(typeof u=="string"){var m=new Uint8Array(J(u)+1),b=pe(u,m,0,m.length);y.write(p,m,0,b,void 0,f.canOwn)}else if(ArrayBuffer.isView(u))y.write(p,u,0,u.byteLength,void 0,f.canOwn);else throw new Error("Unsupported data type");y.close(p)},cwd:()=>y.currentPath,chdir:s=>{var u=y.lookupPath(s,{follow:!0});if(u.node===null)throw new y.ErrnoError(44);if(!y.isDir(u.node.mode))throw new y.ErrnoError(54);var f=y.nodePermissions(u.node,"x");if(f)throw new y.ErrnoError(f);y.currentPath=u.path},createDefaultDirectories:()=>{y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices:()=>{y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(u,f,p,m,b)=>m}),y.mkdev("/dev/null",y.makedev(1,3)),hr.register(y.makedev(5,0),hr.default_tty_ops),hr.register(y.makedev(6,0),hr.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var s=Tl();y.createDevice("/dev","random",s),y.createDevice("/dev","urandom",s),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{y.mkdir("/proc");var s=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount:()=>{var u=y.createNode(s,"fd",16895,73);return u.node_ops={lookup:(f,p)=>{var m=+p,b=y.getStream(m);if(!b)throw new y.ErrnoError(8);var _={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>b.path}};return _.parent=_,_}},u}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?y.createDevice("/dev","stdin",r.stdin):y.symlink("/dev/tty","/dev/stdin"),r.stdout?y.createDevice("/dev","stdout",null,r.stdout):y.symlink("/dev/tty","/dev/stdout"),r.stderr?y.createDevice("/dev","stderr",null,r.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError:()=>{y.ErrnoError||(y.ErrnoError=function(u,f){this.node=f,this.setErrno=function(p){this.errno=p},this.setErrno(u),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(s=>{y.genericErrors[s]=new y.ErrnoError(s),y.genericErrors[s].stack="<generic error, no stack>"}))},staticInit:()=>{y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(oe,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:oe}},init:(s,u,f)=>{y.init.initialized=!0,y.ensureErrnoError(),r.stdin=s||r.stdin,r.stdout=u||r.stdout,r.stderr=f||r.stderr,y.createStandardStreams()},quit:()=>{y.init.initialized=!1;for(var s=0;s<y.streams.length;s++){var u=y.streams[s];u&&y.close(u)}},getMode:(s,u)=>{var f=0;return s&&(f|=365),u&&(f|=146),f},findObject:(s,u)=>{var f=y.analyzePath(s,u);return f.exists?f.object:null},analyzePath:(s,u)=>{try{var f=y.lookupPath(s,{follow:!u});s=f.path}catch{}var p={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var f=y.lookupPath(s,{parent:!0});p.parentExists=!0,p.parentPath=f.path,p.parentObject=f.node,p.name=we.basename(s),f=y.lookupPath(s,{follow:!u}),p.exists=!0,p.path=f.path,p.object=f.node,p.name=f.node.name,p.isRoot=f.path==="/"}catch(m){p.error=m.errno}return p},createPath:(s,u,f,p)=>{s=typeof s=="string"?s:y.getPath(s);for(var m=u.split("/").reverse();m.length;){var b=m.pop();if(b){var _=we.join2(s,b);try{y.mkdir(_)}catch{}s=_}}return _},createFile:(s,u,f,p,m)=>{var b=we.join2(typeof s=="string"?s:y.getPath(s),u),_=y.getMode(p,m);return y.create(b,_)},createDataFile:(s,u,f,p,m,b)=>{var _=u;s&&(s=typeof s=="string"?s:y.getPath(s),_=u?we.join2(s,u):s);var S=y.getMode(p,m),x=y.create(_,S);if(f){if(typeof f=="string"){for(var A=new Array(f.length),U=0,I=f.length;U<I;++U)A[U]=f.charCodeAt(U);f=A}y.chmod(x,S|146);var L=y.open(x,577);y.write(L,f,0,f.length,0,b),y.close(L),y.chmod(x,S)}return x},createDevice:(s,u,f,p)=>{var m=we.join2(typeof s=="string"?s:y.getPath(s),u),b=y.getMode(!!f,!!p);y.createDevice.major||(y.createDevice.major=64);var _=y.makedev(y.createDevice.major++,0);return y.registerDevice(_,{open:S=>{S.seekable=!1},close:S=>{p&&p.buffer&&p.buffer.length&&p(10)},read:(S,x,A,U,I)=>{for(var L=0,V=0;V<U;V++){var j;try{j=f()}catch{throw new y.ErrnoError(29)}if(j===void 0&&L===0)throw new y.ErrnoError(6);if(j==null)break;L++,x[A+V]=j}return L&&(S.node.timestamp=Date.now()),L},write:(S,x,A,U,I)=>{for(var L=0;L<U;L++)try{p(x[A+L])}catch{throw new y.ErrnoError(29)}return U&&(S.node.timestamp=Date.now()),L}}),y.mkdev(m,b,_)},forceLoadFile:s=>{if(s.isDevice||s.isFolder||s.link||s.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(w)try{s.contents=Zn(w(s.url),!0),s.usedBytes=s.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(s,u,f,p,m)=>{function b(){this.lengthKnown=!1,this.chunks=[]}if(b.prototype.get=function(V){if(!(V>this.length-1||V<0)){var j=V%this.chunkSize,Se=V/this.chunkSize|0;return this.getter(Se)[j]}},b.prototype.setDataGetter=function(V){this.getter=V},b.prototype.cacheLength=function(){var V=new XMLHttpRequest;if(V.open("HEAD",f,!1),V.send(null),!(V.status>=200&&V.status<300||V.status===304))throw new Error("Couldn't load "+f+". Status: "+V.status);var j=Number(V.getResponseHeader("Content-length")),Se,Ue=(Se=V.getResponseHeader("Accept-Ranges"))&&Se==="bytes",Ge=(Se=V.getResponseHeader("Content-Encoding"))&&Se==="gzip",F=1024*1024;Ue||(F=j);var X=(Pe,st)=>{if(Pe>st)throw new Error("invalid range ("+Pe+", "+st+") or no bytes requested!");if(st>j-1)throw new Error("only "+j+" bytes available! programmer error!");var Ne=new XMLHttpRequest;if(Ne.open("GET",f,!1),j!==F&&Ne.setRequestHeader("Range","bytes="+Pe+"-"+st),Ne.responseType="arraybuffer",Ne.overrideMimeType&&Ne.overrideMimeType("text/plain; charset=x-user-defined"),Ne.send(null),!(Ne.status>=200&&Ne.status<300||Ne.status===304))throw new Error("Couldn't load "+f+". Status: "+Ne.status);return Ne.response!==void 0?new Uint8Array(Ne.response||[]):Zn(Ne.responseText||"",!0)},We=this;We.setDataGetter(Pe=>{var st=Pe*F,Ne=(Pe+1)*F-1;if(Ne=Math.min(Ne,j-1),typeof We.chunks[Pe]>"u"&&(We.chunks[Pe]=X(st,Ne)),typeof We.chunks[Pe]>"u")throw new Error("doXHR failed!");return We.chunks[Pe]}),(Ge||!j)&&(F=j=1,j=this.getter(0).length,F=j,$("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=j,this._chunkSize=F,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var _=new b;Object.defineProperties(_,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:_}}else var S={isDevice:!1,url:f};var x=y.createFile(s,u,S,p,m);S.contents?x.contents=S.contents:S.url&&(x.contents=null,x.url=S.url),Object.defineProperties(x,{usedBytes:{get:function(){return this.contents.length}}});var A={},U=Object.keys(x.stream_ops);U.forEach(L=>{var V=x.stream_ops[L];A[L]=function(){return y.forceLoadFile(x),V.apply(null,arguments)}});function I(L,V,j,Se,Ue){var Ge=L.node.contents;if(Ue>=Ge.length)return 0;var F=Math.min(Ge.length-Ue,Se);if(Ge.slice)for(var X=0;X<F;X++)V[j+X]=Ge[Ue+X];else for(var X=0;X<F;X++)V[j+X]=Ge.get(Ue+X);return F}return A.read=(L,V,j,Se,Ue)=>(y.forceLoadFile(x),I(L,V,j,Se,Ue)),A.mmap=(L,V,j,Se,Ue)=>{y.forceLoadFile(x);var Ge=ns(V);if(!Ge)throw new y.ErrnoError(48);return I(L,ge,Ge,V,j),{ptr:Ge,allocated:!0}},x.stream_ops=A,x},createPreloadedFile:(s,u,f,p,m,b,_,S,x,A)=>{var U=u?Ft.resolve(we.join2(s,u)):s;function I(L){function V(j){A&&A(),S||y.createDataFile(s,u,j,p,m,x),b&&b(),Dn()}Browser.handledByPreloadPlugin(L,U,V,()=>{_&&_(),Dn()})||V(L)}Go(),typeof f=="string"?Pl(f,L=>I(L),_):I(f)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(b){return f(b)}m.onupgradeneeded=()=>{$("creating db");var b=m.result;b.createObjectStore(y.DB_STORE_NAME)},m.onsuccess=()=>{var b=m.result,_=b.transaction([y.DB_STORE_NAME],"readwrite"),S=_.objectStore(y.DB_STORE_NAME),x=0,A=0,U=s.length;function I(){A==0?u():f()}s.forEach(L=>{var V=S.put(y.analyzePath(L).object.contents,L);V.onsuccess=()=>{x++,x+A==U&&I()},V.onerror=()=>{A++,x+A==U&&I()}}),_.onerror=f},m.onerror=f},loadFilesFromDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(b){return f(b)}m.onupgradeneeded=f,m.onsuccess=()=>{var b=m.result;try{var _=b.transaction([y.DB_STORE_NAME],"readonly")}catch(L){f(L);return}var S=_.objectStore(y.DB_STORE_NAME),x=0,A=0,U=s.length;function I(){A==0?u():f()}s.forEach(L=>{var V=S.get(L);V.onsuccess=()=>{y.analyzePath(L).exists&&y.unlink(L),y.createDataFile(we.dirname(L),we.basename(L),V.result,!0,!0,!0),x++,x+A==U&&I()},V.onerror=()=>{A++,x+A==U&&I()}}),_.onerror=f},m.onerror=f}},be={DEFAULT_POLLMASK:5,calculateAt:function(s,u,f){if(we.isAbs(u))return u;var p;if(s===-100)p=y.cwd();else{var m=y.getStream(s);if(!m)throw new y.ErrnoError(8);p=m.path}if(u.length==0){if(!f)throw new y.ErrnoError(44);return p}return we.join2(p,u)},doStat:function(s,u,f){try{var p=s(u)}catch(m){if(m&&m.node&&we.normalize(u)!==we.normalize(y.getPath(m.node)))return-54;throw m}return B[f>>2]=p.dev,B[f+4>>2]=0,B[f+8>>2]=p.ino,B[f+12>>2]=p.mode,B[f+16>>2]=p.nlink,B[f+20>>2]=p.uid,B[f+24>>2]=p.gid,B[f+28>>2]=p.rdev,B[f+32>>2]=0,Dt=[p.size>>>0,(Ye=p.size,+Math.abs(Ye)>=1?Ye>0?(Math.min(+Math.floor(Ye/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ye-+(~~Ye>>>0))/4294967296)>>>0:0)],B[f+40>>2]=Dt[0],B[f+44>>2]=Dt[1],B[f+48>>2]=4096,B[f+52>>2]=p.blocks,B[f+56>>2]=p.atime.getTime()/1e3|0,B[f+60>>2]=0,B[f+64>>2]=p.mtime.getTime()/1e3|0,B[f+68>>2]=0,B[f+72>>2]=p.ctime.getTime()/1e3|0,B[f+76>>2]=0,Dt=[p.ino>>>0,(Ye=p.ino,+Math.abs(Ye)>=1?Ye>0?(Math.min(+Math.floor(Ye/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ye-+(~~Ye>>>0))/4294967296)>>>0:0)],B[f+80>>2]=Dt[0],B[f+84>>2]=Dt[1],0},doMsync:function(s,u,f,p,m){var b=Oe.slice(s,s+f);y.msync(u,b,m,f,p)},varargs:void 0,get:function(){be.varargs+=4;var s=B[be.varargs-4>>2];return s},getStr:function(s){var u=ne(s);return u},getStreamFromFD:function(s){var u=y.getStream(s);if(!u)throw new y.ErrnoError(8);return u}};function kl(s,u){try{return s=be.getStr(s),y.chmod(s,u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Al(s,u,f,p){try{if(u=be.getStr(u),u=be.calculateAt(s,u),f&-8)return-28;var m=y.lookupPath(u,{follow:!0}),b=m.node;if(!b)return-44;var _="";return f&4&&(_+="r"),f&2&&(_+="w"),f&1&&(_+="x"),_&&y.nodePermissions(b,_)?-2:0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function Rl(s){return B[Es()>>2]=s,s}function Ol(s,u,f){be.varargs=f;try{var p=be.getStreamFromFD(s);switch(u){case 0:{var m=be.get();if(m<0)return-28;var b;return b=y.createStream(p,m),b.fd}case 1:case 2:return 0;case 3:return p.flags;case 4:{var m=be.get();return p.flags|=m,0}case 5:{var m=be.get(),_=0;return Ae[m+_>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Rl(28),-1;default:return-28}}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function Ml(s,u){try{var f=be.getStreamFromFD(s);return be.doStat(y.stat,f.path,u)}catch(p){if(typeof y>"u"||!(p instanceof y.ErrnoError))throw p;return-p.errno}}function Dl(s,u,f){be.varargs=f;try{var p=be.getStreamFromFD(s);switch(u){case 21509:case 21505:return p.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return p.tty?0:-59;case 21519:{if(!p.tty)return-59;var m=be.get();return B[m>>2]=0,0}case 21520:return p.tty?-28:-59;case 21531:{var m=be.get();return y.ioctl(p,u,m)}case 21523:return p.tty?0:-59;case 21524:return p.tty?0:-59;default:qt("bad ioctl syscall "+u)}}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return-b.errno}}function Fl(s,u){try{return s=be.getStr(s),be.doStat(y.lstat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Ll(s,u,f,p){try{u=be.getStr(u);var m=p&256,b=p&4096;return p=p&-4353,u=be.calculateAt(s,u,b),be.doStat(m?y.lstat:y.stat,u,f)}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function Bl(s,u,f,p){be.varargs=p;try{u=be.getStr(u),u=be.calculateAt(s,u);var m=p?be.get():0;return y.open(u,f,m).fd}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return-b.errno}}function Ul(s,u){try{return s=be.getStr(s),be.doStat(y.stat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Il(s,u,f,p,m){}function Bn(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function Gl(){for(var s=new Array(256),u=0;u<256;++u)s[u]=String.fromCharCode(u);os=s}var os=void 0;function Qe(s){for(var u="",f=s;Oe[f];)u+=os[Oe[f++]];return u}var kr={},pr={},Un={},Nl=48,Vl=57;function In(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var u=s.charCodeAt(0);return u>=Nl&&u<=Vl?"_"+s:s}function Gn(s,u){return s=In(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(u)}function Vo(s,u){var f=Gn(u,function(p){this.name=u,this.message=p;var m=new Error(p).stack;m!==void 0&&(this.stack=this.toString()+`
`+m.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},f}var Ar=void 0;function _e(s){throw new Ar(s)}var is=void 0;function Nn(s){throw new is(s)}function dr(s,u,f){s.forEach(function(S){Un[S]=u});function p(S){var x=f(S);x.length!==s.length&&Nn("Mismatched type converter count");for(var A=0;A<s.length;++A)Pt(s[A],x[A])}var m=new Array(u.length),b=[],_=0;u.forEach((S,x)=>{pr.hasOwnProperty(S)?m[x]=pr[S]:(b.push(S),kr.hasOwnProperty(S)||(kr[S]=[]),kr[S].push(()=>{m[x]=pr[S],++_,_===b.length&&p(m)}))}),b.length===0&&p(m)}function Pt(s,u,f={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");var p=u.name;if(s||_e('type "'+p+'" must have a positive integer typeid pointer'),pr.hasOwnProperty(s)){if(f.ignoreDuplicateRegistrations)return;_e("Cannot register type '"+p+"' twice")}if(pr[s]=u,delete Un[s],kr.hasOwnProperty(s)){var m=kr[s];delete kr[s],m.forEach(b=>b())}}function Hl(s,u,f,p,m){var b=Bn(f);u=Qe(u),Pt(s,{name:u,fromWireType:function(_){return!!_},toWireType:function(_,S){return S?p:m},argPackAdvance:8,readValueFromPointer:function(_){var S;if(f===1)S=ge;else if(f===2)S=Ae;else if(f===4)S=B;else throw new TypeError("Unknown boolean type size: "+u);return this.fromWireType(S[_>>b])},destructorFunction:null})}function Wl(s){if(!(this instanceof Zt)||!(s instanceof Zt))return!1;for(var u=this.$$.ptrType.registeredClass,f=this.$$.ptr,p=s.$$.ptrType.registeredClass,m=s.$$.ptr;u.baseClass;)f=u.upcast(f),u=u.baseClass;for(;p.baseClass;)m=p.upcast(m),p=p.baseClass;return u===p&&f===m}function zl(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function Ho(s){function u(f){return f.$$.ptrType.registeredClass.name}_e(u(s)+" instance already deleted")}var Wo=!1;function ss(s){}function $l(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function as(s){s.count.value-=1;var u=s.count.value===0;u&&$l(s)}function us(s,u,f){if(u===f)return s;if(f.baseClass===void 0)return null;var p=us(s,u,f.baseClass);return p===null?null:f.downcast(p)}var ls={};function Xl(){return Object.keys(qr).length}function Yl(){var s=[];for(var u in qr)qr.hasOwnProperty(u)&&s.push(qr[u]);return s}var Yr=[];function zo(){for(;Yr.length;){var s=Yr.pop();s.$$.deleteScheduled=!1,s.delete()}}var jr=void 0;function jl(s){jr=s,Yr.length&&jr&&jr(zo)}function ql(){r.getInheritedInstanceCount=Xl,r.getLiveInheritedInstances=Yl,r.flushPendingDeletes=zo,r.setDelayFunction=jl}var qr={};function Zl(s,u){for(u===void 0&&_e("ptr should not be undefined");s.baseClass;)u=s.upcast(u),s=s.baseClass;return u}function Kl(s,u){return u=Zl(s,u),qr[u]}function Vn(s,u){(!u.ptrType||!u.ptr)&&Nn("makeClassHandle requires ptr and ptrType");var f=!!u.smartPtrType,p=!!u.smartPtr;return f!==p&&Nn("Both smartPtrType and smartPtr must be specified"),u.count={value:1},Zr(Object.create(s,{$$:{value:u}}))}function Ql(s){var u=this.getPointee(s);if(!u)return this.destructor(s),null;var f=Kl(this.registeredClass,u);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=u,f.$$.smartPtr=s,f.clone();var p=f.clone();return this.destructor(s),p}function m(){return this.isSmartPointer?Vn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:s}):Vn(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var b=this.registeredClass.getActualType(u),_=ls[b];if(!_)return m.call(this);var S;this.isConst?S=_.constPointerType:S=_.pointerType;var x=us(u,this.registeredClass,S.registeredClass);return x===null?m.call(this):this.isSmartPointer?Vn(S.registeredClass.instancePrototype,{ptrType:S,ptr:x,smartPtrType:this,smartPtr:s}):Vn(S.registeredClass.instancePrototype,{ptrType:S,ptr:x})}function Zr(s){return typeof FinalizationRegistry>"u"?(Zr=u=>u,s):(Wo=new FinalizationRegistry(u=>{as(u.$$)}),Zr=u=>{var f=u.$$,p=!!f.smartPtr;if(p){var m={$$:f};Wo.register(u,m,u)}return u},ss=u=>Wo.unregister(u),Zr(s))}function Jl(){if(this.$$.ptr||Ho(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=Zr(Object.create(Object.getPrototypeOf(this),{$$:{value:zl(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function ec(){this.$$.ptr||Ho(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_e("Object already scheduled for deletion"),ss(this),as(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function tc(){return!this.$$.ptr}function rc(){return this.$$.ptr||Ho(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_e("Object already scheduled for deletion"),Yr.push(this),Yr.length===1&&jr&&jr(zo),this.$$.deleteScheduled=!0,this}function nc(){Zt.prototype.isAliasOf=Wl,Zt.prototype.clone=Jl,Zt.prototype.delete=ec,Zt.prototype.isDeleted=tc,Zt.prototype.deleteLater=rc}function Zt(){}function $o(s,u,f){if(s[u].overloadTable===void 0){var p=s[u];s[u]=function(){return s[u].overloadTable.hasOwnProperty(arguments.length)||_e("Function '"+f+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[u].overloadTable+")!"),s[u].overloadTable[arguments.length].apply(this,arguments)},s[u].overloadTable=[],s[u].overloadTable[p.argCount]=p}}function cs(s,u,f){r.hasOwnProperty(s)?((f===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[f]!==void 0)&&_e("Cannot register public name '"+s+"' twice"),$o(r,s,s),r.hasOwnProperty(f)&&_e("Cannot register multiple overloads of a function with the same number of arguments ("+f+")!"),r[s].overloadTable[f]=u):(r[s]=u,f!==void 0&&(r[s].numArguments=f))}function oc(s,u,f,p,m,b,_,S){this.name=s,this.constructor=u,this.instancePrototype=f,this.rawDestructor=p,this.baseClass=m,this.getActualType=b,this.upcast=_,this.downcast=S,this.pureVirtualFunctions=[]}function Xo(s,u,f){for(;u!==f;)u.upcast||_e("Expected null or instance of "+f.name+", got an instance of "+u.name),s=u.upcast(s),u=u.baseClass;return s}function ic(s,u){if(u===null)return this.isReference&&_e("null is not a valid "+this.name),0;u.$$||_e('Cannot pass "'+Ko(u)+'" as a '+this.name),u.$$.ptr||_e("Cannot pass deleted object as a pointer of type "+this.name);var f=u.$$.ptrType.registeredClass,p=Xo(u.$$.ptr,f,this.registeredClass);return p}function sc(s,u){var f;if(u===null)return this.isReference&&_e("null is not a valid "+this.name),this.isSmartPointer?(f=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,f),f):0;u.$$||_e('Cannot pass "'+Ko(u)+'" as a '+this.name),u.$$.ptr||_e("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&u.$$.ptrType.isConst&&_e("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);var p=u.$$.ptrType.registeredClass;if(f=Xo(u.$$.ptr,p,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&_e("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?f=u.$$.smartPtr:_e("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:f=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)f=u.$$.smartPtr;else{var m=u.clone();f=this.rawShare(f,He.toHandle(function(){m.delete()})),s!==null&&s.push(this.rawDestructor,f)}break;default:_e("Unsupporting sharing policy")}return f}function ac(s,u){if(u===null)return this.isReference&&_e("null is not a valid "+this.name),0;u.$$||_e('Cannot pass "'+Ko(u)+'" as a '+this.name),u.$$.ptr||_e("Cannot pass deleted object as a pointer of type "+this.name),u.$$.ptrType.isConst&&_e("Cannot convert argument of type "+u.$$.ptrType.name+" to parameter type "+this.name);var f=u.$$.ptrType.registeredClass,p=Xo(u.$$.ptr,f,this.registeredClass);return p}function Hn(s){return this.fromWireType(se[s>>2])}function uc(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function lc(s){this.rawDestructor&&this.rawDestructor(s)}function cc(s){s!==null&&s.delete()}function fc(){Lt.prototype.getPointee=uc,Lt.prototype.destructor=lc,Lt.prototype.argPackAdvance=8,Lt.prototype.readValueFromPointer=Hn,Lt.prototype.deleteObject=cc,Lt.prototype.fromWireType=Ql}function Lt(s,u,f,p,m,b,_,S,x,A,U){this.name=s,this.registeredClass=u,this.isReference=f,this.isConst=p,this.isSmartPointer=m,this.pointeeType=b,this.sharingPolicy=_,this.rawGetPointee=S,this.rawConstructor=x,this.rawShare=A,this.rawDestructor=U,!m&&u.baseClass===void 0?p?(this.toWireType=ic,this.destructorFunction=null):(this.toWireType=ac,this.destructorFunction=null):this.toWireType=sc}function hc(s,u,f){r.hasOwnProperty(s)||Nn("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&f!==void 0?r[s].overloadTable[f]=u:(r[s]=u,r[s].argCount=f)}function pc(s,u,f){var p=r["dynCall_"+s];return f&&f.length?p.apply(null,[u].concat(f)):p.call(null,u)}function dc(s,u,f){return s.includes("j")?pc(s,u,f):Ln(u).apply(null,f)}function vc(s,u){var f=[];return function(){return f.length=0,Object.assign(f,arguments),dc(s,u,f)}}function vr(s,u){s=Qe(s);function f(){return s.includes("j")?vc(s,u):Ln(u)}var p=f();return typeof p!="function"&&_e("unknown function pointer with signature "+s+": "+u),p}var fs=void 0;function hs(s){var u=Ts(s),f=Qe(u);return It(u),f}function Wn(s,u){var f=[],p={};function m(b){if(!p[b]&&!pr[b]){if(Un[b]){Un[b].forEach(m);return}f.push(b),p[b]=!0}}throw u.forEach(m),new fs(s+": "+f.map(hs).join([", "]))}function gc(s,u,f,p,m,b,_,S,x,A,U,I,L){U=Qe(U),b=vr(m,b),S&&(S=vr(_,S)),A&&(A=vr(x,A)),L=vr(I,L);var V=In(U);cs(V,function(){Wn("Cannot construct "+U+" due to unbound types",[p])}),dr([s,u,f],p?[p]:[],function(j){j=j[0];var Se,Ue;p?(Se=j.registeredClass,Ue=Se.instancePrototype):Ue=Zt.prototype;var Ge=Gn(V,function(){if(Object.getPrototypeOf(this)!==F)throw new Ar("Use 'new' to construct "+U);if(X.constructor_body===void 0)throw new Ar(U+" has no accessible constructor");var Ne=X.constructor_body[arguments.length];if(Ne===void 0)throw new Ar("Tried to invoke ctor of "+U+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(X.constructor_body).toString()+") parameters instead!");return Ne.apply(this,arguments)}),F=Object.create(Ue,{constructor:{value:Ge}});Ge.prototype=F;var X=new oc(U,Ge,F,L,Se,b,S,A),We=new Lt(U,X,!0,!1,!1),Pe=new Lt(U+"*",X,!1,!1,!1),st=new Lt(U+" const*",X,!1,!0,!1);return ls[s]={pointerType:Pe,constPointerType:st},hc(V,Ge),[We,Pe,st]})}function ps(s,u){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var f=Gn(s.name||"unknownFunctionName",function(){});f.prototype=s.prototype;var p=new f,m=s.apply(p,u);return m instanceof Object?m:p}function ds(s){for(;s.length;){var u=s.pop(),f=s.pop();f(u)}}function Yo(s,u,f,p,m){var b=u.length;b<2&&_e("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var _=u[1]!==null&&f!==null,S=!1,x=1;x<u.length;++x)if(u[x]!==null&&u[x].destructorFunction===void 0){S=!0;break}for(var A=u[0].name!=="void",U="",I="",x=0;x<b-2;++x)U+=(x!==0?", ":"")+"arg"+x,I+=(x!==0?", ":"")+"arg"+x+"Wired";var L="return function "+In(s)+"("+U+`) {
if (arguments.length !== `+(b-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(b-2)+` args!');
}
`;S&&(L+=`var destructors = [];
`);var V=S?"destructors":"null",j=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Se=[_e,p,m,ds,u[0],u[1]];_&&(L+="var thisWired = classParam.toWireType("+V+`, this);
`);for(var x=0;x<b-2;++x)L+="var arg"+x+"Wired = argType"+x+".toWireType("+V+", arg"+x+"); // "+u[x+2].name+`
`,j.push("argType"+x),Se.push(u[x+2]);if(_&&(I="thisWired"+(I.length>0?", ":"")+I),L+=(A?"var rv = ":"")+"invoker(fn"+(I.length>0?", ":"")+I+`);
`,S)L+=`runDestructors(destructors);
`;else for(var x=_?1:2;x<u.length;++x){var Ue=x===1?"thisWired":"arg"+(x-2)+"Wired";u[x].destructorFunction!==null&&(L+=Ue+"_dtor("+Ue+"); // "+u[x].name+`
`,j.push(Ue+"_dtor"),Se.push(u[x].destructorFunction))}A&&(L+=`var ret = retType.fromWireType(rv);
return ret;
`),L+=`}
`,j.push(L);var Ge=ps(Function,j).apply(null,Se);return Ge}function jo(s,u){for(var f=[],p=0;p<s;p++)f.push(B[(u>>2)+p]);return f}function mc(s,u,f,p,m,b,_){var S=jo(f,p);u=Qe(u),b=vr(m,b),dr([],[s],function(x){x=x[0];var A=x.name+"."+u;function U(){Wn("Cannot call "+A+" due to unbound types",S)}u.startsWith("@@")&&(u=Symbol[u.substring(2)]);var I=x.registeredClass.constructor;return I[u]===void 0?(U.argCount=f-1,I[u]=U):($o(I,u,A),I[u].overloadTable[f-1]=U),dr([],S,function(L){var V=[L[0],null].concat(L.slice(1)),j=Yo(A,V,null,b,_);return I[u].overloadTable===void 0?(j.argCount=f-1,I[u]=j):I[u].overloadTable[f-1]=j,[]}),[]})}function yc(s,u,f,p,m,b){de(u>0);var _=jo(u,f);m=vr(p,m),dr([],[s],function(S){S=S[0];var x="constructor "+S.name;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[u-1]!==void 0)throw new Ar("Cannot register multiple constructors with identical number of parameters ("+(u-1)+") for class '"+S.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return S.registeredClass.constructor_body[u-1]=()=>{Wn("Cannot construct "+S.name+" due to unbound types",_)},dr([],_,function(A){return A.splice(1,0,null),S.registeredClass.constructor_body[u-1]=Yo(x,A,null,m,b),[]}),[]})}function wc(s,u,f,p,m,b,_,S){var x=jo(f,p);u=Qe(u),b=vr(m,b),dr([],[s],function(A){A=A[0];var U=A.name+"."+u;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),S&&A.registeredClass.pureVirtualFunctions.push(u);function I(){Wn("Cannot call "+U+" due to unbound types",x)}var L=A.registeredClass.instancePrototype,V=L[u];return V===void 0||V.overloadTable===void 0&&V.className!==A.name&&V.argCount===f-2?(I.argCount=f-2,I.className=A.name,L[u]=I):($o(L,u,U),L[u].overloadTable[f-2]=I),dr([],x,function(j){var Se=Yo(U,j,A,b,_);return L[u].overloadTable===void 0?(Se.argCount=f-2,L[u]=Se):L[u].overloadTable[f-2]=Se,[]}),[]})}var qo=[],yt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Zo(s){s>4&&--yt[s].refcount===0&&(yt[s]=void 0,qo.push(s))}function bc(){for(var s=0,u=5;u<yt.length;++u)yt[u]!==void 0&&++s;return s}function _c(){for(var s=5;s<yt.length;++s)if(yt[s]!==void 0)return yt[s];return null}function Sc(){r.count_emval_handles=bc,r.get_first_emval=_c}var He={toValue:s=>(s||_e("Cannot use deleted val. handle = "+s),yt[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var u=qo.length?qo.pop():yt.length;return yt[u]={refcount:1,value:s},u}}}};function Ec(s,u){u=Qe(u),Pt(s,{name:u,fromWireType:function(f){var p=He.toValue(f);return Zo(f),p},toWireType:function(f,p){return He.toHandle(p)},argPackAdvance:8,readValueFromPointer:Hn,destructorFunction:null})}function Tc(s,u,f){switch(u){case 0:return function(p){var m=f?ge:Oe;return this.fromWireType(m[p])};case 1:return function(p){var m=f?Ae:ot;return this.fromWireType(m[p>>1])};case 2:return function(p){var m=f?B:se;return this.fromWireType(m[p>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function xc(s,u,f,p){var m=Bn(f);u=Qe(u);function b(){}b.values={},Pt(s,{name:u,constructor:b,fromWireType:function(_){return this.constructor.values[_]},toWireType:function(_,S){return S.value},argPackAdvance:8,readValueFromPointer:Tc(u,m,p),destructorFunction:null}),cs(u,b)}function zn(s,u){var f=pr[s];return f===void 0&&_e(u+" has unknown type "+hs(s)),f}function Cc(s,u,f){var p=zn(s,"enum");u=Qe(u);var m=p.constructor,b=Object.create(p.constructor.prototype,{value:{value:f},constructor:{value:Gn(p.name+"_"+u,function(){})}});m.values[f]=b,m[u]=b}function Ko(s){if(s===null)return"null";var u=typeof s;return u==="object"||u==="array"||u==="function"?s.toString():""+s}function Pc(s,u){switch(u){case 2:return function(f){return this.fromWireType(ut[f>>2])};case 3:return function(f){return this.fromWireType(Rn[f>>3])};default:throw new TypeError("Unknown float type: "+s)}}function kc(s,u,f){var p=Bn(f);u=Qe(u),Pt(s,{name:u,fromWireType:function(m){return m},toWireType:function(m,b){return b},argPackAdvance:8,readValueFromPointer:Pc(u,p),destructorFunction:null})}function Ac(s,u,f){switch(u){case 0:return f?function(m){return ge[m]}:function(m){return Oe[m]};case 1:return f?function(m){return Ae[m>>1]}:function(m){return ot[m>>1]};case 2:return f?function(m){return B[m>>2]}:function(m){return se[m>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function Rc(s,u,f,p,m){u=Qe(u);var b=Bn(f),_=I=>I;if(p===0){var S=32-8*f;_=I=>I<<S>>>S}var x=u.includes("unsigned"),A=(I,L)=>{},U;x?U=function(I,L){return A(L,this.name),L>>>0}:U=function(I,L){return A(L,this.name),L},Pt(s,{name:u,fromWireType:_,toWireType:U,argPackAdvance:8,readValueFromPointer:Ac(u,b,p!==0),destructorFunction:null})}function Oc(s,u,f){var p=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],m=p[u];function b(_){_=_>>2;var S=se,x=S[_],A=S[_+1];return new m(at,A,x)}f=Qe(f),Pt(s,{name:f,fromWireType:b,argPackAdvance:8,readValueFromPointer:b},{ignoreDuplicateRegistrations:!0})}function Mc(s,u){u=Qe(u);var f=u==="std::string";Pt(s,{name:u,fromWireType:function(p){var m=se[p>>2],b;if(f)for(var _=p+4,S=0;S<=m;++S){var x=p+4+S;if(S==m||Oe[x]==0){var A=x-_,U=ne(_,A);b===void 0?b=U:(b+=String.fromCharCode(0),b+=U),_=x+1}}else{for(var I=new Array(m),S=0;S<m;++S)I[S]=String.fromCharCode(Oe[p+4+S]);b=I.join("")}return It(p),b},toWireType:function(p,m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));var b,_=typeof m=="string";_||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int8Array||_e("Cannot pass non-string to std::string"),f&&_?b=()=>J(m):b=()=>m.length;var S=b(),x=Ut(4+S+1);if(se[x>>2]=S,f&&_)me(m,x+4,S+1);else if(_)for(var A=0;A<S;++A){var U=m.charCodeAt(A);U>255&&(It(x),_e("String has UTF-16 code units that do not fit in 8 bits")),Oe[x+4+A]=U}else for(var A=0;A<S;++A)Oe[x+4+A]=m[A];return p!==null&&p.push(It,x),x},argPackAdvance:8,readValueFromPointer:Hn,destructorFunction:function(p){It(p)}})}function Dc(s,u,f){f=Qe(f);var p,m,b,_,S;u===2?(p=ce,m=ke,_=ve,b=()=>ot,S=1):u===4&&(p=De,m=mt,_=qe,b=()=>se,S=2),Pt(s,{name:f,fromWireType:function(x){for(var A=se[x>>2],U=b(),I,L=x+4,V=0;V<=A;++V){var j=x+4+V*u;if(V==A||U[j>>S]==0){var Se=j-L,Ue=p(L,Se);I===void 0?I=Ue:(I+=String.fromCharCode(0),I+=Ue),L=j+u}}return It(x),I},toWireType:function(x,A){typeof A!="string"&&_e("Cannot pass non-string to C++ string type "+f);var U=_(A),I=Ut(4+U+u);return se[I>>2]=U>>S,m(A,I+4,U+u),x!==null&&x.push(It,I),I},argPackAdvance:8,readValueFromPointer:Hn,destructorFunction:function(x){It(x)}})}function Fc(s,u){u=Qe(u),Pt(s,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:function(){},toWireType:function(f,p){}})}function Lc(){return Date.now()}var Bc=!0;function Uc(){return Bc}function Ic(s,u,f){s=He.toValue(s),u=zn(u,"emval::as");var p=[],m=He.toHandle(p);return B[f>>2]=m,u.toWireType(p,s)}function Gc(s){var u=[];return B[s>>2]=He.toHandle(u),u}var Nc={};function Qo(s){var u=Nc[s];return u===void 0?Qe(s):u}var Jo=[];function Vc(s,u,f,p,m){return s=Jo[s],u=He.toValue(u),f=Qo(f),s(u,f,Gc(p),m)}function vs(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Hc(s){return s===0?He.toHandle(vs()):(s=Qo(s),He.toHandle(vs()[s]))}function Wc(s){var u=Jo.length;return Jo.push(s),u}function zc(s,u){for(var f=new Array(s),p=0;p<s;++p)f[p]=zn(se[u+p*Z>>2],"parameter "+p);return f}var gs=[];function $c(s,u){var f=zc(s,u),p=f[0],m=p.name+"_$"+f.slice(1).map(function(j){return j.name}).join("_")+"$",b=gs[m];if(b!==void 0)return b;for(var _=["retType"],S=[p],x="",A=0;A<s-1;++A)x+=(A!==0?", ":"")+"arg"+A,_.push("argType"+A),S.push(f[1+A]);for(var U=In("methodCaller_"+m),I="return function "+U+`(handle, name, destructors, args) {
`,L=0,A=0;A<s-1;++A)I+="    var arg"+A+" = argType"+A+".readValueFromPointer(args"+(L?"+"+L:"")+`);
`,L+=f[A+1].argPackAdvance;I+="    var rv = handle[name]("+x+`);
`;for(var A=0;A<s-1;++A)f[A+1].deleteObject&&(I+="    argType"+A+".deleteObject(arg"+A+`);
`);p.isVoid||(I+=`    return retType.toWireType(destructors, rv);
`),I+=`};
`,_.push(I);var V=ps(Function,_).apply(null,S);return b=Wc(V),gs[m]=b,b}function Xc(s,u){return s=He.toValue(s),u=He.toValue(u),He.toHandle(s[u])}function Yc(s){s>4&&(yt[s].refcount+=1)}function jc(s){return He.toHandle(Qo(s))}function qc(s){var u=He.toValue(s);ds(u),Zo(s)}function Zc(s,u,f){s=He.toValue(s),u=He.toValue(u),f=He.toValue(f),s[u]=f}function Kc(s,u){s=zn(s,"_emval_take_value");var f=s.readValueFromPointer(u);return He.toHandle(f)}function Qc(s){return s=He.toValue(s),He.toHandle(typeof s)}function Jc(s,u){var f=new Date(B[s>>2]*1e3);B[u>>2]=f.getSeconds(),B[u+4>>2]=f.getMinutes(),B[u+8>>2]=f.getHours(),B[u+12>>2]=f.getDate(),B[u+16>>2]=f.getMonth(),B[u+20>>2]=f.getFullYear()-1900,B[u+24>>2]=f.getDay();var p=new Date(f.getFullYear(),0,1),m=(f.getTime()-p.getTime())/(1e3*60*60*24)|0;B[u+28>>2]=m,B[u+36>>2]=-(f.getTimezoneOffset()*60);var b=new Date(f.getFullYear(),6,1).getTimezoneOffset(),_=p.getTimezoneOffset(),S=(b!=_&&f.getTimezoneOffset()==Math.min(_,b))|0;B[u+32>>2]=S}function ef(s,u,f,p,m,b){try{var _=y.getStream(m);_&&(f&2&&be.doMsync(s,_,u,p,b),y.munmap(_))}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function tf(s,u,f){var p=new Date().getFullYear(),m=new Date(p,0,1),b=new Date(p,6,1),_=m.getTimezoneOffset(),S=b.getTimezoneOffset(),x=Math.max(_,S);B[s>>2]=x*60,B[u>>2]=Number(_!=S);function A(j){var Se=j.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Se?Se[1]:"GMT"}var U=A(m),I=A(b),L=Xe(U),V=Xe(I);S<_?(se[f>>2]=L,se[f+4>>2]=V):(se[f>>2]=V,se[f+4>>2]=L)}function ei(s,u,f){ei.called||(ei.called=!0,tf(s,u,f))}function rf(){qt("")}function ms(){return 2147483648}function nf(){return ms()}function of(s,u,f){Oe.copyWithin(s,u,u+f)}function sf(s){try{return re.grow(s-at.byteLength+65535>>>16),On(re.buffer),1}catch{}}function af(s){var u=Oe.length;s=s>>>0;var f=ms();if(s>f)return!1;let p=(x,A)=>x+(A-x%A)%A;for(var m=1;m<=4;m*=2){var b=u*(1+.2/m);b=Math.min(b,s+100663296);var _=Math.min(f,p(Math.max(s,b),65536)),S=sf(_);if(S)return!0}return!1}var ti={};function uf(){return a||"./this.program"}function Kr(){if(!Kr.strings){var s=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:s,_:uf()};for(var f in ti)ti[f]===void 0?delete u[f]:u[f]=ti[f];var p=[];for(var f in u)p.push(f+"="+u[f]);Kr.strings=p}return Kr.strings}function lf(s,u){var f=0;return Kr().forEach(function(p,m){var b=u+f;se[s+m*4>>2]=b,jt(p,b),f+=p.length+1}),0}function cf(s,u){var f=Kr();se[s>>2]=f.length;var p=0;return f.forEach(function(m){p+=m.length+1}),se[u>>2]=p,0}function ff(s){zf(s)}function hf(s){try{var u=be.getStreamFromFD(s);return y.close(u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return f.errno}}function pf(s,u,f,p){for(var m=0,b=0;b<f;b++){var _=se[u>>2],S=se[u+4>>2];u+=8;var x=y.read(s,ge,_,S,p);if(x<0)return-1;if(m+=x,x<S)break}return m}function df(s,u,f,p){try{var m=be.getStreamFromFD(s),b=pf(m,u,f);return B[p>>2]=b,0}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return _.errno}}function vf(s,u){return u+2097152>>>0<4194305-!!s?(s>>>0)+u*4294967296:NaN}function gf(s,u,f,p,m){try{var b=vf(u,f);if(isNaN(b))return 61;var _=be.getStreamFromFD(s);return y.llseek(_,b,p),Dt=[_.position>>>0,(Ye=_.position,+Math.abs(Ye)>=1?Ye>0?(Math.min(+Math.floor(Ye/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ye-+(~~Ye>>>0))/4294967296)>>>0:0)],B[m>>2]=Dt[0],B[m+4>>2]=Dt[1],_.getdents&&b===0&&p===0&&(_.getdents=null),0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return S.errno}}function mf(s,u,f,p){for(var m=0,b=0;b<f;b++){var _=se[u>>2],S=se[u+4>>2];u+=8;var x=y.write(s,ge,_,S,p);if(x<0)return-1;m+=x}return m}function yf(s,u,f,p){try{var m=be.getStreamFromFD(s),b=mf(m,u,f);return se[p>>2]=b,0}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return _.errno}}function ys(s){for(var u=s.split("."),f=0;f<4;f++){var p=Number(u[f]);if(isNaN(p))return null;u[f]=p}return(u[0]|u[1]<<8|u[2]<<16|u[3]<<24)>>>0}function Qr(s){return parseInt(s)}function wf(s){var u,f,p,m,b=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,_=[];if(!b.test(s))return null;if(s==="::")return[0,0,0,0,0,0,0,0];for(s.startsWith("::")?s=s.replace("::","Z:"):s=s.replace("::",":Z:"),s.indexOf(".")>0?(s=s.replace(new RegExp("[.]","g"),":"),u=s.split(":"),u[u.length-4]=Qr(u[u.length-4])+Qr(u[u.length-3])*256,u[u.length-3]=Qr(u[u.length-2])+Qr(u[u.length-1])*256,u=u.slice(0,u.length-2)):u=s.split(":"),p=0,m=0,f=0;f<u.length;f++)if(typeof u[f]=="string")if(u[f]==="Z"){for(m=0;m<8-u.length+1;m++)_[f+m]=0;p=m-1}else _[f+p]=xs(parseInt(u[f],16));else _[f+p]=u[f];return[_[1]<<16|_[0],_[3]<<16|_[2],_[5]<<16|_[4],_[7]<<16|_[6]]}var Kt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(s){var u=ys(s);if(u!==null||(u=wf(s),u!==null))return s;var f;if(Kt.address_map.addrs[s])f=Kt.address_map.addrs[s];else{var p=Kt.address_map.id++;de(p<65535,"exceeded max address mappings of 65535"),f="172.29."+(p&255)+"."+(p&65280),Kt.address_map.names[f]=s,Kt.address_map.addrs[s]=f}return f},lookup_addr:function(s){return Kt.address_map.names[s]?Kt.address_map.names[s]:null}};function bf(s){var u=Ut(20),f=Ut(s.length+1);me(s,f,s.length+1),se[u>>2]=f;var p=Ut(4);se[p>>2]=0,se[u+4>>2]=p;var m=2;B[u+8>>2]=m,B[u+12>>2]=4;var b=Ut(12);return se[b>>2]=b+8,se[b+4>>2]=0,B[b+8>>2]=ys(Kt.lookup_name(s)),se[u+16>>2]=b,u}function _f(s){return bf(ne(s))}function Sf(s){var u=s.getExtension("ANGLE_instanced_arrays");if(u)return s.vertexAttribDivisor=function(f,p){u.vertexAttribDivisorANGLE(f,p)},s.drawArraysInstanced=function(f,p,m,b){u.drawArraysInstancedANGLE(f,p,m,b)},s.drawElementsInstanced=function(f,p,m,b,_){u.drawElementsInstancedANGLE(f,p,m,b,_)},1}function Ef(s){var u=s.getExtension("OES_vertex_array_object");if(u)return s.createVertexArray=function(){return u.createVertexArrayOES()},s.deleteVertexArray=function(f){u.deleteVertexArrayOES(f)},s.bindVertexArray=function(f){u.bindVertexArrayOES(f)},s.isVertexArray=function(f){return u.isVertexArrayOES(f)},1}function Tf(s){var u=s.getExtension("WEBGL_draw_buffers");if(u)return s.drawBuffers=function(f,p){u.drawBuffersWEBGL(f,p)},1}function xf(s){return!!(s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw"))}var Fe={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(u){Fe.lastError||(Fe.lastError=u)},getNewId:function(s){for(var u=Fe.counter++,f=s.length;f<u;f++)s[f]=null;return u},getSource:function(s,u,f,p){for(var m="",b=0;b<u;++b){var _=p?B[p+b*4>>2]:-1;m+=ne(B[f+b*4>>2],_<0?void 0:_)}return m},createContext:function(s,u){if(!s.getContextSafariWebGL2Fixed){let b=function(_,S){var x=s.getContextSafariWebGL2Fixed(_,S);return _=="webgl"==x instanceof WebGLRenderingContext?x:null};var m=b;s.getContextSafariWebGL2Fixed=s.getContext,s.getContext=b}var f=s.getContext("webgl",u);if(!f)return 0;var p=Fe.registerContext(f,u);return p},registerContext:function(s,u){var f=Fe.getNewId(Fe.contexts),p={handle:f,attributes:u,version:u.majorVersion,GLctx:s};return s.canvas&&(s.canvas.GLctxObject=p),Fe.contexts[f]=p,(typeof u.enableExtensionsByDefault>"u"||u.enableExtensionsByDefault)&&Fe.initExtensions(p),f},makeContextCurrent:function(s){return Fe.currentContext=Fe.contexts[s],r.ctx=tt=Fe.currentContext&&Fe.currentContext.GLctx,!(s&&!tt)},getContext:function(s){return Fe.contexts[s]},deleteContext:function(s){Fe.currentContext===Fe.contexts[s]&&(Fe.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(Fe.contexts[s].GLctx.canvas),Fe.contexts[s]&&Fe.contexts[s].GLctx.canvas&&(Fe.contexts[s].GLctx.canvas.GLctxObject=void 0),Fe.contexts[s]=null},initExtensions:function(s){if(s||(s=Fe.currentContext),!s.initExtensionsDone){s.initExtensionsDone=!0;var u=s.GLctx;Sf(u),Ef(u),Tf(u),u.disjointTimerQueryExt=u.getExtension("EXT_disjoint_timer_query"),xf(u);var f=u.getSupportedExtensions()||[];f.forEach(function(p){!p.includes("lose_context")&&!p.includes("debug")&&u.getExtension(p)})}}};function ws(s){return s.slice(-1)=="]"&&s.lastIndexOf("[")}function Cf(s){var u=s.uniformLocsById,f=s.uniformSizeAndIdsByName,p,m;if(!u)for(s.uniformLocsById=u={},s.uniformArrayNamesById={},p=0;p<tt.getProgramParameter(s,35718);++p){var b=tt.getActiveUniform(s,p),_=b.name,S=b.size,x=ws(_),A=x>0?_.slice(0,x):_,U=s.uniformIdCounter;for(s.uniformIdCounter+=S,f[A]=[S,U],m=0;m<S;++m)u[U]=m,s.uniformArrayNamesById[U++]=A}}function Pf(s,u){if(u=ne(u),s=Fe.programs[s]){Cf(s);var f=s.uniformLocsById,p=0,m=u,b=ws(u);b>0&&(p=Qr(u.slice(b+1))>>>0,m=u.slice(0,b));var _=s.uniformSizeAndIdsByName[m];if(_&&p<_[0]&&(p+=_[1],f[p]=f[p]||tt.getUniformLocation(s,u)))return p}else Fe.recordError(1281);return-1}function Qt(s){var u=tt.currentProgram;if(u){var f=u.uniformLocsById[s];return typeof f=="number"&&(u.uniformLocsById[s]=f=tt.getUniformLocation(u,u.uniformArrayNamesById[s]+(f>0?"["+f+"]":""))),f}else Fe.recordError(1282)}function kf(s,u){tt.uniform1f(Qt(s),u)}function Af(s,u){tt.uniform1i(Qt(s),u)}var $n=[];function Rf(s,u,f){if(u<=144)for(var p=$n[2*u-1],m=0;m<2*u;m+=2)p[m]=ut[f+4*m>>2],p[m+1]=ut[f+(4*m+4)>>2];else var p=ut.subarray(f>>2,f+u*8>>2);tt.uniform2fv(Qt(s),p)}var Xn=[];function Of(s,u,f){if(u<=144)for(var p=Xn[2*u-1],m=0;m<2*u;m+=2)p[m]=B[f+4*m>>2],p[m+1]=B[f+(4*m+4)>>2];else var p=B.subarray(f>>2,f+u*8>>2);tt.uniform2iv(Qt(s),p)}function Mf(s,u,f){if(u<=96)for(var p=$n[3*u-1],m=0;m<3*u;m+=3)p[m]=ut[f+4*m>>2],p[m+1]=ut[f+(4*m+4)>>2],p[m+2]=ut[f+(4*m+8)>>2];else var p=ut.subarray(f>>2,f+u*12>>2);tt.uniform3fv(Qt(s),p)}function Df(s,u,f){if(u<=96)for(var p=Xn[3*u-1],m=0;m<3*u;m+=3)p[m]=B[f+4*m>>2],p[m+1]=B[f+(4*m+4)>>2],p[m+2]=B[f+(4*m+8)>>2];else var p=B.subarray(f>>2,f+u*12>>2);tt.uniform3iv(Qt(s),p)}function Ff(s,u,f){if(u<=72){var p=$n[4*u-1],m=ut;f>>=2;for(var b=0;b<4*u;b+=4){var _=f+b;p[b]=m[_],p[b+1]=m[_+1],p[b+2]=m[_+2],p[b+3]=m[_+3]}}else var p=ut.subarray(f>>2,f+u*16>>2);tt.uniform4fv(Qt(s),p)}function Lf(s,u,f){if(u<=72)for(var p=Xn[4*u-1],m=0;m<4*u;m+=4)p[m]=B[f+4*m>>2],p[m+1]=B[f+(4*m+4)>>2],p[m+2]=B[f+(4*m+8)>>2],p[m+3]=B[f+(4*m+12)>>2];else var p=B.subarray(f>>2,f+u*16>>2);tt.uniform4iv(Qt(s),p)}function Bf(s){}function Yn(s){return s%4===0&&(s%100!==0||s%400===0)}function Uf(s,u){for(var f=0,p=0;p<=u;f+=s[p++]);return f}var bs=[31,29,31,30,31,30,31,31,30,31,30,31],_s=[31,28,31,30,31,30,31,31,30,31,30,31];function If(s,u){for(var f=new Date(s.getTime());u>0;){var p=Yn(f.getFullYear()),m=f.getMonth(),b=(p?bs:_s)[m];if(u>b-f.getDate())u-=b-f.getDate()+1,f.setDate(1),m<11?f.setMonth(m+1):(f.setMonth(0),f.setFullYear(f.getFullYear()+1));else return f.setDate(f.getDate()+u),f}return f}function Gf(s,u,f,p){var m=B[p+40>>2],b={tm_sec:B[p>>2],tm_min:B[p+4>>2],tm_hour:B[p+8>>2],tm_mday:B[p+12>>2],tm_mon:B[p+16>>2],tm_year:B[p+20>>2],tm_wday:B[p+24>>2],tm_yday:B[p+28>>2],tm_isdst:B[p+32>>2],tm_gmtoff:B[p+36>>2],tm_zone:m?ne(m):""},_=ne(f),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var x in S)_=_.replace(new RegExp(x,"g"),S[x]);var A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],U=["January","February","March","April","May","June","July","August","September","October","November","December"];function I(F,X,We){for(var Pe=typeof F=="number"?F.toString():F||"";Pe.length<X;)Pe=We[0]+Pe;return Pe}function L(F,X){return I(F,X,"0")}function V(F,X){function We(st){return st<0?-1:st>0?1:0}var Pe;return(Pe=We(F.getFullYear()-X.getFullYear()))===0&&(Pe=We(F.getMonth()-X.getMonth()))===0&&(Pe=We(F.getDate()-X.getDate())),Pe}function j(F){switch(F.getDay()){case 0:return new Date(F.getFullYear()-1,11,29);case 1:return F;case 2:return new Date(F.getFullYear(),0,3);case 3:return new Date(F.getFullYear(),0,2);case 4:return new Date(F.getFullYear(),0,1);case 5:return new Date(F.getFullYear()-1,11,31);case 6:return new Date(F.getFullYear()-1,11,30)}}function Se(F){var X=If(new Date(F.tm_year+1900,0,1),F.tm_yday),We=new Date(X.getFullYear(),0,4),Pe=new Date(X.getFullYear()+1,0,4),st=j(We),Ne=j(Pe);return V(st,X)<=0?V(Ne,X)<=0?X.getFullYear()+1:X.getFullYear():X.getFullYear()-1}var Ue={"%a":function(F){return A[F.tm_wday].substring(0,3)},"%A":function(F){return A[F.tm_wday]},"%b":function(F){return U[F.tm_mon].substring(0,3)},"%B":function(F){return U[F.tm_mon]},"%C":function(F){var X=F.tm_year+1900;return L(X/100|0,2)},"%d":function(F){return L(F.tm_mday,2)},"%e":function(F){return I(F.tm_mday,2," ")},"%g":function(F){return Se(F).toString().substring(2)},"%G":function(F){return Se(F)},"%H":function(F){return L(F.tm_hour,2)},"%I":function(F){var X=F.tm_hour;return X==0?X=12:X>12&&(X-=12),L(X,2)},"%j":function(F){return L(F.tm_mday+Uf(Yn(F.tm_year+1900)?bs:_s,F.tm_mon-1),3)},"%m":function(F){return L(F.tm_mon+1,2)},"%M":function(F){return L(F.tm_min,2)},"%n":function(){return`
`},"%p":function(F){return F.tm_hour>=0&&F.tm_hour<12?"AM":"PM"},"%S":function(F){return L(F.tm_sec,2)},"%t":function(){return"	"},"%u":function(F){return F.tm_wday||7},"%U":function(F){var X=F.tm_yday+7-F.tm_wday;return L(Math.floor(X/7),2)},"%V":function(F){var X=Math.floor((F.tm_yday+7-(F.tm_wday+6)%7)/7);if((F.tm_wday+371-F.tm_yday-2)%7<=2&&X++,X){if(X==53){var Pe=(F.tm_wday+371-F.tm_yday)%7;Pe!=4&&(Pe!=3||!Yn(F.tm_year))&&(X=1)}}else{X=52;var We=(F.tm_wday+7-F.tm_yday-1)%7;(We==4||We==5&&Yn(F.tm_year%400-1))&&X++}return L(X,2)},"%w":function(F){return F.tm_wday},"%W":function(F){var X=F.tm_yday+7-(F.tm_wday+6)%7;return L(Math.floor(X/7),2)},"%y":function(F){return(F.tm_year+1900).toString().substring(2)},"%Y":function(F){return F.tm_year+1900},"%z":function(F){var X=F.tm_gmtoff,We=X>=0;return X=Math.abs(X)/60,X=X/60*100+X%60,(We?"+":"-")+String("0000"+X).slice(-4)},"%Z":function(F){return F.tm_zone},"%%":function(){return"%"}};_=_.replace(/%%/g,"\0\0");for(var x in Ue)_.includes(x)&&(_=_.replace(new RegExp(x,"g"),Ue[x](b)));_=_.replace(/\0\0/g,"%");var Ge=Zn(_,!1);return Ge.length>u?0:(nt(Ge,s),Ge.length-1)}function Nf(s,u,f,p){return Gf(s,u,f,p)}var Ss=function(s,u,f,p){s||(s=this),this.parent=s,this.mount=s.mount,this.mounted=null,this.id=y.nextInode++,this.name=u,this.mode=f,this.node_ops={},this.stream_ops={},this.rdev=p},jn=365,qn=146;Object.defineProperties(Ss.prototype,{read:{get:function(){return(this.mode&jn)===jn},set:function(s){s?this.mode|=jn:this.mode&=~jn}},write:{get:function(){return(this.mode&qn)===qn},set:function(s){s?this.mode|=qn:this.mode&=~qn}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=Ss,y.staticInit(),Gl(),Ar=r.BindingError=Vo(Error,"BindingError"),is=r.InternalError=Vo(Error,"InternalError"),nc(),ql(),fc(),fs=r.UnboundTypeError=Vo(Error,"UnboundTypeError"),Sc();for(var tt,Vf=new Float32Array(288),Bt=0;Bt<288;++Bt)$n[Bt]=Vf.subarray(0,Bt+1);for(var Hf=new Int32Array(288),Bt=0;Bt<288;++Bt)Xn[Bt]=Hf.subarray(0,Bt+1);function Zn(s,u,f){var p=f>0?f:J(s)+1,m=new Array(p),b=pe(s,m,0,m.length);return u&&(m.length=b),m}var Wf={ga:wl,k:bl,b:_l,c:El,Q:kl,R:Al,q:Ol,K:Ml,U:Dl,I:Fl,H:Ll,u:Bl,J:Ul,z:Il,W:Hl,d:gc,f:mc,e:yc,a:wc,V:Ec,g:xc,h:Cc,v:kc,j:Rc,i:Oc,w:Mc,r:Dc,X:Fc,N:Lc,M:Uc,m:Ic,ka:Vc,x:Zo,la:Hc,ja:$c,s:Xc,E:Yc,ia:jc,ma:qc,n:Zc,l:Kc,na:Qc,O:Jc,D:ef,P:ei,t:rf,C:nf,L:of,o:af,F:lf,G:cf,fa:ff,p:hf,T:df,y:gf,S:yf,ha:_f,ea:Pf,ca:kf,da:Af,_:Rf,ba:Of,Z:Mf,aa:Df,Y:Ff,$:Lf,A:Bf,B:Nf};yl(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Ut=r._malloc=function(){return(Ut=r._malloc=r.asm.qa).apply(null,arguments)},It=r._free=function(){return(It=r._free=r.asm.ra).apply(null,arguments)},Es=r.___errno_location=function(){return(Es=r.___errno_location=r.asm.sa).apply(null,arguments)},Ts=r.___getTypeName=function(){return(Ts=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var xs=r._htons=function(){return(xs=r._htons=r.asm.wa).apply(null,arguments)},Cs=r._emscripten_builtin_memalign=function(){return(Cs=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},Ps=r.___cxa_is_pointer_type=function(){return(Ps=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=y;var Kn;function ri(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}Xr=function s(){Kn||ni(),Kn||(Xr=s)};function ni(s){if(fr>0||(cl(),fr>0))return;function u(){Kn||(Kn=!0,r.calledRun=!0,!he&&(fl(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),hl()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),u()},1)):u()}r.run=ni;function zf(s,u){$f(s)}function $f(s){Pr()||(r.onExit&&r.onExit(s),he=!0),l(s,new ri(s))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return ni(),r.ready}})(),jf="/cad-os/assets/replicad_single-b4564eab.wasm";const wi={library:null},qf=t=>{wi.library=t},G=()=>{if(!wi.library)throw new Error("oppencascade has not been loaded");return wi.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const tn=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class ft{constructor(e){this.oc=G(),e&&tn.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(tn.unregister(this._wrapped),this._wrapped.delete()),tn.register(this,e,e),this._wrapped=e}delete(){var e;tn.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const Re=()=>{function t(e){return tn.register(t,e),e}return t},ze=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},Na=2147483647,bt=Math.PI/180,on=180/Math.PI,oi=t=>Math.round(t*1e3)/1e3,fn=(t,e,r)=>{const n=G(),o=ct(t),i=zt(e);let a;if(r){const l=zt(r);a=new n.gp_Ax3_3(o,i,l),l.delete()}else a=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),a},yn=(t,e,r)=>{const n=G(),o=ct(t),i=zt(e);let a;if(r){const l=zt(r);a=new n.gp_Ax2_2(o,i,l),l.delete()}else a=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),a},sn=(t,e)=>{const r=G(),n=ct(t),o=zt(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},Zf=(t=[0,0,0])=>{const e=G();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof M)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class M extends ft{constructor(e=[0,0,0]){super(Zf(e))}get repr(){return`x: ${oi(this.x)}, y: ${oi(this.y)}, z: ${oi(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new M(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new M(this.wrapped.Subtracted(e.wrapped))}add(e){return new M(this.wrapped.Added(e.wrapped))}multiply(e){return new M(this.wrapped.Multiplied(e))}normalized(){return new M(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*on}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),a=this.sub(i);return o.delete(),i.delete(),a}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=sn(r,n);return this.wrapped.Rotate(o,e*bt),o.delete(),this}}const Kf={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function Qf(t){return t==="X"||t==="Y"||t==="Z"?Kf[t]:t}function ct(t){const e=new M(t),r=e.toPnt();return e.delete(),r}function zt(t){const e=new M(t),r=e.toDir();return e.delete(),r}class Sr extends ft{constructor(e){const r=G();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new M(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=zt(n),i=ct(r),a=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(a,e*bt),a.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=Re();let o,i;if(typeof e=="string"){const l=n(Va(e,r));o=l.origin,i=l.zDir}else e instanceof rt?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const a=n(yn(o,i));return this.wrapped.SetMirror_3(a),this}scale(e,r){const n=ct(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=Re(),o=n(e==="reference"?new this.oc.gp_Ax3_1:fn(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:fn(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=ct(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class rt{constructor(e,r=null,n=[0,0,1]){this.oc=G();const o=new M(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new M(r);else{const a=fn(e,o);i=new M(a.XDirection()),a.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new M(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new rt(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new M(e),r}translate(e,r=0,n=0){const o=new M(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=Qf(r),o=new M(this.zDir).rotate(e,[0,0,0],n),i=new M(this.xDir).rotate(e,[0,0,0],n);return new rt(this.origin,i,o)}rotate2DAxes(e){const r=new M(this.xDir).rotate(e,[0,0,0],this.zDir);return new rt(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=fn(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new Sr,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new Sr,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new M(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new M(r);return r.delete(),n}}const Jf={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},Va=(t,e=[0,0,0])=>{const r=Jf[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new rt(n,r.xDir,r.normal)};let eh=class extends ft{constructor(e){const r=G();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new M(e).repr} - ${new M(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},a={current:0};return this.wrapped.Get(e,r,n,o,i,a),[[e.current,r.current,n.current],[o.current,i.current,a.current]]}get center(){const[[e,r,n],[o,i,a]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(a-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function ar(t="XY",e=[0,0,0]){return t instanceof rt?t.clone():Va(t,e)}function th(t,e,r=[0,0,0],n=[0,0,1]){const o=new Sr;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function rh(t,e){const r=new Sr;r.translate(e);const n=r.transform(t);return r.delete(),n}function nh(t,e,r){const n=new Sr;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function oh(t,e,r){const n=new Sr;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function po(t){return Array.isArray(t)&&t.length===2}let Qn=null;const ks=t=>{if(Qn&&!t)return Qn;const r=G().GeomAbs_CurveType;return Qn=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),Qn},wn=t=>{let e=ks().get(t);if(e||(e=ks(!0).get(t)),!e)throw new Error("unknown type");return e};function ih(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function sh(t){return Array.from(Array(t).keys())}function Lr(t){const e=Math.min(...t.map(r=>r.length));return sh(e).map(r=>t.map(n=>n[r]))}function vo(t){return Math.round(t*100)/100}const an=([t,e])=>`(${vo(t)},${vo(e)})`,As=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Ha=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${As(r,e)},${As(n,e)}]`,[r,n]])).values()),Ke=([t,e])=>{const r=G();return new r.gp_Pnt2d_3(t,e)},ah=([t,e])=>{const r=G();return new r.gp_Dir2d_4(t,e)},Wa=([t,e])=>{const r=G();return new r.gp_Vec2d_4(t,e)},Ir=(t,e)=>{const r=G(),[n,o]=ze(),i=new r.gp_Ax2d_2(n(Ke(t)),n(ah(e)));return o(),i};class bn extends ft{constructor(e){const r=G();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${an(e)} - ${an(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=Re()(Ke(e));return!this.wrapped.IsOut_1(n)}}const et=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,Gr=([t,e],[r,n])=>[t+r,e+n],Bi=([t,e],[r,n])=>[t-r,e-n],bi=([t,e],r)=>[t*r,e*r],At=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),uh=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function lh([t,e],[r,n]){return t*n-e*r}const ch=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),fh=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),rr=([t,e])=>{const r=At([t,e]);return[t/r,e/r]},hh=(t,e,r=[0,0])=>{const[n,o]=t,[i,a]=r,l=n-i,c=o-a,h=Math.sin(e),d=Math.cos(e),g=l*d-c*h,v=l*h+c*d;return[g+i,v+a]},Dr=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},ph=([t,e])=>{const r=At([t,e]),n=Math.atan2(e,t);return[r,n]};class Ie extends ft{constructor(e){const r=G(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=G(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new bn(r),this._boundingBox}get repr(){return`${this.geomType} ${an(this.firstPoint)} - ${an(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=G();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=wn(e.GetType());return e.delete(),r}clone(){return new Ie(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=G(),n=Re(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(Ke(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,At(e,this.firstPoint),At(e,this.lastPoint))}distanceFromCurve(e){const r=G(),n=Re();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return po(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=G(),o=Re();let i,a;try{const l=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(Ke(e)),this.wrapped));i=l.LowerDistance(),a=l.LowerDistanceParameter()}catch{if(et(e,this.firstPoint,r))return this.firstParameter;if(et(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${an(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return a}tangentAt(e){const r=G(),[n,o]=ze();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const a=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,a,l);const c=[l.X(),l.Y()];return o(),c}splitAt(e,r=1e-9){const n=G(),o=Re();let i=e.map(c=>po(c)?this.parameter(c,r):c);i=Array.from(new Map(i.map(c=>[ih(c,-Math.log10(r)),c])).values()).sort((c,h)=>c-h);const a=this.firstParameter,l=this.lastParameter;return a>l&&i.reverse(),Math.abs(i[0]-a)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-l)<r*100&&(i=i.slice(0,-1)),i.length?Lr([[a,...i],[...i,l]]).map(([c,h])=>{try{if(this.geomType==="BEZIER_CURVE"){const g=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return g.Segment(c,h),new Ie(new n.Handle_Geom2d_Curve_2(g))}if(this.geomType==="BSPLINE_CURVE"){const g=o(this.adaptor()).BSpline().get(),v=new n.Geom2d_BSplineCurve_1(g.Poles_2(),g.Knots_2(),g.Multiplicities_2(),g.Degree(),g.IsPeriodic());return v.Segment(c,h,r),new Ie(new n.Handle_Geom2d_Curve_2(v))}const d=new n.Geom2d_TrimmedCurve(this.wrapped,c,h,!0,!0);return new Ie(new n.Handle_Geom2d_Curve_2(d))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const za=(t,e=1e-4,r="C0",n=200)=>{const o=G(),i=Re(),a={C0:o.GeomAbs_Shape.GeomAbs_C0,C1:o.GeomAbs_Shape.GeomAbs_C1,C2:o.GeomAbs_Shape.GeomAbs_C2,C3:o.GeomAbs_Shape.GeomAbs_C3},l=i(new o.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,a[r],n,3));return new Ie(l.Curve())},Rs=t=>{if(wn(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=G(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const a=n.NbArcs();if(a)for(let l=1;l<=a;l++){const c=n.Arc(l);yield new Ie(c)}}const i=Array.from(o());return n.delete(),i};function go(t,e={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=Re();return t.flatMap(n=>{const o=r(n.adaptor()),i=wn(o.GetType());if(i==="ELLIPSE"||i==="CIRCLE"&&et(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(i))return n;if(i==="BEZIER_CURVE"){const c=o.Bezier().get().Degree();if([1,2,3].includes(c))return n}if(i==="BSPLINE_CURVE"){const l=Rs(o);return go(l,e)}const a=za(o,e.tolerance,e.continuity,e.maxSegments);return go(Rs(r(a.adaptor())),e)})}function*$a(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*dh(t){const e=t.NbSegments();if(!e)return;const r=G();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new Ie(o),i.delete()}}const _n=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=G(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,a;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from($a(o)),a=Array.from(dh(o))}catch(h){throw console.error(t,e,h),new Error("Intersections failed between curves")}finally{o.delete()}const l=a.filter(h=>et(h.firstPoint,h.lastPoint,r)).map(h=>h.firstPoint);l.length&&(i.push(...l),a=a.filter(h=>!et(h.firstPoint,h.lastPoint,r)));const c=a.flatMap(h=>[h.firstPoint,h.lastPoint]);return{intersections:i,commonSegments:a,commonSegmentsPoints:c}},vh=(t,e=1e-9)=>{const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from($a(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},Sn=(t,e)=>{const r=G(),[n,o]=ze(),i=n(new r.GCE2d_MakeSegment_1(n(Ke(t)),n(Ke(e)))).Value(),a=new Ie(i);return et(a.firstPoint,t)||a.reverse(),o(),a},_i=(t,e,r)=>{const n=G(),[o,i]=ze(),a=o(new n.GCE2d_MakeArcOfCircle_4(o(Ke(t)),o(Ke(e)),o(Ke(r)))).Value();i();const l=new Ie(a);return et(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},gh=(t,e,r)=>{const n=G(),[o,i]=ze(),a=o(new n.GCE2d_MakeArcOfCircle_5(o(Ke(t)),o(Wa(e)),o(Ke(r)))).Value();i();const l=new Ie(a);return et(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},mh=(t,e,r,n,o=[0,0],i,a=!0)=>{const l=G(),[c,h]=ze(),d=c(new l.gp_Elips2d_2(c(Ir(o,i)),t,e,!0)),g=c(new l.GCE2d_MakeArcOfEllipse_1(d,r,n,a)).Value();return h(),new Ie(g)},yh=(t,e,r)=>{const n=G(),[o,i]=ze(),a=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));a.SetValue(1,o(Ke(t))),e.forEach((c,h)=>{a.SetValue(h+2,o(Ke(c)))}),a.SetValue(e.length+2,o(Ke(r)));const l=new n.Geom2d_BezierCurve_1(a);return i(),new Ie(new n.Handle_Geom2d_Curve_2(l))},Xa=(t,e,r)=>{const n=bi(Gr(t,e),.5),o=At(r,t),i=rr(Bi(n,r));return _i(t,Gr(bi(i,o),r),e)},wh=(t,e,r)=>{const n=rr(Bi(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:Gr(t,i),lastPoint:Gr(e,i)}},Si=(t,e)=>{const r=Re(),n=t.geomType;if(n==="CIRCLE"){const c=r(r(t.adaptor()).Circle()),h=c.Radius(),d=c.IsDirect()?1:-1,g=e*d,v=h+g;if(v<1e-10){const k=r(c.Location()),D=[k.X(),k.Y()],O=$=>{const[N,Z]=rr(Bi($,D));return Gr($,[g*N,g*Z])};return{collapsed:!0,firstPoint:O(t.firstPoint),lastPoint:O(t.lastPoint)}}const w=G(),E=new w.gp_Circ2d_3(c.Axis(),v),T=new w.Geom2d_Circle_1(E),C=new w.Geom2d_TrimmedCurve(new w.Handle_Geom2d_Curve_2(T),t.firstParameter,t.lastParameter,!0,!0);return new Ie(new w.Handle_Geom2d_Curve_2(C))}if(n==="LINE"){const{firstPoint:c,lastPoint:h}=wh(t.firstPoint,t.lastPoint,e);return Sn(c,h)}const o=G(),i=new Ie(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),a=za(i.adaptor());return vh(a).length?{collapsed:!0,firstPoint:a.firstPoint,lastPoint:a.lastPoint}:a};function Ya(t,e,r){const n=lh(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,a=Si(t,i),l=Si(e,i);if(!(a instanceof Ie)||!(l instanceof Ie))return null;let c;try{const{intersections:w}=_n(a,l,1e-9);c=w.at(-1)}catch{return null}if(!po(c))return null;const h=c,d=(w,E)=>{const[T,C]=E.tangentAt(h),k=rr([-C,T]),D=Gr(h,bi(k,i)),O=w.parameter(D,1e-6);return w.splitAt([O])},[g]=d(t,a),[,v]=d(e,l);return{first:g,second:v,center:h}}function Ei(t,e,r){const n=Ya(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:a}=n;return[o,Xa(o.lastPoint,i.firstPoint,a),i]}function Ti(t,e,r){const n=Ya(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,Sn(o.lastPoint,i.firstPoint),i]}class bh{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let a=(i<<1)+1;const l=a+1;let c=this.ids[a],h=this.values[a];const d=this.values[l];if(l<this.length&&d<h&&(a=l,c=this.ids[l],h=d),h>=n)break;this.ids[i]=c,this.values[i]=h,i=a}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Os=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],ii=3;class Ui{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==ii)throw new Error(`Got v${n>>4} data when expected v${ii}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Ui(i,o,Os[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,a=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),a+=i,this._levelBounds.push(a*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const l=Os.indexOf(this.ArrayType),c=a*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=a*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+c+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(ii<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new bh}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let a=4*i;const l=this._boxes[a++],c=this._boxes[a++],h=this._boxes[a++],d=this._boxes[a++],g=Math.floor(o*((l+h)/2-this.minX)/e),v=Math.floor(o*((c+d)/2-this.minY)/r);n[i]=Sh(g,v)}xi(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,a=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;a<l;){const c=a;let h=1/0,d=1/0,g=-1/0,v=-1/0;for(let w=0;w<this.nodeSize&&a<l;w++)h=Math.min(h,this._boxes[a++]),d=Math.min(d,this._boxes[a++]),g=Math.max(g,this._boxes[a++]),v=Math.max(v,this._boxes[a++]);this._indices[this._pos>>2]=c,this._boxes[this._pos++]=h,this._boxes[this._pos++]=d,this._boxes[this._pos++]=g,this._boxes[this._pos++]=v}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=[],c=[];for(;a!==void 0;){const h=Math.min(a+this.nodeSize*4,Ds(a,this._levelBounds));for(let d=a;d<h;d+=4){if(n<this._boxes[d]||o<this._boxes[d+1]||e>this._boxes[d+2]||r>this._boxes[d+3])continue;const g=this._indices[d>>2]|0;a<this.numItems*4?(i===void 0||i(g))&&c.push(g):l.push(g)}a=l.pop()}return c}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=this._queue,c=[],h=o*o;for(;a!==void 0;){const d=Math.min(a+this.nodeSize*4,Ds(a,this._levelBounds));for(let g=a;g<d;g+=4){const v=this._indices[g>>2]|0,w=Ms(e,this._boxes[g],this._boxes[g+2]),E=Ms(r,this._boxes[g+1],this._boxes[g+3]),T=w*w+E*E;a<this.numItems*4?(i===void 0||i(v))&&l.push((v<<1)+1,T):l.push(v<<1,T)}for(;l.length&&l.peek()&1;)if(l.peekValue()>h||(c.push(l.pop()>>1),c.length===n))return l.clear(),c;a=l.pop()>>1}return l.clear(),c}}function Ms(t,e,r){return t<e?e-t:t<=r?0:t-r}function Ds(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function xi(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const a=t[n+o>>1];let l=n-1,c=o+1;for(;;){do l++;while(t[l]<a);do c--;while(t[c]>a);if(l>=c)break;_h(t,e,r,l,c)}xi(t,e,r,n,c,i),xi(t,e,r,c+1,o,i)}function _h(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const a=4*n,l=4*o,c=e[a],h=e[a+1],d=e[a+2],g=e[a+3];e[a]=e[l],e[a+1]=e[l+1],e[a+2]=e[l+2],e[a+3]=e[l+3],e[l]=c,e[l+1]=h,e[l+2]=d,e[l+3]=g;const v=r[n];r[n]=r[o],r[o]=v}function Sh(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),a=r|n>>1,l=r>>1^r,c=o>>1^n&i>>1^o,h=r&o>>1^i>>1^i;r=a,n=l,o=c,i=h,a=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,c^=r&o>>2^n&i>>2,h^=n&o>>2^(r^n)&i>>2,r=a,n=l,o=c,i=h,a=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,c^=r&o>>4^n&i>>4,h^=n&o>>4^(r^n)&i>>4,r=a,n=l,o=c,i=h,c^=r&o>>8^n&i>>8,h^=n&o>>8^(r^n)&i>>8,r=c^c>>1,n=h^h>>1;let d=t^e,g=n|65535^(d|r);return d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,(g<<1|d)>>>0}const ja=(t,e=1e-7)=>{const r=new Ui(t.length);t.forEach(i=>{const[a,l]=i.firstPoint;r.add(a-e,l-e,a+e,l+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,a)=>{if(o.has(a))return;const l=[i];let c=a;o.add(a);let h=t.length;for(;;){if(h--<0)throw new Error("Infinite loop detected");const d=l[l.length-1].lastPoint,[g,v]=d,w=r.search(g-e,v-e,g+e,v+e),E=D=>Math.abs((c-D)%t.length),T=w.filter(D=>!o.has(D)).map(D=>[t[D],D,E(D)]).sort(([,,D],[,,O])=>E(D)-E(O));if(T.length===0){n.push(l);break}const[C,k]=T[0];l.push(C),o.add(k),c=k}}),n};function wt(t){return Math.round(t*1e5)/1e5}const si=t=>`${vo(t.X())} ${vo(t.Y())}`,Eh=(t,e)=>{const r=G(),n=wn(t.GetType()),[o,i]=e,a=`${wt(o)} ${wt(i)}`;if(n==="LINE")return`L ${a}`;if(n==="BEZIER_CURVE"){const l=t.Bezier().get(),c=l.Degree();if(c===1)return`L ${a}`;if(c===2)return`Q ${si(l.Pole(2))} ${a}`;if(c===3){const h=si(l.Pole(2)),d=si(l.Pole(3));return`C ${h} ${d} ${a}`}}if(n==="CIRCLE"){const l=t.Circle(),c=l.Radius(),h=t.FirstParameter(),g=(t.LastParameter()-h)*on,v=g!==360?a:`${wt(o)} ${wt(i+1e-4)}`;return`A ${c} ${c} 0 ${Math.abs(g)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${v}`}if(n==="ELLIPSE"){const l=t.Ellipse(),c=l.MajorRadius(),h=l.MinorRadius(),d=t.FirstParameter(),v=(t.LastParameter()-d)*on,w=v!==360?a:`${wt(o)} ${wt(i+1e-4)}`,E=new r.gp_Dir2d_1,T=180-l.XAxis().Direction().Angle(E)*on;return E.delete(),`A ${wt(c)} ${wt(h)} ${wt(T)} ${Math.abs(v)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${w}`}throw new Error(`Unsupported curve type: ${n}`)},Th={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},mo={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class qa{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class xh extends ft{constructor(){const e=G();super(new e.Message_ProgressRange_1)}}class ai extends ft{constructor(e){const r=G();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(e.wrapped)}distanceTo(e){this.wrapped.LoadS2(e.wrapped);const r=new xh;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class Za extends qa{when(e){return this.filters.push(e),this}inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new M(Th[e]):n=new M(e);const o=({normal:i})=>{if(!i)return!1;const a=Math.acos(Math.abs(i.dot(n)));return Math.abs(a-bt*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=bo(r),o=new ai(n),i=({element:a})=>Math.abs(o.distanceTo(a)-e)<1e-6;return this.filters.push(i),this}containsPoint(e){return this.atDistance(0,e)}withinDistance(e,r=[0,0,0]){const n=bo(r),o=new ai(n),i=({element:a})=>o.distanceTo(a)-e<1e-6;return this.filters.push(i),this}inBox(e,r){const n=Ce(e,r);return this.inShape(n)}inShape(e){const r=new ai(e),n=({element:o})=>r.distanceTo(o)<1e-6;return this.filters.push(n),this}}class yo extends Za{clone(){const e=new yo;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&mo[e])return this.atAngleWith(mo[e],90);if(typeof e!="string"&&e instanceof rt)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof rt?ar(e):ar(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.startPoint,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class Ii extends Za{clone(){const e=new Ii;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&mo[e])return this.atAngleWith(mo[e]);if(typeof e!="string"&&e instanceof rt)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof rt?ar(e):ar(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.center,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const Ch=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},ui=2*Math.PI,Fs=t=>{const e=t%ui,r=e<0?e+ui:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-ui)};class wo extends qa{clone(){const e=new wo;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>et(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(At(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return et(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,a]=r,l=Math.min(n,i),c=Math.max(n,i),h=Math.min(o,a),d=Math.max(o,a);function g({element:v}){const[w,E]=v.point;return w>=l&&w<=c&&E>=h&&E<=d}return this.filters.push(g),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(Fs(ch(o,i))-Fs(bt*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return Ch(e).filter(r=>this.shouldKeep(r))}}const Ls=t=>{const e=G();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},Ph=function*(e,r){const n=G(),o=new n.TopExp_Explorer_2(e,Ls(r),Ls("shape")),i=new Map;for(;o.More();){const a=o.Current(),l=a.HashCode(Na);i.get(l)||(i.set(l,!0),yield a),o.Next()}o.delete()},Ka=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class Do extends ft{constructor(e){super(e)}clone(){return new this.constructor(Er(this.wrapped))}get hashCode(){return this.wrapped.HashCode(Na)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=G(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=Le(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=Le(rh(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Le(th(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=Le(nh(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=Le(oh(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return Ph(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>Er(r))}get edges(){return this._listTopo("edge").map(e=>new lr(e))}get faces(){return this._listTopo("face").map(e=>new Wr(e))}get wires(){return this._listTopo("wire").map(e=>new Xt(e))}get boundingBox(){const e=new eh;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const a=[];for(const l of this.faces){const c=l.triangulation(o.length/3);if(!c)continue;const{trianglesIndexes:h,vertices:d,verticesNormals:g}=c;a.push({start:n.length,count:h.length,faceId:l.hashCode}),n=n.concat(h),o=o.concat(d),i=i.concat(g)}return{triangles:n,vertices:o,normals:i,faceGroups:a}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=Re(),i=new Set,a=[],l=[],c=()=>{const d=a.length;let g=null;return[v=>{g?(a.push(...g),g=[v.X(),v.Y(),v.Z()],a.push(...g)):g=[v.X(),v.Y(),v.Z()]},v=>{l.push({start:d/3,count:(a.length-d)/3,edgeId:v}),i.add(v)}]},h=o(new this.oc.TopLoc_Location_1);for(const d of this.faces){const g=o(this.oc.BRep_Tool.Triangulation(d.wrapped,h,0));if(g.IsNull())continue;const v=g.get();for(const w of d.edges){if(o(w),i.has(w.hashCode))continue;const E=o(new this.oc.TopLoc_Location_1),T=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(w.wrapped,g,E)),C=(n=T==null?void 0:T.get())==null?void 0:n.Nodes();if(!C)continue;o(C);const[k,D]=c();for(let O=C.Lower();O<=C.Upper();O++){const $=o(o(v.Node(C.Value(O))).Transformed(E.Transformation()));k($)}D(w.hashCode)}}for(const d of this.edges){o(d);const g=d.hashCode;if(i.has(g))continue;const v=o(new this.oc.BRepAdaptor_Curve_2(d.wrapped)),w=o(new this.oc.GCPnts_TangentialDeflection_2(v,e,r,2,1e-9,1e-7)),[E,T]=c();for(let C=0;C<w.NbPoints();C++){const k=o(w.Value(C+1).Transformed(h.Transformation()));E(k)}T(g)}return{lines:a,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const a=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([a],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Qa extends Do{}class Ja extends Do{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new kh(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(e=0){return this.curve.tangentAt(e)}pointAt(e=0){return this.curve.pointAt(e)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class kh extends ft{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return wn(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new M(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new M(e)}_mapParameter(e){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*e}pointAt(e=.5){return new M(this.wrapped.Value(this._mapParameter(e)))}tangentAt(e=.5){const r=this._mapParameter(e),n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new M(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class lr extends Ja{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Xt extends Ja{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=Le(o.Shape());if(o.delete(),this.delete(),!(i instanceof Xt))throw new Error("Could not offset with a wire");return i}}class Ah extends ft{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Wr extends Do{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Ah(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:a}=this.UVBounds,l=this._geomAdaptor(),c=new this.oc.gp_Pnt_1,h=e*(o-n)+n,d=r*(a-i)+i;l.D0(h,d,c);const g=new M(c);return l.delete(),c.delete(),g}normalAt(e){let r=0,n=0;const o=Re();if(e){const h=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),d=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(ct(e)),h,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),g={current:0},v={current:0};d.LowerDistanceParameters(g,v),r=g.current,n=v.current}else{const{uMin:h,uMax:d,vMin:g,vMax:v}=this.UVBounds;r=.5*(h+d),n=.5*(g+v)}const i=o(new this.oc.gp_Pnt_1),a=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,a),new M(a)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new M(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Xt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=Re(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),a={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=o.get(),c=l.NbNodes();a.vertices=new Array(c*3);for(let E=1;E<=c;E++){const T=r(r(l.Node(E)).Transformed(i));a.vertices[(E-1)*3+0]=T.X(),a.vertices[(E-1)*3+1]=T.Y(),a.vertices[(E-1)*3+2]=T.Z()}const h=r(new this.oc.TColgp_Array1OfDir_2(1,c)),d=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,d,h),a.verticesNormals=new Array(h.Length()*3);for(let E=h.Lower();E<=h.Upper();E++){const T=r(r(h.Value(E)).Transformed(i));a.verticesNormals[(E-1)*3+0]=T.X(),a.verticesNormals[(E-1)*3+1]=T.Y(),a.verticesNormals[(E-1)*3+2]=T.Z()}const g=this.orientation,v=l.NbTriangles();a.trianglesIndexes=new Array(v*3);let w=0;for(let E=1;E<=v;E++){const T=r(l.Triangle(E));let C=T.Value(1),k=T.Value(2);const D=T.Value(3);if(g==="backward"){const O=C;C=k,k=O}a.trianglesIndexes[w*3+0]=C-1+e,a.trianglesIndexes[w*3+1]=k-1+e,a.trianglesIndexes[w*3+2]=D-1+e,w++}return a}}class Fo extends Do{fuse(e,{optimisation:r="none"}={}){const n=Re(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Le(i.Shape());if(!Nt(a))throw new Error("Could not fuse as a 3d shape");return a}cut(e,{optimisation:r="none"}={}){const n=Re(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Le(i.Shape());if(!Nt(a))throw new Error("Could not cut as a 3d shape");return a}intersect(e){const r=Re(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=Le(o.Shape());if(!Nt(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,a;if(typeof e=="number"){a=e;const w=new Ii;i=typeof r=="function"?r(w):w}else a=e.thickness,i=e.filter;const l=Re(),c=i.find(this),h=l(new this.oc.TopTools_ListOfShape_1);c.forEach(w=>{h.Append_1(w.wrapped)});const d=l(new this.oc.Message_ProgressRange_1),g=l(new this.oc.BRepOffsetAPI_MakeThickSolid);g.MakeThickSolidByJoin(this.wrapped,h,-a,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,d);const v=Le(g.Shape());if(!Nt(v))throw new Error("Could not shell as a 3d shape");return v}_builderIter(e,r){if(typeof e=="number"){let a=0;for(const l of this._iterTopo("edge"))r(e,Er(l)),a+=1;return a}let n,o=null;typeof e=="function"?n=e:(n=a=>e.filter.shouldKeep(a)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const a of this._iterTopo("edge")){const l=Er(a),c=new lr(l),h=n(c);h&&(r(h,l),i+=1),c.delete()}return o&&o(),i}fillet(e,r){const o=Re()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new yo)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not fillet, no edge was selected");const l=Le(o.Shape());if(!Nt(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const o=Re()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new yo)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not chamfer, no edge was selected");const l=Le(o.Shape());if(!Nt(l))throw new Error("Could not chamfer as a 3d shape");return l}}class eu extends Fo{}class xr extends Fo{}class tu extends Fo{}class ru extends Fo{}function Nt(t){return t instanceof eu||t instanceof xr||t instanceof tu||t instanceof ru}function Bs(t){return t instanceof Xt}function Er(t){const e=G(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=Ka(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function Le(t){const r=G().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,Qa],[r.TopAbs_EDGE,lr],[r.TopAbs_WIRE,Xt],[r.TopAbs_FACE,Wr],[r.TopAbs_SHELL,eu],[r.TopAbs_SOLID,xr],[r.TopAbs_COMPSOLID,tu],[r.TopAbs_COMPOUND,ru]]).get(Ka(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(Er(t))}const nu=(t,e)=>{const r=G();return new lr(new r.BRepBuilderAPI_MakeEdge_3(ct(t),ct(e)).Edge())},Rh=(t,e=[0,0,0],r=[0,0,1])=>{const n=G(),[o,i]=ze(),a=o(yn(e,r)),l=o(new n.gp_Circ_2(a,t)),c=o(new n.BRepBuilderAPI_MakeEdge_8(l)),h=new lr(c.Edge());return i(),h},Oh=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const a=G(),[l,c]=ze();let h=2*Math.PI;i&&(h=-2*Math.PI);const d=l(new a.Geom2d_Line_3(l(new a.gp_Pnt2d_3(0,0)),l(new a.gp_Dir2d_4(h,t)))),g=e/t,v=d.Value(0),w=d.Value(g*Math.sqrt((2*Math.PI)**2+t**2)),E=l(new a.GCE2d_MakeSegment_1(v,w)),T=new a.Geom_CylindricalSurface_1(l(fn(n,o)),r),C=l(new a.BRepBuilderAPI_MakeEdge_30(l(new a.Handle_Geom2d_Curve_2(E.Value().get())),l(new a.Handle_Geom_Surface_2(T)))).Edge(),k=l(new a.BRepBuilderAPI_MakeWire_2(C)).Wire();return a.BRepLib.BuildCurves3d_2(k),c(),new Xt(k)},hn=t=>{const e=G(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(a=>{a instanceof lr&&r.Add_1(a.wrapped),a instanceof Xt&&r.Add_2(a.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const a=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${a.get(o)||"unknown error"}`)}const i=new Xt(r.Wire());return r.delete(),n.delete(),i},ao=(t,e)=>{const r=G(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new Wr(o)},Mh=(t,e)=>{const r=G(),[n,o]=ze(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new Wr(l)},un=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=G(),i=yn(r,n),a=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),l=new xr(a.Shape());return i.delete(),a.delete(),l},Dh=t=>{const e=G(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new xr(r.Shape());return r.delete(),n};class Fh extends ft{constructor(e,r,n){const o=G(),i=Re(),a=Math.sqrt(e*r/n),l=e/a,c=r/a,h=new o.gp_GTrsf_1;h.SetAffinity_1(sn([0,0,0],[0,1,0]),l);const d=i(new o.gp_GTrsf_1);d.SetAffinity_1(sn([0,0,0],[0,0,1]),a);const g=i(new o.gp_GTrsf_1);g.SetAffinity_1(sn([0,0,0],[1,0,0]),c),h.Multiply(d),h.Multiply(g),super(h)}applyToPoint(e){const r=G(),o=Re()(e.XYZ());return this.wrapped.Transforms_1(o),new r.gp_Pnt_2(o)}}function Lh(t){const e=[];for(let r=t.LowerRow();r<=t.UpperRow();r++){const n=[];e.push(n);for(let o=t.LowerCol();o<=t.UpperCol();o++){const i=t.Value(r,o);n.push(i)}}return e}const Bh=(t,e,r)=>{const n=G(),o=Re(),i=o(new n.gp_Sphere_1);i.SetRadius(1);const a=o(new n.Geom_SphericalSurface_2(i)),l=n.GeomConvert.SurfaceToBSplineSurface(a.UReversed()).get(),c=Lh(l.Poles_2()),h=new Fh(t,e,r);c.forEach((g,v)=>{g.forEach((w,E)=>{const T=h.applyToPoint(w);l.SetPole_1(v+1,E+1,T)})});const d=Le(o(new n.BRepBuilderAPI_MakeShell_2(l.UReversed(),!1)).Shell());return Gi([d])},Ce=(t,e)=>{const r=G(),n=new r.BRepPrimAPI_MakeBox_4(ct(t),ct(e)),o=new xr(n.Solid());return n.delete(),o},bo=t=>{const e=G(),r=ct(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new Qa(o)},Rt=t=>{const e=G(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),Le(n)},kt=Rt;function Uh(t){const e=G(),r=Re(),n=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return t.forEach(({wrapped:o})=>{n.Add(o)}),n.Perform(r(new e.Message_ProgressRange_1)),Le(Er(n.SewedShape()))}function Gi(t){const e=Re(),r=G(),n=Uh(t),o=Le(e(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(o instanceof xr))throw new Error("Could not make a solid of faces and shells");return o}const ou=(t,e)=>{const r=G(),[n,o]=ze(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(h=>{i.Add(h.wrapped)});const a=n(i.Face()),l=n(new r.ShapeFix_Face_2(a));l.FixOrientation_1();const c=l.Face();return o(),new Wr(c)},Ih=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Gh=t=>{let e;t?Ih(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let a;typeof r=="number"?a=Dr(1,r*bt):a=r;let l;return typeof i=="number"?l=Dr(1,i*bt):l=i,{endTangent:a,startFactor:n,endFactor:o,startTangent:l}};function Us(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let a=Math.acos(o/i);return t*n-e*r<0&&(a=-a),a}function Nh([t,e],[r,n],o,i,a,l,c){const h=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const d=Math.sin(a),g=Math.cos(a),v=(t-r)/2,w=(e-n)/2,E=(t+r)/2,T=(e+n)/2,C=g*v+d*w,k=g*w-d*v,D=C*C/(o*o)+k*k/(i*i);D>1&&(o=o*Math.sqrt(D),i=i*Math.sqrt(D));const O=o*i,$=o*k,N=i*C,Z=$*$+N*N;if(!Z)throw Error("start point can not be same as end point");let Y=Math.sqrt(Math.abs((O*O-Z)/Z));l==c&&(Y=-Y);const q=Y*$/i,re=-Y*N/o,he=g*q-d*re+E,de=d*q+g*re+T,Ee=(C-q)/o,Te=(C+q)/o,ne=(k-re)/i,pe=(k+re)/i,me=Us(1,0,Ee,ne);let J=Us(Ee,ne,-Te,-pe);for(;J>h;)J-=h;for(;J<0;)J+=h;c||(J-=h);let Q=me+J;for(;Q>h;)Q-=h;for(;Q<0;)Q+=h;return{cx:he,cy:de,startAngle:me,deltaAngle:J,endAngle:Q,clockwise:!!c,rx:o,ry:i}}const iu=(t,e)=>{const r=G(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new xr(Er(n.Shape()));return n.delete(),o},su=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=G(),i=sn(e,r),a=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*bt,!1),l=Le(a.Shape());if(i.delete(),a.delete(),!Nt(l))throw new Error("Could not revolve to a 3d shape");return l};function pn(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:a,support:l,forceProfileSpineOthogonality:c}={},h=!1){const d=G(),g=i==="round"?!0:!!c,v=new d.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const T={transformed:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];T&&v.SetTransitionMode(T)}l?v.SetMode_4(l):r&&v.SetMode_1(r),n&&v.SetMode_5(n.wrapped,!1,d.BRepFill_TypeOfContact.BRepFill_NoContact),o?v.SetLaw_1(t.wrapped,o,!!a,g):v.Add_1(t.wrapped,!!a,g);const w=new d.Message_ProgressRange_1;v.Build(w),h||v.MakeSolid();const E=Le(v.Shape());if(!Nt(E))throw new Error("Could not sweep to a 3d shape");if(h){const T=Le(v.FirstShape()),C=Le(v.LastShape());if(!Bs(T))throw new Error("Could not sweep with one start wire");if(!Bs(C))throw new Error("Could not sweep with one end wire");return v.delete(),[E,T,C]}return v.delete(),w.delete(),E}const au=(t,{profile:e,endFactor:r=1})=>{let n;const o=G();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function uu(t,e,r,n,o=!1){const i=new M(e),a=new M(r),l=nu(i,i.add(a)),c=hn([l]),h=n?au(a.Length,n):null;return o?pn(t,c,{law:h},o):pn(t,c,{law:h},o)}function lu(t,e,r,n,o,i=!1){const a=new M(r),l=new M(n),c=nu(a,a.add(l)),h=hn([c]),d=360/e*l.Length,g=1,v=Oh(d,l.Length,g,r,n),w=o?au(l.Length,o):null;return i?pn(t,h,{auxiliarySpine:v,law:w},i):pn(t,h,{auxiliarySpine:v,law:w},i)}const Vh=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=G(),[a,l]=ze(),c=a(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&c.AddVertex(a(bo(r)).wrapped),t.forEach(g=>c.AddWire(g.wrapped)),n&&c.AddVertex(a(bo(n)).wrapped);const h=a(new i.Message_ProgressRange_1);c.Build(h);const d=Le(c.Shape());if(l(),!Nt(d))throw new Error("Could not loft to a 3d shape");return d};class Nr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Nr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new M(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new M(e)}face(){let e;return this.baseFace?e=Mh(this.baseFace,this.wire):e=ao(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=ao(this.wire),o=su(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[a,l]=ze(),c=a(new M(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const g=uu(this.wire,i||this.defaultOrigin,c,n);return l(),this.delete(),g}if(o){const g=lu(this.wire,o,i||this.defaultOrigin,c,n);return l(),this.delete(),g}const h=ao(this.wire),d=iu(h,c);return l(),this.delete(),d}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),a=e(new rt(n,i,o),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const c=pn(a.wire,this.wire,l);return this.delete(),c}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=Vh(o.map(a=>a.wire),r,n);return o.forEach(a=>a.delete()),i}}const Hh=t=>{const e=G(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new bn(r)};function Wh(t,e){const[r,n]=ze(),o=r(yn(e.origin,e.zDir,e.xDir)),i=G(),a=t.map(l=>{const c=i.GeomLib.To3d(o,l.wrapped);return new lr(new i.BRepBuilderAPI_MakeEdge_24(c).Edge())});return n(),a}const zh=(t,e)=>{const[r,n]=ze(),o=G(),i=t.map(a=>{const l=r(new o.BRepBuilderAPI_MakeEdge_30(a.wrapped,e));return new lr(l.Edge())});return n(),i},cu=(t,e)=>{const r=G();return t.map(o=>e?new Ie(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class En extends ft{transformCurves(e){return cu(e,this.wrapped)}}const fu=(t,e,r=[0,0])=>{const n=G(),o=Ir(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new En(i)},$h=t=>{const e=G(),[r,n]=ze(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(Wa(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new En(i)},Xh=(t,e=[0,0],r="center")=>{const n=G(),[o,i]=ze(),a=new n.gp_Trsf2d_1;r==="center"?a.SetMirror_1(o(Ke(t))):a.SetMirror_2(o(Ir(e,t)));const l=new n.gp_GTrsf2d_2(a);return i(),new En(l)},Yh=(t,e=[0,0])=>{const r=G(),[n,o]=ze(),i=new r.gp_Trsf2d_1;i.SetRotation(n(Ke(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new En(a)},jh=(t,e=[0,0])=>{const r=G(),[n,o]=ze(),i=new r.gp_Trsf2d_1;i.SetScale(n(Ke(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new En(a)};function qh(t,e,r="original"){const[n,o]=ze(),i=G();let a=n(i.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let c=null;const h=n(Ir([0,0],[0,1])),d=n(Ir([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const w=n(a.get().Cylinder());w.Direct()||(a=a.get().UReversed());const E=w.Radius();c=fu(1/E,[0,1]).wrapped}if(r==="bounds"){if(c=n(new i.gp_GTrsf2d_1),c.SetAffinity(h,l.uMax-l.uMin),l.uMin!==0){const E=n(new i.gp_GTrsf2d_1);E.SetTranslationPart(new i.gp_XY_2(0,-l.uMin)),c.Multiply(E)}const w=n(new i.gp_GTrsf2d_1);if(w.SetAffinity(d,l.vMax-l.vMin),c.Multiply(w),l.vMin!==0){const E=n(new i.gp_GTrsf2d_1);E.SetTranslationPart(n(new i.gp_XY_2(0,-l.vMin))),c.Multiply(E)}}const g=cu(t,c),v=zh(g,a);return o(),v}function Zh(t,e){const r=G(),o=Re()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),i=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&i.Reverse(),new Ie(new r.Handle_Geom2d_Curve_2(i))}const Lo=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},Ni=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${Lo(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class le{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new le(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=Hh(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=fu(e,r,n).transformCurves(this.curves);return new le(o)}scale(e,r){const n=r||this.boundingBox.center,o=jh(e,n).transformCurves(this.curves);return new le(o)}rotate(e,r){const n=Yh(e*bt,r).transformCurves(this.curves);return new le(n)}translate(e,r=0){const n=po(e)?e:[e,r],o=$h(n).transformCurves(this.curves);return new le(o)}mirror(e,r=[0,0],n="center"){const o=Xh(e,r,n).transformCurves(this.curves);return new le(o)}sketchOnPlane(e,r){const n=e instanceof rt?ar(e):ar(e,r),o=Wh(this.curves,n),i=hn(o);return new Nr(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=G(),o=qh(this.curves,e,r),i=hn(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const a=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);a.FixEdgeCurves(),a.delete();const l=new Nr(i);if(i.isClosed){const c=l.clone().face();l.defaultOrigin=c.pointOnSurface(.5,.5),l.defaultDirection=c.normalAt(),c.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const c=i.startPoint;l.defaultOrigin=c,l.defaultDirection=e.normalAt(c),l.baseFace=e}return l}toSVGPathD(){const e=Re(),r=this.clone().mirror([1,0],[0,0],"plane"),o=go(r.curves).flatMap(l=>Eh(e(l.adaptor()),l.lastPoint)),[i,a]=r.curves[0].firstPoint;return`M ${wt(i)} ${wt(a)} ${o.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return Lo(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return Ni(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1,o=Sn(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,l.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return et(this.firstPoint,this.lastPoint)}intersects(e){const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class hu{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?Ti:Ei;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=Sn(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*bt,o=Dr(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*bt,[o,i]=Dr(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=rr(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(_i(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,a]=this.pointer;return this.threePointsArcTo([i+e,a+r],[i+n,a+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,a]=e,l=[(n+i)/2,(o+a)/2],c=[-(a-o),i-n],h=Math.sqrt(c[0]**2+c[1]**2),d=[l[0]+c[0]/h*r,l[1]+c[1]/h*r];return this.saveCurve(_i(this._convertToUV(this.pointer),this._convertToUV(d),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=At(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(gh(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,a=!1){let l=o,c=r,h=n;r<n&&(l=o+90,c=n,h=r);const d=l*bt,g=q=>At(this._convertToUV(q)),v=g(Dr(c,d)),w=g(Dr(h,d+Math.PI/2)),E=rr(this._convertToUV(hh([1,0],d))),[,T]=ph(E),{cx:C,cy:k,startAngle:D,endAngle:O,clockwise:$,rx:N,ry:Z}=Nh(this._convertToUV(this.pointer),this._convertToUV(e),v,w,T,i,a),Y=mh(N,Z,$?D:O,$?O:D,[C,k],E);return $||Y.reverse(),this.saveCurve(Y),this.pointer=e,this}ellipse(e,r,n,o,i=0,a=!1,l=!1){const[c,h]=this.pointer;return this.ellipseTo([e+c,r+h],n,o,i,a,l)}halfEllipseTo(e,r,n=!1){const o=fh(e,this.pointer),i=At(e,this.pointer);return this.ellipseTo(e,i/2,r,o*on,!0,n)}halfEllipse(e,r,n,o=!1){const[i,a]=this.pointer;return this.halfEllipseTo([i+e,a+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(yh(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:a}=Gh(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,c=At(this.pointer,e)*.25;let h;o?h=o:l?h=this._convertFromUV(l.tangentAt(1)):h=[1,0],h=rr(h);const d=[this.pointer[0]+h[0]*i*c,this.pointer[1]+h[1]*i*c];let g;n==="symmetric"?g=[-h[0],-h[1]]:g=n,g=rr(g);const v=[e[0]-g[0]*a*c,e[1]-g[1]*a*c];return this.cubicBezierCurveTo(e,d,v)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?Ti:Ei;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){et(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(et(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=Ir(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new Ie(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class Kh extends hu{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new le(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const Qh=t=>{const e=G(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,a)=>{i.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,a===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=Le(r.Shape());if(r.delete(),!(o instanceof Wr))throw new Error("Failed to create a face");return o},Jh=(t,e)=>{const r=G(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},Is=t=>{let e,r;try{e=ao(t[0]),r=t.slice(1)}catch{e=Qh(t),r=t.slice(1).map(o=>Jh(o,e))}return ou(e,r)},Gs=(t,e)=>{const r=[],n=[],o=[];t.forEach(c=>{const[h,d,g]=e(c);r.push(h),n.push(d),o.push(g)});const i=Is(n),a=Is(o);return Gi([i,...r,a])};class Ns{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return Rt(e)}face(){const e=this.outerSketch.face();return ou(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const a=new M(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?Gs(this.sketches,h=>uu(h.wire,i||this.outerSketch.defaultOrigin,a,n,!0)):o?Gs(this.sketches,h=>lu(h.wire,o,i||this.outerSketch.defaultOrigin,a,n,!0)):iu(this.face(),a)}revolve(e,{origin:r}={}){return su(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,a)=>{const l=e.sketches[a];return i.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),Gi(n)}}class xe{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new xe(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new bn;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new xe(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new xe(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new xe(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new xe(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new xe(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new Ns(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new Ns(n)}toSVGViewBox(e=1){return Lo(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return Ni(this.toSVGGroup(),this.boundingBox,e)}}class Vs{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof Nr?r.wire:r.wires);return Rt(e)}faces(){const e=this.sketches.map(r=>r.face());return Rt(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return Rt(n)}revolve(e,r){return Rt(this.sketches.map(n=>n.revolve(e,r)))}}class ee{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new ee(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new bn;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new ee(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new ee(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new ee(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new ee(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new ee(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new Vs(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new Vs(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return Lo(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof le?n.toSVGPath():n.toSVGGroup());return Ni(r.join(`
    `),this.boundingBox,e)}}const ep=t=>{const e=t.map((o,i)=>t.slice(i+1).map((a,l)=>[l+i+1,a]).filter(([,a])=>!o.boundingBox.isOut(a.boundingBox)).map(([a])=>a)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let a=n[i];a||(a=[],r.push(a)),a.push(t[i]),o.length&&o.forEach(l=>{n[l]=a})}),r},pu=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((a,l)=>r===l?!1:a.isInside(o));return{blueprint:e,isIn:i}}),tp=(t,e)=>t.flatMap(({blueprint:r})=>Vi(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),rp=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=Vi(pu(t.map(({blueprint:o})=>o)));return[r,...n]},Vi=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?tp(e,t):rp(r,t)},Tn=t=>{const e=ep(t).map(pu);return new ee(e.flatMap(Vi).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new xe(r.map(({blueprint:n})=>n)))))},np=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let i=Math.min(n,t/2),a=Math.min(o,e/2);const l=i&&a;l||(i=0,a=0);const c=i===a,h=new Kh([Math.min(0,-(t/2-i)),-e/2]),d=(g,v)=>{l&&(c?h.tangentArc(g,v):h.ellipse(g,v,i,a,0,!1,!0))};return i<t/2&&h.hLine(t-2*i),d(i,a),a<e/2&&h.vLine(e-2*a),d(-i,a),i<t/2&&h.hLine(-(t-2*i)),d(-i,-a),a<e/2&&h.vLine(-(e-2*a)),d(i,-a),h.close()},uo=1e-9,Je=(t,e)=>et(t,e,uo),rn=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},Hs=(t,e)=>{const r=t.findIndex(i=>Je(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},Ws=(t,e)=>{const r=a=>Je(e.firstPoint,a.firstPoint)&&Je(e.lastPoint,a.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Hi(t),n=t.findIndex(r),n===-1))throw console.error(t.map(a=>a.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*zs(t,e,r){const n=a=>!!e.find(l=>Je(l,a.lastPoint)),o=a=>!!r.find(l=>Je(l.firstPoint,a.firstPoint)&&Je(l.lastPoint,a.lastPoint)||Je(l.firstPoint,a.lastPoint)&&Je(l.lastPoint,a.firstPoint));let i=[];for(const a of t)n(a)?(i.push(a),yield i,i=[]):o(a)?(i.length&&(yield i,i=[]),yield[a]):i.push(a);i.length&&(yield i)}const op=t=>t[0].firstPoint,li=t=>t[t.length-1].lastPoint,Hi=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),ip=t=>(t.reverse(),t.map(Hi));function sp(t,e,r){return t.filter(n=>{const o=e.filter(l=>Je(l.firstPoint,n)||Je(l.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(l=>r.isInside(rn(l)));return!(i.every(l=>l)||!i.some(l=>l))})}function ap(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((v,w)=>{e.curves.forEach((E,T)=>{const{intersections:C,commonSegments:k,commonSegmentsPoints:D}=_n(v,E,uo/100);r.push(...C),o[w].push(...C),i[T].push(...C),n.push(...k),r.push(...D),o[w].push(...D),i[T].push(...D)})}),r=Ha(r,uo),!r.length||r.length===1)return null;const a=([v,w])=>w.length?v.splitAt(w,uo/100):[v];let l=Lr([t.curves,o]).flatMap(a),c=Lr([e.curves,i]).flatMap(a);const h=n.map(v=>[v.firstPoint,v.lastPoint]);if(r=sp(r,l,e),!r.length&&!n.length)return null;if(n.length){const v=n[0];l=Ws(l,v),c=Ws(c,v)}else{const v=r[0];l=Hs(l,v),c=Hs(c,v)}const d=Array.from(zs(l,r,n));let g=Array.from(zs(c,r,n));return(!Je(li(g[0]),li(d[0]))||n.length>0&&g[0].length!==1)&&(g=ip(g)),Lr([d,g]).map(([v,w])=>{const E=op(v),T=li(v);return h.find(([C,k])=>Je(C,E)&&Je(k,T)||Je(C,T)&&Je(C,E))?[v,"same"]:[v,w]})}const up=t=>{const e=t.map(a=>a.firstPoint);let r=t.map(a=>a.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=Lr([e,r]).map(([a,l],c)=>Je(a,l)?null:c).filter(a=>a!==null);if(!n.length)return[t];const o=Lr([n.slice(0,-1),n.slice(1)]).map(([a,l])=>t.slice(a,l));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function Wi(t,e,{firstInside:r,secondInside:n}){const o=ap(t,e);if(!o){const h=rn(t.curves[0]),d=e.isInside(h),g=rn(e.curves[0]),v=t.isInside(g);return{identical:!1,firstCurveInSecond:d,secondCurveInFirst:v}}if(o.every(([,h])=>h==="same"))return{identical:!0};let i=null,a=null;const l=o.flatMap(([h,d])=>{let g=[],v=0;if(d==="same")return a===1?(a=1,[...h]):a===2||a===0?(a=null,[]):a===null?(i?i=[...i,...h]:i=h,[]):(console.error("weird situation"),[]);const w=rn(h[0]),E=e.isInside(w);(r==="keep"&&E||r==="remove"&&!E)&&(v+=1,g.push(...h));const T=rn(d[0]),C=t.isInside(T);if(n==="keep"&&C||n==="remove"&&!C){let k=d;v===1&&(k=Hi(d)),v+=1,g.push(...k)}return a===null&&v===1&&i&&(g=[...i,...g]),v===1&&(a=v,i=null),g}),c=up(l).filter(h=>h.length).map(h=>new le(h));return c.length===0?null:c.length===1?c[0]:Tn(c)}const Bo=(t,e)=>{const r=Wi(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof le||r instanceof ee?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new ee([t,e])},dn=(t,e)=>{const r=Wi(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof le||r instanceof ee?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new ee([new xe([t,e])]):t.clone()},zi=(t,e)=>{const r=Wi(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof le||r instanceof ee?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},Ci=(t,e)=>{if(t instanceof le&&e instanceof le){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:a}=_n(n,o);r.push(...i),r.push(...a)})}),r=Ha(r),r.length>1}if(t instanceof xe||t instanceof ee)return t.blueprints.some(r=>Ci(r,e));if(e instanceof xe||e instanceof ee)return e.blueprints.some(r=>Ci(t,r));throw new Error("Bug in the generic intersects algorithm")},lp=(t,e)=>{if(t instanceof xe){if(e instanceof le)return _o(e,t);if(e instanceof xe)return So(t,e)}if(e instanceof xe){if(t instanceof le)return _o(t,e);if(t instanceof xe)return So(t,e)}if(t instanceof le&&e instanceof le)return Bo(t,e);throw new Error("Bug in the generic fuse algorithm")},$s=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((a,l)=>{const c=i.current,h=o+l+1;if(i.fusedWith.has(h))return;let d=a,g=!1;if(e.has(h)&&(d=e.get(h).current,g=!0),c.boundingBox.isOut(d.boundingBox)||!Ci(c,d))return;let v;if(c instanceof ee||d instanceof ee?v=Ht(c,d):v=lp(c,d),!(v instanceof le||v instanceof xe)){if(v instanceof ee&&v.blueprints.length===2)return;if(v instanceof ee&&v.blueprints.length===1)v=v.blueprints[0];else if(!(v instanceof ee))throw console.error(v),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(h),i.current=v,g||e.set(h,i)})}),Tn(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>Vt(n)))},Vt=t=>t instanceof le?[t]:t instanceof xe?t.blueprints:t instanceof ee?t.blueprints.flatMap(e=>Vt(e)):[],_o=(t,e)=>{const r=Bo(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>dn(o,t));return Tn([...Vt(r),...n.flatMap(o=>Vt(o))])};function cp(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const So=(t,e)=>{const r=Bo(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(a=>dn(a,t.blueprints[0])),o=t.blueprints.slice(1).map(a=>dn(a,e.blueprints[0])),i=cp(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([a,l])=>Vt(zi(a,l)));return Tn([...Vt(r),...n.flatMap(a=>Vt(a)),...o.flatMap(a=>Vt(a)),...i])},Ht=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof ee)&&e instanceof ee)return $s([t,...e.blueprints]);if(!(e instanceof ee)&&t instanceof ee)return $s([e,...t.blueprints]);if(t instanceof ee&&e instanceof ee){let r=Ht(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=Ht(n,r)}),r}if(t instanceof xe){if(e instanceof ee)return Ht(e,t);if(e instanceof le)return _o(e,t);if(e instanceof xe)return So(t,e)}if(e instanceof xe){if(t instanceof ee)return Ht(t,e);if(t instanceof le)return _o(t,e);if(t instanceof xe)return So(t,e)}return t instanceof le&&e instanceof le?Bo(t,e):null},Eo=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof ee?r.blueprints:r);return e.length===1?e[0]:new ee(e)},nr=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof ee)return Eo(t.blueprints.map(n=>nr(n,e)));if(t instanceof xe){const n=t.blueprints[0];if(e instanceof le&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=Ht(e,new ee(t.blueprints.slice(1)));return Tn([n,...Vt(o)])}else{let o=nr(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=nr(o,i)}),o}}if(e instanceof ee)return Eo(e.blueprints.map(n=>nr(t,n)));if(e instanceof xe){let n=dn(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=Ht(n,zi(o,t))}),n}return dn(t,e)};function nn(t,e){if(t===null||e===null)return null;if(t instanceof le&&e instanceof le)return zi(t,e);if(t instanceof ee)return Eo(t.blueprints.map(r=>nn(r,e)));if(t instanceof xe){const r=t.blueprints[0],n=t.blueprints[1];return nr(nn(r,e),n)}if(e instanceof ee)return Eo(e.blueprints.map(r=>nn(t,r)));if(e instanceof xe){const r=e.blueprints[0],n=e.blueprints[1];return nr(nn(r,t),n)}throw new Error("intersct 2D algorithm error")}const Xs=(t,e={})=>{const r=e.plane instanceof rt?ar(e.plane):ar(e.plane,e.origin),n=hn([Rh(t,r.origin,r.zDir)]),o=new Nr(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var a=n.charCodeAt(i),l;return a>=55296&&a<=56319&&o>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(a-55296)*1024+l-56320+65536:a}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function du(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var fp=new du,hp=new du,vu=new Uint8Array(30),gu=new Uint16Array(30),pp=new Uint8Array(30),dp=new Uint16Array(30);function mu(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function vp(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}vp(fp,hp);mu(vu,gu,4,3);mu(pp,dp,2,1);vu[28]=0;gu[28]=258;function Rr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function cr(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}cr.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};cr.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};cr.prototype.addX=function(t){this.addPoint(t,null)};cr.prototype.addY=function(t){this.addPoint(null,t)};cr.prototype.addBezier=function(t,e,r,n,o,i,a,l){var c=[t,e],h=[r,n],d=[o,i],g=[a,l];this.addPoint(t,e),this.addPoint(a,l);for(var v=0;v<=1;v++){var w=6*c[v]-12*h[v]+6*d[v],E=-3*c[v]+9*h[v]-9*d[v]+3*g[v],T=3*h[v]-3*c[v];if(E===0){if(w===0)continue;var C=-T/w;0<C&&C<1&&(v===0&&this.addX(Rr(c[v],h[v],d[v],g[v],C)),v===1&&this.addY(Rr(c[v],h[v],d[v],g[v],C)));continue}var k=Math.pow(w,2)-4*T*E;if(!(k<0)){var D=(-w+Math.sqrt(k))/(2*E);0<D&&D<1&&(v===0&&this.addX(Rr(c[v],h[v],d[v],g[v],D)),v===1&&this.addY(Rr(c[v],h[v],d[v],g[v],D)));var O=(-w-Math.sqrt(k))/(2*E);0<O&&O<1&&(v===0&&this.addX(Rr(c[v],h[v],d[v],g[v],O)),v===1&&this.addY(Rr(c[v],h[v],d[v],g[v],O)))}}};cr.prototype.addQuad=function(t,e,r,n,o,i){var a=t+.6666666666666666*(r-t),l=e+2/3*(n-e),c=a+1/3*(o-t),h=l+1/3*(i-e);this.addBezier(t,e,a,l,c,h,o,i)};function $e(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}$e.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};$e.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};$e.prototype.curveTo=$e.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})};$e.prototype.quadTo=$e.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};$e.prototype.close=$e.prototype.closePath=function(){this.commands.push({type:"Z"})};$e.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof cr){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};$e.prototype.getBoundingBox=function(){for(var t=new cr,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var a=this.commands[i];switch(a.type){case"M":t.addPoint(a.x,a.y),e=n=a.x,r=o=a.y;break;case"L":t.addPoint(a.x,a.y),n=a.x,o=a.y;break;case"Q":t.addQuad(n,o,a.x1,a.y1,a.x,a.y),n=a.x,o=a.y;break;case"C":t.addBezier(n,o,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,o=a.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+a.type)}}return t.isEmpty()&&t.addPoint(0,0),t};$e.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};$e.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(t)}function r(){for(var a=arguments,l="",c=0;c<arguments.length;c+=1){var h=a[c];h>=0&&c>0&&(l+=" "),l+=e(h)}return l}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n};$e.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};$e.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function yu(t){throw new Error(t)}function Ys(t,e){t||yu(e)}var te={fail:yu,argument:Ys,assert:Ys},js=32768,qs=2147483648,Vr={},H={},K={};function Et(t){return function(){return t}}H.BYTE=function(t){return te.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};K.BYTE=Et(1);H.CHAR=function(t){return[t.charCodeAt(0)]};K.CHAR=Et(1);H.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};K.CHARARRAY=function(t){return typeof t>"u"?0:t.length};H.USHORT=function(t){return[t>>8&255,t&255]};K.USHORT=Et(2);H.SHORT=function(t){return t>=js&&(t=-(2*js-t)),[t>>8&255,t&255]};K.SHORT=Et(2);H.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};K.UINT24=Et(3);H.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};K.ULONG=Et(4);H.LONG=function(t){return t>=qs&&(t=-(2*qs-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};K.LONG=Et(4);H.FIXED=H.ULONG;K.FIXED=K.ULONG;H.FWORD=H.SHORT;K.FWORD=K.SHORT;H.UFWORD=H.USHORT;K.UFWORD=K.USHORT;H.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};K.LONGDATETIME=Et(8);H.TAG=function(t){return te.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};K.TAG=Et(4);H.Card8=H.BYTE;K.Card8=K.BYTE;H.Card16=H.USHORT;K.Card16=K.USHORT;H.OffSize=H.BYTE;K.OffSize=K.BYTE;H.SID=H.USHORT;K.SID=K.USHORT;H.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?H.NUMBER16(t):H.NUMBER32(t)};K.NUMBER=function(t){return H.NUMBER(t).length};H.NUMBER16=function(t){return[28,t>>8&255,t&255]};K.NUMBER16=Et(3);H.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};K.NUMBER32=Et(5);H.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,a=e.length;i<a;i+=1){var l=e[i];l==="e"?o+=e[++i]==="-"?"c":"b":l==="."?o+="a":l==="-"?o+="e":o+=l}o+=o.length&1?"f":"ff";for(var c=[30],h=0,d=o.length;h<d;h+=2)c.push(parseInt(o.substr(h,2),16));return c};K.REAL=function(t){return H.REAL(t).length};H.NAME=H.CHARARRAY;K.NAME=K.CHARARRAY;H.STRING=H.CHARARRAY;K.STRING=K.CHARARRAY;Vr.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Vr.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)};H.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};K.UTF16=function(t){return t.length*2};var Pi={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Vr.MACSTRING=function(t,e,r,n){var o=Pi[n];if(o!==void 0){for(var i="",a=0;a<r;a++){var l=t.getUint8(e+a);l<=127?i+=String.fromCharCode(l):i+=o[l&127]}return i}};var Jn=typeof WeakMap=="function"&&new WeakMap,eo,gp=function(t){if(!eo){eo={};for(var e in Pi)eo[e]=new String(e)}var r=eo[t];if(r!==void 0){if(Jn){var n=Jn.get(r);if(n!==void 0)return n}var o=Pi[t];if(o!==void 0){for(var i={},a=0;a<o.length;a++)i[o.charCodeAt(a)]=a+128;return Jn&&Jn.set(r,i),i}}};H.MACSTRING=function(t,e){var r=gp(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}};K.MACSTRING=function(t,e){var r=H.MACSTRING(t,e);return r!==void 0?r.length:0};function ki(t){return t>=-128&&t<=127}function mp(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function yp(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(!ki(a)||a===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var l=e;l<i;++l)r.push(t[l]+256&255);return i}function wp(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(a===0||ki(a)&&i+1<o&&ki(t[i+1]))break;++i,++n}r.push(64|n-1);for(var l=e;l<i;++l){var c=t[l];r.push(c+65536>>8&255,c+256&255)}return i}H.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=mp(t,e,r):n>=-128&&n<=127?e=yp(t,e,r):e=wp(t,e,r)}return r};H.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=H.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var a=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,c=[void 0,H.BYTE,H.USHORT,H.UINT24,H.ULONG][l],h=0;h<r.length;h+=1){var d=c(r[h]);Array.prototype.push.apply(a,d)}return Array.prototype.concat(H.Card16(t.length),H.OffSize(l),a,n)};K.INDEX=function(t){return H.INDEX(t).length};H.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),a=t[i];e=e.concat(H.OPERAND(a.value,a.type)),e=e.concat(H.OPERATOR(i))}return e};K.DICT=function(t){return H.DICT(t).length};H.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};H.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)te.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(H.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(H.NUMBER(t));else if(e==="offset")r=r.concat(H.NUMBER32(t));else if(e==="number")r=r.concat(H.NUMBER(t));else if(e==="real")r=r.concat(H.REAL(t));else throw new Error("Unknown operand type "+e);return r};H.OP=H.BYTE;K.OP=K.BYTE;var to=typeof WeakMap=="function"&&new WeakMap;H.CHARSTRING=function(t){if(to){var e=to.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(H[i.type](i.value))}return to&&to.set(t,r),r};K.CHARSTRING=function(t){return H.CHARSTRING(t).length};H.OBJECT=function(t){var e=H[t.type];return te.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};K.OBJECT=function(t){var e=K[t.type];return te.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};H.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var a=t.fields[i],l=H[a.type];te.argument(l!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var c=t[a.name];c===void 0&&(c=a.value);var h=l(c);a.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(h)):e=e.concat(h)}for(var d=0;d<n.length;d+=1){var g=o[d],v=e.length;te.argument(v<65536,"Table "+t.tableName+" too big."),e[g]=v>>8,e[g+1]=v&255,e=e.concat(n[d])}return e};K.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=K[o.type];te.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var a=t[o.name];a===void 0&&(a=o.value),e+=i(a),o.type==="TABLE"&&(e+=2)}return e};H.RECORD=H.TABLE;K.RECORD=K.TABLE;H.LITERAL=function(t){return t};K.LITERAL=function(t){return t.length};function je(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),a=0;a<i.length;a+=1){var l=i[a],c=r[l];this[l]!==void 0&&(this[l]=c)}}je.prototype.encode=function(){return H.TABLE(this)};je.prototype.sizeOf=function(){return K.TABLE(this)};function vn(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function Ai(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function gn(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function To(t){t.format===1?je.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(vn("glyph",t.glyphs))):t.format===2?je.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(gn("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):te.assert(!1,"Coverage format must be 1 or 2.")}To.prototype=Object.create(je.prototype);To.prototype.constructor=To;function xo(t){je.call(this,"scriptListTable",gn("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return te.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new je("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new je("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(vn("featureIndex",o.featureIndexes)))}].concat(gn("langSys",n.langSysRecords,function(i,a){var l=i.langSys;return[{name:"langSysTag"+a,type:"TAG",value:i.tag},{name:"langSys"+a,type:"TABLE",value:new je("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(vn("featureIndex",l.featureIndexes)))}]})))}]}))}xo.prototype=Object.create(je.prototype);xo.prototype.constructor=xo;function Co(t){je.call(this,"featureListTable",gn("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new je("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(vn("lookupListIndex",n.lookupListIndexes)))}]}))}Co.prototype=Object.create(je.prototype);Co.prototype.constructor=Co;function Po(t,e){je.call(this,"lookupListTable",Ai("lookup",t,function(r){var n=e[r.lookupType];return te.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new je("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Ai("subtable",r.subtables,n)))}))}Po.prototype=Object.create(je.prototype);Po.prototype.constructor=Po;var z={Table:je,Record:je,Coverage:To,ScriptList:xo,FeatureList:Co,LookupList:Po,ushortList:vn,tableList:Ai,recordList:gn};function Zs(t,e){return t.getUint8(e)}function ko(t,e){return t.getUint16(e,!1)}function bp(t,e){return t.getInt16(e,!1)}function $i(t,e){return t.getUint32(e,!1)}function wu(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function _p(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function Sp(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Ep(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function Tp(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var xp={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function P(t,e){this.data=t,this.offset=e,this.relativeOffset=0}P.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};P.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};P.prototype.parseCard8=P.prototype.parseByte;P.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};P.prototype.parseCard16=P.prototype.parseUShort;P.prototype.parseSID=P.prototype.parseUShort;P.prototype.parseOffset16=P.prototype.parseUShort;P.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};P.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};P.prototype.parseULong=function(){var t=$i(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};P.prototype.parseOffset32=P.prototype.parseULong;P.prototype.parseFixed=function(){var t=wu(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};P.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n};P.prototype.parseTag=function(){return this.parseString(4)};P.prototype.parseLongDateTime=function(){var t=$i(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};P.prototype.parseVersion=function(t){var e=ko(this.data,this.offset+this.relativeOffset),r=ko(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};P.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=xp[t]*e};P.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};P.prototype.parseOffset16List=P.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};P.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};P.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e};P.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};P.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};P.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r};P.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r};P.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r};P.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};P.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};P.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new P(this.data,this.offset+e).parseStruct(t)};P.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new P(this.data,this.offset+e).parseStruct(t)};P.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var a=e[i];if(a===0){o[i]=void 0;continue}if(this.relativeOffset=a,t){for(var l=this.parseOffset16List(),c=new Array(l.length),h=0;h<l.length;h++)this.relativeOffset=a+l[h],c[h]=t.call(this);o[i]=c}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o};P.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};P.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:P.uShort,end:P.uShort,classId:P.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};P.list=function(t,e){return function(){return this.parseList(t,e)}};P.list32=function(t,e){return function(){return this.parseList32(t,e)}};P.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};P.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};P.pointer=function(t){return function(){return this.parsePointer(t)}};P.pointer32=function(t){return function(){return this.parsePointer32(t)}};P.tag=P.prototype.parseTag;P.byte=P.prototype.parseByte;P.uShort=P.offset16=P.prototype.parseUShort;P.uShortList=P.prototype.parseUShortList;P.uLong=P.offset32=P.prototype.parseULong;P.uLongList=P.prototype.parseULongList;P.struct=P.prototype.parseStruct;P.coverage=P.prototype.parseCoverage;P.classDef=P.prototype.parseClassDef;var Ks={reserved:P.uShort,reqFeatureIndex:P.uShort,featureIndexes:P.uShortList};P.prototype.parseScriptList=function(){return this.parsePointer(P.recordList({tag:P.tag,script:P.pointer({defaultLangSys:P.pointer(Ks),langSysRecords:P.recordList({tag:P.tag,langSys:P.pointer(Ks)})})}))||[]};P.prototype.parseFeatureList=function(){return this.parsePointer(P.recordList({tag:P.tag,feature:P.pointer({featureParams:P.offset16,lookupListIndexes:P.uShortList})}))||[]};P.prototype.parseLookupList=function(t){return this.parsePointer(P.list(P.pointer(function(){var e=this.parseUShort();te.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(P.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};P.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();te.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:P.offset32,featureTableSubstitutionOffset:P.offset32});return r})||[]};var ie={getByte:Zs,getCard8:Zs,getUShort:ko,getCard16:ko,getShort:bp,getULong:$i,getFixed:wu,getTag:_p,getOffset:Sp,getBytes:Ep,bytesToString:Tp,Parser:P};function Cp(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),a=e.parseULong(),l=o;l<=i;l+=1)t.glyphIndexMap[l]=a,a++}function Pp(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var a=new ie.Parser(r,n+o+14),l=new ie.Parser(r,n+o+16+i*2),c=new ie.Parser(r,n+o+16+i*4),h=new ie.Parser(r,n+o+16+i*6),d=n+o+16+i*8,g=0;g<i-1;g+=1)for(var v=void 0,w=a.parseUShort(),E=l.parseUShort(),T=c.parseShort(),C=h.parseUShort(),k=E;k<=w;k+=1)C!==0?(d=h.offset+h.relativeOffset-2,d+=C,d+=(k-E)*2,v=ie.getUShort(r,d),v!==0&&(v=v+T&65535)):v=k+T&65535,t.glyphIndexMap[k]=v}function kp(t,e){var r={};r.version=ie.getUShort(t,e),te.argument(r.version===0,"cmap table version should be 0."),r.numTables=ie.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=ie.getUShort(t,e+4+o*8),a=ie.getUShort(t,e+4+o*8+2);if(i===3&&(a===0||a===1||a===10)||i===0&&(a===0||a===1||a===2||a===3||a===4)){n=ie.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new ie.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)Cp(r,l);else if(r.format===4)Pp(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function Ap(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Rp(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Op(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new z.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var a=t.get(r),l=0;l<a.unicodes.length;l+=1)Ap(i,a.unicodes[l],r);i.segments=i.segments.sort(function(D,O){return D.start-O.start})}Rp(i);var c=i.segments.length,h=0,d=[],g=[],v=[],w=[],E=[],T=[];for(r=0;r<c;r+=1){var C=i.segments[r];C.end<=65535&&C.start<=65535?(d=d.concat({name:"end_"+r,type:"USHORT",value:C.end}),g=g.concat({name:"start_"+r,type:"USHORT",value:C.start}),v=v.concat({name:"idDelta_"+r,type:"SHORT",value:C.delta}),w=w.concat({name:"idRangeOffset_"+r,type:"USHORT",value:C.offset}),C.glyphId!==void 0&&(E=E.concat({name:"glyph_"+r,type:"USHORT",value:C.glyphId}))):h+=1,!e&&C.glyphIndex!==void 0&&(T=T.concat({name:"cmap12Start_"+r,type:"ULONG",value:C.start}),T=T.concat({name:"cmap12End_"+r,type:"ULONG",value:C.end}),T=T.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:C.glyphIndex}))}if(i.segCountX2=(c-h)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(c-h)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(d),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(g),i.fields=i.fields.concat(v),i.fields=i.fields.concat(w),i.fields=i.fields.concat(E),i.cmap4Length=14+d.length*2+2+g.length*2+v.length*2+w.length*2+E.length*2,!e){var k=16+T.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:k},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:T.length/3}]),i.fields=i.fields.concat(T)}return i}var Mp={parse:kp,make:Op},lo=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Dp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Fp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Qs=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function bu(t){this.font=t}bu.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function Ao(t,e){this.encoding=t,this.charset=e}Ao.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function Lp(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var gr={line:Lp};function Bp(t,e){var r=e||new $e;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function gt(t){this.bindConstructorValues(t)}gt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",Bp(this,t.path))};gt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};gt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};gt.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,a;n||(n={});var l=n.xScale,c=n.yScale;if(n.hinting&&o&&o.hinting&&(a=this.path&&o.hinting.exec(this,r)),a)i=o.hinting.getCommands(a),t=Math.round(t),e=Math.round(e),l=c=1;else{i=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=h),c===void 0&&(c=h)}for(var d=new $e,g=0;g<i.length;g+=1){var v=i[g];v.type==="M"?d.moveTo(t+v.x*l,e+-v.y*c):v.type==="L"?d.lineTo(t+v.x*l,e+-v.y*c):v.type==="Q"?d.quadraticCurveTo(t+v.x1*l,e+-v.y1*c,t+v.x*l,e+-v.y*c):v.type==="C"?d.curveTo(t+v.x1*l,e+-v.y1*c,t+v.x2*l,e+-v.y2*c,t+v.x*l,e+-v.y*c):v.type==="Z"&&d.closePath()}return d};gt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return te.argument(e.length===0,"There are still points left in the current contour."),t};gt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i};gt.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)};gt.prototype.drawPoints=function(t,e,r,n){function o(g,v,w,E){t.beginPath();for(var T=0;T<g.length;T+=1)t.moveTo(v+g[T].x*E,w+g[T].y*E),t.arc(v+g[T].x*E,w+g[T].y*E,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,a=[],l=[],c=this.path,h=0;h<c.commands.length;h+=1){var d=c.commands[h];d.x!==void 0&&a.push({x:d.x,y:-d.y}),d.x1!==void 0&&l.push({x:d.x1,y:-d.y1}),d.x2!==void 0&&l.push({x:d.x2,y:-d.y2})}t.fillStyle="blue",o(a,e,r,i),t.fillStyle="red",o(l,e,r,i)};gt.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",gr.line(t,e,-1e4,e,1e4),gr.line(t,-1e4,r,1e4,r);var i=this.xMin||0,a=this.yMin||0,l=this.xMax||0,c=this.yMax||0,h=this.advanceWidth||0;t.strokeStyle="blue",gr.line(t,e+i*o,-1e4,e+i*o,1e4),gr.line(t,e+l*o,-1e4,e+l*o,1e4),gr.line(t,-1e4,r+-a*o,1e4,r+-a*o),gr.line(t,-1e4,r+-c*o,1e4,r+-c*o),t.strokeStyle="green",gr.line(t,e+h*o,-1e4,e+h*o,1e4)};function ro(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Xi(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Xi.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};Xi.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function Up(t,e){return new gt({index:e,font:t})}function Ip(t,e,r,n,o,i){return function(){var a=new gt({index:e,font:t});return a.path=function(){r(a,n,o);var l=i(t.glyphs,a);return l.unitsPerEm=t.unitsPerEm,l},ro(a,"xMin","_xMin"),ro(a,"xMax","_xMax"),ro(a,"yMin","_yMin"),ro(a,"yMax","_yMax"),a}}function Gp(t,e,r,n){return function(){var o=new gt({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var Mt={GlyphSet:Xi,glyphLoader:Up,ttfGlyphLoader:Ip,cffGlyphLoader:Gp};function _u(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!_u(t[r],e[r]))return!1;return!0}else return!1}function Ri(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function tr(t,e,r){var n=[],o=[],i=ie.getCard16(t,e),a,l;if(i!==0){var c=ie.getByte(t,e+2);a=e+(i+1)*c+2;for(var h=e+3,d=0;d<i+1;d+=1)n.push(ie.getOffset(t,h,c)),h+=c;l=a+n[i]}else l=e+2;for(var g=0;g<n.length-1;g+=1){var v=ie.getBytes(t,a+n[g],a+n[g+1]);r&&(v=r(v)),o.push(v)}return{objects:o,startOffset:e,endOffset:l}}function Np(t,e){var r=[],n=ie.getCard16(t,e),o,i;if(n!==0){var a=ie.getByte(t,e+2);o=e+(n+1)*a+2;for(var l=e+3,c=0;c<n+1;c+=1)r.push(ie.getOffset(t,l,a)),l+=a;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function Vp(t,e,r,n,o){var i=ie.getCard16(r,n),a=0;if(i!==0){var l=ie.getByte(r,n+2);a=n+(i+1)*l+2}var c=ie.getBytes(r,a+e[t],a+e[t+1]);return o&&(c=o(c)),c}function Hp(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,a=o&15;if(i===r||(e+=n[i],a===r))break;e+=n[a]}return parseFloat(e)}function Wp(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return Hp(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function zp(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Su(t,e,r){e=e!==void 0?e:0;var n=new ie.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var a=n.parseByte();a<=21?(a===12&&(a=1200+n.parseByte()),o.push([a,i]),i=[]):i.push(Wp(n,a))}return zp(o)}function ln(t,e){return e<=390?e=lo[e]:e=t[e-391],e}function Eu(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var a=e[i];if(Array.isArray(a.type)){var l=[];l.length=a.type.length;for(var c=0;c<a.type.length;c++)o=t[a.op]!==void 0?t[a.op][c]:void 0,o===void 0&&(o=a.value!==void 0&&a.value[c]!==void 0?a.value[c]:null),a.type[c]==="SID"&&(o=ln(r,o)),l[c]=o;n[a.name]=l}else o=t[a.op],o===void 0&&(o=a.value!==void 0?a.value:null),a.type==="SID"&&(o=ln(r,o)),n[a.name]=o}return n}function $p(t,e){var r={};return r.formatMajor=ie.getCard8(t,e),r.formatMinor=ie.getCard8(t,e+1),r.size=ie.getCard8(t,e+2),r.offsetSize=ie.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Tu=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],xu=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Xp(t,e){var r=Su(t,0,t.byteLength);return Eu(r,Tu,e)}function Cu(t,e,r,n){var o=Su(t,e,r);return Eu(o,xu,n)}function Js(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var a=new DataView(new Uint8Array(r[i]).buffer),l=Xp(a,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var c=l.private[0],h=l.private[1];if(c!==0&&h!==0){var d=Cu(t,h+e,c,n);if(l._defaultWidthX=d.defaultWidthX,l._nominalWidthX=d.nominalWidthX,d.subrs!==0){var g=h+d.subrs,v=tr(t,g+e);l._subrs=v.objects,l._subrsBias=Ri(l._subrs)}l._privateDict=d}o.push(l)}return o}function Yp(t,e,r,n){var o,i,a=new ie.Parser(t,e);r-=1;var l=[".notdef"],c=a.parseCard8();if(c===0)for(var h=0;h<r;h+=1)o=a.parseSID(),l.push(ln(n,o));else if(c===1)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard8();for(var d=0;d<=i;d+=1)l.push(ln(n,o)),o+=1}else if(c===2)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard16();for(var g=0;g<=i;g+=1)l.push(ln(n,o)),o+=1}else throw new Error("Unknown charset format "+c);return l}function jp(t,e,r){var n,o={},i=new ie.Parser(t,e),a=i.parseCard8();if(a===0)for(var l=i.parseCard8(),c=0;c<l;c+=1)n=i.parseCard8(),o[n]=c;else if(a===1){var h=i.parseCard8();n=1;for(var d=0;d<h;d+=1)for(var g=i.parseCard8(),v=i.parseCard8(),w=g;w<=g+v;w+=1)o[w]=n,n+=1}else throw new Error("Unknown encoding format "+a);return new Ao(o,r)}function ea(t,e,r){var n,o,i,a,l=new $e,c=[],h=0,d=!1,g=!1,v=0,w=0,E,T,C,k;if(t.isCIDFont){var D=t.tables.cff.topDict._fdSelect[e.index],O=t.tables.cff.topDict._fdArray[D];E=O._subrs,T=O._subrsBias,C=O._defaultWidthX,k=O._nominalWidthX}else E=t.tables.cff.topDict._subrs,T=t.tables.cff.topDict._subrsBias,C=t.tables.cff.topDict._defaultWidthX,k=t.tables.cff.topDict._nominalWidthX;var $=C;function N(q,re){g&&l.closePath(),l.moveTo(q,re),g=!0}function Z(){var q;q=c.length%2!==0,q&&!d&&($=c.shift()+k),h+=c.length>>1,c.length=0,d=!0}function Y(q){for(var re,he,de,Ee,Te,ne,pe,me,J,Q,ce,ke,ve=0;ve<q.length;){var De=q[ve];switch(ve+=1,De){case 1:Z();break;case 3:Z();break;case 4:c.length>1&&!d&&($=c.shift()+k,d=!0),w+=c.pop(),N(v,w);break;case 5:for(;c.length>0;)v+=c.shift(),w+=c.shift(),l.lineTo(v,w);break;case 6:for(;c.length>0&&(v+=c.shift(),l.lineTo(v,w),c.length!==0);)w+=c.shift(),l.lineTo(v,w);break;case 7:for(;c.length>0&&(w+=c.shift(),l.lineTo(v,w),c.length!==0);)v+=c.shift(),l.lineTo(v,w);break;case 8:for(;c.length>0;)n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,v,w);break;case 10:Te=c.pop()+T,ne=E[Te],ne&&Y(ne);break;case 11:return;case 12:switch(De=q[ve],ve+=1,De){case 35:n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),pe=i+c.shift(),me=a+c.shift(),J=pe+c.shift(),Q=me+c.shift(),ce=J+c.shift(),ke=Q+c.shift(),v=ce+c.shift(),w=ke+c.shift(),c.shift(),l.curveTo(n,o,i,a,pe,me),l.curveTo(J,Q,ce,ke,v,w);break;case 34:n=v+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),pe=i+c.shift(),me=a,J=pe+c.shift(),Q=a,ce=J+c.shift(),ke=w,v=ce+c.shift(),l.curveTo(n,o,i,a,pe,me),l.curveTo(J,Q,ce,ke,v,w);break;case 36:n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),pe=i+c.shift(),me=a,J=pe+c.shift(),Q=a,ce=J+c.shift(),ke=Q+c.shift(),v=ce+c.shift(),l.curveTo(n,o,i,a,pe,me),l.curveTo(J,Q,ce,ke,v,w);break;case 37:n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),pe=i+c.shift(),me=a+c.shift(),J=pe+c.shift(),Q=me+c.shift(),ce=J+c.shift(),ke=Q+c.shift(),Math.abs(ce-v)>Math.abs(ke-w)?v=ce+c.shift():w=ke+c.shift(),l.curveTo(n,o,i,a,pe,me),l.curveTo(J,Q,ce,ke,v,w);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+De),c.length=0}break;case 14:c.length>0&&!d&&($=c.shift()+k,d=!0),g&&(l.closePath(),g=!1);break;case 18:Z();break;case 19:case 20:Z(),ve+=h+7>>3;break;case 21:c.length>2&&!d&&($=c.shift()+k,d=!0),w+=c.pop(),v+=c.pop(),N(v,w);break;case 22:c.length>1&&!d&&($=c.shift()+k,d=!0),v+=c.pop(),N(v,w);break;case 23:Z();break;case 24:for(;c.length>2;)n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,v,w);v+=c.shift(),w+=c.shift(),l.lineTo(v,w);break;case 25:for(;c.length>6;)v+=c.shift(),w+=c.shift(),l.lineTo(v,w);n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,v,w);break;case 26:for(c.length%2&&(v+=c.shift());c.length>0;)n=v,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i,w=a+c.shift(),l.curveTo(n,o,i,a,v,w);break;case 27:for(c.length%2&&(w+=c.shift());c.length>0;)n=v+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a,l.curveTo(n,o,i,a,v,w);break;case 28:re=q[ve],he=q[ve+1],c.push((re<<24|he<<16)>>16),ve+=2;break;case 29:Te=c.pop()+t.gsubrsBias,ne=t.gsubrs[Te],ne&&Y(ne);break;case 30:for(;c.length>0&&(n=v,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,w),c.length!==0);)n=v+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),w=a+c.shift(),v=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,w);break;case 31:for(;c.length>0&&(n=v+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),w=a+c.shift(),v=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,w),c.length!==0);)n=v,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,w);break;default:De<32?console.log("Glyph "+e.index+": unknown operator "+De):De<247?c.push(De-139):De<251?(re=q[ve],ve+=1,c.push((De-247)*256+re+108)):De<255?(re=q[ve],ve+=1,c.push(-(De-251)*256-re-108)):(re=q[ve],he=q[ve+1],de=q[ve+2],Ee=q[ve+3],ve+=4,c.push((re<<24|he<<16|de<<8|Ee)/65536))}}}return Y(r),e.advanceWidth=$,l}function qp(t,e,r,n){var o=[],i,a=new ie.Parser(t,e),l=a.parseCard8();if(l===0)for(var c=0;c<r;c++){if(i=a.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(l===3){var h=a.parseCard16(),d=a.parseCard16();if(d!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+d);for(var g,v=0;v<h;v++){if(i=a.parseCard8(),g=a.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(g>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+g);for(;d<g;d++)o.push(i);d=g}if(g!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+g)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return o}function Zp(t,e,r,n){r.tables.cff={};var o=$p(t,e),i=tr(t,o.endOffset,ie.bytesToString),a=tr(t,i.endOffset),l=tr(t,a.endOffset,ie.bytesToString),c=tr(t,l.endOffset);r.gsubrs=c.objects,r.gsubrsBias=Ri(r.gsubrs);var h=Js(t,e,a.objects,l.objects);if(h.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var d=h[0];if(r.tables.cff.topDict=d,d._privateDict&&(r.defaultWidthX=d._privateDict.defaultWidthX,r.nominalWidthX=d._privateDict.nominalWidthX),d.ros[0]!==void 0&&d.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var g=d.fdArray,v=d.fdSelect;if(g===0||v===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");g+=e;var w=tr(t,g),E=Js(t,e,w.objects,l.objects);d._fdArray=E,v+=e,d._fdSelect=qp(t,v,r.numGlyphs,E.length)}var T=e+d.private[1],C=Cu(t,T,d.private[0],l.objects);if(r.defaultWidthX=C.defaultWidthX,r.nominalWidthX=C.nominalWidthX,C.subrs!==0){var k=T+C.subrs,D=tr(t,k);r.subrs=D.objects,r.subrsBias=Ri(r.subrs)}else r.subrs=[],r.subrsBias=0;var O;n.lowMemory?(O=Np(t,e+d.charStrings),r.nGlyphs=O.offsets.length):(O=tr(t,e+d.charStrings),r.nGlyphs=O.objects.length);var $=Yp(t,e+d.charset,r.nGlyphs,l.objects);if(d.encoding===0?r.cffEncoding=new Ao(Dp,$):d.encoding===1?r.cffEncoding=new Ao(Fp,$):r.cffEncoding=jp(t,e+d.encoding,$),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Mt.GlyphSet(r),n.lowMemory)r._push=function(Y){var q=Vp(Y,O.offsets,t,e+d.charStrings);r.glyphs.push(Y,Mt.cffGlyphLoader(r,Y,ea,q))};else for(var N=0;N<r.nGlyphs;N+=1){var Z=O.objects[N];r.glyphs.push(N,Mt.cffGlyphLoader(r,N,ea,Z))}}function Pu(t,e){var r,n=lo.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+lo.length:(r=lo.length+e.length,e.push(t)),r}function Kp(){return new z.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Qp(t){var e=new z.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function ku(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],a=e[i.name];a!==void 0&&!_u(a,i.value)&&(i.type==="SID"&&(a=Pu(a,r)),n[i.op]={name:i.name,type:i.type,value:a})}return n}function ta(t,e){var r=new z.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ku(Tu,t,e),r}function ra(t){var e=new z.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function Jp(t){var e=new z.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function ed(){return new z.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function td(t,e){for(var r=new z.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=Pu(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function rd(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var a=void 0,l=void 0,c=r.commands[i];if(c.type==="Q"){var h=.3333333333333333,d=2/3;c={type:"C",x:c.x,y:c.y,x1:Math.round(h*n+d*c.x1),y1:Math.round(h*o+d*c.y1),x2:Math.round(h*c.x+d*c.x1),y2:Math.round(h*c.y+d*c.y1)}}if(c.type==="M")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="L")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="C"){var g=Math.round(c.x1-n),v=Math.round(c.y1-o),w=Math.round(c.x2-c.x1),E=Math.round(c.y2-c.y1);a=Math.round(c.x-c.x2),l=Math.round(c.y-c.y2),e.push({name:"dx1",type:"NUMBER",value:g}),e.push({name:"dy1",type:"NUMBER",value:v}),e.push({name:"dx2",type:"NUMBER",value:w}),e.push({name:"dy2",type:"NUMBER",value:E}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),o=Math.round(c.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function nd(t){for(var e=new z.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=rd(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function od(t,e){var r=new z.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ku(xu,t,e),r}function id(t,e){for(var r=new z.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},a=[],l,c=1;c<t.length;c+=1)l=t.get(c),a.push(l.name);var h=[];r.header=Kp(),r.nameIndex=Qp([e.postScriptName]);var d=ta(o,h);r.topDictIndex=ra(d),r.globalSubrIndex=ed(),r.charsets=td(a,h),r.charStringsIndex=nd(t),r.privateDict=od(i,h),r.stringIndex=Jp(h);var g=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=g,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),d=ta(o,h),r.topDictIndex=ra(d),r}var sd={parse:Zp,make:id};function ad(t,e){var r={},n=new ie.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),te.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function ud(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new z.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var ld={parse:ad,make:ud};function cd(t,e){var r={},n=new ie.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function fd(t){return new z.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var hd={parse:cd,make:fd};function pd(t,e,r,n,o){for(var i,a,l=new ie.Parser(t,e),c=0;c<n;c+=1){c<r&&(i=l.parseUShort(),a=l.parseShort());var h=o.get(c);h.advanceWidth=i,h.leftSideBearing=a}}function dd(t,e,r,n,o){t._hmtxTableData={};for(var i,a,l=new ie.Parser(e,r),c=0;c<o;c+=1)c<n&&(i=l.parseUShort(),a=l.parseShort()),t._hmtxTableData[c]={advanceWidth:i,leftSideBearing:a}}function vd(t,e,r,n,o,i,a){a.lowMemory?dd(t,e,r,n,o):pd(e,r,n,o,i)}function gd(t){for(var e=new z.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var md={parse:vd,make:gd};function yd(t){for(var e=new z.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function wd(t,e){var r=new ie.Parser(t,e),n=r.parseULong();te.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],a=0;a<o;a++){for(var l="",c=e+r.parseUShort(),h=r.parseUShort(),d=c;d<c+h;++d)l+=String.fromCharCode(t.getInt8(d));i.push(l)}return i}var bd={make:yd,parse:wd};function _d(t,e){var r={},n=new ie.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function Sd(t){return new z.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Ed={parse:_d,make:Sd},Au=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Ru={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Td={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Ou={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function xd(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return Ru[e];case 3:return Ou[e]}}var Oi="utf-16",Cd={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Pd={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Mu(t,e,r){switch(t){case 0:return Oi;case 1:return Pd[r]||Cd[e];case 3:if(e===1||e===10)return Oi;break}}function kd(t,e,r){for(var n={},o=new ie.Parser(t,e),i=o.parseUShort(),a=o.parseUShort(),l=o.offset+o.parseUShort(),c=0;c<a;c++){var h=o.parseUShort(),d=o.parseUShort(),g=o.parseUShort(),v=o.parseUShort(),w=Au[v]||v,E=o.parseUShort(),T=o.parseUShort(),C=xd(h,g,r),k=Mu(h,d,g);if(k!==void 0&&C!==void 0){var D=void 0;if(k===Oi?D=Vr.UTF16(t,l+T,E):D=Vr.MACSTRING(t,l+T,E,k),D){var O=n[w];O===void 0&&(O=n[w]={}),O[C]=D}}}return i===1&&o.parseUShort(),n}function ci(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function na(t,e,r,n,o,i){return new z.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function Ad(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function oa(t,e){var r=Ad(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function Rd(t,e){var r,n=[],o={},i=ci(Au);for(var a in t){var l=i[a];if(l===void 0&&(l=a),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');o[r]=t[a],n.push(r)}for(var c=ci(Ru),h=ci(Ou),d=[],g=[],v=0;v<n.length;v++){r=n[v];var w=o[r];for(var E in w){var T=w[E],C=1,k=c[E],D=Td[k],O=Mu(C,D,k),$=H.MACSTRING(T,O);$===void 0&&(C=0,k=e.indexOf(E),k<0&&(k=e.length,e.push(E)),D=4,$=H.UTF16(T));var N=oa($,g);d.push(na(C,D,k,r,$.length,N));var Z=h[E];if(Z!==void 0){var Y=H.UTF16(T),q=oa(Y,g);d.push(na(3,1,Z,r,Y.length,q))}}}d.sort(function(de,Ee){return de.platformID-Ee.platformID||de.encodingID-Ee.encodingID||de.languageID-Ee.languageID||de.nameID-Ee.nameID});for(var re=new z.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:d.length},{name:"stringOffset",type:"USHORT",value:6+d.length*12}]),he=0;he<d.length;he++)re.fields.push({name:"record_"+he,type:"RECORD",value:d[he]});return re.fields.push({name:"strings",type:"LITERAL",value:g}),re}var Od={parse:kd,make:Rd},Mi=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Md(t){for(var e=0;e<Mi.length;e+=1){var r=Mi[e];if(t>=r.begin&&t<r.end)return e}return-1}function Dd(t,e){var r={},n=new ie.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Fd(t){return new z.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var ia={parse:Dd,make:Fd,unicodeRanges:Mi,getUnicodeRange:Md};function Ld(t,e){var r={},n=new ie.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Qs.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=Qs.length){var a=n.parseChar();r.names.push(n.parseString(a))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function Bd(){return new z.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Ud={parse:Ld,make:Bd},_t=new Array(9);_t[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(P.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(P.coverage),substitute:this.parseOffset16List()};te.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};_t[2]=function(){var e=this.parseUShort();return te.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),sequences:this.parseListOfLists()}};_t[3]=function(){var e=this.parseUShort();return te.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),alternateSets:this.parseListOfLists()}};_t[4]=function(){var e=this.parseUShort();return te.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Br={sequenceIndex:P.uShort,lookupListIndex:P.uShort};_t[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(P.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Br)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(P.coverage),classDef:this.parsePointer(P.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Br)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,P.pointer(P.coverage)),lookupRecords:this.parseRecordList(o,Br)}}te.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};_t[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(P.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Br)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(P.coverage),backtrackClassDef:this.parsePointer(P.classDef),inputClassDef:this.parsePointer(P.classDef),lookaheadClassDef:this.parsePointer(P.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Br)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(P.pointer(P.coverage)),inputCoverage:this.parseList(P.pointer(P.coverage)),lookaheadCoverage:this.parseList(P.pointer(P.coverage)),lookupRecords:this.parseRecordList(Br)};te.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};_t[7]=function(){var e=this.parseUShort();te.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new P(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:_t[r].call(n)}};_t[8]=function(){var e=this.parseUShort();return te.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),backtrackCoverage:this.parseList(P.pointer(P.coverage)),lookaheadCoverage:this.parseList(P.pointer(P.coverage)),substitutes:this.parseUShortList()}};function Id(t,e){e=e||0;var r=new P(t,e),n=r.parseVersion(1);return te.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(_t)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(_t),variations:r.parseFeatureVariationsList()}}var zr=new Array(9);zr[1]=function(e){return e.substFormat===1?new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.ushortList("substitute",e.substitute)))};zr[2]=function(e){return te.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("seqSet",e.sequences,function(r){return new z.Table("sequenceSetTable",z.ushortList("sequence",r))})))};zr[3]=function(e){return te.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("altSet",e.alternateSets,function(r){return new z.Table("alternateSetTable",z.ushortList("alternate",r))})))};zr[4]=function(e){return te.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("ligSet",e.ligatureSets,function(r){return new z.Table("ligatureSetTable",z.tableList("ligature",r,function(n){return new z.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(z.ushortList("component",n.components,n.components.length+1)))}))})))};zr[6]=function(e){if(e.substFormat===1){var r=new z.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("chainRuleSet",e.chainRuleSets,function(i){return new z.Table("chainRuleSetTable",z.tableList("chainRule",i,function(a){var l=z.ushortList("backtrackGlyph",a.backtrack,a.backtrack.length).concat(z.ushortList("inputGlyph",a.input,a.input.length+1)).concat(z.ushortList("lookaheadGlyph",a.lookahead,a.lookahead.length)).concat(z.ushortList("substitution",[],a.lookupRecords.length));return a.lookupRecords.forEach(function(c,h){l=l.concat({name:"sequenceIndex"+h,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+h,type:"USHORT",value:c.lookupListIndex})}),new z.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)te.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,a){n.push({name:"backtrackCoverage"+a,type:"TABLE",value:new z.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,a){n.push({name:"inputCoverage"+a,type:"TABLE",value:new z.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,a){n.push({name:"lookaheadCoverage"+a,type:"TABLE",value:new z.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,a){n=n.concat({name:"sequenceIndex"+a,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+a,type:"USHORT",value:i.lookupListIndex})});var o=new z.Table("chainContextTable",n);return o}te.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Gd(t){return new z.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new z.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new z.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new z.LookupList(t.lookups,zr)}])}var Nd={parse:Id,make:Gd};function Vd(t,e){var r=new ie.Parser(t,e),n=r.parseULong();te.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},a=0;a<o;a++){var l=r.parseTag(),c=r.parseULong(),h=r.parseULong(),d=Vr.UTF8(t,e+c,h);i[l]=d}return i}function Hd(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new z.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var a=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+a}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var Wd={parse:Vd,make:Hd};function sa(t){return Math.log(t)/Math.log(2)|0}function Yi(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function aa(t,e,r,n){return new z.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function Du(t){var e=new z.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,sa(e.numTables));e.searchRange=16*r,e.entrySelector=sa(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+aa().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<t.length;a+=1){var l=t[a];te.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var c=l.sizeOf(),h=aa(l.tableName,Yi(l.encode()),i,c);for(n.push({name:h.tag+" Table Record",type:"RECORD",value:h}),o.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=c,te.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(d,g){return d.value.tag>g.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function ua(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function zd(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function $d(t){for(var e=[],r=[],n=[],o=[],i=[],a=[],l=[],c,h=0,d=0,g=0,v=0,w=0,E=0;E<t.glyphs.length;E+=1){var T=t.glyphs.get(E),C=T.unicode|0;if(isNaN(T.advanceWidth))throw new Error("Glyph "+T.name+" ("+E+"): advanceWidth is not a number.");(c>C||c===void 0)&&C>0&&(c=C),h<C&&(h=C);var k=ia.getUnicodeRange(C);if(k<32)d|=1<<k;else if(k<64)g|=1<<k-32;else if(k<96)v|=1<<k-64;else if(k<123)w|=1<<k-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(T.name!==".notdef"){var D=T.getMetrics();e.push(D.xMin),r.push(D.yMin),n.push(D.xMax),o.push(D.yMax),a.push(D.leftSideBearing),l.push(D.rightSideBearing),i.push(T.advanceWidth)}}var O={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:zd(i),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,l)};O.ascender=t.ascender,O.descender=t.descender;var $=ld.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:O.xMin,yMin:O.yMin,xMax:O.xMax,yMax:O.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),N=hd.make({ascender:O.ascender,descender:O.descender,advanceWidthMax:O.advanceWidthMax,minLeftSideBearing:O.minLeftSideBearing,minRightSideBearing:O.minRightSideBearing,xMaxExtent:O.maxLeftSideBearing+(O.xMax-O.xMin),numberOfHMetrics:t.glyphs.length}),Z=Ed.make(t.glyphs.length),Y=ia.make(Object.assign({xAvgCharWidth:Math.round(O.advanceWidthAvg),usFirstCharIndex:c,usLastCharIndex:h,ulUnicodeRange1:d,ulUnicodeRange2:g,ulUnicodeRange3:v,ulUnicodeRange4:w,sTypoAscender:O.ascender,sTypoDescender:O.descender,sTypoLineGap:0,usWinAscent:O.yMax,usWinDescent:Math.abs(O.yMin),ulCodePageRange1:1,sxHeight:ua(t,"xyvw",{yMax:Math.round(O.ascender/2)}).yMax,sCapHeight:ua(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",O).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),q=md.make(t.glyphs),re=Mp.make(t.glyphs),he=t.getEnglishName("fontFamily"),de=t.getEnglishName("fontSubfamily"),Ee=he+" "+de,Te=t.getEnglishName("postScriptName");Te||(Te=he.replace(/\s/g,"")+"-"+de);var ne={};for(var pe in t.names)ne[pe]=t.names[pe];ne.uniqueID||(ne.uniqueID={en:t.getEnglishName("manufacturer")+":"+Ee}),ne.postScriptName||(ne.postScriptName={en:Te}),ne.preferredFamily||(ne.preferredFamily=t.names.fontFamily),ne.preferredSubfamily||(ne.preferredSubfamily=t.names.fontSubfamily);var me=[],J=Od.make(ne,me),Q=me.length>0?bd.make(me):void 0,ce=Ud.make(),ke=sd.make(t.glyphs,{version:t.getEnglishName("version"),fullName:Ee,familyName:he,weightName:de,postScriptName:Te,unitsPerEm:t.unitsPerEm,fontBBox:[0,O.yMin,O.ascender,O.advanceWidthMax]}),ve=t.metas&&Object.keys(t.metas).length>0?Wd.make(t.metas):void 0,De=[$,N,Z,Y,J,re,ce,ke,q];Q&&De.push(Q),t.tables.gsub&&De.push(Nd.make(t.tables.gsub)),ve&&De.push(ve);for(var mt=Du(De),qe=mt.encode(),Xe=Yi(qe),nt=mt.fields,jt=!1,at=0;at<nt.length;at+=1)if(nt[at].name==="head table"){nt[at].value.checkSumAdjustment=2981146554-Xe,jt=!0;break}if(!jt)throw new Error("Could not find head table with checkSum to adjust.");return mt}var Xd={make:Du,fontToTable:$d,computeCheckSum:Yi};function fi(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function la(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function ca(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var a=r.start;if(a===e)return r;a<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function xn(t,e){this.font=t,this.tableName=e}xn.prototype={searchTag:fi,binSearch:la,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=fi(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=fi(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,a=o.featureIndexes,l=this.font.tables[this.tableName].features,c=0;c<a.length;c++)if(i=l[a[c]],i.tag===r)return i.feature;if(n){var h=l.length;return te.assert(h===0||r>=l[h-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(i),a.push(h),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),a=[];if(i){for(var l,c=i.lookupListIndexes,h=this.font.tables[this.tableName].lookups,d=0;d<c.length;d++)l=h[c[d]],l.lookupType===n&&a.push(l);if(a.length===0&&o){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var g=h.length;return h.push(l),c.push(g),[l]}}return a},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=ca(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=la(t.glyphs,e);return r>=0?r:-1;case 2:var n=ca(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,a=o.end,l=i;l<=a;l++)e.push(l);return e}};function Cn(t){xn.call(this,t,"gpos")}Cn.prototype=xn.prototype;Cn.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};Cn.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var a=o[i],l=this.getCoverageIndex(a.coverage,e);if(!(l<0))switch(a.posFormat){case 1:for(var c=a.pairSets[l],h=0;h<c.length;h++){var d=c[h];if(d.secondGlyph===r)return d.value1&&d.value1.xAdvance||0}break;case 2:var g=this.getGlyphClass(a.classDef1,e),v=this.getGlyphClass(a.classDef2,r),w=a.classRecords[g][v];return w.value1&&w.value1.xAdvance||0}}return 0};Cn.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function ht(t){xn.call(this,t,"gsub")}function Yd(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function ji(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}ht.prototype=xn.prototype;ht.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};ht.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),d=void 0;if(c.substFormat===1){var g=c.deltaGlyphId;for(d=0;d<h.length;d++){var v=h[d];n.push({sub:v,by:v+g})}}else{var w=c.substitute;for(d=0;d<h.length;d++)n.push({sub:h[d],by:w[d]})}}return n};ht.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),d=void 0;for(d=0;d<h.length;d++){var g=h[d],v=c.sequences[d];n.push({sub:g,by:v})}}return n};ht.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),d=c.alternateSets,g=0;g<h.length;g++)n.push({sub:h[g],by:d[g]});return n};ht.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),d=c.ligatureSets,g=0;g<h.length;g++)for(var v=h[g],w=d[g],E=0;E<w.length;E++){var T=w[E];n.push({sub:[v].concat(T.components),by:T.ligGlyph})}return n};ht.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=ji(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});te.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.substitute.splice(l,0,0)),i.substitute[l]=e.by};ht.prototype.addMultiple=function(t,e,r,n){te.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=ji(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});te.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.sequences.splice(l,0,0)),i.sequences[l]=e.by};ht.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=ji(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});te.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by};ht.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),te.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var a=e.sub[0],l=e.sub.slice(1),c={ligGlyph:e.by,components:l},h=this.binSearch(i.coverage.glyphs,a);if(h>=0){for(var d=i.ligatureSets[h],g=0;g<d.length;g++)if(Yd(d[g].components,l))return;d.push(c)}else h=-1-h,i.coverage.glyphs.splice(h,0,a),i.ligatureSets.splice(h,0,[c])};ht.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};ht.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function jd(){return typeof window<"u"}function qd(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Jr(t,e){if(!t)throw e}function fa(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),e&o||(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function Fu(t,e,r){var n=new ie.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var a=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)a.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var c=0;c<t.instructionLength;c+=1)t.instructions.push(n.parseByte());var h=a[a.length-1]+1;o=[];for(var d=0;d<h;d+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var g=n.parseByte(),v=0;v<g;v+=1)o.push(i),d+=1;if(te.argument(o.length===h,"Bad flags."),a.length>0){var w=[],E;if(h>0){for(var T=0;T<h;T+=1)i=o[T],E={},E.onCurve=!!(i&1),E.lastPointOfContour=a.indexOf(T)>=0,w.push(E);for(var C=0,k=0;k<h;k+=1)i=o[k],E=w[k],E.x=fa(n,i,C,2,16),C=E.x;for(var D=0,O=0;O<h;O+=1)i=o[O],E=w[O],E.y=fa(n,i,D,4,32),D=E.y}t.points=w}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var $=!0;$;){o=n.parseUShort();var N={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(N.dx=n.parseShort(),N.dy=n.parseShort()):N.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(N.dx=n.parseChar(),N.dy=n.parseChar()):N.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?N.xScale=N.yScale=n.parseF2Dot14():(o&64)>0?(N.xScale=n.parseF2Dot14(),N.yScale=n.parseF2Dot14()):(o&128)>0&&(N.xScale=n.parseF2Dot14(),N.scale01=n.parseF2Dot14(),N.scale10=n.parseF2Dot14(),N.yScale=n.parseF2Dot14()),t.components.push(N),$=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var Z=0;Z<t.instructionLength;Z+=1)t.instructions.push(n.parseByte())}}}function hi(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function Zd(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return te.argument(r.length===0,"There are still points left in the current contour."),e}function Lu(t){var e=new $e;if(!t)return e;for(var r=Zd(t),n=0;n<r.length;++n){var o=r[n],i=null,a=o[o.length-1],l=o[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var c={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5};e.moveTo(c.x,c.y)}for(var h=0;h<o.length;++h)if(i=a,a=l,l=o[(h+1)%o.length],a.onCurve)e.lineTo(a.x,a.y);else{var d=l;i.onCurve||((a.x+i.x)*.5,(a.y+i.y)*.5),l.onCurve||(d={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5}),e.quadraticCurveTo(a.x,a.y,d.x,d.y)}e.closePath()}return e}function Bu(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=hi(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[n.matchedPoints[0]],l=o.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=hi([l],c)[0],c.dx=a.x-l.x,c.dy=a.y-l.y,i=hi(o.points,c)}e.points=e.points.concat(i)}}return Lu(e.points)}function Kd(t,e,r,n){for(var o=new Mt.GlyphSet(n),i=0;i<r.length-1;i+=1){var a=r[i],l=r[i+1];a!==l?o.push(i,Mt.ttfGlyphLoader(n,i,Fu,t,e+a,Bu)):o.push(i,Mt.glyphLoader(n,i))}return o}function Qd(t,e,r,n){var o=new Mt.GlyphSet(n);return n._push=function(i){var a=r[i],l=r[i+1];a!==l?o.push(i,Mt.ttfGlyphLoader(n,i,Fu,t,e+a,Bu)):o.push(i,Mt.glyphLoader(n,i))},o}function Jd(t,e,r,n,o){return o.lowMemory?Qd(t,e,r,n):Kd(t,e,r,n)}var ev={getPath:Lu,parse:Jd},Uu,Tr,Iu,Di;function Gu(t){this.font=t,this.getCommands=function(e){return ev.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function tv(t){return t}function Nu(t){return Math.sign(t)*Math.round(Math.abs(t))}function rv(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function nv(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function ov(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function iv(t){return Math.sign(t)*Math.floor(Math.abs(t))}var Vu=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},Ot={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,d;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,c=e.x-e.xo,h=r.x-r.xo,a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){t.x=t.xo+(c+h)/2;return}t.x=t.xo+(c*l+h*a)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){Ot.setRelative(t,t,(c+h)/2,n,!0);return}Ot.setRelative(t,t,(c*l+h*a)/d,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.x=l+(t.y-c)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},Wt={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,d;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,c=e.y-e.yo,h=r.y-r.yo,a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){t.y=t.yo+(c+h)/2;return}t.y=t.yo+(c*l+h*a)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){Wt.setRelative(t,t,(c+h)/2,n,!0);return}Wt.setRelative(t,t,(c*l+h*a)/d,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.y=c+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(Ot);Object.freeze(Wt);function Pn(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}Pn.prototype.distance=function(t,e,r,n){return this.x*Ot.distance(t,e,r,n)+this.y*Wt.distance(t,e,r,n)};Pn.prototype.interpolate=function(t,e,r,n){var o,i,a,l,c,h,d;if(a=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),c=Math.abs(a),h=Math.abs(l),d=c+h,d===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*h+i*c)/d,n,!0)};Pn.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y,h=n.normalSlope,d=this.slope,g=t.x,v=t.y;t.x=(d*g-h*l+c-v)/(d-h),t.y=d*(t.x-g)+v};Pn.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function kn(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?Ot:t===0&&e===1?Wt:new Pn(t,e)}function $t(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}$t.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};$t.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var mn=Object.freeze(new $t(0,0)),sv={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function or(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Ot,this.round=Nu}}Gu.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){or.prototype=sv,o=this._fpgmState=new or("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,R.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{Tr(o)}catch(h){console.log("Hinting error in FPGM:"+h),this._errorState=3;return}}or.prototype=o,n=this._prepState=new or("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var a=n.cvt=new Array(i.length),l=e/r.unitsPerEm,c=0;c<i.length;c++)a[c]=i[c]*l;else n.cvt=[];R.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{Tr(n)}catch(h){this._errorState<2&&console.log("Hinting error in PREP:"+h),this._errorState=2}}if(!(this._errorState>1))try{return Iu(t,n)}catch(h){this._errorState<1&&(console.log("Hinting error:"+h),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};Iu=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,a,l;if(or.prototype=e,!o)l=new or("glyf",t.instructions),R.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),Di(t,l,r,n),a=l.gZone;else{var c=e.font;a=[],i=[];for(var h=0;h<o.length;h++){var d=o[h],g=c.glyphs.get(d.glyphIndex);l=new or("glyf",g.instructions),R.DEBUG&&(console.log("---EXEC COMP "+h+"---"),l.step=-1),Di(g,l,r,n);for(var v=Math.round(d.dx*r),w=Math.round(d.dy*n),E=l.gZone,T=l.contours,C=0;C<E.length;C++){var k=E[C];k.xTouched=k.yTouched=!1,k.xo=k.x=k.x+v,k.yo=k.y=k.y+w}var D=a.length;a.push.apply(a,E);for(var O=0;O<T.length;O++)i.push(T[O]+D)}t.instructions&&!l.inhibitGridFit&&(l=new or("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=a,l.contours=i,a.push(new $t(0,0),new $t(Math.round(t.advanceWidth*r),0)),R.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),Tr(l),a.length-=2)}return a};Di=function(t,e,r,n){for(var o=t.points||[],i=o.length,a=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],c,h=0;h<i;h++)c=o[h],a[h]=new $t(c.x*r,c.y*n,c.lastPointOfContour,c.onCurve);for(var d,g,v=0;v<i;v++)c=a[v],d||(d=c,l.push(v)),c.lastPointOfContour?(c.nextPointOnContour=d,d.prevPointOnContour=c,d=void 0):(g=a[v+1],c.nextPointOnContour=g,g.prevPointOnContour=c);if(!e.inhibitGridFit){if(R.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var w=0;w<i;w++)console.log(w,a[w].x,a[w].y)}if(a.push(new $t(0,0),new $t(Math.round(t.advanceWidth*r),0)),Tr(e),a.length-=2,R.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var E=0;E<i;E++)console.log(E,a[E].x,a[E].y)}}};Tr=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(R.DEBUG&&t.step++,n=Uu[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function Uo(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new $t(0,0)}function Hu(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function ha(t,e){R.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function pa(t,e){R.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function da(t,e){R.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function va(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log("SPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.pv=e.dpv=kn(l,c)}function ga(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log("SFVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.fv=kn(l,c)}function av(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=kn(n,r)}function uv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=kn(n,r)}function lv(t){var e=t.stack,r=t.pv;R.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function cv(t){var e=t.stack,r=t.fv;R.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function fv(t){t.fv=t.pv,R.DEBUG&&console.log(t.step,"SFVTPV[]")}function hv(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),a=e.pop(),l=t.z0,c=t.z1,h=l[r],d=l[n],g=c[o],v=c[i],w=t.z2[a];R.DEBUG&&console.log("ISECT[], ",r,n,o,i,a);var E=h.x,T=h.y,C=d.x,k=d.y,D=g.x,O=g.y,$=v.x,N=v.y,Z=(E-C)*(O-N)-(T-k)*(D-$),Y=E*k-T*C,q=D*N-O*$;w.x=(Y*(D-$)-q*(E-C))/Z,w.y=(Y*(O-N)-q*(T-k))/Z}function pv(t){t.rp0=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function dv(t){t.rp1=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function vv(t){t.rp2=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function gv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||Uo(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function mv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||Uo(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function yv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||Uo(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function wv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||Uo(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function bv(t){t.loop=t.stack.pop(),R.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function _v(t){R.DEBUG&&console.log(t.step,"RTG[]"),t.round=Nu}function Sv(t){R.DEBUG&&console.log(t.step,"RTHG[]"),t.round=nv}function Ev(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Tv(t){R.DEBUG&&console.log(t.step,"ELSE[]"),Hu(t,!1)}function xv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Cv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function Pv(t){var e=t.stack;R.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function pi(t){R.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function kv(t){R.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function Av(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function Rv(t){var e=t.stack;R.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function Ov(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var a=0;a<n;a++)Tr(t),R.DEBUG&&console.log(++t.step,a+1<n?"next loopcall":"done loopcall",a);t.ip=o,t.prog=i}function Mv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],Tr(t),t.ip=r,t.prog=n,R.DEBUG&&console.log(++t.step,"returning from",e)}function Dv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function Fv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function Lv(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(R.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function ma(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;R.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var a=i.distance(n,mn);t&&(a=e.round(a)),o.setRelative(n,mn,a,i),o.touch(n),e.rp0=e.rp1=r}function ya(t,e){var r=e.z2,n=r.length-2,o,i,a;R.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)o=r[l],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(a=o.nextTouched(t),i===a&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,a,t)))}function wa(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=e.loop,c=e.z2;l--;){var h=r.pop(),d=c[h],g=a.distance(o,o,!1,!0);i.setRelative(d,d,g,a),i.touch(d),R.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",h)}e.loop=1}function ba(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop(),c=e.z2[e.contours[l]],h=c;R.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var d=a.distance(o,o,!1,!0);do h!==o&&i.setRelative(h,h,d,a),h=h.nextPointOnContour;while(h!==c)}function _a(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop();R.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var c;switch(l){case 0:c=e.tZone;break;case 1:c=e.gZone;break;default:throw new Error("Invalid zone")}for(var h,d=a.distance(o,o,!1,!0),g=c.length-2,v=0;v<g;v++)h=c[v],i.setRelative(h,h,d,a)}function Bv(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var a=e.pop(),l=i[a];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",a,o),n.setRelative(l,l,o),n.touch(l)}t.loop=1}function Uv(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],a=t.z1[n],l=t.fv,c=t.dpv,h=t.z2;o--;){var d=e.pop(),g=h[d];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",d,r,"<->",n),l.interpolate(g,i,a,c),l.touch(g)}t.loop=1}function Sa(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],a=e.z0[e.rp0],l=e.fv,c=e.pv;l.setRelative(i,a,n,c),l.touch(i),R.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function Iv(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,a=t.pv,l=t.z1;o--;){var c=e.pop(),h=l[c];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",c),i.setRelative(h,n,0,a),i.touch(h)}t.loop=1}function Gv(t){R.DEBUG&&console.log(t.step,"RTDG[]"),t.round=rv}function Ea(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],a=e.fv,l=e.pv,c=e.cvt[n];R.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",c,")",o);var h=l.distance(i,mn);t&&(Math.abs(h-c)<e.cvCutIn&&(h=c),h=e.round(h)),a.setRelative(i,mn,h,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),a.touch(i),e.rp0=e.rp1=o}function Nv(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];R.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function Vv(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];R.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var a=r[++e]<<8|r[++e];a&32768&&(a=-((a^65535)+1)),n.push(a)}t.ip=e}function Hv(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();R.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function Wv(t){var e=t.stack,r=t.store,n=e.pop();R.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function zv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function $v(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function Ta(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];R.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,mn,t,!1)*64)}function xa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],a=e.z0[o],l=e.dpv.distance(a,i,t,t);R.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",l),e.stack.push(Math.round(l*64))}function Xv(t){R.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function Yv(t){R.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function jv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function qv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function Zv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function Kv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function Qv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function Jv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function eg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function tg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function rg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"IF[]",e),e||(Hu(t,!0),R.DEBUG&&console.log(t.step,"EIF[]"))}function ng(t){R.DEBUG&&console.log(t.step,"EIF[]")}function og(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function ig(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function sg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function di(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,a=e.ppem,l=e.deltaBase+(t-1)*16,c=e.deltaShift,h=e.z0;R.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var d=0;d<n;d++){var g=r.pop(),v=r.pop(),w=l+((v&240)>>4);if(w===a){var E=(v&15)-8;E>=0&&E++,R.DEBUG&&console.log(e.step,"DELTAPFIX",g,"by",E*c);var T=h[g];o.setRelative(T,T,E*c,i)}}}function ag(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function ug(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function lg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function cg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function fg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function hg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function pg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function dg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function vg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function gg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function no(t,e){var r=e.stack,n=r.pop();R.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function mg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function vi(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,a=e.deltaShift;R.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var c=r.pop(),h=r.pop(),d=i+((h&240)>>4);if(d===o){var g=(h&15)-8;g>=0&&g++;var v=g*a;R.DEBUG&&console.log(e.step,"DELTACFIX",c,"by",v),e.cvt[c]+=v}}}function yg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=Vu;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function wg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=Vu;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function bg(t){R.DEBUG&&console.log(t.step,"ROFF[]"),t.round=tv}function _g(t){R.DEBUG&&console.log(t.step,"RUTG[]"),t.round=ov}function Sg(t){R.DEBUG&&console.log(t.step,"RDTG[]"),t.round=iv}function Eg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function Ca(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.dpv=kn(l,c)}function Tg(t){var e=t.stack,r=e.pop(),n=0;R.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function xg(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();R.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function Cg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function Pg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function kg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function Ag(t){var e=t.stack.pop(),r=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Jt(t,e){var r=e.stack,n=e.prog,o=e.ip;R.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function er(t,e){var r=e.ip,n=e.prog,o=e.stack;R.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var a=n[++r]<<8|n[++r];a&32768&&(a=-((a^65535)+1)),o.push(a)}e.ip=r}function W(t,e,r,n,o,i){var a=i.stack,l=t&&a.pop(),c=a.pop(),h=i.rp0,d=i.z0[h],g=i.z1[c],v=i.minDis,w=i.fv,E=i.dpv,T,C,k,D;C=T=E.distance(g,d,!0,!0),k=C>=0?1:-1,C=Math.abs(C),t&&(D=i.cvt[l],n&&Math.abs(C-D)<i.cvCutIn&&(C=D)),r&&C<v&&(C=v),n&&(C=i.round(C)),w.setRelative(g,d,k*C,E),w.touch(g),R.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?l+"("+i.cvt[l]+","+D+")":"",c,"(d =",T,"->",k*C,")"),i.rp1=i.rp0,i.rp2=c,e&&(i.rp0=c)}Uu=[ha.bind(void 0,Wt),ha.bind(void 0,Ot),pa.bind(void 0,Wt),pa.bind(void 0,Ot),da.bind(void 0,Wt),da.bind(void 0,Ot),va.bind(void 0,0),va.bind(void 0,1),ga.bind(void 0,0),ga.bind(void 0,1),av,uv,lv,cv,fv,hv,pv,dv,vv,gv,mv,yv,wv,bv,_v,Sv,Ev,Tv,xv,Cv,void 0,void 0,Pv,pi,kv,Av,Rv,Dv,Fv,void 0,void 0,void 0,Ov,Mv,Lv,void 0,ma.bind(void 0,0),ma.bind(void 0,1),ya.bind(void 0,Wt),ya.bind(void 0,Ot),wa.bind(void 0,0),wa.bind(void 0,1),ba.bind(void 0,0),ba.bind(void 0,1),_a.bind(void 0,0),_a.bind(void 0,1),Bv,Uv,Sa.bind(void 0,0),Sa.bind(void 0,1),Iv,Gv,Ea.bind(void 0,0),Ea.bind(void 0,1),Nv,Vv,Hv,Wv,zv,$v,Ta.bind(void 0,0),Ta.bind(void 0,1),void 0,xa.bind(void 0,0),xa.bind(void 0,1),Xv,void 0,Yv,void 0,void 0,jv,qv,Zv,Kv,Qv,Jv,eg,tg,rg,ng,og,ig,sg,di.bind(void 0,1),ag,ug,lg,cg,fg,hg,pg,dg,vg,gg,no.bind(void 0,0),no.bind(void 0,1),no.bind(void 0,2),no.bind(void 0,3),void 0,void 0,void 0,void 0,mg,di.bind(void 0,2),di.bind(void 0,3),vi.bind(void 0,1),vi.bind(void 0,2),vi.bind(void 0,3),yg,wg,void 0,void 0,bg,void 0,_g,Sg,pi,pi,void 0,void 0,void 0,void 0,void 0,Eg,Ca.bind(void 0,0),Ca.bind(void 0,1),Tg,void 0,xg,Cg,Pg,kg,Ag,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Jt.bind(void 0,1),Jt.bind(void 0,2),Jt.bind(void 0,3),Jt.bind(void 0,4),Jt.bind(void 0,5),Jt.bind(void 0,6),Jt.bind(void 0,7),Jt.bind(void 0,8),er.bind(void 0,1),er.bind(void 0,2),er.bind(void 0,3),er.bind(void 0,4),er.bind(void 0,5),er.bind(void 0,6),er.bind(void 0,7),er.bind(void 0,8),W.bind(void 0,0,0,0,0,0),W.bind(void 0,0,0,0,0,1),W.bind(void 0,0,0,0,0,2),W.bind(void 0,0,0,0,0,3),W.bind(void 0,0,0,0,1,0),W.bind(void 0,0,0,0,1,1),W.bind(void 0,0,0,0,1,2),W.bind(void 0,0,0,0,1,3),W.bind(void 0,0,0,1,0,0),W.bind(void 0,0,0,1,0,1),W.bind(void 0,0,0,1,0,2),W.bind(void 0,0,0,1,0,3),W.bind(void 0,0,0,1,1,0),W.bind(void 0,0,0,1,1,1),W.bind(void 0,0,0,1,1,2),W.bind(void 0,0,0,1,1,3),W.bind(void 0,0,1,0,0,0),W.bind(void 0,0,1,0,0,1),W.bind(void 0,0,1,0,0,2),W.bind(void 0,0,1,0,0,3),W.bind(void 0,0,1,0,1,0),W.bind(void 0,0,1,0,1,1),W.bind(void 0,0,1,0,1,2),W.bind(void 0,0,1,0,1,3),W.bind(void 0,0,1,1,0,0),W.bind(void 0,0,1,1,0,1),W.bind(void 0,0,1,1,0,2),W.bind(void 0,0,1,1,0,3),W.bind(void 0,0,1,1,1,0),W.bind(void 0,0,1,1,1,1),W.bind(void 0,0,1,1,1,2),W.bind(void 0,0,1,1,1,3),W.bind(void 0,1,0,0,0,0),W.bind(void 0,1,0,0,0,1),W.bind(void 0,1,0,0,0,2),W.bind(void 0,1,0,0,0,3),W.bind(void 0,1,0,0,1,0),W.bind(void 0,1,0,0,1,1),W.bind(void 0,1,0,0,1,2),W.bind(void 0,1,0,0,1,3),W.bind(void 0,1,0,1,0,0),W.bind(void 0,1,0,1,0,1),W.bind(void 0,1,0,1,0,2),W.bind(void 0,1,0,1,0,3),W.bind(void 0,1,0,1,1,0),W.bind(void 0,1,0,1,1,1),W.bind(void 0,1,0,1,1,2),W.bind(void 0,1,0,1,1,3),W.bind(void 0,1,1,0,0,0),W.bind(void 0,1,1,0,0,1),W.bind(void 0,1,1,0,0,2),W.bind(void 0,1,1,0,0,3),W.bind(void 0,1,1,0,1,0),W.bind(void 0,1,1,0,1,1),W.bind(void 0,1,1,0,1,2),W.bind(void 0,1,1,0,1,3),W.bind(void 0,1,1,1,0,0),W.bind(void 0,1,1,1,0,1),W.bind(void 0,1,1,1,0,2),W.bind(void 0,1,1,1,0,3),W.bind(void 0,1,1,1,1,0),W.bind(void 0,1,1,1,1,1),W.bind(void 0,1,1,1,1,2),W.bind(void 0,1,1,1,1,3)];function $r(t){this.char=t,this.state={},this.activeState=null}function qi(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function Rg(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function St(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Io(t){this.eventId=t,this.subscribers=[]}function Og(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Io(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Ve(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Og.call(this,t)}$r.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};$r.prototype.getState=function(t){return this.state[t]||null};Ve.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};Ve.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])};Ve.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(a){return a instanceof $r});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Ve.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof $r){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};Ve.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};Ve.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};Ve.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof $r});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};Ve.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],a=e===null||e.apply(this,i)===!0,l=[n,o];if(a){var c=r.apply(this,l);n.setState(t,c)}}),this.registeredModifiers.push(t)};Io.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Io.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};St.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};St.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};Ve.prototype.rangeToText=function(t){if(t instanceof qi)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};Ve.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};Ve.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};Ve.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};Ve.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Io&&n.subscribers.forEach(function(o){o.apply(r,e||[])})};Ve.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new Rg(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};Ve.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};Ve.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};Ve.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};Ve.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new St(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Ve.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new qi(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n};Ve.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new qi(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),i&&n.checkEnd(t)){var a=r-i.startIndex+1,l=e.setEndOffset(a,o);e.dispatch("contextEnd",[o,l])}})};Ve.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new St(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new $r(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function sr(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Wu(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function ur(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function co(t){return/[A-z]/.test(t)}function Mg(t){return/\s/.test(t)}function pt(t){this.font=t,this.features={}}function yr(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function An(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function Dg(t,e){var r=An(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function Fg(t,e){var r=An(t,e.coverage);return r===-1?null:e.substitute[r]}function gi(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var a=An(i,o);a!==-1&&r.push(a)}return r.length!==t.length?-1:r}function Lg(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=gi(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&ur(i[0].char);)i.shift();var a=new St(i,0),l=gi(e.lookaheadCoverage,a),c=[].concat(t.backtrack);for(c.reverse();c.length&&ur(c[0].char);)c.shift();if(c.length<e.backtrackCoverage.length)return[];var h=new St(c,0),d=gi(e.backtrackCoverage,h),g=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&d.length===e.backtrackCoverage.length,v=[];if(g)for(var w=0;w<e.lookupRecords.length;w++)for(var E=e.lookupRecords[w],T=E.lookupListIndex,C=this.getLookupByIndex(T),k=0;k<C.subtables.length;k++){var D=C.subtables[k],O=this.getLookupMethod(C,D),$=this.getSubstitutionType(C,D);if($==="12")for(var N=0;N<n.length;N++){var Z=t.get(N),Y=O(Z);Y&&v.push(Y)}}return v}function Bg(t,e){var r=t.current,n=An(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],a=0;a<i.length;a++){o=i[a];for(var l=0;l<o.components.length;l++){var c=t.lookahead[l],h=o.components[l];if(c!==h)break;if(l===o.components.length-1)return o}}return null}function Ug(t,e){var r=An(t,e.coverage);return r===-1?null:e.sequences[r]}pt.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};pt.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var a=0;a<i.length;a++){var l=i[a];if(l.tag===t){var c=l.langSys;return c.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};pt.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r};pt.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};pt.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};pt.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return Dg.apply(r,[o,e])};case"12":return function(o){return Fg.apply(r,[o,e])};case"63":return function(o){return Lg.apply(r,[o,e])};case"41":return function(o){return Bg.apply(r,[o,e])};case"21":return function(o){return Ug.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};pt.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),a=0;a<o.length;a++)for(var l=o[a],c=this.getLookupSubtables(l),h=0;h<c.length;h++){var d=c[h],g=this.getSubstitutionType(l,d),v=this.getLookupMethod(l,d),w=void 0;switch(g){case"11":w=v(e.current),w&&i.splice(r,1,new yr({id:11,tag:t.tag,substitution:w}));break;case"12":w=v(e.current),w&&i.splice(r,1,new yr({id:12,tag:t.tag,substitution:w}));break;case"63":w=v(e),Array.isArray(w)&&w.length&&i.splice(r,1,new yr({id:63,tag:t.tag,substitution:w}));break;case"41":w=v(e),w&&i.splice(r,1,new yr({id:41,tag:t.tag,substitution:w}));break;case"21":w=v(e.current),w&&i.splice(r,1,new yr({id:21,tag:t.tag,substitution:w}));break}e=new St(i,r),!(Array.isArray(w)&&!w.length)&&(w=null)}return i.length?i:null};pt.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};pt.prototype.getLookupSubtables=function(t){return t.subtables||null};pt.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};pt.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};pt.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function Ig(t){var e=t.current,r=t.get(-1);return r===null&&sr(e)||!sr(r)&&sr(e)}function Gg(t){var e=t.get(1);return e===null||!sr(e)}var Ng={startCheck:Ig,endCheck:Gg};function Vg(t){var e=t.current,r=t.get(-1);return(sr(e)||ur(e))&&!sr(r)}function Hg(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!sr(e)&&!ur(e)):var r=Mg(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return sr(o)||ur(o)}),!n)return!0}break;default:return!1}}var Wg={startCheck:Vg,endCheck:Hg};function zg(t,e,r){e[r].setState(t.tag,t.substitution)}function $g(t,e,r){e[r].setState(t.tag,t.substitution)}function Xg(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function Yg(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var Pa={11:zg,12:$g,63:Xg,41:Yg};function Zi(t,e,r){t instanceof yr&&Pa[t.id]&&Pa[t.id](t,e,r)}function jg(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=Wu(n),i=ur(n);if(!o&&!i)return!0;if(o)return!1}return!1}function qg(t){if(Wu(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=ur(r);if(!n)return!0}return!1}function Zg(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new St(o.map(function(l){return l.getState("glyphIndex")}),0),a=new St(o.map(function(l){return l.char}),0);o.forEach(function(l,c){if(!ur(l.char)){i.setCurrentIndex(c),a.setCurrentIndex(c);var h=0;jg(a)&&(h|=1),qg(a)&&(h|=2);var d;switch(h){case 1:d="fina";break;case 2:d="init";break;case 3:d="medi";break}if(n.indexOf(d)!==-1){var g=e.query.lookupFeature({tag:d,script:r,contextParams:i});if(g instanceof Error)return console.info(g.message);g.forEach(function(v,w){v instanceof yr&&(Zi(v,o,w),i.context[w]=v.substitution)})}}})}}function ka(t,e){var r=t.map(function(n){return n.activeState.value});return new St(r,e||0)}function Kg(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=ka(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});l.length&&(l.forEach(function(c){return Zi(c,n,a)}),o=ka(n))})}function Qg(t){var e=t.current,r=t.get(-1);return r===null&&co(e)||!co(r)&&co(e)}function Jg(t){var e=t.get(1);return e===null||!co(e)}var em={startCheck:Qg,endCheck:Jg};function Aa(t,e){var r=t.map(function(n){return n.activeState.value});return new St(r,e||0)}function tm(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=Aa(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});l.length&&(l.forEach(function(c){return Zi(c,n,a)}),o=Aa(n))})}function Tt(t){this.baseDir=t||"ltr",this.tokenizer=new Ve,this.featuresTags={}}Tt.prototype.setText=function(t){this.text=t};Tt.prototype.contextChecks={latinWordCheck:em,arabicWordCheck:Ng,arabicSentenceCheck:Wg};function mi(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function rm(){return mi.call(this,"latinWord"),mi.call(this,"arabicWord"),mi.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function nm(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Tt.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};Tt.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new pt(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};Tt.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function Ki(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function om(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Ki.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){Zg.call(t,n)})}}function im(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){Ki.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){Kg.call(t,o)})}}}function sm(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){Ki.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){tm.call(t,o)})}}}Tt.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};Tt.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(om.call(this),im.call(this)),this.checkContextReady("latinWord")&&sm.call(this),this.checkContextReady("arabicSentence")&&nm.call(this)};Tt.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),rm.call(this),this.applyFeaturesToContexts())};Tt.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};Tt.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function Me(t){t=t||{},t.tables=t.tables||{},t.empty||(Jr(t.familyName,"When creating a new Font object, familyName is required."),Jr(t.styleName,"When creating a new Font object, styleName is required."),Jr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Jr(t.ascender,"When creating a new Font object, ascender is required."),Jr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Mt.GlyphSet(this,t.glyphs||[]),this.encoding=new bu(this),this.position=new Cn(this),this.substitution=new ht(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Gu(this)}})}Me.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Me.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Me.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Me.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};Me.prototype.stringToGlyphs=function(t,e){var r=this,n=new Tt,o=function(g){return r.charToGlyphIndex(g.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var a=n.getTextGlyphs(t),l=a.length,c=new Array(l),h=this.glyphs.get(0),d=0;d<l;d+=1)c[d]=this.glyphs.get(a[d])||h;return c};Me.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Me.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Me.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Me.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};Me.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Me.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var a=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,o),c;if(o.kerning){var h=o.script||this.position.getDefaultScriptName();c=this.position.getKerningTables(h,o.language)}for(var d=0;d<l.length;d+=1){var g=l[d];if(i.call(this,g,e,r,n,o),g.advanceWidth&&(e+=g.advanceWidth*a),o.kerning&&d<l.length-1){var v=c?this.position.getKerningValue(c,g.index,l[d+1].index):this.getKerningValue(g,l[d+1]);e+=v*a}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e};Me.prototype.getPath=function(t,e,r,n,o){var i=new $e;return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var d=a.getPath(l,c,h,o,this);i.extend(d)}),i};Me.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var d=a.getPath(l,c,h,o,this);i.push(d)}),i};Me.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};Me.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)};Me.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawPoints(t,l,c,h)})};Me.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawMetrics(t,l,c,h)})};Me.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Me.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Me.prototype.toTables=function(){return Xd.fontToTable(this)};Me.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Me.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r};Me.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(jd())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i),a.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),a.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),h=qd(n);c.writeFileSync(t,h)}};Me.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Me.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Me.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Yt=new Array(10);Yt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(P.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(P.coverage),values:this.parseValueRecordList()};te.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Yt[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();te.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(P.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(P.pointer(P.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var a=this.parsePointer(P.classDef),l=this.parsePointer(P.classDef),c=this.parseUShort(),h=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:a,classDef2:l,class1Count:c,class2Count:h,classRecords:this.parseList(c,P.list(h,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}};Yt[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Yt[4]=function(){return{error:"GPOS Lookup 4 not supported"}};Yt[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Yt[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Yt[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Yt[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Yt[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const am={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function um(t){const{dir:e,xAxis:r}=am[t];return new zu([0,0,0],e,r)}function Ra(t){const e=new M(t);let r=new M([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new M([0,1,0]),n=r.cross(e)),n.normalize()}class zu extends ft{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new M(n):Ra(r),i=yn(e,r,o);super(i)}get position(){return new M(this.wrapped.Location())}get direction(){return new M(this.wrapped.Direction())}get xAxis(){return new M(this.wrapped.XDirection())}get yAxis(){return new M(this.wrapped.YDirection())}autoAxes(){const e=Ra(this.direction);this.wrapped.SetXDirection(zt(e))}setPosition(e){return this.wrapped.SetLocation(ct(e)),this}setXAxis(e){return this.wrapped.SetYDirection(zt(e)),this}setYAxis(e){return this.wrapped.SetYDirection(zt(e)),this}lookAt(e){const r=new M("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const Or=t=>t.IsNull()?[]:Le(t).edges;function lm(t,e,r=!0){const n=G(),o=Re(),i=o(new n.HLRBRep_Algo_1);i.Add_2(t.wrapped,0);const a=o(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(a),i.Update(),i.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),c=[...Or(l.VCompound_1()),...Or(l.Rg1LineVCompound_1()),...Or(l.OutLineVCompound_1())];c.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped));const h=r?[...Or(l.HCompound_1()),...Or(l.Rg1LineHCompound_1()),...Or(l.OutLineHCompound_1())]:[];return h.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped)),{visible:c,hidden:h}}const _r=1e-8,Fr=(t,e)=>et(t,e,_r*10);function cm(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(h=>({offset:Si(h,r),original:h})),o=[];let i=null,a=n.at(-1);if(!a)return[];if(o.length===1)return o;const l=h=>{i?h.offset instanceof Ie?o.push(h.offset):Fr(h.offset.firstPoint,h.offset.lastPoint)||o.push(Sn(h.offset.firstPoint,h.offset.lastPoint)):i=h},c=function*(){for(const h of n.slice(0,-1))yield h;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const h of c()){const d=a.offset.lastPoint,g=h.offset.firstPoint;if(Fr(d,g)){l(a),a=h;continue}let v=[];if(a.offset instanceof Ie&&h.offset instanceof Ie){const{intersections:E,commonSegmentsPoints:T}=_n(a.offset,h.offset,_r/100);v=[...E,...T]}if(v.length>0){let E=v[0];if(v.length>1){const k=a==null?void 0:a.original.lastPoint,D=v.map(O=>uh(O,k));E=v[D.indexOf(Math.min(...D))]}const T=a.offset.splitAt([E],_r)[0],C=h.offset.splitAt([E],_r).at(-1);if(!C)throw new Error("Bug in the splitting algo in offset");l({offset:T,original:a.original}),a={offset:C,original:h.original};continue}const w=Xa(d,g,a.original.lastPoint);l(a),o.push(w),a=h}return l(a),o}function fm(t,e){const r=cm(t,e);if(r.length<2)return null;const n=new Map,o=(h,d)=>{const g=n.get(h)||[];n.set(h,[...g,...d])};if(r.forEach((h,d)=>{r.slice(d+1).forEach((g,v)=>{const{intersections:w,commonSegmentsPoints:E}=_n(h,g,_r),T=[...w,...E].filter(C=>{const k=Fr(C,h.firstPoint)||Fr(C,h.lastPoint),D=Fr(C,g.firstPoint)||Fr(C,g.lastPoint);return!(k&&D)});T.length&&(o(d,T),o(v+d+1,T))})}),!n.size){const h=new le(r);return t.intersects(h)?null:h}const a=r.flatMap((h,d)=>{if(!n.has(d))return h;const g=n.get(d)||[];return h.splitAt(g,_r*100)}).filter(h=>!t.curves.find(g=>g.distanceFrom(h)<Math.abs(e)-_r));if(!a.length)return null;const c=ja(a).filter(h=>h.length>1).map(h=>new le(h)).filter(h=>h.isClosed());return c.length?c.length===1?c[0]:new ee(c):null}const Oa=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=Ht(e,t[r]);return e};function fo(t,e){if(t instanceof le)return fm(t,e);if(t instanceof ee)return Oa(t.blueprints.map(r=>fo(r,e)));if(t instanceof xe){const r=Oa(t.blueprints.slice(1).map(n=>fo(n,e)));return nr(fo(t.blueprints[0],e),r)}return null}function Ma(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],a=(c,h)=>{o({firstCurve:c,secondCurve:h,point:c.lastPoint})?i.push(...t(c,h,r)):i.push(c,h)};e.curves.slice(1).forEach(c=>{const h=i.pop();if(!h)throw new Error("Bug in the blueprint filletting algo");a(h,c)});const l=i.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(et(i[0].firstPoint,l.lastPoint)&&i.length>1){const c=i.pop(),h=i.shift();if(!c||!h)throw new Error("Bug in the blueprint filletting algo");a(c,h)}return new le(i)}function Qi(t,e,r,n){if(e instanceof le)return Ma(t,e,r,n);if(e instanceof xe)return new xe(e.blueprints.map(o=>Ma(t,o,r,n)));if(e instanceof ee){const o=e.blueprints.map(i=>Qi(t,i,r,n)).filter(i=>i!==null);return new ee(o)}return null}function hm(t,e,r){return Qi(Ei,t,e,r)}function pm(t,e,r){return Qi(Ti,t,e,r)}function Fi(t,e){return t instanceof le?new le(go(t.curves,e)):t instanceof xe?new xe(t.blueprints.map(r=>Fi(r,e))):t instanceof ee?new ee(t.blueprints.map(r=>Fi(r,e))):t}class Be{constructor(e=null){this.innerShape=e}clone(){var e;return new Be(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new bn}stretch(e,r,n){return this.innerShape?new Be(this.innerShape.stretch(e,r,n)):new Be}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Be(this.innerShape.rotate(e,r)):new Be}translate(e,r=0){return this.innerShape?new Be(this.innerShape.translate(e,r)):new Be}scale(e,r){return this.innerShape?new Be(this.innerShape.scale(e,r)):new Be}mirror(e,r,n){return this.innerShape?new Be(this.innerShape.mirror(e,r,n)):new Be}cut(e){return new Be(nr(this.innerShape,e.innerShape))}fuse(e){return new Be(Ht(this.innerShape,e.innerShape))}intersect(e){return new Be(nn(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new wo);return new Be(hm(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new wo);return new Be(pm(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Be(fo(this.innerShape,e))}approximate(e,r={}){if(e!=="svg")throw new Error("Only 'svg' is supported for now");return new Be(Fi(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof le)){if(this.innerShape instanceof ee&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof le)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class dm extends hu{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Be(new le(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}function vm(t){const e=new dm;return t&&e.movePointerTo(t),e}function gm(t,e,r=0){return new Be(np(t,e,r))}const mm=gm,Da=t=>{const e=mm(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>Zh(o,e)),n=ja(r).map(o=>new le(o));return n.length===0?new Be:n.length===1?new Be(n[0]):new Be(new ee(n))};function lt(t,e="front"){let r;e instanceof zu?r=e:r=um(e);const{visible:n,hidden:o}=lm(t,r);return{visible:Da(n),hidden:Da(o)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $u=Symbol("Comlink.proxy"),ym=Symbol("Comlink.endpoint"),wm=Symbol("Comlink.releaseProxy"),yi=Symbol("Comlink.finalizer"),ho=Symbol("Comlink.thrown"),Xu=t=>typeof t=="object"&&t!==null||typeof t=="function",bm={canHandle:t=>Xu(t)&&t[$u],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Ji(t,e),[r,[r]]},deserialize(t){return t.start(),Tm(t)}},_m={canHandle:t=>Xu(t)&&ho in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Yu=new Map([["proxy",bm],["throw",_m]]);function Sm(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Ji(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!Sm(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:a,path:l}=Object.assign({path:[]},o.data),c=(o.data.argumentList||[]).map(wr);let h;try{const d=l.slice(0,-1).reduce((v,w)=>v[w],t),g=l.reduce((v,w)=>v[w],t);switch(a){case"GET":h=g;break;case"SET":d[l.slice(-1)[0]]=wr(o.data.value),h=!0;break;case"APPLY":h=g.apply(d,c);break;case"CONSTRUCT":{const v=new g(...c);h=Am(v)}break;case"ENDPOINT":{const{port1:v,port2:w}=new MessageChannel;Ji(t,w),h=km(v,[v])}break;case"RELEASE":h=void 0;break;default:return}}catch(d){h={value:d,[ho]:0}}Promise.resolve(h).catch(d=>({value:d,[ho]:0})).then(d=>{const[g,v]=Mo(d);e.postMessage(Object.assign(Object.assign({},g),{id:i}),v),a==="RELEASE"&&(e.removeEventListener("message",n),ju(e),yi in t&&typeof t[yi]=="function"&&t[yi]())}).catch(d=>{const[g,v]=Mo({value:new TypeError("Unserializable return value"),[ho]:0});e.postMessage(Object.assign(Object.assign({},g),{id:i}),v)})}),e.start&&e.start()}function Em(t){return t.constructor.name==="MessagePort"}function ju(t){Em(t)&&t.close()}function Tm(t,e){const r=new Map;return t.addEventListener("message",function(o){const{data:i}=o;if(!i||!i.id)return;const a=r.get(i.id);if(a)try{a(i)}finally{r.delete(i.id)}}),Li(t,r,[],e)}function oo(t){if(t)throw new Error("Proxy has been released and is not useable")}function qu(t){return Mr(t,new Map,{type:"RELEASE"}).then(()=>{ju(t)})}const Ro=new WeakMap,Oo="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Ro.get(t)||0)-1;Ro.set(t,e),e===0&&qu(t)});function xm(t,e){const r=(Ro.get(e)||0)+1;Ro.set(e,r),Oo&&Oo.register(t,e,t)}function Cm(t){Oo&&Oo.unregister(t)}function Li(t,e,r=[],n=function(){}){let o=!1;const i=new Proxy(n,{get(a,l){if(oo(o),l===wm)return()=>{Cm(i),qu(t),e.clear(),o=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const c=Mr(t,e,{type:"GET",path:r.map(h=>h.toString())}).then(wr);return c.then.bind(c)}return Li(t,e,[...r,l])},set(a,l,c){oo(o);const[h,d]=Mo(c);return Mr(t,e,{type:"SET",path:[...r,l].map(g=>g.toString()),value:h},d).then(wr)},apply(a,l,c){oo(o);const h=r[r.length-1];if(h===ym)return Mr(t,e,{type:"ENDPOINT"}).then(wr);if(h==="bind")return Li(t,e,r.slice(0,-1));const[d,g]=Fa(c);return Mr(t,e,{type:"APPLY",path:r.map(v=>v.toString()),argumentList:d},g).then(wr)},construct(a,l){oo(o);const[c,h]=Fa(l);return Mr(t,e,{type:"CONSTRUCT",path:r.map(d=>d.toString()),argumentList:c},h).then(wr)}});return xm(i,t),i}function Pm(t){return Array.prototype.concat.apply([],t)}function Fa(t){const e=t.map(Mo);return[e.map(r=>r[0]),Pm(e.map(r=>r[1]))]}const Zu=new WeakMap;function km(t,e){return Zu.set(t,e),t}function Am(t){return Object.assign(t,{[$u]:!0})}function Mo(t){for(const[e,r]of Yu)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},Zu.get(t)||[]]}function wr(t){switch(t.type){case"HANDLER":return Yu.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Mr(t,e,r,n){return new Promise(o=>{const i=Rm();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function Rm(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ku(t,e){return typeof t!="number"||isNaN(t)?{valid:!1,message:`Parameter '${e}' must be a number`}:{valid:!0}}function Om(t,e){return t<=0?{valid:!1,message:`Parameter '${e}' must be positive`}:{valid:!0}}function Mm(t,e,r){return t>=e?{valid:!1,message:`${r} (${t}) must be less than ${e}`}:{valid:!0}}function xt(t,e){const r=Ku(t,e);return r.valid?Om(t,e):r}function Dm(t,e,r){const n=Ku(t,r);return n.valid?Mm(t,e,r):n}function Ct(t,e){return r=>{const n=[];for(const o of e){const i=t(r[o],o);i.valid||n.push(i.message)}return{valid:n.length===0,errors:n}}}function La(t,e){return r=>{const n=r[t],o=r[e],i=Dm(n,o,t);return i.valid?{valid:!0,errors:[]}:{valid:!1,errors:[i.message]}}}function Fm(t,e){let r=!0;const n=[];if(e.params)for(const o of e.params){const{name:i,validators:a}=o;if(!a)continue;const l=t[i];for(const c of a){const h=c(l,i);if(!h.valid){r=!1,n.push(h.message);break}}}if(e.validators)for(const o of e.validators){const i=o(t);i.valid||(r=!1,n.push(...i.errors))}return{valid:r,errors:n}}function Ur({width:t=100,depth:e=100,height:r=100}){if(t===0&&e===0&&r===0)return Ce([0,0,0],[1e-7,1e-7,1e-7]);const n=t/2,o=e/2;return Ce([-n,-o,0],[n,o,r])}const Lm={name:"Cuboid",create:Ur,params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],validators:[Ct(xt,["width","depth","height"])],hasExplosion:!1};function Bm({radius:t=50}){return Dh(t)}const Um={name:"Sphere",create:Bm,params:[{name:"radius",defaultValue:50}],validators:[Ct(xt,["radius"])],hasExplosion:!1};function Qu({radius:t=50,height:e=100}){return un(t,e,[0,0,0],[0,0,-1])}const Im={name:"Cylinder",create:Qu,params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],validators:[Ct(xt,["radius","height"])],hasExplosion:!1};function Gm({aLength:t=80,bLength:e=50,cLength:r=30}){return Bh(t,e,r)}const Nm={name:"Ellipsoid",create:Gm,params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],validators:[Ct(xt,["aLength","bLength","cLength"])],hasExplosion:!1},Ju=t=>t.boundingBox.center;function el(t,e,r){return r.map(({position:n,direction:o,orientation:i})=>{const a=t(),l=e(a);let c=a.translate([n[0]-l[0],n[1]-l[1],n[2]-l[2]]);const h=[0,0,1],d=new M(i||o);if(d.Length>0){const g=new M(h).cross(d);if(g.Length>1e-10){const v=new M(h).getAngle(d);c=c.rotate(v,n,g)}else d.dot(new M(h))<0&&(c=c.rotate(180,n,[1,0,0]))}return c})}function tl(t,e,r,n,o,i=0,a=0,l=1){const c=new M([i,a,l]).normalized();return Array.from({length:e*r},(h,d)=>{const g=Math.floor(d/r),w=d%r*n,E=g*o,C=new rt(new M(t.origin),new M(t.xDirection).normalized(),new M(t.normal).normalized()).toWorldCoords([w,E,0]);return{position:[C.x,C.y,C.z],direction:[t.normal[0],t.normal[1],t.normal[2]],orientation:[c.x,c.y,c.z]}})}function Vm(t,e,r,n=0,o=0,i=1){return tl({origin:t,xDirection:e,normal:(()=>{const a=new M(e),l=new M([0,0,1]),c=Math.abs(a.normalized().dot(l))>.99?new M([1,0,0]):a.cross(l).normalized();return[c.x,c.y,c.z]})()},1,r,r>1?new M(e).Length/(r-1):0,0,n,o,i)}function Hm({count:t=5,vectorX:e=0,vectorY:r=50,vectorZ:n=50,originX:o=0,originY:i=0,originZ:a=0,boxWidth:l=10,boxDepth:c=10,boxHeight:h=10,orientationX:d=0,orientationY:g=0,orientationZ:v=1}){return Rt(el(()=>Ur({width:l,depth:c,height:h}),Ju,Vm([o,i,a],[e,r,n],t,d,g,v)))}const Wm={name:"DiagonalCuboidPattern",create:Hm,params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[Ct(xt,["count","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function zm({originX:t=0,originY:e=0,originZ:r=0,directionX:n=1,directionY:o=0,directionZ:i=0,normalX:a=0,normalY:l=0,normalZ:c=1,rowCount:h=3,colCount:d=3,xSpacing:g=30,ySpacing:v=30,boxWidth:w=10,boxDepth:E=10,boxHeight:T=10,orientationX:C=0,orientationY:k=0,orientationZ:D=1}){return Rt(el(()=>Ur({width:w,depth:E,height:T}),Ju,tl({origin:[t,e,r],xDirection:[n,o,i],normal:[a,l,c]},h,d,g,v,C,k,D)))}const $m={name:"RectangularCuboidGrid",create:zm,params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[Ct(xt,["rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function rl({depth:t=100,flangeXLenght:e=50,flangeYLenght:r=50,thickness:n=5}){const o=Ce([0,-t/2,0],[e,t/2,n]),i=Ce([0,-t/2,0],[n,t/2,r]);return o.fuse(i)}const Xm={name:"LProfile",create:rl,params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],validators:[Ct(xt,["depth","flangeXLenght","flangeYLenght","thickness"]),La("thickness","flangeXLenght"),La("thickness","flangeYLenght")],hasExplosion:!1};function nl({bottomRadius:t=50,topRadius:e=25,height:r=100}){return Xs(t,{plane:"XY",origin:[0,0,0]}).loftWith(Xs(e,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}const Ym={name:"Frustum",create:nl,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],validators:[Ct(xt,["bottomRadius","topRadius","height"])],hasExplosion:!1};function ol({bottomRadius:t=50,topRadius:e=25,frustumHeight:r=80,cylinderHeight:n=40}){return nl({bottomRadius:t,topRadius:e,height:r}).fuse(un(e,n,[0,0,-r],[0,0,-1]))}const jm={name:"Drill",create:ol,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],validators:[Ct(xt,["bottomRadius","topRadius","frustumHeight","cylinderHeight"])],hasExplosion:!1};function qm(t,e){return{main:t,helperSpaces:e}}function cn(t){return t.main||t}const ue={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},fe={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function io(t){let e;switch(t){case ue.FRONT:e=new M([0,-1,0]);break;case ue.BACK:e=new M([0,1,0]);break;case ue.LEFT:e=new M([-1,0,0]);break;case ue.RIGHT:e=new M([1,0,0]);break;case ue.TOP:e=new M([0,0,1]);break;case ue.BOTTOM:e=new M([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return e}function il(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case fe.FRONT_TOP:c=new M([r,n,l]);break;case fe.FRONT_BOTTOM:c=new M([r,n,o]);break;case fe.BACK_TOP:c=new M([r,a,l]);break;case fe.BACK_BOTTOM:c=new M([r,a,o]);break;case fe.LEFT_TOP:c=new M([r,n,l]);break;case fe.LEFT_BOTTOM:c=new M([r,n,o]);break;case fe.RIGHT_TOP:c=new M([i,n,l]);break;case fe.RIGHT_BOTTOM:c=new M([i,n,o]);break;case fe.FRONT_LEFT:c=new M([r,n,o]);break;case fe.FRONT_RIGHT:c=new M([i,n,o]);break;case fe.BACK_LEFT:c=new M([r,a,o]);break;case fe.BACK_RIGHT:c=new M([i,a,o]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function sl(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case fe.FRONT_TOP:c=new M([i,n,l]);break;case fe.FRONT_BOTTOM:c=new M([i,n,o]);break;case fe.BACK_TOP:c=new M([i,a,l]);break;case fe.BACK_BOTTOM:c=new M([i,a,o]);break;case fe.LEFT_TOP:c=new M([r,a,l]);break;case fe.LEFT_BOTTOM:c=new M([r,a,o]);break;case fe.RIGHT_TOP:c=new M([i,a,l]);break;case fe.RIGHT_BOTTOM:c=new M([i,a,o]);break;case fe.FRONT_LEFT:c=new M([r,n,l]);break;case fe.FRONT_RIGHT:c=new M([i,n,l]);break;case fe.BACK_LEFT:c=new M([r,a,l]);break;case fe.BACK_RIGHT:c=new M([i,a,l]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function Zm(t){switch(t){case fe.FRONT_LEFT:return[ue.FRONT,ue.LEFT];case fe.FRONT_RIGHT:return[ue.FRONT,ue.RIGHT];case fe.FRONT_TOP:return[ue.FRONT,ue.TOP];case fe.FRONT_BOTTOM:return[ue.FRONT,ue.BOTTOM];case fe.BACK_LEFT:return[ue.BACK,ue.LEFT];case fe.BACK_RIGHT:return[ue.BACK,ue.RIGHT];case fe.BACK_TOP:return[ue.BACK,ue.TOP];case fe.BACK_BOTTOM:return[ue.BACK,ue.BOTTOM];case fe.LEFT_TOP:return[ue.LEFT,ue.TOP];case fe.LEFT_BOTTOM:return[ue.LEFT,ue.BOTTOM];case fe.RIGHT_TOP:return[ue.RIGHT,ue.TOP];case fe.RIGHT_BOTTOM:return[ue.RIGHT,ue.BOTTOM];default:throw new Error(`Unknown edge identifier: ${t}`)}}function Km(t,e,r=.5,n=.5){const[[o,i,a],[l,c,h]]=t.bounds,d=Math.max(0,Math.min(1,r)),g=Math.max(0,Math.min(1,n));let v;switch(e){case ue.FRONT:v=new M([o+(l-o)*d,i,a+(h-a)*g]);break;case ue.BACK:v=new M([o+(l-o)*d,c,a+(h-a)*g]);break;case ue.LEFT:v=new M([o,i+(c-i)*d,a+(h-a)*g]);break;case ue.RIGHT:v=new M([l,i+(c-i)*d,a+(h-a)*g]);break;case ue.TOP:v=new M([o+(l-o)*d,i+(c-i)*g,h]);break;case ue.BOTTOM:v=new M([o+(l-o)*d,i+(c-i)*g,a]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return v}function Qm(t,e,r=.5){const n=Math.max(0,Math.min(1,r)),o=il(t,e),i=sl(t,e);return new M([o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n,o.z+(i.z-o.z)*n])}function Jm(t,e){const{type:r,element:n,params:o={}}=e;switch(r){case"face":return Km(t,n,o.u,o.v);case"edge":return Qm(t,n,o.t);case"corner":if(n.includes("START")){const i=n.replace("_START","");return il(t,i)}else if(n.includes("END")){const i=n.replace("_END","");return sl(t,i)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new M(t.center);default:throw new Error(`Unknown position type: ${r}`)}}function e0(t){const e=t.normalized(),r=Math.abs(e.x),n=Math.abs(e.y),o=Math.abs(e.z);let i;return r<=n&&r<=o?i=new M([0,e.z,-e.y]):n<=r&&n<=o?i=new M([e.z,0,-e.x]):i=new M([e.y,-e.x,0]),i.normalized()}function so(t,e,r,n={}){const o=Jm(t.boundingBox,e);let i;n.normal?i=new M(n.normal):i=t0(t,e,n);let a;n.xDir?a=new M(n.xDir):a=e0(i);const l=new Sr;l.coordSystemChange({origin:o.toTuple(),zDir:i.toTuple(),xDir:a.toTuple()},"reference");const c=Le(l.transform(r.wrapped));return l.delete(),i.delete(),a.delete(),o.delete(),c}function t0(t,e,r={}){const{type:n,element:o}=e;switch(n){case"face":return io(o);case"edge":if(r.faceForEdge)return io(r.faceForEdge);{const i=Zm(o);return io(i[0])}case"corner":return r.faceForCorner?io(r.faceForCorner):new M([0,0,1]);case"center":default:return new M([0,0,1])}}function mr(t,e,r,n=!1){return n?Le(t.wrapped).mirror(e,r):t.mirror(e,r)}const al=[{id:"ST001",name:"Stringer"},{id:"LP001",name:"L-Profile"},{id:"SS001",name:"Side Stringer"}];function r0({width:t=50,depth:e=100,height:r=200,showHelper:n=!0,explosionFactor:o=0}){const i=Ur({width:t,depth:e,height:r}),a=Math.round(r/17.5)-1;if(a<=0)return qm(Rt([]),n?[i]:[]);const l=r/(a+1),c=a>1?(e-28)/(a-1):0,h=Ur({width:t-1,depth:20,height:.5}),d=h.boundingBox.center,g=so(h,{type:"face",element:ue.TOP,params:{u:1.5/(t-1),v:2.25/20}},ol({bottomRadius:1.2,topRadius:.8,frustumHeight:.5*.8,cylinderHeight:.5*.2})),v=h.cut(g).cut(mr(g,"XZ",d,!0)).cut(mr(g,"YZ",d,!0)).cut(mr(mr(g,"XZ",d,!0),"YZ",d,!0)),w=v.clone(),E=rl({depth:20,flangeXLenght:4.5,flangeYLenght:4.5,thickness:.5}),T=E.boundingBox.center,C=so(E,{type:"face",element:ue.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},Qu({radius:.800001,height:.5})),k=E.cut(C).cut(mr(C,"XZ",T,!0)),D=k.clone(),O=so(v,{type:"edge",element:fe.LEFT_BOTTOM,params:{t:.5}},k,{normal:[0,0,-1],xDir:[1,0,0]}),$=mr(O,"YZ",d,!0),N=[];let Z=0,Y=-e/2+14,q=l-(v.boundingBox.bounds[1][2]-v.boundingBox.bounds[0][2]);for(let qe=0;qe<a;qe++){const Xe=o*15;N.push(v.clone().translate([Z,Y,q])),N.push(O.clone().translate([Z-Xe,Y,q])),N.push($.clone().translate([Z+Xe,Y,q])),Y+=c,q+=l}const re=Ur({width:600,depth:20,height:.5}),he=c,de=l,Ee=Math.sqrt(he*he+de*de),Te=Ee>.001?[0,he/Ee,de/Ee]:[1,0,0],pe=so(i,{type:"face",element:ue.RIGHT},re,{normal:[-1,0,0],xDir:Te}).intersect(i),me=pe.clone(),J=i.boundingBox.center,Q=mr(pe,"YZ",J,!0),ce=o*30,ke=o*30;N.push(pe.translate([ce,0,0])),N.push(Q.translate([-ke,0,0]));const ve=Rt(N),De=al.map(qe=>{let Xe=0,nt="Variable";return qe.id==="ST001"?(Xe=a,nt=`${t-1}200.5cm`):qe.id==="LP001"?(Xe=a*2,nt="4.54.520cm"):qe.id==="SS001"&&(Xe=2),{...qe,quantity:Xe,dimensions:nt,material:"Steel"}});return{main:ve,helperSpaces:n?[i]:[],componentData:De,technicalDrawingModels:{ST001:w,LP001:D,SS001:me}}}const n0={name:"Staircase",create:r0,params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],validators:[Ct(xt,["width","depth","height"])],hasExplosion:!0,hasTechnicalDrawingParts:!0,componentDataStructure:al};function o0({width:t,depth:e,board_thickness:r}){let n=[];const a=Math.floor(e/10),l=Math.floor((e-r)/10),c=Math.floor(e/15),h=(e-a*5)/(a+1),d=(e-r-l*5)/(l+1),g=(2*e/3-c*5)/(c+1),v=vm([-2.4,.25]).bulgeArcTo([2.4,.25],-.3).tangentArcTo([2.4,-.25]).bulgeArcTo([-2.4,-.25],-.3).tangentArcTo([-2.4,.25]).close().sketchOnPlane("XZ",-.15).extrude(.3),w=[];for(let ae=0;ae<a;ae++){const ye=v.clone().translate(h+2.5+ae*(5+h),-t/2+r/2,50);w.push(ye),n.push(ye.clone()),n.push(ye.clone().mirror("XZ"))}const E=kt(w),T=[];for(let ae=0;ae<l;ae++){const ye=v.clone().rotate(90,[0,0,0],[1,0,0]).translate(d+2.5+ae*(5+d),-t/2+r,3*r/2);T.push(ye),n.push(ye.clone()),n.push(ye.clone().mirror("XZ"))}const C=kt(T),k=Ce([0,-t/2,0],[e,-t/2+r,50]).cut(E).cut(C);n.push(k),n.push(k.clone().mirror("XZ"));const D=Ce([e,-t/2,0],[e+.2,-t/2+r,50]);n.push(D),n.push(D.clone().mirror("XZ"));const O=[];for(let ae=0;ae<l;ae++){const ye=v.clone().translate(d+2.5+ae*(5+d),t/6,2*r);O.push(ye),n.push(ye.clone()),n.push(ye.clone().mirror("XZ"))}const $=kt(O),N=Ce([0,-t/2+r,r],[e-r-.2,t/2-r,2*r]).cut(C).cut(C.mirror("XZ")).cut($).cut($.clone().mirror("XZ"));n.push(N);const Z=Ce([e-r-.2,-t/2+r,r],[e-r,t/2-r,2*r]);n.push(Z);const Y=[];for(let ae=0;ae<l;ae++){const ye=v.clone().translate(d+2.5+ae*(5+d),t/6,50);Y.push(ye),n.push(ye.clone()),n.push(ye.clone().mirror("XZ"))}const q=kt(Y),re=Ce([e-r,-t/2+r+.4,r],[e,-t/6-.3,50-.4]);n.push(re),n.push(re.clone().mirror("XZ"));const he=Ce([e-r,-t/6+.3,r],[e,t/6-.3,50-.4]);n.push(he);const de=Ce([0,t/6-r/2,2*r],[e-r-.2,t/6+r/2,50]).cut($).cut(q);n.push(de),n.push(de.clone().mirror("XZ"));const Ee=Ce([e-r-.2,t/6-r/2,2*r],[e-r,t/6+r/2,50]);n.push(Ee),n.push(Ee.clone().mirror("XZ"));const Te=[];for(let ae=0;ae<c;ae++){const ye=v.clone().translate(g+2.5+ae*(5+g),t/4,50+r);Te.push(ye),n.push(ye.clone()),n.push(ye.clone().mirror("XZ"))}const ne=kt(Te),pe=Ce([0,-t/2,50],[e,t/2,50+r]).cut(E).cut(E.mirror("XZ")).cut(q).cut(q.mirror("XZ")).cut(ne).cut(ne.clone().mirror("XZ"));n.push(pe);const me=Ce([e,-t/2,50],[e+.2,t/2,50+r]);n.push(me);const J=[];for(let ae=0;ae<c;ae++){const ye=v.clone().translate(g+2.5+ae*(5+g),t/4,50+6*(r+30));J.push(ye),n.push(ye.clone()),n.push(ye.clone().mirror("XZ"))}const Q=kt(J),ce=[];for(let ae=0;ae<4;ae++)for(let ye=0;ye<c;ye++){const Pr=v.clone().rotate(90,[0,0,0],[1,0,0]).translate(g+2.5+ye*(5+g),t/4-r/2,50+2.5*r+60+ae*(30+r));ce.push(Pr),n.push(Pr.clone()),n.push(Pr.clone().mirror("XZ"))}const ke=kt(ce);un(.4,3,[2*e/3-g/2,-t/4,50+30+1.5*r],[0,-1,0]);const De=kt([]),mt=Ce([0,t/4-r/2,50+r],[2*e/3,t/4+r/2,50+6*(r+30)]).cut(ne).cut(Q).cut(ke).cut(De);n.push(mt),n.push(mt.clone().mirror("XZ"));const qe=Ce([2*e/3,t/4-r/2,50+r],[2*e/3+.2,t/4+r/2,50+6*(r+30)]);n.push(qe),n.push(qe.clone().mirror("XZ"));const Xe=[];for(let ae=0;ae<c;ae++){const ye=v.clone().rotate(90,[0,0,0],[1,0,0]).translate(g+2.5+ae*(5+g),t/4-r/2,50+2.5*r+60);Xe.push(ye)}const nt=kt(Xe),jt=Ce([0,-t/4+r/2,50+2*(30+r)],[2*e/3,t/4-r/2,50+2*30+3*r]).cut(nt),at=Ce([2*e/3,-t/4+r/2,50+2*(30+r)],[2*e/3+.2,t/4-r/2,50+2*30+3*r]);for(let ae=0;ae<4;ae++)n.push(jt.clone().translateZ(ae*(30+r))),n.push(at.clone().translateZ(ae*(30+r)));const ge=Ce([0,-t/2,50+6*(r+30)],[e,t/2,50+7*r+6*30]).cut(Q).cut(Q.mirror("XZ"));n.push(ge);const Oe=Ce([e,-t/2,50+6*(r+30)],[e+.2,t/2,50+7*r+6*30]);n.push(Oe);const Ae=Ce([e-r,-t/6-.3,r],[e,-t/6-.1,50-.4]),ot=Ce([e-r,-t/2+r+.2,r],[e,-t/2+r+.4,50-.4]),B=Ce([e-r,-t/2+r+.4,50-.4],[e,-t/6-.3,50-.2]),se=Ce([e-r,-t/2+r+.4,r],[e,-t/6-.3,r+.2]);n.push(Ae),n.push(ot),n.push(B),n.push(se),n.push(Ae.clone().mirror("XZ")),n.push(ot.clone().mirror("XZ")),n.push(B.clone().mirror("XZ")),n.push(se.clone().mirror("XZ"));const ut=Ce([e-r,-t/6+.1,r],[e,-t/6+.3,50-.4]),Rn=Ce([e-r,t/6-.3,r],[e,t/6-.1,50-.4]),On=Ce([e-r,-t/6+.3,50-.4],[e,t/6-.3,50-.2]),Mn=Ce([e-r,-t/6+.3,r],[e,t/6-.3,r+.2]);n.push(ut),n.push(Rn),n.push(On),n.push(Mn);const Cr=un(.5,2,[e,t/6+r,50-r],[1,0,0]).fuse(un(1,1,[e+2,t/6+r,50-r],[1,0,0]));return n.push(Cr),n.push(Cr.clone().mirror("XZ")),n.push(Cr.clone().translateY(-2*r)),kt(n)}const i0={name:"Closet",create:o0,params:[{name:"width",defaultValue:200,description:"Overall width of the closet"},{name:"depth",defaultValue:50,description:"Overall depth of the closet"},{name:"board_thickness",defaultValue:3,description:"Thickness of the boards used"}],validators:[Ct(xt,["width","depth","board_thickness"])],hasExplosion:!1,hasBoM:!0},s0={Cuboid:Lm,Sphere:Um,Cylinder:Im,Ellipsoid:Nm,DiagonalCuboidPattern:Wm,RectangularCuboidGrid:$m,LProfile:Xm,Frustum:Ym,Drill:jm,Closet:i0,Staircase:{...n0,hasBoM:!0}};function ul(t,e){const r=s0[t];if(!r)throw new Error(`Model "${t}" not found`);const n=Fm(e,r);return n.valid?r.create(e):{error:!0,validationErrors:n.errors}}function Ze(t){if(!t||typeof t!="string")return null;const e=t.split(/[\s,]+/).map(parseFloat);if(e.length!==4||e.some(isNaN))return console.warn("Could not parse viewBox string:",t),null;const r=Math.max(0,e[2]),n=Math.max(0,e[3]);return{x:e[0],y:e[1],width:r,height:n}}function a0(t,e){const r="0 0 100 100",n=Ze(t),o=Ze(e);if(!n&&!o)return r;if(!n)return e||r;if(!o)return t||r;const i=Math.min(n.x,o.x),a=Math.min(n.y,o.y),l=Math.max(n.x+n.width,o.x+o.width),c=Math.max(n.y+n.height,o.y+o.height),h=Math.max(0,l-i),d=Math.max(0,c-a);return`${i} ${a} ${h} ${d}`}const vt=1e-6;function ir(t,e,r=vt){return!t||!e?!1:Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))<r}function Ba(t,e,r,n=vt){if(!t||!e||!r)return!1;if(Math.abs(t[0]-e[0])<n&&Math.abs(e[0]-r[0])<n||Math.abs(t[1]-e[1])<n&&Math.abs(e[1]-r[1])<n)return!0;const o=Math.abs((e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])),i=Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2);return i<n*n?!0:o/Math.sqrt(i)<n}let Ua=!1;const u0=async()=>{if(console.log("[TECH_DRAW_WORKER_INIT] Starting initialization..."),Ua)return console.log("[TECH_DRAW_WORKER_INIT] Already loaded."),Promise.resolve(!0);try{console.log("[TECH_DRAW_WORKER_INIT] Loading OpenCascade...");const t=await Yf({locateFile:()=>jf});return console.log("[TECH_DRAW_WORKER_INIT] OpenCascade loaded."),Ua=!0,qf(t),console.log("[TECH_DRAW_WORKER_INIT] OpenCascade set successfully."),!0}catch(t){throw console.error("[TECH_DRAW_WORKER_INIT_ERROR] Failed to initialize OpenCascade:",t),t}},ll=u0();function l0(t){if(!t||typeof t!="string")return console.error("Invalid input to parsePathData:",t),[];const e=/([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/ig,r=[];let n;for(;(n=e.exec(t))!==null;){const o=n[1],i=n[2].trim(),a=/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g,l=(i.match(a)||[]).map(Number);if(l.some(isNaN)){console.warn(`Skipping command due to invalid parameters: ${n[0]}`);continue}r.push({command:o,values:l})}return r}function c0(t,e,r){t.forEach(n=>{const o=n.command,i=n.values;if(o===o.toUpperCase()&&o!=="Z")for(let a=0;a<i.length;a++)switch(o){case"M":case"L":case"T":i[a]+=a%2===0?e:r;break;case"H":i[a]+=e;break;case"V":i[a]+=r;break;case"C":i[a]+=a%2===0?e:r;break;case"S":case"Q":i[a]+=a%2===0?e:r;break;case"A":a>=5&&(i[a]+=a%2!==0?e:r);break}})}function f0(t){return t.map(e=>{const r=e.values.map(n=>Math.abs(n)>1e6||Math.abs(n)<1e-4&&n!==0?n.toExponential(4):parseFloat(n.toFixed(4))).join(" ");return`${e.command}${r}`}).join("")}function h0(t){const e=cn(t);if(t&&t.technicalDrawingModels){const n=[],o=[];return Object.entries(t.technicalDrawingModels).forEach(([i,a])=>{try{const l=cn(a),c=l.boundingBox.center,h=l.translate([-c[0],-c[1],-c[2]]);o.push(h);const d=t.componentData.find(O=>O.id===i||O.name.toLowerCase().includes(i.toLowerCase())),g=lt(h,"front"),v=lt(h,"bottom"),w=lt(h,"left"),E=Ze(g.visible.toSVGViewBox()),T=Ze(v.visible.toSVGViewBox()),C=Ze(w.visible.toSVGViewBox()),k=Math.max((E==null?void 0:E.width)||0,(T==null?void 0:T.width)||0,(C==null?void 0:C.width)||0),D=Math.max((E==null?void 0:E.height)||0,(T==null?void 0:T.height)||0,(C==null?void 0:C.height)||0);E&&(g.normalizedViewBox=dt(E,k,D)),T&&(v.normalizedViewBox=dt(T,k,D)),C&&(w.normalizedViewBox=dt(C,k,D)),n.push({name:d?d.name:i,views:{front:g,bottom:v,left:w}})}catch(l){console.error(`Error processing model ${i}:`,l)}}),{parts:n}}const r=[];try{const n=cn(e),o=n.boundingBox.center,i=n.translate([-o[0],-o[1],-o[2]]);r.push(i);const a=lt(i,"front"),l=lt(i,"bottom"),c=lt(i,"left"),h=Ze(a.visible.toSVGViewBox()),d=Ze(l.visible.toSVGViewBox()),g=Ze(c.visible.toSVGViewBox()),v=Math.max((h==null?void 0:h.width)||0,(d==null?void 0:d.width)||0,(g==null?void 0:g.width)||0),w=Math.max((h==null?void 0:h.height)||0,(d==null?void 0:d.height)||0,(g==null?void 0:g.height)||0);h&&(a.normalizedViewBox=dt(h,v,w)),d&&(l.normalizedViewBox=dt(d,v,w)),g&&(c.normalizedViewBox=dt(g,v,w));let E=[];if(t&&t.main&&Array.isArray(t.helperSpaces)){const T=t.main,C=T.boundingBox.center,k=T.translate([-C[0],-C[1],-C[2]]);r.push(k);const D=lt(k,"front"),O=lt(k,"bottom"),$=lt(k,"left"),N=Ze(D.visible.toSVGViewBox()),Z=Ze(O.visible.toSVGViewBox()),Y=Ze($.visible.toSVGViewBox()),q=Math.max((N==null?void 0:N.width)||0,(Z==null?void 0:Z.width)||0,(Y==null?void 0:Y.width)||0),re=Math.max((N==null?void 0:N.height)||0,(Z==null?void 0:Z.height)||0,(Y==null?void 0:Y.height)||0);N&&(D.normalizedViewBox=dt(N,q,re)),Z&&(O.normalizedViewBox=dt(Z,q,re)),Y&&($.normalizedViewBox=dt(Y,q,re)),E=[{name:"Main Component",views:{front:D,bottom:O,left:$}}],t.helperSpaces.forEach((he,de)=>{const Ee=he.boundingBox.center,Te=he.translate([-Ee[0],-Ee[1],-Ee[2]]);r.push(Te);const ne=lt(Te,"front"),pe=lt(Te,"bottom"),me=lt(Te,"left"),J=Ze(ne.visible.toSVGViewBox()),Q=Ze(pe.visible.toSVGViewBox()),ce=Ze(me.visible.toSVGViewBox()),ke=Math.max((J==null?void 0:J.width)||0,(Q==null?void 0:Q.width)||0,(ce==null?void 0:ce.width)||0),ve=Math.max((J==null?void 0:J.height)||0,(Q==null?void 0:Q.height)||0,(ce==null?void 0:ce.height)||0);J&&(ne.normalizedViewBox=dt(J,ke,ve)),Q&&(pe.normalizedViewBox=dt(Q,ke,ve)),ce&&(me.normalizedViewBox=dt(ce,ke,ve)),E.push({name:`Helper Space ${de+1}`,views:{front:ne,bottom:pe,left:me}})})}return{standard:{frontView:a,bottomView:l,left:c},parts:E}}catch(n){return console.error("Error in standard projections:",n),{standard:{},parts:[]}}}function dt(t,e,r){if(!t||typeof t.x!="number"||typeof t.y!="number"||typeof t.width!="number"||typeof t.height!="number")return"0 0 100 100";const n=t.x+t.width/2,o=t.y+t.height/2,i=e>0?e:100,a=r>0?r:100,l=1.3,c=i*l,h=a*l,d=n-c/2,g=o-h/2;return`${d} ${g} ${c} ${h}`}function p0(t){const e={};if(t.standard&&t.standard.frontView){const{frontView:n,bottomView:o,left:i}=t.standard,a=[],l={view:n,name:"front",viewBox:Ze(n.normalizedViewBox||n.visible.toSVGViewBox(5)),visiblePaths:n.visible.toSVGPaths(),hiddenPaths:n.hidden.toSVGPaths()},c=o?{view:o,name:"bottom",viewBox:Ze(o.normalizedViewBox||o.visible.toSVGViewBox(5)),visiblePaths:o.visible.toSVGPaths(),hiddenPaths:o.hidden.toSVGPaths()}:null,h=i?{view:i,name:"left",viewBox:Ze(i.normalizedViewBox||i.visible.toSVGViewBox(5)),visiblePaths:i.visible.toSVGPaths(),hiddenPaths:i.hidden.toSVGPaths()}:null;if(!l.viewBox)return{parts:Ia(t.parts)};let d=l.viewBox.x,g=l.viewBox.y,v=l.viewBox.x+l.viewBox.width,w=l.viewBox.y+l.viewBox.height,E={x:0,y:0},T={x:0,y:0};c&&c.viewBox&&(E.x=l.viewBox.x+(l.viewBox.width-c.viewBox.width)/2,E.y=l.viewBox.y+l.viewBox.height+20,d=Math.min(d,E.x),v=Math.max(v,E.x+c.viewBox.width),w=Math.max(w,E.y+c.viewBox.height)),h&&h.viewBox&&(T.x=l.viewBox.x+l.viewBox.width+20,T.y=l.viewBox.y+(l.viewBox.height-h.viewBox.height)/2,g=Math.min(g,T.y),v=Math.max(v,T.x+h.viewBox.width),w=Math.max(w,T.y+h.viewBox.height));const C=v-d,k=w-g,D=`${d} ${g} ${C} ${k}`,O=($,N,Z,Y)=>{if(!$)return;const q=`standard_${Y}`,re=Hr($.visiblePaths,`${q}_visible`,N,Z),he=Hr($.hiddenPaths,`${q}_hidden`,N,Z);re.forEach(de=>de.originalView=Y),he.forEach(de=>de.originalView=Y),a.push(...re,...he)};O(l,0,0,"front"),c&&c.viewBox&&O(c,E.x-c.viewBox.x,E.y-c.viewBox.y,"bottom"),h&&h.viewBox&&O(h,T.x-h.viewBox.x,T.y-h.viewBox.y,"left"),e.standardLayout={combinedViewBox:D,paths:a}}return e.parts=Ia(t.parts),t.componentData&&(e.componentData=t.componentData),e}function Ia(t=[]){const e=[];for(const r of t)try{const n={};for(const[o,i]of Object.entries(r.views)){if(!i){console.warn(`[WARN] Skipping null/undefined view '${o}' for part '${r.name}'`);continue}const a=i.visible.toSVGPaths(),l=i.hidden.toSVGPaths(),c=`${r.name.replace(/\s+/g,"_")}_${o}`,h=Hr(a,`${c}_visible`,0,0),d=Hr(l,`${c}_hidden`,0,0),g=i.normalizedViewBox||i.visible.toSVGViewBox(5),v=i.normalizedViewBox||i.hidden.toSVGViewBox(5),w=i.normalizedViewBox||a0(g,v);n[o]={visible:{paths:h,viewBox:g},hidden:{paths:d,viewBox:v},combinedViewBox:w}}e.push({name:r.name,views:n})}catch(n){console.error(`[ERROR] Error processing part ${r.name}:`,n)}return e}function d0(t,e){let r,n;if(ir(t.endpoints[1],e.endpoints[0]))r=t.endpoints[0],n=e.endpoints[1];else if(ir(t.endpoints[0],e.endpoints[1]))r=e.endpoints[0],n=t.endpoints[1];else if(ir(t.endpoints[0],e.endpoints[0]))r=t.endpoints[1],n=e.endpoints[1];else if(ir(t.endpoints[1],e.endpoints[1]))r=t.endpoints[0],n=e.endpoints[0];else return console.warn("Cannot determine merge order for segments",t,e),t;const o=(t.length||0)+(e.length||0);return{type:"line",path:`M ${r[0]} ${r[1]} L ${n[0]} ${n[1]}`,length:o,endpoints:[r,n]}}function Hr(t,e="path",r=0,n=0){if(!Array.isArray(t))return console.warn("[WARN] normalizePaths received non-array input:",t),[];const o=[];let i=0;for(const a of t){let l;if(typeof a=="string")l=a;else if(Array.isArray(a)&&a.length>0&&typeof a[0]=="string")l=a[0];else if(a&&typeof a=="object"&&typeof a.d=="string")l=a.d;else{console.warn("[WARN] Skipping path due to unexpected format:",a);continue}if(!l||!l.trim())continue;let c=l;if(r!==0||n!==0)try{const w=l0(l);w.length>0?(c0(w,r,n),c=f0(w)):console.warn(`[WARN] Could not parse path data for transformation: ${l.substring(0,50)}...`)}catch(w){console.error(`[ERROR] Failed to transform path data: ${l.substring(0,50)}...`,w)}const h=v0(c),d={type:"unknown"};h&&(d.type="circle",d.center=h.center,d.radius=h.radius,d.diameter=h.radius*2);const g=g0(c),v=[];if(g.length>0){let w=g[0];for(let E=1;E<g.length;E++){const T=g[E];w&&T&&w.type==="line"&&T.type==="line"&&w.endpoints&&T.endpoints&&(ir(w.endpoints[1],T.endpoints[0])||ir(w.endpoints[0],T.endpoints[1])||ir(w.endpoints[0],T.endpoints[0])||ir(w.endpoints[1],T.endpoints[1]))&&Ba(w.endpoints[0],w.endpoints[1],T.endpoints[0])&&Ba(w.endpoints[0],w.endpoints[1],T.endpoints[1])?w=d0(w,T):(w&&v.push(w),w=T)}w&&v.push(w),v.forEach((E,T)=>{if(E&&E.path){const C=`${e}_${i}_${T}`;o.push({id:C,groupId:C,data:E.path,type:E.type,geometry:E.geometry})}else console.warn("[WARN] Skipping invalid segment during final ID assignment:",E)})}else if(h){const w=`${e}_${i}_circle`;o.push({id:w,groupId:w,data:c,type:"circle",geometry:d})}else{const w=`${e}_${i}_unknown`;o.push({id:w,groupId:w,data:c,type:"unknown",geometry:{type:"unknown"}}),console.warn(`[WARN] Path could not be decomposed or identified as circle: ${c.substring(0,50)}...`)}i++}return o}function v0(t){const e=/([Aa])\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)\s+([-\d.eE+]+)\s+([01])\s*,?\s*([01])\s+([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/g,r=/M\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/i,n=t.match(r);if(!n)return null;const o=parseFloat(n[1]),i=parseFloat(n[2]),a=[];let l;for(e.lastIndex=0;(l=e.exec(t))!==null;)a.push({rx:parseFloat(l[2]),ry:parseFloat(l[3]),xAxisRotation:parseFloat(l[4]),largeArcFlag:parseInt(l[5]),sweepFlag:parseInt(l[6]),endX:parseFloat(l[7]),endY:parseFloat(l[8]),isRelative:l[1]==="a"});if(a.length===0)return null;const c=Math.abs(a[0].rx),h=Math.abs(a[0].ry);if(c<vt||Math.abs(c-h)>vt*Math.max(c,h)||!a.every(ge=>Math.abs(Math.abs(ge.rx)-c)<vt&&Math.abs(Math.abs(ge.ry)-h)<vt))return null;let d=o,g=i;const v=t.match(/([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/ig);if(!v)return null;for(const ge of v){const Oe=ge[0],Ae=(ge.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(Ae.some(isNaN)){console.warn(`Could not parse parameters for command: ${ge}`);continue}const ot=Ga(Oe,Ae,d,g);d=ot[0],g=ot[1]}if(!(Math.abs(d-o)<vt&&Math.abs(g-i)<vt)||a.length<2)return null;let E=null;d=o,g=i;for(const ge of v){const Oe=ge[0],Ae=(ge.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(Ae.some(isNaN))continue;if(Oe==="A"||Oe==="a"){if(Ae.length<7){console.warn(`Invalid arc command parameters: ${ge}`);continue}E={rx:Math.abs(Ae[0]),ry:Math.abs(Ae[1]),xAxisRotationDeg:Ae[2],largeArcFlag:Ae[3],sweepFlag:Ae[4],endX:Oe==="a"?d+Ae[5]:Ae[5],endY:Oe==="a"?g+Ae[6]:Ae[6],startX:d,startY:g};break}const ot=Ga(Oe,Ae,d,g);d=ot[0],g=ot[1]}if(!E)return null;const{rx:T,ry:C,xAxisRotationDeg:k,largeArcFlag:D,sweepFlag:O,endX:$,endY:N,startX:Z,startY:Y}=E,q=k*Math.PI/180,re=Math.cos(q),he=Math.sin(q),de=re*(Z-$)/2+he*(Y-N)/2,Ee=-he*(Z-$)/2+re*(Y-N)/2,Te=T*T,ne=C*C,pe=de*de,me=Ee*Ee;let J=pe/Te+me/ne,Q=T,ce=C;if(J>1){const ge=Math.sqrt(J);Q=ge*T,ce=ge*C}const ke=Q*Q,ve=ce*ce;let De=D===O?-1:1,mt=Math.max(0,(ke*ve-ke*me-ve*pe)/(ke*me+ve*pe)),qe=De*Math.sqrt(mt);const Xe=qe*(Q*Ee/ce),nt=qe*-(ce*de/Q),jt=re*Xe-he*nt+(Z+$)/2,at=he*Xe+re*nt+(Y+N)/2;return{center:[jt,at],radius:Q}}function g0(t){const e=[];let r=0,n=0,o=0,i=0;const a=/([MLHVCSQTAZmlhvcsqtaz])([^MLHVCSQTAZmlhvcsqtaz]*)/g;let l;for(;(l=a.exec(t))!==null;){const c=l[1],h=(l[2].match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(h.some(isNaN)){console.warn(`Could not parse parameters for command: ${l[0]}`);continue}let d=[];switch(c){case"M":if(h.length>=2){r=h[0],n=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const v=h[g],w=h[g+1],E=Gt(r,n,v,w);E&&e.push(E),r=v,n=w}}break;case"m":if(h.length>=2){r+=h[0],n+=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const v=r+h[g],w=n+h[g+1],E=Gt(r,n,v,w);E&&e.push(E),r=v,n=w}}break;case"L":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const v=h[g],w=h[g+1],E=Gt(r,n,v,w);E&&e.push(E),r=v,n=w}break;case"l":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const v=r+h[g],w=n+h[g+1],E=Gt(r,n,v,w);E&&e.push(E),r=v,n=w}break;case"H":for(let g=0;g<h.length;g++){const v=h[g],w=Gt(r,n,v,n);w&&e.push(w),r=v}break;case"h":for(let g=0;g<h.length;g++){const v=r+h[g],w=Gt(r,n,v,n);w&&e.push(w),r=v}break;case"V":for(let g=0;g<h.length;g++){const v=h[g],w=Gt(r,n,r,v);w&&e.push(w),n=v}break;case"v":for(let g=0;g<h.length;g++){const v=n+h[g],w=Gt(r,n,r,v);w&&e.push(w),n=v}break;case"Z":case"z":if(Math.abs(r-o)>vt||Math.abs(n-i)>vt){const g=Gt(r,n,o,i);g&&e.push(g)}r=o,n=i;break;case"C":case"c":d=h.length/6;for(let g=0;g<d;++g){const v=h.slice(g*6,(g+1)*6);if(v.length===6){const w=br(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"curve",length:en(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break;case"S":case"s":d=h.length/4;for(let g=0;g<d;++g){const v=h.slice(g*4,(g+1)*4);if(v.length===4){const w=br(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"curve",length:en(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break;case"Q":case"q":d=h.length/4;for(let g=0;g<d;++g){const v=h.slice(g*4,(g+1)*4);if(v.length===4){const w=br(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"curve",length:en(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break;case"T":case"t":d=h.length/2;for(let g=0;g<d;++g){const v=h.slice(g*2,(g+1)*2);if(v.length===2){const w=br(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"curve",length:en(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break;case"A":case"a":d=h.length/7;for(let g=0;g<d;++g){const v=h.slice(g*7,(g+1)*7);if(v.length===7){const w=br(c,v,r,n);e.push({type:"arc",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"arc",length:en(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break}}return e}function Gt(t,e,r,n){if(Math.abs(t-r)<vt&&Math.abs(e-n)<vt)return null;const o=Math.sqrt(Math.pow(r-t,2)+Math.pow(n-e,2));return{type:"line",path:`M ${t} ${e} L ${r} ${n}`,geometry:{type:"line",length:o,endpoints:[[t,e],[r,n]]}}}function en(t,e,r,n){const o=br(t,e,r,n);return Math.sqrt(Math.pow(o[0]-r,2)+Math.pow(o[1]-n,2))}function Ga(t,e,r,n){if("CSQTAcsgta".includes(t))return br(t,e,r,n);let o=r,i=n;const a=t===t.toLowerCase(),l=e.length;switch(t.toUpperCase()){case"M":case"L":l>=2&&(o=e[l-2],i=e[l-1],a&&(o+=r,i+=n));break;case"H":l>=1&&(o=e[l-1],a&&(o+=r),i=n);break;case"V":l>=1&&(o=r,i=e[l-1],a&&(i+=n));break;case"Z":o=r,i=n;break}return[o,i]}function br(t,e,r,n){const o=t===t.toLowerCase();let i=r,a=n;const l=e.length;switch(t.toUpperCase()){case"C":l>=6&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"S":case"Q":l>=4&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"T":l>=2&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"A":l>=7&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break}return[i,a]}async function m0(t,e){console.log(`[TECH_DRAW_WORKER] Generating projections for: ${t}`),console.time(`[PERF_TD] Total ${t} projections creation`),await ll,console.log(`[TECH_DRAW_WORKER] OpenCascade ready for ${t}`),console.time(`[PERF_TD] Base model creation ${t}`);const r=ul(t,e);if(console.timeEnd(`[PERF_TD] Base model creation ${t}`),!r||r.error)return console.error(`[TECH_DRAW_WORKER] Base model creation failed for ${t}:`,r==null?void 0:r.validationErrors),console.timeEnd(`[PERF_TD] Total ${t} projections creation`),{error:!0,validationErrors:(r==null?void 0:r.validationErrors)||["Model creation failed."]};console.log(`[TECH_DRAW_WORKER] Base model created for ${t}.`);let n;try{console.time(`[PERF_TD] createOrthographicProjections ${t}`),n=h0(r),console.timeEnd(`[PERF_TD] createOrthographicProjections ${t}`),console.log(`[TECH_DRAW_WORKER] Raw projections generated for ${t}.`)}catch(i){return console.error(`[TECH_DRAW_WORKER] Error during createOrthographicProjections for ${t}:`,i),console.timeEnd(`[PERF_TD] Total ${t} projections creation`),{error:!0,message:`Orthographic projection failed: ${i.message}`}}let o;try{console.time(`[PERF_TD] processProjectionsForRendering ${t}`),o=p0(n),console.timeEnd(`[PERF_TD] processProjectionsForRendering ${t}`),console.log(`[TECH_DRAW_WORKER] Projections processed for rendering for ${t}.`)}catch(i){return console.error(`[TECH_DRAW_WORKER] Error during processProjectionsForRendering for ${t}:`,i),console.timeEnd(`[PERF_TD] Total ${t} projections creation`),{error:!0,message:`Projection processing failed: ${i.message}`}}if(r&&r.componentData){const i=r.componentData.map(a=>({id:a.id,name:a.name,quantity:a.quantity,dimensions:a.dimensions,material:a.material}));o.componentData=i,console.log(`[TECH_DRAW_WORKER] Added component data for ${t}.`)}return console.timeEnd(`[PERF_TD] Total ${t} projections creation`),console.log(`[TECH_DRAW_WORKER] Successfully generated projections for ${t}.`),o}const y0=async(t,e,r,n,o=null)=>{console.log(`[TECH_DRAW_WORKER] Generating single projection: Model='${t}', Part='${o||"Whole"}', View='${r}', Hidden=${n}`),console.time(`[PERF_TD_SINGLE] Total ${t} ${o||"Whole"} ${r} projection`),await ll,console.time(`[PERF_TD_SINGLE] Base model creation ${t}`);const i=ul(t,e);if(console.timeEnd(`[PERF_TD_SINGLE] Base model creation ${t}`),!i||i.error)return console.error("[TECH_DRAW_WORKER] Base model creation failed for single projection:",i==null?void 0:i.validationErrors),console.timeEnd(`[PERF_TD_SINGLE] Total ${t} ${o||"Whole"} ${r} projection`),{error:!0,validationErrors:(i==null?void 0:i.validationErrors)||["Model creation failed."]};let a;if(o){if(!i.technicalDrawingModels||!i.technicalDrawingModels[o]){const T=`Part '${o}' not found in technicalDrawingModels for model '${t}'.`;return console.error(`[TECH_DRAW_WORKER] ${T}`),console.timeEnd(`[PERF_TD_SINGLE] Total ${t} ${o} ${r} projection`),{error:!0,message:T}}a=cn(i.technicalDrawingModels[o]),console.log(`[TECH_DRAW_WORKER] Projecting specific part: ${o}`)}else a=cn(i),console.log("[TECH_DRAW_WORKER] Projecting whole model.");let l;try{console.time(`[PERF_TD_SINGLE] drawProjection ${t} ${o||"Whole"} ${r}`),l=lt(a,r.toLowerCase()),console.timeEnd(`[PERF_TD_SINGLE] drawProjection ${t} ${o||"Whole"} ${r}`)}catch(T){return console.error(`[TECH_DRAW_WORKER] Error during drawProjection for ${t} ${o||"Whole"} ${r}:`,T),console.timeEnd(`[PERF_TD_SINGLE] Total ${t} ${o||"Whole"} ${r} projection`),{error:!0,message:`Drawing projection failed: ${T.message}`}}const c=l.visible.toSVGPaths(),h=n?l.hidden.toSVGPaths():[],d=`single_${o?o.replace(/\s+/g,"_")+"_":""}${r}`;console.time(`[PERF_TD_SINGLE] normalizePaths ${t} ${o||"Whole"} ${r}`);const g=Hr(c,`${d}_visible`,0,0),v=n?Hr(h,`${d}_hidden`,0,0):[];console.timeEnd(`[PERF_TD_SINGLE] normalizePaths ${t} ${o||"Whole"} ${r}`);const w=[...g,...v],E=l.visible.toSVGViewBox(5);return console.timeEnd(`[PERF_TD_SINGLE] Total ${t} ${o||"Whole"} ${r} projection`),console.log(`[TECH_DRAW_WORKER] Successfully generated single projection for ${t} ${o||"Whole"} ${r}.`),{error:!1,paths:w,viewBox:E}};Ji({generateProjections:m0,generateSingleProjection:y0})});export default w0();
