var zf=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var l0=zf(R=>{var Wf=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(s,u){n=s,o=u});var i=Object.assign({},r),a="./this.program",l=(s,u)=>{throw u},c=typeof window=="object",h=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function v(s){return r.locateFile?r.locateFile(s,g):g+s}var b,T,C;function x(s){if(s instanceof Yo)return;H("exiting due to exception: "+s)}var A,L,D;d?(h?g=require("path").dirname(g)+"/":g=__dirname+"/",D=()=>{L||(A=require("fs"),L=require("path"))},b=function(u,f){return D(),u=L.normalize(u),A.readFileSync(u,f?void 0:"utf8")},C=s=>{var u=b(s,!0);return u.buffer||(u=new Uint8Array(u)),u},T=(s,u,f)=>{D(),s=L.normalize(s),A.readFile(s,function(p,m){p?f(p):u(m.buffer)})},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof Yo))throw s}),process.on("unhandledRejection",function(s){throw s}),l=(s,u)=>{if(Ki())throw process.exitCode=s,u;x(u),process.exit(s)},r.inspect=function(){return"[Emscripten Module object]"}):(c||h)&&(h?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",b=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.send(null),u.responseText},h&&(C=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),T=(s,u,f)=>{var p=new XMLHttpRequest;p.open("GET",s,!0),p.responseType="arraybuffer",p.onload=()=>{if(p.status==200||p.status==0&&p.response){u(p.response);return}f()},p.onerror=f,p.send(null)});var Y=r.print||console.log.bind(console),H=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(a=r.thisProgram),r.quit&&(l=r.quit);var q=4,j;r.wasmBinary&&(j=r.wasmBinary);var K=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Wt("no native wasm support detected");var se,Se=!1;function _e(s,u){s||Wt(u)}var Te=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function xe(s,u,f){for(var p=u+f,m=u;s[m]&&!(m>=p);)++m;if(m-u>16&&s.buffer&&Te)return Te.decode(s.subarray(u,m));for(var w="";u<m;){var S=s[u++];if(!(S&128)){w+=String.fromCharCode(S);continue}var _=s[u++]&63;if((S&224)==192){w+=String.fromCharCode((S&31)<<6|_);continue}var E=s[u++]&63;if((S&240)==224?S=(S&15)<<12|_<<6|E:S=(S&7)<<18|_<<12|E<<6|s[u++]&63,S<65536)w+=String.fromCharCode(S);else{var P=S-65536;w+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return w}function ne(s,u){return s?xe(Oe,s,u):""}function fe(s,u,f,p){if(!(p>0))return 0;for(var m=f,w=f+p-1,S=0;S<s.length;++S){var _=s.charCodeAt(S);if(_>=55296&&_<=57343){var E=s.charCodeAt(++S);_=65536+((_&1023)<<10)|E&1023}if(_<=127){if(f>=w)break;u[f++]=_}else if(_<=2047){if(f+1>=w)break;u[f++]=192|_>>6,u[f++]=128|_&63}else if(_<=65535){if(f+2>=w)break;u[f++]=224|_>>12,u[f++]=128|_>>6&63,u[f++]=128|_&63}else{if(f+3>=w)break;u[f++]=240|_>>18,u[f++]=128|_>>12&63,u[f++]=128|_>>6&63,u[f++]=128|_&63}}return u[f]=0,f-m}function ye(s,u,f){return fe(s,Oe,u,f)}function ue(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&(p=65536+((p&1023)<<10)|s.charCodeAt(++f)&1023),p<=127?++u:p<=2047?u+=2:p<=65535?u+=3:u+=4}return u}var re=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ce(s,u){for(var f=s,p=f>>1,m=p+u/2;!(p>=m)&&lt[p];)++p;if(f=p<<1,f-s>32&&re)return re.decode(Oe.subarray(s,f));for(var w="",S=0;!(S>=u/2);++S){var _=Me[s+S*2>>1];if(_==0)break;w+=String.fromCharCode(_)}return w}function we(s,u,f){if(f===void 0&&(f=2147483647),f<2)return 0;f-=2;for(var p=u,m=f<s.length*2?f/2:s.length,w=0;w<m;++w){var S=s.charCodeAt(w);Me[u>>1]=S,u+=2}return Me[u>>1]=0,u-p}function he(s){return s.length*2}function Ce(s,u){for(var f=0,p="";!(f>=u/4);){var m=I[s+f*4>>2];if(m==0)break;if(++f,m>=65536){var w=m-65536;p+=String.fromCharCode(55296|w>>10,56320|w&1023)}else p+=String.fromCharCode(m)}return p}function yt(s,u,f){if(f===void 0&&(f=2147483647),f<4)return 0;for(var p=u,m=p+f-4,w=0;w<s.length;++w){var S=s.charCodeAt(w);if(S>=55296&&S<=57343){var _=s.charCodeAt(++w);S=65536+((S&1023)<<10)|_&1023}if(I[u>>2]=S,u+=4,u+4>m)break}return I[u>>2]=0,u-p}function Ct(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&++f,u+=4}return u}function wt(s){var u=ue(s)+1,f=Ot(u);return f&&fe(s,me,f,u),f}function zt(s,u){me.set(s,u)}function Sr(s,u,f){for(var p=0;p<s.length;++p)me[u++>>0]=s.charCodeAt(p);f||(me[u>>0]=0)}var ut,me,Oe,Me,lt,I,le,ct,$i;function Yi(s){ut=s,r.HEAP8=me=new Int8Array(s),r.HEAP16=Me=new Int16Array(s),r.HEAP32=I=new Int32Array(s),r.HEAPU8=Oe=new Uint8Array(s),r.HEAPU16=lt=new Uint16Array(s),r.HEAPU32=le=new Uint32Array(s),r.HEAPF32=ct=new Float32Array(s),r.HEAPF64=$i=new Float64Array(s)}r.INITIAL_MEMORY;var Xi,ji=[],qi=[],Zi=[];function Ki(){return K}function al(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)cl(r.preRun.shift());Ro(ji)}function ul(){!r.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,Ro(qi)}function ll(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)hl(r.postRun.shift());Ro(Zi)}function cl(s){ji.unshift(s)}function fl(s){qi.unshift(s)}function hl(s){Zi.unshift(s)}var sr=0,Gr=null;function c0(s){return s}function Ao(s){sr++,r.monitorRunDependencies&&r.monitorRunDependencies(sr)}function _n(s){if(sr--,r.monitorRunDependencies&&r.monitorRunDependencies(sr),sr==0&&Gr){var u=Gr;Gr=null,u()}}function Wt(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",H(s),Se=!0,s+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(s);throw o(u),u}var pl="data:application/octet-stream;base64,";function Qi(s){return s.startsWith(pl)}function Ji(s){return s.startsWith("file://")}var Ke;Ke="replicad_single.wasm",Qi(Ke)||(Ke=v(Ke));function es(s){try{if(s==Ke&&j)return new Uint8Array(j);if(C)return C(s);throw"both async and sync fetching of the wasm failed"}catch(u){Wt(u)}}function dl(){if(!j&&(c||h)){if(typeof fetch=="function"&&!Ji(Ke))return fetch(Ke,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+Ke+"'";return s.arrayBuffer()}).catch(function(){return es(Ke)});if(T)return new Promise(function(s,u){T(Ke,function(f){s(new Uint8Array(f))},u)})}return Promise.resolve().then(function(){return es(Ke)})}function vl(){var s={a:Nf};function u(S,_){var E=S.exports;r.asm=E,se=r.asm.oa,Yi(se.buffer),Xi=r.asm.va,fl(r.asm.pa),_n()}Ao();function f(S){u(S.instance)}function p(S){return dl().then(function(_){return WebAssembly.instantiate(_,s)}).then(function(_){return _}).then(S,function(_){H("failed to asynchronously prepare wasm: "+_),Wt(_)})}function m(){return!j&&typeof WebAssembly.instantiateStreaming=="function"&&!Qi(Ke)&&!Ji(Ke)&&!d&&typeof fetch=="function"?fetch(Ke,{credentials:"same-origin"}).then(function(S){var _=WebAssembly.instantiateStreaming(S,s);return _.then(f,function(E){return H("wasm streaming compile failed: "+E),H("falling back to ArrayBuffer instantiation"),p(f)})}):p(f)}if(r.instantiateWasm)try{var w=r.instantiateWasm(s,u);return w}catch(S){return H("Module.instantiateWasm callback failed with error: "+S),!1}return m().catch(o),{}}var ze,kt;function gl(){return r.HEAP8.length}function Ro(s){for(;s.length>0;){var u=s.shift();if(typeof u=="function"){u(r);continue}var f=u.func;typeof f=="number"?u.arg===void 0?En(f)():En(f)(u.arg):f(u.arg===void 0?null:u.arg)}}var Tn=[];function En(s){var u=Tn[s];return u||(s>=Tn.length&&(Tn.length=s+1),Tn[s]=u=Xi.get(s)),u}function ml(s,u,f,p){Wt("Assertion failed: "+ne(s)+", at: "+[u?ne(u):"unknown filename",f,p?ne(p):"unknown function"])}function yl(s){return Ot(s+24)+24}function wl(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(u){le[this.ptr+4>>2]=u},this.get_type=function(){return le[this.ptr+4>>2]},this.set_destructor=function(u){le[this.ptr+8>>2]=u},this.get_destructor=function(){return le[this.ptr+8>>2]},this.set_refcount=function(u){I[this.ptr>>2]=u},this.set_caught=function(u){u=u?1:0,me[this.ptr+12>>0]=u},this.get_caught=function(){return me[this.ptr+12>>0]!=0},this.set_rethrown=function(u){u=u?1:0,me[this.ptr+13>>0]=u},this.get_rethrown=function(){return me[this.ptr+13>>0]!=0},this.init=function(u,f){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(f),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var u=I[this.ptr>>2];I[this.ptr>>2]=u+1},this.release_ref=function(){var u=I[this.ptr>>2];return I[this.ptr>>2]=u-1,u===1},this.set_adjusted_ptr=function(u){le[this.ptr+16>>2]=u},this.get_adjusted_ptr=function(){return le[this.ptr+16>>2]},this.get_exception_ptr=function(){var u=xs(this.get_type());if(u)return le[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}function bl(s,u,f){var p=new wl(s);throw p.init(u,f),s}var pe={isAbs:s=>s.charAt(0)==="/",splitPath:s=>{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return u.exec(s).slice(1)},normalizeArray:(s,u)=>{for(var f=0,p=s.length-1;p>=0;p--){var m=s[p];m==="."?s.splice(p,1):m===".."?(s.splice(p,1),f++):f&&(s.splice(p,1),f--)}if(u)for(;f;f--)s.unshift("..");return s},normalize:s=>{var u=pe.isAbs(s),f=s.substr(-1)==="/";return s=pe.normalizeArray(s.split("/").filter(p=>!!p),!u).join("/"),!s&&!u&&(s="."),s&&f&&(s+="/"),(u?"/":"")+s},dirname:s=>{var u=pe.splitPath(s),f=u[0],p=u[1];return!f&&!p?".":(p&&(p=p.substr(0,p.length-1)),f+p)},basename:s=>{if(s==="/")return"/";s=pe.normalize(s),s=s.replace(/\/$/,"");var u=s.lastIndexOf("/");return u===-1?s:s.substr(u+1)},join:function(){var s=Array.prototype.slice.call(arguments,0);return pe.normalize(s.join("/"))},join2:(s,u)=>pe.normalize(s+"/"+u)};function Sl(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var s=new Uint8Array(1);return function(){return crypto.getRandomValues(s),s[0]}}else if(d)try{var u=require("crypto");return function(){return u.randomBytes(1)[0]}}catch{}return function(){Wt("randomDevice")}}var Pt={resolve:function(){for(var s="",u=!1,f=arguments.length-1;f>=-1&&!u;f--){var p=f>=0?arguments[f]:y.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)return"";s=p+"/"+s,u=pe.isAbs(p)}return s=pe.normalizeArray(s.split("/").filter(m=>!!m),!u).join("/"),(u?"/":"")+s||"."},relative:(s,u)=>{s=Pt.resolve(s).substr(1),u=Pt.resolve(u).substr(1);function f(P){for(var B=0;B<P.length&&P[B]==="";B++);for(var U=P.length-1;U>=0&&P[U]==="";U--);return B>U?[]:P.slice(B,U-B+1)}for(var p=f(s.split("/")),m=f(u.split("/")),w=Math.min(p.length,m.length),S=w,_=0;_<w;_++)if(p[_]!==m[_]){S=_;break}for(var E=[],_=S;_<p.length;_++)E.push("..");return E=E.concat(m.slice(S)),E.join("/")}},ar={ttys:[],init:function(){},shutdown:function(){},register:function(s,u){ar.ttys[s]={input:[],output:[],ops:u},y.registerDevice(s,ar.stream_ops)},stream_ops:{open:function(s){var u=ar.ttys[s.node.rdev];if(!u)throw new y.ErrnoError(43);s.tty=u,s.seekable=!1},close:function(s){s.tty.ops.flush(s.tty)},flush:function(s){s.tty.ops.flush(s.tty)},read:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.get_char)throw new y.ErrnoError(60);for(var w=0,S=0;S<p;S++){var _;try{_=s.tty.ops.get_char(s.tty)}catch{throw new y.ErrnoError(29)}if(_===void 0&&w===0)throw new y.ErrnoError(6);if(_==null)break;w++,u[f+S]=_}return w&&(s.node.timestamp=Date.now()),w},write:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var w=0;w<p;w++)s.tty.ops.put_char(s.tty,u[f+w])}catch{throw new y.ErrnoError(29)}return p&&(s.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(s){if(!s.input.length){var u=null;if(d){var f=256,p=Buffer.alloc(f),m=0;try{m=A.readSync(process.stdin.fd,p,0,f,-1)}catch(w){if(w.toString().includes("EOF"))m=0;else throw w}m>0?u=p.slice(0,m).toString("utf-8"):u=null}else typeof window<"u"&&typeof window.prompt=="function"?(u=window.prompt("Input: "),u!==null&&(u+=`
`)):typeof readline=="function"&&(u=readline(),u!==null&&(u+=`
`));if(!u)return null;s.input=Gn(u,!0)}return s.input.shift()},put_char:function(s,u){u===null||u===10?(Y(xe(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&(Y(xe(s.output,0)),s.output=[])}},default_tty1_ops:{put_char:function(s,u){u===null||u===10?(H(xe(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&(H(xe(s.output,0)),s.output=[])}}};function _l(s,u){Oe.fill(0,s,s+u)}function Tl(s,u){return Math.ceil(s/u)*u}function ts(s){s=Tl(s,65536);var u=Es(65536,s);return u?(_l(u,s),u):0}var ee={ops_table:null,mount:function(s){return ee.createNode(null,"/",16895,0)},createNode:function(s,u,f,p){if(y.isBlkdev(f)||y.isFIFO(f))throw new y.ErrnoError(63);ee.ops_table||(ee.ops_table={dir:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,lookup:ee.node_ops.lookup,mknod:ee.node_ops.mknod,rename:ee.node_ops.rename,unlink:ee.node_ops.unlink,rmdir:ee.node_ops.rmdir,readdir:ee.node_ops.readdir,symlink:ee.node_ops.symlink},stream:{llseek:ee.stream_ops.llseek}},file:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:{llseek:ee.stream_ops.llseek,read:ee.stream_ops.read,write:ee.stream_ops.write,allocate:ee.stream_ops.allocate,mmap:ee.stream_ops.mmap,msync:ee.stream_ops.msync}},link:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,readlink:ee.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:y.chrdev_stream_ops}});var m=y.createNode(s,u,f,p);return y.isDir(m.mode)?(m.node_ops=ee.ops_table.dir.node,m.stream_ops=ee.ops_table.dir.stream,m.contents={}):y.isFile(m.mode)?(m.node_ops=ee.ops_table.file.node,m.stream_ops=ee.ops_table.file.stream,m.usedBytes=0,m.contents=null):y.isLink(m.mode)?(m.node_ops=ee.ops_table.link.node,m.stream_ops=ee.ops_table.link.stream):y.isChrdev(m.mode)&&(m.node_ops=ee.ops_table.chrdev.node,m.stream_ops=ee.ops_table.chrdev.stream),m.timestamp=Date.now(),s&&(s.contents[u]=m,s.timestamp=m.timestamp),m},getFileDataAsTypedArray:function(s){return s.contents?s.contents.subarray?s.contents.subarray(0,s.usedBytes):new Uint8Array(s.contents):new Uint8Array(0)},expandFileStorage:function(s,u){var f=s.contents?s.contents.length:0;if(!(f>=u)){var p=1024*1024;u=Math.max(u,f*(f<p?2:1.125)>>>0),f!=0&&(u=Math.max(u,256));var m=s.contents;s.contents=new Uint8Array(u),s.usedBytes>0&&s.contents.set(m.subarray(0,s.usedBytes),0)}},resizeFileStorage:function(s,u){if(s.usedBytes!=u)if(u==0)s.contents=null,s.usedBytes=0;else{var f=s.contents;s.contents=new Uint8Array(u),f&&s.contents.set(f.subarray(0,Math.min(u,s.usedBytes))),s.usedBytes=u}},node_ops:{getattr:function(s){var u={};return u.dev=y.isChrdev(s.mode)?s.id:1,u.ino=s.id,u.mode=s.mode,u.nlink=1,u.uid=0,u.gid=0,u.rdev=s.rdev,y.isDir(s.mode)?u.size=4096:y.isFile(s.mode)?u.size=s.usedBytes:y.isLink(s.mode)?u.size=s.link.length:u.size=0,u.atime=new Date(s.timestamp),u.mtime=new Date(s.timestamp),u.ctime=new Date(s.timestamp),u.blksize=4096,u.blocks=Math.ceil(u.size/u.blksize),u},setattr:function(s,u){u.mode!==void 0&&(s.mode=u.mode),u.timestamp!==void 0&&(s.timestamp=u.timestamp),u.size!==void 0&&ee.resizeFileStorage(s,u.size)},lookup:function(s,u){throw y.genericErrors[44]},mknod:function(s,u,f,p){return ee.createNode(s,u,f,p)},rename:function(s,u,f){if(y.isDir(s.mode)){var p;try{p=y.lookupNode(u,f)}catch{}if(p)for(var m in p.contents)throw new y.ErrnoError(55)}delete s.parent.contents[s.name],s.parent.timestamp=Date.now(),s.name=f,u.contents[f]=s,u.timestamp=s.parent.timestamp,s.parent=u},unlink:function(s,u){delete s.contents[u],s.timestamp=Date.now()},rmdir:function(s,u){var f=y.lookupNode(s,u);for(var p in f.contents)throw new y.ErrnoError(55);delete s.contents[u],s.timestamp=Date.now()},readdir:function(s){var u=[".",".."];for(var f in s.contents)s.contents.hasOwnProperty(f)&&u.push(f);return u},symlink:function(s,u,f){var p=ee.createNode(s,u,41471,0);return p.link=f,p},readlink:function(s){if(!y.isLink(s.mode))throw new y.ErrnoError(28);return s.link}},stream_ops:{read:function(s,u,f,p,m){var w=s.node.contents;if(m>=s.node.usedBytes)return 0;var S=Math.min(s.node.usedBytes-m,p);if(S>8&&w.subarray)u.set(w.subarray(m,m+S),f);else for(var _=0;_<S;_++)u[f+_]=w[m+_];return S},write:function(s,u,f,p,m,w){if(u.buffer===me.buffer&&(w=!1),!p)return 0;var S=s.node;if(S.timestamp=Date.now(),u.subarray&&(!S.contents||S.contents.subarray)){if(w)return S.contents=u.subarray(f,f+p),S.usedBytes=p,p;if(S.usedBytes===0&&m===0)return S.contents=u.slice(f,f+p),S.usedBytes=p,p;if(m+p<=S.usedBytes)return S.contents.set(u.subarray(f,f+p),m),p}if(ee.expandFileStorage(S,m+p),S.contents.subarray&&u.subarray)S.contents.set(u.subarray(f,f+p),m);else for(var _=0;_<p;_++)S.contents[m+_]=u[f+_];return S.usedBytes=Math.max(S.usedBytes,m+p),p},llseek:function(s,u,f){var p=u;if(f===1?p+=s.position:f===2&&y.isFile(s.node.mode)&&(p+=s.node.usedBytes),p<0)throw new y.ErrnoError(28);return p},allocate:function(s,u,f){ee.expandFileStorage(s.node,u+f),s.node.usedBytes=Math.max(s.node.usedBytes,u+f)},mmap:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);var w,S,_=s.node.contents;if(!(m&2)&&_.buffer===ut)S=!1,w=_.byteOffset;else{if((f>0||f+u<_.length)&&(_.subarray?_=_.subarray(f,f+u):_=Array.prototype.slice.call(_,f,f+u)),S=!0,w=ts(u),!w)throw new y.ErrnoError(48);me.set(_,w)}return{ptr:w,allocated:S}},msync:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);return m&2||ee.stream_ops.write(s,u,0,p,f,!1),0}}};function El(s,u,f,p){var m=p?"":"al "+s;T(s,function(w){_e(w,'Loading data file "'+s+'" failed (no arrayBuffer).'),u(new Uint8Array(w)),m&&_n()},function(w){if(f)f();else throw'Loading data file "'+s+'" failed.'}),m&&Ao()}var y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(s,u={})=>{if(s=Pt.resolve(y.cwd(),s),!s)return{path:"",node:null};var f={follow_mount:!0,recurse_count:0};if(u=Object.assign(f,u),u.recurse_count>8)throw new y.ErrnoError(32);for(var p=pe.normalizeArray(s.split("/").filter(U=>!!U),!1),m=y.root,w="/",S=0;S<p.length;S++){var _=S===p.length-1;if(_&&u.parent)break;if(m=y.lookupNode(m,p[S]),w=pe.join2(w,p[S]),y.isMountpoint(m)&&(!_||_&&u.follow_mount)&&(m=m.mounted.root),!_||u.follow)for(var E=0;y.isLink(m.mode);){var P=y.readlink(w);w=Pt.resolve(pe.dirname(w),P);var B=y.lookupPath(w,{recurse_count:u.recurse_count+1});if(m=B.node,E++>40)throw new y.ErrnoError(32)}}return{path:w,node:m}},getPath:s=>{for(var u;;){if(y.isRoot(s)){var f=s.mount.mountpoint;return u?f[f.length-1]!=="/"?f+"/"+u:f+u:f}u=u?s.name+"/"+u:s.name,s=s.parent}},hashName:(s,u)=>{for(var f=0,p=0;p<u.length;p++)f=(f<<5)-f+u.charCodeAt(p)|0;return(s+f>>>0)%y.nameTable.length},hashAddNode:s=>{var u=y.hashName(s.parent.id,s.name);s.name_next=y.nameTable[u],y.nameTable[u]=s},hashRemoveNode:s=>{var u=y.hashName(s.parent.id,s.name);if(y.nameTable[u]===s)y.nameTable[u]=s.name_next;else for(var f=y.nameTable[u];f;){if(f.name_next===s){f.name_next=s.name_next;break}f=f.name_next}},lookupNode:(s,u)=>{var f=y.mayLookup(s);if(f)throw new y.ErrnoError(f,s);for(var p=y.hashName(s.id,u),m=y.nameTable[p];m;m=m.name_next){var w=m.name;if(m.parent.id===s.id&&w===u)return m}return y.lookup(s,u)},createNode:(s,u,f,p)=>{var m=new y.FSNode(s,u,f,p);return y.hashAddNode(m),m},destroyNode:s=>{y.hashRemoveNode(s)},isRoot:s=>s===s.parent,isMountpoint:s=>!!s.mounted,isFile:s=>(s&61440)===32768,isDir:s=>(s&61440)===16384,isLink:s=>(s&61440)===40960,isChrdev:s=>(s&61440)===8192,isBlkdev:s=>(s&61440)===24576,isFIFO:s=>(s&61440)===4096,isSocket:s=>(s&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:s=>{var u=y.flagModes[s];if(typeof u>"u")throw new Error("Unknown file open mode: "+s);return u},flagsToPermissionString:s=>{var u=["r","w","rw"][s&3];return s&512&&(u+="w"),u},nodePermissions:(s,u)=>y.ignorePermissions?0:u.includes("r")&&!(s.mode&292)||u.includes("w")&&!(s.mode&146)||u.includes("x")&&!(s.mode&73)?2:0,mayLookup:s=>{var u=y.nodePermissions(s,"x");return u||(s.node_ops.lookup?0:2)},mayCreate:(s,u)=>{try{var f=y.lookupNode(s,u);return 20}catch{}return y.nodePermissions(s,"wx")},mayDelete:(s,u,f)=>{var p;try{p=y.lookupNode(s,u)}catch(w){return w.errno}var m=y.nodePermissions(s,"wx");if(m)return m;if(f){if(!y.isDir(p.mode))return 54;if(y.isRoot(p)||y.getPath(p)===y.cwd())return 10}else if(y.isDir(p.mode))return 31;return 0},mayOpen:(s,u)=>s?y.isLink(s.mode)?32:y.isDir(s.mode)&&(y.flagsToPermissionString(u)!=="r"||u&512)?31:y.nodePermissions(s,y.flagsToPermissionString(u)):44,MAX_OPEN_FDS:4096,nextfd:(s=0,u=y.MAX_OPEN_FDS)=>{for(var f=s;f<=u;f++)if(!y.streams[f])return f;throw new y.ErrnoError(33)},getStream:s=>y.streams[s],createStream:(s,u,f)=>{y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get:function(){return this.node},set:function(m){this.node=m}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(m){this.shared.flags=m}},position:{get:function(){return this.shared.position},set:function(m){this.shared.position=m}}})),s=Object.assign(new y.FSStream,s);var p=y.nextfd(u,f);return s.fd=p,y.streams[p]=s,s},closeStream:s=>{y.streams[s]=null},chrdev_stream_ops:{open:s=>{var u=y.getDevice(s.node.rdev);s.stream_ops=u.stream_ops,s.stream_ops.open&&s.stream_ops.open(s)},llseek:()=>{throw new y.ErrnoError(70)}},major:s=>s>>8,minor:s=>s&255,makedev:(s,u)=>s<<8|u,registerDevice:(s,u)=>{y.devices[s]={stream_ops:u}},getDevice:s=>y.devices[s],getMounts:s=>{for(var u=[],f=[s];f.length;){var p=f.pop();u.push(p),f.push.apply(f,p.mounts)}return u},syncfs:(s,u)=>{typeof s=="function"&&(u=s,s=!1),y.syncFSRequests++,y.syncFSRequests>1&&H("warning: "+y.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var f=y.getMounts(y.root.mount),p=0;function m(S){return y.syncFSRequests--,u(S)}function w(S){if(S)return w.errored?void 0:(w.errored=!0,m(S));++p>=f.length&&m(null)}f.forEach(S=>{if(!S.type.syncfs)return w(null);S.type.syncfs(S,s,w)})},mount:(s,u,f)=>{var p=f==="/",m=!f,w;if(p&&y.root)throw new y.ErrnoError(10);if(!p&&!m){var S=y.lookupPath(f,{follow_mount:!1});if(f=S.path,w=S.node,y.isMountpoint(w))throw new y.ErrnoError(10);if(!y.isDir(w.mode))throw new y.ErrnoError(54)}var _={type:s,opts:u,mountpoint:f,mounts:[]},E=s.mount(_);return E.mount=_,_.root=E,p?y.root=E:w&&(w.mounted=_,w.mount&&w.mount.mounts.push(_)),E},unmount:s=>{var u=y.lookupPath(s,{follow_mount:!1});if(!y.isMountpoint(u.node))throw new y.ErrnoError(28);var f=u.node,p=f.mounted,m=y.getMounts(p);Object.keys(y.nameTable).forEach(S=>{for(var _=y.nameTable[S];_;){var E=_.name_next;m.includes(_.mount)&&y.destroyNode(_),_=E}}),f.mounted=null;var w=f.mount.mounts.indexOf(p);f.mount.mounts.splice(w,1)},lookup:(s,u)=>s.node_ops.lookup(s,u),mknod:(s,u,f)=>{var p=y.lookupPath(s,{parent:!0}),m=p.node,w=pe.basename(s);if(!w||w==="."||w==="..")throw new y.ErrnoError(28);var S=y.mayCreate(m,w);if(S)throw new y.ErrnoError(S);if(!m.node_ops.mknod)throw new y.ErrnoError(63);return m.node_ops.mknod(m,w,u,f)},create:(s,u)=>(u=u!==void 0?u:438,u&=4095,u|=32768,y.mknod(s,u,0)),mkdir:(s,u)=>(u=u!==void 0?u:511,u&=1023,u|=16384,y.mknod(s,u,0)),mkdirTree:(s,u)=>{for(var f=s.split("/"),p="",m=0;m<f.length;++m)if(f[m]){p+="/"+f[m];try{y.mkdir(p,u)}catch(w){if(w.errno!=20)throw w}}},mkdev:(s,u,f)=>(typeof f>"u"&&(f=u,u=438),u|=8192,y.mknod(s,u,f)),symlink:(s,u)=>{if(!Pt.resolve(s))throw new y.ErrnoError(44);var f=y.lookupPath(u,{parent:!0}),p=f.node;if(!p)throw new y.ErrnoError(44);var m=pe.basename(u),w=y.mayCreate(p,m);if(w)throw new y.ErrnoError(w);if(!p.node_ops.symlink)throw new y.ErrnoError(63);return p.node_ops.symlink(p,m,s)},rename:(s,u)=>{var f=pe.dirname(s),p=pe.dirname(u),m=pe.basename(s),w=pe.basename(u),S,_,E;if(S=y.lookupPath(s,{parent:!0}),_=S.node,S=y.lookupPath(u,{parent:!0}),E=S.node,!_||!E)throw new y.ErrnoError(44);if(_.mount!==E.mount)throw new y.ErrnoError(75);var P=y.lookupNode(_,m),B=Pt.relative(s,p);if(B.charAt(0)!==".")throw new y.ErrnoError(28);if(B=Pt.relative(u,f),B.charAt(0)!==".")throw new y.ErrnoError(55);var U;try{U=y.lookupNode(E,w)}catch{}if(P!==U){var F=y.isDir(P.mode),N=y.mayDelete(_,m,F);if(N)throw new y.ErrnoError(N);if(N=U?y.mayDelete(E,w,F):y.mayCreate(E,w),N)throw new y.ErrnoError(N);if(!_.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(P)||U&&y.isMountpoint(U))throw new y.ErrnoError(10);if(E!==_&&(N=y.nodePermissions(_,"w"),N))throw new y.ErrnoError(N);y.hashRemoveNode(P);try{_.node_ops.rename(P,E,w)}catch(X){throw X}finally{y.hashAddNode(P)}}},rmdir:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node,p=pe.basename(s),m=y.lookupNode(f,p),w=y.mayDelete(f,p,!0);if(w)throw new y.ErrnoError(w);if(!f.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.rmdir(f,p),y.destroyNode(m)},readdir:s=>{var u=y.lookupPath(s,{follow:!0}),f=u.node;if(!f.node_ops.readdir)throw new y.ErrnoError(54);return f.node_ops.readdir(f)},unlink:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node;if(!f)throw new y.ErrnoError(44);var p=pe.basename(s),m=y.lookupNode(f,p),w=y.mayDelete(f,p,!1);if(w)throw new y.ErrnoError(w);if(!f.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.unlink(f,p),y.destroyNode(m)},readlink:s=>{var u=y.lookupPath(s),f=u.node;if(!f)throw new y.ErrnoError(44);if(!f.node_ops.readlink)throw new y.ErrnoError(28);return Pt.resolve(y.getPath(f.parent),f.node_ops.readlink(f))},stat:(s,u)=>{var f=y.lookupPath(s,{follow:!u}),p=f.node;if(!p)throw new y.ErrnoError(44);if(!p.node_ops.getattr)throw new y.ErrnoError(63);return p.node_ops.getattr(p)},lstat:s=>y.stat(s,!0),chmod:(s,u,f)=>{var p;if(typeof s=="string"){var m=y.lookupPath(s,{follow:!f});p=m.node}else p=s;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{mode:u&4095|p.mode&-4096,timestamp:Date.now()})},lchmod:(s,u)=>{y.chmod(s,u,!0)},fchmod:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);y.chmod(f.node,u)},chown:(s,u,f,p)=>{var m;if(typeof s=="string"){var w=y.lookupPath(s,{follow:!p});m=w.node}else m=s;if(!m.node_ops.setattr)throw new y.ErrnoError(63);m.node_ops.setattr(m,{timestamp:Date.now()})},lchown:(s,u,f)=>{y.chown(s,u,f,!0)},fchown:(s,u,f)=>{var p=y.getStream(s);if(!p)throw new y.ErrnoError(8);y.chown(p.node,u,f)},truncate:(s,u)=>{if(u<0)throw new y.ErrnoError(28);var f;if(typeof s=="string"){var p=y.lookupPath(s,{follow:!0});f=p.node}else f=s;if(!f.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(f.mode))throw new y.ErrnoError(31);if(!y.isFile(f.mode))throw new y.ErrnoError(28);var m=y.nodePermissions(f,"w");if(m)throw new y.ErrnoError(m);f.node_ops.setattr(f,{size:u,timestamp:Date.now()})},ftruncate:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);if(!(f.flags&2097155))throw new y.ErrnoError(28);y.truncate(f.node,u)},utime:(s,u,f)=>{var p=y.lookupPath(s,{follow:!0}),m=p.node;m.node_ops.setattr(m,{timestamp:Math.max(u,f)})},open:(s,u,f)=>{if(s==="")throw new y.ErrnoError(44);u=typeof u=="string"?y.modeStringToFlags(u):u,f=typeof f>"u"?438:f,u&64?f=f&4095|32768:f=0;var p;if(typeof s=="object")p=s;else{s=pe.normalize(s);try{var m=y.lookupPath(s,{follow:!(u&131072)});p=m.node}catch{}}var w=!1;if(u&64)if(p){if(u&128)throw new y.ErrnoError(20)}else p=y.mknod(s,f,0),w=!0;if(!p)throw new y.ErrnoError(44);if(y.isChrdev(p.mode)&&(u&=-513),u&65536&&!y.isDir(p.mode))throw new y.ErrnoError(54);if(!w){var S=y.mayOpen(p,u);if(S)throw new y.ErrnoError(S)}u&512&&!w&&y.truncate(p,0),u&=-131713;var _=y.createStream({node:p,path:y.getPath(p),flags:u,seekable:!0,position:0,stream_ops:p.stream_ops,ungotten:[],error:!1});return _.stream_ops.open&&_.stream_ops.open(_),r.logReadFiles&&!(u&1)&&(y.readFiles||(y.readFiles={}),s in y.readFiles||(y.readFiles[s]=1)),_},close:s=>{if(y.isClosed(s))throw new y.ErrnoError(8);s.getdents&&(s.getdents=null);try{s.stream_ops.close&&s.stream_ops.close(s)}catch(u){throw u}finally{y.closeStream(s.fd)}s.fd=null},isClosed:s=>s.fd===null,llseek:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(!s.seekable||!s.stream_ops.llseek)throw new y.ErrnoError(70);if(f!=0&&f!=1&&f!=2)throw new y.ErrnoError(28);return s.position=s.stream_ops.llseek(s,u,f),s.ungotten=[],s.position},read:(s,u,f,p,m)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if((s.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.read)throw new y.ErrnoError(28);var w=typeof m<"u";if(!w)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var S=s.stream_ops.read(s,u,f,p,m);return w||(s.position+=S),S},write:(s,u,f,p,m,w)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.write)throw new y.ErrnoError(28);s.seekable&&s.flags&1024&&y.llseek(s,0,2);var S=typeof m<"u";if(!S)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var _=s.stream_ops.write(s,u,f,p,m,w);return S||(s.position+=_),_},allocate:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(u<0||f<=0)throw new y.ErrnoError(28);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(s.node.mode)&&!y.isDir(s.node.mode))throw new y.ErrnoError(43);if(!s.stream_ops.allocate)throw new y.ErrnoError(138);s.stream_ops.allocate(s,u,f)},mmap:(s,u,f,p,m)=>{if(p&2&&!(m&2)&&(s.flags&2097155)!==2)throw new y.ErrnoError(2);if((s.flags&2097155)===1)throw new y.ErrnoError(2);if(!s.stream_ops.mmap)throw new y.ErrnoError(43);return s.stream_ops.mmap(s,u,f,p,m)},msync:(s,u,f,p,m)=>!s||!s.stream_ops.msync?0:s.stream_ops.msync(s,u,f,p,m),munmap:s=>0,ioctl:(s,u,f)=>{if(!s.stream_ops.ioctl)throw new y.ErrnoError(59);return s.stream_ops.ioctl(s,u,f)},readFile:(s,u={})=>{if(u.flags=u.flags||0,u.encoding=u.encoding||"binary",u.encoding!=="utf8"&&u.encoding!=="binary")throw new Error('Invalid encoding type "'+u.encoding+'"');var f,p=y.open(s,u.flags),m=y.stat(s),w=m.size,S=new Uint8Array(w);return y.read(p,S,0,w,0),u.encoding==="utf8"?f=xe(S,0):u.encoding==="binary"&&(f=S),y.close(p),f},writeFile:(s,u,f={})=>{f.flags=f.flags||577;var p=y.open(s,f.flags,f.mode);if(typeof u=="string"){var m=new Uint8Array(ue(u)+1),w=fe(u,m,0,m.length);y.write(p,m,0,w,void 0,f.canOwn)}else if(ArrayBuffer.isView(u))y.write(p,u,0,u.byteLength,void 0,f.canOwn);else throw new Error("Unsupported data type");y.close(p)},cwd:()=>y.currentPath,chdir:s=>{var u=y.lookupPath(s,{follow:!0});if(u.node===null)throw new y.ErrnoError(44);if(!y.isDir(u.node.mode))throw new y.ErrnoError(54);var f=y.nodePermissions(u.node,"x");if(f)throw new y.ErrnoError(f);y.currentPath=u.path},createDefaultDirectories:()=>{y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices:()=>{y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(u,f,p,m,w)=>m}),y.mkdev("/dev/null",y.makedev(1,3)),ar.register(y.makedev(5,0),ar.default_tty_ops),ar.register(y.makedev(6,0),ar.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var s=Sl();y.createDevice("/dev","random",s),y.createDevice("/dev","urandom",s),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{y.mkdir("/proc");var s=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount:()=>{var u=y.createNode(s,"fd",16895,73);return u.node_ops={lookup:(f,p)=>{var m=+p,w=y.getStream(m);if(!w)throw new y.ErrnoError(8);var S={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return S.parent=S,S}},u}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?y.createDevice("/dev","stdin",r.stdin):y.symlink("/dev/tty","/dev/stdin"),r.stdout?y.createDevice("/dev","stdout",null,r.stdout):y.symlink("/dev/tty","/dev/stdout"),r.stderr?y.createDevice("/dev","stderr",null,r.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError:()=>{y.ErrnoError||(y.ErrnoError=function(u,f){this.node=f,this.setErrno=function(p){this.errno=p},this.setErrno(u),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(s=>{y.genericErrors[s]=new y.ErrnoError(s),y.genericErrors[s].stack="<generic error, no stack>"}))},staticInit:()=>{y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(ee,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:ee}},init:(s,u,f)=>{y.init.initialized=!0,y.ensureErrnoError(),r.stdin=s||r.stdin,r.stdout=u||r.stdout,r.stderr=f||r.stderr,y.createStandardStreams()},quit:()=>{y.init.initialized=!1;for(var s=0;s<y.streams.length;s++){var u=y.streams[s];u&&y.close(u)}},getMode:(s,u)=>{var f=0;return s&&(f|=365),u&&(f|=146),f},findObject:(s,u)=>{var f=y.analyzePath(s,u);return f.exists?f.object:null},analyzePath:(s,u)=>{try{var f=y.lookupPath(s,{follow:!u});s=f.path}catch{}var p={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var f=y.lookupPath(s,{parent:!0});p.parentExists=!0,p.parentPath=f.path,p.parentObject=f.node,p.name=pe.basename(s),f=y.lookupPath(s,{follow:!u}),p.exists=!0,p.path=f.path,p.object=f.node,p.name=f.node.name,p.isRoot=f.path==="/"}catch(m){p.error=m.errno}return p},createPath:(s,u,f,p)=>{s=typeof s=="string"?s:y.getPath(s);for(var m=u.split("/").reverse();m.length;){var w=m.pop();if(w){var S=pe.join2(s,w);try{y.mkdir(S)}catch{}s=S}}return S},createFile:(s,u,f,p,m)=>{var w=pe.join2(typeof s=="string"?s:y.getPath(s),u),S=y.getMode(p,m);return y.create(w,S)},createDataFile:(s,u,f,p,m,w)=>{var S=u;s&&(s=typeof s=="string"?s:y.getPath(s),S=u?pe.join2(s,u):s);var _=y.getMode(p,m),E=y.create(S,_);if(f){if(typeof f=="string"){for(var P=new Array(f.length),B=0,U=f.length;B<U;++B)P[B]=f.charCodeAt(B);f=P}y.chmod(E,_|146);var F=y.open(E,577);y.write(F,f,0,f.length,0,w),y.close(F),y.chmod(E,_)}return E},createDevice:(s,u,f,p)=>{var m=pe.join2(typeof s=="string"?s:y.getPath(s),u),w=y.getMode(!!f,!!p);y.createDevice.major||(y.createDevice.major=64);var S=y.makedev(y.createDevice.major++,0);return y.registerDevice(S,{open:_=>{_.seekable=!1},close:_=>{p&&p.buffer&&p.buffer.length&&p(10)},read:(_,E,P,B,U)=>{for(var F=0,N=0;N<B;N++){var X;try{X=f()}catch{throw new y.ErrnoError(29)}if(X===void 0&&F===0)throw new y.ErrnoError(6);if(X==null)break;F++,E[P+N]=X}return F&&(_.node.timestamp=Date.now()),F},write:(_,E,P,B,U)=>{for(var F=0;F<B;F++)try{p(E[P+F])}catch{throw new y.ErrnoError(29)}return B&&(_.node.timestamp=Date.now()),F}}),y.mkdev(m,w,S)},forceLoadFile:s=>{if(s.isDevice||s.isFolder||s.link||s.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(b)try{s.contents=Gn(b(s.url),!0),s.usedBytes=s.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(s,u,f,p,m)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(N){if(!(N>this.length-1||N<0)){var X=N%this.chunkSize,ge=N/this.chunkSize|0;return this.getter(ge)[X]}},w.prototype.setDataGetter=function(N){this.getter=N},w.prototype.cacheLength=function(){var N=new XMLHttpRequest;if(N.open("HEAD",f,!1),N.send(null),!(N.status>=200&&N.status<300||N.status===304))throw new Error("Couldn't load "+f+". Status: "+N.status);var X=Number(N.getResponseHeader("Content-length")),ge,De=(ge=N.getResponseHeader("Accept-Ranges"))&&ge==="bytes",Be=(ge=N.getResponseHeader("Content-Encoding"))&&ge==="gzip",M=1024*1024;De||(M=X);var $=(Ee,Qe)=>{if(Ee>Qe)throw new Error("invalid range ("+Ee+", "+Qe+") or no bytes requested!");if(Qe>X-1)throw new Error("only "+X+" bytes available! programmer error!");var Ue=new XMLHttpRequest;if(Ue.open("GET",f,!1),X!==M&&Ue.setRequestHeader("Range","bytes="+Ee+"-"+Qe),Ue.responseType="arraybuffer",Ue.overrideMimeType&&Ue.overrideMimeType("text/plain; charset=x-user-defined"),Ue.send(null),!(Ue.status>=200&&Ue.status<300||Ue.status===304))throw new Error("Couldn't load "+f+". Status: "+Ue.status);return Ue.response!==void 0?new Uint8Array(Ue.response||[]):Gn(Ue.responseText||"",!0)},Ne=this;Ne.setDataGetter(Ee=>{var Qe=Ee*M,Ue=(Ee+1)*M-1;if(Ue=Math.min(Ue,X-1),typeof Ne.chunks[Ee]>"u"&&(Ne.chunks[Ee]=$(Qe,Ue)),typeof Ne.chunks[Ee]>"u")throw new Error("doXHR failed!");return Ne.chunks[Ee]}),(Be||!X)&&(M=X=1,X=this.getter(0).length,M=X,Y("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=X,this._chunkSize=M,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var S=new w;Object.defineProperties(S,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var _={isDevice:!1,contents:S}}else var _={isDevice:!1,url:f};var E=y.createFile(s,u,_,p,m);_.contents?E.contents=_.contents:_.url&&(E.contents=null,E.url=_.url),Object.defineProperties(E,{usedBytes:{get:function(){return this.contents.length}}});var P={},B=Object.keys(E.stream_ops);B.forEach(F=>{var N=E.stream_ops[F];P[F]=function(){return y.forceLoadFile(E),N.apply(null,arguments)}});function U(F,N,X,ge,De){var Be=F.node.contents;if(De>=Be.length)return 0;var M=Math.min(Be.length-De,ge);if(Be.slice)for(var $=0;$<M;$++)N[X+$]=Be[De+$];else for(var $=0;$<M;$++)N[X+$]=Be.get(De+$);return M}return P.read=(F,N,X,ge,De)=>(y.forceLoadFile(E),U(F,N,X,ge,De)),P.mmap=(F,N,X,ge,De)=>{y.forceLoadFile(E);var Be=ts(N);if(!Be)throw new y.ErrnoError(48);return U(F,me,Be,N,X),{ptr:Be,allocated:!0}},E.stream_ops=P,E},createPreloadedFile:(s,u,f,p,m,w,S,_,E,P)=>{var B=u?Pt.resolve(pe.join2(s,u)):s;function U(F){function N(X){P&&P(),_||y.createDataFile(s,u,X,p,m,E),w&&w(),_n()}Browser.handledByPreloadPlugin(F,B,N,()=>{S&&S(),_n()})||N(F)}Ao(),typeof f=="string"?El(f,F=>U(F),S):U(f)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(w){return f(w)}m.onupgradeneeded=()=>{Y("creating db");var w=m.result;w.createObjectStore(y.DB_STORE_NAME)},m.onsuccess=()=>{var w=m.result,S=w.transaction([y.DB_STORE_NAME],"readwrite"),_=S.objectStore(y.DB_STORE_NAME),E=0,P=0,B=s.length;function U(){P==0?u():f()}s.forEach(F=>{var N=_.put(y.analyzePath(F).object.contents,F);N.onsuccess=()=>{E++,E+P==B&&U()},N.onerror=()=>{P++,E+P==B&&U()}}),S.onerror=f},m.onerror=f},loadFilesFromDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(w){return f(w)}m.onupgradeneeded=f,m.onsuccess=()=>{var w=m.result;try{var S=w.transaction([y.DB_STORE_NAME],"readonly")}catch(F){f(F);return}var _=S.objectStore(y.DB_STORE_NAME),E=0,P=0,B=s.length;function U(){P==0?u():f()}s.forEach(F=>{var N=_.get(F);N.onsuccess=()=>{y.analyzePath(F).exists&&y.unlink(F),y.createDataFile(pe.dirname(F),pe.basename(F),N.result,!0,!0,!0),E++,E+P==B&&U()},N.onerror=()=>{P++,E+P==B&&U()}}),S.onerror=f},m.onerror=f}},de={DEFAULT_POLLMASK:5,calculateAt:function(s,u,f){if(pe.isAbs(u))return u;var p;if(s===-100)p=y.cwd();else{var m=y.getStream(s);if(!m)throw new y.ErrnoError(8);p=m.path}if(u.length==0){if(!f)throw new y.ErrnoError(44);return p}return pe.join2(p,u)},doStat:function(s,u,f){try{var p=s(u)}catch(m){if(m&&m.node&&pe.normalize(u)!==pe.normalize(y.getPath(m.node)))return-54;throw m}return I[f>>2]=p.dev,I[f+4>>2]=0,I[f+8>>2]=p.ino,I[f+12>>2]=p.mode,I[f+16>>2]=p.nlink,I[f+20>>2]=p.uid,I[f+24>>2]=p.gid,I[f+28>>2]=p.rdev,I[f+32>>2]=0,kt=[p.size>>>0,(ze=p.size,+Math.abs(ze)>=1?ze>0?(Math.min(+Math.floor(ze/4294967296),4294967295)|0)>>>0:~~+Math.ceil((ze-+(~~ze>>>0))/4294967296)>>>0:0)],I[f+40>>2]=kt[0],I[f+44>>2]=kt[1],I[f+48>>2]=4096,I[f+52>>2]=p.blocks,I[f+56>>2]=p.atime.getTime()/1e3|0,I[f+60>>2]=0,I[f+64>>2]=p.mtime.getTime()/1e3|0,I[f+68>>2]=0,I[f+72>>2]=p.ctime.getTime()/1e3|0,I[f+76>>2]=0,kt=[p.ino>>>0,(ze=p.ino,+Math.abs(ze)>=1?ze>0?(Math.min(+Math.floor(ze/4294967296),4294967295)|0)>>>0:~~+Math.ceil((ze-+(~~ze>>>0))/4294967296)>>>0:0)],I[f+80>>2]=kt[0],I[f+84>>2]=kt[1],0},doMsync:function(s,u,f,p,m){var w=Oe.slice(s,s+f);y.msync(u,w,m,f,p)},varargs:void 0,get:function(){de.varargs+=4;var s=I[de.varargs-4>>2];return s},getStr:function(s){var u=ne(s);return u},getStreamFromFD:function(s){var u=y.getStream(s);if(!u)throw new y.ErrnoError(8);return u}};function xl(s,u){try{return s=de.getStr(s),y.chmod(s,u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Cl(s,u,f,p){try{if(u=de.getStr(u),u=de.calculateAt(s,u),f&-8)return-28;var m=y.lookupPath(u,{follow:!0}),w=m.node;if(!w)return-44;var S="";return f&4&&(S+="r"),f&2&&(S+="w"),f&1&&(S+="x"),S&&y.nodePermissions(w,S)?-2:0}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function kl(s){return I[Ss()>>2]=s,s}function Pl(s,u,f){de.varargs=f;try{var p=de.getStreamFromFD(s);switch(u){case 0:{var m=de.get();if(m<0)return-28;var w;return w=y.createStream(p,m),w.fd}case 1:case 2:return 0;case 3:return p.flags;case 4:{var m=de.get();return p.flags|=m,0}case 5:{var m=de.get(),S=0;return Me[m+S>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return kl(28),-1;default:return-28}}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function Al(s,u){try{var f=de.getStreamFromFD(s);return de.doStat(y.stat,f.path,u)}catch(p){if(typeof y>"u"||!(p instanceof y.ErrnoError))throw p;return-p.errno}}function Rl(s,u,f){de.varargs=f;try{var p=de.getStreamFromFD(s);switch(u){case 21509:case 21505:return p.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return p.tty?0:-59;case 21519:{if(!p.tty)return-59;var m=de.get();return I[m>>2]=0,0}case 21520:return p.tty?-28:-59;case 21531:{var m=de.get();return y.ioctl(p,u,m)}case 21523:return p.tty?0:-59;case 21524:return p.tty?0:-59;default:Wt("bad ioctl syscall "+u)}}catch(w){if(typeof y>"u"||!(w instanceof y.ErrnoError))throw w;return-w.errno}}function Ol(s,u){try{return s=de.getStr(s),de.doStat(y.lstat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Ml(s,u,f,p){try{u=de.getStr(u);var m=p&256,w=p&4096;return p=p&-4353,u=de.calculateAt(s,u,w),de.doStat(m?y.lstat:y.stat,u,f)}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function Dl(s,u,f,p){de.varargs=p;try{u=de.getStr(u),u=de.calculateAt(s,u);var m=p?de.get():0;return y.open(u,f,m).fd}catch(w){if(typeof y>"u"||!(w instanceof y.ErrnoError))throw w;return-w.errno}}function Fl(s,u){try{return s=de.getStr(s),de.doStat(y.stat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Ll(s,u,f,p,m){}function xn(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function Bl(){for(var s=new Array(256),u=0;u<256;++u)s[u]=String.fromCharCode(u);rs=s}var rs=void 0;function Ye(s){for(var u="",f=s;Oe[f];)u+=rs[Oe[f++]];return u}var _r={},ur={},Cn={},Ul=48,Il=57;function kn(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var u=s.charCodeAt(0);return u>=Ul&&u<=Il?"_"+s:s}function Pn(s,u){return s=kn(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(u)}function Oo(s,u){var f=Pn(u,function(p){this.name=u,this.message=p;var m=new Error(p).stack;m!==void 0&&(this.stack=this.toString()+`
`+m.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},f}var Tr=void 0;function ve(s){throw new Tr(s)}var ns=void 0;function An(s){throw new ns(s)}function lr(s,u,f){s.forEach(function(_){Cn[_]=u});function p(_){var E=f(_);E.length!==s.length&&An("Mismatched type converter count");for(var P=0;P<s.length;++P)bt(s[P],E[P])}var m=new Array(u.length),w=[],S=0;u.forEach((_,E)=>{ur.hasOwnProperty(_)?m[E]=ur[_]:(w.push(_),_r.hasOwnProperty(_)||(_r[_]=[]),_r[_].push(()=>{m[E]=ur[_],++S,S===w.length&&p(m)}))}),w.length===0&&p(m)}function bt(s,u,f={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");var p=u.name;if(s||ve('type "'+p+'" must have a positive integer typeid pointer'),ur.hasOwnProperty(s)){if(f.ignoreDuplicateRegistrations)return;ve("Cannot register type '"+p+"' twice")}if(ur[s]=u,delete Cn[s],_r.hasOwnProperty(s)){var m=_r[s];delete _r[s],m.forEach(w=>w())}}function Gl(s,u,f,p,m){var w=xn(f);u=Ye(u),bt(s,{name:u,fromWireType:function(S){return!!S},toWireType:function(S,_){return _?p:m},argPackAdvance:8,readValueFromPointer:function(S){var _;if(f===1)_=me;else if(f===2)_=Me;else if(f===4)_=I;else throw new TypeError("Unknown boolean type size: "+u);return this.fromWireType(_[S>>w])},destructorFunction:null})}function Nl(s){if(!(this instanceof $t)||!(s instanceof $t))return!1;for(var u=this.$$.ptrType.registeredClass,f=this.$$.ptr,p=s.$$.ptrType.registeredClass,m=s.$$.ptr;u.baseClass;)f=u.upcast(f),u=u.baseClass;for(;p.baseClass;)m=p.upcast(m),p=p.baseClass;return u===p&&f===m}function Vl(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function Mo(s){function u(f){return f.$$.ptrType.registeredClass.name}ve(u(s)+" instance already deleted")}var Do=!1;function os(s){}function Hl(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function is(s){s.count.value-=1;var u=s.count.value===0;u&&Hl(s)}function ss(s,u,f){if(u===f)return s;if(f.baseClass===void 0)return null;var p=ss(s,u,f.baseClass);return p===null?null:f.downcast(p)}var as={};function zl(){return Object.keys(Hr).length}function Wl(){var s=[];for(var u in Hr)Hr.hasOwnProperty(u)&&s.push(Hr[u]);return s}var Nr=[];function Fo(){for(;Nr.length;){var s=Nr.pop();s.$$.deleteScheduled=!1,s.delete()}}var Vr=void 0;function $l(s){Vr=s,Nr.length&&Vr&&Vr(Fo)}function Yl(){r.getInheritedInstanceCount=zl,r.getLiveInheritedInstances=Wl,r.flushPendingDeletes=Fo,r.setDelayFunction=$l}var Hr={};function Xl(s,u){for(u===void 0&&ve("ptr should not be undefined");s.baseClass;)u=s.upcast(u),s=s.baseClass;return u}function jl(s,u){return u=Xl(s,u),Hr[u]}function Rn(s,u){(!u.ptrType||!u.ptr)&&An("makeClassHandle requires ptr and ptrType");var f=!!u.smartPtrType,p=!!u.smartPtr;return f!==p&&An("Both smartPtrType and smartPtr must be specified"),u.count={value:1},zr(Object.create(s,{$$:{value:u}}))}function ql(s){var u=this.getPointee(s);if(!u)return this.destructor(s),null;var f=jl(this.registeredClass,u);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=u,f.$$.smartPtr=s,f.clone();var p=f.clone();return this.destructor(s),p}function m(){return this.isSmartPointer?Rn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:s}):Rn(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var w=this.registeredClass.getActualType(u),S=as[w];if(!S)return m.call(this);var _;this.isConst?_=S.constPointerType:_=S.pointerType;var E=ss(u,this.registeredClass,_.registeredClass);return E===null?m.call(this):this.isSmartPointer?Rn(_.registeredClass.instancePrototype,{ptrType:_,ptr:E,smartPtrType:this,smartPtr:s}):Rn(_.registeredClass.instancePrototype,{ptrType:_,ptr:E})}function zr(s){return typeof FinalizationRegistry>"u"?(zr=u=>u,s):(Do=new FinalizationRegistry(u=>{is(u.$$)}),zr=u=>{var f=u.$$,p=!!f.smartPtr;if(p){var m={$$:f};Do.register(u,m,u)}return u},os=u=>Do.unregister(u),zr(s))}function Zl(){if(this.$$.ptr||Mo(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=zr(Object.create(Object.getPrototypeOf(this),{$$:{value:Vl(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function Kl(){this.$$.ptr||Mo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ve("Object already scheduled for deletion"),os(this),is(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Ql(){return!this.$$.ptr}function Jl(){return this.$$.ptr||Mo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ve("Object already scheduled for deletion"),Nr.push(this),Nr.length===1&&Vr&&Vr(Fo),this.$$.deleteScheduled=!0,this}function ec(){$t.prototype.isAliasOf=Nl,$t.prototype.clone=Zl,$t.prototype.delete=Kl,$t.prototype.isDeleted=Ql,$t.prototype.deleteLater=Jl}function $t(){}function Lo(s,u,f){if(s[u].overloadTable===void 0){var p=s[u];s[u]=function(){return s[u].overloadTable.hasOwnProperty(arguments.length)||ve("Function '"+f+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[u].overloadTable+")!"),s[u].overloadTable[arguments.length].apply(this,arguments)},s[u].overloadTable=[],s[u].overloadTable[p.argCount]=p}}function us(s,u,f){r.hasOwnProperty(s)?((f===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[f]!==void 0)&&ve("Cannot register public name '"+s+"' twice"),Lo(r,s,s),r.hasOwnProperty(f)&&ve("Cannot register multiple overloads of a function with the same number of arguments ("+f+")!"),r[s].overloadTable[f]=u):(r[s]=u,f!==void 0&&(r[s].numArguments=f))}function tc(s,u,f,p,m,w,S,_){this.name=s,this.constructor=u,this.instancePrototype=f,this.rawDestructor=p,this.baseClass=m,this.getActualType=w,this.upcast=S,this.downcast=_,this.pureVirtualFunctions=[]}function Bo(s,u,f){for(;u!==f;)u.upcast||ve("Expected null or instance of "+f.name+", got an instance of "+u.name),s=u.upcast(s),u=u.baseClass;return s}function rc(s,u){if(u===null)return this.isReference&&ve("null is not a valid "+this.name),0;u.$$||ve('Cannot pass "'+Vo(u)+'" as a '+this.name),u.$$.ptr||ve("Cannot pass deleted object as a pointer of type "+this.name);var f=u.$$.ptrType.registeredClass,p=Bo(u.$$.ptr,f,this.registeredClass);return p}function nc(s,u){var f;if(u===null)return this.isReference&&ve("null is not a valid "+this.name),this.isSmartPointer?(f=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,f),f):0;u.$$||ve('Cannot pass "'+Vo(u)+'" as a '+this.name),u.$$.ptr||ve("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&u.$$.ptrType.isConst&&ve("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);var p=u.$$.ptrType.registeredClass;if(f=Bo(u.$$.ptr,p,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&ve("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?f=u.$$.smartPtr:ve("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:f=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)f=u.$$.smartPtr;else{var m=u.clone();f=this.rawShare(f,Ge.toHandle(function(){m.delete()})),s!==null&&s.push(this.rawDestructor,f)}break;default:ve("Unsupporting sharing policy")}return f}function oc(s,u){if(u===null)return this.isReference&&ve("null is not a valid "+this.name),0;u.$$||ve('Cannot pass "'+Vo(u)+'" as a '+this.name),u.$$.ptr||ve("Cannot pass deleted object as a pointer of type "+this.name),u.$$.ptrType.isConst&&ve("Cannot convert argument of type "+u.$$.ptrType.name+" to parameter type "+this.name);var f=u.$$.ptrType.registeredClass,p=Bo(u.$$.ptr,f,this.registeredClass);return p}function On(s){return this.fromWireType(le[s>>2])}function ic(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function sc(s){this.rawDestructor&&this.rawDestructor(s)}function ac(s){s!==null&&s.delete()}function uc(){At.prototype.getPointee=ic,At.prototype.destructor=sc,At.prototype.argPackAdvance=8,At.prototype.readValueFromPointer=On,At.prototype.deleteObject=ac,At.prototype.fromWireType=ql}function At(s,u,f,p,m,w,S,_,E,P,B){this.name=s,this.registeredClass=u,this.isReference=f,this.isConst=p,this.isSmartPointer=m,this.pointeeType=w,this.sharingPolicy=S,this.rawGetPointee=_,this.rawConstructor=E,this.rawShare=P,this.rawDestructor=B,!m&&u.baseClass===void 0?p?(this.toWireType=rc,this.destructorFunction=null):(this.toWireType=oc,this.destructorFunction=null):this.toWireType=nc}function lc(s,u,f){r.hasOwnProperty(s)||An("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&f!==void 0?r[s].overloadTable[f]=u:(r[s]=u,r[s].argCount=f)}function cc(s,u,f){var p=r["dynCall_"+s];return f&&f.length?p.apply(null,[u].concat(f)):p.call(null,u)}function fc(s,u,f){return s.includes("j")?cc(s,u,f):En(u).apply(null,f)}function hc(s,u){var f=[];return function(){return f.length=0,Object.assign(f,arguments),fc(s,u,f)}}function cr(s,u){s=Ye(s);function f(){return s.includes("j")?hc(s,u):En(u)}var p=f();return typeof p!="function"&&ve("unknown function pointer with signature "+s+": "+u),p}var ls=void 0;function cs(s){var u=_s(s),f=Ye(u);return Mt(u),f}function Mn(s,u){var f=[],p={};function m(w){if(!p[w]&&!ur[w]){if(Cn[w]){Cn[w].forEach(m);return}f.push(w),p[w]=!0}}throw u.forEach(m),new ls(s+": "+f.map(cs).join([", "]))}function pc(s,u,f,p,m,w,S,_,E,P,B,U,F){B=Ye(B),w=cr(m,w),_&&(_=cr(S,_)),P&&(P=cr(E,P)),F=cr(U,F);var N=kn(B);us(N,function(){Mn("Cannot construct "+B+" due to unbound types",[p])}),lr([s,u,f],p?[p]:[],function(X){X=X[0];var ge,De;p?(ge=X.registeredClass,De=ge.instancePrototype):De=$t.prototype;var Be=Pn(N,function(){if(Object.getPrototypeOf(this)!==M)throw new Tr("Use 'new' to construct "+B);if($.constructor_body===void 0)throw new Tr(B+" has no accessible constructor");var Ue=$.constructor_body[arguments.length];if(Ue===void 0)throw new Tr("Tried to invoke ctor of "+B+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys($.constructor_body).toString()+") parameters instead!");return Ue.apply(this,arguments)}),M=Object.create(De,{constructor:{value:Be}});Be.prototype=M;var $=new tc(B,Be,M,F,ge,w,_,P),Ne=new At(B,$,!0,!1,!1),Ee=new At(B+"*",$,!1,!1,!1),Qe=new At(B+" const*",$,!1,!0,!1);return as[s]={pointerType:Ee,constPointerType:Qe},lc(N,Be),[Ne,Ee,Qe]})}function fs(s,u){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var f=Pn(s.name||"unknownFunctionName",function(){});f.prototype=s.prototype;var p=new f,m=s.apply(p,u);return m instanceof Object?m:p}function hs(s){for(;s.length;){var u=s.pop(),f=s.pop();f(u)}}function Uo(s,u,f,p,m){var w=u.length;w<2&&ve("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var S=u[1]!==null&&f!==null,_=!1,E=1;E<u.length;++E)if(u[E]!==null&&u[E].destructorFunction===void 0){_=!0;break}for(var P=u[0].name!=="void",B="",U="",E=0;E<w-2;++E)B+=(E!==0?", ":"")+"arg"+E,U+=(E!==0?", ":"")+"arg"+E+"Wired";var F="return function "+kn(s)+"("+B+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;_&&(F+=`var destructors = [];
`);var N=_?"destructors":"null",X=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ge=[ve,p,m,hs,u[0],u[1]];S&&(F+="var thisWired = classParam.toWireType("+N+`, this);
`);for(var E=0;E<w-2;++E)F+="var arg"+E+"Wired = argType"+E+".toWireType("+N+", arg"+E+"); // "+u[E+2].name+`
`,X.push("argType"+E),ge.push(u[E+2]);if(S&&(U="thisWired"+(U.length>0?", ":"")+U),F+=(P?"var rv = ":"")+"invoker(fn"+(U.length>0?", ":"")+U+`);
`,_)F+=`runDestructors(destructors);
`;else for(var E=S?1:2;E<u.length;++E){var De=E===1?"thisWired":"arg"+(E-2)+"Wired";u[E].destructorFunction!==null&&(F+=De+"_dtor("+De+"); // "+u[E].name+`
`,X.push(De+"_dtor"),ge.push(u[E].destructorFunction))}P&&(F+=`var ret = retType.fromWireType(rv);
return ret;
`),F+=`}
`,X.push(F);var Be=fs(Function,X).apply(null,ge);return Be}function Io(s,u){for(var f=[],p=0;p<s;p++)f.push(I[(u>>2)+p]);return f}function dc(s,u,f,p,m,w,S){var _=Io(f,p);u=Ye(u),w=cr(m,w),lr([],[s],function(E){E=E[0];var P=E.name+"."+u;function B(){Mn("Cannot call "+P+" due to unbound types",_)}u.startsWith("@@")&&(u=Symbol[u.substring(2)]);var U=E.registeredClass.constructor;return U[u]===void 0?(B.argCount=f-1,U[u]=B):(Lo(U,u,P),U[u].overloadTable[f-1]=B),lr([],_,function(F){var N=[F[0],null].concat(F.slice(1)),X=Uo(P,N,null,w,S);return U[u].overloadTable===void 0?(X.argCount=f-1,U[u]=X):U[u].overloadTable[f-1]=X,[]}),[]})}function vc(s,u,f,p,m,w){_e(u>0);var S=Io(u,f);m=cr(p,m),lr([],[s],function(_){_=_[0];var E="constructor "+_.name;if(_.registeredClass.constructor_body===void 0&&(_.registeredClass.constructor_body=[]),_.registeredClass.constructor_body[u-1]!==void 0)throw new Tr("Cannot register multiple constructors with identical number of parameters ("+(u-1)+") for class '"+_.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return _.registeredClass.constructor_body[u-1]=()=>{Mn("Cannot construct "+_.name+" due to unbound types",S)},lr([],S,function(P){return P.splice(1,0,null),_.registeredClass.constructor_body[u-1]=Uo(E,P,null,m,w),[]}),[]})}function gc(s,u,f,p,m,w,S,_){var E=Io(f,p);u=Ye(u),w=cr(m,w),lr([],[s],function(P){P=P[0];var B=P.name+"."+u;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),_&&P.registeredClass.pureVirtualFunctions.push(u);function U(){Mn("Cannot call "+B+" due to unbound types",E)}var F=P.registeredClass.instancePrototype,N=F[u];return N===void 0||N.overloadTable===void 0&&N.className!==P.name&&N.argCount===f-2?(U.argCount=f-2,U.className=P.name,F[u]=U):(Lo(F,u,B),F[u].overloadTable[f-2]=U),lr([],E,function(X){var ge=Uo(B,X,P,w,S);return F[u].overloadTable===void 0?(ge.argCount=f-2,F[u]=ge):F[u].overloadTable[f-2]=ge,[]}),[]})}var Go=[],ft=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function No(s){s>4&&--ft[s].refcount===0&&(ft[s]=void 0,Go.push(s))}function mc(){for(var s=0,u=5;u<ft.length;++u)ft[u]!==void 0&&++s;return s}function yc(){for(var s=5;s<ft.length;++s)if(ft[s]!==void 0)return ft[s];return null}function wc(){r.count_emval_handles=mc,r.get_first_emval=yc}var Ge={toValue:s=>(s||ve("Cannot use deleted val. handle = "+s),ft[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var u=Go.length?Go.pop():ft.length;return ft[u]={refcount:1,value:s},u}}}};function bc(s,u){u=Ye(u),bt(s,{name:u,fromWireType:function(f){var p=Ge.toValue(f);return No(f),p},toWireType:function(f,p){return Ge.toHandle(p)},argPackAdvance:8,readValueFromPointer:On,destructorFunction:null})}function Sc(s,u,f){switch(u){case 0:return function(p){var m=f?me:Oe;return this.fromWireType(m[p])};case 1:return function(p){var m=f?Me:lt;return this.fromWireType(m[p>>1])};case 2:return function(p){var m=f?I:le;return this.fromWireType(m[p>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function _c(s,u,f,p){var m=xn(f);u=Ye(u);function w(){}w.values={},bt(s,{name:u,constructor:w,fromWireType:function(S){return this.constructor.values[S]},toWireType:function(S,_){return _.value},argPackAdvance:8,readValueFromPointer:Sc(u,m,p),destructorFunction:null}),us(u,w)}function Dn(s,u){var f=ur[s];return f===void 0&&ve(u+" has unknown type "+cs(s)),f}function Tc(s,u,f){var p=Dn(s,"enum");u=Ye(u);var m=p.constructor,w=Object.create(p.constructor.prototype,{value:{value:f},constructor:{value:Pn(p.name+"_"+u,function(){})}});m.values[f]=w,m[u]=w}function Vo(s){if(s===null)return"null";var u=typeof s;return u==="object"||u==="array"||u==="function"?s.toString():""+s}function Ec(s,u){switch(u){case 2:return function(f){return this.fromWireType(ct[f>>2])};case 3:return function(f){return this.fromWireType($i[f>>3])};default:throw new TypeError("Unknown float type: "+s)}}function xc(s,u,f){var p=xn(f);u=Ye(u),bt(s,{name:u,fromWireType:function(m){return m},toWireType:function(m,w){return w},argPackAdvance:8,readValueFromPointer:Ec(u,p),destructorFunction:null})}function Cc(s,u,f){switch(u){case 0:return f?function(m){return me[m]}:function(m){return Oe[m]};case 1:return f?function(m){return Me[m>>1]}:function(m){return lt[m>>1]};case 2:return f?function(m){return I[m>>2]}:function(m){return le[m>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function kc(s,u,f,p,m){u=Ye(u);var w=xn(f),S=U=>U;if(p===0){var _=32-8*f;S=U=>U<<_>>>_}var E=u.includes("unsigned"),P=(U,F)=>{},B;E?B=function(U,F){return P(F,this.name),F>>>0}:B=function(U,F){return P(F,this.name),F},bt(s,{name:u,fromWireType:S,toWireType:B,argPackAdvance:8,readValueFromPointer:Cc(u,w,p!==0),destructorFunction:null})}function Pc(s,u,f){var p=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],m=p[u];function w(S){S=S>>2;var _=le,E=_[S],P=_[S+1];return new m(ut,P,E)}f=Ye(f),bt(s,{name:f,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function Ac(s,u){u=Ye(u);var f=u==="std::string";bt(s,{name:u,fromWireType:function(p){var m=le[p>>2],w;if(f)for(var S=p+4,_=0;_<=m;++_){var E=p+4+_;if(_==m||Oe[E]==0){var P=E-S,B=ne(S,P);w===void 0?w=B:(w+=String.fromCharCode(0),w+=B),S=E+1}}else{for(var U=new Array(m),_=0;_<m;++_)U[_]=String.fromCharCode(Oe[p+4+_]);w=U.join("")}return Mt(p),w},toWireType:function(p,m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));var w,S=typeof m=="string";S||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int8Array||ve("Cannot pass non-string to std::string"),f&&S?w=()=>ue(m):w=()=>m.length;var _=w(),E=Ot(4+_+1);if(le[E>>2]=_,f&&S)ye(m,E+4,_+1);else if(S)for(var P=0;P<_;++P){var B=m.charCodeAt(P);B>255&&(Mt(E),ve("String has UTF-16 code units that do not fit in 8 bits")),Oe[E+4+P]=B}else for(var P=0;P<_;++P)Oe[E+4+P]=m[P];return p!==null&&p.push(Mt,E),E},argPackAdvance:8,readValueFromPointer:On,destructorFunction:function(p){Mt(p)}})}function Rc(s,u,f){f=Ye(f);var p,m,w,S,_;u===2?(p=ce,m=we,S=he,w=()=>lt,_=1):u===4&&(p=Ce,m=yt,S=Ct,w=()=>le,_=2),bt(s,{name:f,fromWireType:function(E){for(var P=le[E>>2],B=w(),U,F=E+4,N=0;N<=P;++N){var X=E+4+N*u;if(N==P||B[X>>_]==0){var ge=X-F,De=p(F,ge);U===void 0?U=De:(U+=String.fromCharCode(0),U+=De),F=X+u}}return Mt(E),U},toWireType:function(E,P){typeof P!="string"&&ve("Cannot pass non-string to C++ string type "+f);var B=S(P),U=Ot(4+B+u);return le[U>>2]=B>>_,m(P,U+4,B+u),E!==null&&E.push(Mt,U),U},argPackAdvance:8,readValueFromPointer:On,destructorFunction:function(E){Mt(E)}})}function Oc(s,u){u=Ye(u),bt(s,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:function(){},toWireType:function(f,p){}})}function Mc(){return Date.now()}var Dc=!0;function Fc(){return Dc}function Lc(s,u,f){s=Ge.toValue(s),u=Dn(u,"emval::as");var p=[],m=Ge.toHandle(p);return I[f>>2]=m,u.toWireType(p,s)}function Bc(s){var u=[];return I[s>>2]=Ge.toHandle(u),u}var Uc={};function Ho(s){var u=Uc[s];return u===void 0?Ye(s):u}var zo=[];function Ic(s,u,f,p,m){return s=zo[s],u=Ge.toValue(u),f=Ho(f),s(u,f,Bc(p),m)}function ps(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Gc(s){return s===0?Ge.toHandle(ps()):(s=Ho(s),Ge.toHandle(ps()[s]))}function Nc(s){var u=zo.length;return zo.push(s),u}function Vc(s,u){for(var f=new Array(s),p=0;p<s;++p)f[p]=Dn(le[u+p*q>>2],"parameter "+p);return f}var ds=[];function Hc(s,u){var f=Vc(s,u),p=f[0],m=p.name+"_$"+f.slice(1).map(function(X){return X.name}).join("_")+"$",w=ds[m];if(w!==void 0)return w;for(var S=["retType"],_=[p],E="",P=0;P<s-1;++P)E+=(P!==0?", ":"")+"arg"+P,S.push("argType"+P),_.push(f[1+P]);for(var B=kn("methodCaller_"+m),U="return function "+B+`(handle, name, destructors, args) {
`,F=0,P=0;P<s-1;++P)U+="    var arg"+P+" = argType"+P+".readValueFromPointer(args"+(F?"+"+F:"")+`);
`,F+=f[P+1].argPackAdvance;U+="    var rv = handle[name]("+E+`);
`;for(var P=0;P<s-1;++P)f[P+1].deleteObject&&(U+="    argType"+P+".deleteObject(arg"+P+`);
`);p.isVoid||(U+=`    return retType.toWireType(destructors, rv);
`),U+=`};
`,S.push(U);var N=fs(Function,S).apply(null,_);return w=Nc(N),ds[m]=w,w}function zc(s,u){return s=Ge.toValue(s),u=Ge.toValue(u),Ge.toHandle(s[u])}function Wc(s){s>4&&(ft[s].refcount+=1)}function $c(s){return Ge.toHandle(Ho(s))}function Yc(s){var u=Ge.toValue(s);hs(u),No(s)}function Xc(s,u,f){s=Ge.toValue(s),u=Ge.toValue(u),f=Ge.toValue(f),s[u]=f}function jc(s,u){s=Dn(s,"_emval_take_value");var f=s.readValueFromPointer(u);return Ge.toHandle(f)}function qc(s){return s=Ge.toValue(s),Ge.toHandle(typeof s)}function Zc(s,u){var f=new Date(I[s>>2]*1e3);I[u>>2]=f.getSeconds(),I[u+4>>2]=f.getMinutes(),I[u+8>>2]=f.getHours(),I[u+12>>2]=f.getDate(),I[u+16>>2]=f.getMonth(),I[u+20>>2]=f.getFullYear()-1900,I[u+24>>2]=f.getDay();var p=new Date(f.getFullYear(),0,1),m=(f.getTime()-p.getTime())/(1e3*60*60*24)|0;I[u+28>>2]=m,I[u+36>>2]=-(f.getTimezoneOffset()*60);var w=new Date(f.getFullYear(),6,1).getTimezoneOffset(),S=p.getTimezoneOffset(),_=(w!=S&&f.getTimezoneOffset()==Math.min(S,w))|0;I[u+32>>2]=_}function Kc(s,u,f,p,m,w){try{var S=y.getStream(m);S&&(f&2&&de.doMsync(s,S,u,p,w),y.munmap(S))}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function Qc(s,u,f){var p=new Date().getFullYear(),m=new Date(p,0,1),w=new Date(p,6,1),S=m.getTimezoneOffset(),_=w.getTimezoneOffset(),E=Math.max(S,_);I[s>>2]=E*60,I[u>>2]=Number(S!=_);function P(X){var ge=X.toTimeString().match(/\(([A-Za-z ]+)\)$/);return ge?ge[1]:"GMT"}var B=P(m),U=P(w),F=wt(B),N=wt(U);_<S?(le[f>>2]=F,le[f+4>>2]=N):(le[f>>2]=N,le[f+4>>2]=F)}function Wo(s,u,f){Wo.called||(Wo.called=!0,Qc(s,u,f))}function Jc(){Wt("")}function vs(){return 2147483648}function ef(){return vs()}function tf(s,u,f){Oe.copyWithin(s,u,u+f)}function rf(s){try{return se.grow(s-ut.byteLength+65535>>>16),Yi(se.buffer),1}catch{}}function nf(s){var u=Oe.length;s=s>>>0;var f=vs();if(s>f)return!1;let p=(E,P)=>E+(P-E%P)%P;for(var m=1;m<=4;m*=2){var w=u*(1+.2/m);w=Math.min(w,s+100663296);var S=Math.min(f,p(Math.max(s,w),65536)),_=rf(S);if(_)return!0}return!1}var $o={};function of(){return a||"./this.program"}function Wr(){if(!Wr.strings){var s=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:s,_:of()};for(var f in $o)$o[f]===void 0?delete u[f]:u[f]=$o[f];var p=[];for(var f in u)p.push(f+"="+u[f]);Wr.strings=p}return Wr.strings}function sf(s,u){var f=0;return Wr().forEach(function(p,m){var w=u+f;le[s+m*4>>2]=w,Sr(p,w),f+=p.length+1}),0}function af(s,u){var f=Wr();le[s>>2]=f.length;var p=0;return f.forEach(function(m){p+=m.length+1}),le[u>>2]=p,0}function uf(s){Vf(s)}function lf(s){try{var u=de.getStreamFromFD(s);return y.close(u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return f.errno}}function cf(s,u,f,p){for(var m=0,w=0;w<f;w++){var S=le[u>>2],_=le[u+4>>2];u+=8;var E=y.read(s,me,S,_,p);if(E<0)return-1;if(m+=E,E<_)break}return m}function ff(s,u,f,p){try{var m=de.getStreamFromFD(s),w=cf(m,u,f);return I[p>>2]=w,0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return S.errno}}function hf(s,u){return u+2097152>>>0<4194305-!!s?(s>>>0)+u*4294967296:NaN}function pf(s,u,f,p,m){try{var w=hf(u,f);if(isNaN(w))return 61;var S=de.getStreamFromFD(s);return y.llseek(S,w,p),kt=[S.position>>>0,(ze=S.position,+Math.abs(ze)>=1?ze>0?(Math.min(+Math.floor(ze/4294967296),4294967295)|0)>>>0:~~+Math.ceil((ze-+(~~ze>>>0))/4294967296)>>>0:0)],I[m>>2]=kt[0],I[m+4>>2]=kt[1],S.getdents&&w===0&&p===0&&(S.getdents=null),0}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return _.errno}}function df(s,u,f,p){for(var m=0,w=0;w<f;w++){var S=le[u>>2],_=le[u+4>>2];u+=8;var E=y.write(s,me,S,_,p);if(E<0)return-1;m+=E}return m}function vf(s,u,f,p){try{var m=de.getStreamFromFD(s),w=df(m,u,f);return le[p>>2]=w,0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return S.errno}}function gs(s){for(var u=s.split("."),f=0;f<4;f++){var p=Number(u[f]);if(isNaN(p))return null;u[f]=p}return(u[0]|u[1]<<8|u[2]<<16|u[3]<<24)>>>0}function $r(s){return parseInt(s)}function gf(s){var u,f,p,m,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,S=[];if(!w.test(s))return null;if(s==="::")return[0,0,0,0,0,0,0,0];for(s.startsWith("::")?s=s.replace("::","Z:"):s=s.replace("::",":Z:"),s.indexOf(".")>0?(s=s.replace(new RegExp("[.]","g"),":"),u=s.split(":"),u[u.length-4]=$r(u[u.length-4])+$r(u[u.length-3])*256,u[u.length-3]=$r(u[u.length-2])+$r(u[u.length-1])*256,u=u.slice(0,u.length-2)):u=s.split(":"),p=0,m=0,f=0;f<u.length;f++)if(typeof u[f]=="string")if(u[f]==="Z"){for(m=0;m<8-u.length+1;m++)S[f+m]=0;p=m-1}else S[f+p]=Ts(parseInt(u[f],16));else S[f+p]=u[f];return[S[1]<<16|S[0],S[3]<<16|S[2],S[5]<<16|S[4],S[7]<<16|S[6]]}var Yt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(s){var u=gs(s);if(u!==null||(u=gf(s),u!==null))return s;var f;if(Yt.address_map.addrs[s])f=Yt.address_map.addrs[s];else{var p=Yt.address_map.id++;_e(p<65535,"exceeded max address mappings of 65535"),f="172.29."+(p&255)+"."+(p&65280),Yt.address_map.names[f]=s,Yt.address_map.addrs[s]=f}return f},lookup_addr:function(s){return Yt.address_map.names[s]?Yt.address_map.names[s]:null}};function mf(s){var u=Ot(20),f=Ot(s.length+1);ye(s,f,s.length+1),le[u>>2]=f;var p=Ot(4);le[p>>2]=0,le[u+4>>2]=p;var m=2;I[u+8>>2]=m,I[u+12>>2]=4;var w=Ot(12);return le[w>>2]=w+8,le[w+4>>2]=0,I[w+8>>2]=gs(Yt.lookup_name(s)),le[u+16>>2]=w,u}function yf(s){return mf(ne(s))}function wf(s){var u=s.getExtension("ANGLE_instanced_arrays");if(u)return s.vertexAttribDivisor=function(f,p){u.vertexAttribDivisorANGLE(f,p)},s.drawArraysInstanced=function(f,p,m,w){u.drawArraysInstancedANGLE(f,p,m,w)},s.drawElementsInstanced=function(f,p,m,w,S){u.drawElementsInstancedANGLE(f,p,m,w,S)},1}function bf(s){var u=s.getExtension("OES_vertex_array_object");if(u)return s.createVertexArray=function(){return u.createVertexArrayOES()},s.deleteVertexArray=function(f){u.deleteVertexArrayOES(f)},s.bindVertexArray=function(f){u.bindVertexArrayOES(f)},s.isVertexArray=function(f){return u.isVertexArrayOES(f)},1}function Sf(s){var u=s.getExtension("WEBGL_draw_buffers");if(u)return s.drawBuffers=function(f,p){u.drawBuffersWEBGL(f,p)},1}function _f(s){return!!(s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw"))}var Ae={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(u){Ae.lastError||(Ae.lastError=u)},getNewId:function(s){for(var u=Ae.counter++,f=s.length;f<u;f++)s[f]=null;return u},getSource:function(s,u,f,p){for(var m="",w=0;w<u;++w){var S=p?I[p+w*4>>2]:-1;m+=ne(I[f+w*4>>2],S<0?void 0:S)}return m},createContext:function(s,u){if(!s.getContextSafariWebGL2Fixed){let w=function(S,_){var E=s.getContextSafariWebGL2Fixed(S,_);return S=="webgl"==E instanceof WebGLRenderingContext?E:null};var m=w;s.getContextSafariWebGL2Fixed=s.getContext,s.getContext=w}var f=s.getContext("webgl",u);if(!f)return 0;var p=Ae.registerContext(f,u);return p},registerContext:function(s,u){var f=Ae.getNewId(Ae.contexts),p={handle:f,attributes:u,version:u.majorVersion,GLctx:s};return s.canvas&&(s.canvas.GLctxObject=p),Ae.contexts[f]=p,(typeof u.enableExtensionsByDefault>"u"||u.enableExtensionsByDefault)&&Ae.initExtensions(p),f},makeContextCurrent:function(s){return Ae.currentContext=Ae.contexts[s],r.ctx=qe=Ae.currentContext&&Ae.currentContext.GLctx,!(s&&!qe)},getContext:function(s){return Ae.contexts[s]},deleteContext:function(s){Ae.currentContext===Ae.contexts[s]&&(Ae.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(Ae.contexts[s].GLctx.canvas),Ae.contexts[s]&&Ae.contexts[s].GLctx.canvas&&(Ae.contexts[s].GLctx.canvas.GLctxObject=void 0),Ae.contexts[s]=null},initExtensions:function(s){if(s||(s=Ae.currentContext),!s.initExtensionsDone){s.initExtensionsDone=!0;var u=s.GLctx;wf(u),bf(u),Sf(u),u.disjointTimerQueryExt=u.getExtension("EXT_disjoint_timer_query"),_f(u);var f=u.getSupportedExtensions()||[];f.forEach(function(p){!p.includes("lose_context")&&!p.includes("debug")&&u.getExtension(p)})}}};function ms(s){return s.slice(-1)=="]"&&s.lastIndexOf("[")}function Tf(s){var u=s.uniformLocsById,f=s.uniformSizeAndIdsByName,p,m;if(!u)for(s.uniformLocsById=u={},s.uniformArrayNamesById={},p=0;p<qe.getProgramParameter(s,35718);++p){var w=qe.getActiveUniform(s,p),S=w.name,_=w.size,E=ms(S),P=E>0?S.slice(0,E):S,B=s.uniformIdCounter;for(s.uniformIdCounter+=_,f[P]=[_,B],m=0;m<_;++m)u[B]=m,s.uniformArrayNamesById[B++]=P}}function Ef(s,u){if(u=ne(u),s=Ae.programs[s]){Tf(s);var f=s.uniformLocsById,p=0,m=u,w=ms(u);w>0&&(p=$r(u.slice(w+1))>>>0,m=u.slice(0,w));var S=s.uniformSizeAndIdsByName[m];if(S&&p<S[0]&&(p+=S[1],f[p]=f[p]||qe.getUniformLocation(s,u)))return p}else Ae.recordError(1281);return-1}function Xt(s){var u=qe.currentProgram;if(u){var f=u.uniformLocsById[s];return typeof f=="number"&&(u.uniformLocsById[s]=f=qe.getUniformLocation(u,u.uniformArrayNamesById[s]+(f>0?"["+f+"]":""))),f}else Ae.recordError(1282)}function xf(s,u){qe.uniform1f(Xt(s),u)}function Cf(s,u){qe.uniform1i(Xt(s),u)}var Fn=[];function kf(s,u,f){if(u<=144)for(var p=Fn[2*u-1],m=0;m<2*u;m+=2)p[m]=ct[f+4*m>>2],p[m+1]=ct[f+(4*m+4)>>2];else var p=ct.subarray(f>>2,f+u*8>>2);qe.uniform2fv(Xt(s),p)}var Ln=[];function Pf(s,u,f){if(u<=144)for(var p=Ln[2*u-1],m=0;m<2*u;m+=2)p[m]=I[f+4*m>>2],p[m+1]=I[f+(4*m+4)>>2];else var p=I.subarray(f>>2,f+u*8>>2);qe.uniform2iv(Xt(s),p)}function Af(s,u,f){if(u<=96)for(var p=Fn[3*u-1],m=0;m<3*u;m+=3)p[m]=ct[f+4*m>>2],p[m+1]=ct[f+(4*m+4)>>2],p[m+2]=ct[f+(4*m+8)>>2];else var p=ct.subarray(f>>2,f+u*12>>2);qe.uniform3fv(Xt(s),p)}function Rf(s,u,f){if(u<=96)for(var p=Ln[3*u-1],m=0;m<3*u;m+=3)p[m]=I[f+4*m>>2],p[m+1]=I[f+(4*m+4)>>2],p[m+2]=I[f+(4*m+8)>>2];else var p=I.subarray(f>>2,f+u*12>>2);qe.uniform3iv(Xt(s),p)}function Of(s,u,f){if(u<=72){var p=Fn[4*u-1],m=ct;f>>=2;for(var w=0;w<4*u;w+=4){var S=f+w;p[w]=m[S],p[w+1]=m[S+1],p[w+2]=m[S+2],p[w+3]=m[S+3]}}else var p=ct.subarray(f>>2,f+u*16>>2);qe.uniform4fv(Xt(s),p)}function Mf(s,u,f){if(u<=72)for(var p=Ln[4*u-1],m=0;m<4*u;m+=4)p[m]=I[f+4*m>>2],p[m+1]=I[f+(4*m+4)>>2],p[m+2]=I[f+(4*m+8)>>2],p[m+3]=I[f+(4*m+12)>>2];else var p=I.subarray(f>>2,f+u*16>>2);qe.uniform4iv(Xt(s),p)}function Df(s){}function Bn(s){return s%4===0&&(s%100!==0||s%400===0)}function Ff(s,u){for(var f=0,p=0;p<=u;f+=s[p++]);return f}var ys=[31,29,31,30,31,30,31,31,30,31,30,31],ws=[31,28,31,30,31,30,31,31,30,31,30,31];function Lf(s,u){for(var f=new Date(s.getTime());u>0;){var p=Bn(f.getFullYear()),m=f.getMonth(),w=(p?ys:ws)[m];if(u>w-f.getDate())u-=w-f.getDate()+1,f.setDate(1),m<11?f.setMonth(m+1):(f.setMonth(0),f.setFullYear(f.getFullYear()+1));else return f.setDate(f.getDate()+u),f}return f}function Bf(s,u,f,p){var m=I[p+40>>2],w={tm_sec:I[p>>2],tm_min:I[p+4>>2],tm_hour:I[p+8>>2],tm_mday:I[p+12>>2],tm_mon:I[p+16>>2],tm_year:I[p+20>>2],tm_wday:I[p+24>>2],tm_yday:I[p+28>>2],tm_isdst:I[p+32>>2],tm_gmtoff:I[p+36>>2],tm_zone:m?ne(m):""},S=ne(f),_={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var E in _)S=S.replace(new RegExp(E,"g"),_[E]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=["January","February","March","April","May","June","July","August","September","October","November","December"];function U(M,$,Ne){for(var Ee=typeof M=="number"?M.toString():M||"";Ee.length<$;)Ee=Ne[0]+Ee;return Ee}function F(M,$){return U(M,$,"0")}function N(M,$){function Ne(Qe){return Qe<0?-1:Qe>0?1:0}var Ee;return(Ee=Ne(M.getFullYear()-$.getFullYear()))===0&&(Ee=Ne(M.getMonth()-$.getMonth()))===0&&(Ee=Ne(M.getDate()-$.getDate())),Ee}function X(M){switch(M.getDay()){case 0:return new Date(M.getFullYear()-1,11,29);case 1:return M;case 2:return new Date(M.getFullYear(),0,3);case 3:return new Date(M.getFullYear(),0,2);case 4:return new Date(M.getFullYear(),0,1);case 5:return new Date(M.getFullYear()-1,11,31);case 6:return new Date(M.getFullYear()-1,11,30)}}function ge(M){var $=Lf(new Date(M.tm_year+1900,0,1),M.tm_yday),Ne=new Date($.getFullYear(),0,4),Ee=new Date($.getFullYear()+1,0,4),Qe=X(Ne),Ue=X(Ee);return N(Qe,$)<=0?N(Ue,$)<=0?$.getFullYear()+1:$.getFullYear():$.getFullYear()-1}var De={"%a":function(M){return P[M.tm_wday].substring(0,3)},"%A":function(M){return P[M.tm_wday]},"%b":function(M){return B[M.tm_mon].substring(0,3)},"%B":function(M){return B[M.tm_mon]},"%C":function(M){var $=M.tm_year+1900;return F($/100|0,2)},"%d":function(M){return F(M.tm_mday,2)},"%e":function(M){return U(M.tm_mday,2," ")},"%g":function(M){return ge(M).toString().substring(2)},"%G":function(M){return ge(M)},"%H":function(M){return F(M.tm_hour,2)},"%I":function(M){var $=M.tm_hour;return $==0?$=12:$>12&&($-=12),F($,2)},"%j":function(M){return F(M.tm_mday+Ff(Bn(M.tm_year+1900)?ys:ws,M.tm_mon-1),3)},"%m":function(M){return F(M.tm_mon+1,2)},"%M":function(M){return F(M.tm_min,2)},"%n":function(){return`
`},"%p":function(M){return M.tm_hour>=0&&M.tm_hour<12?"AM":"PM"},"%S":function(M){return F(M.tm_sec,2)},"%t":function(){return"	"},"%u":function(M){return M.tm_wday||7},"%U":function(M){var $=M.tm_yday+7-M.tm_wday;return F(Math.floor($/7),2)},"%V":function(M){var $=Math.floor((M.tm_yday+7-(M.tm_wday+6)%7)/7);if((M.tm_wday+371-M.tm_yday-2)%7<=2&&$++,$){if($==53){var Ee=(M.tm_wday+371-M.tm_yday)%7;Ee!=4&&(Ee!=3||!Bn(M.tm_year))&&($=1)}}else{$=52;var Ne=(M.tm_wday+7-M.tm_yday-1)%7;(Ne==4||Ne==5&&Bn(M.tm_year%400-1))&&$++}return F($,2)},"%w":function(M){return M.tm_wday},"%W":function(M){var $=M.tm_yday+7-(M.tm_wday+6)%7;return F(Math.floor($/7),2)},"%y":function(M){return(M.tm_year+1900).toString().substring(2)},"%Y":function(M){return M.tm_year+1900},"%z":function(M){var $=M.tm_gmtoff,Ne=$>=0;return $=Math.abs($)/60,$=$/60*100+$%60,(Ne?"+":"-")+String("0000"+$).slice(-4)},"%Z":function(M){return M.tm_zone},"%%":function(){return"%"}};S=S.replace(/%%/g,"\0\0");for(var E in De)S.includes(E)&&(S=S.replace(new RegExp(E,"g"),De[E](w)));S=S.replace(/\0\0/g,"%");var Be=Gn(S,!1);return Be.length>u?0:(zt(Be,s),Be.length-1)}function Uf(s,u,f,p){return Bf(s,u,f,p)}var bs=function(s,u,f,p){s||(s=this),this.parent=s,this.mount=s.mount,this.mounted=null,this.id=y.nextInode++,this.name=u,this.mode=f,this.node_ops={},this.stream_ops={},this.rdev=p},Un=365,In=146;Object.defineProperties(bs.prototype,{read:{get:function(){return(this.mode&Un)===Un},set:function(s){s?this.mode|=Un:this.mode&=~Un}},write:{get:function(){return(this.mode&In)===In},set:function(s){s?this.mode|=In:this.mode&=~In}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=bs,y.staticInit(),Bl(),Tr=r.BindingError=Oo(Error,"BindingError"),ns=r.InternalError=Oo(Error,"InternalError"),ec(),Yl(),uc(),ls=r.UnboundTypeError=Oo(Error,"UnboundTypeError"),wc();for(var qe,If=new Float32Array(288),Rt=0;Rt<288;++Rt)Fn[Rt]=If.subarray(0,Rt+1);for(var Gf=new Int32Array(288),Rt=0;Rt<288;++Rt)Ln[Rt]=Gf.subarray(0,Rt+1);function Gn(s,u,f){var p=f>0?f:ue(s)+1,m=new Array(p),w=fe(s,m,0,m.length);return u&&(m.length=w),m}var Nf={ga:gl,k:ml,b:yl,c:bl,Q:xl,R:Cl,q:Pl,K:Al,U:Rl,I:Ol,H:Ml,u:Dl,J:Fl,z:Ll,W:Gl,d:pc,f:dc,e:vc,a:gc,V:bc,g:_c,h:Tc,v:xc,j:kc,i:Pc,w:Ac,r:Rc,X:Oc,N:Mc,M:Fc,m:Lc,ka:Ic,x:No,la:Gc,ja:Hc,s:zc,E:Wc,ia:$c,ma:Yc,n:Xc,l:jc,na:qc,O:Zc,D:Kc,P:Wo,t:Jc,C:ef,L:tf,o:nf,F:sf,G:af,fa:uf,p:lf,T:ff,y:pf,S:vf,ha:yf,ea:Ef,ca:xf,da:Cf,_:kf,ba:Pf,Z:Af,aa:Rf,Y:Of,$:Mf,A:Df,B:Uf};vl(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Ot=r._malloc=function(){return(Ot=r._malloc=r.asm.qa).apply(null,arguments)},Mt=r._free=function(){return(Mt=r._free=r.asm.ra).apply(null,arguments)},Ss=r.___errno_location=function(){return(Ss=r.___errno_location=r.asm.sa).apply(null,arguments)},_s=r.___getTypeName=function(){return(_s=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var Ts=r._htons=function(){return(Ts=r._htons=r.asm.wa).apply(null,arguments)},Es=r._emscripten_builtin_memalign=function(){return(Es=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},xs=r.___cxa_is_pointer_type=function(){return(xs=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=y;var Nn;function Yo(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}Gr=function s(){Nn||Xo(),Nn||(Gr=s)};function Xo(s){if(sr>0||(al(),sr>0))return;function u(){Nn||(Nn=!0,r.calledRun=!0,!Se&&(ul(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),ll()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),u()},1)):u()}r.run=Xo;function Vf(s,u){Hf(s)}function Hf(s){Ki()||(r.onExit&&r.onExit(s),Se=!0),l(s,new Yo(s))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Xo(),r.ready}})(),$f="/cad-os/assets/replicad_single-b4564eab.wasm";const ci={library:null},Yf=t=>{ci.library=t},G=()=>{if(!ci.library)throw new Error("oppencascade has not been loaded");return ci.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const jr=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class tt{constructor(e){this.oc=G(),e&&jr.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(jr.unregister(this._wrapped),this._wrapped.delete()),jr.register(this,e,e),this._wrapped=e}delete(){var e;jr.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const ke=()=>{function t(e){return jr.register(t,e),e}return t},Ve=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},Ia=2147483647,pt=Math.PI/180,Kr=180/Math.PI,jo=t=>Math.round(t*1e3)/1e3,tn=(t,e,r)=>{const n=G(),o=et(t),i=Gt(e);let a;if(r){const l=Gt(r);a=new n.gp_Ax3_3(o,i,l),l.delete()}else a=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),a},cn=(t,e,r)=>{const n=G(),o=et(t),i=Gt(e);let a;if(r){const l=Gt(r);a=new n.gp_Ax2_2(o,i,l),l.delete()}else a=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),a},Qr=(t,e)=>{const r=G(),n=et(t),o=Gt(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},Xf=(t=[0,0,0])=>{const e=G();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof O)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class O extends tt{constructor(e=[0,0,0]){super(Xf(e))}get repr(){return`x: ${jo(this.x)}, y: ${jo(this.y)}, z: ${jo(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new O(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new O(this.wrapped.Subtracted(e.wrapped))}add(e){return new O(this.wrapped.Added(e.wrapped))}multiply(e){return new O(this.wrapped.Multiplied(e))}normalized(){return new O(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*Kr}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),a=this.sub(i);return o.delete(),i.delete(),a}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Qr(r,n);return this.wrapped.Rotate(o,e*pt),o.delete(),this}}const jf={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function qf(t){return t==="X"||t==="Y"||t==="Z"?jf[t]:t}function et(t){const e=new O(t),r=e.toPnt();return e.delete(),r}function Gt(t){const e=new O(t),r=e.toDir();return e.delete(),r}class mr extends tt{constructor(e){const r=G();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new O(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Gt(n),i=et(r),a=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(a,e*pt),a.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=ke();let o,i;if(typeof e=="string"){const l=n(Ga(e,r));o=l.origin,i=l.zDir}else e instanceof Ze?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const a=n(cn(o,i));return this.wrapped.SetMirror_3(a),this}scale(e,r){const n=et(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=ke(),o=n(e==="reference"?new this.oc.gp_Ax3_1:tn(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:tn(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=et(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Ze{constructor(e,r=null,n=[0,0,1]){this.oc=G();const o=new O(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new O(r);else{const a=tn(e,o);i=new O(a.XDirection()),a.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new O(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Ze(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new O(e),r}translate(e,r=0,n=0){const o=new O(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=qf(r),o=new O(this.zDir).rotate(e,[0,0,0],n),i=new O(this.xDir).rotate(e,[0,0,0],n);return new Ze(this.origin,i,o)}rotate2DAxes(e){const r=new O(this.xDir).rotate(e,[0,0,0],this.zDir);return new Ze(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=tn(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new mr,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new mr,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new O(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new O(r);return r.delete(),n}}const Zf={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},Ga=(t,e=[0,0,0])=>{const r=Zf[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new Ze(n,r.xDir,r.normal)};let Kf=class extends tt{constructor(e){const r=G();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new O(e).repr} - ${new O(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},a={current:0};return this.wrapped.Get(e,r,n,o,i,a),[[e.current,r.current,n.current],[o.current,i.current,a.current]]}get center(){const[[e,r,n],[o,i,a]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(a-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function rr(t="XY",e=[0,0,0]){return t instanceof Ze?t.clone():Ga(t,e)}function Qf(t,e,r=[0,0,0],n=[0,0,1]){const o=new mr;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function Jf(t,e){const r=new mr;r.translate(e);const n=r.transform(t);return r.delete(),n}function eh(t,e,r){const n=new mr;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function th(t,e,r){const n=new mr;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function no(t){return Array.isArray(t)&&t.length===2}let Vn=null;const Cs=t=>{if(Vn&&!t)return Vn;const r=G().GeomAbs_CurveType;return Vn=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),Vn},fn=t=>{let e=Cs().get(t);if(e||(e=Cs(!0).get(t)),!e)throw new Error("unknown type");return e};function rh(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function nh(t){return Array.from(Array(t).keys())}function Ar(t){const e=Math.min(...t.map(r=>r.length));return nh(e).map(r=>t.map(n=>n[r]))}function oo(t){return Math.round(t*100)/100}const Jr=([t,e])=>`(${oo(t)},${oo(e)})`,ks=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Na=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${ks(r,e)},${ks(n,e)}]`,[r,n]])).values()),$e=([t,e])=>{const r=G();return new r.gp_Pnt2d_3(t,e)},oh=([t,e])=>{const r=G();return new r.gp_Dir2d_4(t,e)},Va=([t,e])=>{const r=G();return new r.gp_Vec2d_4(t,e)},Mr=(t,e)=>{const r=G(),[n,o]=Ve(),i=new r.gp_Ax2d_2(n($e(t)),n(oh(e)));return o(),i};class hn extends tt{constructor(e){const r=G();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${Jr(e)} - ${Jr(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=ke()($e(e));return!this.wrapped.IsOut_1(n)}}const je=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,Dr=([t,e],[r,n])=>[t+r,e+n],ki=([t,e],[r,n])=>[t-r,e-n],fi=([t,e],r)=>[t*r,e*r],St=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),ih=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function sh([t,e],[r,n]){return t*n-e*r}const ah=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),uh=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),Kt=([t,e])=>{const r=St([t,e]);return[t/r,e/r]},lh=(t,e,r=[0,0])=>{const[n,o]=t,[i,a]=r,l=n-i,c=o-a,h=Math.sin(e),d=Math.cos(e),g=l*d-c*h,v=l*h+c*d;return[g+i,v+a]},kr=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},ch=([t,e])=>{const r=St([t,e]),n=Math.atan2(e,t);return[r,n]};class Le extends tt{constructor(e){const r=G(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=G(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new hn(r),this._boundingBox}get repr(){return`${this.geomType} ${Jr(this.firstPoint)} - ${Jr(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=G();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=fn(e.GetType());return e.delete(),r}clone(){return new Le(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=G(),n=ke(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n($e(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,St(e,this.firstPoint),St(e,this.lastPoint))}distanceFromCurve(e){const r=G(),n=ke();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return no(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=G(),o=ke();let i,a;try{const l=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o($e(e)),this.wrapped));i=l.LowerDistance(),a=l.LowerDistanceParameter()}catch{if(je(e,this.firstPoint,r))return this.firstParameter;if(je(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${Jr(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return a}tangentAt(e){const r=G(),[n,o]=Ve();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const a=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,a,l);const c=[l.X(),l.Y()];return o(),c}splitAt(e,r=1e-9){const n=G(),o=ke();let i=e.map(c=>no(c)?this.parameter(c,r):c);i=Array.from(new Map(i.map(c=>[rh(c,-Math.log10(r)),c])).values()).sort((c,h)=>c-h);const a=this.firstParameter,l=this.lastParameter;return a>l&&i.reverse(),Math.abs(i[0]-a)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-l)<r*100&&(i=i.slice(0,-1)),i.length?Ar([[a,...i],[...i,l]]).map(([c,h])=>{try{if(this.geomType==="BEZIER_CURVE"){const g=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return g.Segment(c,h),new Le(new n.Handle_Geom2d_Curve_2(g))}if(this.geomType==="BSPLINE_CURVE"){const g=o(this.adaptor()).BSpline().get(),v=new n.Geom2d_BSplineCurve_1(g.Poles_2(),g.Knots_2(),g.Multiplicities_2(),g.Degree(),g.IsPeriodic());return v.Segment(c,h,r),new Le(new n.Handle_Geom2d_Curve_2(v))}const d=new n.Geom2d_TrimmedCurve(this.wrapped,c,h,!0,!0);return new Le(new n.Handle_Geom2d_Curve_2(d))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const Ha=(t,e=1e-4,r="C0",n=200)=>{const o=G(),i=ke(),a={C0:o.GeomAbs_Shape.GeomAbs_C0,C1:o.GeomAbs_Shape.GeomAbs_C1,C2:o.GeomAbs_Shape.GeomAbs_C2,C3:o.GeomAbs_Shape.GeomAbs_C3},l=i(new o.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,a[r],n,3));return new Le(l.Curve())},Ps=t=>{if(fn(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=G(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const a=n.NbArcs();if(a)for(let l=1;l<=a;l++){const c=n.Arc(l);yield new Le(c)}}const i=Array.from(o());return n.delete(),i};function io(t,e={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=ke();return t.flatMap(n=>{const o=r(n.adaptor()),i=fn(o.GetType());if(i==="ELLIPSE"||i==="CIRCLE"&&je(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(i))return n;if(i==="BEZIER_CURVE"){const c=o.Bezier().get().Degree();if([1,2,3].includes(c))return n}if(i==="BSPLINE_CURVE"){const l=Ps(o);return io(l,e)}const a=Ha(o,e.tolerance,e.continuity,e.maxSegments);return io(Ps(r(a.adaptor())),e)})}function*za(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*fh(t){const e=t.NbSegments();if(!e)return;const r=G();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new Le(o),i.delete()}}const pn=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=G(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,a;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from(za(o)),a=Array.from(fh(o))}catch(h){throw console.error(t,e,h),new Error("Intersections failed between curves")}finally{o.delete()}const l=a.filter(h=>je(h.firstPoint,h.lastPoint,r)).map(h=>h.firstPoint);l.length&&(i.push(...l),a=a.filter(h=>!je(h.firstPoint,h.lastPoint,r)));const c=a.flatMap(h=>[h.firstPoint,h.lastPoint]);return{intersections:i,commonSegments:a,commonSegmentsPoints:c}},hh=(t,e=1e-9)=>{const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from(za(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},dn=(t,e)=>{const r=G(),[n,o]=Ve(),i=n(new r.GCE2d_MakeSegment_1(n($e(t)),n($e(e)))).Value(),a=new Le(i);return je(a.firstPoint,t)||a.reverse(),o(),a},hi=(t,e,r)=>{const n=G(),[o,i]=Ve(),a=o(new n.GCE2d_MakeArcOfCircle_4(o($e(t)),o($e(e)),o($e(r)))).Value();i();const l=new Le(a);return je(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},ph=(t,e,r)=>{const n=G(),[o,i]=Ve(),a=o(new n.GCE2d_MakeArcOfCircle_5(o($e(t)),o(Va(e)),o($e(r)))).Value();i();const l=new Le(a);return je(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},dh=(t,e,r,n,o=[0,0],i,a=!0)=>{const l=G(),[c,h]=Ve(),d=c(new l.gp_Elips2d_2(c(Mr(o,i)),t,e,!0)),g=c(new l.GCE2d_MakeArcOfEllipse_1(d,r,n,a)).Value();return h(),new Le(g)},vh=(t,e,r)=>{const n=G(),[o,i]=Ve(),a=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));a.SetValue(1,o($e(t))),e.forEach((c,h)=>{a.SetValue(h+2,o($e(c)))}),a.SetValue(e.length+2,o($e(r)));const l=new n.Geom2d_BezierCurve_1(a);return i(),new Le(new n.Handle_Geom2d_Curve_2(l))},Wa=(t,e,r)=>{const n=fi(Dr(t,e),.5),o=St(r,t),i=Kt(ki(n,r));return hi(t,Dr(fi(i,o),r),e)},gh=(t,e,r)=>{const n=Kt(ki(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:Dr(t,i),lastPoint:Dr(e,i)}},pi=(t,e)=>{const r=ke(),n=t.geomType;if(n==="CIRCLE"){const c=r(r(t.adaptor()).Circle()),h=c.Radius(),d=c.IsDirect()?1:-1,g=e*d,v=h+g;if(v<1e-10){const A=r(c.Location()),L=[A.X(),A.Y()],D=Y=>{const[H,q]=Kt(ki(Y,L));return Dr(Y,[g*H,g*q])};return{collapsed:!0,firstPoint:D(t.firstPoint),lastPoint:D(t.lastPoint)}}const b=G(),T=new b.gp_Circ2d_3(c.Axis(),v),C=new b.Geom2d_Circle_1(T),x=new b.Geom2d_TrimmedCurve(new b.Handle_Geom2d_Curve_2(C),t.firstParameter,t.lastParameter,!0,!0);return new Le(new b.Handle_Geom2d_Curve_2(x))}if(n==="LINE"){const{firstPoint:c,lastPoint:h}=gh(t.firstPoint,t.lastPoint,e);return dn(c,h)}const o=G(),i=new Le(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),a=Ha(i.adaptor());return hh(a).length?{collapsed:!0,firstPoint:a.firstPoint,lastPoint:a.lastPoint}:a};function $a(t,e,r){const n=sh(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,a=pi(t,i),l=pi(e,i);if(!(a instanceof Le)||!(l instanceof Le))return null;let c;try{const{intersections:b}=pn(a,l,1e-9);c=b.at(-1)}catch{return null}if(!no(c))return null;const h=c,d=(b,T)=>{const[C,x]=T.tangentAt(h),A=Kt([-x,C]),L=Dr(h,fi(A,i)),D=b.parameter(L,1e-6);return b.splitAt([D])},[g]=d(t,a),[,v]=d(e,l);return{first:g,second:v,center:h}}function di(t,e,r){const n=$a(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:a}=n;return[o,Wa(o.lastPoint,i.firstPoint,a),i]}function vi(t,e,r){const n=$a(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,dn(o.lastPoint,i.firstPoint),i]}class mh{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let a=(i<<1)+1;const l=a+1;let c=this.ids[a],h=this.values[a];const d=this.values[l];if(l<this.length&&d<h&&(a=l,c=this.ids[l],h=d),h>=n)break;this.ids[i]=c,this.values[i]=h,i=a}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const As=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],qo=3;class Pi{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==qo)throw new Error(`Got v${n>>4} data when expected v${qo}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Pi(i,o,As[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,a=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),a+=i,this._levelBounds.push(a*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const l=As.indexOf(this.ArrayType),c=a*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=a*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+c+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(qo<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new mh}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let a=4*i;const l=this._boxes[a++],c=this._boxes[a++],h=this._boxes[a++],d=this._boxes[a++],g=Math.floor(o*((l+h)/2-this.minX)/e),v=Math.floor(o*((c+d)/2-this.minY)/r);n[i]=wh(g,v)}gi(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,a=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;a<l;){const c=a;let h=1/0,d=1/0,g=-1/0,v=-1/0;for(let b=0;b<this.nodeSize&&a<l;b++)h=Math.min(h,this._boxes[a++]),d=Math.min(d,this._boxes[a++]),g=Math.max(g,this._boxes[a++]),v=Math.max(v,this._boxes[a++]);this._indices[this._pos>>2]=c,this._boxes[this._pos++]=h,this._boxes[this._pos++]=d,this._boxes[this._pos++]=g,this._boxes[this._pos++]=v}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=[],c=[];for(;a!==void 0;){const h=Math.min(a+this.nodeSize*4,Os(a,this._levelBounds));for(let d=a;d<h;d+=4){if(n<this._boxes[d]||o<this._boxes[d+1]||e>this._boxes[d+2]||r>this._boxes[d+3])continue;const g=this._indices[d>>2]|0;a<this.numItems*4?(i===void 0||i(g))&&c.push(g):l.push(g)}a=l.pop()}return c}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=this._queue,c=[],h=o*o;for(;a!==void 0;){const d=Math.min(a+this.nodeSize*4,Os(a,this._levelBounds));for(let g=a;g<d;g+=4){const v=this._indices[g>>2]|0,b=Rs(e,this._boxes[g],this._boxes[g+2]),T=Rs(r,this._boxes[g+1],this._boxes[g+3]),C=b*b+T*T;a<this.numItems*4?(i===void 0||i(v))&&l.push((v<<1)+1,C):l.push(v<<1,C)}for(;l.length&&l.peek()&1;)if(l.peekValue()>h||(c.push(l.pop()>>1),c.length===n))return l.clear(),c;a=l.pop()>>1}return l.clear(),c}}function Rs(t,e,r){return t<e?e-t:t<=r?0:t-r}function Os(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function gi(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const a=t[n+o>>1];let l=n-1,c=o+1;for(;;){do l++;while(t[l]<a);do c--;while(t[c]>a);if(l>=c)break;yh(t,e,r,l,c)}gi(t,e,r,n,c,i),gi(t,e,r,c+1,o,i)}function yh(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const a=4*n,l=4*o,c=e[a],h=e[a+1],d=e[a+2],g=e[a+3];e[a]=e[l],e[a+1]=e[l+1],e[a+2]=e[l+2],e[a+3]=e[l+3],e[l]=c,e[l+1]=h,e[l+2]=d,e[l+3]=g;const v=r[n];r[n]=r[o],r[o]=v}function wh(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),a=r|n>>1,l=r>>1^r,c=o>>1^n&i>>1^o,h=r&o>>1^i>>1^i;r=a,n=l,o=c,i=h,a=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,c^=r&o>>2^n&i>>2,h^=n&o>>2^(r^n)&i>>2,r=a,n=l,o=c,i=h,a=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,c^=r&o>>4^n&i>>4,h^=n&o>>4^(r^n)&i>>4,r=a,n=l,o=c,i=h,c^=r&o>>8^n&i>>8,h^=n&o>>8^(r^n)&i>>8,r=c^c>>1,n=h^h>>1;let d=t^e,g=n|65535^(d|r);return d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,(g<<1|d)>>>0}const Ya=(t,e=1e-7)=>{const r=new Pi(t.length);t.forEach(i=>{const[a,l]=i.firstPoint;r.add(a-e,l-e,a+e,l+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,a)=>{if(o.has(a))return;const l=[i];let c=a;o.add(a);let h=t.length;for(;;){if(h--<0)throw new Error("Infinite loop detected");const d=l[l.length-1].lastPoint,[g,v]=d,b=r.search(g-e,v-e,g+e,v+e),T=L=>Math.abs((c-L)%t.length),C=b.filter(L=>!o.has(L)).map(L=>[t[L],L,T(L)]).sort(([,,L],[,,D])=>T(L)-T(D));if(C.length===0){n.push(l);break}const[x,A]=C[0];l.push(x),o.add(A),c=A}}),n};function ht(t){return Math.round(t*1e5)/1e5}const Zo=t=>`${oo(t.X())} ${oo(t.Y())}`,bh=(t,e)=>{const r=G(),n=fn(t.GetType()),[o,i]=e,a=`${ht(o)} ${ht(i)}`;if(n==="LINE")return`L ${a}`;if(n==="BEZIER_CURVE"){const l=t.Bezier().get(),c=l.Degree();if(c===1)return`L ${a}`;if(c===2)return`Q ${Zo(l.Pole(2))} ${a}`;if(c===3){const h=Zo(l.Pole(2)),d=Zo(l.Pole(3));return`C ${h} ${d} ${a}`}}if(n==="CIRCLE"){const l=t.Circle(),c=l.Radius(),h=t.FirstParameter(),g=(t.LastParameter()-h)*Kr,v=g!==360?a:`${ht(o)} ${ht(i+1e-4)}`;return`A ${c} ${c} 0 ${Math.abs(g)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${v}`}if(n==="ELLIPSE"){const l=t.Ellipse(),c=l.MajorRadius(),h=l.MinorRadius(),d=t.FirstParameter(),v=(t.LastParameter()-d)*Kr,b=v!==360?a:`${ht(o)} ${ht(i+1e-4)}`,T=new r.gp_Dir2d_1,C=180-l.XAxis().Direction().Angle(T)*Kr;return T.delete(),`A ${ht(c)} ${ht(h)} ${ht(C)} ${Math.abs(v)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${b}`}throw new Error(`Unsupported curve type: ${n}`)},Sh={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},so={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Xa{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class _h extends tt{constructor(){const e=G();super(new e.Message_ProgressRange_1)}}class Ko extends tt{constructor(e){const r=G();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(e.wrapped)}distanceTo(e){this.wrapped.LoadS2(e.wrapped);const r=new _h;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class ja extends Xa{when(e){return this.filters.push(e),this}inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new O(Sh[e]):n=new O(e);const o=({normal:i})=>{if(!i)return!1;const a=Math.acos(Math.abs(i.dot(n)));return Math.abs(a-pt*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=lo(r),o=new Ko(n),i=({element:a})=>Math.abs(o.distanceTo(a)-e)<1e-6;return this.filters.push(i),this}containsPoint(e){return this.atDistance(0,e)}withinDistance(e,r=[0,0,0]){const n=lo(r),o=new Ko(n),i=({element:a})=>o.distanceTo(a)-e<1e-6;return this.filters.push(i),this}inBox(e,r){const n=nn(e,r);return this.inShape(n)}inShape(e){const r=new Ko(e),n=({element:o})=>r.distanceTo(o)<1e-6;return this.filters.push(n),this}}class ao extends ja{clone(){const e=new ao;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&so[e])return this.atAngleWith(so[e],90);if(typeof e!="string"&&e instanceof Ze)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Ze?rr(e):rr(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.startPoint,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class Ai extends ja{clone(){const e=new Ai;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&so[e])return this.atAngleWith(so[e]);if(typeof e!="string"&&e instanceof Ze)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Ze?rr(e):rr(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.center,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const Th=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},Qo=2*Math.PI,Ms=t=>{const e=t%Qo,r=e<0?e+Qo:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-Qo)};class uo extends Xa{clone(){const e=new uo;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>je(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(St(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return je(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,a]=r,l=Math.min(n,i),c=Math.max(n,i),h=Math.min(o,a),d=Math.max(o,a);function g({element:v}){const[b,T]=v.point;return b>=l&&b<=c&&T>=h&&T<=d}return this.filters.push(g),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(Ms(ah(o,i))-Ms(pt*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return Th(e).filter(r=>this.shouldKeep(r))}}const Ds=t=>{const e=G();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},Eh=function*(e,r){const n=G(),o=new n.TopExp_Explorer_2(e,Ds(r),Ds("shape")),i=new Map;for(;o.More();){const a=o.Current(),l=a.HashCode(Ia);i.get(l)||(i.set(l,!0),yield a),o.Next()}o.delete()},qa=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class To extends tt{constructor(e){super(e)}clone(){return new this.constructor(yr(this.wrapped))}get hashCode(){return this.wrapped.HashCode(Ia)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=G(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=Re(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=Re(Jf(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Re(Qf(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=Re(eh(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=Re(th(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return Eh(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>yr(r))}get edges(){return this._listTopo("edge").map(e=>new or(e))}get faces(){return this._listTopo("face").map(e=>new Br(e))}get wires(){return this._listTopo("wire").map(e=>new Vt(e))}get boundingBox(){const e=new Kf;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const a=[];for(const l of this.faces){const c=l.triangulation(o.length/3);if(!c)continue;const{trianglesIndexes:h,vertices:d,verticesNormals:g}=c;a.push({start:n.length,count:h.length,faceId:l.hashCode}),n=n.concat(h),o=o.concat(d),i=i.concat(g)}return{triangles:n,vertices:o,normals:i,faceGroups:a}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=ke(),i=new Set,a=[],l=[],c=()=>{const d=a.length;let g=null;return[v=>{g?(a.push(...g),g=[v.X(),v.Y(),v.Z()],a.push(...g)):g=[v.X(),v.Y(),v.Z()]},v=>{l.push({start:d/3,count:(a.length-d)/3,edgeId:v}),i.add(v)}]},h=o(new this.oc.TopLoc_Location_1);for(const d of this.faces){const g=o(this.oc.BRep_Tool.Triangulation(d.wrapped,h,0));if(g.IsNull())continue;const v=g.get();for(const b of d.edges){if(o(b),i.has(b.hashCode))continue;const T=o(new this.oc.TopLoc_Location_1),C=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(b.wrapped,g,T)),x=(n=C==null?void 0:C.get())==null?void 0:n.Nodes();if(!x)continue;o(x);const[A,L]=c();for(let D=x.Lower();D<=x.Upper();D++){const Y=o(o(v.Node(x.Value(D))).Transformed(T.Transformation()));A(Y)}L(b.hashCode)}}for(const d of this.edges){o(d);const g=d.hashCode;if(i.has(g))continue;const v=o(new this.oc.BRepAdaptor_Curve_2(d.wrapped)),b=o(new this.oc.GCPnts_TangentialDeflection_2(v,e,r,2,1e-9,1e-7)),[T,C]=c();for(let x=0;x<b.NbPoints();x++){const A=o(b.Value(x+1).Transformed(h.Transformation()));T(A)}C(g)}return{lines:a,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const a=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([a],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Za extends To{}class Ka extends To{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new xh(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(e=0){return this.curve.tangentAt(e)}pointAt(e=0){return this.curve.pointAt(e)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class xh extends tt{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return fn(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new O(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new O(e)}_mapParameter(e){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*e}pointAt(e=.5){return new O(this.wrapped.Value(this._mapParameter(e)))}tangentAt(e=.5){const r=this._mapParameter(e),n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new O(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class or extends Ka{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Vt extends Ka{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=Re(o.Shape());if(o.delete(),this.delete(),!(i instanceof Vt))throw new Error("Could not offset with a wire");return i}}class Ch extends tt{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Br extends To{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Ch(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:a}=this.UVBounds,l=this._geomAdaptor(),c=new this.oc.gp_Pnt_1,h=e*(o-n)+n,d=r*(a-i)+i;l.D0(h,d,c);const g=new O(c);return l.delete(),c.delete(),g}normalAt(e){let r=0,n=0;const o=ke();if(e){const h=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),d=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(et(e)),h,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),g={current:0},v={current:0};d.LowerDistanceParameters(g,v),r=g.current,n=v.current}else{const{uMin:h,uMax:d,vMin:g,vMax:v}=this.UVBounds;r=.5*(h+d),n=.5*(g+v)}const i=o(new this.oc.gp_Pnt_1),a=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,a),new O(a)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new O(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Vt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=ke(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),a={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=o.get(),c=l.NbNodes();a.vertices=new Array(c*3);for(let T=1;T<=c;T++){const C=r(r(l.Node(T)).Transformed(i));a.vertices[(T-1)*3+0]=C.X(),a.vertices[(T-1)*3+1]=C.Y(),a.vertices[(T-1)*3+2]=C.Z()}const h=r(new this.oc.TColgp_Array1OfDir_2(1,c)),d=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,d,h),a.verticesNormals=new Array(h.Length()*3);for(let T=h.Lower();T<=h.Upper();T++){const C=r(r(h.Value(T)).Transformed(i));a.verticesNormals[(T-1)*3+0]=C.X(),a.verticesNormals[(T-1)*3+1]=C.Y(),a.verticesNormals[(T-1)*3+2]=C.Z()}const g=this.orientation,v=l.NbTriangles();a.trianglesIndexes=new Array(v*3);let b=0;for(let T=1;T<=v;T++){const C=r(l.Triangle(T));let x=C.Value(1),A=C.Value(2);const L=C.Value(3);if(g==="backward"){const D=x;x=A,A=D}a.trianglesIndexes[b*3+0]=x-1+e,a.trianglesIndexes[b*3+1]=A-1+e,a.trianglesIndexes[b*3+2]=L-1+e,b++}return a}}class Eo extends To{fuse(e,{optimisation:r="none"}={}){const n=ke(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Re(i.Shape());if(!Ft(a))throw new Error("Could not fuse as a 3d shape");return a}cut(e,{optimisation:r="none"}={}){const n=ke(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Re(i.Shape());if(!Ft(a))throw new Error("Could not cut as a 3d shape");return a}intersect(e){const r=ke(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=Re(o.Shape());if(!Ft(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,a;if(typeof e=="number"){a=e;const b=new Ai;i=typeof r=="function"?r(b):b}else a=e.thickness,i=e.filter;const l=ke(),c=i.find(this),h=l(new this.oc.TopTools_ListOfShape_1);c.forEach(b=>{h.Append_1(b.wrapped)});const d=l(new this.oc.Message_ProgressRange_1),g=l(new this.oc.BRepOffsetAPI_MakeThickSolid);g.MakeThickSolidByJoin(this.wrapped,h,-a,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,d);const v=Re(g.Shape());if(!Ft(v))throw new Error("Could not shell as a 3d shape");return v}_builderIter(e,r){if(typeof e=="number"){let a=0;for(const l of this._iterTopo("edge"))r(e,yr(l)),a+=1;return a}let n,o=null;typeof e=="function"?n=e:(n=a=>e.filter.shouldKeep(a)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const a of this._iterTopo("edge")){const l=yr(a),c=new or(l),h=n(c);h&&(r(h,l),i+=1),c.delete()}return o&&o(),i}fillet(e,r){const o=ke()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new ao)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not fillet, no edge was selected");const l=Re(o.Shape());if(!Ft(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const o=ke()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new ao)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not chamfer, no edge was selected");const l=Re(o.Shape());if(!Ft(l))throw new Error("Could not chamfer as a 3d shape");return l}}class Qa extends Eo{}class br extends Eo{}class Ja extends Eo{}class eu extends Eo{}function Ft(t){return t instanceof Qa||t instanceof br||t instanceof Ja||t instanceof eu}function Fs(t){return t instanceof Vt}function yr(t){const e=G(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=qa(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function Re(t){const r=G().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,Za],[r.TopAbs_EDGE,or],[r.TopAbs_WIRE,Vt],[r.TopAbs_FACE,Br],[r.TopAbs_SHELL,Qa],[r.TopAbs_SOLID,br],[r.TopAbs_COMPSOLID,Ja],[r.TopAbs_COMPOUND,eu]]).get(qa(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(yr(t))}const tu=(t,e)=>{const r=G();return new or(new r.BRepBuilderAPI_MakeEdge_3(et(t),et(e)).Edge())},kh=(t,e=[0,0,0],r=[0,0,1])=>{const n=G(),[o,i]=Ve(),a=o(cn(e,r)),l=o(new n.gp_Circ_2(a,t)),c=o(new n.BRepBuilderAPI_MakeEdge_8(l)),h=new or(c.Edge());return i(),h},Ph=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const a=G(),[l,c]=Ve();let h=2*Math.PI;i&&(h=-2*Math.PI);const d=l(new a.Geom2d_Line_3(l(new a.gp_Pnt2d_3(0,0)),l(new a.gp_Dir2d_4(h,t)))),g=e/t,v=d.Value(0),b=d.Value(g*Math.sqrt((2*Math.PI)**2+t**2)),T=l(new a.GCE2d_MakeSegment_1(v,b)),C=new a.Geom_CylindricalSurface_1(l(tn(n,o)),r),x=l(new a.BRepBuilderAPI_MakeEdge_30(l(new a.Handle_Geom2d_Curve_2(T.Value().get())),l(new a.Handle_Geom_Surface_2(C)))).Edge(),A=l(new a.BRepBuilderAPI_MakeWire_2(x)).Wire();return a.BRepLib.BuildCurves3d_2(A),c(),new Vt(A)},rn=t=>{const e=G(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(a=>{a instanceof or&&r.Add_1(a.wrapped),a instanceof Vt&&r.Add_2(a.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const a=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${a.get(o)||"unknown error"}`)}const i=new Vt(r.Wire());return r.delete(),n.delete(),i},Kn=(t,e)=>{const r=G(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new Br(o)},Ah=(t,e)=>{const r=G(),[n,o]=Ve(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new Br(l)},ru=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=G(),i=cn(r,n),a=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),l=new br(a.Shape());return i.delete(),a.delete(),l},Rh=t=>{const e=G(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new br(r.Shape());return r.delete(),n};class Oh extends tt{constructor(e,r,n){const o=G(),i=ke(),a=Math.sqrt(e*r/n),l=e/a,c=r/a,h=new o.gp_GTrsf_1;h.SetAffinity_1(Qr([0,0,0],[0,1,0]),l);const d=i(new o.gp_GTrsf_1);d.SetAffinity_1(Qr([0,0,0],[0,0,1]),a);const g=i(new o.gp_GTrsf_1);g.SetAffinity_1(Qr([0,0,0],[1,0,0]),c),h.Multiply(d),h.Multiply(g),super(h)}applyToPoint(e){const r=G(),o=ke()(e.XYZ());return this.wrapped.Transforms_1(o),new r.gp_Pnt_2(o)}}function Mh(t){const e=[];for(let r=t.LowerRow();r<=t.UpperRow();r++){const n=[];e.push(n);for(let o=t.LowerCol();o<=t.UpperCol();o++){const i=t.Value(r,o);n.push(i)}}return e}const Dh=(t,e,r)=>{const n=G(),o=ke(),i=o(new n.gp_Sphere_1);i.SetRadius(1);const a=o(new n.Geom_SphericalSurface_2(i)),l=n.GeomConvert.SurfaceToBSplineSurface(a.UReversed()).get(),c=Mh(l.Poles_2()),h=new Oh(t,e,r);c.forEach((g,v)=>{g.forEach((b,T)=>{const C=h.applyToPoint(b);l.SetPole_1(v+1,T+1,C)})});const d=Re(o(new n.BRepBuilderAPI_MakeShell_2(l.UReversed(),!1)).Shell());return Ri([d])},nn=(t,e)=>{const r=G(),n=new r.BRepPrimAPI_MakeBox_4(et(t),et(e)),o=new br(n.Solid());return n.delete(),o},lo=t=>{const e=G(),r=et(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new Za(o)},Lt=t=>{const e=G(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),Re(n)};function Fh(t){const e=G(),r=ke(),n=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return t.forEach(({wrapped:o})=>{n.Add(o)}),n.Perform(r(new e.Message_ProgressRange_1)),Re(yr(n.SewedShape()))}function Ri(t){const e=ke(),r=G(),n=Fh(t),o=Re(e(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(o instanceof br))throw new Error("Could not make a solid of faces and shells");return o}const nu=(t,e)=>{const r=G(),[n,o]=Ve(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(h=>{i.Add(h.wrapped)});const a=n(i.Face()),l=n(new r.ShapeFix_Face_2(a));l.FixOrientation_1();const c=l.Face();return o(),new Br(c)},Lh=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Bh=t=>{let e;t?Lh(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let a;typeof r=="number"?a=kr(1,r*pt):a=r;let l;return typeof i=="number"?l=kr(1,i*pt):l=i,{endTangent:a,startFactor:n,endFactor:o,startTangent:l}};function Ls(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let a=Math.acos(o/i);return t*n-e*r<0&&(a=-a),a}function Uh([t,e],[r,n],o,i,a,l,c){const h=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const d=Math.sin(a),g=Math.cos(a),v=(t-r)/2,b=(e-n)/2,T=(t+r)/2,C=(e+n)/2,x=g*v+d*b,A=g*b-d*v,L=x*x/(o*o)+A*A/(i*i);L>1&&(o=o*Math.sqrt(L),i=i*Math.sqrt(L));const D=o*i,Y=o*A,H=i*x,q=Y*Y+H*H;if(!q)throw Error("start point can not be same as end point");let j=Math.sqrt(Math.abs((D*D-q)/q));l==c&&(j=-j);const K=j*Y/i,se=-j*H/o,Se=g*K-d*se+T,_e=d*K+g*se+C,Te=(x-K)/o,xe=(x+K)/o,ne=(A-se)/i,fe=(A+se)/i,ye=Ls(1,0,Te,ne);let ue=Ls(Te,ne,-xe,-fe);for(;ue>h;)ue-=h;for(;ue<0;)ue+=h;c||(ue-=h);let re=ye+ue;for(;re>h;)re-=h;for(;re<0;)re+=h;return{cx:Se,cy:_e,startAngle:ye,deltaAngle:ue,endAngle:re,clockwise:!!c,rx:o,ry:i}}const ou=(t,e)=>{const r=G(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new br(yr(n.Shape()));return n.delete(),o},iu=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=G(),i=Qr(e,r),a=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*pt,!1),l=Re(a.Shape());if(i.delete(),a.delete(),!Ft(l))throw new Error("Could not revolve to a 3d shape");return l};function on(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:a,support:l,forceProfileSpineOthogonality:c}={},h=!1){const d=G(),g=i==="round"?!0:!!c,v=new d.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const C={transformed:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];C&&v.SetTransitionMode(C)}l?v.SetMode_4(l):r&&v.SetMode_1(r),n&&v.SetMode_5(n.wrapped,!1,d.BRepFill_TypeOfContact.BRepFill_NoContact),o?v.SetLaw_1(t.wrapped,o,!!a,g):v.Add_1(t.wrapped,!!a,g);const b=new d.Message_ProgressRange_1;v.Build(b),h||v.MakeSolid();const T=Re(v.Shape());if(!Ft(T))throw new Error("Could not sweep to a 3d shape");if(h){const C=Re(v.FirstShape()),x=Re(v.LastShape());if(!Fs(C))throw new Error("Could not sweep with one start wire");if(!Fs(x))throw new Error("Could not sweep with one end wire");return v.delete(),[T,C,x]}return v.delete(),b.delete(),T}const su=(t,{profile:e,endFactor:r=1})=>{let n;const o=G();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function au(t,e,r,n,o=!1){const i=new O(e),a=new O(r),l=tu(i,i.add(a)),c=rn([l]),h=n?su(a.Length,n):null;return o?on(t,c,{law:h},o):on(t,c,{law:h},o)}function uu(t,e,r,n,o,i=!1){const a=new O(r),l=new O(n),c=tu(a,a.add(l)),h=rn([c]),d=360/e*l.Length,g=1,v=Ph(d,l.Length,g,r,n),b=o?su(l.Length,o):null;return i?on(t,h,{auxiliarySpine:v,law:b},i):on(t,h,{auxiliarySpine:v,law:b},i)}const Ih=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=G(),[a,l]=Ve(),c=a(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&c.AddVertex(a(lo(r)).wrapped),t.forEach(g=>c.AddWire(g.wrapped)),n&&c.AddVertex(a(lo(n)).wrapped);const h=a(new i.Message_ProgressRange_1);c.Build(h);const d=Re(c.Shape());if(l(),!Ft(d))throw new Error("Could not loft to a 3d shape");return d};class Fr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Fr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new O(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new O(e)}face(){let e;return this.baseFace?e=Ah(this.baseFace,this.wire):e=Kn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=Kn(this.wire),o=iu(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[a,l]=Ve(),c=a(new O(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const g=au(this.wire,i||this.defaultOrigin,c,n);return l(),this.delete(),g}if(o){const g=uu(this.wire,o,i||this.defaultOrigin,c,n);return l(),this.delete(),g}const h=Kn(this.wire),d=ou(h,c);return l(),this.delete(),d}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),a=e(new Ze(n,i,o),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const c=on(a.wire,this.wire,l);return this.delete(),c}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=Ih(o.map(a=>a.wire),r,n);return o.forEach(a=>a.delete()),i}}const Gh=t=>{const e=G(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new hn(r)};function Nh(t,e){const[r,n]=Ve(),o=r(cn(e.origin,e.zDir,e.xDir)),i=G(),a=t.map(l=>{const c=i.GeomLib.To3d(o,l.wrapped);return new or(new i.BRepBuilderAPI_MakeEdge_24(c).Edge())});return n(),a}const Vh=(t,e)=>{const[r,n]=Ve(),o=G(),i=t.map(a=>{const l=r(new o.BRepBuilderAPI_MakeEdge_30(a.wrapped,e));return new or(l.Edge())});return n(),i},lu=(t,e)=>{const r=G();return t.map(o=>e?new Le(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class vn extends tt{transformCurves(e){return lu(e,this.wrapped)}}const cu=(t,e,r=[0,0])=>{const n=G(),o=Mr(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new vn(i)},Hh=t=>{const e=G(),[r,n]=Ve(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(Va(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new vn(i)},zh=(t,e=[0,0],r="center")=>{const n=G(),[o,i]=Ve(),a=new n.gp_Trsf2d_1;r==="center"?a.SetMirror_1(o($e(t))):a.SetMirror_2(o(Mr(e,t)));const l=new n.gp_GTrsf2d_2(a);return i(),new vn(l)},Wh=(t,e=[0,0])=>{const r=G(),[n,o]=Ve(),i=new r.gp_Trsf2d_1;i.SetRotation(n($e(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new vn(a)},$h=(t,e=[0,0])=>{const r=G(),[n,o]=Ve(),i=new r.gp_Trsf2d_1;i.SetScale(n($e(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new vn(a)};function Yh(t,e,r="original"){const[n,o]=Ve(),i=G();let a=n(i.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let c=null;const h=n(Mr([0,0],[0,1])),d=n(Mr([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const b=n(a.get().Cylinder());b.Direct()||(a=a.get().UReversed());const T=b.Radius();c=cu(1/T,[0,1]).wrapped}if(r==="bounds"){if(c=n(new i.gp_GTrsf2d_1),c.SetAffinity(h,l.uMax-l.uMin),l.uMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(new i.gp_XY_2(0,-l.uMin)),c.Multiply(T)}const b=n(new i.gp_GTrsf2d_1);if(b.SetAffinity(d,l.vMax-l.vMin),c.Multiply(b),l.vMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(n(new i.gp_XY_2(0,-l.vMin))),c.Multiply(T)}}const g=lu(t,c),v=Vh(g,a);return o(),v}function Xh(t,e){const r=G(),o=ke()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),i=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&i.Reverse(),new Le(new r.Handle_Geom2d_Curve_2(i))}const xo=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},Oi=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${xo(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class ie{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new ie(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=Gh(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=cu(e,r,n).transformCurves(this.curves);return new ie(o)}scale(e,r){const n=r||this.boundingBox.center,o=$h(e,n).transformCurves(this.curves);return new ie(o)}rotate(e,r){const n=Wh(e*pt,r).transformCurves(this.curves);return new ie(n)}translate(e,r=0){const n=no(e)?e:[e,r],o=Hh(n).transformCurves(this.curves);return new ie(o)}mirror(e,r=[0,0],n="center"){const o=zh(e,r,n).transformCurves(this.curves);return new ie(o)}sketchOnPlane(e,r){const n=e instanceof Ze?rr(e):rr(e,r),o=Nh(this.curves,n),i=rn(o);return new Fr(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=G(),o=Yh(this.curves,e,r),i=rn(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const a=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);a.FixEdgeCurves(),a.delete();const l=new Fr(i);if(i.isClosed){const c=l.clone().face();l.defaultOrigin=c.pointOnSurface(.5,.5),l.defaultDirection=c.normalAt(),c.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const c=i.startPoint;l.defaultOrigin=c,l.defaultDirection=e.normalAt(c),l.baseFace=e}return l}toSVGPathD(){const e=ke(),r=this.clone().mirror([1,0],[0,0],"plane"),o=io(r.curves).flatMap(l=>bh(e(l.adaptor()),l.lastPoint)),[i,a]=r.curves[0].firstPoint;return`M ${ht(i)} ${ht(a)} ${o.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return xo(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return Oi(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1,o=dn(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,l.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return je(this.firstPoint,this.lastPoint)}intersects(e){const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class jh{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?vi:di;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=dn(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*pt,o=kr(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*pt,[o,i]=kr(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=Kt(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(hi(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,a]=this.pointer;return this.threePointsArcTo([i+e,a+r],[i+n,a+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,a]=e,l=[(n+i)/2,(o+a)/2],c=[-(a-o),i-n],h=Math.sqrt(c[0]**2+c[1]**2),d=[l[0]+c[0]/h*r,l[1]+c[1]/h*r];return this.saveCurve(hi(this._convertToUV(this.pointer),this._convertToUV(d),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=St(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(ph(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,a=!1){let l=o,c=r,h=n;r<n&&(l=o+90,c=n,h=r);const d=l*pt,g=K=>St(this._convertToUV(K)),v=g(kr(c,d)),b=g(kr(h,d+Math.PI/2)),T=Kt(this._convertToUV(lh([1,0],d))),[,C]=ch(T),{cx:x,cy:A,startAngle:L,endAngle:D,clockwise:Y,rx:H,ry:q}=Uh(this._convertToUV(this.pointer),this._convertToUV(e),v,b,C,i,a),j=dh(H,q,Y?L:D,Y?D:L,[x,A],T);return Y||j.reverse(),this.saveCurve(j),this.pointer=e,this}ellipse(e,r,n,o,i=0,a=!1,l=!1){const[c,h]=this.pointer;return this.ellipseTo([e+c,r+h],n,o,i,a,l)}halfEllipseTo(e,r,n=!1){const o=uh(e,this.pointer),i=St(e,this.pointer);return this.ellipseTo(e,i/2,r,o*Kr,!0,n)}halfEllipse(e,r,n,o=!1){const[i,a]=this.pointer;return this.halfEllipseTo([i+e,a+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(vh(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:a}=Bh(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,c=St(this.pointer,e)*.25;let h;o?h=o:l?h=this._convertFromUV(l.tangentAt(1)):h=[1,0],h=Kt(h);const d=[this.pointer[0]+h[0]*i*c,this.pointer[1]+h[1]*i*c];let g;n==="symmetric"?g=[-h[0],-h[1]]:g=n,g=Kt(g);const v=[e[0]-g[0]*a*c,e[1]-g[1]*a*c];return this.cubicBezierCurveTo(e,d,v)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?vi:di;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){je(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(je(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=Mr(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new Le(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class qh extends jh{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new ie(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const Zh=t=>{const e=G(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,a)=>{i.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,a===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=Re(r.Shape());if(r.delete(),!(o instanceof Br))throw new Error("Failed to create a face");return o},Kh=(t,e)=>{const r=G(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},Bs=t=>{let e,r;try{e=Kn(t[0]),r=t.slice(1)}catch{e=Zh(t),r=t.slice(1).map(o=>Kh(o,e))}return nu(e,r)},Us=(t,e)=>{const r=[],n=[],o=[];t.forEach(c=>{const[h,d,g]=e(c);r.push(h),n.push(d),o.push(g)});const i=Bs(n),a=Bs(o);return Ri([i,...r,a])};class Is{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return Lt(e)}face(){const e=this.outerSketch.face();return nu(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const a=new O(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?Us(this.sketches,h=>au(h.wire,i||this.outerSketch.defaultOrigin,a,n,!0)):o?Us(this.sketches,h=>uu(h.wire,o,i||this.outerSketch.defaultOrigin,a,n,!0)):ou(this.face(),a)}revolve(e,{origin:r}={}){return iu(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,a)=>{const l=e.sketches[a];return i.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),Ri(n)}}class be{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new be(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new hn;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new be(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new be(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new be(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new be(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new be(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new Is(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new Is(n)}toSVGViewBox(e=1){return xo(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return Oi(this.toSVGGroup(),this.boundingBox,e)}}class Gs{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof Fr?r.wire:r.wires);return Lt(e)}faces(){const e=this.sketches.map(r=>r.face());return Lt(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return Lt(n)}revolve(e,r){return Lt(this.sketches.map(n=>n.revolve(e,r)))}}class Q{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new Q(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new hn;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new Q(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new Q(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new Q(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new Q(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new Q(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new Gs(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new Gs(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return xo(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof ie?n.toSVGPath():n.toSVGGroup());return Oi(r.join(`
    `),this.boundingBox,e)}}const Qh=t=>{const e=t.map((o,i)=>t.slice(i+1).map((a,l)=>[l+i+1,a]).filter(([,a])=>!o.boundingBox.isOut(a.boundingBox)).map(([a])=>a)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let a=n[i];a||(a=[],r.push(a)),a.push(t[i]),o.length&&o.forEach(l=>{n[l]=a})}),r},fu=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((a,l)=>r===l?!1:a.isInside(o));return{blueprint:e,isIn:i}}),Jh=(t,e)=>t.flatMap(({blueprint:r})=>Mi(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),ep=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=Mi(fu(t.map(({blueprint:o})=>o)));return[r,...n]},Mi=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?Jh(e,t):ep(r,t)},gn=t=>{const e=Qh(t).map(fu);return new Q(e.flatMap(Mi).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new be(r.map(({blueprint:n})=>n)))))},tp=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let i=Math.min(n,t/2),a=Math.min(o,e/2);const l=i&&a;l||(i=0,a=0);const c=i===a,h=new qh([Math.min(0,-(t/2-i)),-e/2]),d=(g,v)=>{l&&(c?h.tangentArc(g,v):h.ellipse(g,v,i,a,0,!1,!0))};return i<t/2&&h.hLine(t-2*i),d(i,a),a<e/2&&h.vLine(e-2*a),d(-i,a),i<t/2&&h.hLine(-(t-2*i)),d(-i,-a),a<e/2&&h.vLine(-(e-2*a)),d(i,-a),h.close()},Qn=1e-9,Xe=(t,e)=>je(t,e,Qn),qr=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},Ns=(t,e)=>{const r=t.findIndex(i=>Xe(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},Vs=(t,e)=>{const r=a=>Xe(e.firstPoint,a.firstPoint)&&Xe(e.lastPoint,a.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Di(t),n=t.findIndex(r),n===-1))throw console.error(t.map(a=>a.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*Hs(t,e,r){const n=a=>!!e.find(l=>Xe(l,a.lastPoint)),o=a=>!!r.find(l=>Xe(l.firstPoint,a.firstPoint)&&Xe(l.lastPoint,a.lastPoint)||Xe(l.firstPoint,a.lastPoint)&&Xe(l.lastPoint,a.firstPoint));let i=[];for(const a of t)n(a)?(i.push(a),yield i,i=[]):o(a)?(i.length&&(yield i,i=[]),yield[a]):i.push(a);i.length&&(yield i)}const rp=t=>t[0].firstPoint,Jo=t=>t[t.length-1].lastPoint,Di=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),np=t=>(t.reverse(),t.map(Di));function op(t,e,r){return t.filter(n=>{const o=e.filter(l=>Xe(l.firstPoint,n)||Xe(l.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(l=>r.isInside(qr(l)));return!(i.every(l=>l)||!i.some(l=>l))})}function ip(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((v,b)=>{e.curves.forEach((T,C)=>{const{intersections:x,commonSegments:A,commonSegmentsPoints:L}=pn(v,T,Qn/100);r.push(...x),o[b].push(...x),i[C].push(...x),n.push(...A),r.push(...L),o[b].push(...L),i[C].push(...L)})}),r=Na(r,Qn),!r.length||r.length===1)return null;const a=([v,b])=>b.length?v.splitAt(b,Qn/100):[v];let l=Ar([t.curves,o]).flatMap(a),c=Ar([e.curves,i]).flatMap(a);const h=n.map(v=>[v.firstPoint,v.lastPoint]);if(r=op(r,l,e),!r.length&&!n.length)return null;if(n.length){const v=n[0];l=Vs(l,v),c=Vs(c,v)}else{const v=r[0];l=Ns(l,v),c=Ns(c,v)}const d=Array.from(Hs(l,r,n));let g=Array.from(Hs(c,r,n));return(!Xe(Jo(g[0]),Jo(d[0]))||n.length>0&&g[0].length!==1)&&(g=np(g)),Ar([d,g]).map(([v,b])=>{const T=rp(v),C=Jo(v);return h.find(([x,A])=>Xe(x,T)&&Xe(A,C)||Xe(x,C)&&Xe(x,T))?[v,"same"]:[v,b]})}const sp=t=>{const e=t.map(a=>a.firstPoint);let r=t.map(a=>a.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=Ar([e,r]).map(([a,l],c)=>Xe(a,l)?null:c).filter(a=>a!==null);if(!n.length)return[t];const o=Ar([n.slice(0,-1),n.slice(1)]).map(([a,l])=>t.slice(a,l));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function Fi(t,e,{firstInside:r,secondInside:n}){const o=ip(t,e);if(!o){const h=qr(t.curves[0]),d=e.isInside(h),g=qr(e.curves[0]),v=t.isInside(g);return{identical:!1,firstCurveInSecond:d,secondCurveInFirst:v}}if(o.every(([,h])=>h==="same"))return{identical:!0};let i=null,a=null;const l=o.flatMap(([h,d])=>{let g=[],v=0;if(d==="same")return a===1?(a=1,[...h]):a===2||a===0?(a=null,[]):a===null?(i?i=[...i,...h]:i=h,[]):(console.error("weird situation"),[]);const b=qr(h[0]),T=e.isInside(b);(r==="keep"&&T||r==="remove"&&!T)&&(v+=1,g.push(...h));const C=qr(d[0]),x=t.isInside(C);if(n==="keep"&&x||n==="remove"&&!x){let A=d;v===1&&(A=Di(d)),v+=1,g.push(...A)}return a===null&&v===1&&i&&(g=[...i,...g]),v===1&&(a=v,i=null),g}),c=sp(l).filter(h=>h.length).map(h=>new ie(h));return c.length===0?null:c.length===1?c[0]:gn(c)}const Co=(t,e)=>{const r=Fi(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof ie||r instanceof Q?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new Q([t,e])},sn=(t,e)=>{const r=Fi(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof ie||r instanceof Q?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new Q([new be([t,e])]):t.clone()},Li=(t,e)=>{const r=Fi(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof ie||r instanceof Q?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},mi=(t,e)=>{if(t instanceof ie&&e instanceof ie){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:a}=pn(n,o);r.push(...i),r.push(...a)})}),r=Na(r),r.length>1}if(t instanceof be||t instanceof Q)return t.blueprints.some(r=>mi(r,e));if(e instanceof be||e instanceof Q)return e.blueprints.some(r=>mi(t,r));throw new Error("Bug in the generic intersects algorithm")},ap=(t,e)=>{if(t instanceof be){if(e instanceof ie)return co(e,t);if(e instanceof be)return fo(t,e)}if(e instanceof be){if(t instanceof ie)return co(t,e);if(t instanceof be)return fo(t,e)}if(t instanceof ie&&e instanceof ie)return Co(t,e);throw new Error("Bug in the generic fuse algorithm")},zs=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((a,l)=>{const c=i.current,h=o+l+1;if(i.fusedWith.has(h))return;let d=a,g=!1;if(e.has(h)&&(d=e.get(h).current,g=!0),c.boundingBox.isOut(d.boundingBox)||!mi(c,d))return;let v;if(c instanceof Q||d instanceof Q?v=Ut(c,d):v=ap(c,d),!(v instanceof ie||v instanceof be)){if(v instanceof Q&&v.blueprints.length===2)return;if(v instanceof Q&&v.blueprints.length===1)v=v.blueprints[0];else if(!(v instanceof Q))throw console.error(v),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(h),i.current=v,g||e.set(h,i)})}),gn(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>Bt(n)))},Bt=t=>t instanceof ie?[t]:t instanceof be?t.blueprints:t instanceof Q?t.blueprints.flatMap(e=>Bt(e)):[],co=(t,e)=>{const r=Co(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>sn(o,t));return gn([...Bt(r),...n.flatMap(o=>Bt(o))])};function up(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const fo=(t,e)=>{const r=Co(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(a=>sn(a,t.blueprints[0])),o=t.blueprints.slice(1).map(a=>sn(a,e.blueprints[0])),i=up(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([a,l])=>Bt(Li(a,l)));return gn([...Bt(r),...n.flatMap(a=>Bt(a)),...o.flatMap(a=>Bt(a)),...i])},Ut=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof Q)&&e instanceof Q)return zs([t,...e.blueprints]);if(!(e instanceof Q)&&t instanceof Q)return zs([e,...t.blueprints]);if(t instanceof Q&&e instanceof Q){let r=Ut(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=Ut(n,r)}),r}if(t instanceof be){if(e instanceof Q)return Ut(e,t);if(e instanceof ie)return co(e,t);if(e instanceof be)return fo(t,e)}if(e instanceof be){if(t instanceof Q)return Ut(t,e);if(t instanceof ie)return co(t,e);if(t instanceof be)return fo(t,e)}return t instanceof ie&&e instanceof ie?Co(t,e):null},ho=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof Q?r.blueprints:r);return e.length===1?e[0]:new Q(e)},Qt=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof Q)return ho(t.blueprints.map(n=>Qt(n,e)));if(t instanceof be){const n=t.blueprints[0];if(e instanceof ie&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=Ut(e,new Q(t.blueprints.slice(1)));return gn([n,...Bt(o)])}else{let o=Qt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=Qt(o,i)}),o}}if(e instanceof Q)return ho(e.blueprints.map(n=>Qt(t,n)));if(e instanceof be){let n=sn(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=Ut(n,Li(o,t))}),n}return sn(t,e)};function Zr(t,e){if(t===null||e===null)return null;if(t instanceof ie&&e instanceof ie)return Li(t,e);if(t instanceof Q)return ho(t.blueprints.map(r=>Zr(r,e)));if(t instanceof be){const r=t.blueprints[0],n=t.blueprints[1];return Qt(Zr(r,e),n)}if(e instanceof Q)return ho(e.blueprints.map(r=>Zr(t,r)));if(e instanceof be){const r=e.blueprints[0],n=e.blueprints[1];return Qt(Zr(r,t),n)}throw new Error("intersct 2D algorithm error")}const Ws=(t,e={})=>{const r=e.plane instanceof Ze?rr(e.plane):rr(e.plane,e.origin),n=rn([kh(t,r.origin,r.zDir)]),o=new Fr(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var a=n.charCodeAt(i),l;return a>=55296&&a<=56319&&o>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(a-55296)*1024+l-56320+65536:a}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function hu(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var lp=new hu,cp=new hu,pu=new Uint8Array(30),du=new Uint16Array(30),fp=new Uint8Array(30),hp=new Uint16Array(30);function vu(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function pp(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}pp(lp,cp);vu(pu,du,4,3);vu(fp,hp,2,1);pu[28]=0;du[28]=258;function Er(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function ir(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}ir.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};ir.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};ir.prototype.addX=function(t){this.addPoint(t,null)};ir.prototype.addY=function(t){this.addPoint(null,t)};ir.prototype.addBezier=function(t,e,r,n,o,i,a,l){var c=[t,e],h=[r,n],d=[o,i],g=[a,l];this.addPoint(t,e),this.addPoint(a,l);for(var v=0;v<=1;v++){var b=6*c[v]-12*h[v]+6*d[v],T=-3*c[v]+9*h[v]-9*d[v]+3*g[v],C=3*h[v]-3*c[v];if(T===0){if(b===0)continue;var x=-C/b;0<x&&x<1&&(v===0&&this.addX(Er(c[v],h[v],d[v],g[v],x)),v===1&&this.addY(Er(c[v],h[v],d[v],g[v],x)));continue}var A=Math.pow(b,2)-4*C*T;if(!(A<0)){var L=(-b+Math.sqrt(A))/(2*T);0<L&&L<1&&(v===0&&this.addX(Er(c[v],h[v],d[v],g[v],L)),v===1&&this.addY(Er(c[v],h[v],d[v],g[v],L)));var D=(-b-Math.sqrt(A))/(2*T);0<D&&D<1&&(v===0&&this.addX(Er(c[v],h[v],d[v],g[v],D)),v===1&&this.addY(Er(c[v],h[v],d[v],g[v],D)))}}};ir.prototype.addQuad=function(t,e,r,n,o,i){var a=t+.6666666666666666*(r-t),l=e+2/3*(n-e),c=a+1/3*(o-t),h=l+1/3*(i-e);this.addBezier(t,e,a,l,c,h,o,i)};function He(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}He.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};He.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};He.prototype.curveTo=He.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})};He.prototype.quadTo=He.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};He.prototype.close=He.prototype.closePath=function(){this.commands.push({type:"Z"})};He.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof ir){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};He.prototype.getBoundingBox=function(){for(var t=new ir,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var a=this.commands[i];switch(a.type){case"M":t.addPoint(a.x,a.y),e=n=a.x,r=o=a.y;break;case"L":t.addPoint(a.x,a.y),n=a.x,o=a.y;break;case"Q":t.addQuad(n,o,a.x1,a.y1,a.x,a.y),n=a.x,o=a.y;break;case"C":t.addBezier(n,o,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,o=a.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+a.type)}}return t.isEmpty()&&t.addPoint(0,0),t};He.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};He.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(t)}function r(){for(var a=arguments,l="",c=0;c<arguments.length;c+=1){var h=a[c];h>=0&&c>0&&(l+=" "),l+=e(h)}return l}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n};He.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};He.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function gu(t){throw new Error(t)}function $s(t,e){t||gu(e)}var J={fail:gu,argument:$s,assert:$s},Ys=32768,Xs=2147483648,Lr={},V={},Z={};function gt(t){return function(){return t}}V.BYTE=function(t){return J.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};Z.BYTE=gt(1);V.CHAR=function(t){return[t.charCodeAt(0)]};Z.CHAR=gt(1);V.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};Z.CHARARRAY=function(t){return typeof t>"u"?0:t.length};V.USHORT=function(t){return[t>>8&255,t&255]};Z.USHORT=gt(2);V.SHORT=function(t){return t>=Ys&&(t=-(2*Ys-t)),[t>>8&255,t&255]};Z.SHORT=gt(2);V.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};Z.UINT24=gt(3);V.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};Z.ULONG=gt(4);V.LONG=function(t){return t>=Xs&&(t=-(2*Xs-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};Z.LONG=gt(4);V.FIXED=V.ULONG;Z.FIXED=Z.ULONG;V.FWORD=V.SHORT;Z.FWORD=Z.SHORT;V.UFWORD=V.USHORT;Z.UFWORD=Z.USHORT;V.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};Z.LONGDATETIME=gt(8);V.TAG=function(t){return J.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};Z.TAG=gt(4);V.Card8=V.BYTE;Z.Card8=Z.BYTE;V.Card16=V.USHORT;Z.Card16=Z.USHORT;V.OffSize=V.BYTE;Z.OffSize=Z.BYTE;V.SID=V.USHORT;Z.SID=Z.USHORT;V.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?V.NUMBER16(t):V.NUMBER32(t)};Z.NUMBER=function(t){return V.NUMBER(t).length};V.NUMBER16=function(t){return[28,t>>8&255,t&255]};Z.NUMBER16=gt(3);V.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};Z.NUMBER32=gt(5);V.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,a=e.length;i<a;i+=1){var l=e[i];l==="e"?o+=e[++i]==="-"?"c":"b":l==="."?o+="a":l==="-"?o+="e":o+=l}o+=o.length&1?"f":"ff";for(var c=[30],h=0,d=o.length;h<d;h+=2)c.push(parseInt(o.substr(h,2),16));return c};Z.REAL=function(t){return V.REAL(t).length};V.NAME=V.CHARARRAY;Z.NAME=Z.CHARARRAY;V.STRING=V.CHARARRAY;Z.STRING=Z.CHARARRAY;Lr.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Lr.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)};V.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};Z.UTF16=function(t){return t.length*2};var yi={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Lr.MACSTRING=function(t,e,r,n){var o=yi[n];if(o!==void 0){for(var i="",a=0;a<r;a++){var l=t.getUint8(e+a);l<=127?i+=String.fromCharCode(l):i+=o[l&127]}return i}};var Hn=typeof WeakMap=="function"&&new WeakMap,zn,dp=function(t){if(!zn){zn={};for(var e in yi)zn[e]=new String(e)}var r=zn[t];if(r!==void 0){if(Hn){var n=Hn.get(r);if(n!==void 0)return n}var o=yi[t];if(o!==void 0){for(var i={},a=0;a<o.length;a++)i[o.charCodeAt(a)]=a+128;return Hn&&Hn.set(r,i),i}}};V.MACSTRING=function(t,e){var r=dp(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}};Z.MACSTRING=function(t,e){var r=V.MACSTRING(t,e);return r!==void 0?r.length:0};function wi(t){return t>=-128&&t<=127}function vp(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function gp(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(!wi(a)||a===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var l=e;l<i;++l)r.push(t[l]+256&255);return i}function mp(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(a===0||wi(a)&&i+1<o&&wi(t[i+1]))break;++i,++n}r.push(64|n-1);for(var l=e;l<i;++l){var c=t[l];r.push(c+65536>>8&255,c+256&255)}return i}V.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=vp(t,e,r):n>=-128&&n<=127?e=gp(t,e,r):e=mp(t,e,r)}return r};V.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=V.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var a=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,c=[void 0,V.BYTE,V.USHORT,V.UINT24,V.ULONG][l],h=0;h<r.length;h+=1){var d=c(r[h]);Array.prototype.push.apply(a,d)}return Array.prototype.concat(V.Card16(t.length),V.OffSize(l),a,n)};Z.INDEX=function(t){return V.INDEX(t).length};V.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),a=t[i];e=e.concat(V.OPERAND(a.value,a.type)),e=e.concat(V.OPERATOR(i))}return e};Z.DICT=function(t){return V.DICT(t).length};V.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};V.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)J.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(V.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(V.NUMBER(t));else if(e==="offset")r=r.concat(V.NUMBER32(t));else if(e==="number")r=r.concat(V.NUMBER(t));else if(e==="real")r=r.concat(V.REAL(t));else throw new Error("Unknown operand type "+e);return r};V.OP=V.BYTE;Z.OP=Z.BYTE;var Wn=typeof WeakMap=="function"&&new WeakMap;V.CHARSTRING=function(t){if(Wn){var e=Wn.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(V[i.type](i.value))}return Wn&&Wn.set(t,r),r};Z.CHARSTRING=function(t){return V.CHARSTRING(t).length};V.OBJECT=function(t){var e=V[t.type];return J.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};Z.OBJECT=function(t){var e=Z[t.type];return J.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};V.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var a=t.fields[i],l=V[a.type];J.argument(l!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var c=t[a.name];c===void 0&&(c=a.value);var h=l(c);a.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(h)):e=e.concat(h)}for(var d=0;d<n.length;d+=1){var g=o[d],v=e.length;J.argument(v<65536,"Table "+t.tableName+" too big."),e[g]=v>>8,e[g+1]=v&255,e=e.concat(n[d])}return e};Z.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=Z[o.type];J.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var a=t[o.name];a===void 0&&(a=o.value),e+=i(a),o.type==="TABLE"&&(e+=2)}return e};V.RECORD=V.TABLE;Z.RECORD=Z.TABLE;V.LITERAL=function(t){return t};Z.LITERAL=function(t){return t.length};function We(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),a=0;a<i.length;a+=1){var l=i[a],c=r[l];this[l]!==void 0&&(this[l]=c)}}We.prototype.encode=function(){return V.TABLE(this)};We.prototype.sizeOf=function(){return Z.TABLE(this)};function an(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function bi(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function un(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function po(t){t.format===1?We.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(an("glyph",t.glyphs))):t.format===2?We.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(un("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):J.assert(!1,"Coverage format must be 1 or 2.")}po.prototype=Object.create(We.prototype);po.prototype.constructor=po;function vo(t){We.call(this,"scriptListTable",un("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return J.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new We("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new We("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(an("featureIndex",o.featureIndexes)))}].concat(un("langSys",n.langSysRecords,function(i,a){var l=i.langSys;return[{name:"langSysTag"+a,type:"TAG",value:i.tag},{name:"langSys"+a,type:"TABLE",value:new We("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(an("featureIndex",l.featureIndexes)))}]})))}]}))}vo.prototype=Object.create(We.prototype);vo.prototype.constructor=vo;function go(t){We.call(this,"featureListTable",un("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new We("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(an("lookupListIndex",n.lookupListIndexes)))}]}))}go.prototype=Object.create(We.prototype);go.prototype.constructor=go;function mo(t,e){We.call(this,"lookupListTable",bi("lookup",t,function(r){var n=e[r.lookupType];return J.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new We("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(bi("subtable",r.subtables,n)))}))}mo.prototype=Object.create(We.prototype);mo.prototype.constructor=mo;var W={Table:We,Record:We,Coverage:po,ScriptList:vo,FeatureList:go,LookupList:mo,ushortList:an,tableList:bi,recordList:un};function js(t,e){return t.getUint8(e)}function yo(t,e){return t.getUint16(e,!1)}function yp(t,e){return t.getInt16(e,!1)}function Bi(t,e){return t.getUint32(e,!1)}function mu(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function wp(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function bp(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Sp(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function _p(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Tp={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function k(t,e){this.data=t,this.offset=e,this.relativeOffset=0}k.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};k.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};k.prototype.parseCard8=k.prototype.parseByte;k.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};k.prototype.parseCard16=k.prototype.parseUShort;k.prototype.parseSID=k.prototype.parseUShort;k.prototype.parseOffset16=k.prototype.parseUShort;k.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};k.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};k.prototype.parseULong=function(){var t=Bi(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};k.prototype.parseOffset32=k.prototype.parseULong;k.prototype.parseFixed=function(){var t=mu(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};k.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n};k.prototype.parseTag=function(){return this.parseString(4)};k.prototype.parseLongDateTime=function(){var t=Bi(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};k.prototype.parseVersion=function(t){var e=yo(this.data,this.offset+this.relativeOffset),r=yo(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};k.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Tp[t]*e};k.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};k.prototype.parseOffset16List=k.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};k.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};k.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e};k.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};k.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};k.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r};k.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r};k.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r};k.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};k.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};k.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new k(this.data,this.offset+e).parseStruct(t)};k.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new k(this.data,this.offset+e).parseStruct(t)};k.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var a=e[i];if(a===0){o[i]=void 0;continue}if(this.relativeOffset=a,t){for(var l=this.parseOffset16List(),c=new Array(l.length),h=0;h<l.length;h++)this.relativeOffset=a+l[h],c[h]=t.call(this);o[i]=c}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o};k.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};k.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:k.uShort,end:k.uShort,classId:k.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};k.list=function(t,e){return function(){return this.parseList(t,e)}};k.list32=function(t,e){return function(){return this.parseList32(t,e)}};k.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};k.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};k.pointer=function(t){return function(){return this.parsePointer(t)}};k.pointer32=function(t){return function(){return this.parsePointer32(t)}};k.tag=k.prototype.parseTag;k.byte=k.prototype.parseByte;k.uShort=k.offset16=k.prototype.parseUShort;k.uShortList=k.prototype.parseUShortList;k.uLong=k.offset32=k.prototype.parseULong;k.uLongList=k.prototype.parseULongList;k.struct=k.prototype.parseStruct;k.coverage=k.prototype.parseCoverage;k.classDef=k.prototype.parseClassDef;var qs={reserved:k.uShort,reqFeatureIndex:k.uShort,featureIndexes:k.uShortList};k.prototype.parseScriptList=function(){return this.parsePointer(k.recordList({tag:k.tag,script:k.pointer({defaultLangSys:k.pointer(qs),langSysRecords:k.recordList({tag:k.tag,langSys:k.pointer(qs)})})}))||[]};k.prototype.parseFeatureList=function(){return this.parsePointer(k.recordList({tag:k.tag,feature:k.pointer({featureParams:k.offset16,lookupListIndexes:k.uShortList})}))||[]};k.prototype.parseLookupList=function(t){return this.parsePointer(k.list(k.pointer(function(){var e=this.parseUShort();J.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(k.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};k.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();J.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:k.offset32,featureTableSubstitutionOffset:k.offset32});return r})||[]};var te={getByte:js,getCard8:js,getUShort:yo,getCard16:yo,getShort:yp,getULong:Bi,getFixed:mu,getTag:wp,getOffset:bp,getBytes:Sp,bytesToString:_p,Parser:k};function Ep(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),a=e.parseULong(),l=o;l<=i;l+=1)t.glyphIndexMap[l]=a,a++}function xp(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var a=new te.Parser(r,n+o+14),l=new te.Parser(r,n+o+16+i*2),c=new te.Parser(r,n+o+16+i*4),h=new te.Parser(r,n+o+16+i*6),d=n+o+16+i*8,g=0;g<i-1;g+=1)for(var v=void 0,b=a.parseUShort(),T=l.parseUShort(),C=c.parseShort(),x=h.parseUShort(),A=T;A<=b;A+=1)x!==0?(d=h.offset+h.relativeOffset-2,d+=x,d+=(A-T)*2,v=te.getUShort(r,d),v!==0&&(v=v+C&65535)):v=A+C&65535,t.glyphIndexMap[A]=v}function Cp(t,e){var r={};r.version=te.getUShort(t,e),J.argument(r.version===0,"cmap table version should be 0."),r.numTables=te.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=te.getUShort(t,e+4+o*8),a=te.getUShort(t,e+4+o*8+2);if(i===3&&(a===0||a===1||a===10)||i===0&&(a===0||a===1||a===2||a===3||a===4)){n=te.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new te.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)Ep(r,l);else if(r.format===4)xp(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function kp(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Pp(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Ap(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new W.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var a=t.get(r),l=0;l<a.unicodes.length;l+=1)kp(i,a.unicodes[l],r);i.segments=i.segments.sort(function(L,D){return L.start-D.start})}Pp(i);var c=i.segments.length,h=0,d=[],g=[],v=[],b=[],T=[],C=[];for(r=0;r<c;r+=1){var x=i.segments[r];x.end<=65535&&x.start<=65535?(d=d.concat({name:"end_"+r,type:"USHORT",value:x.end}),g=g.concat({name:"start_"+r,type:"USHORT",value:x.start}),v=v.concat({name:"idDelta_"+r,type:"SHORT",value:x.delta}),b=b.concat({name:"idRangeOffset_"+r,type:"USHORT",value:x.offset}),x.glyphId!==void 0&&(T=T.concat({name:"glyph_"+r,type:"USHORT",value:x.glyphId}))):h+=1,!e&&x.glyphIndex!==void 0&&(C=C.concat({name:"cmap12Start_"+r,type:"ULONG",value:x.start}),C=C.concat({name:"cmap12End_"+r,type:"ULONG",value:x.end}),C=C.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:x.glyphIndex}))}if(i.segCountX2=(c-h)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(c-h)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(d),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(g),i.fields=i.fields.concat(v),i.fields=i.fields.concat(b),i.fields=i.fields.concat(T),i.cmap4Length=14+d.length*2+2+g.length*2+v.length*2+b.length*2+T.length*2,!e){var A=16+C.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:A},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:C.length/3}]),i.fields=i.fields.concat(C)}return i}var Rp={parse:Cp,make:Ap},Jn=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Op=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Mp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Zs=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function yu(t){this.font=t}yu.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function wo(t,e){this.encoding=t,this.charset=e}wo.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function Dp(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var fr={line:Dp};function Fp(t,e){var r=e||new He;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function at(t){this.bindConstructorValues(t)}at.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",Fp(this,t.path))};at.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};at.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};at.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,a;n||(n={});var l=n.xScale,c=n.yScale;if(n.hinting&&o&&o.hinting&&(a=this.path&&o.hinting.exec(this,r)),a)i=o.hinting.getCommands(a),t=Math.round(t),e=Math.round(e),l=c=1;else{i=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=h),c===void 0&&(c=h)}for(var d=new He,g=0;g<i.length;g+=1){var v=i[g];v.type==="M"?d.moveTo(t+v.x*l,e+-v.y*c):v.type==="L"?d.lineTo(t+v.x*l,e+-v.y*c):v.type==="Q"?d.quadraticCurveTo(t+v.x1*l,e+-v.y1*c,t+v.x*l,e+-v.y*c):v.type==="C"?d.curveTo(t+v.x1*l,e+-v.y1*c,t+v.x2*l,e+-v.y2*c,t+v.x*l,e+-v.y*c):v.type==="Z"&&d.closePath()}return d};at.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return J.argument(e.length===0,"There are still points left in the current contour."),t};at.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i};at.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)};at.prototype.drawPoints=function(t,e,r,n){function o(g,v,b,T){t.beginPath();for(var C=0;C<g.length;C+=1)t.moveTo(v+g[C].x*T,b+g[C].y*T),t.arc(v+g[C].x*T,b+g[C].y*T,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,a=[],l=[],c=this.path,h=0;h<c.commands.length;h+=1){var d=c.commands[h];d.x!==void 0&&a.push({x:d.x,y:-d.y}),d.x1!==void 0&&l.push({x:d.x1,y:-d.y1}),d.x2!==void 0&&l.push({x:d.x2,y:-d.y2})}t.fillStyle="blue",o(a,e,r,i),t.fillStyle="red",o(l,e,r,i)};at.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",fr.line(t,e,-1e4,e,1e4),fr.line(t,-1e4,r,1e4,r);var i=this.xMin||0,a=this.yMin||0,l=this.xMax||0,c=this.yMax||0,h=this.advanceWidth||0;t.strokeStyle="blue",fr.line(t,e+i*o,-1e4,e+i*o,1e4),fr.line(t,e+l*o,-1e4,e+l*o,1e4),fr.line(t,-1e4,r+-a*o,1e4,r+-a*o),fr.line(t,-1e4,r+-c*o,1e4,r+-c*o),t.strokeStyle="green",fr.line(t,e+h*o,-1e4,e+h*o,1e4)};function $n(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Ui(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Ui.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};Ui.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function Lp(t,e){return new at({index:e,font:t})}function Bp(t,e,r,n,o,i){return function(){var a=new at({index:e,font:t});return a.path=function(){r(a,n,o);var l=i(t.glyphs,a);return l.unitsPerEm=t.unitsPerEm,l},$n(a,"xMin","_xMin"),$n(a,"xMax","_xMax"),$n(a,"yMin","_yMin"),$n(a,"yMax","_yMax"),a}}function Up(t,e,r,n){return function(){var o=new at({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var Tt={GlyphSet:Ui,glyphLoader:Lp,ttfGlyphLoader:Bp,cffGlyphLoader:Up};function wu(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!wu(t[r],e[r]))return!1;return!0}else return!1}function Si(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Zt(t,e,r){var n=[],o=[],i=te.getCard16(t,e),a,l;if(i!==0){var c=te.getByte(t,e+2);a=e+(i+1)*c+2;for(var h=e+3,d=0;d<i+1;d+=1)n.push(te.getOffset(t,h,c)),h+=c;l=a+n[i]}else l=e+2;for(var g=0;g<n.length-1;g+=1){var v=te.getBytes(t,a+n[g],a+n[g+1]);r&&(v=r(v)),o.push(v)}return{objects:o,startOffset:e,endOffset:l}}function Ip(t,e){var r=[],n=te.getCard16(t,e),o,i;if(n!==0){var a=te.getByte(t,e+2);o=e+(n+1)*a+2;for(var l=e+3,c=0;c<n+1;c+=1)r.push(te.getOffset(t,l,a)),l+=a;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function Gp(t,e,r,n,o){var i=te.getCard16(r,n),a=0;if(i!==0){var l=te.getByte(r,n+2);a=n+(i+1)*l+2}var c=te.getBytes(r,a+e[t],a+e[t+1]);return o&&(c=o(c)),c}function Np(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,a=o&15;if(i===r||(e+=n[i],a===r))break;e+=n[a]}return parseFloat(e)}function Vp(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return Np(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function Hp(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function bu(t,e,r){e=e!==void 0?e:0;var n=new te.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var a=n.parseByte();a<=21?(a===12&&(a=1200+n.parseByte()),o.push([a,i]),i=[]):i.push(Vp(n,a))}return Hp(o)}function en(t,e){return e<=390?e=Jn[e]:e=t[e-391],e}function Su(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var a=e[i];if(Array.isArray(a.type)){var l=[];l.length=a.type.length;for(var c=0;c<a.type.length;c++)o=t[a.op]!==void 0?t[a.op][c]:void 0,o===void 0&&(o=a.value!==void 0&&a.value[c]!==void 0?a.value[c]:null),a.type[c]==="SID"&&(o=en(r,o)),l[c]=o;n[a.name]=l}else o=t[a.op],o===void 0&&(o=a.value!==void 0?a.value:null),a.type==="SID"&&(o=en(r,o)),n[a.name]=o}return n}function zp(t,e){var r={};return r.formatMajor=te.getCard8(t,e),r.formatMinor=te.getCard8(t,e+1),r.size=te.getCard8(t,e+2),r.offsetSize=te.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var _u=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Tu=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Wp(t,e){var r=bu(t,0,t.byteLength);return Su(r,_u,e)}function Eu(t,e,r,n){var o=bu(t,e,r);return Su(o,Tu,n)}function Ks(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var a=new DataView(new Uint8Array(r[i]).buffer),l=Wp(a,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var c=l.private[0],h=l.private[1];if(c!==0&&h!==0){var d=Eu(t,h+e,c,n);if(l._defaultWidthX=d.defaultWidthX,l._nominalWidthX=d.nominalWidthX,d.subrs!==0){var g=h+d.subrs,v=Zt(t,g+e);l._subrs=v.objects,l._subrsBias=Si(l._subrs)}l._privateDict=d}o.push(l)}return o}function $p(t,e,r,n){var o,i,a=new te.Parser(t,e);r-=1;var l=[".notdef"],c=a.parseCard8();if(c===0)for(var h=0;h<r;h+=1)o=a.parseSID(),l.push(en(n,o));else if(c===1)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard8();for(var d=0;d<=i;d+=1)l.push(en(n,o)),o+=1}else if(c===2)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard16();for(var g=0;g<=i;g+=1)l.push(en(n,o)),o+=1}else throw new Error("Unknown charset format "+c);return l}function Yp(t,e,r){var n,o={},i=new te.Parser(t,e),a=i.parseCard8();if(a===0)for(var l=i.parseCard8(),c=0;c<l;c+=1)n=i.parseCard8(),o[n]=c;else if(a===1){var h=i.parseCard8();n=1;for(var d=0;d<h;d+=1)for(var g=i.parseCard8(),v=i.parseCard8(),b=g;b<=g+v;b+=1)o[b]=n,n+=1}else throw new Error("Unknown encoding format "+a);return new wo(o,r)}function Qs(t,e,r){var n,o,i,a,l=new He,c=[],h=0,d=!1,g=!1,v=0,b=0,T,C,x,A;if(t.isCIDFont){var L=t.tables.cff.topDict._fdSelect[e.index],D=t.tables.cff.topDict._fdArray[L];T=D._subrs,C=D._subrsBias,x=D._defaultWidthX,A=D._nominalWidthX}else T=t.tables.cff.topDict._subrs,C=t.tables.cff.topDict._subrsBias,x=t.tables.cff.topDict._defaultWidthX,A=t.tables.cff.topDict._nominalWidthX;var Y=x;function H(K,se){g&&l.closePath(),l.moveTo(K,se),g=!0}function q(){var K;K=c.length%2!==0,K&&!d&&(Y=c.shift()+A),h+=c.length>>1,c.length=0,d=!0}function j(K){for(var se,Se,_e,Te,xe,ne,fe,ye,ue,re,ce,we,he=0;he<K.length;){var Ce=K[he];switch(he+=1,Ce){case 1:q();break;case 3:q();break;case 4:c.length>1&&!d&&(Y=c.shift()+A,d=!0),b+=c.pop(),H(v,b);break;case 5:for(;c.length>0;)v+=c.shift(),b+=c.shift(),l.lineTo(v,b);break;case 6:for(;c.length>0&&(v+=c.shift(),l.lineTo(v,b),c.length!==0);)b+=c.shift(),l.lineTo(v,b);break;case 7:for(;c.length>0&&(b+=c.shift(),l.lineTo(v,b),c.length!==0);)v+=c.shift(),l.lineTo(v,b);break;case 8:for(;c.length>0;)n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+c.shift(),l.curveTo(n,o,i,a,v,b);break;case 10:xe=c.pop()+C,ne=T[xe],ne&&j(ne);break;case 11:return;case 12:switch(Ce=K[he],he+=1,Ce){case 35:n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),fe=i+c.shift(),ye=a+c.shift(),ue=fe+c.shift(),re=ye+c.shift(),ce=ue+c.shift(),we=re+c.shift(),v=ce+c.shift(),b=we+c.shift(),c.shift(),l.curveTo(n,o,i,a,fe,ye),l.curveTo(ue,re,ce,we,v,b);break;case 34:n=v+c.shift(),o=b,i=n+c.shift(),a=o+c.shift(),fe=i+c.shift(),ye=a,ue=fe+c.shift(),re=a,ce=ue+c.shift(),we=b,v=ce+c.shift(),l.curveTo(n,o,i,a,fe,ye),l.curveTo(ue,re,ce,we,v,b);break;case 36:n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),fe=i+c.shift(),ye=a,ue=fe+c.shift(),re=a,ce=ue+c.shift(),we=re+c.shift(),v=ce+c.shift(),l.curveTo(n,o,i,a,fe,ye),l.curveTo(ue,re,ce,we,v,b);break;case 37:n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),fe=i+c.shift(),ye=a+c.shift(),ue=fe+c.shift(),re=ye+c.shift(),ce=ue+c.shift(),we=re+c.shift(),Math.abs(ce-v)>Math.abs(we-b)?v=ce+c.shift():b=we+c.shift(),l.curveTo(n,o,i,a,fe,ye),l.curveTo(ue,re,ce,we,v,b);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+Ce),c.length=0}break;case 14:c.length>0&&!d&&(Y=c.shift()+A,d=!0),g&&(l.closePath(),g=!1);break;case 18:q();break;case 19:case 20:q(),he+=h+7>>3;break;case 21:c.length>2&&!d&&(Y=c.shift()+A,d=!0),b+=c.pop(),v+=c.pop(),H(v,b);break;case 22:c.length>1&&!d&&(Y=c.shift()+A,d=!0),v+=c.pop(),H(v,b);break;case 23:q();break;case 24:for(;c.length>2;)n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+c.shift(),l.curveTo(n,o,i,a,v,b);v+=c.shift(),b+=c.shift(),l.lineTo(v,b);break;case 25:for(;c.length>6;)v+=c.shift(),b+=c.shift(),l.lineTo(v,b);n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+c.shift(),l.curveTo(n,o,i,a,v,b);break;case 26:for(c.length%2&&(v+=c.shift());c.length>0;)n=v,o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i,b=a+c.shift(),l.curveTo(n,o,i,a,v,b);break;case 27:for(c.length%2&&(b+=c.shift());c.length>0;)n=v+c.shift(),o=b,i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a,l.curveTo(n,o,i,a,v,b);break;case 28:se=K[he],Se=K[he+1],c.push((se<<24|Se<<16)>>16),he+=2;break;case 29:xe=c.pop()+t.gsubrsBias,ne=t.gsubrs[xe],ne&&j(ne);break;case 30:for(;c.length>0&&(n=v,o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,b),c.length!==0);)n=v+c.shift(),o=b,i=n+c.shift(),a=o+c.shift(),b=a+c.shift(),v=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,b);break;case 31:for(;c.length>0&&(n=v+c.shift(),o=b,i=n+c.shift(),a=o+c.shift(),b=a+c.shift(),v=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,b),c.length!==0);)n=v,o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,b);break;default:Ce<32?console.log("Glyph "+e.index+": unknown operator "+Ce):Ce<247?c.push(Ce-139):Ce<251?(se=K[he],he+=1,c.push((Ce-247)*256+se+108)):Ce<255?(se=K[he],he+=1,c.push(-(Ce-251)*256-se-108)):(se=K[he],Se=K[he+1],_e=K[he+2],Te=K[he+3],he+=4,c.push((se<<24|Se<<16|_e<<8|Te)/65536))}}}return j(r),e.advanceWidth=Y,l}function Xp(t,e,r,n){var o=[],i,a=new te.Parser(t,e),l=a.parseCard8();if(l===0)for(var c=0;c<r;c++){if(i=a.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(l===3){var h=a.parseCard16(),d=a.parseCard16();if(d!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+d);for(var g,v=0;v<h;v++){if(i=a.parseCard8(),g=a.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(g>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+g);for(;d<g;d++)o.push(i);d=g}if(g!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+g)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return o}function jp(t,e,r,n){r.tables.cff={};var o=zp(t,e),i=Zt(t,o.endOffset,te.bytesToString),a=Zt(t,i.endOffset),l=Zt(t,a.endOffset,te.bytesToString),c=Zt(t,l.endOffset);r.gsubrs=c.objects,r.gsubrsBias=Si(r.gsubrs);var h=Ks(t,e,a.objects,l.objects);if(h.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var d=h[0];if(r.tables.cff.topDict=d,d._privateDict&&(r.defaultWidthX=d._privateDict.defaultWidthX,r.nominalWidthX=d._privateDict.nominalWidthX),d.ros[0]!==void 0&&d.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var g=d.fdArray,v=d.fdSelect;if(g===0||v===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");g+=e;var b=Zt(t,g),T=Ks(t,e,b.objects,l.objects);d._fdArray=T,v+=e,d._fdSelect=Xp(t,v,r.numGlyphs,T.length)}var C=e+d.private[1],x=Eu(t,C,d.private[0],l.objects);if(r.defaultWidthX=x.defaultWidthX,r.nominalWidthX=x.nominalWidthX,x.subrs!==0){var A=C+x.subrs,L=Zt(t,A);r.subrs=L.objects,r.subrsBias=Si(r.subrs)}else r.subrs=[],r.subrsBias=0;var D;n.lowMemory?(D=Ip(t,e+d.charStrings),r.nGlyphs=D.offsets.length):(D=Zt(t,e+d.charStrings),r.nGlyphs=D.objects.length);var Y=$p(t,e+d.charset,r.nGlyphs,l.objects);if(d.encoding===0?r.cffEncoding=new wo(Op,Y):d.encoding===1?r.cffEncoding=new wo(Mp,Y):r.cffEncoding=Yp(t,e+d.encoding,Y),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Tt.GlyphSet(r),n.lowMemory)r._push=function(j){var K=Gp(j,D.offsets,t,e+d.charStrings);r.glyphs.push(j,Tt.cffGlyphLoader(r,j,Qs,K))};else for(var H=0;H<r.nGlyphs;H+=1){var q=D.objects[H];r.glyphs.push(H,Tt.cffGlyphLoader(r,H,Qs,q))}}function xu(t,e){var r,n=Jn.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Jn.length:(r=Jn.length+e.length,e.push(t)),r}function qp(){return new W.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Zp(t){var e=new W.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function Cu(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],a=e[i.name];a!==void 0&&!wu(a,i.value)&&(i.type==="SID"&&(a=xu(a,r)),n[i.op]={name:i.name,type:i.type,value:a})}return n}function Js(t,e){var r=new W.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Cu(_u,t,e),r}function ea(t){var e=new W.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function Kp(t){var e=new W.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function Qp(){return new W.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Jp(t,e){for(var r=new W.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=xu(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function ed(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var a=void 0,l=void 0,c=r.commands[i];if(c.type==="Q"){var h=.3333333333333333,d=2/3;c={type:"C",x:c.x,y:c.y,x1:Math.round(h*n+d*c.x1),y1:Math.round(h*o+d*c.y1),x2:Math.round(h*c.x+d*c.x1),y2:Math.round(h*c.y+d*c.y1)}}if(c.type==="M")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="L")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="C"){var g=Math.round(c.x1-n),v=Math.round(c.y1-o),b=Math.round(c.x2-c.x1),T=Math.round(c.y2-c.y1);a=Math.round(c.x-c.x2),l=Math.round(c.y-c.y2),e.push({name:"dx1",type:"NUMBER",value:g}),e.push({name:"dy1",type:"NUMBER",value:v}),e.push({name:"dx2",type:"NUMBER",value:b}),e.push({name:"dy2",type:"NUMBER",value:T}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),o=Math.round(c.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function td(t){for(var e=new W.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=ed(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function rd(t,e){var r=new W.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Cu(Tu,t,e),r}function nd(t,e){for(var r=new W.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},a=[],l,c=1;c<t.length;c+=1)l=t.get(c),a.push(l.name);var h=[];r.header=qp(),r.nameIndex=Zp([e.postScriptName]);var d=Js(o,h);r.topDictIndex=ea(d),r.globalSubrIndex=Qp(),r.charsets=Jp(a,h),r.charStringsIndex=td(t),r.privateDict=rd(i,h),r.stringIndex=Kp(h);var g=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=g,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),d=Js(o,h),r.topDictIndex=ea(d),r}var od={parse:jp,make:nd};function id(t,e){var r={},n=new te.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),J.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function sd(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new W.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var ad={parse:id,make:sd};function ud(t,e){var r={},n=new te.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function ld(t){return new W.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var cd={parse:ud,make:ld};function fd(t,e,r,n,o){for(var i,a,l=new te.Parser(t,e),c=0;c<n;c+=1){c<r&&(i=l.parseUShort(),a=l.parseShort());var h=o.get(c);h.advanceWidth=i,h.leftSideBearing=a}}function hd(t,e,r,n,o){t._hmtxTableData={};for(var i,a,l=new te.Parser(e,r),c=0;c<o;c+=1)c<n&&(i=l.parseUShort(),a=l.parseShort()),t._hmtxTableData[c]={advanceWidth:i,leftSideBearing:a}}function pd(t,e,r,n,o,i,a){a.lowMemory?hd(t,e,r,n,o):fd(e,r,n,o,i)}function dd(t){for(var e=new W.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var vd={parse:pd,make:dd};function gd(t){for(var e=new W.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function md(t,e){var r=new te.Parser(t,e),n=r.parseULong();J.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],a=0;a<o;a++){for(var l="",c=e+r.parseUShort(),h=r.parseUShort(),d=c;d<c+h;++d)l+=String.fromCharCode(t.getInt8(d));i.push(l)}return i}var yd={make:gd,parse:md};function wd(t,e){var r={},n=new te.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function bd(t){return new W.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Sd={parse:wd,make:bd},ku=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Pu={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},_d={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Au={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Td(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return Pu[e];case 3:return Au[e]}}var _i="utf-16",Ed={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},xd={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Ru(t,e,r){switch(t){case 0:return _i;case 1:return xd[r]||Ed[e];case 3:if(e===1||e===10)return _i;break}}function Cd(t,e,r){for(var n={},o=new te.Parser(t,e),i=o.parseUShort(),a=o.parseUShort(),l=o.offset+o.parseUShort(),c=0;c<a;c++){var h=o.parseUShort(),d=o.parseUShort(),g=o.parseUShort(),v=o.parseUShort(),b=ku[v]||v,T=o.parseUShort(),C=o.parseUShort(),x=Td(h,g,r),A=Ru(h,d,g);if(A!==void 0&&x!==void 0){var L=void 0;if(A===_i?L=Lr.UTF16(t,l+C,T):L=Lr.MACSTRING(t,l+C,T,A),L){var D=n[b];D===void 0&&(D=n[b]={}),D[x]=L}}}return i===1&&o.parseUShort(),n}function ei(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function ta(t,e,r,n,o,i){return new W.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function kd(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function ra(t,e){var r=kd(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function Pd(t,e){var r,n=[],o={},i=ei(ku);for(var a in t){var l=i[a];if(l===void 0&&(l=a),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');o[r]=t[a],n.push(r)}for(var c=ei(Pu),h=ei(Au),d=[],g=[],v=0;v<n.length;v++){r=n[v];var b=o[r];for(var T in b){var C=b[T],x=1,A=c[T],L=_d[A],D=Ru(x,L,A),Y=V.MACSTRING(C,D);Y===void 0&&(x=0,A=e.indexOf(T),A<0&&(A=e.length,e.push(T)),L=4,Y=V.UTF16(C));var H=ra(Y,g);d.push(ta(x,L,A,r,Y.length,H));var q=h[T];if(q!==void 0){var j=V.UTF16(C),K=ra(j,g);d.push(ta(3,1,q,r,j.length,K))}}}d.sort(function(_e,Te){return _e.platformID-Te.platformID||_e.encodingID-Te.encodingID||_e.languageID-Te.languageID||_e.nameID-Te.nameID});for(var se=new W.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:d.length},{name:"stringOffset",type:"USHORT",value:6+d.length*12}]),Se=0;Se<d.length;Se++)se.fields.push({name:"record_"+Se,type:"RECORD",value:d[Se]});return se.fields.push({name:"strings",type:"LITERAL",value:g}),se}var Ad={parse:Cd,make:Pd},Ti=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Rd(t){for(var e=0;e<Ti.length;e+=1){var r=Ti[e];if(t>=r.begin&&t<r.end)return e}return-1}function Od(t,e){var r={},n=new te.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Md(t){return new W.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var na={parse:Od,make:Md,unicodeRanges:Ti,getUnicodeRange:Rd};function Dd(t,e){var r={},n=new te.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Zs.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=Zs.length){var a=n.parseChar();r.names.push(n.parseString(a))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function Fd(){return new W.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Ld={parse:Dd,make:Fd},dt=new Array(9);dt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(k.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(k.coverage),substitute:this.parseOffset16List()};J.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};dt[2]=function(){var e=this.parseUShort();return J.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),sequences:this.parseListOfLists()}};dt[3]=function(){var e=this.parseUShort();return J.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),alternateSets:this.parseListOfLists()}};dt[4]=function(){var e=this.parseUShort();return J.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Rr={sequenceIndex:k.uShort,lookupListIndex:k.uShort};dt[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(k.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Rr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(k.coverage),classDef:this.parsePointer(k.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Rr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,k.pointer(k.coverage)),lookupRecords:this.parseRecordList(o,Rr)}}J.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};dt[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(k.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Rr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(k.coverage),backtrackClassDef:this.parsePointer(k.classDef),inputClassDef:this.parsePointer(k.classDef),lookaheadClassDef:this.parsePointer(k.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Rr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(k.pointer(k.coverage)),inputCoverage:this.parseList(k.pointer(k.coverage)),lookaheadCoverage:this.parseList(k.pointer(k.coverage)),lookupRecords:this.parseRecordList(Rr)};J.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};dt[7]=function(){var e=this.parseUShort();J.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new k(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:dt[r].call(n)}};dt[8]=function(){var e=this.parseUShort();return J.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),backtrackCoverage:this.parseList(k.pointer(k.coverage)),lookaheadCoverage:this.parseList(k.pointer(k.coverage)),substitutes:this.parseUShortList()}};function Bd(t,e){e=e||0;var r=new k(t,e),n=r.parseVersion(1);return J.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(dt)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(dt),variations:r.parseFeatureVariationsList()}}var Ur=new Array(9);Ur[1]=function(e){return e.substFormat===1?new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.ushortList("substitute",e.substitute)))};Ur[2]=function(e){return J.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.tableList("seqSet",e.sequences,function(r){return new W.Table("sequenceSetTable",W.ushortList("sequence",r))})))};Ur[3]=function(e){return J.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.tableList("altSet",e.alternateSets,function(r){return new W.Table("alternateSetTable",W.ushortList("alternate",r))})))};Ur[4]=function(e){return J.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.tableList("ligSet",e.ligatureSets,function(r){return new W.Table("ligatureSetTable",W.tableList("ligature",r,function(n){return new W.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(W.ushortList("component",n.components,n.components.length+1)))}))})))};Ur[6]=function(e){if(e.substFormat===1){var r=new W.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.tableList("chainRuleSet",e.chainRuleSets,function(i){return new W.Table("chainRuleSetTable",W.tableList("chainRule",i,function(a){var l=W.ushortList("backtrackGlyph",a.backtrack,a.backtrack.length).concat(W.ushortList("inputGlyph",a.input,a.input.length+1)).concat(W.ushortList("lookaheadGlyph",a.lookahead,a.lookahead.length)).concat(W.ushortList("substitution",[],a.lookupRecords.length));return a.lookupRecords.forEach(function(c,h){l=l.concat({name:"sequenceIndex"+h,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+h,type:"USHORT",value:c.lookupListIndex})}),new W.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)J.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,a){n.push({name:"backtrackCoverage"+a,type:"TABLE",value:new W.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,a){n.push({name:"inputCoverage"+a,type:"TABLE",value:new W.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,a){n.push({name:"lookaheadCoverage"+a,type:"TABLE",value:new W.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,a){n=n.concat({name:"sequenceIndex"+a,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+a,type:"USHORT",value:i.lookupListIndex})});var o=new W.Table("chainContextTable",n);return o}J.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Ud(t){return new W.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new W.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new W.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new W.LookupList(t.lookups,Ur)}])}var Id={parse:Bd,make:Ud};function Gd(t,e){var r=new te.Parser(t,e),n=r.parseULong();J.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},a=0;a<o;a++){var l=r.parseTag(),c=r.parseULong(),h=r.parseULong(),d=Lr.UTF8(t,e+c,h);i[l]=d}return i}function Nd(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new W.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var a=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+a}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var Vd={parse:Gd,make:Nd};function oa(t){return Math.log(t)/Math.log(2)|0}function Ii(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function ia(t,e,r,n){return new W.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function Ou(t){var e=new W.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,oa(e.numTables));e.searchRange=16*r,e.entrySelector=oa(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+ia().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<t.length;a+=1){var l=t[a];J.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var c=l.sizeOf(),h=ia(l.tableName,Ii(l.encode()),i,c);for(n.push({name:h.tag+" Table Record",type:"RECORD",value:h}),o.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=c,J.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(d,g){return d.value.tag>g.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function sa(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function Hd(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function zd(t){for(var e=[],r=[],n=[],o=[],i=[],a=[],l=[],c,h=0,d=0,g=0,v=0,b=0,T=0;T<t.glyphs.length;T+=1){var C=t.glyphs.get(T),x=C.unicode|0;if(isNaN(C.advanceWidth))throw new Error("Glyph "+C.name+" ("+T+"): advanceWidth is not a number.");(c>x||c===void 0)&&x>0&&(c=x),h<x&&(h=x);var A=na.getUnicodeRange(x);if(A<32)d|=1<<A;else if(A<64)g|=1<<A-32;else if(A<96)v|=1<<A-64;else if(A<123)b|=1<<A-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(C.name!==".notdef"){var L=C.getMetrics();e.push(L.xMin),r.push(L.yMin),n.push(L.xMax),o.push(L.yMax),a.push(L.leftSideBearing),l.push(L.rightSideBearing),i.push(C.advanceWidth)}}var D={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:Hd(i),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,l)};D.ascender=t.ascender,D.descender=t.descender;var Y=ad.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:D.xMin,yMin:D.yMin,xMax:D.xMax,yMax:D.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),H=cd.make({ascender:D.ascender,descender:D.descender,advanceWidthMax:D.advanceWidthMax,minLeftSideBearing:D.minLeftSideBearing,minRightSideBearing:D.minRightSideBearing,xMaxExtent:D.maxLeftSideBearing+(D.xMax-D.xMin),numberOfHMetrics:t.glyphs.length}),q=Sd.make(t.glyphs.length),j=na.make(Object.assign({xAvgCharWidth:Math.round(D.advanceWidthAvg),usFirstCharIndex:c,usLastCharIndex:h,ulUnicodeRange1:d,ulUnicodeRange2:g,ulUnicodeRange3:v,ulUnicodeRange4:b,sTypoAscender:D.ascender,sTypoDescender:D.descender,sTypoLineGap:0,usWinAscent:D.yMax,usWinDescent:Math.abs(D.yMin),ulCodePageRange1:1,sxHeight:sa(t,"xyvw",{yMax:Math.round(D.ascender/2)}).yMax,sCapHeight:sa(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",D).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),K=vd.make(t.glyphs),se=Rp.make(t.glyphs),Se=t.getEnglishName("fontFamily"),_e=t.getEnglishName("fontSubfamily"),Te=Se+" "+_e,xe=t.getEnglishName("postScriptName");xe||(xe=Se.replace(/\s/g,"")+"-"+_e);var ne={};for(var fe in t.names)ne[fe]=t.names[fe];ne.uniqueID||(ne.uniqueID={en:t.getEnglishName("manufacturer")+":"+Te}),ne.postScriptName||(ne.postScriptName={en:xe}),ne.preferredFamily||(ne.preferredFamily=t.names.fontFamily),ne.preferredSubfamily||(ne.preferredSubfamily=t.names.fontSubfamily);var ye=[],ue=Ad.make(ne,ye),re=ye.length>0?yd.make(ye):void 0,ce=Ld.make(),we=od.make(t.glyphs,{version:t.getEnglishName("version"),fullName:Te,familyName:Se,weightName:_e,postScriptName:xe,unitsPerEm:t.unitsPerEm,fontBBox:[0,D.yMin,D.ascender,D.advanceWidthMax]}),he=t.metas&&Object.keys(t.metas).length>0?Vd.make(t.metas):void 0,Ce=[Y,H,q,j,ue,se,ce,we,K];re&&Ce.push(re),t.tables.gsub&&Ce.push(Id.make(t.tables.gsub)),he&&Ce.push(he);for(var yt=Ou(Ce),Ct=yt.encode(),wt=Ii(Ct),zt=yt.fields,Sr=!1,ut=0;ut<zt.length;ut+=1)if(zt[ut].name==="head table"){zt[ut].value.checkSumAdjustment=2981146554-wt,Sr=!0;break}if(!Sr)throw new Error("Could not find head table with checkSum to adjust.");return yt}var Wd={make:Ou,fontToTable:zd,computeCheckSum:Ii};function ti(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function aa(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function ua(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var a=r.start;if(a===e)return r;a<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function mn(t,e){this.font=t,this.tableName=e}mn.prototype={searchTag:ti,binSearch:aa,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=ti(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=ti(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,a=o.featureIndexes,l=this.font.tables[this.tableName].features,c=0;c<a.length;c++)if(i=l[a[c]],i.tag===r)return i.feature;if(n){var h=l.length;return J.assert(h===0||r>=l[h-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(i),a.push(h),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),a=[];if(i){for(var l,c=i.lookupListIndexes,h=this.font.tables[this.tableName].lookups,d=0;d<c.length;d++)l=h[c[d]],l.lookupType===n&&a.push(l);if(a.length===0&&o){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var g=h.length;return h.push(l),c.push(g),[l]}}return a},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=ua(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=aa(t.glyphs,e);return r>=0?r:-1;case 2:var n=ua(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,a=o.end,l=i;l<=a;l++)e.push(l);return e}};function yn(t){mn.call(this,t,"gpos")}yn.prototype=mn.prototype;yn.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};yn.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var a=o[i],l=this.getCoverageIndex(a.coverage,e);if(!(l<0))switch(a.posFormat){case 1:for(var c=a.pairSets[l],h=0;h<c.length;h++){var d=c[h];if(d.secondGlyph===r)return d.value1&&d.value1.xAdvance||0}break;case 2:var g=this.getGlyphClass(a.classDef1,e),v=this.getGlyphClass(a.classDef2,r),b=a.classRecords[g][v];return b.value1&&b.value1.xAdvance||0}}return 0};yn.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function rt(t){mn.call(this,t,"gsub")}function $d(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Gi(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}rt.prototype=mn.prototype;rt.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};rt.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),d=void 0;if(c.substFormat===1){var g=c.deltaGlyphId;for(d=0;d<h.length;d++){var v=h[d];n.push({sub:v,by:v+g})}}else{var b=c.substitute;for(d=0;d<h.length;d++)n.push({sub:h[d],by:b[d]})}}return n};rt.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),d=void 0;for(d=0;d<h.length;d++){var g=h[d],v=c.sequences[d];n.push({sub:g,by:v})}}return n};rt.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),d=c.alternateSets,g=0;g<h.length;g++)n.push({sub:h[g],by:d[g]});return n};rt.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),d=c.ligatureSets,g=0;g<h.length;g++)for(var v=h[g],b=d[g],T=0;T<b.length;T++){var C=b[T];n.push({sub:[v].concat(C.components),by:C.ligGlyph})}return n};rt.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=Gi(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});J.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.substitute.splice(l,0,0)),i.substitute[l]=e.by};rt.prototype.addMultiple=function(t,e,r,n){J.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=Gi(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});J.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.sequences.splice(l,0,0)),i.sequences[l]=e.by};rt.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=Gi(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});J.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by};rt.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),J.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var a=e.sub[0],l=e.sub.slice(1),c={ligGlyph:e.by,components:l},h=this.binSearch(i.coverage.glyphs,a);if(h>=0){for(var d=i.ligatureSets[h],g=0;g<d.length;g++)if($d(d[g].components,l))return;d.push(c)}else h=-1-h,i.coverage.glyphs.splice(h,0,a),i.ligatureSets.splice(h,0,[c])};rt.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};rt.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function Yd(){return typeof window<"u"}function Xd(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Yr(t,e){if(!t)throw e}function la(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),e&o||(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function Mu(t,e,r){var n=new te.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var a=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)a.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var c=0;c<t.instructionLength;c+=1)t.instructions.push(n.parseByte());var h=a[a.length-1]+1;o=[];for(var d=0;d<h;d+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var g=n.parseByte(),v=0;v<g;v+=1)o.push(i),d+=1;if(J.argument(o.length===h,"Bad flags."),a.length>0){var b=[],T;if(h>0){for(var C=0;C<h;C+=1)i=o[C],T={},T.onCurve=!!(i&1),T.lastPointOfContour=a.indexOf(C)>=0,b.push(T);for(var x=0,A=0;A<h;A+=1)i=o[A],T=b[A],T.x=la(n,i,x,2,16),x=T.x;for(var L=0,D=0;D<h;D+=1)i=o[D],T=b[D],T.y=la(n,i,L,4,32),L=T.y}t.points=b}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var Y=!0;Y;){o=n.parseUShort();var H={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(H.dx=n.parseShort(),H.dy=n.parseShort()):H.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(H.dx=n.parseChar(),H.dy=n.parseChar()):H.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?H.xScale=H.yScale=n.parseF2Dot14():(o&64)>0?(H.xScale=n.parseF2Dot14(),H.yScale=n.parseF2Dot14()):(o&128)>0&&(H.xScale=n.parseF2Dot14(),H.scale01=n.parseF2Dot14(),H.scale10=n.parseF2Dot14(),H.yScale=n.parseF2Dot14()),t.components.push(H),Y=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var q=0;q<t.instructionLength;q+=1)t.instructions.push(n.parseByte())}}}function ri(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function jd(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return J.argument(r.length===0,"There are still points left in the current contour."),e}function Du(t){var e=new He;if(!t)return e;for(var r=jd(t),n=0;n<r.length;++n){var o=r[n],i=null,a=o[o.length-1],l=o[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var c={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5};e.moveTo(c.x,c.y)}for(var h=0;h<o.length;++h)if(i=a,a=l,l=o[(h+1)%o.length],a.onCurve)e.lineTo(a.x,a.y);else{var d=l;i.onCurve||((a.x+i.x)*.5,(a.y+i.y)*.5),l.onCurve||(d={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5}),e.quadraticCurveTo(a.x,a.y,d.x,d.y)}e.closePath()}return e}function Fu(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=ri(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[n.matchedPoints[0]],l=o.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=ri([l],c)[0],c.dx=a.x-l.x,c.dy=a.y-l.y,i=ri(o.points,c)}e.points=e.points.concat(i)}}return Du(e.points)}function qd(t,e,r,n){for(var o=new Tt.GlyphSet(n),i=0;i<r.length-1;i+=1){var a=r[i],l=r[i+1];a!==l?o.push(i,Tt.ttfGlyphLoader(n,i,Mu,t,e+a,Fu)):o.push(i,Tt.glyphLoader(n,i))}return o}function Zd(t,e,r,n){var o=new Tt.GlyphSet(n);return n._push=function(i){var a=r[i],l=r[i+1];a!==l?o.push(i,Tt.ttfGlyphLoader(n,i,Mu,t,e+a,Fu)):o.push(i,Tt.glyphLoader(n,i))},o}function Kd(t,e,r,n,o){return o.lowMemory?Zd(t,e,r,n):qd(t,e,r,n)}var Qd={getPath:Du,parse:Kd},Lu,wr,Bu,Ei;function Uu(t){this.font=t,this.getCommands=function(e){return Qd.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Jd(t){return t}function Iu(t){return Math.sign(t)*Math.round(Math.abs(t))}function ev(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function tv(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function rv(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function nv(t){return Math.sign(t)*Math.floor(Math.abs(t))}var Gu=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},_t={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,d;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,c=e.x-e.xo,h=r.x-r.xo,a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){t.x=t.xo+(c+h)/2;return}t.x=t.xo+(c*l+h*a)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){_t.setRelative(t,t,(c+h)/2,n,!0);return}_t.setRelative(t,t,(c*l+h*a)/d,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.x=l+(t.y-c)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},It={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,d;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,c=e.y-e.yo,h=r.y-r.yo,a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){t.y=t.yo+(c+h)/2;return}t.y=t.yo+(c*l+h*a)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){It.setRelative(t,t,(c+h)/2,n,!0);return}It.setRelative(t,t,(c*l+h*a)/d,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.y=c+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(_t);Object.freeze(It);function wn(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}wn.prototype.distance=function(t,e,r,n){return this.x*_t.distance(t,e,r,n)+this.y*It.distance(t,e,r,n)};wn.prototype.interpolate=function(t,e,r,n){var o,i,a,l,c,h,d;if(a=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),c=Math.abs(a),h=Math.abs(l),d=c+h,d===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*h+i*c)/d,n,!0)};wn.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y,h=n.normalSlope,d=this.slope,g=t.x,v=t.y;t.x=(d*g-h*l+c-v)/(d-h),t.y=d*(t.x-g)+v};wn.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function bn(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?_t:t===0&&e===1?It:new wn(t,e)}function Nt(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Nt.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};Nt.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var ln=Object.freeze(new Nt(0,0)),ov={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Jt(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=_t,this.round=Iu}}Uu.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){Jt.prototype=ov,o=this._fpgmState=new Jt("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,R.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{wr(o)}catch(h){console.log("Hinting error in FPGM:"+h),this._errorState=3;return}}Jt.prototype=o,n=this._prepState=new Jt("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var a=n.cvt=new Array(i.length),l=e/r.unitsPerEm,c=0;c<i.length;c++)a[c]=i[c]*l;else n.cvt=[];R.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{wr(n)}catch(h){this._errorState<2&&console.log("Hinting error in PREP:"+h),this._errorState=2}}if(!(this._errorState>1))try{return Bu(t,n)}catch(h){this._errorState<1&&(console.log("Hinting error:"+h),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};Bu=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,a,l;if(Jt.prototype=e,!o)l=new Jt("glyf",t.instructions),R.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),Ei(t,l,r,n),a=l.gZone;else{var c=e.font;a=[],i=[];for(var h=0;h<o.length;h++){var d=o[h],g=c.glyphs.get(d.glyphIndex);l=new Jt("glyf",g.instructions),R.DEBUG&&(console.log("---EXEC COMP "+h+"---"),l.step=-1),Ei(g,l,r,n);for(var v=Math.round(d.dx*r),b=Math.round(d.dy*n),T=l.gZone,C=l.contours,x=0;x<T.length;x++){var A=T[x];A.xTouched=A.yTouched=!1,A.xo=A.x=A.x+v,A.yo=A.y=A.y+b}var L=a.length;a.push.apply(a,T);for(var D=0;D<C.length;D++)i.push(C[D]+L)}t.instructions&&!l.inhibitGridFit&&(l=new Jt("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=a,l.contours=i,a.push(new Nt(0,0),new Nt(Math.round(t.advanceWidth*r),0)),R.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),wr(l),a.length-=2)}return a};Ei=function(t,e,r,n){for(var o=t.points||[],i=o.length,a=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],c,h=0;h<i;h++)c=o[h],a[h]=new Nt(c.x*r,c.y*n,c.lastPointOfContour,c.onCurve);for(var d,g,v=0;v<i;v++)c=a[v],d||(d=c,l.push(v)),c.lastPointOfContour?(c.nextPointOnContour=d,d.prevPointOnContour=c,d=void 0):(g=a[v+1],c.nextPointOnContour=g,g.prevPointOnContour=c);if(!e.inhibitGridFit){if(R.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var b=0;b<i;b++)console.log(b,a[b].x,a[b].y)}if(a.push(new Nt(0,0),new Nt(Math.round(t.advanceWidth*r),0)),wr(e),a.length-=2,R.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var T=0;T<i;T++)console.log(T,a[T].x,a[T].y)}}};wr=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(R.DEBUG&&t.step++,n=Lu[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function ko(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new Nt(0,0)}function Nu(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function ca(t,e){R.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function fa(t,e){R.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function ha(t,e){R.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function pa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log("SPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.pv=e.dpv=bn(l,c)}function da(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log("SFVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.fv=bn(l,c)}function iv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=bn(n,r)}function sv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=bn(n,r)}function av(t){var e=t.stack,r=t.pv;R.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function uv(t){var e=t.stack,r=t.fv;R.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function lv(t){t.fv=t.pv,R.DEBUG&&console.log(t.step,"SFVTPV[]")}function cv(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),a=e.pop(),l=t.z0,c=t.z1,h=l[r],d=l[n],g=c[o],v=c[i],b=t.z2[a];R.DEBUG&&console.log("ISECT[], ",r,n,o,i,a);var T=h.x,C=h.y,x=d.x,A=d.y,L=g.x,D=g.y,Y=v.x,H=v.y,q=(T-x)*(D-H)-(C-A)*(L-Y),j=T*A-C*x,K=L*H-D*Y;b.x=(j*(L-Y)-K*(T-x))/q,b.y=(j*(D-H)-K*(C-A))/q}function fv(t){t.rp0=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function hv(t){t.rp1=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function pv(t){t.rp2=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function dv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||ko(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function vv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||ko(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function gv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||ko(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function mv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||ko(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function yv(t){t.loop=t.stack.pop(),R.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function wv(t){R.DEBUG&&console.log(t.step,"RTG[]"),t.round=Iu}function bv(t){R.DEBUG&&console.log(t.step,"RTHG[]"),t.round=tv}function Sv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function _v(t){R.DEBUG&&console.log(t.step,"ELSE[]"),Nu(t,!1)}function Tv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Ev(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function xv(t){var e=t.stack;R.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function ni(t){R.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function Cv(t){R.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function kv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function Pv(t){var e=t.stack;R.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function Av(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var a=0;a<n;a++)wr(t),R.DEBUG&&console.log(++t.step,a+1<n?"next loopcall":"done loopcall",a);t.ip=o,t.prog=i}function Rv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],wr(t),t.ip=r,t.prog=n,R.DEBUG&&console.log(++t.step,"returning from",e)}function Ov(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function Mv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function Dv(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(R.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function va(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;R.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var a=i.distance(n,ln);t&&(a=e.round(a)),o.setRelative(n,ln,a,i),o.touch(n),e.rp0=e.rp1=r}function ga(t,e){var r=e.z2,n=r.length-2,o,i,a;R.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)o=r[l],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(a=o.nextTouched(t),i===a&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,a,t)))}function ma(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=e.loop,c=e.z2;l--;){var h=r.pop(),d=c[h],g=a.distance(o,o,!1,!0);i.setRelative(d,d,g,a),i.touch(d),R.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",h)}e.loop=1}function ya(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop(),c=e.z2[e.contours[l]],h=c;R.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var d=a.distance(o,o,!1,!0);do h!==o&&i.setRelative(h,h,d,a),h=h.nextPointOnContour;while(h!==c)}function wa(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop();R.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var c;switch(l){case 0:c=e.tZone;break;case 1:c=e.gZone;break;default:throw new Error("Invalid zone")}for(var h,d=a.distance(o,o,!1,!0),g=c.length-2,v=0;v<g;v++)h=c[v],i.setRelative(h,h,d,a)}function Fv(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var a=e.pop(),l=i[a];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",a,o),n.setRelative(l,l,o),n.touch(l)}t.loop=1}function Lv(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],a=t.z1[n],l=t.fv,c=t.dpv,h=t.z2;o--;){var d=e.pop(),g=h[d];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",d,r,"<->",n),l.interpolate(g,i,a,c),l.touch(g)}t.loop=1}function ba(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],a=e.z0[e.rp0],l=e.fv,c=e.pv;l.setRelative(i,a,n,c),l.touch(i),R.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function Bv(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,a=t.pv,l=t.z1;o--;){var c=e.pop(),h=l[c];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",c),i.setRelative(h,n,0,a),i.touch(h)}t.loop=1}function Uv(t){R.DEBUG&&console.log(t.step,"RTDG[]"),t.round=ev}function Sa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],a=e.fv,l=e.pv,c=e.cvt[n];R.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",c,")",o);var h=l.distance(i,ln);t&&(Math.abs(h-c)<e.cvCutIn&&(h=c),h=e.round(h)),a.setRelative(i,ln,h,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),a.touch(i),e.rp0=e.rp1=o}function Iv(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];R.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function Gv(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];R.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var a=r[++e]<<8|r[++e];a&32768&&(a=-((a^65535)+1)),n.push(a)}t.ip=e}function Nv(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();R.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function Vv(t){var e=t.stack,r=t.store,n=e.pop();R.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function Hv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function zv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function _a(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];R.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,ln,t,!1)*64)}function Ta(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],a=e.z0[o],l=e.dpv.distance(a,i,t,t);R.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",l),e.stack.push(Math.round(l*64))}function Wv(t){R.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function $v(t){R.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function Yv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function Xv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function jv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function qv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function Zv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function Kv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function Qv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function Jv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function eg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"IF[]",e),e||(Nu(t,!0),R.DEBUG&&console.log(t.step,"EIF[]"))}function tg(t){R.DEBUG&&console.log(t.step,"EIF[]")}function rg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function ng(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function og(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function oi(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,a=e.ppem,l=e.deltaBase+(t-1)*16,c=e.deltaShift,h=e.z0;R.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var d=0;d<n;d++){var g=r.pop(),v=r.pop(),b=l+((v&240)>>4);if(b===a){var T=(v&15)-8;T>=0&&T++,R.DEBUG&&console.log(e.step,"DELTAPFIX",g,"by",T*c);var C=h[g];o.setRelative(C,C,T*c,i)}}}function ig(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function sg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function ag(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function ug(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function lg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function cg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function fg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function hg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function pg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function dg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Yn(t,e){var r=e.stack,n=r.pop();R.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function vg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function ii(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,a=e.deltaShift;R.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var c=r.pop(),h=r.pop(),d=i+((h&240)>>4);if(d===o){var g=(h&15)-8;g>=0&&g++;var v=g*a;R.DEBUG&&console.log(e.step,"DELTACFIX",c,"by",v),e.cvt[c]+=v}}}function gg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=Gu;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function mg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=Gu;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function yg(t){R.DEBUG&&console.log(t.step,"ROFF[]"),t.round=Jd}function wg(t){R.DEBUG&&console.log(t.step,"RUTG[]"),t.round=rv}function bg(t){R.DEBUG&&console.log(t.step,"RDTG[]"),t.round=nv}function Sg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function Ea(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.dpv=bn(l,c)}function _g(t){var e=t.stack,r=e.pop(),n=0;R.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Tg(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();R.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function Eg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function xg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function Cg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function kg(t){var e=t.stack.pop(),r=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function jt(t,e){var r=e.stack,n=e.prog,o=e.ip;R.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function qt(t,e){var r=e.ip,n=e.prog,o=e.stack;R.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var a=n[++r]<<8|n[++r];a&32768&&(a=-((a^65535)+1)),o.push(a)}e.ip=r}function z(t,e,r,n,o,i){var a=i.stack,l=t&&a.pop(),c=a.pop(),h=i.rp0,d=i.z0[h],g=i.z1[c],v=i.minDis,b=i.fv,T=i.dpv,C,x,A,L;x=C=T.distance(g,d,!0,!0),A=x>=0?1:-1,x=Math.abs(x),t&&(L=i.cvt[l],n&&Math.abs(x-L)<i.cvCutIn&&(x=L)),r&&x<v&&(x=v),n&&(x=i.round(x)),b.setRelative(g,d,A*x,T),b.touch(g),R.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?l+"("+i.cvt[l]+","+L+")":"",c,"(d =",C,"->",A*x,")"),i.rp1=i.rp0,i.rp2=c,e&&(i.rp0=c)}Lu=[ca.bind(void 0,It),ca.bind(void 0,_t),fa.bind(void 0,It),fa.bind(void 0,_t),ha.bind(void 0,It),ha.bind(void 0,_t),pa.bind(void 0,0),pa.bind(void 0,1),da.bind(void 0,0),da.bind(void 0,1),iv,sv,av,uv,lv,cv,fv,hv,pv,dv,vv,gv,mv,yv,wv,bv,Sv,_v,Tv,Ev,void 0,void 0,xv,ni,Cv,kv,Pv,Ov,Mv,void 0,void 0,void 0,Av,Rv,Dv,void 0,va.bind(void 0,0),va.bind(void 0,1),ga.bind(void 0,It),ga.bind(void 0,_t),ma.bind(void 0,0),ma.bind(void 0,1),ya.bind(void 0,0),ya.bind(void 0,1),wa.bind(void 0,0),wa.bind(void 0,1),Fv,Lv,ba.bind(void 0,0),ba.bind(void 0,1),Bv,Uv,Sa.bind(void 0,0),Sa.bind(void 0,1),Iv,Gv,Nv,Vv,Hv,zv,_a.bind(void 0,0),_a.bind(void 0,1),void 0,Ta.bind(void 0,0),Ta.bind(void 0,1),Wv,void 0,$v,void 0,void 0,Yv,Xv,jv,qv,Zv,Kv,Qv,Jv,eg,tg,rg,ng,og,oi.bind(void 0,1),ig,sg,ag,ug,lg,cg,fg,hg,pg,dg,Yn.bind(void 0,0),Yn.bind(void 0,1),Yn.bind(void 0,2),Yn.bind(void 0,3),void 0,void 0,void 0,void 0,vg,oi.bind(void 0,2),oi.bind(void 0,3),ii.bind(void 0,1),ii.bind(void 0,2),ii.bind(void 0,3),gg,mg,void 0,void 0,yg,void 0,wg,bg,ni,ni,void 0,void 0,void 0,void 0,void 0,Sg,Ea.bind(void 0,0),Ea.bind(void 0,1),_g,void 0,Tg,Eg,xg,Cg,kg,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,jt.bind(void 0,1),jt.bind(void 0,2),jt.bind(void 0,3),jt.bind(void 0,4),jt.bind(void 0,5),jt.bind(void 0,6),jt.bind(void 0,7),jt.bind(void 0,8),qt.bind(void 0,1),qt.bind(void 0,2),qt.bind(void 0,3),qt.bind(void 0,4),qt.bind(void 0,5),qt.bind(void 0,6),qt.bind(void 0,7),qt.bind(void 0,8),z.bind(void 0,0,0,0,0,0),z.bind(void 0,0,0,0,0,1),z.bind(void 0,0,0,0,0,2),z.bind(void 0,0,0,0,0,3),z.bind(void 0,0,0,0,1,0),z.bind(void 0,0,0,0,1,1),z.bind(void 0,0,0,0,1,2),z.bind(void 0,0,0,0,1,3),z.bind(void 0,0,0,1,0,0),z.bind(void 0,0,0,1,0,1),z.bind(void 0,0,0,1,0,2),z.bind(void 0,0,0,1,0,3),z.bind(void 0,0,0,1,1,0),z.bind(void 0,0,0,1,1,1),z.bind(void 0,0,0,1,1,2),z.bind(void 0,0,0,1,1,3),z.bind(void 0,0,1,0,0,0),z.bind(void 0,0,1,0,0,1),z.bind(void 0,0,1,0,0,2),z.bind(void 0,0,1,0,0,3),z.bind(void 0,0,1,0,1,0),z.bind(void 0,0,1,0,1,1),z.bind(void 0,0,1,0,1,2),z.bind(void 0,0,1,0,1,3),z.bind(void 0,0,1,1,0,0),z.bind(void 0,0,1,1,0,1),z.bind(void 0,0,1,1,0,2),z.bind(void 0,0,1,1,0,3),z.bind(void 0,0,1,1,1,0),z.bind(void 0,0,1,1,1,1),z.bind(void 0,0,1,1,1,2),z.bind(void 0,0,1,1,1,3),z.bind(void 0,1,0,0,0,0),z.bind(void 0,1,0,0,0,1),z.bind(void 0,1,0,0,0,2),z.bind(void 0,1,0,0,0,3),z.bind(void 0,1,0,0,1,0),z.bind(void 0,1,0,0,1,1),z.bind(void 0,1,0,0,1,2),z.bind(void 0,1,0,0,1,3),z.bind(void 0,1,0,1,0,0),z.bind(void 0,1,0,1,0,1),z.bind(void 0,1,0,1,0,2),z.bind(void 0,1,0,1,0,3),z.bind(void 0,1,0,1,1,0),z.bind(void 0,1,0,1,1,1),z.bind(void 0,1,0,1,1,2),z.bind(void 0,1,0,1,1,3),z.bind(void 0,1,1,0,0,0),z.bind(void 0,1,1,0,0,1),z.bind(void 0,1,1,0,0,2),z.bind(void 0,1,1,0,0,3),z.bind(void 0,1,1,0,1,0),z.bind(void 0,1,1,0,1,1),z.bind(void 0,1,1,0,1,2),z.bind(void 0,1,1,0,1,3),z.bind(void 0,1,1,1,0,0),z.bind(void 0,1,1,1,0,1),z.bind(void 0,1,1,1,0,2),z.bind(void 0,1,1,1,0,3),z.bind(void 0,1,1,1,1,0),z.bind(void 0,1,1,1,1,1),z.bind(void 0,1,1,1,1,2),z.bind(void 0,1,1,1,1,3)];function Ir(t){this.char=t,this.state={},this.activeState=null}function Ni(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function Pg(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function vt(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Po(t){this.eventId=t,this.subscribers=[]}function Ag(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Po(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Ie(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Ag.call(this,t)}Ir.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};Ir.prototype.getState=function(t){return this.state[t]||null};Ie.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};Ie.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])};Ie.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(a){return a instanceof Ir});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Ie.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Ir){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};Ie.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};Ie.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};Ie.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof Ir});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};Ie.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],a=e===null||e.apply(this,i)===!0,l=[n,o];if(a){var c=r.apply(this,l);n.setState(t,c)}}),this.registeredModifiers.push(t)};Po.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Po.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};vt.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};vt.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};Ie.prototype.rangeToText=function(t){if(t instanceof Ni)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};Ie.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};Ie.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};Ie.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};Ie.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Po&&n.subscribers.forEach(function(o){o.apply(r,e||[])})};Ie.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new Pg(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};Ie.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};Ie.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};Ie.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};Ie.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new vt(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Ie.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new Ni(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n};Ie.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new Ni(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),i&&n.checkEnd(t)){var a=r-i.startIndex+1,l=e.setEndOffset(a,o);e.dispatch("contextEnd",[o,l])}})};Ie.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new vt(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new Ir(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function tr(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Vu(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function nr(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function eo(t){return/[A-z]/.test(t)}function Rg(t){return/\s/.test(t)}function nt(t){this.font=t,this.features={}}function pr(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function Sn(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function Og(t,e){var r=Sn(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function Mg(t,e){var r=Sn(t,e.coverage);return r===-1?null:e.substitute[r]}function si(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var a=Sn(i,o);a!==-1&&r.push(a)}return r.length!==t.length?-1:r}function Dg(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=si(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&nr(i[0].char);)i.shift();var a=new vt(i,0),l=si(e.lookaheadCoverage,a),c=[].concat(t.backtrack);for(c.reverse();c.length&&nr(c[0].char);)c.shift();if(c.length<e.backtrackCoverage.length)return[];var h=new vt(c,0),d=si(e.backtrackCoverage,h),g=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&d.length===e.backtrackCoverage.length,v=[];if(g)for(var b=0;b<e.lookupRecords.length;b++)for(var T=e.lookupRecords[b],C=T.lookupListIndex,x=this.getLookupByIndex(C),A=0;A<x.subtables.length;A++){var L=x.subtables[A],D=this.getLookupMethod(x,L),Y=this.getSubstitutionType(x,L);if(Y==="12")for(var H=0;H<n.length;H++){var q=t.get(H),j=D(q);j&&v.push(j)}}return v}function Fg(t,e){var r=t.current,n=Sn(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],a=0;a<i.length;a++){o=i[a];for(var l=0;l<o.components.length;l++){var c=t.lookahead[l],h=o.components[l];if(c!==h)break;if(l===o.components.length-1)return o}}return null}function Lg(t,e){var r=Sn(t,e.coverage);return r===-1?null:e.sequences[r]}nt.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};nt.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var a=0;a<i.length;a++){var l=i[a];if(l.tag===t){var c=l.langSys;return c.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};nt.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r};nt.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};nt.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};nt.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return Og.apply(r,[o,e])};case"12":return function(o){return Mg.apply(r,[o,e])};case"63":return function(o){return Dg.apply(r,[o,e])};case"41":return function(o){return Fg.apply(r,[o,e])};case"21":return function(o){return Lg.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};nt.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),a=0;a<o.length;a++)for(var l=o[a],c=this.getLookupSubtables(l),h=0;h<c.length;h++){var d=c[h],g=this.getSubstitutionType(l,d),v=this.getLookupMethod(l,d),b=void 0;switch(g){case"11":b=v(e.current),b&&i.splice(r,1,new pr({id:11,tag:t.tag,substitution:b}));break;case"12":b=v(e.current),b&&i.splice(r,1,new pr({id:12,tag:t.tag,substitution:b}));break;case"63":b=v(e),Array.isArray(b)&&b.length&&i.splice(r,1,new pr({id:63,tag:t.tag,substitution:b}));break;case"41":b=v(e),b&&i.splice(r,1,new pr({id:41,tag:t.tag,substitution:b}));break;case"21":b=v(e.current),b&&i.splice(r,1,new pr({id:21,tag:t.tag,substitution:b}));break}e=new vt(i,r),!(Array.isArray(b)&&!b.length)&&(b=null)}return i.length?i:null};nt.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};nt.prototype.getLookupSubtables=function(t){return t.subtables||null};nt.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};nt.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};nt.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function Bg(t){var e=t.current,r=t.get(-1);return r===null&&tr(e)||!tr(r)&&tr(e)}function Ug(t){var e=t.get(1);return e===null||!tr(e)}var Ig={startCheck:Bg,endCheck:Ug};function Gg(t){var e=t.current,r=t.get(-1);return(tr(e)||nr(e))&&!tr(r)}function Ng(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!tr(e)&&!nr(e)):var r=Rg(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return tr(o)||nr(o)}),!n)return!0}break;default:return!1}}var Vg={startCheck:Gg,endCheck:Ng};function Hg(t,e,r){e[r].setState(t.tag,t.substitution)}function zg(t,e,r){e[r].setState(t.tag,t.substitution)}function Wg(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function $g(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var xa={11:Hg,12:zg,63:Wg,41:$g};function Vi(t,e,r){t instanceof pr&&xa[t.id]&&xa[t.id](t,e,r)}function Yg(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=Vu(n),i=nr(n);if(!o&&!i)return!0;if(o)return!1}return!1}function Xg(t){if(Vu(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=nr(r);if(!n)return!0}return!1}function jg(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new vt(o.map(function(l){return l.getState("glyphIndex")}),0),a=new vt(o.map(function(l){return l.char}),0);o.forEach(function(l,c){if(!nr(l.char)){i.setCurrentIndex(c),a.setCurrentIndex(c);var h=0;Yg(a)&&(h|=1),Xg(a)&&(h|=2);var d;switch(h){case 1:d="fina";break;case 2:d="init";break;case 3:d="medi";break}if(n.indexOf(d)!==-1){var g=e.query.lookupFeature({tag:d,script:r,contextParams:i});if(g instanceof Error)return console.info(g.message);g.forEach(function(v,b){v instanceof pr&&(Vi(v,o,b),i.context[b]=v.substitution)})}}})}}function Ca(t,e){var r=t.map(function(n){return n.activeState.value});return new vt(r,e||0)}function qg(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=Ca(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});l.length&&(l.forEach(function(c){return Vi(c,n,a)}),o=Ca(n))})}function Zg(t){var e=t.current,r=t.get(-1);return r===null&&eo(e)||!eo(r)&&eo(e)}function Kg(t){var e=t.get(1);return e===null||!eo(e)}var Qg={startCheck:Zg,endCheck:Kg};function ka(t,e){var r=t.map(function(n){return n.activeState.value});return new vt(r,e||0)}function Jg(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=ka(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});l.length&&(l.forEach(function(c){return Vi(c,n,a)}),o=ka(n))})}function mt(t){this.baseDir=t||"ltr",this.tokenizer=new Ie,this.featuresTags={}}mt.prototype.setText=function(t){this.text=t};mt.prototype.contextChecks={latinWordCheck:Qg,arabicWordCheck:Ig,arabicSentenceCheck:Vg};function ai(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function em(){return ai.call(this,"latinWord"),ai.call(this,"arabicWord"),ai.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function tm(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}mt.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};mt.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new nt(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};mt.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function Hi(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function rm(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Hi.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){jg.call(t,n)})}}function nm(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){Hi.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){qg.call(t,o)})}}}function om(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){Hi.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){Jg.call(t,o)})}}}mt.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};mt.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(rm.call(this),nm.call(this)),this.checkContextReady("latinWord")&&om.call(this),this.checkContextReady("arabicSentence")&&tm.call(this)};mt.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),em.call(this),this.applyFeaturesToContexts())};mt.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};mt.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function Pe(t){t=t||{},t.tables=t.tables||{},t.empty||(Yr(t.familyName,"When creating a new Font object, familyName is required."),Yr(t.styleName,"When creating a new Font object, styleName is required."),Yr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Yr(t.ascender,"When creating a new Font object, ascender is required."),Yr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Tt.GlyphSet(this,t.glyphs||[]),this.encoding=new yu(this),this.position=new yn(this),this.substitution=new rt(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Uu(this)}})}Pe.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Pe.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Pe.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Pe.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};Pe.prototype.stringToGlyphs=function(t,e){var r=this,n=new mt,o=function(g){return r.charToGlyphIndex(g.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var a=n.getTextGlyphs(t),l=a.length,c=new Array(l),h=this.glyphs.get(0),d=0;d<l;d+=1)c[d]=this.glyphs.get(a[d])||h;return c};Pe.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Pe.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Pe.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Pe.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};Pe.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Pe.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var a=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,o),c;if(o.kerning){var h=o.script||this.position.getDefaultScriptName();c=this.position.getKerningTables(h,o.language)}for(var d=0;d<l.length;d+=1){var g=l[d];if(i.call(this,g,e,r,n,o),g.advanceWidth&&(e+=g.advanceWidth*a),o.kerning&&d<l.length-1){var v=c?this.position.getKerningValue(c,g.index,l[d+1].index):this.getKerningValue(g,l[d+1]);e+=v*a}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e};Pe.prototype.getPath=function(t,e,r,n,o){var i=new He;return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var d=a.getPath(l,c,h,o,this);i.extend(d)}),i};Pe.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var d=a.getPath(l,c,h,o,this);i.push(d)}),i};Pe.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};Pe.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)};Pe.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawPoints(t,l,c,h)})};Pe.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawMetrics(t,l,c,h)})};Pe.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Pe.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Pe.prototype.toTables=function(){return Wd.fontToTable(this)};Pe.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Pe.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r};Pe.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(Yd())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i),a.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),a.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),h=Xd(n);c.writeFileSync(t,h)}};Pe.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Pe.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Pe.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Ht=new Array(10);Ht[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(k.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(k.coverage),values:this.parseValueRecordList()};J.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Ht[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();J.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(k.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(k.pointer(k.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var a=this.parsePointer(k.classDef),l=this.parsePointer(k.classDef),c=this.parseUShort(),h=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:a,classDef2:l,class1Count:c,class2Count:h,classRecords:this.parseList(c,k.list(h,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}};Ht[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Ht[4]=function(){return{error:"GPOS Lookup 4 not supported"}};Ht[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Ht[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Ht[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Ht[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Ht[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const im={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function sm(t){const{dir:e,xAxis:r}=im[t];return new Hu([0,0,0],e,r)}function Pa(t){const e=new O(t);let r=new O([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new O([0,1,0]),n=r.cross(e)),n.normalize()}class Hu extends tt{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new O(n):Pa(r),i=cn(e,r,o);super(i)}get position(){return new O(this.wrapped.Location())}get direction(){return new O(this.wrapped.Direction())}get xAxis(){return new O(this.wrapped.XDirection())}get yAxis(){return new O(this.wrapped.YDirection())}autoAxes(){const e=Pa(this.direction);this.wrapped.SetXDirection(Gt(e))}setPosition(e){return this.wrapped.SetLocation(et(e)),this}setXAxis(e){return this.wrapped.SetYDirection(Gt(e)),this}setYAxis(e){return this.wrapped.SetYDirection(Gt(e)),this}lookAt(e){const r=new O("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const xr=t=>t.IsNull()?[]:Re(t).edges;function am(t,e,r=!0){const n=G(),o=ke(),i=o(new n.HLRBRep_Algo_1);i.Add_2(t.wrapped,0);const a=o(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(a),i.Update(),i.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),c=[...xr(l.VCompound_1()),...xr(l.Rg1LineVCompound_1()),...xr(l.OutLineVCompound_1())];c.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped));const h=r?[...xr(l.HCompound_1()),...xr(l.Rg1LineHCompound_1()),...xr(l.OutLineHCompound_1())]:[];return h.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped)),{visible:c,hidden:h}}const gr=1e-8,Pr=(t,e)=>je(t,e,gr*10);function um(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(h=>({offset:pi(h,r),original:h})),o=[];let i=null,a=n.at(-1);if(!a)return[];if(o.length===1)return o;const l=h=>{i?h.offset instanceof Le?o.push(h.offset):Pr(h.offset.firstPoint,h.offset.lastPoint)||o.push(dn(h.offset.firstPoint,h.offset.lastPoint)):i=h},c=function*(){for(const h of n.slice(0,-1))yield h;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const h of c()){const d=a.offset.lastPoint,g=h.offset.firstPoint;if(Pr(d,g)){l(a),a=h;continue}let v=[];if(a.offset instanceof Le&&h.offset instanceof Le){const{intersections:T,commonSegmentsPoints:C}=pn(a.offset,h.offset,gr/100);v=[...T,...C]}if(v.length>0){let T=v[0];if(v.length>1){const A=a==null?void 0:a.original.lastPoint,L=v.map(D=>ih(D,A));T=v[L.indexOf(Math.min(...L))]}const C=a.offset.splitAt([T],gr)[0],x=h.offset.splitAt([T],gr).at(-1);if(!x)throw new Error("Bug in the splitting algo in offset");l({offset:C,original:a.original}),a={offset:x,original:h.original};continue}const b=Wa(d,g,a.original.lastPoint);l(a),o.push(b),a=h}return l(a),o}function lm(t,e){const r=um(t,e);if(r.length<2)return null;const n=new Map,o=(h,d)=>{const g=n.get(h)||[];n.set(h,[...g,...d])};if(r.forEach((h,d)=>{r.slice(d+1).forEach((g,v)=>{const{intersections:b,commonSegmentsPoints:T}=pn(h,g,gr),C=[...b,...T].filter(x=>{const A=Pr(x,h.firstPoint)||Pr(x,h.lastPoint),L=Pr(x,g.firstPoint)||Pr(x,g.lastPoint);return!(A&&L)});C.length&&(o(d,C),o(v+d+1,C))})}),!n.size){const h=new ie(r);return t.intersects(h)?null:h}const a=r.flatMap((h,d)=>{if(!n.has(d))return h;const g=n.get(d)||[];return h.splitAt(g,gr*100)}).filter(h=>!t.curves.find(g=>g.distanceFrom(h)<Math.abs(e)-gr));if(!a.length)return null;const c=Ya(a).filter(h=>h.length>1).map(h=>new ie(h)).filter(h=>h.isClosed());return c.length?c.length===1?c[0]:new Q(c):null}const Aa=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=Ut(e,t[r]);return e};function to(t,e){if(t instanceof ie)return lm(t,e);if(t instanceof Q)return Aa(t.blueprints.map(r=>to(r,e)));if(t instanceof be){const r=Aa(t.blueprints.slice(1).map(n=>to(n,e)));return Qt(to(t.blueprints[0],e),r)}return null}function Ra(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],a=(c,h)=>{o({firstCurve:c,secondCurve:h,point:c.lastPoint})?i.push(...t(c,h,r)):i.push(c,h)};e.curves.slice(1).forEach(c=>{const h=i.pop();if(!h)throw new Error("Bug in the blueprint filletting algo");a(h,c)});const l=i.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(je(i[0].firstPoint,l.lastPoint)&&i.length>1){const c=i.pop(),h=i.shift();if(!c||!h)throw new Error("Bug in the blueprint filletting algo");a(c,h)}return new ie(i)}function zi(t,e,r,n){if(e instanceof ie)return Ra(t,e,r,n);if(e instanceof be)return new be(e.blueprints.map(o=>Ra(t,o,r,n)));if(e instanceof Q){const o=e.blueprints.map(i=>zi(t,i,r,n)).filter(i=>i!==null);return new Q(o)}return null}function cm(t,e,r){return zi(di,t,e,r)}function fm(t,e,r){return zi(vi,t,e,r)}function xi(t,e){return t instanceof ie?new ie(io(t.curves,e)):t instanceof be?new be(t.blueprints.map(r=>xi(r,e))):t instanceof Q?new Q(t.blueprints.map(r=>xi(r,e))):t}class Fe{constructor(e=null){this.innerShape=e}clone(){var e;return new Fe(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new hn}stretch(e,r,n){return this.innerShape?new Fe(this.innerShape.stretch(e,r,n)):new Fe}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Fe(this.innerShape.rotate(e,r)):new Fe}translate(e,r=0){return this.innerShape?new Fe(this.innerShape.translate(e,r)):new Fe}scale(e,r){return this.innerShape?new Fe(this.innerShape.scale(e,r)):new Fe}mirror(e,r,n){return this.innerShape?new Fe(this.innerShape.mirror(e,r,n)):new Fe}cut(e){return new Fe(Qt(this.innerShape,e.innerShape))}fuse(e){return new Fe(Ut(this.innerShape,e.innerShape))}intersect(e){return new Fe(Zr(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new uo);return new Fe(cm(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new uo);return new Fe(fm(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Fe(to(this.innerShape,e))}approximate(e,r={}){if(e!=="svg")throw new Error("Only 'svg' is supported for now");return new Fe(xi(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof ie)){if(this.innerShape instanceof Q&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof ie)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}function hm(t,e,r=0){return new Fe(tp(t,e,r))}const pm=hm,Oa=t=>{const e=pm(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>Xh(o,e)),n=Ya(r).map(o=>new ie(o));return n.length===0?new Fe:n.length===1?new Fe(n[0]):new Fe(new Q(n))};function ot(t,e="front"){let r;e instanceof Hu?r=e:r=sm(e);const{visible:n,hidden:o}=am(t,r);return{visible:Oa(n),hidden:Oa(o)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const zu=Symbol("Comlink.proxy"),dm=Symbol("Comlink.endpoint"),vm=Symbol("Comlink.releaseProxy"),ui=Symbol("Comlink.finalizer"),ro=Symbol("Comlink.thrown"),Wu=t=>typeof t=="object"&&t!==null||typeof t=="function",gm={canHandle:t=>Wu(t)&&t[zu],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Wi(t,e),[r,[r]]},deserialize(t){return t.start(),bm(t)}},mm={canHandle:t=>Wu(t)&&ro in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},$u=new Map([["proxy",gm],["throw",mm]]);function ym(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Wi(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!ym(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:a,path:l}=Object.assign({path:[]},o.data),c=(o.data.argumentList||[]).map(dr);let h;try{const d=l.slice(0,-1).reduce((v,b)=>v[b],t),g=l.reduce((v,b)=>v[b],t);switch(a){case"GET":h=g;break;case"SET":d[l.slice(-1)[0]]=dr(o.data.value),h=!0;break;case"APPLY":h=g.apply(d,c);break;case"CONSTRUCT":{const v=new g(...c);h=xm(v)}break;case"ENDPOINT":{const{port1:v,port2:b}=new MessageChannel;Wi(t,b),h=Em(v,[v])}break;case"RELEASE":h=void 0;break;default:return}}catch(d){h={value:d,[ro]:0}}Promise.resolve(h).catch(d=>({value:d,[ro]:0})).then(d=>{const[g,v]=_o(d);e.postMessage(Object.assign(Object.assign({},g),{id:i}),v),a==="RELEASE"&&(e.removeEventListener("message",n),Yu(e),ui in t&&typeof t[ui]=="function"&&t[ui]())}).catch(d=>{const[g,v]=_o({value:new TypeError("Unserializable return value"),[ro]:0});e.postMessage(Object.assign(Object.assign({},g),{id:i}),v)})}),e.start&&e.start()}function wm(t){return t.constructor.name==="MessagePort"}function Yu(t){wm(t)&&t.close()}function bm(t,e){const r=new Map;return t.addEventListener("message",function(o){const{data:i}=o;if(!i||!i.id)return;const a=r.get(i.id);if(a)try{a(i)}finally{r.delete(i.id)}}),Ci(t,r,[],e)}function Xn(t){if(t)throw new Error("Proxy has been released and is not useable")}function Xu(t){return Cr(t,new Map,{type:"RELEASE"}).then(()=>{Yu(t)})}const bo=new WeakMap,So="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(bo.get(t)||0)-1;bo.set(t,e),e===0&&Xu(t)});function Sm(t,e){const r=(bo.get(e)||0)+1;bo.set(e,r),So&&So.register(t,e,t)}function _m(t){So&&So.unregister(t)}function Ci(t,e,r=[],n=function(){}){let o=!1;const i=new Proxy(n,{get(a,l){if(Xn(o),l===vm)return()=>{_m(i),Xu(t),e.clear(),o=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const c=Cr(t,e,{type:"GET",path:r.map(h=>h.toString())}).then(dr);return c.then.bind(c)}return Ci(t,e,[...r,l])},set(a,l,c){Xn(o);const[h,d]=_o(c);return Cr(t,e,{type:"SET",path:[...r,l].map(g=>g.toString()),value:h},d).then(dr)},apply(a,l,c){Xn(o);const h=r[r.length-1];if(h===dm)return Cr(t,e,{type:"ENDPOINT"}).then(dr);if(h==="bind")return Ci(t,e,r.slice(0,-1));const[d,g]=Ma(c);return Cr(t,e,{type:"APPLY",path:r.map(v=>v.toString()),argumentList:d},g).then(dr)},construct(a,l){Xn(o);const[c,h]=Ma(l);return Cr(t,e,{type:"CONSTRUCT",path:r.map(d=>d.toString()),argumentList:c},h).then(dr)}});return Sm(i,t),i}function Tm(t){return Array.prototype.concat.apply([],t)}function Ma(t){const e=t.map(_o);return[e.map(r=>r[0]),Tm(e.map(r=>r[1]))]}const ju=new WeakMap;function Em(t,e){return ju.set(t,e),t}function xm(t){return Object.assign(t,{[zu]:!0})}function _o(t){for(const[e,r]of $u)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},ju.get(t)||[]]}function dr(t){switch(t.type){case"HANDLER":return $u.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Cr(t,e,r,n){return new Promise(o=>{const i=Cm();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function Cm(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function qu(t,e){return typeof t!="number"||isNaN(t)?{valid:!1,message:`Parameter '${e}' must be a number`}:{valid:!0}}function km(t,e){return t<=0?{valid:!1,message:`Parameter '${e}' must be positive`}:{valid:!0}}function Pm(t,e,r){return t>=e?{valid:!1,message:`${r} (${t}) must be less than ${e}`}:{valid:!0}}function Et(t,e){const r=qu(t,e);return r.valid?km(t,e):r}function Am(t,e,r){const n=qu(t,r);return n.valid?Pm(t,e,r):n}function xt(t,e){return r=>{const n=[];for(const o of e){const i=t(r[o],o);i.valid||n.push(i.message)}return{valid:n.length===0,errors:n}}}function Da(t,e){return r=>{const n=r[t],o=r[e],i=Am(n,o,t);return i.valid?{valid:!0,errors:[]}:{valid:!1,errors:[i.message]}}}function Rm(t,e){let r=!0;const n=[];if(e.params)for(const o of e.params){const{name:i,validators:a}=o;if(!a)continue;const l=t[i];for(const c of a){const h=c(l,i);if(!h.valid){r=!1,n.push(h.message);break}}}if(e.validators)for(const o of e.validators){const i=o(t);i.valid||(r=!1,n.push(...i.errors))}return{valid:r,errors:n}}function Or({width:t=100,depth:e=100,height:r=100}){if(t===0&&e===0&&r===0)return nn([0,0,0],[1e-7,1e-7,1e-7]);const n=t/2,o=e/2;return nn([-n,-o,0],[n,o,r])}const Om={name:"Cuboid",create:Or,params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],validators:[xt(Et,["width","depth","height"])],hasExplosion:!1};function Mm({radius:t=50}){return Rh(t)}const Dm={name:"Sphere",create:Mm,params:[{name:"radius",defaultValue:50}],validators:[xt(Et,["radius"])],hasExplosion:!1};function Zu({radius:t=50,height:e=100}){return ru(t,e,[0,0,0],[0,0,-1])}const Fm={name:"Cylinder",create:Zu,params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],validators:[xt(Et,["radius","height"])],hasExplosion:!1};function Lm({aLength:t=80,bLength:e=50,cLength:r=30}){return Dh(t,e,r)}const Bm={name:"Ellipsoid",create:Lm,params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],validators:[xt(Et,["aLength","bLength","cLength"])],hasExplosion:!1},Ku=t=>t.boundingBox.center;function Qu(t,e,r){return r.map(({position:n,direction:o,orientation:i})=>{const a=t(),l=e(a);let c=a.translate([n[0]-l[0],n[1]-l[1],n[2]-l[2]]);const h=[0,0,1],d=new O(i||o);if(d.Length>0){const g=new O(h).cross(d);if(g.Length>1e-10){const v=new O(h).getAngle(d);c=c.rotate(v,n,g)}else d.dot(new O(h))<0&&(c=c.rotate(180,n,[1,0,0]))}return c})}function Ju(t,e,r,n,o,i=0,a=0,l=1){const c=new O([i,a,l]).normalized();return Array.from({length:e*r},(h,d)=>{const g=Math.floor(d/r),b=d%r*n,T=g*o,x=new Ze(new O(t.origin),new O(t.xDirection).normalized(),new O(t.normal).normalized()).toWorldCoords([b,T,0]);return{position:[x.x,x.y,x.z],direction:[t.normal[0],t.normal[1],t.normal[2]],orientation:[c.x,c.y,c.z]}})}function Um(t,e,r,n=0,o=0,i=1){return Ju({origin:t,xDirection:e,normal:(()=>{const a=new O(e),l=new O([0,0,1]),c=Math.abs(a.normalized().dot(l))>.99?new O([1,0,0]):a.cross(l).normalized();return[c.x,c.y,c.z]})()},1,r,r>1?new O(e).Length/(r-1):0,0,n,o,i)}function Im({count:t=5,vectorX:e=0,vectorY:r=50,vectorZ:n=50,originX:o=0,originY:i=0,originZ:a=0,boxWidth:l=10,boxDepth:c=10,boxHeight:h=10,orientationX:d=0,orientationY:g=0,orientationZ:v=1}){return Lt(Qu(()=>Or({width:l,depth:c,height:h}),Ku,Um([o,i,a],[e,r,n],t,d,g,v)))}const Gm={name:"DiagonalCuboidPattern",create:Im,params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[xt(Et,["count","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function Nm({originX:t=0,originY:e=0,originZ:r=0,directionX:n=1,directionY:o=0,directionZ:i=0,normalX:a=0,normalY:l=0,normalZ:c=1,rowCount:h=3,colCount:d=3,xSpacing:g=30,ySpacing:v=30,boxWidth:b=10,boxDepth:T=10,boxHeight:C=10,orientationX:x=0,orientationY:A=0,orientationZ:L=1}){return Lt(Qu(()=>Or({width:b,depth:T,height:C}),Ku,Ju({origin:[t,e,r],xDirection:[n,o,i],normal:[a,l,c]},h,d,g,v,x,A,L)))}const Vm={name:"RectangularCuboidGrid",create:Nm,params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[xt(Et,["rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function el({depth:t=100,flangeXLenght:e=50,flangeYLenght:r=50,thickness:n=5}){const o=nn([0,-t/2,0],[e,t/2,n]),i=nn([0,-t/2,0],[n,t/2,r]);return o.fuse(i)}const Hm={name:"LProfile",create:el,params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],validators:[xt(Et,["depth","flangeXLenght","flangeYLenght","thickness"]),Da("thickness","flangeXLenght"),Da("thickness","flangeYLenght")],hasExplosion:!1};function tl({bottomRadius:t=50,topRadius:e=25,height:r=100}){return Ws(t,{plane:"XY",origin:[0,0,0]}).loftWith(Ws(e,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}const zm={name:"Frustum",create:tl,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],validators:[xt(Et,["bottomRadius","topRadius","height"])],hasExplosion:!1};function rl({bottomRadius:t=50,topRadius:e=25,frustumHeight:r=80,cylinderHeight:n=40}){return tl({bottomRadius:t,topRadius:e,height:r}).fuse(ru(e,n,[0,0,-r],[0,0,-1]))}const Wm={name:"Drill",create:rl,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],validators:[xt(Et,["bottomRadius","topRadius","frustumHeight","cylinderHeight"])],hasExplosion:!1};function $m(t,e){return{main:t,helperSpaces:e}}function li(t){return t.main||t}const oe={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},ae={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function jn(t){let e;switch(t){case oe.FRONT:e=new O([0,-1,0]);break;case oe.BACK:e=new O([0,1,0]);break;case oe.LEFT:e=new O([-1,0,0]);break;case oe.RIGHT:e=new O([1,0,0]);break;case oe.TOP:e=new O([0,0,1]);break;case oe.BOTTOM:e=new O([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return e}function nl(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case ae.FRONT_TOP:c=new O([r,n,l]);break;case ae.FRONT_BOTTOM:c=new O([r,n,o]);break;case ae.BACK_TOP:c=new O([r,a,l]);break;case ae.BACK_BOTTOM:c=new O([r,a,o]);break;case ae.LEFT_TOP:c=new O([r,n,l]);break;case ae.LEFT_BOTTOM:c=new O([r,n,o]);break;case ae.RIGHT_TOP:c=new O([i,n,l]);break;case ae.RIGHT_BOTTOM:c=new O([i,n,o]);break;case ae.FRONT_LEFT:c=new O([r,n,o]);break;case ae.FRONT_RIGHT:c=new O([i,n,o]);break;case ae.BACK_LEFT:c=new O([r,a,o]);break;case ae.BACK_RIGHT:c=new O([i,a,o]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function ol(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case ae.FRONT_TOP:c=new O([i,n,l]);break;case ae.FRONT_BOTTOM:c=new O([i,n,o]);break;case ae.BACK_TOP:c=new O([i,a,l]);break;case ae.BACK_BOTTOM:c=new O([i,a,o]);break;case ae.LEFT_TOP:c=new O([r,a,l]);break;case ae.LEFT_BOTTOM:c=new O([r,a,o]);break;case ae.RIGHT_TOP:c=new O([i,a,l]);break;case ae.RIGHT_BOTTOM:c=new O([i,a,o]);break;case ae.FRONT_LEFT:c=new O([r,n,l]);break;case ae.FRONT_RIGHT:c=new O([i,n,l]);break;case ae.BACK_LEFT:c=new O([r,a,l]);break;case ae.BACK_RIGHT:c=new O([i,a,l]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function Ym(t){switch(t){case ae.FRONT_LEFT:return[oe.FRONT,oe.LEFT];case ae.FRONT_RIGHT:return[oe.FRONT,oe.RIGHT];case ae.FRONT_TOP:return[oe.FRONT,oe.TOP];case ae.FRONT_BOTTOM:return[oe.FRONT,oe.BOTTOM];case ae.BACK_LEFT:return[oe.BACK,oe.LEFT];case ae.BACK_RIGHT:return[oe.BACK,oe.RIGHT];case ae.BACK_TOP:return[oe.BACK,oe.TOP];case ae.BACK_BOTTOM:return[oe.BACK,oe.BOTTOM];case ae.LEFT_TOP:return[oe.LEFT,oe.TOP];case ae.LEFT_BOTTOM:return[oe.LEFT,oe.BOTTOM];case ae.RIGHT_TOP:return[oe.RIGHT,oe.TOP];case ae.RIGHT_BOTTOM:return[oe.RIGHT,oe.BOTTOM];default:throw new Error(`Unknown edge identifier: ${t}`)}}function Xm(t,e,r=.5,n=.5){const[[o,i,a],[l,c,h]]=t.bounds,d=Math.max(0,Math.min(1,r)),g=Math.max(0,Math.min(1,n));let v;switch(e){case oe.FRONT:v=new O([o+(l-o)*d,i,a+(h-a)*g]);break;case oe.BACK:v=new O([o+(l-o)*d,c,a+(h-a)*g]);break;case oe.LEFT:v=new O([o,i+(c-i)*d,a+(h-a)*g]);break;case oe.RIGHT:v=new O([l,i+(c-i)*d,a+(h-a)*g]);break;case oe.TOP:v=new O([o+(l-o)*d,i+(c-i)*g,h]);break;case oe.BOTTOM:v=new O([o+(l-o)*d,i+(c-i)*g,a]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return v}function jm(t,e,r=.5){const n=Math.max(0,Math.min(1,r)),o=nl(t,e),i=ol(t,e);return new O([o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n,o.z+(i.z-o.z)*n])}function qm(t,e){const{type:r,element:n,params:o={}}=e;switch(r){case"face":return Xm(t,n,o.u,o.v);case"edge":return jm(t,n,o.t);case"corner":if(n.includes("START")){const i=n.replace("_START","");return nl(t,i)}else if(n.includes("END")){const i=n.replace("_END","");return ol(t,i)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new O(t.center);default:throw new Error(`Unknown position type: ${r}`)}}function Zm(t){const e=t.normalized(),r=Math.abs(e.x),n=Math.abs(e.y),o=Math.abs(e.z);let i;return r<=n&&r<=o?i=new O([0,e.z,-e.y]):n<=r&&n<=o?i=new O([e.z,0,-e.x]):i=new O([e.y,-e.x,0]),i.normalized()}function qn(t,e,r,n={}){const o=qm(t.boundingBox,e);let i;n.normal?i=new O(n.normal):i=Km(t,e,n);let a;n.xDir?a=new O(n.xDir):a=Zm(i);const l=new mr;l.coordSystemChange({origin:o.toTuple(),zDir:i.toTuple(),xDir:a.toTuple()},"reference");const c=Re(l.transform(r.wrapped));return l.delete(),i.delete(),a.delete(),o.delete(),c}function Km(t,e,r={}){const{type:n,element:o}=e;switch(n){case"face":return jn(o);case"edge":if(r.faceForEdge)return jn(r.faceForEdge);{const i=Ym(o);return jn(i[0])}case"corner":return r.faceForCorner?jn(r.faceForCorner):new O([0,0,1]);case"center":default:return new O([0,0,1])}}function hr(t,e,r,n=!1){return n?Re(t.wrapped).mirror(e,r):t.mirror(e,r)}function Qm({width:t=50,depth:e=100,height:r=200,showHelper:n=!0,explosionFactor:o=0}){const i=Or({width:t,depth:e,height:r}),a=Math.round(r/17.5)-1;if(a<=0)return $m(Lt([]),n?[i]:[]);const l=r/(a+1),c=a>1?(e-28)/(a-1):0,h=Or({width:t-1,depth:20,height:.5}),d=h.boundingBox.center,g=qn(h,{type:"face",element:oe.TOP,params:{u:1.5/(t-1),v:2.25/20}},rl({bottomRadius:1.2,topRadius:.8,frustumHeight:.5*.8,cylinderHeight:.5*.2})),v=h.cut(g).cut(hr(g,"XZ",d,!0)).cut(hr(g,"YZ",d,!0)).cut(hr(hr(g,"XZ",d,!0),"YZ",d,!0)),b=v.clone(),T=el({depth:20,flangeXLenght:4.5,flangeYLenght:4.5,thickness:.5}),C=T.boundingBox.center,x=qn(T,{type:"face",element:oe.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},Zu({radius:.800001,height:.5})),A=T.cut(x).cut(hr(x,"XZ",C,!0)),L=A.clone(),D=qn(v,{type:"edge",element:ae.LEFT_BOTTOM,params:{t:.5}},A,{normal:[0,0,-1],xDir:[1,0,0]}),Y=hr(D,"YZ",d,!0),H=[];let q=0,j=-e/2+14,K=l-(v.boundingBox.bounds[1][2]-v.boundingBox.bounds[0][2]);for(let Ct=0;Ct<a;Ct++){const wt=o*15;H.push(v.clone().translate([q,j,K])),H.push(D.clone().translate([q-wt,j,K])),H.push(Y.clone().translate([q+wt,j,K])),j+=c,K+=l}const se=Or({width:600,depth:20,height:.5}),Se=c,_e=l,Te=Math.sqrt(Se*Se+_e*_e),xe=Te>.001?[0,Se/Te,_e/Te]:[1,0,0],fe=qn(i,{type:"face",element:oe.RIGHT},se,{normal:[-1,0,0],xDir:xe}).intersect(i),ye=fe.clone(),ue=i.boundingBox.center,re=hr(fe,"YZ",ue,!0),ce=o*30,we=o*30;H.push(fe.translate([ce,0,0])),H.push(re.translate([-we,0,0]));const he=Lt(H),Ce=[{id:"ST001",name:"Stringer",quantity:a,dimensions:`${t-1}200.5cm`,material:"Steel"},{id:"LP001",name:"L-Profile",quantity:a*2,dimensions:"4.54.520cm",material:"Steel"},{id:"SS001",name:"Side Stringer",quantity:2,dimensions:"Variable",material:"Steel"}];return{main:he,helperSpaces:n?[i]:[],componentData:Ce,technicalDrawingModels:{ST001:b,LP001:L,SS001:ye}}}const Jm={name:"Staircase",create:Qm,params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],validators:[xt(Et,["width","depth","height"])],hasExplosion:!0},e0={Cuboid:Om,Sphere:Dm,Cylinder:Fm,Ellipsoid:Bm,DiagonalCuboidPattern:Gm,RectangularCuboidGrid:Vm,LProfile:Hm,Frustum:zm,Drill:Wm,Staircase:{...Jm,hasBoM:!0}};function il(t,e){const r=e0[t];if(!r)throw new Error(`Model "${t}" not found`);const n=Rm(e,r);return n.valid?r.create(e):{error:!0,validationErrors:n.errors}}function Je(t){if(!t||typeof t!="string")return null;const e=t.split(/[\s,]+/).map(parseFloat);if(e.length!==4||e.some(isNaN))return console.warn("Could not parse viewBox string:",t),null;const r=Math.max(0,e[2]),n=Math.max(0,e[3]);return{x:e[0],y:e[1],width:r,height:n}}function Fa(t,e){const r="0 0 100 100",n=Je(t),o=Je(e);if(!n&&!o)return r;if(!n)return e||r;if(!o)return t||r;const i=Math.min(n.x,o.x),a=Math.min(n.y,o.y),l=Math.max(n.x+n.width,o.x+o.width),c=Math.max(n.y+n.height,o.y+o.height),h=Math.max(0,l-i),d=Math.max(0,c-a);return`${i} ${a} ${h} ${d}`}const st=1e-6;function er(t,e,r=st){return!t||!e?!1:Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))<r}function La(t,e,r,n=st){if(!t||!e||!r)return!1;if(Math.abs(t[0]-e[0])<n&&Math.abs(e[0]-r[0])<n||Math.abs(t[1]-e[1])<n&&Math.abs(e[1]-r[1])<n)return!0;const o=Math.abs((e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])),i=Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2);return i<n*n?!0:o/Math.sqrt(i)<n}function t0(t){const e=li(t);if(t&&t.technicalDrawingModels){const n=[],o=[];return Object.entries(t.technicalDrawingModels).forEach(([i,a])=>{try{const l=li(a),c=l.boundingBox.center;console.log(`Model ${i} original center:`,c);const h=l.translate([-c[0],-c[1],-c[2]]);console.log(`Model ${i} new center:`,h.boundingBox.center),o.push(h);const d=t.componentData.find(Y=>Y.id===i||Y.name.toLowerCase().includes(i.toLowerCase())),g=ot(h,"front"),v=ot(h,"top"),b=ot(h,"right");console.log(`${i} front view bounds:`,g.visible.toSVGViewBox()),console.log(`${i} top view bounds:`,v.visible.toSVGViewBox()),console.log(`${i} right view bounds:`,b.visible.toSVGViewBox());const T=Je(g.visible.toSVGViewBox()),C=Je(v.visible.toSVGViewBox()),x=Je(b.visible.toSVGViewBox()),A=Math.max((T==null?void 0:T.width)||0,(C==null?void 0:C.width)||0,(x==null?void 0:x.width)||0),L=Math.max((T==null?void 0:T.height)||0,(C==null?void 0:C.height)||0,(x==null?void 0:x.height)||0);T&&(g.normalizedViewBox=it(T,A,L)),C&&(v.normalizedViewBox=it(C,A,L)),x&&(b.normalizedViewBox=it(x,A,L));const D={front:g,top:v,right:b};n.push({name:d?d.name:i,views:D})}catch(l){console.error(`Error processing model ${i}:`,l)}}),console.log("All projections completed with",o.length,"centered models"),{parts:n}}const r=[];try{const n=li(e),o=n.boundingBox.center;console.log("Main model original center:",o);const i=n.translate([-o[0],-o[1],-o[2]]);console.log("Main model new center:",i.boundingBox.center),r.push(i);const a=ot(i,"front"),l=ot(i,"top"),c=ot(i,"right");console.log("Standard front view bounds:",a.visible.toSVGViewBox()),console.log("Standard top view bounds:",l.visible.toSVGViewBox()),console.log("Standard right view bounds:",c.visible.toSVGViewBox());const h=Je(a.visible.toSVGViewBox()),d=Je(l.visible.toSVGViewBox()),g=Je(c.visible.toSVGViewBox()),v=Math.max((h==null?void 0:h.width)||0,(d==null?void 0:d.width)||0,(g==null?void 0:g.width)||0),b=Math.max((h==null?void 0:h.height)||0,(d==null?void 0:d.height)||0,(g==null?void 0:g.height)||0);h&&(a.normalizedViewBox=it(h,v,b)),d&&(l.normalizedViewBox=it(d,v,b)),g&&(c.normalizedViewBox=it(g,v,b));let T=[];if(t&&t.main&&Array.isArray(t.helperSpaces)){const C=t.main,x=C.boundingBox.center;console.log("Component main original center:",x);const A=C.translate([-x[0],-x[1],-x[2]]);console.log("Component main new center:",A.boundingBox.center),r.push(A);const L=ot(A,"front"),D=ot(A,"top"),Y=ot(A,"right"),H=Je(L.visible.toSVGViewBox()),q=Je(D.visible.toSVGViewBox()),j=Je(Y.visible.toSVGViewBox()),K=Math.max((H==null?void 0:H.width)||0,(q==null?void 0:q.width)||0,(j==null?void 0:j.width)||0),se=Math.max((H==null?void 0:H.height)||0,(q==null?void 0:q.height)||0,(j==null?void 0:j.height)||0);H&&(L.normalizedViewBox=it(H,K,se)),q&&(D.normalizedViewBox=it(q,K,se)),j&&(Y.normalizedViewBox=it(j,K,se)),T=[{name:"Main Component",views:{front:L,top:D,right:Y}}],t.helperSpaces.forEach((_e,Te)=>{const xe=_e.boundingBox.center;console.log(`Helper space ${Te} original center:`,xe);const ne=_e.translate([-xe[0],-xe[1],-xe[2]]);console.log(`Helper space ${Te} new center:`,ne.boundingBox.center),r.push(ne);const fe=ot(ne,"front"),ye=ot(ne,"top"),ue=ot(ne,"right"),re=Je(fe.visible.toSVGViewBox()),ce=Je(ye.visible.toSVGViewBox()),we=Je(ue.visible.toSVGViewBox()),he=Math.max((re==null?void 0:re.width)||0,(ce==null?void 0:ce.width)||0,(we==null?void 0:we.width)||0),Ce=Math.max((re==null?void 0:re.height)||0,(ce==null?void 0:ce.height)||0,(we==null?void 0:we.height)||0);re&&(fe.normalizedViewBox=it(re,he,Ce)),ce&&(ye.normalizedViewBox=it(ce,he,Ce)),we&&(ue.normalizedViewBox=it(we,he,Ce));const yt={front:fe,top:ye,right:ue};T.push({name:`Helper Space ${Te+1}`,views:yt})})}return console.log("All standard projections completed with",r.length,"centered models"),{standard:{frontView:a,topView:l,rightView:c},parts:T}}catch(n){return console.error("Error in standard projections:",n),{standard:{},parts:[]}}}function it(t,e,r){if(!t||typeof t.x!="number"||typeof t.y!="number"||typeof t.width!="number"||typeof t.height!="number")return console.warn("Invalid viewBox provided to createNormalizedViewBox:",t),"0 0 100 100";const n=t.x+t.width/2,o=t.y+t.height/2,i=e>0?e:100,a=r>0?r:100,l=1.3,c=i*l,h=a*l,d=n-c/2,g=o-h/2;return`${d} ${g} ${c} ${h}`}function r0(t){const e={};if(t.standard)for(const[n,o]of Object.entries(t.standard))try{const i=o.visible.toSVGPaths(),a=o.hidden.toSVGPaths(),l=o.normalizedViewBox||o.visible.toSVGViewBox(5),c=o.normalizedViewBox||o.hidden.toSVGViewBox(5),h=o.normalizedViewBox||Fa(l,c);console.log(`Processed ${n} viewBox:`,h);const g=`standard_${n.replace("View","").toLowerCase()}`,v=Zn(i,`${g}_visible`),b=Zn(a,`${g}_hidden`);e[n]={visible:{paths:v,viewBox:l},hidden:{paths:b,viewBox:c},combinedViewBox:h}}catch(i){console.error(`Error processing view ${n}:`,i)}const r=[];for(const n of t.parts||[])try{const o={};for(const[i,a]of Object.entries(n.views)){const l=a.visible.toSVGPaths(),c=a.hidden.toSVGPaths(),h=`${n.name.replace(/\s+/g,"_")}_${i}`,d=Zn(l,`${h}_visible`),g=Zn(c,`${h}_hidden`),v=a.normalizedViewBox||a.visible.toSVGViewBox(5),b=a.normalizedViewBox||a.hidden.toSVGViewBox(5),T=a.normalizedViewBox||Fa(v,b);console.log(`Processed ${n.name} ${i} viewBox:`,T),o[i]={visible:{paths:d,viewBox:v},hidden:{paths:g,viewBox:b},combinedViewBox:T}}r.push({name:n.name,views:o})}catch(o){console.error(`Error processing part ${n.name}:`,o)}return{standard:Object.keys(e).length>0?e:void 0,parts:r}}function n0(t,e){let r,n;if(er(t.endpoints[1],e.endpoints[0]))r=t.endpoints[0],n=e.endpoints[1];else if(er(t.endpoints[0],e.endpoints[1]))r=e.endpoints[0],n=t.endpoints[1];else if(er(t.endpoints[0],e.endpoints[0]))r=t.endpoints[1],n=e.endpoints[1];else if(er(t.endpoints[1],e.endpoints[1]))r=t.endpoints[0],n=e.endpoints[0];else return console.warn("Cannot determine merge order for segments",t,e),t;const o=(t.length||0)+(e.length||0);return{type:"line",path:`M ${r[0]} ${r[1]} L ${n[0]} ${n[1]}`,length:o,endpoints:[r,n]}}function Zn(t,e="path"){if(!Array.isArray(t))return[];const r=[];let n=0;for(let o=0;o<t.length;o++){const i=t[o];let a;if(typeof i=="string"?a=i:Array.isArray(i)?i.every(d=>typeof d=="string")?a=i.join(" "):i.length>0&&typeof i[0]=="string"?a=i[0]:a="":i&&typeof i=="object"&&typeof i.d=="string"?a=i.d:a=String(i),!a.trim())continue;const l=o0(a);if(l){const d=`${e}_${n}_circle`;r.push({id:d,groupId:d,data:a,type:"circle",geometry:{type:"circle",center:l.center,radius:l.radius,diameter:l.radius*2}}),n++;continue}const c=i0(a),h=[];if(c.length>0){let d=c[0];for(let g=1;g<c.length;g++){const v=c[g];d&&v&&d.type==="line"&&v.type==="line"&&d.endpoints&&v.endpoints&&(er(d.endpoints[1],v.endpoints[0])||er(d.endpoints[0],v.endpoints[1])||er(d.endpoints[0],v.endpoints[0])||er(d.endpoints[1],v.endpoints[1]))&&La(d.endpoints[0],d.endpoints[1],v.endpoints[0])&&La(d.endpoints[0],d.endpoints[1],v.endpoints[1])?d=n0(d,v):(d&&h.push(d),d=v)}d&&h.push(d),h.forEach((g,v)=>{if(g&&g.path){const b=`${e}_${n}_${v}`;r.push({id:b,groupId:b,data:g.path,type:g.type,geometry:{type:g.type,length:g.length,endpoints:g.endpoints,center:g.type==="circle"?g.center:void 0,radius:g.type==="circle"?g.radius:void 0,diameter:g.type==="circle"?g.radius*2:void 0}})}else console.warn("Skipping invalid segment during final ID assignment:",g)})}else{const d=`${e}_${n}_unknown`;r.push({id:d,groupId:d,data:a,type:"unknown",geometry:{type:"unknown"}})}n++}return r}function o0(t){const e=/([Aa])\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)\s+([-\d.eE+]+)\s+([01])\s*,?\s*([01])\s+([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/g,r=/M\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/i,n=t.match(r);if(!n)return null;const o=parseFloat(n[1]),i=parseFloat(n[2]),a=[];let l;for(e.lastIndex=0;(l=e.exec(t))!==null;)a.push({rx:parseFloat(l[2]),ry:parseFloat(l[3]),xAxisRotation:parseFloat(l[4]),largeArcFlag:parseInt(l[5]),sweepFlag:parseInt(l[6]),endX:parseFloat(l[7]),endY:parseFloat(l[8]),isRelative:l[1]==="a"});if(a.length===0)return null;const c=Math.abs(a[0].rx),h=Math.abs(a[0].ry);if(c<st||Math.abs(c-h)>st*Math.max(c,h)||!a.every(me=>Math.abs(Math.abs(me.rx)-c)<st&&Math.abs(Math.abs(me.ry)-h)<st))return null;let d=o,g=i;const v=t.match(/([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/ig);if(!v)return null;for(const me of v){const Oe=me[0],Me=(me.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(Me.some(isNaN)){console.warn(`Could not parse parameters for command: ${me}`);continue}const lt=Ba(Oe,Me,d,g);d=lt[0],g=lt[1]}if(!(Math.abs(d-o)<st&&Math.abs(g-i)<st)||a.length<2)return null;let T=null;d=o,g=i;for(const me of v){const Oe=me[0],Me=(me.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(Me.some(isNaN))continue;if(Oe==="A"||Oe==="a"){if(Me.length<7){console.warn(`Invalid arc command parameters: ${me}`);continue}T={rx:Math.abs(Me[0]),ry:Math.abs(Me[1]),xAxisRotationDeg:Me[2],largeArcFlag:Me[3],sweepFlag:Me[4],endX:Oe==="a"?d+Me[5]:Me[5],endY:Oe==="a"?g+Me[6]:Me[6],startX:d,startY:g};break}const lt=Ba(Oe,Me,d,g);d=lt[0],g=lt[1]}if(!T)return null;const{rx:C,ry:x,xAxisRotationDeg:A,largeArcFlag:L,sweepFlag:D,endX:Y,endY:H,startX:q,startY:j}=T,K=A*Math.PI/180,se=Math.cos(K),Se=Math.sin(K),_e=se*(q-Y)/2+Se*(j-H)/2,Te=-Se*(q-Y)/2+se*(j-H)/2,xe=C*C,ne=x*x,fe=_e*_e,ye=Te*Te;let ue=fe/xe+ye/ne,re=C,ce=x;if(ue>1){const me=Math.sqrt(ue);re=me*C,ce=me*x}const we=re*re,he=ce*ce;let Ce=L===D?-1:1,yt=Math.max(0,(we*he-we*ye-he*fe)/(we*ye+he*fe)),Ct=Ce*Math.sqrt(yt);const wt=Ct*(re*Te/ce),zt=Ct*-(ce*_e/re),Sr=se*wt-Se*zt+(q+Y)/2,ut=Se*wt+se*zt+(j+H)/2;return{center:[Sr,ut],radius:re}}function i0(t){const e=[];let r=0,n=0,o=0,i=0;const a=/([MLHVCSQTAZmlhvcsqtaz])([^MLHVCSQTAZmlhvcsqtaz]*)/g;let l;for(;(l=a.exec(t))!==null;){const c=l[1],h=(l[2].match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(h.some(isNaN)){console.warn(`Could not parse parameters for command: ${l[0]}`);continue}let d=[];switch(c){case"M":if(h.length>=2){r=h[0],n=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const v=h[g],b=h[g+1],T=Dt(r,n,v,b);T&&e.push(T),r=v,n=b}}break;case"m":if(h.length>=2){r+=h[0],n+=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const v=r+h[g],b=n+h[g+1],T=Dt(r,n,v,b);T&&e.push(T),r=v,n=b}}break;case"L":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const v=h[g],b=h[g+1],T=Dt(r,n,v,b);T&&e.push(T),r=v,n=b}break;case"l":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const v=r+h[g],b=n+h[g+1],T=Dt(r,n,v,b);T&&e.push(T),r=v,n=b}break;case"H":for(let g=0;g<h.length;g++){const v=h[g],b=Dt(r,n,v,n);b&&e.push(b),r=v}break;case"h":for(let g=0;g<h.length;g++){const v=r+h[g],b=Dt(r,n,v,n);b&&e.push(b),r=v}break;case"V":for(let g=0;g<h.length;g++){const v=h[g],b=Dt(r,n,r,v);b&&e.push(b),n=v}break;case"v":for(let g=0;g<h.length;g++){const v=n+h[g],b=Dt(r,n,r,v);b&&e.push(b),n=v}break;case"Z":case"z":if(Math.abs(r-o)>st||Math.abs(n-i)>st){const g=Dt(r,n,o,i);g&&e.push(g)}r=o,n=i;break;case"C":case"c":d=h.length/6;for(let g=0;g<d;++g){const v=h.slice(g*6,(g+1)*6);if(v.length===6){const b=vr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:Xr(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break;case"S":case"s":d=h.length/4;for(let g=0;g<d;++g){const v=h.slice(g*4,(g+1)*4);if(v.length===4){const b=vr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:Xr(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break;case"Q":case"q":d=h.length/4;for(let g=0;g<d;++g){const v=h.slice(g*4,(g+1)*4);if(v.length===4){const b=vr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:Xr(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break;case"T":case"t":d=h.length/2;for(let g=0;g<d;++g){const v=h.slice(g*2,(g+1)*2);if(v.length===2){const b=vr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:Xr(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break;case"A":case"a":d=h.length/7;for(let g=0;g<d;++g){const v=h.slice(g*7,(g+1)*7);if(v.length===7){const b=vr(c,v,r,n);e.push({type:"arc",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:Xr(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break}}return e}function Dt(t,e,r,n){if(Math.abs(t-r)<st&&Math.abs(e-n)<st)return null;const o=Math.sqrt(Math.pow(r-t,2)+Math.pow(n-e,2));return{type:"line",path:`M ${t} ${e} L ${r} ${n}`,length:o,endpoints:[[t,e],[r,n]]}}function Xr(t,e,r,n){const o=vr(t,e,r,n);return Math.sqrt(Math.pow(o[0]-r,2)+Math.pow(o[1]-n,2))}function Ba(t,e,r,n){if("CSQTAcsgta".includes(t))return vr(t,e,r,n);let o=r,i=n;const a=t===t.toLowerCase(),l=e.length;switch(t.toUpperCase()){case"M":case"L":l>=2&&(o=e[l-2],i=e[l-1],a&&(o+=r,i+=n));break;case"H":l>=1&&(o=e[l-1],a&&(o+=r),i=n);break;case"V":l>=1&&(o=r,i=e[l-1],a&&(i+=n));break;case"Z":o=r,i=n;break}return[o,i]}function vr(t,e,r,n){const o=t===t.toLowerCase();let i=r,a=n;const l=e.length;switch(t.toUpperCase()){case"C":l>=6&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"S":case"Q":l>=4&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"T":l>=2&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"A":l>=7&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break}return[i,a]}let Ua=!1;const s0=async()=>{if(Ua)return Promise.resolve(!0);const t=await Wf({locateFile:()=>$f});return Ua=!0,Yf(t),!0},sl=s0();function a0(t,e){return console.log(`[LOG] createProjections called for model: ${t}`),console.time(`[PERF] Total ${t} projections creation`),sl.then(()=>{const r=il(t,e);if(r&&r.error)return{error:!0,validationErrors:r.validationErrors};console.time(`[PERF] ${t} projections generation`);const n=t0(r);console.timeEnd(`[PERF] ${t} projections generation`),console.time(`[PERF] ${t} projections processing`);const o=r0(n);if(console.timeEnd(`[PERF] ${t} projections processing`),console.timeEnd(`[PERF] Total ${t} projections creation`),r&&r.componentData){const i=r.componentData.map(a=>({id:a.id,name:a.name,quantity:a.quantity,dimensions:a.dimensions,material:a.material}));o.componentData=i}return o})}function u0(t,e,r="standard"){return console.time(`[PERF] Total ${t} creation (Quality: ${r})`),sl.then(()=>{console.time(`[PERF] ${t} model function`);const n=il(t,e);if(console.timeEnd(`[PERF] ${t} model function`),n&&n.error)return{error:!0,validationErrors:n.validationErrors};if(n&&n.main&&Array.isArray(n.helperSpaces)){const l=n.main,c=n.helperSpaces,h=r==="high"?{tolerance:.01,angularTolerance:1}:{tolerance:.1,angularTolerance:15};console.log(`[INFO] Using mesh options for ${r} quality:`,h),console.time(`[PERF] ${t} main model generation (Quality: ${r})`);const d=l.mesh(h),g=l.meshEdges(h);console.timeEnd(`[PERF] ${t} main model generation (Quality: ${r})`),console.time(`[PERF] ${t} helper spaces generation (Quality: ${r})`);const v=c.map(b=>({faces:b.mesh(h),edges:b.meshEdges(h)}));return console.timeEnd(`[PERF] ${t} helper spaces generation (Quality: ${r})`),console.timeEnd(`[PERF] Total ${t} creation (Quality: ${r})`),{faces:d,edges:g,helperSpaces:v,componentData:n.componentData}}const o=r==="high"?{tolerance:.01,angularTolerance:1}:{tolerance:.1,angularTolerance:15};console.log(`[INFO] Using mesh options for ${r} quality:`,o),console.time(`[PERF] ${t} faces generation (Quality: ${r})`);const i=n.mesh(o);console.timeEnd(`[PERF] ${t} faces generation (Quality: ${r})`),i&&i.triangles&&console.log(`[INFO] ${t} (Quality: ${r}) triangles: ${i.triangles.length/3}, vertices: ${i.vertices.length/3}`),console.time(`[PERF] ${t} edges generation (Quality: ${r})`);const a=n.meshEdges(o);return console.timeEnd(`[PERF] ${t} edges generation (Quality: ${r})`),console.timeEnd(`[PERF] Total ${t} creation (Quality: ${r})`),{faces:i,edges:a,componentData:n.componentData}})}Wi({createMesh:u0,createProjections:a0})});export default l0();
