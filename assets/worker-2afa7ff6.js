var $f=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var y0=$f(R=>{var Xf=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(s,u){n=s,o=u});var i=Object.assign({},r),a="./this.program",l=(s,u)=>{throw u},c=typeof window=="object",h=typeof importScripts=="function",v=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function d(s){return r.locateFile?r.locateFile(s,g):g+s}var w,T,C;function x(s){if(s instanceof jo)return;N("exiting due to exception: "+s)}var P,D,O;v?(h?g=require("path").dirname(g)+"/":g=__dirname+"/",O=()=>{D||(P=require("fs"),D=require("path"))},w=function(u,f){return O(),u=D.normalize(u),P.readFileSync(u,f?void 0:"utf8")},C=s=>{var u=w(s,!0);return u.buffer||(u=new Uint8Array(u)),u},T=(s,u,f)=>{O(),s=D.normalize(s),P.readFile(s,function(p,m){p?f(p):u(m.buffer)})},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof jo))throw s}),process.on("unhandledRejection",function(s){throw s}),l=(s,u)=>{if(Ji())throw process.exitCode=s,u;x(u),process.exit(s)},r.inspect=function(){return"[Emscripten Module object]"}):(c||h)&&(h?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",w=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.send(null),u.responseText},h&&(C=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),T=(s,u,f)=>{var p=new XMLHttpRequest;p.open("GET",s,!0),p.responseType="arraybuffer",p.onload=()=>{if(p.status==200||p.status==0&&p.response){u(p.response);return}f()},p.onerror=f,p.send(null)});var z=r.print||console.log.bind(console),N=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(a=r.thisProgram),r.quit&&(l=r.quit);var Z=4,j;r.wasmBinary&&(j=r.wasmBinary);var K=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Xt("no native wasm support detected");var ie,me=!1;function Te(s,u){s||Xt(u)}var ye=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function xe(s,u,f){for(var p=u+f,m=u;s[m]&&!(m>=p);)++m;if(m-u>16&&s.buffer&&ye)return ye.decode(s.subarray(u,m));for(var b="";u<m;){var _=s[u++];if(!(_&128)){b+=String.fromCharCode(_);continue}var S=s[u++]&63;if((_&224)==192){b+=String.fromCharCode((_&31)<<6|S);continue}var E=s[u++]&63;if((_&240)==224?_=(_&15)<<12|S<<6|E:_=(_&7)<<18|S<<12|E<<6|s[u++]&63,_<65536)b+=String.fromCharCode(_);else{var A=_-65536;b+=String.fromCharCode(55296|A>>10,56320|A&1023)}}return b}function re(s,u){return s?xe(Re,s,u):""}function le(s,u,f,p){if(!(p>0))return 0;for(var m=f,b=f+p-1,_=0;_<s.length;++_){var S=s.charCodeAt(_);if(S>=55296&&S<=57343){var E=s.charCodeAt(++_);S=65536+((S&1023)<<10)|E&1023}if(S<=127){if(f>=b)break;u[f++]=S}else if(S<=2047){if(f+1>=b)break;u[f++]=192|S>>6,u[f++]=128|S&63}else if(S<=65535){if(f+2>=b)break;u[f++]=224|S>>12,u[f++]=128|S>>6&63,u[f++]=128|S&63}else{if(f+3>=b)break;u[f++]=240|S>>18,u[f++]=128|S>>12&63,u[f++]=128|S>>6&63,u[f++]=128|S&63}}return u[f]=0,f-m}function de(s,u,f){return le(s,Re,u,f)}function ce(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&(p=65536+((p&1023)<<10)|s.charCodeAt(++f)&1023),p<=127?++u:p<=2047?u+=2:p<=65535?u+=3:u+=4}return u}var te=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ue(s,u){for(var f=s,p=f>>1,m=p+u/2;!(p>=m)&&it[p];)++p;if(f=p<<1,f-s>32&&te)return te.decode(Re.subarray(s,f));for(var b="",_=0;!(_>=u/2);++_){var S=Oe[s+_*2>>1];if(S==0)break;b+=String.fromCharCode(S)}return b}function ve(s,u,f){if(f===void 0&&(f=2147483647),f<2)return 0;f-=2;for(var p=u,m=f<s.length*2?f/2:s.length,b=0;b<m;++b){var _=s.charCodeAt(b);Oe[u>>1]=_,u+=2}return Oe[u>>1]=0,u-p}function he(s){return s.length*2}function Ce(s,u){for(var f=0,p="";!(f>=u/4);){var m=L[s+f*4>>2];if(m==0)break;if(++f,m>=65536){var b=m-65536;p+=String.fromCharCode(55296|b>>10,56320|b&1023)}else p+=String.fromCharCode(m)}return p}function nt(s,u,f){if(f===void 0&&(f=2147483647),f<4)return 0;for(var p=u,m=p+f-4,b=0;b<s.length;++b){var _=s.charCodeAt(b);if(_>=55296&&_<=57343){var S=s.charCodeAt(++b);_=65536+((_&1023)<<10)|S&1023}if(L[u>>2]=_,u+=4,u+4>m)break}return L[u>>2]=0,u-p}function dt(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&++f,u+=4}return u}function ot(s){var u=ce(s)+1,f=Bt(u);return f&&le(s,ge,f,u),f}function vt(s,u){ge.set(s,u)}function Rt(s,u,f){for(var p=0;p<s.length;++p)ge[u++>>0]=s.charCodeAt(p);f||(ge[u>>0]=0)}var et,ge,Re,Oe,it,L,Y,pe,Yi;function ji(s){et=s,r.HEAP8=ge=new Int8Array(s),r.HEAP16=Oe=new Int16Array(s),r.HEAP32=L=new Int32Array(s),r.HEAPU8=Re=new Uint8Array(s),r.HEAPU16=it=new Uint16Array(s),r.HEAPU32=Y=new Uint32Array(s),r.HEAPF32=pe=new Float32Array(s),r.HEAPF64=Yi=new Float64Array(s)}r.INITIAL_MEMORY;var qi,Zi=[],Ki=[],Qi=[];function Ji(){return K}function ll(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)hl(r.preRun.shift());Mo(Zi)}function cl(){!r.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,Mo(Ki)}function fl(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)dl(r.postRun.shift());Mo(Qi)}function hl(s){Zi.unshift(s)}function pl(s){Ki.unshift(s)}function dl(s){Qi.unshift(s)}var lr=0,Vr=null;function w0(s){return s}function Oo(s){lr++,r.monitorRunDependencies&&r.monitorRunDependencies(lr)}function Tn(s){if(lr--,r.monitorRunDependencies&&r.monitorRunDependencies(lr),lr==0&&Vr){var u=Vr;Vr=null,u()}}function Xt(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",N(s),me=!0,s+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(s);throw o(u),u}var vl="data:application/octet-stream;base64,";function es(s){return s.startsWith(vl)}function ts(s){return s.startsWith("file://")}var tt;tt="replicad_single.wasm",es(tt)||(tt=d(tt));function rs(s){try{if(s==tt&&j)return new Uint8Array(j);if(C)return C(s);throw"both async and sync fetching of the wasm failed"}catch(u){Xt(u)}}function gl(){if(!j&&(c||h)){if(typeof fetch=="function"&&!ts(tt))return fetch(tt,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+tt+"'";return s.arrayBuffer()}).catch(function(){return rs(tt)});if(T)return new Promise(function(s,u){T(tt,function(f){s(new Uint8Array(f))},u)})}return Promise.resolve().then(function(){return rs(tt)})}function ml(){var s={a:Hf};function u(_,S){var E=_.exports;r.asm=E,ie=r.asm.oa,ji(ie.buffer),qi=r.asm.va,pl(r.asm.pa),Tn()}Oo();function f(_){u(_.instance)}function p(_){return gl().then(function(S){return WebAssembly.instantiate(S,s)}).then(function(S){return S}).then(_,function(S){N("failed to asynchronously prepare wasm: "+S),Xt(S)})}function m(){return!j&&typeof WebAssembly.instantiateStreaming=="function"&&!es(tt)&&!ts(tt)&&!v&&typeof fetch=="function"?fetch(tt,{credentials:"same-origin"}).then(function(_){var S=WebAssembly.instantiateStreaming(_,s);return S.then(f,function(E){return N("wasm streaming compile failed: "+E),N("falling back to ArrayBuffer instantiation"),p(f)})}):p(f)}if(r.instantiateWasm)try{var b=r.instantiateWasm(s,u);return b}catch(_){return N("Module.instantiateWasm callback failed with error: "+_),!1}return m().catch(o),{}}var $e,Ot;function yl(){return r.HEAP8.length}function Mo(s){for(;s.length>0;){var u=s.shift();if(typeof u=="function"){u(r);continue}var f=u.func;typeof f=="number"?u.arg===void 0?xn(f)():xn(f)(u.arg):f(u.arg===void 0?null:u.arg)}}var En=[];function xn(s){var u=En[s];return u||(s>=En.length&&(En.length=s+1),En[s]=u=qi.get(s)),u}function wl(s,u,f,p){Xt("Assertion failed: "+re(s)+", at: "+[u?re(u):"unknown filename",f,p?re(p):"unknown function"])}function bl(s){return Bt(s+24)+24}function _l(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(u){Y[this.ptr+4>>2]=u},this.get_type=function(){return Y[this.ptr+4>>2]},this.set_destructor=function(u){Y[this.ptr+8>>2]=u},this.get_destructor=function(){return Y[this.ptr+8>>2]},this.set_refcount=function(u){L[this.ptr>>2]=u},this.set_caught=function(u){u=u?1:0,ge[this.ptr+12>>0]=u},this.get_caught=function(){return ge[this.ptr+12>>0]!=0},this.set_rethrown=function(u){u=u?1:0,ge[this.ptr+13>>0]=u},this.get_rethrown=function(){return ge[this.ptr+13>>0]!=0},this.init=function(u,f){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(f),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var u=L[this.ptr>>2];L[this.ptr>>2]=u+1},this.release_ref=function(){var u=L[this.ptr>>2];return L[this.ptr>>2]=u-1,u===1},this.set_adjusted_ptr=function(u){Y[this.ptr+16>>2]=u},this.get_adjusted_ptr=function(){return Y[this.ptr+16>>2]},this.get_exception_ptr=function(){var u=Ps(this.get_type());if(u)return Y[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}function Sl(s,u,f){var p=new _l(s);throw p.init(u,f),s}var we={isAbs:s=>s.charAt(0)==="/",splitPath:s=>{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return u.exec(s).slice(1)},normalizeArray:(s,u)=>{for(var f=0,p=s.length-1;p>=0;p--){var m=s[p];m==="."?s.splice(p,1):m===".."?(s.splice(p,1),f++):f&&(s.splice(p,1),f--)}if(u)for(;f;f--)s.unshift("..");return s},normalize:s=>{var u=we.isAbs(s),f=s.substr(-1)==="/";return s=we.normalizeArray(s.split("/").filter(p=>!!p),!u).join("/"),!s&&!u&&(s="."),s&&f&&(s+="/"),(u?"/":"")+s},dirname:s=>{var u=we.splitPath(s),f=u[0],p=u[1];return!f&&!p?".":(p&&(p=p.substr(0,p.length-1)),f+p)},basename:s=>{if(s==="/")return"/";s=we.normalize(s),s=s.replace(/\/$/,"");var u=s.lastIndexOf("/");return u===-1?s:s.substr(u+1)},join:function(){var s=Array.prototype.slice.call(arguments,0);return we.normalize(s.join("/"))},join2:(s,u)=>we.normalize(s+"/"+u)};function Tl(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var s=new Uint8Array(1);return function(){return crypto.getRandomValues(s),s[0]}}else if(v)try{var u=require("crypto");return function(){return u.randomBytes(1)[0]}}catch{}return function(){Xt("randomDevice")}}var Mt={resolve:function(){for(var s="",u=!1,f=arguments.length-1;f>=-1&&!u;f--){var p=f>=0?arguments[f]:y.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)return"";s=p+"/"+s,u=we.isAbs(p)}return s=we.normalizeArray(s.split("/").filter(m=>!!m),!u).join("/"),(u?"/":"")+s||"."},relative:(s,u)=>{s=Mt.resolve(s).substr(1),u=Mt.resolve(u).substr(1);function f(A){for(var U=0;U<A.length&&A[U]==="";U++);for(var I=A.length-1;I>=0&&A[I]==="";I--);return U>I?[]:A.slice(U,I-U+1)}for(var p=f(s.split("/")),m=f(u.split("/")),b=Math.min(p.length,m.length),_=b,S=0;S<b;S++)if(p[S]!==m[S]){_=S;break}for(var E=[],S=_;S<p.length;S++)E.push("..");return E=E.concat(m.slice(_)),E.join("/")}},cr={ttys:[],init:function(){},shutdown:function(){},register:function(s,u){cr.ttys[s]={input:[],output:[],ops:u},y.registerDevice(s,cr.stream_ops)},stream_ops:{open:function(s){var u=cr.ttys[s.node.rdev];if(!u)throw new y.ErrnoError(43);s.tty=u,s.seekable=!1},close:function(s){s.tty.ops.flush(s.tty)},flush:function(s){s.tty.ops.flush(s.tty)},read:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.get_char)throw new y.ErrnoError(60);for(var b=0,_=0;_<p;_++){var S;try{S=s.tty.ops.get_char(s.tty)}catch{throw new y.ErrnoError(29)}if(S===void 0&&b===0)throw new y.ErrnoError(6);if(S==null)break;b++,u[f+_]=S}return b&&(s.node.timestamp=Date.now()),b},write:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var b=0;b<p;b++)s.tty.ops.put_char(s.tty,u[f+b])}catch{throw new y.ErrnoError(29)}return p&&(s.node.timestamp=Date.now()),b}},default_tty_ops:{get_char:function(s){if(!s.input.length){var u=null;if(v){var f=256,p=Buffer.alloc(f),m=0;try{m=P.readSync(process.stdin.fd,p,0,f,-1)}catch(b){if(b.toString().includes("EOF"))m=0;else throw b}m>0?u=p.slice(0,m).toString("utf-8"):u=null}else typeof window<"u"&&typeof window.prompt=="function"?(u=window.prompt("Input: "),u!==null&&(u+=`
`)):typeof readline=="function"&&(u=readline(),u!==null&&(u+=`
`));if(!u)return null;s.input=Nn(u,!0)}return s.input.shift()},put_char:function(s,u){u===null||u===10?(z(xe(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&(z(xe(s.output,0)),s.output=[])}},default_tty1_ops:{put_char:function(s,u){u===null||u===10?(N(xe(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&(N(xe(s.output,0)),s.output=[])}}};function El(s,u){Re.fill(0,s,s+u)}function xl(s,u){return Math.ceil(s/u)*u}function ns(s){s=xl(s,65536);var u=Cs(65536,s);return u?(El(u,s),u):0}var ne={ops_table:null,mount:function(s){return ne.createNode(null,"/",16895,0)},createNode:function(s,u,f,p){if(y.isBlkdev(f)||y.isFIFO(f))throw new y.ErrnoError(63);ne.ops_table||(ne.ops_table={dir:{node:{getattr:ne.node_ops.getattr,setattr:ne.node_ops.setattr,lookup:ne.node_ops.lookup,mknod:ne.node_ops.mknod,rename:ne.node_ops.rename,unlink:ne.node_ops.unlink,rmdir:ne.node_ops.rmdir,readdir:ne.node_ops.readdir,symlink:ne.node_ops.symlink},stream:{llseek:ne.stream_ops.llseek}},file:{node:{getattr:ne.node_ops.getattr,setattr:ne.node_ops.setattr},stream:{llseek:ne.stream_ops.llseek,read:ne.stream_ops.read,write:ne.stream_ops.write,allocate:ne.stream_ops.allocate,mmap:ne.stream_ops.mmap,msync:ne.stream_ops.msync}},link:{node:{getattr:ne.node_ops.getattr,setattr:ne.node_ops.setattr,readlink:ne.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ne.node_ops.getattr,setattr:ne.node_ops.setattr},stream:y.chrdev_stream_ops}});var m=y.createNode(s,u,f,p);return y.isDir(m.mode)?(m.node_ops=ne.ops_table.dir.node,m.stream_ops=ne.ops_table.dir.stream,m.contents={}):y.isFile(m.mode)?(m.node_ops=ne.ops_table.file.node,m.stream_ops=ne.ops_table.file.stream,m.usedBytes=0,m.contents=null):y.isLink(m.mode)?(m.node_ops=ne.ops_table.link.node,m.stream_ops=ne.ops_table.link.stream):y.isChrdev(m.mode)&&(m.node_ops=ne.ops_table.chrdev.node,m.stream_ops=ne.ops_table.chrdev.stream),m.timestamp=Date.now(),s&&(s.contents[u]=m,s.timestamp=m.timestamp),m},getFileDataAsTypedArray:function(s){return s.contents?s.contents.subarray?s.contents.subarray(0,s.usedBytes):new Uint8Array(s.contents):new Uint8Array(0)},expandFileStorage:function(s,u){var f=s.contents?s.contents.length:0;if(!(f>=u)){var p=1024*1024;u=Math.max(u,f*(f<p?2:1.125)>>>0),f!=0&&(u=Math.max(u,256));var m=s.contents;s.contents=new Uint8Array(u),s.usedBytes>0&&s.contents.set(m.subarray(0,s.usedBytes),0)}},resizeFileStorage:function(s,u){if(s.usedBytes!=u)if(u==0)s.contents=null,s.usedBytes=0;else{var f=s.contents;s.contents=new Uint8Array(u),f&&s.contents.set(f.subarray(0,Math.min(u,s.usedBytes))),s.usedBytes=u}},node_ops:{getattr:function(s){var u={};return u.dev=y.isChrdev(s.mode)?s.id:1,u.ino=s.id,u.mode=s.mode,u.nlink=1,u.uid=0,u.gid=0,u.rdev=s.rdev,y.isDir(s.mode)?u.size=4096:y.isFile(s.mode)?u.size=s.usedBytes:y.isLink(s.mode)?u.size=s.link.length:u.size=0,u.atime=new Date(s.timestamp),u.mtime=new Date(s.timestamp),u.ctime=new Date(s.timestamp),u.blksize=4096,u.blocks=Math.ceil(u.size/u.blksize),u},setattr:function(s,u){u.mode!==void 0&&(s.mode=u.mode),u.timestamp!==void 0&&(s.timestamp=u.timestamp),u.size!==void 0&&ne.resizeFileStorage(s,u.size)},lookup:function(s,u){throw y.genericErrors[44]},mknod:function(s,u,f,p){return ne.createNode(s,u,f,p)},rename:function(s,u,f){if(y.isDir(s.mode)){var p;try{p=y.lookupNode(u,f)}catch{}if(p)for(var m in p.contents)throw new y.ErrnoError(55)}delete s.parent.contents[s.name],s.parent.timestamp=Date.now(),s.name=f,u.contents[f]=s,u.timestamp=s.parent.timestamp,s.parent=u},unlink:function(s,u){delete s.contents[u],s.timestamp=Date.now()},rmdir:function(s,u){var f=y.lookupNode(s,u);for(var p in f.contents)throw new y.ErrnoError(55);delete s.contents[u],s.timestamp=Date.now()},readdir:function(s){var u=[".",".."];for(var f in s.contents)s.contents.hasOwnProperty(f)&&u.push(f);return u},symlink:function(s,u,f){var p=ne.createNode(s,u,41471,0);return p.link=f,p},readlink:function(s){if(!y.isLink(s.mode))throw new y.ErrnoError(28);return s.link}},stream_ops:{read:function(s,u,f,p,m){var b=s.node.contents;if(m>=s.node.usedBytes)return 0;var _=Math.min(s.node.usedBytes-m,p);if(_>8&&b.subarray)u.set(b.subarray(m,m+_),f);else for(var S=0;S<_;S++)u[f+S]=b[m+S];return _},write:function(s,u,f,p,m,b){if(u.buffer===ge.buffer&&(b=!1),!p)return 0;var _=s.node;if(_.timestamp=Date.now(),u.subarray&&(!_.contents||_.contents.subarray)){if(b)return _.contents=u.subarray(f,f+p),_.usedBytes=p,p;if(_.usedBytes===0&&m===0)return _.contents=u.slice(f,f+p),_.usedBytes=p,p;if(m+p<=_.usedBytes)return _.contents.set(u.subarray(f,f+p),m),p}if(ne.expandFileStorage(_,m+p),_.contents.subarray&&u.subarray)_.contents.set(u.subarray(f,f+p),m);else for(var S=0;S<p;S++)_.contents[m+S]=u[f+S];return _.usedBytes=Math.max(_.usedBytes,m+p),p},llseek:function(s,u,f){var p=u;if(f===1?p+=s.position:f===2&&y.isFile(s.node.mode)&&(p+=s.node.usedBytes),p<0)throw new y.ErrnoError(28);return p},allocate:function(s,u,f){ne.expandFileStorage(s.node,u+f),s.node.usedBytes=Math.max(s.node.usedBytes,u+f)},mmap:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);var b,_,S=s.node.contents;if(!(m&2)&&S.buffer===et)_=!1,b=S.byteOffset;else{if((f>0||f+u<S.length)&&(S.subarray?S=S.subarray(f,f+u):S=Array.prototype.slice.call(S,f,f+u)),_=!0,b=ns(u),!b)throw new y.ErrnoError(48);ge.set(S,b)}return{ptr:b,allocated:_}},msync:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);return m&2||ne.stream_ops.write(s,u,0,p,f,!1),0}}};function Cl(s,u,f,p){var m=p?"":"al "+s;T(s,function(b){Te(b,'Loading data file "'+s+'" failed (no arrayBuffer).'),u(new Uint8Array(b)),m&&Tn()},function(b){if(f)f();else throw'Loading data file "'+s+'" failed.'}),m&&Oo()}var y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(s,u={})=>{if(s=Mt.resolve(y.cwd(),s),!s)return{path:"",node:null};var f={follow_mount:!0,recurse_count:0};if(u=Object.assign(f,u),u.recurse_count>8)throw new y.ErrnoError(32);for(var p=we.normalizeArray(s.split("/").filter(I=>!!I),!1),m=y.root,b="/",_=0;_<p.length;_++){var S=_===p.length-1;if(S&&u.parent)break;if(m=y.lookupNode(m,p[_]),b=we.join2(b,p[_]),y.isMountpoint(m)&&(!S||S&&u.follow_mount)&&(m=m.mounted.root),!S||u.follow)for(var E=0;y.isLink(m.mode);){var A=y.readlink(b);b=Mt.resolve(we.dirname(b),A);var U=y.lookupPath(b,{recurse_count:u.recurse_count+1});if(m=U.node,E++>40)throw new y.ErrnoError(32)}}return{path:b,node:m}},getPath:s=>{for(var u;;){if(y.isRoot(s)){var f=s.mount.mountpoint;return u?f[f.length-1]!=="/"?f+"/"+u:f+u:f}u=u?s.name+"/"+u:s.name,s=s.parent}},hashName:(s,u)=>{for(var f=0,p=0;p<u.length;p++)f=(f<<5)-f+u.charCodeAt(p)|0;return(s+f>>>0)%y.nameTable.length},hashAddNode:s=>{var u=y.hashName(s.parent.id,s.name);s.name_next=y.nameTable[u],y.nameTable[u]=s},hashRemoveNode:s=>{var u=y.hashName(s.parent.id,s.name);if(y.nameTable[u]===s)y.nameTable[u]=s.name_next;else for(var f=y.nameTable[u];f;){if(f.name_next===s){f.name_next=s.name_next;break}f=f.name_next}},lookupNode:(s,u)=>{var f=y.mayLookup(s);if(f)throw new y.ErrnoError(f,s);for(var p=y.hashName(s.id,u),m=y.nameTable[p];m;m=m.name_next){var b=m.name;if(m.parent.id===s.id&&b===u)return m}return y.lookup(s,u)},createNode:(s,u,f,p)=>{var m=new y.FSNode(s,u,f,p);return y.hashAddNode(m),m},destroyNode:s=>{y.hashRemoveNode(s)},isRoot:s=>s===s.parent,isMountpoint:s=>!!s.mounted,isFile:s=>(s&61440)===32768,isDir:s=>(s&61440)===16384,isLink:s=>(s&61440)===40960,isChrdev:s=>(s&61440)===8192,isBlkdev:s=>(s&61440)===24576,isFIFO:s=>(s&61440)===4096,isSocket:s=>(s&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:s=>{var u=y.flagModes[s];if(typeof u>"u")throw new Error("Unknown file open mode: "+s);return u},flagsToPermissionString:s=>{var u=["r","w","rw"][s&3];return s&512&&(u+="w"),u},nodePermissions:(s,u)=>y.ignorePermissions?0:u.includes("r")&&!(s.mode&292)||u.includes("w")&&!(s.mode&146)||u.includes("x")&&!(s.mode&73)?2:0,mayLookup:s=>{var u=y.nodePermissions(s,"x");return u||(s.node_ops.lookup?0:2)},mayCreate:(s,u)=>{try{var f=y.lookupNode(s,u);return 20}catch{}return y.nodePermissions(s,"wx")},mayDelete:(s,u,f)=>{var p;try{p=y.lookupNode(s,u)}catch(b){return b.errno}var m=y.nodePermissions(s,"wx");if(m)return m;if(f){if(!y.isDir(p.mode))return 54;if(y.isRoot(p)||y.getPath(p)===y.cwd())return 10}else if(y.isDir(p.mode))return 31;return 0},mayOpen:(s,u)=>s?y.isLink(s.mode)?32:y.isDir(s.mode)&&(y.flagsToPermissionString(u)!=="r"||u&512)?31:y.nodePermissions(s,y.flagsToPermissionString(u)):44,MAX_OPEN_FDS:4096,nextfd:(s=0,u=y.MAX_OPEN_FDS)=>{for(var f=s;f<=u;f++)if(!y.streams[f])return f;throw new y.ErrnoError(33)},getStream:s=>y.streams[s],createStream:(s,u,f)=>{y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get:function(){return this.node},set:function(m){this.node=m}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(m){this.shared.flags=m}},position:{get:function(){return this.shared.position},set:function(m){this.shared.position=m}}})),s=Object.assign(new y.FSStream,s);var p=y.nextfd(u,f);return s.fd=p,y.streams[p]=s,s},closeStream:s=>{y.streams[s]=null},chrdev_stream_ops:{open:s=>{var u=y.getDevice(s.node.rdev);s.stream_ops=u.stream_ops,s.stream_ops.open&&s.stream_ops.open(s)},llseek:()=>{throw new y.ErrnoError(70)}},major:s=>s>>8,minor:s=>s&255,makedev:(s,u)=>s<<8|u,registerDevice:(s,u)=>{y.devices[s]={stream_ops:u}},getDevice:s=>y.devices[s],getMounts:s=>{for(var u=[],f=[s];f.length;){var p=f.pop();u.push(p),f.push.apply(f,p.mounts)}return u},syncfs:(s,u)=>{typeof s=="function"&&(u=s,s=!1),y.syncFSRequests++,y.syncFSRequests>1&&N("warning: "+y.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var f=y.getMounts(y.root.mount),p=0;function m(_){return y.syncFSRequests--,u(_)}function b(_){if(_)return b.errored?void 0:(b.errored=!0,m(_));++p>=f.length&&m(null)}f.forEach(_=>{if(!_.type.syncfs)return b(null);_.type.syncfs(_,s,b)})},mount:(s,u,f)=>{var p=f==="/",m=!f,b;if(p&&y.root)throw new y.ErrnoError(10);if(!p&&!m){var _=y.lookupPath(f,{follow_mount:!1});if(f=_.path,b=_.node,y.isMountpoint(b))throw new y.ErrnoError(10);if(!y.isDir(b.mode))throw new y.ErrnoError(54)}var S={type:s,opts:u,mountpoint:f,mounts:[]},E=s.mount(S);return E.mount=S,S.root=E,p?y.root=E:b&&(b.mounted=S,b.mount&&b.mount.mounts.push(S)),E},unmount:s=>{var u=y.lookupPath(s,{follow_mount:!1});if(!y.isMountpoint(u.node))throw new y.ErrnoError(28);var f=u.node,p=f.mounted,m=y.getMounts(p);Object.keys(y.nameTable).forEach(_=>{for(var S=y.nameTable[_];S;){var E=S.name_next;m.includes(S.mount)&&y.destroyNode(S),S=E}}),f.mounted=null;var b=f.mount.mounts.indexOf(p);f.mount.mounts.splice(b,1)},lookup:(s,u)=>s.node_ops.lookup(s,u),mknod:(s,u,f)=>{var p=y.lookupPath(s,{parent:!0}),m=p.node,b=we.basename(s);if(!b||b==="."||b==="..")throw new y.ErrnoError(28);var _=y.mayCreate(m,b);if(_)throw new y.ErrnoError(_);if(!m.node_ops.mknod)throw new y.ErrnoError(63);return m.node_ops.mknod(m,b,u,f)},create:(s,u)=>(u=u!==void 0?u:438,u&=4095,u|=32768,y.mknod(s,u,0)),mkdir:(s,u)=>(u=u!==void 0?u:511,u&=1023,u|=16384,y.mknod(s,u,0)),mkdirTree:(s,u)=>{for(var f=s.split("/"),p="",m=0;m<f.length;++m)if(f[m]){p+="/"+f[m];try{y.mkdir(p,u)}catch(b){if(b.errno!=20)throw b}}},mkdev:(s,u,f)=>(typeof f>"u"&&(f=u,u=438),u|=8192,y.mknod(s,u,f)),symlink:(s,u)=>{if(!Mt.resolve(s))throw new y.ErrnoError(44);var f=y.lookupPath(u,{parent:!0}),p=f.node;if(!p)throw new y.ErrnoError(44);var m=we.basename(u),b=y.mayCreate(p,m);if(b)throw new y.ErrnoError(b);if(!p.node_ops.symlink)throw new y.ErrnoError(63);return p.node_ops.symlink(p,m,s)},rename:(s,u)=>{var f=we.dirname(s),p=we.dirname(u),m=we.basename(s),b=we.basename(u),_,S,E;if(_=y.lookupPath(s,{parent:!0}),S=_.node,_=y.lookupPath(u,{parent:!0}),E=_.node,!S||!E)throw new y.ErrnoError(44);if(S.mount!==E.mount)throw new y.ErrnoError(75);var A=y.lookupNode(S,m),U=Mt.relative(s,p);if(U.charAt(0)!==".")throw new y.ErrnoError(28);if(U=Mt.relative(u,f),U.charAt(0)!==".")throw new y.ErrnoError(55);var I;try{I=y.lookupNode(E,b)}catch{}if(A!==I){var B=y.isDir(A.mode),V=y.mayDelete(S,m,B);if(V)throw new y.ErrnoError(V);if(V=I?y.mayDelete(E,b,B):y.mayCreate(E,b),V)throw new y.ErrnoError(V);if(!S.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(A)||I&&y.isMountpoint(I))throw new y.ErrnoError(10);if(E!==S&&(V=y.nodePermissions(S,"w"),V))throw new y.ErrnoError(V);y.hashRemoveNode(A);try{S.node_ops.rename(A,E,b)}catch(q){throw q}finally{y.hashAddNode(A)}}},rmdir:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node,p=we.basename(s),m=y.lookupNode(f,p),b=y.mayDelete(f,p,!0);if(b)throw new y.ErrnoError(b);if(!f.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.rmdir(f,p),y.destroyNode(m)},readdir:s=>{var u=y.lookupPath(s,{follow:!0}),f=u.node;if(!f.node_ops.readdir)throw new y.ErrnoError(54);return f.node_ops.readdir(f)},unlink:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node;if(!f)throw new y.ErrnoError(44);var p=we.basename(s),m=y.lookupNode(f,p),b=y.mayDelete(f,p,!1);if(b)throw new y.ErrnoError(b);if(!f.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.unlink(f,p),y.destroyNode(m)},readlink:s=>{var u=y.lookupPath(s),f=u.node;if(!f)throw new y.ErrnoError(44);if(!f.node_ops.readlink)throw new y.ErrnoError(28);return Mt.resolve(y.getPath(f.parent),f.node_ops.readlink(f))},stat:(s,u)=>{var f=y.lookupPath(s,{follow:!u}),p=f.node;if(!p)throw new y.ErrnoError(44);if(!p.node_ops.getattr)throw new y.ErrnoError(63);return p.node_ops.getattr(p)},lstat:s=>y.stat(s,!0),chmod:(s,u,f)=>{var p;if(typeof s=="string"){var m=y.lookupPath(s,{follow:!f});p=m.node}else p=s;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{mode:u&4095|p.mode&-4096,timestamp:Date.now()})},lchmod:(s,u)=>{y.chmod(s,u,!0)},fchmod:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);y.chmod(f.node,u)},chown:(s,u,f,p)=>{var m;if(typeof s=="string"){var b=y.lookupPath(s,{follow:!p});m=b.node}else m=s;if(!m.node_ops.setattr)throw new y.ErrnoError(63);m.node_ops.setattr(m,{timestamp:Date.now()})},lchown:(s,u,f)=>{y.chown(s,u,f,!0)},fchown:(s,u,f)=>{var p=y.getStream(s);if(!p)throw new y.ErrnoError(8);y.chown(p.node,u,f)},truncate:(s,u)=>{if(u<0)throw new y.ErrnoError(28);var f;if(typeof s=="string"){var p=y.lookupPath(s,{follow:!0});f=p.node}else f=s;if(!f.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(f.mode))throw new y.ErrnoError(31);if(!y.isFile(f.mode))throw new y.ErrnoError(28);var m=y.nodePermissions(f,"w");if(m)throw new y.ErrnoError(m);f.node_ops.setattr(f,{size:u,timestamp:Date.now()})},ftruncate:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);if(!(f.flags&2097155))throw new y.ErrnoError(28);y.truncate(f.node,u)},utime:(s,u,f)=>{var p=y.lookupPath(s,{follow:!0}),m=p.node;m.node_ops.setattr(m,{timestamp:Math.max(u,f)})},open:(s,u,f)=>{if(s==="")throw new y.ErrnoError(44);u=typeof u=="string"?y.modeStringToFlags(u):u,f=typeof f>"u"?438:f,u&64?f=f&4095|32768:f=0;var p;if(typeof s=="object")p=s;else{s=we.normalize(s);try{var m=y.lookupPath(s,{follow:!(u&131072)});p=m.node}catch{}}var b=!1;if(u&64)if(p){if(u&128)throw new y.ErrnoError(20)}else p=y.mknod(s,f,0),b=!0;if(!p)throw new y.ErrnoError(44);if(y.isChrdev(p.mode)&&(u&=-513),u&65536&&!y.isDir(p.mode))throw new y.ErrnoError(54);if(!b){var _=y.mayOpen(p,u);if(_)throw new y.ErrnoError(_)}u&512&&!b&&y.truncate(p,0),u&=-131713;var S=y.createStream({node:p,path:y.getPath(p),flags:u,seekable:!0,position:0,stream_ops:p.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),r.logReadFiles&&!(u&1)&&(y.readFiles||(y.readFiles={}),s in y.readFiles||(y.readFiles[s]=1)),S},close:s=>{if(y.isClosed(s))throw new y.ErrnoError(8);s.getdents&&(s.getdents=null);try{s.stream_ops.close&&s.stream_ops.close(s)}catch(u){throw u}finally{y.closeStream(s.fd)}s.fd=null},isClosed:s=>s.fd===null,llseek:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(!s.seekable||!s.stream_ops.llseek)throw new y.ErrnoError(70);if(f!=0&&f!=1&&f!=2)throw new y.ErrnoError(28);return s.position=s.stream_ops.llseek(s,u,f),s.ungotten=[],s.position},read:(s,u,f,p,m)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if((s.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.read)throw new y.ErrnoError(28);var b=typeof m<"u";if(!b)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var _=s.stream_ops.read(s,u,f,p,m);return b||(s.position+=_),_},write:(s,u,f,p,m,b)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.write)throw new y.ErrnoError(28);s.seekable&&s.flags&1024&&y.llseek(s,0,2);var _=typeof m<"u";if(!_)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var S=s.stream_ops.write(s,u,f,p,m,b);return _||(s.position+=S),S},allocate:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(u<0||f<=0)throw new y.ErrnoError(28);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(s.node.mode)&&!y.isDir(s.node.mode))throw new y.ErrnoError(43);if(!s.stream_ops.allocate)throw new y.ErrnoError(138);s.stream_ops.allocate(s,u,f)},mmap:(s,u,f,p,m)=>{if(p&2&&!(m&2)&&(s.flags&2097155)!==2)throw new y.ErrnoError(2);if((s.flags&2097155)===1)throw new y.ErrnoError(2);if(!s.stream_ops.mmap)throw new y.ErrnoError(43);return s.stream_ops.mmap(s,u,f,p,m)},msync:(s,u,f,p,m)=>!s||!s.stream_ops.msync?0:s.stream_ops.msync(s,u,f,p,m),munmap:s=>0,ioctl:(s,u,f)=>{if(!s.stream_ops.ioctl)throw new y.ErrnoError(59);return s.stream_ops.ioctl(s,u,f)},readFile:(s,u={})=>{if(u.flags=u.flags||0,u.encoding=u.encoding||"binary",u.encoding!=="utf8"&&u.encoding!=="binary")throw new Error('Invalid encoding type "'+u.encoding+'"');var f,p=y.open(s,u.flags),m=y.stat(s),b=m.size,_=new Uint8Array(b);return y.read(p,_,0,b,0),u.encoding==="utf8"?f=xe(_,0):u.encoding==="binary"&&(f=_),y.close(p),f},writeFile:(s,u,f={})=>{f.flags=f.flags||577;var p=y.open(s,f.flags,f.mode);if(typeof u=="string"){var m=new Uint8Array(ce(u)+1),b=le(u,m,0,m.length);y.write(p,m,0,b,void 0,f.canOwn)}else if(ArrayBuffer.isView(u))y.write(p,u,0,u.byteLength,void 0,f.canOwn);else throw new Error("Unsupported data type");y.close(p)},cwd:()=>y.currentPath,chdir:s=>{var u=y.lookupPath(s,{follow:!0});if(u.node===null)throw new y.ErrnoError(44);if(!y.isDir(u.node.mode))throw new y.ErrnoError(54);var f=y.nodePermissions(u.node,"x");if(f)throw new y.ErrnoError(f);y.currentPath=u.path},createDefaultDirectories:()=>{y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices:()=>{y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(u,f,p,m,b)=>m}),y.mkdev("/dev/null",y.makedev(1,3)),cr.register(y.makedev(5,0),cr.default_tty_ops),cr.register(y.makedev(6,0),cr.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var s=Tl();y.createDevice("/dev","random",s),y.createDevice("/dev","urandom",s),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{y.mkdir("/proc");var s=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount:()=>{var u=y.createNode(s,"fd",16895,73);return u.node_ops={lookup:(f,p)=>{var m=+p,b=y.getStream(m);if(!b)throw new y.ErrnoError(8);var _={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>b.path}};return _.parent=_,_}},u}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?y.createDevice("/dev","stdin",r.stdin):y.symlink("/dev/tty","/dev/stdin"),r.stdout?y.createDevice("/dev","stdout",null,r.stdout):y.symlink("/dev/tty","/dev/stdout"),r.stderr?y.createDevice("/dev","stderr",null,r.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError:()=>{y.ErrnoError||(y.ErrnoError=function(u,f){this.node=f,this.setErrno=function(p){this.errno=p},this.setErrno(u),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(s=>{y.genericErrors[s]=new y.ErrnoError(s),y.genericErrors[s].stack="<generic error, no stack>"}))},staticInit:()=>{y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(ne,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:ne}},init:(s,u,f)=>{y.init.initialized=!0,y.ensureErrnoError(),r.stdin=s||r.stdin,r.stdout=u||r.stdout,r.stderr=f||r.stderr,y.createStandardStreams()},quit:()=>{y.init.initialized=!1;for(var s=0;s<y.streams.length;s++){var u=y.streams[s];u&&y.close(u)}},getMode:(s,u)=>{var f=0;return s&&(f|=365),u&&(f|=146),f},findObject:(s,u)=>{var f=y.analyzePath(s,u);return f.exists?f.object:null},analyzePath:(s,u)=>{try{var f=y.lookupPath(s,{follow:!u});s=f.path}catch{}var p={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var f=y.lookupPath(s,{parent:!0});p.parentExists=!0,p.parentPath=f.path,p.parentObject=f.node,p.name=we.basename(s),f=y.lookupPath(s,{follow:!u}),p.exists=!0,p.path=f.path,p.object=f.node,p.name=f.node.name,p.isRoot=f.path==="/"}catch(m){p.error=m.errno}return p},createPath:(s,u,f,p)=>{s=typeof s=="string"?s:y.getPath(s);for(var m=u.split("/").reverse();m.length;){var b=m.pop();if(b){var _=we.join2(s,b);try{y.mkdir(_)}catch{}s=_}}return _},createFile:(s,u,f,p,m)=>{var b=we.join2(typeof s=="string"?s:y.getPath(s),u),_=y.getMode(p,m);return y.create(b,_)},createDataFile:(s,u,f,p,m,b)=>{var _=u;s&&(s=typeof s=="string"?s:y.getPath(s),_=u?we.join2(s,u):s);var S=y.getMode(p,m),E=y.create(_,S);if(f){if(typeof f=="string"){for(var A=new Array(f.length),U=0,I=f.length;U<I;++U)A[U]=f.charCodeAt(U);f=A}y.chmod(E,S|146);var B=y.open(E,577);y.write(B,f,0,f.length,0,b),y.close(B),y.chmod(E,S)}return E},createDevice:(s,u,f,p)=>{var m=we.join2(typeof s=="string"?s:y.getPath(s),u),b=y.getMode(!!f,!!p);y.createDevice.major||(y.createDevice.major=64);var _=y.makedev(y.createDevice.major++,0);return y.registerDevice(_,{open:S=>{S.seekable=!1},close:S=>{p&&p.buffer&&p.buffer.length&&p(10)},read:(S,E,A,U,I)=>{for(var B=0,V=0;V<U;V++){var q;try{q=f()}catch{throw new y.ErrnoError(29)}if(q===void 0&&B===0)throw new y.ErrnoError(6);if(q==null)break;B++,E[A+V]=q}return B&&(S.node.timestamp=Date.now()),B},write:(S,E,A,U,I)=>{for(var B=0;B<U;B++)try{p(E[A+B])}catch{throw new y.ErrnoError(29)}return U&&(S.node.timestamp=Date.now()),B}}),y.mkdev(m,b,_)},forceLoadFile:s=>{if(s.isDevice||s.isFolder||s.link||s.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(w)try{s.contents=Nn(w(s.url),!0),s.usedBytes=s.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(s,u,f,p,m)=>{function b(){this.lengthKnown=!1,this.chunks=[]}if(b.prototype.get=function(V){if(!(V>this.length-1||V<0)){var q=V%this.chunkSize,Se=V/this.chunkSize|0;return this.getter(Se)[q]}},b.prototype.setDataGetter=function(V){this.getter=V},b.prototype.cacheLength=function(){var V=new XMLHttpRequest;if(V.open("HEAD",f,!1),V.send(null),!(V.status>=200&&V.status<300||V.status===304))throw new Error("Couldn't load "+f+". Status: "+V.status);var q=Number(V.getResponseHeader("Content-length")),Se,Le=(Se=V.getResponseHeader("Accept-Ranges"))&&Se==="bytes",Ie=(Se=V.getResponseHeader("Content-Encoding"))&&Se==="gzip",F=1024*1024;Le||(F=q);var X=(Pe,rt)=>{if(Pe>rt)throw new Error("invalid range ("+Pe+", "+rt+") or no bytes requested!");if(rt>q-1)throw new Error("only "+q+" bytes available! programmer error!");var Ge=new XMLHttpRequest;if(Ge.open("GET",f,!1),q!==F&&Ge.setRequestHeader("Range","bytes="+Pe+"-"+rt),Ge.responseType="arraybuffer",Ge.overrideMimeType&&Ge.overrideMimeType("text/plain; charset=x-user-defined"),Ge.send(null),!(Ge.status>=200&&Ge.status<300||Ge.status===304))throw new Error("Couldn't load "+f+". Status: "+Ge.status);return Ge.response!==void 0?new Uint8Array(Ge.response||[]):Nn(Ge.responseText||"",!0)},He=this;He.setDataGetter(Pe=>{var rt=Pe*F,Ge=(Pe+1)*F-1;if(Ge=Math.min(Ge,q-1),typeof He.chunks[Pe]>"u"&&(He.chunks[Pe]=X(rt,Ge)),typeof He.chunks[Pe]>"u")throw new Error("doXHR failed!");return He.chunks[Pe]}),(Ie||!q)&&(F=q=1,q=this.getter(0).length,F=q,z("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=q,this._chunkSize=F,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var _=new b;Object.defineProperties(_,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:_}}else var S={isDevice:!1,url:f};var E=y.createFile(s,u,S,p,m);S.contents?E.contents=S.contents:S.url&&(E.contents=null,E.url=S.url),Object.defineProperties(E,{usedBytes:{get:function(){return this.contents.length}}});var A={},U=Object.keys(E.stream_ops);U.forEach(B=>{var V=E.stream_ops[B];A[B]=function(){return y.forceLoadFile(E),V.apply(null,arguments)}});function I(B,V,q,Se,Le){var Ie=B.node.contents;if(Le>=Ie.length)return 0;var F=Math.min(Ie.length-Le,Se);if(Ie.slice)for(var X=0;X<F;X++)V[q+X]=Ie[Le+X];else for(var X=0;X<F;X++)V[q+X]=Ie.get(Le+X);return F}return A.read=(B,V,q,Se,Le)=>(y.forceLoadFile(E),I(B,V,q,Se,Le)),A.mmap=(B,V,q,Se,Le)=>{y.forceLoadFile(E);var Ie=ns(V);if(!Ie)throw new y.ErrnoError(48);return I(B,ge,Ie,V,q),{ptr:Ie,allocated:!0}},E.stream_ops=A,E},createPreloadedFile:(s,u,f,p,m,b,_,S,E,A)=>{var U=u?Mt.resolve(we.join2(s,u)):s;function I(B){function V(q){A&&A(),S||y.createDataFile(s,u,q,p,m,E),b&&b(),Tn()}Browser.handledByPreloadPlugin(B,U,V,()=>{_&&_(),Tn()})||V(B)}Oo(),typeof f=="string"?Cl(f,B=>I(B),_):I(f)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(b){return f(b)}m.onupgradeneeded=()=>{z("creating db");var b=m.result;b.createObjectStore(y.DB_STORE_NAME)},m.onsuccess=()=>{var b=m.result,_=b.transaction([y.DB_STORE_NAME],"readwrite"),S=_.objectStore(y.DB_STORE_NAME),E=0,A=0,U=s.length;function I(){A==0?u():f()}s.forEach(B=>{var V=S.put(y.analyzePath(B).object.contents,B);V.onsuccess=()=>{E++,E+A==U&&I()},V.onerror=()=>{A++,E+A==U&&I()}}),_.onerror=f},m.onerror=f},loadFilesFromDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(b){return f(b)}m.onupgradeneeded=f,m.onsuccess=()=>{var b=m.result;try{var _=b.transaction([y.DB_STORE_NAME],"readonly")}catch(B){f(B);return}var S=_.objectStore(y.DB_STORE_NAME),E=0,A=0,U=s.length;function I(){A==0?u():f()}s.forEach(B=>{var V=S.get(B);V.onsuccess=()=>{y.analyzePath(B).exists&&y.unlink(B),y.createDataFile(we.dirname(B),we.basename(B),V.result,!0,!0,!0),E++,E+A==U&&I()},V.onerror=()=>{A++,E+A==U&&I()}}),_.onerror=f},m.onerror=f}},be={DEFAULT_POLLMASK:5,calculateAt:function(s,u,f){if(we.isAbs(u))return u;var p;if(s===-100)p=y.cwd();else{var m=y.getStream(s);if(!m)throw new y.ErrnoError(8);p=m.path}if(u.length==0){if(!f)throw new y.ErrnoError(44);return p}return we.join2(p,u)},doStat:function(s,u,f){try{var p=s(u)}catch(m){if(m&&m.node&&we.normalize(u)!==we.normalize(y.getPath(m.node)))return-54;throw m}return L[f>>2]=p.dev,L[f+4>>2]=0,L[f+8>>2]=p.ino,L[f+12>>2]=p.mode,L[f+16>>2]=p.nlink,L[f+20>>2]=p.uid,L[f+24>>2]=p.gid,L[f+28>>2]=p.rdev,L[f+32>>2]=0,Ot=[p.size>>>0,($e=p.size,+Math.abs($e)>=1?$e>0?(Math.min(+Math.floor($e/4294967296),4294967295)|0)>>>0:~~+Math.ceil(($e-+(~~$e>>>0))/4294967296)>>>0:0)],L[f+40>>2]=Ot[0],L[f+44>>2]=Ot[1],L[f+48>>2]=4096,L[f+52>>2]=p.blocks,L[f+56>>2]=p.atime.getTime()/1e3|0,L[f+60>>2]=0,L[f+64>>2]=p.mtime.getTime()/1e3|0,L[f+68>>2]=0,L[f+72>>2]=p.ctime.getTime()/1e3|0,L[f+76>>2]=0,Ot=[p.ino>>>0,($e=p.ino,+Math.abs($e)>=1?$e>0?(Math.min(+Math.floor($e/4294967296),4294967295)|0)>>>0:~~+Math.ceil(($e-+(~~$e>>>0))/4294967296)>>>0:0)],L[f+80>>2]=Ot[0],L[f+84>>2]=Ot[1],0},doMsync:function(s,u,f,p,m){var b=Re.slice(s,s+f);y.msync(u,b,m,f,p)},varargs:void 0,get:function(){be.varargs+=4;var s=L[be.varargs-4>>2];return s},getStr:function(s){var u=re(s);return u},getStreamFromFD:function(s){var u=y.getStream(s);if(!u)throw new y.ErrnoError(8);return u}};function Pl(s,u){try{return s=be.getStr(s),y.chmod(s,u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function kl(s,u,f,p){try{if(u=be.getStr(u),u=be.calculateAt(s,u),f&-8)return-28;var m=y.lookupPath(u,{follow:!0}),b=m.node;if(!b)return-44;var _="";return f&4&&(_+="r"),f&2&&(_+="w"),f&1&&(_+="x"),_&&y.nodePermissions(b,_)?-2:0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function Al(s){return L[Ts()>>2]=s,s}function Rl(s,u,f){be.varargs=f;try{var p=be.getStreamFromFD(s);switch(u){case 0:{var m=be.get();if(m<0)return-28;var b;return b=y.createStream(p,m),b.fd}case 1:case 2:return 0;case 3:return p.flags;case 4:{var m=be.get();return p.flags|=m,0}case 5:{var m=be.get(),_=0;return Oe[m+_>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Al(28),-1;default:return-28}}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function Ol(s,u){try{var f=be.getStreamFromFD(s);return be.doStat(y.stat,f.path,u)}catch(p){if(typeof y>"u"||!(p instanceof y.ErrnoError))throw p;return-p.errno}}function Ml(s,u,f){be.varargs=f;try{var p=be.getStreamFromFD(s);switch(u){case 21509:case 21505:return p.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return p.tty?0:-59;case 21519:{if(!p.tty)return-59;var m=be.get();return L[m>>2]=0,0}case 21520:return p.tty?-28:-59;case 21531:{var m=be.get();return y.ioctl(p,u,m)}case 21523:return p.tty?0:-59;case 21524:return p.tty?0:-59;default:Xt("bad ioctl syscall "+u)}}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return-b.errno}}function Dl(s,u){try{return s=be.getStr(s),be.doStat(y.lstat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Fl(s,u,f,p){try{u=be.getStr(u);var m=p&256,b=p&4096;return p=p&-4353,u=be.calculateAt(s,u,b),be.doStat(m?y.lstat:y.stat,u,f)}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function Bl(s,u,f,p){be.varargs=p;try{u=be.getStr(u),u=be.calculateAt(s,u);var m=p?be.get():0;return y.open(u,f,m).fd}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return-b.errno}}function Ll(s,u){try{return s=be.getStr(s),be.doStat(y.stat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Ul(s,u,f,p,m){}function Cn(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function Il(){for(var s=new Array(256),u=0;u<256;++u)s[u]=String.fromCharCode(u);os=s}var os=void 0;function qe(s){for(var u="",f=s;Re[f];)u+=os[Re[f++]];return u}var Er={},fr={},Pn={},Gl=48,Nl=57;function kn(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var u=s.charCodeAt(0);return u>=Gl&&u<=Nl?"_"+s:s}function An(s,u){return s=kn(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(u)}function Do(s,u){var f=An(u,function(p){this.name=u,this.message=p;var m=new Error(p).stack;m!==void 0&&(this.stack=this.toString()+`
`+m.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},f}var xr=void 0;function _e(s){throw new xr(s)}var is=void 0;function Rn(s){throw new is(s)}function hr(s,u,f){s.forEach(function(S){Pn[S]=u});function p(S){var E=f(S);E.length!==s.length&&Rn("Mismatched type converter count");for(var A=0;A<s.length;++A)xt(s[A],E[A])}var m=new Array(u.length),b=[],_=0;u.forEach((S,E)=>{fr.hasOwnProperty(S)?m[E]=fr[S]:(b.push(S),Er.hasOwnProperty(S)||(Er[S]=[]),Er[S].push(()=>{m[E]=fr[S],++_,_===b.length&&p(m)}))}),b.length===0&&p(m)}function xt(s,u,f={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");var p=u.name;if(s||_e('type "'+p+'" must have a positive integer typeid pointer'),fr.hasOwnProperty(s)){if(f.ignoreDuplicateRegistrations)return;_e("Cannot register type '"+p+"' twice")}if(fr[s]=u,delete Pn[s],Er.hasOwnProperty(s)){var m=Er[s];delete Er[s],m.forEach(b=>b())}}function Vl(s,u,f,p,m){var b=Cn(f);u=qe(u),xt(s,{name:u,fromWireType:function(_){return!!_},toWireType:function(_,S){return S?p:m},argPackAdvance:8,readValueFromPointer:function(_){var S;if(f===1)S=ge;else if(f===2)S=Oe;else if(f===4)S=L;else throw new TypeError("Unknown boolean type size: "+u);return this.fromWireType(S[_>>b])},destructorFunction:null})}function Hl(s){if(!(this instanceof Yt)||!(s instanceof Yt))return!1;for(var u=this.$$.ptrType.registeredClass,f=this.$$.ptr,p=s.$$.ptrType.registeredClass,m=s.$$.ptr;u.baseClass;)f=u.upcast(f),u=u.baseClass;for(;p.baseClass;)m=p.upcast(m),p=p.baseClass;return u===p&&f===m}function zl(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function Fo(s){function u(f){return f.$$.ptrType.registeredClass.name}_e(u(s)+" instance already deleted")}var Bo=!1;function ss(s){}function Wl(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function as(s){s.count.value-=1;var u=s.count.value===0;u&&Wl(s)}function us(s,u,f){if(u===f)return s;if(f.baseClass===void 0)return null;var p=us(s,u,f.baseClass);return p===null?null:f.downcast(p)}var ls={};function $l(){return Object.keys(Wr).length}function Xl(){var s=[];for(var u in Wr)Wr.hasOwnProperty(u)&&s.push(Wr[u]);return s}var Hr=[];function Lo(){for(;Hr.length;){var s=Hr.pop();s.$$.deleteScheduled=!1,s.delete()}}var zr=void 0;function Yl(s){zr=s,Hr.length&&zr&&zr(Lo)}function jl(){r.getInheritedInstanceCount=$l,r.getLiveInheritedInstances=Xl,r.flushPendingDeletes=Lo,r.setDelayFunction=Yl}var Wr={};function ql(s,u){for(u===void 0&&_e("ptr should not be undefined");s.baseClass;)u=s.upcast(u),s=s.baseClass;return u}function Zl(s,u){return u=ql(s,u),Wr[u]}function On(s,u){(!u.ptrType||!u.ptr)&&Rn("makeClassHandle requires ptr and ptrType");var f=!!u.smartPtrType,p=!!u.smartPtr;return f!==p&&Rn("Both smartPtrType and smartPtr must be specified"),u.count={value:1},$r(Object.create(s,{$$:{value:u}}))}function Kl(s){var u=this.getPointee(s);if(!u)return this.destructor(s),null;var f=Zl(this.registeredClass,u);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=u,f.$$.smartPtr=s,f.clone();var p=f.clone();return this.destructor(s),p}function m(){return this.isSmartPointer?On(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:s}):On(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var b=this.registeredClass.getActualType(u),_=ls[b];if(!_)return m.call(this);var S;this.isConst?S=_.constPointerType:S=_.pointerType;var E=us(u,this.registeredClass,S.registeredClass);return E===null?m.call(this):this.isSmartPointer?On(S.registeredClass.instancePrototype,{ptrType:S,ptr:E,smartPtrType:this,smartPtr:s}):On(S.registeredClass.instancePrototype,{ptrType:S,ptr:E})}function $r(s){return typeof FinalizationRegistry>"u"?($r=u=>u,s):(Bo=new FinalizationRegistry(u=>{as(u.$$)}),$r=u=>{var f=u.$$,p=!!f.smartPtr;if(p){var m={$$:f};Bo.register(u,m,u)}return u},ss=u=>Bo.unregister(u),$r(s))}function Ql(){if(this.$$.ptr||Fo(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=$r(Object.create(Object.getPrototypeOf(this),{$$:{value:zl(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function Jl(){this.$$.ptr||Fo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_e("Object already scheduled for deletion"),ss(this),as(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ec(){return!this.$$.ptr}function tc(){return this.$$.ptr||Fo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_e("Object already scheduled for deletion"),Hr.push(this),Hr.length===1&&zr&&zr(Lo),this.$$.deleteScheduled=!0,this}function rc(){Yt.prototype.isAliasOf=Hl,Yt.prototype.clone=Ql,Yt.prototype.delete=Jl,Yt.prototype.isDeleted=ec,Yt.prototype.deleteLater=tc}function Yt(){}function Uo(s,u,f){if(s[u].overloadTable===void 0){var p=s[u];s[u]=function(){return s[u].overloadTable.hasOwnProperty(arguments.length)||_e("Function '"+f+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[u].overloadTable+")!"),s[u].overloadTable[arguments.length].apply(this,arguments)},s[u].overloadTable=[],s[u].overloadTable[p.argCount]=p}}function cs(s,u,f){r.hasOwnProperty(s)?((f===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[f]!==void 0)&&_e("Cannot register public name '"+s+"' twice"),Uo(r,s,s),r.hasOwnProperty(f)&&_e("Cannot register multiple overloads of a function with the same number of arguments ("+f+")!"),r[s].overloadTable[f]=u):(r[s]=u,f!==void 0&&(r[s].numArguments=f))}function nc(s,u,f,p,m,b,_,S){this.name=s,this.constructor=u,this.instancePrototype=f,this.rawDestructor=p,this.baseClass=m,this.getActualType=b,this.upcast=_,this.downcast=S,this.pureVirtualFunctions=[]}function Io(s,u,f){for(;u!==f;)u.upcast||_e("Expected null or instance of "+f.name+", got an instance of "+u.name),s=u.upcast(s),u=u.baseClass;return s}function oc(s,u){if(u===null)return this.isReference&&_e("null is not a valid "+this.name),0;u.$$||_e('Cannot pass "'+zo(u)+'" as a '+this.name),u.$$.ptr||_e("Cannot pass deleted object as a pointer of type "+this.name);var f=u.$$.ptrType.registeredClass,p=Io(u.$$.ptr,f,this.registeredClass);return p}function ic(s,u){var f;if(u===null)return this.isReference&&_e("null is not a valid "+this.name),this.isSmartPointer?(f=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,f),f):0;u.$$||_e('Cannot pass "'+zo(u)+'" as a '+this.name),u.$$.ptr||_e("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&u.$$.ptrType.isConst&&_e("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);var p=u.$$.ptrType.registeredClass;if(f=Io(u.$$.ptr,p,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&_e("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?f=u.$$.smartPtr:_e("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:f=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)f=u.$$.smartPtr;else{var m=u.clone();f=this.rawShare(f,Ve.toHandle(function(){m.delete()})),s!==null&&s.push(this.rawDestructor,f)}break;default:_e("Unsupporting sharing policy")}return f}function sc(s,u){if(u===null)return this.isReference&&_e("null is not a valid "+this.name),0;u.$$||_e('Cannot pass "'+zo(u)+'" as a '+this.name),u.$$.ptr||_e("Cannot pass deleted object as a pointer of type "+this.name),u.$$.ptrType.isConst&&_e("Cannot convert argument of type "+u.$$.ptrType.name+" to parameter type "+this.name);var f=u.$$.ptrType.registeredClass,p=Io(u.$$.ptr,f,this.registeredClass);return p}function Mn(s){return this.fromWireType(Y[s>>2])}function ac(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function uc(s){this.rawDestructor&&this.rawDestructor(s)}function lc(s){s!==null&&s.delete()}function cc(){Dt.prototype.getPointee=ac,Dt.prototype.destructor=uc,Dt.prototype.argPackAdvance=8,Dt.prototype.readValueFromPointer=Mn,Dt.prototype.deleteObject=lc,Dt.prototype.fromWireType=Kl}function Dt(s,u,f,p,m,b,_,S,E,A,U){this.name=s,this.registeredClass=u,this.isReference=f,this.isConst=p,this.isSmartPointer=m,this.pointeeType=b,this.sharingPolicy=_,this.rawGetPointee=S,this.rawConstructor=E,this.rawShare=A,this.rawDestructor=U,!m&&u.baseClass===void 0?p?(this.toWireType=oc,this.destructorFunction=null):(this.toWireType=sc,this.destructorFunction=null):this.toWireType=ic}function fc(s,u,f){r.hasOwnProperty(s)||Rn("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&f!==void 0?r[s].overloadTable[f]=u:(r[s]=u,r[s].argCount=f)}function hc(s,u,f){var p=r["dynCall_"+s];return f&&f.length?p.apply(null,[u].concat(f)):p.call(null,u)}function pc(s,u,f){return s.includes("j")?hc(s,u,f):xn(u).apply(null,f)}function dc(s,u){var f=[];return function(){return f.length=0,Object.assign(f,arguments),pc(s,u,f)}}function pr(s,u){s=qe(s);function f(){return s.includes("j")?dc(s,u):xn(u)}var p=f();return typeof p!="function"&&_e("unknown function pointer with signature "+s+": "+u),p}var fs=void 0;function hs(s){var u=Es(s),f=qe(u);return Lt(u),f}function Dn(s,u){var f=[],p={};function m(b){if(!p[b]&&!fr[b]){if(Pn[b]){Pn[b].forEach(m);return}f.push(b),p[b]=!0}}throw u.forEach(m),new fs(s+": "+f.map(hs).join([", "]))}function vc(s,u,f,p,m,b,_,S,E,A,U,I,B){U=qe(U),b=pr(m,b),S&&(S=pr(_,S)),A&&(A=pr(E,A)),B=pr(I,B);var V=kn(U);cs(V,function(){Dn("Cannot construct "+U+" due to unbound types",[p])}),hr([s,u,f],p?[p]:[],function(q){q=q[0];var Se,Le;p?(Se=q.registeredClass,Le=Se.instancePrototype):Le=Yt.prototype;var Ie=An(V,function(){if(Object.getPrototypeOf(this)!==F)throw new xr("Use 'new' to construct "+U);if(X.constructor_body===void 0)throw new xr(U+" has no accessible constructor");var Ge=X.constructor_body[arguments.length];if(Ge===void 0)throw new xr("Tried to invoke ctor of "+U+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(X.constructor_body).toString()+") parameters instead!");return Ge.apply(this,arguments)}),F=Object.create(Le,{constructor:{value:Ie}});Ie.prototype=F;var X=new nc(U,Ie,F,B,Se,b,S,A),He=new Dt(U,X,!0,!1,!1),Pe=new Dt(U+"*",X,!1,!1,!1),rt=new Dt(U+" const*",X,!1,!0,!1);return ls[s]={pointerType:Pe,constPointerType:rt},fc(V,Ie),[He,Pe,rt]})}function ps(s,u){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var f=An(s.name||"unknownFunctionName",function(){});f.prototype=s.prototype;var p=new f,m=s.apply(p,u);return m instanceof Object?m:p}function ds(s){for(;s.length;){var u=s.pop(),f=s.pop();f(u)}}function Go(s,u,f,p,m){var b=u.length;b<2&&_e("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var _=u[1]!==null&&f!==null,S=!1,E=1;E<u.length;++E)if(u[E]!==null&&u[E].destructorFunction===void 0){S=!0;break}for(var A=u[0].name!=="void",U="",I="",E=0;E<b-2;++E)U+=(E!==0?", ":"")+"arg"+E,I+=(E!==0?", ":"")+"arg"+E+"Wired";var B="return function "+kn(s)+"("+U+`) {
if (arguments.length !== `+(b-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(b-2)+` args!');
}
`;S&&(B+=`var destructors = [];
`);var V=S?"destructors":"null",q=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Se=[_e,p,m,ds,u[0],u[1]];_&&(B+="var thisWired = classParam.toWireType("+V+`, this);
`);for(var E=0;E<b-2;++E)B+="var arg"+E+"Wired = argType"+E+".toWireType("+V+", arg"+E+"); // "+u[E+2].name+`
`,q.push("argType"+E),Se.push(u[E+2]);if(_&&(I="thisWired"+(I.length>0?", ":"")+I),B+=(A?"var rv = ":"")+"invoker(fn"+(I.length>0?", ":"")+I+`);
`,S)B+=`runDestructors(destructors);
`;else for(var E=_?1:2;E<u.length;++E){var Le=E===1?"thisWired":"arg"+(E-2)+"Wired";u[E].destructorFunction!==null&&(B+=Le+"_dtor("+Le+"); // "+u[E].name+`
`,q.push(Le+"_dtor"),Se.push(u[E].destructorFunction))}A&&(B+=`var ret = retType.fromWireType(rv);
return ret;
`),B+=`}
`,q.push(B);var Ie=ps(Function,q).apply(null,Se);return Ie}function No(s,u){for(var f=[],p=0;p<s;p++)f.push(L[(u>>2)+p]);return f}function gc(s,u,f,p,m,b,_){var S=No(f,p);u=qe(u),b=pr(m,b),hr([],[s],function(E){E=E[0];var A=E.name+"."+u;function U(){Dn("Cannot call "+A+" due to unbound types",S)}u.startsWith("@@")&&(u=Symbol[u.substring(2)]);var I=E.registeredClass.constructor;return I[u]===void 0?(U.argCount=f-1,I[u]=U):(Uo(I,u,A),I[u].overloadTable[f-1]=U),hr([],S,function(B){var V=[B[0],null].concat(B.slice(1)),q=Go(A,V,null,b,_);return I[u].overloadTable===void 0?(q.argCount=f-1,I[u]=q):I[u].overloadTable[f-1]=q,[]}),[]})}function mc(s,u,f,p,m,b){Te(u>0);var _=No(u,f);m=pr(p,m),hr([],[s],function(S){S=S[0];var E="constructor "+S.name;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[u-1]!==void 0)throw new xr("Cannot register multiple constructors with identical number of parameters ("+(u-1)+") for class '"+S.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return S.registeredClass.constructor_body[u-1]=()=>{Dn("Cannot construct "+S.name+" due to unbound types",_)},hr([],_,function(A){return A.splice(1,0,null),S.registeredClass.constructor_body[u-1]=Go(E,A,null,m,b),[]}),[]})}function yc(s,u,f,p,m,b,_,S){var E=No(f,p);u=qe(u),b=pr(m,b),hr([],[s],function(A){A=A[0];var U=A.name+"."+u;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),S&&A.registeredClass.pureVirtualFunctions.push(u);function I(){Dn("Cannot call "+U+" due to unbound types",E)}var B=A.registeredClass.instancePrototype,V=B[u];return V===void 0||V.overloadTable===void 0&&V.className!==A.name&&V.argCount===f-2?(I.argCount=f-2,I.className=A.name,B[u]=I):(Uo(B,u,U),B[u].overloadTable[f-2]=I),hr([],E,function(q){var Se=Go(U,q,A,b,_);return B[u].overloadTable===void 0?(Se.argCount=f-2,B[u]=Se):B[u].overloadTable[f-2]=Se,[]}),[]})}var Vo=[],gt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ho(s){s>4&&--gt[s].refcount===0&&(gt[s]=void 0,Vo.push(s))}function wc(){for(var s=0,u=5;u<gt.length;++u)gt[u]!==void 0&&++s;return s}function bc(){for(var s=5;s<gt.length;++s)if(gt[s]!==void 0)return gt[s];return null}function _c(){r.count_emval_handles=wc,r.get_first_emval=bc}var Ve={toValue:s=>(s||_e("Cannot use deleted val. handle = "+s),gt[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var u=Vo.length?Vo.pop():gt.length;return gt[u]={refcount:1,value:s},u}}}};function Sc(s,u){u=qe(u),xt(s,{name:u,fromWireType:function(f){var p=Ve.toValue(f);return Ho(f),p},toWireType:function(f,p){return Ve.toHandle(p)},argPackAdvance:8,readValueFromPointer:Mn,destructorFunction:null})}function Tc(s,u,f){switch(u){case 0:return function(p){var m=f?ge:Re;return this.fromWireType(m[p])};case 1:return function(p){var m=f?Oe:it;return this.fromWireType(m[p>>1])};case 2:return function(p){var m=f?L:Y;return this.fromWireType(m[p>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Ec(s,u,f,p){var m=Cn(f);u=qe(u);function b(){}b.values={},xt(s,{name:u,constructor:b,fromWireType:function(_){return this.constructor.values[_]},toWireType:function(_,S){return S.value},argPackAdvance:8,readValueFromPointer:Tc(u,m,p),destructorFunction:null}),cs(u,b)}function Fn(s,u){var f=fr[s];return f===void 0&&_e(u+" has unknown type "+hs(s)),f}function xc(s,u,f){var p=Fn(s,"enum");u=qe(u);var m=p.constructor,b=Object.create(p.constructor.prototype,{value:{value:f},constructor:{value:An(p.name+"_"+u,function(){})}});m.values[f]=b,m[u]=b}function zo(s){if(s===null)return"null";var u=typeof s;return u==="object"||u==="array"||u==="function"?s.toString():""+s}function Cc(s,u){switch(u){case 2:return function(f){return this.fromWireType(pe[f>>2])};case 3:return function(f){return this.fromWireType(Yi[f>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Pc(s,u,f){var p=Cn(f);u=qe(u),xt(s,{name:u,fromWireType:function(m){return m},toWireType:function(m,b){return b},argPackAdvance:8,readValueFromPointer:Cc(u,p),destructorFunction:null})}function kc(s,u,f){switch(u){case 0:return f?function(m){return ge[m]}:function(m){return Re[m]};case 1:return f?function(m){return Oe[m>>1]}:function(m){return it[m>>1]};case 2:return f?function(m){return L[m>>2]}:function(m){return Y[m>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function Ac(s,u,f,p,m){u=qe(u);var b=Cn(f),_=I=>I;if(p===0){var S=32-8*f;_=I=>I<<S>>>S}var E=u.includes("unsigned"),A=(I,B)=>{},U;E?U=function(I,B){return A(B,this.name),B>>>0}:U=function(I,B){return A(B,this.name),B},xt(s,{name:u,fromWireType:_,toWireType:U,argPackAdvance:8,readValueFromPointer:kc(u,b,p!==0),destructorFunction:null})}function Rc(s,u,f){var p=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],m=p[u];function b(_){_=_>>2;var S=Y,E=S[_],A=S[_+1];return new m(et,A,E)}f=qe(f),xt(s,{name:f,fromWireType:b,argPackAdvance:8,readValueFromPointer:b},{ignoreDuplicateRegistrations:!0})}function Oc(s,u){u=qe(u);var f=u==="std::string";xt(s,{name:u,fromWireType:function(p){var m=Y[p>>2],b;if(f)for(var _=p+4,S=0;S<=m;++S){var E=p+4+S;if(S==m||Re[E]==0){var A=E-_,U=re(_,A);b===void 0?b=U:(b+=String.fromCharCode(0),b+=U),_=E+1}}else{for(var I=new Array(m),S=0;S<m;++S)I[S]=String.fromCharCode(Re[p+4+S]);b=I.join("")}return Lt(p),b},toWireType:function(p,m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));var b,_=typeof m=="string";_||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int8Array||_e("Cannot pass non-string to std::string"),f&&_?b=()=>ce(m):b=()=>m.length;var S=b(),E=Bt(4+S+1);if(Y[E>>2]=S,f&&_)de(m,E+4,S+1);else if(_)for(var A=0;A<S;++A){var U=m.charCodeAt(A);U>255&&(Lt(E),_e("String has UTF-16 code units that do not fit in 8 bits")),Re[E+4+A]=U}else for(var A=0;A<S;++A)Re[E+4+A]=m[A];return p!==null&&p.push(Lt,E),E},argPackAdvance:8,readValueFromPointer:Mn,destructorFunction:function(p){Lt(p)}})}function Mc(s,u,f){f=qe(f);var p,m,b,_,S;u===2?(p=ue,m=ve,_=he,b=()=>it,S=1):u===4&&(p=Ce,m=nt,_=dt,b=()=>Y,S=2),xt(s,{name:f,fromWireType:function(E){for(var A=Y[E>>2],U=b(),I,B=E+4,V=0;V<=A;++V){var q=E+4+V*u;if(V==A||U[q>>S]==0){var Se=q-B,Le=p(B,Se);I===void 0?I=Le:(I+=String.fromCharCode(0),I+=Le),B=q+u}}return Lt(E),I},toWireType:function(E,A){typeof A!="string"&&_e("Cannot pass non-string to C++ string type "+f);var U=_(A),I=Bt(4+U+u);return Y[I>>2]=U>>S,m(A,I+4,U+u),E!==null&&E.push(Lt,I),I},argPackAdvance:8,readValueFromPointer:Mn,destructorFunction:function(E){Lt(E)}})}function Dc(s,u){u=qe(u),xt(s,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:function(){},toWireType:function(f,p){}})}function Fc(){return Date.now()}var Bc=!0;function Lc(){return Bc}function Uc(s,u,f){s=Ve.toValue(s),u=Fn(u,"emval::as");var p=[],m=Ve.toHandle(p);return L[f>>2]=m,u.toWireType(p,s)}function Ic(s){var u=[];return L[s>>2]=Ve.toHandle(u),u}var Gc={};function Wo(s){var u=Gc[s];return u===void 0?qe(s):u}var $o=[];function Nc(s,u,f,p,m){return s=$o[s],u=Ve.toValue(u),f=Wo(f),s(u,f,Ic(p),m)}function vs(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Vc(s){return s===0?Ve.toHandle(vs()):(s=Wo(s),Ve.toHandle(vs()[s]))}function Hc(s){var u=$o.length;return $o.push(s),u}function zc(s,u){for(var f=new Array(s),p=0;p<s;++p)f[p]=Fn(Y[u+p*Z>>2],"parameter "+p);return f}var gs=[];function Wc(s,u){var f=zc(s,u),p=f[0],m=p.name+"_$"+f.slice(1).map(function(q){return q.name}).join("_")+"$",b=gs[m];if(b!==void 0)return b;for(var _=["retType"],S=[p],E="",A=0;A<s-1;++A)E+=(A!==0?", ":"")+"arg"+A,_.push("argType"+A),S.push(f[1+A]);for(var U=kn("methodCaller_"+m),I="return function "+U+`(handle, name, destructors, args) {
`,B=0,A=0;A<s-1;++A)I+="    var arg"+A+" = argType"+A+".readValueFromPointer(args"+(B?"+"+B:"")+`);
`,B+=f[A+1].argPackAdvance;I+="    var rv = handle[name]("+E+`);
`;for(var A=0;A<s-1;++A)f[A+1].deleteObject&&(I+="    argType"+A+".deleteObject(arg"+A+`);
`);p.isVoid||(I+=`    return retType.toWireType(destructors, rv);
`),I+=`};
`,_.push(I);var V=ps(Function,_).apply(null,S);return b=Hc(V),gs[m]=b,b}function $c(s,u){return s=Ve.toValue(s),u=Ve.toValue(u),Ve.toHandle(s[u])}function Xc(s){s>4&&(gt[s].refcount+=1)}function Yc(s){return Ve.toHandle(Wo(s))}function jc(s){var u=Ve.toValue(s);ds(u),Ho(s)}function qc(s,u,f){s=Ve.toValue(s),u=Ve.toValue(u),f=Ve.toValue(f),s[u]=f}function Zc(s,u){s=Fn(s,"_emval_take_value");var f=s.readValueFromPointer(u);return Ve.toHandle(f)}function Kc(s){return s=Ve.toValue(s),Ve.toHandle(typeof s)}function Qc(s,u){var f=new Date(L[s>>2]*1e3);L[u>>2]=f.getSeconds(),L[u+4>>2]=f.getMinutes(),L[u+8>>2]=f.getHours(),L[u+12>>2]=f.getDate(),L[u+16>>2]=f.getMonth(),L[u+20>>2]=f.getFullYear()-1900,L[u+24>>2]=f.getDay();var p=new Date(f.getFullYear(),0,1),m=(f.getTime()-p.getTime())/(1e3*60*60*24)|0;L[u+28>>2]=m,L[u+36>>2]=-(f.getTimezoneOffset()*60);var b=new Date(f.getFullYear(),6,1).getTimezoneOffset(),_=p.getTimezoneOffset(),S=(b!=_&&f.getTimezoneOffset()==Math.min(_,b))|0;L[u+32>>2]=S}function Jc(s,u,f,p,m,b){try{var _=y.getStream(m);_&&(f&2&&be.doMsync(s,_,u,p,b),y.munmap(_))}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function ef(s,u,f){var p=new Date().getFullYear(),m=new Date(p,0,1),b=new Date(p,6,1),_=m.getTimezoneOffset(),S=b.getTimezoneOffset(),E=Math.max(_,S);L[s>>2]=E*60,L[u>>2]=Number(_!=S);function A(q){var Se=q.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Se?Se[1]:"GMT"}var U=A(m),I=A(b),B=ot(U),V=ot(I);S<_?(Y[f>>2]=B,Y[f+4>>2]=V):(Y[f>>2]=V,Y[f+4>>2]=B)}function Xo(s,u,f){Xo.called||(Xo.called=!0,ef(s,u,f))}function tf(){Xt("")}function ms(){return 2147483648}function rf(){return ms()}function nf(s,u,f){Re.copyWithin(s,u,u+f)}function of(s){try{return ie.grow(s-et.byteLength+65535>>>16),ji(ie.buffer),1}catch{}}function sf(s){var u=Re.length;s=s>>>0;var f=ms();if(s>f)return!1;let p=(E,A)=>E+(A-E%A)%A;for(var m=1;m<=4;m*=2){var b=u*(1+.2/m);b=Math.min(b,s+100663296);var _=Math.min(f,p(Math.max(s,b),65536)),S=of(_);if(S)return!0}return!1}var Yo={};function af(){return a||"./this.program"}function Xr(){if(!Xr.strings){var s=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:s,_:af()};for(var f in Yo)Yo[f]===void 0?delete u[f]:u[f]=Yo[f];var p=[];for(var f in u)p.push(f+"="+u[f]);Xr.strings=p}return Xr.strings}function uf(s,u){var f=0;return Xr().forEach(function(p,m){var b=u+f;Y[s+m*4>>2]=b,Rt(p,b),f+=p.length+1}),0}function lf(s,u){var f=Xr();Y[s>>2]=f.length;var p=0;return f.forEach(function(m){p+=m.length+1}),Y[u>>2]=p,0}function cf(s){zf(s)}function ff(s){try{var u=be.getStreamFromFD(s);return y.close(u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return f.errno}}function hf(s,u,f,p){for(var m=0,b=0;b<f;b++){var _=Y[u>>2],S=Y[u+4>>2];u+=8;var E=y.read(s,ge,_,S,p);if(E<0)return-1;if(m+=E,E<S)break}return m}function pf(s,u,f,p){try{var m=be.getStreamFromFD(s),b=hf(m,u,f);return L[p>>2]=b,0}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return _.errno}}function df(s,u){return u+2097152>>>0<4194305-!!s?(s>>>0)+u*4294967296:NaN}function vf(s,u,f,p,m){try{var b=df(u,f);if(isNaN(b))return 61;var _=be.getStreamFromFD(s);return y.llseek(_,b,p),Ot=[_.position>>>0,($e=_.position,+Math.abs($e)>=1?$e>0?(Math.min(+Math.floor($e/4294967296),4294967295)|0)>>>0:~~+Math.ceil(($e-+(~~$e>>>0))/4294967296)>>>0:0)],L[m>>2]=Ot[0],L[m+4>>2]=Ot[1],_.getdents&&b===0&&p===0&&(_.getdents=null),0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return S.errno}}function gf(s,u,f,p){for(var m=0,b=0;b<f;b++){var _=Y[u>>2],S=Y[u+4>>2];u+=8;var E=y.write(s,ge,_,S,p);if(E<0)return-1;m+=E}return m}function mf(s,u,f,p){try{var m=be.getStreamFromFD(s),b=gf(m,u,f);return Y[p>>2]=b,0}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return _.errno}}function ys(s){for(var u=s.split("."),f=0;f<4;f++){var p=Number(u[f]);if(isNaN(p))return null;u[f]=p}return(u[0]|u[1]<<8|u[2]<<16|u[3]<<24)>>>0}function Yr(s){return parseInt(s)}function yf(s){var u,f,p,m,b=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,_=[];if(!b.test(s))return null;if(s==="::")return[0,0,0,0,0,0,0,0];for(s.startsWith("::")?s=s.replace("::","Z:"):s=s.replace("::",":Z:"),s.indexOf(".")>0?(s=s.replace(new RegExp("[.]","g"),":"),u=s.split(":"),u[u.length-4]=Yr(u[u.length-4])+Yr(u[u.length-3])*256,u[u.length-3]=Yr(u[u.length-2])+Yr(u[u.length-1])*256,u=u.slice(0,u.length-2)):u=s.split(":"),p=0,m=0,f=0;f<u.length;f++)if(typeof u[f]=="string")if(u[f]==="Z"){for(m=0;m<8-u.length+1;m++)_[f+m]=0;p=m-1}else _[f+p]=xs(parseInt(u[f],16));else _[f+p]=u[f];return[_[1]<<16|_[0],_[3]<<16|_[2],_[5]<<16|_[4],_[7]<<16|_[6]]}var jt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(s){var u=ys(s);if(u!==null||(u=yf(s),u!==null))return s;var f;if(jt.address_map.addrs[s])f=jt.address_map.addrs[s];else{var p=jt.address_map.id++;Te(p<65535,"exceeded max address mappings of 65535"),f="172.29."+(p&255)+"."+(p&65280),jt.address_map.names[f]=s,jt.address_map.addrs[s]=f}return f},lookup_addr:function(s){return jt.address_map.names[s]?jt.address_map.names[s]:null}};function wf(s){var u=Bt(20),f=Bt(s.length+1);de(s,f,s.length+1),Y[u>>2]=f;var p=Bt(4);Y[p>>2]=0,Y[u+4>>2]=p;var m=2;L[u+8>>2]=m,L[u+12>>2]=4;var b=Bt(12);return Y[b>>2]=b+8,Y[b+4>>2]=0,L[b+8>>2]=ys(jt.lookup_name(s)),Y[u+16>>2]=b,u}function bf(s){return wf(re(s))}function _f(s){var u=s.getExtension("ANGLE_instanced_arrays");if(u)return s.vertexAttribDivisor=function(f,p){u.vertexAttribDivisorANGLE(f,p)},s.drawArraysInstanced=function(f,p,m,b){u.drawArraysInstancedANGLE(f,p,m,b)},s.drawElementsInstanced=function(f,p,m,b,_){u.drawElementsInstancedANGLE(f,p,m,b,_)},1}function Sf(s){var u=s.getExtension("OES_vertex_array_object");if(u)return s.createVertexArray=function(){return u.createVertexArrayOES()},s.deleteVertexArray=function(f){u.deleteVertexArrayOES(f)},s.bindVertexArray=function(f){u.bindVertexArrayOES(f)},s.isVertexArray=function(f){return u.isVertexArrayOES(f)},1}function Tf(s){var u=s.getExtension("WEBGL_draw_buffers");if(u)return s.drawBuffers=function(f,p){u.drawBuffersWEBGL(f,p)},1}function Ef(s){return!!(s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw"))}var De={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(u){De.lastError||(De.lastError=u)},getNewId:function(s){for(var u=De.counter++,f=s.length;f<u;f++)s[f]=null;return u},getSource:function(s,u,f,p){for(var m="",b=0;b<u;++b){var _=p?L[p+b*4>>2]:-1;m+=re(L[f+b*4>>2],_<0?void 0:_)}return m},createContext:function(s,u){if(!s.getContextSafariWebGL2Fixed){let b=function(_,S){var E=s.getContextSafariWebGL2Fixed(_,S);return _=="webgl"==E instanceof WebGLRenderingContext?E:null};var m=b;s.getContextSafariWebGL2Fixed=s.getContext,s.getContext=b}var f=s.getContext("webgl",u);if(!f)return 0;var p=De.registerContext(f,u);return p},registerContext:function(s,u){var f=De.getNewId(De.contexts),p={handle:f,attributes:u,version:u.majorVersion,GLctx:s};return s.canvas&&(s.canvas.GLctxObject=p),De.contexts[f]=p,(typeof u.enableExtensionsByDefault>"u"||u.enableExtensionsByDefault)&&De.initExtensions(p),f},makeContextCurrent:function(s){return De.currentContext=De.contexts[s],r.ctx=Qe=De.currentContext&&De.currentContext.GLctx,!(s&&!Qe)},getContext:function(s){return De.contexts[s]},deleteContext:function(s){De.currentContext===De.contexts[s]&&(De.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(De.contexts[s].GLctx.canvas),De.contexts[s]&&De.contexts[s].GLctx.canvas&&(De.contexts[s].GLctx.canvas.GLctxObject=void 0),De.contexts[s]=null},initExtensions:function(s){if(s||(s=De.currentContext),!s.initExtensionsDone){s.initExtensionsDone=!0;var u=s.GLctx;_f(u),Sf(u),Tf(u),u.disjointTimerQueryExt=u.getExtension("EXT_disjoint_timer_query"),Ef(u);var f=u.getSupportedExtensions()||[];f.forEach(function(p){!p.includes("lose_context")&&!p.includes("debug")&&u.getExtension(p)})}}};function ws(s){return s.slice(-1)=="]"&&s.lastIndexOf("[")}function xf(s){var u=s.uniformLocsById,f=s.uniformSizeAndIdsByName,p,m;if(!u)for(s.uniformLocsById=u={},s.uniformArrayNamesById={},p=0;p<Qe.getProgramParameter(s,35718);++p){var b=Qe.getActiveUniform(s,p),_=b.name,S=b.size,E=ws(_),A=E>0?_.slice(0,E):_,U=s.uniformIdCounter;for(s.uniformIdCounter+=S,f[A]=[S,U],m=0;m<S;++m)u[U]=m,s.uniformArrayNamesById[U++]=A}}function Cf(s,u){if(u=re(u),s=De.programs[s]){xf(s);var f=s.uniformLocsById,p=0,m=u,b=ws(u);b>0&&(p=Yr(u.slice(b+1))>>>0,m=u.slice(0,b));var _=s.uniformSizeAndIdsByName[m];if(_&&p<_[0]&&(p+=_[1],f[p]=f[p]||Qe.getUniformLocation(s,u)))return p}else De.recordError(1281);return-1}function qt(s){var u=Qe.currentProgram;if(u){var f=u.uniformLocsById[s];return typeof f=="number"&&(u.uniformLocsById[s]=f=Qe.getUniformLocation(u,u.uniformArrayNamesById[s]+(f>0?"["+f+"]":""))),f}else De.recordError(1282)}function Pf(s,u){Qe.uniform1f(qt(s),u)}function kf(s,u){Qe.uniform1i(qt(s),u)}var Bn=[];function Af(s,u,f){if(u<=144)for(var p=Bn[2*u-1],m=0;m<2*u;m+=2)p[m]=pe[f+4*m>>2],p[m+1]=pe[f+(4*m+4)>>2];else var p=pe.subarray(f>>2,f+u*8>>2);Qe.uniform2fv(qt(s),p)}var Ln=[];function Rf(s,u,f){if(u<=144)for(var p=Ln[2*u-1],m=0;m<2*u;m+=2)p[m]=L[f+4*m>>2],p[m+1]=L[f+(4*m+4)>>2];else var p=L.subarray(f>>2,f+u*8>>2);Qe.uniform2iv(qt(s),p)}function Of(s,u,f){if(u<=96)for(var p=Bn[3*u-1],m=0;m<3*u;m+=3)p[m]=pe[f+4*m>>2],p[m+1]=pe[f+(4*m+4)>>2],p[m+2]=pe[f+(4*m+8)>>2];else var p=pe.subarray(f>>2,f+u*12>>2);Qe.uniform3fv(qt(s),p)}function Mf(s,u,f){if(u<=96)for(var p=Ln[3*u-1],m=0;m<3*u;m+=3)p[m]=L[f+4*m>>2],p[m+1]=L[f+(4*m+4)>>2],p[m+2]=L[f+(4*m+8)>>2];else var p=L.subarray(f>>2,f+u*12>>2);Qe.uniform3iv(qt(s),p)}function Df(s,u,f){if(u<=72){var p=Bn[4*u-1],m=pe;f>>=2;for(var b=0;b<4*u;b+=4){var _=f+b;p[b]=m[_],p[b+1]=m[_+1],p[b+2]=m[_+2],p[b+3]=m[_+3]}}else var p=pe.subarray(f>>2,f+u*16>>2);Qe.uniform4fv(qt(s),p)}function Ff(s,u,f){if(u<=72)for(var p=Ln[4*u-1],m=0;m<4*u;m+=4)p[m]=L[f+4*m>>2],p[m+1]=L[f+(4*m+4)>>2],p[m+2]=L[f+(4*m+8)>>2],p[m+3]=L[f+(4*m+12)>>2];else var p=L.subarray(f>>2,f+u*16>>2);Qe.uniform4iv(qt(s),p)}function Bf(s){}function Un(s){return s%4===0&&(s%100!==0||s%400===0)}function Lf(s,u){for(var f=0,p=0;p<=u;f+=s[p++]);return f}var bs=[31,29,31,30,31,30,31,31,30,31,30,31],_s=[31,28,31,30,31,30,31,31,30,31,30,31];function Uf(s,u){for(var f=new Date(s.getTime());u>0;){var p=Un(f.getFullYear()),m=f.getMonth(),b=(p?bs:_s)[m];if(u>b-f.getDate())u-=b-f.getDate()+1,f.setDate(1),m<11?f.setMonth(m+1):(f.setMonth(0),f.setFullYear(f.getFullYear()+1));else return f.setDate(f.getDate()+u),f}return f}function If(s,u,f,p){var m=L[p+40>>2],b={tm_sec:L[p>>2],tm_min:L[p+4>>2],tm_hour:L[p+8>>2],tm_mday:L[p+12>>2],tm_mon:L[p+16>>2],tm_year:L[p+20>>2],tm_wday:L[p+24>>2],tm_yday:L[p+28>>2],tm_isdst:L[p+32>>2],tm_gmtoff:L[p+36>>2],tm_zone:m?re(m):""},_=re(f),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var E in S)_=_.replace(new RegExp(E,"g"),S[E]);var A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],U=["January","February","March","April","May","June","July","August","September","October","November","December"];function I(F,X,He){for(var Pe=typeof F=="number"?F.toString():F||"";Pe.length<X;)Pe=He[0]+Pe;return Pe}function B(F,X){return I(F,X,"0")}function V(F,X){function He(rt){return rt<0?-1:rt>0?1:0}var Pe;return(Pe=He(F.getFullYear()-X.getFullYear()))===0&&(Pe=He(F.getMonth()-X.getMonth()))===0&&(Pe=He(F.getDate()-X.getDate())),Pe}function q(F){switch(F.getDay()){case 0:return new Date(F.getFullYear()-1,11,29);case 1:return F;case 2:return new Date(F.getFullYear(),0,3);case 3:return new Date(F.getFullYear(),0,2);case 4:return new Date(F.getFullYear(),0,1);case 5:return new Date(F.getFullYear()-1,11,31);case 6:return new Date(F.getFullYear()-1,11,30)}}function Se(F){var X=Uf(new Date(F.tm_year+1900,0,1),F.tm_yday),He=new Date(X.getFullYear(),0,4),Pe=new Date(X.getFullYear()+1,0,4),rt=q(He),Ge=q(Pe);return V(rt,X)<=0?V(Ge,X)<=0?X.getFullYear()+1:X.getFullYear():X.getFullYear()-1}var Le={"%a":function(F){return A[F.tm_wday].substring(0,3)},"%A":function(F){return A[F.tm_wday]},"%b":function(F){return U[F.tm_mon].substring(0,3)},"%B":function(F){return U[F.tm_mon]},"%C":function(F){var X=F.tm_year+1900;return B(X/100|0,2)},"%d":function(F){return B(F.tm_mday,2)},"%e":function(F){return I(F.tm_mday,2," ")},"%g":function(F){return Se(F).toString().substring(2)},"%G":function(F){return Se(F)},"%H":function(F){return B(F.tm_hour,2)},"%I":function(F){var X=F.tm_hour;return X==0?X=12:X>12&&(X-=12),B(X,2)},"%j":function(F){return B(F.tm_mday+Lf(Un(F.tm_year+1900)?bs:_s,F.tm_mon-1),3)},"%m":function(F){return B(F.tm_mon+1,2)},"%M":function(F){return B(F.tm_min,2)},"%n":function(){return`
`},"%p":function(F){return F.tm_hour>=0&&F.tm_hour<12?"AM":"PM"},"%S":function(F){return B(F.tm_sec,2)},"%t":function(){return"	"},"%u":function(F){return F.tm_wday||7},"%U":function(F){var X=F.tm_yday+7-F.tm_wday;return B(Math.floor(X/7),2)},"%V":function(F){var X=Math.floor((F.tm_yday+7-(F.tm_wday+6)%7)/7);if((F.tm_wday+371-F.tm_yday-2)%7<=2&&X++,X){if(X==53){var Pe=(F.tm_wday+371-F.tm_yday)%7;Pe!=4&&(Pe!=3||!Un(F.tm_year))&&(X=1)}}else{X=52;var He=(F.tm_wday+7-F.tm_yday-1)%7;(He==4||He==5&&Un(F.tm_year%400-1))&&X++}return B(X,2)},"%w":function(F){return F.tm_wday},"%W":function(F){var X=F.tm_yday+7-(F.tm_wday+6)%7;return B(Math.floor(X/7),2)},"%y":function(F){return(F.tm_year+1900).toString().substring(2)},"%Y":function(F){return F.tm_year+1900},"%z":function(F){var X=F.tm_gmtoff,He=X>=0;return X=Math.abs(X)/60,X=X/60*100+X%60,(He?"+":"-")+String("0000"+X).slice(-4)},"%Z":function(F){return F.tm_zone},"%%":function(){return"%"}};_=_.replace(/%%/g,"\0\0");for(var E in Le)_.includes(E)&&(_=_.replace(new RegExp(E,"g"),Le[E](b)));_=_.replace(/\0\0/g,"%");var Ie=Nn(_,!1);return Ie.length>u?0:(vt(Ie,s),Ie.length-1)}function Gf(s,u,f,p){return If(s,u,f,p)}var Ss=function(s,u,f,p){s||(s=this),this.parent=s,this.mount=s.mount,this.mounted=null,this.id=y.nextInode++,this.name=u,this.mode=f,this.node_ops={},this.stream_ops={},this.rdev=p},In=365,Gn=146;Object.defineProperties(Ss.prototype,{read:{get:function(){return(this.mode&In)===In},set:function(s){s?this.mode|=In:this.mode&=~In}},write:{get:function(){return(this.mode&Gn)===Gn},set:function(s){s?this.mode|=Gn:this.mode&=~Gn}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=Ss,y.staticInit(),Il(),xr=r.BindingError=Do(Error,"BindingError"),is=r.InternalError=Do(Error,"InternalError"),rc(),jl(),cc(),fs=r.UnboundTypeError=Do(Error,"UnboundTypeError"),_c();for(var Qe,Nf=new Float32Array(288),Ft=0;Ft<288;++Ft)Bn[Ft]=Nf.subarray(0,Ft+1);for(var Vf=new Int32Array(288),Ft=0;Ft<288;++Ft)Ln[Ft]=Vf.subarray(0,Ft+1);function Nn(s,u,f){var p=f>0?f:ce(s)+1,m=new Array(p),b=le(s,m,0,m.length);return u&&(m.length=b),m}var Hf={ga:yl,k:wl,b:bl,c:Sl,Q:Pl,R:kl,q:Rl,K:Ol,U:Ml,I:Dl,H:Fl,u:Bl,J:Ll,z:Ul,W:Vl,d:vc,f:gc,e:mc,a:yc,V:Sc,g:Ec,h:xc,v:Pc,j:Ac,i:Rc,w:Oc,r:Mc,X:Dc,N:Fc,M:Lc,m:Uc,ka:Nc,x:Ho,la:Vc,ja:Wc,s:$c,E:Xc,ia:Yc,ma:jc,n:qc,l:Zc,na:Kc,O:Qc,D:Jc,P:Xo,t:tf,C:rf,L:nf,o:sf,F:uf,G:lf,fa:cf,p:ff,T:pf,y:vf,S:mf,ha:bf,ea:Cf,ca:Pf,da:kf,_:Af,ba:Rf,Z:Of,aa:Mf,Y:Df,$:Ff,A:Bf,B:Gf};ml(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Bt=r._malloc=function(){return(Bt=r._malloc=r.asm.qa).apply(null,arguments)},Lt=r._free=function(){return(Lt=r._free=r.asm.ra).apply(null,arguments)},Ts=r.___errno_location=function(){return(Ts=r.___errno_location=r.asm.sa).apply(null,arguments)},Es=r.___getTypeName=function(){return(Es=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var xs=r._htons=function(){return(xs=r._htons=r.asm.wa).apply(null,arguments)},Cs=r._emscripten_builtin_memalign=function(){return(Cs=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},Ps=r.___cxa_is_pointer_type=function(){return(Ps=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=y;var Vn;function jo(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}Vr=function s(){Vn||qo(),Vn||(Vr=s)};function qo(s){if(lr>0||(ll(),lr>0))return;function u(){Vn||(Vn=!0,r.calledRun=!0,!me&&(cl(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),fl()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),u()},1)):u()}r.run=qo;function zf(s,u){Wf(s)}function Wf(s){Ji()||(r.onExit&&r.onExit(s),me=!0),l(s,new jo(s))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return qo(),r.ready}})(),Yf="/cad-os/assets/replicad_single-b4564eab.wasm";const hi={library:null},jf=t=>{hi.library=t},G=()=>{if(!hi.library)throw new Error("oppencascade has not been loaded");return hi.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const Zr=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class at{constructor(e){this.oc=G(),e&&Zr.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(Zr.unregister(this._wrapped),this._wrapped.delete()),Zr.register(this,e,e),this._wrapped=e}delete(){var e;Zr.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const Ae=()=>{function t(e){return Zr.register(t,e),e}return t},ze=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},Na=2147483647,yt=Math.PI/180,Jr=180/Math.PI,Zo=t=>Math.round(t*1e3)/1e3,nn=(t,e,r)=>{const n=G(),o=st(t),i=Ht(e);let a;if(r){const l=Ht(r);a=new n.gp_Ax3_3(o,i,l),l.delete()}else a=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),a},fn=(t,e,r)=>{const n=G(),o=st(t),i=Ht(e);let a;if(r){const l=Ht(r);a=new n.gp_Ax2_2(o,i,l),l.delete()}else a=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),a},en=(t,e)=>{const r=G(),n=st(t),o=Ht(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},qf=(t=[0,0,0])=>{const e=G();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof M)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class M extends at{constructor(e=[0,0,0]){super(qf(e))}get repr(){return`x: ${Zo(this.x)}, y: ${Zo(this.y)}, z: ${Zo(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new M(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new M(this.wrapped.Subtracted(e.wrapped))}add(e){return new M(this.wrapped.Added(e.wrapped))}multiply(e){return new M(this.wrapped.Multiplied(e))}normalized(){return new M(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*Jr}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),a=this.sub(i);return o.delete(),i.delete(),a}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=en(r,n);return this.wrapped.Rotate(o,e*yt),o.delete(),this}}const Zf={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function Kf(t){return t==="X"||t==="Y"||t==="Z"?Zf[t]:t}function st(t){const e=new M(t),r=e.toPnt();return e.delete(),r}function Ht(t){const e=new M(t),r=e.toDir();return e.delete(),r}class br extends at{constructor(e){const r=G();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new M(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Ht(n),i=st(r),a=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(a,e*yt),a.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=Ae();let o,i;if(typeof e=="string"){const l=n(Va(e,r));o=l.origin,i=l.zDir}else e instanceof Je?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const a=n(fn(o,i));return this.wrapped.SetMirror_3(a),this}scale(e,r){const n=st(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=Ae(),o=n(e==="reference"?new this.oc.gp_Ax3_1:nn(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:nn(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=st(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Je{constructor(e,r=null,n=[0,0,1]){this.oc=G();const o=new M(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new M(r);else{const a=nn(e,o);i=new M(a.XDirection()),a.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new M(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Je(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new M(e),r}translate(e,r=0,n=0){const o=new M(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=Kf(r),o=new M(this.zDir).rotate(e,[0,0,0],n),i=new M(this.xDir).rotate(e,[0,0,0],n);return new Je(this.origin,i,o)}rotate2DAxes(e){const r=new M(this.xDir).rotate(e,[0,0,0],this.zDir);return new Je(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=nn(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new br,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new br,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new M(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new M(r);return r.delete(),n}}const Qf={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},Va=(t,e=[0,0,0])=>{const r=Qf[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new Je(n,r.xDir,r.normal)};let Jf=class extends at{constructor(e){const r=G();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new M(e).repr} - ${new M(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},a={current:0};return this.wrapped.Get(e,r,n,o,i,a),[[e.current,r.current,n.current],[o.current,i.current,a.current]]}get center(){const[[e,r,n],[o,i,a]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(a-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function ir(t="XY",e=[0,0,0]){return t instanceof Je?t.clone():Va(t,e)}function eh(t,e,r=[0,0,0],n=[0,0,1]){const o=new br;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function th(t,e){const r=new br;r.translate(e);const n=r.transform(t);return r.delete(),n}function rh(t,e,r){const n=new br;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function nh(t,e,r){const n=new br;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function no(t){return Array.isArray(t)&&t.length===2}let Hn=null;const ks=t=>{if(Hn&&!t)return Hn;const r=G().GeomAbs_CurveType;return Hn=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),Hn},hn=t=>{let e=ks().get(t);if(e||(e=ks(!0).get(t)),!e)throw new Error("unknown type");return e};function oh(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function ih(t){return Array.from(Array(t).keys())}function Or(t){const e=Math.min(...t.map(r=>r.length));return ih(e).map(r=>t.map(n=>n[r]))}function oo(t){return Math.round(t*100)/100}const tn=([t,e])=>`(${oo(t)},${oo(e)})`,As=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Ha=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${As(r,e)},${As(n,e)}]`,[r,n]])).values()),je=([t,e])=>{const r=G();return new r.gp_Pnt2d_3(t,e)},sh=([t,e])=>{const r=G();return new r.gp_Dir2d_4(t,e)},za=([t,e])=>{const r=G();return new r.gp_Vec2d_4(t,e)},Fr=(t,e)=>{const r=G(),[n,o]=ze(),i=new r.gp_Ax2d_2(n(je(t)),n(sh(e)));return o(),i};class pn extends at{constructor(e){const r=G();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${tn(e)} - ${tn(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=Ae()(je(e));return!this.wrapped.IsOut_1(n)}}const Ke=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,Br=([t,e],[r,n])=>[t+r,e+n],Ai=([t,e],[r,n])=>[t-r,e-n],pi=([t,e],r)=>[t*r,e*r],Ct=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),ah=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function uh([t,e],[r,n]){return t*n-e*r}const lh=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),ch=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),er=([t,e])=>{const r=Ct([t,e]);return[t/r,e/r]},fh=(t,e,r=[0,0])=>{const[n,o]=t,[i,a]=r,l=n-i,c=o-a,h=Math.sin(e),v=Math.cos(e),g=l*v-c*h,d=l*h+c*v;return[g+i,d+a]},Ar=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},hh=([t,e])=>{const r=Ct([t,e]),n=Math.atan2(e,t);return[r,n]};class Ue extends at{constructor(e){const r=G(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=G(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new pn(r),this._boundingBox}get repr(){return`${this.geomType} ${tn(this.firstPoint)} - ${tn(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=G();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=hn(e.GetType());return e.delete(),r}clone(){return new Ue(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=G(),n=Ae(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(je(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,Ct(e,this.firstPoint),Ct(e,this.lastPoint))}distanceFromCurve(e){const r=G(),n=Ae();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return no(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=G(),o=Ae();let i,a;try{const l=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(je(e)),this.wrapped));i=l.LowerDistance(),a=l.LowerDistanceParameter()}catch{if(Ke(e,this.firstPoint,r))return this.firstParameter;if(Ke(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${tn(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return a}tangentAt(e){const r=G(),[n,o]=ze();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const a=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,a,l);const c=[l.X(),l.Y()];return o(),c}splitAt(e,r=1e-9){const n=G(),o=Ae();let i=e.map(c=>no(c)?this.parameter(c,r):c);i=Array.from(new Map(i.map(c=>[oh(c,-Math.log10(r)),c])).values()).sort((c,h)=>c-h);const a=this.firstParameter,l=this.lastParameter;return a>l&&i.reverse(),Math.abs(i[0]-a)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-l)<r*100&&(i=i.slice(0,-1)),i.length?Or([[a,...i],[...i,l]]).map(([c,h])=>{try{if(this.geomType==="BEZIER_CURVE"){const g=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return g.Segment(c,h),new Ue(new n.Handle_Geom2d_Curve_2(g))}if(this.geomType==="BSPLINE_CURVE"){const g=o(this.adaptor()).BSpline().get(),d=new n.Geom2d_BSplineCurve_1(g.Poles_2(),g.Knots_2(),g.Multiplicities_2(),g.Degree(),g.IsPeriodic());return d.Segment(c,h,r),new Ue(new n.Handle_Geom2d_Curve_2(d))}const v=new n.Geom2d_TrimmedCurve(this.wrapped,c,h,!0,!0);return new Ue(new n.Handle_Geom2d_Curve_2(v))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const Wa=(t,e=1e-4,r="C0",n=200)=>{const o=G(),i=Ae(),a={C0:o.GeomAbs_Shape.GeomAbs_C0,C1:o.GeomAbs_Shape.GeomAbs_C1,C2:o.GeomAbs_Shape.GeomAbs_C2,C3:o.GeomAbs_Shape.GeomAbs_C3},l=i(new o.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,a[r],n,3));return new Ue(l.Curve())},Rs=t=>{if(hn(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=G(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const a=n.NbArcs();if(a)for(let l=1;l<=a;l++){const c=n.Arc(l);yield new Ue(c)}}const i=Array.from(o());return n.delete(),i};function io(t,e={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=Ae();return t.flatMap(n=>{const o=r(n.adaptor()),i=hn(o.GetType());if(i==="ELLIPSE"||i==="CIRCLE"&&Ke(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(i))return n;if(i==="BEZIER_CURVE"){const c=o.Bezier().get().Degree();if([1,2,3].includes(c))return n}if(i==="BSPLINE_CURVE"){const l=Rs(o);return io(l,e)}const a=Wa(o,e.tolerance,e.continuity,e.maxSegments);return io(Rs(r(a.adaptor())),e)})}function*$a(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*ph(t){const e=t.NbSegments();if(!e)return;const r=G();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new Ue(o),i.delete()}}const dn=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=G(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,a;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from($a(o)),a=Array.from(ph(o))}catch(h){throw console.error(t,e,h),new Error("Intersections failed between curves")}finally{o.delete()}const l=a.filter(h=>Ke(h.firstPoint,h.lastPoint,r)).map(h=>h.firstPoint);l.length&&(i.push(...l),a=a.filter(h=>!Ke(h.firstPoint,h.lastPoint,r)));const c=a.flatMap(h=>[h.firstPoint,h.lastPoint]);return{intersections:i,commonSegments:a,commonSegmentsPoints:c}},dh=(t,e=1e-9)=>{const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from($a(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},vn=(t,e)=>{const r=G(),[n,o]=ze(),i=n(new r.GCE2d_MakeSegment_1(n(je(t)),n(je(e)))).Value(),a=new Ue(i);return Ke(a.firstPoint,t)||a.reverse(),o(),a},di=(t,e,r)=>{const n=G(),[o,i]=ze(),a=o(new n.GCE2d_MakeArcOfCircle_4(o(je(t)),o(je(e)),o(je(r)))).Value();i();const l=new Ue(a);return Ke(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},vh=(t,e,r)=>{const n=G(),[o,i]=ze(),a=o(new n.GCE2d_MakeArcOfCircle_5(o(je(t)),o(za(e)),o(je(r)))).Value();i();const l=new Ue(a);return Ke(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},gh=(t,e,r,n,o=[0,0],i,a=!0)=>{const l=G(),[c,h]=ze(),v=c(new l.gp_Elips2d_2(c(Fr(o,i)),t,e,!0)),g=c(new l.GCE2d_MakeArcOfEllipse_1(v,r,n,a)).Value();return h(),new Ue(g)},mh=(t,e,r)=>{const n=G(),[o,i]=ze(),a=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));a.SetValue(1,o(je(t))),e.forEach((c,h)=>{a.SetValue(h+2,o(je(c)))}),a.SetValue(e.length+2,o(je(r)));const l=new n.Geom2d_BezierCurve_1(a);return i(),new Ue(new n.Handle_Geom2d_Curve_2(l))},Xa=(t,e,r)=>{const n=pi(Br(t,e),.5),o=Ct(r,t),i=er(Ai(n,r));return di(t,Br(pi(i,o),r),e)},yh=(t,e,r)=>{const n=er(Ai(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:Br(t,i),lastPoint:Br(e,i)}},vi=(t,e)=>{const r=Ae(),n=t.geomType;if(n==="CIRCLE"){const c=r(r(t.adaptor()).Circle()),h=c.Radius(),v=c.IsDirect()?1:-1,g=e*v,d=h+g;if(d<1e-10){const P=r(c.Location()),D=[P.X(),P.Y()],O=z=>{const[N,Z]=er(Ai(z,D));return Br(z,[g*N,g*Z])};return{collapsed:!0,firstPoint:O(t.firstPoint),lastPoint:O(t.lastPoint)}}const w=G(),T=new w.gp_Circ2d_3(c.Axis(),d),C=new w.Geom2d_Circle_1(T),x=new w.Geom2d_TrimmedCurve(new w.Handle_Geom2d_Curve_2(C),t.firstParameter,t.lastParameter,!0,!0);return new Ue(new w.Handle_Geom2d_Curve_2(x))}if(n==="LINE"){const{firstPoint:c,lastPoint:h}=yh(t.firstPoint,t.lastPoint,e);return vn(c,h)}const o=G(),i=new Ue(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),a=Wa(i.adaptor());return dh(a).length?{collapsed:!0,firstPoint:a.firstPoint,lastPoint:a.lastPoint}:a};function Ya(t,e,r){const n=uh(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,a=vi(t,i),l=vi(e,i);if(!(a instanceof Ue)||!(l instanceof Ue))return null;let c;try{const{intersections:w}=dn(a,l,1e-9);c=w.at(-1)}catch{return null}if(!no(c))return null;const h=c,v=(w,T)=>{const[C,x]=T.tangentAt(h),P=er([-x,C]),D=Br(h,pi(P,i)),O=w.parameter(D,1e-6);return w.splitAt([O])},[g]=v(t,a),[,d]=v(e,l);return{first:g,second:d,center:h}}function gi(t,e,r){const n=Ya(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:a}=n;return[o,Xa(o.lastPoint,i.firstPoint,a),i]}function mi(t,e,r){const n=Ya(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,vn(o.lastPoint,i.firstPoint),i]}class wh{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let a=(i<<1)+1;const l=a+1;let c=this.ids[a],h=this.values[a];const v=this.values[l];if(l<this.length&&v<h&&(a=l,c=this.ids[l],h=v),h>=n)break;this.ids[i]=c,this.values[i]=h,i=a}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Os=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Ko=3;class Ri{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==Ko)throw new Error(`Got v${n>>4} data when expected v${Ko}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Ri(i,o,Os[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,a=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),a+=i,this._levelBounds.push(a*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const l=Os.indexOf(this.ArrayType),c=a*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=a*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+c+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Ko<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new wh}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let a=4*i;const l=this._boxes[a++],c=this._boxes[a++],h=this._boxes[a++],v=this._boxes[a++],g=Math.floor(o*((l+h)/2-this.minX)/e),d=Math.floor(o*((c+v)/2-this.minY)/r);n[i]=_h(g,d)}yi(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,a=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;a<l;){const c=a;let h=1/0,v=1/0,g=-1/0,d=-1/0;for(let w=0;w<this.nodeSize&&a<l;w++)h=Math.min(h,this._boxes[a++]),v=Math.min(v,this._boxes[a++]),g=Math.max(g,this._boxes[a++]),d=Math.max(d,this._boxes[a++]);this._indices[this._pos>>2]=c,this._boxes[this._pos++]=h,this._boxes[this._pos++]=v,this._boxes[this._pos++]=g,this._boxes[this._pos++]=d}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=[],c=[];for(;a!==void 0;){const h=Math.min(a+this.nodeSize*4,Ds(a,this._levelBounds));for(let v=a;v<h;v+=4){if(n<this._boxes[v]||o<this._boxes[v+1]||e>this._boxes[v+2]||r>this._boxes[v+3])continue;const g=this._indices[v>>2]|0;a<this.numItems*4?(i===void 0||i(g))&&c.push(g):l.push(g)}a=l.pop()}return c}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=this._queue,c=[],h=o*o;for(;a!==void 0;){const v=Math.min(a+this.nodeSize*4,Ds(a,this._levelBounds));for(let g=a;g<v;g+=4){const d=this._indices[g>>2]|0,w=Ms(e,this._boxes[g],this._boxes[g+2]),T=Ms(r,this._boxes[g+1],this._boxes[g+3]),C=w*w+T*T;a<this.numItems*4?(i===void 0||i(d))&&l.push((d<<1)+1,C):l.push(d<<1,C)}for(;l.length&&l.peek()&1;)if(l.peekValue()>h||(c.push(l.pop()>>1),c.length===n))return l.clear(),c;a=l.pop()>>1}return l.clear(),c}}function Ms(t,e,r){return t<e?e-t:t<=r?0:t-r}function Ds(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function yi(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const a=t[n+o>>1];let l=n-1,c=o+1;for(;;){do l++;while(t[l]<a);do c--;while(t[c]>a);if(l>=c)break;bh(t,e,r,l,c)}yi(t,e,r,n,c,i),yi(t,e,r,c+1,o,i)}function bh(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const a=4*n,l=4*o,c=e[a],h=e[a+1],v=e[a+2],g=e[a+3];e[a]=e[l],e[a+1]=e[l+1],e[a+2]=e[l+2],e[a+3]=e[l+3],e[l]=c,e[l+1]=h,e[l+2]=v,e[l+3]=g;const d=r[n];r[n]=r[o],r[o]=d}function _h(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),a=r|n>>1,l=r>>1^r,c=o>>1^n&i>>1^o,h=r&o>>1^i>>1^i;r=a,n=l,o=c,i=h,a=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,c^=r&o>>2^n&i>>2,h^=n&o>>2^(r^n)&i>>2,r=a,n=l,o=c,i=h,a=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,c^=r&o>>4^n&i>>4,h^=n&o>>4^(r^n)&i>>4,r=a,n=l,o=c,i=h,c^=r&o>>8^n&i>>8,h^=n&o>>8^(r^n)&i>>8,r=c^c>>1,n=h^h>>1;let v=t^e,g=n|65535^(v|r);return v=(v|v<<8)&16711935,v=(v|v<<4)&252645135,v=(v|v<<2)&858993459,v=(v|v<<1)&1431655765,g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,(g<<1|v)>>>0}const ja=(t,e=1e-7)=>{const r=new Ri(t.length);t.forEach(i=>{const[a,l]=i.firstPoint;r.add(a-e,l-e,a+e,l+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,a)=>{if(o.has(a))return;const l=[i];let c=a;o.add(a);let h=t.length;for(;;){if(h--<0)throw new Error("Infinite loop detected");const v=l[l.length-1].lastPoint,[g,d]=v,w=r.search(g-e,d-e,g+e,d+e),T=D=>Math.abs((c-D)%t.length),C=w.filter(D=>!o.has(D)).map(D=>[t[D],D,T(D)]).sort(([,,D],[,,O])=>T(D)-T(O));if(C.length===0){n.push(l);break}const[x,P]=C[0];l.push(x),o.add(P),c=P}}),n};function mt(t){return Math.round(t*1e5)/1e5}const Qo=t=>`${oo(t.X())} ${oo(t.Y())}`,Sh=(t,e)=>{const r=G(),n=hn(t.GetType()),[o,i]=e,a=`${mt(o)} ${mt(i)}`;if(n==="LINE")return`L ${a}`;if(n==="BEZIER_CURVE"){const l=t.Bezier().get(),c=l.Degree();if(c===1)return`L ${a}`;if(c===2)return`Q ${Qo(l.Pole(2))} ${a}`;if(c===3){const h=Qo(l.Pole(2)),v=Qo(l.Pole(3));return`C ${h} ${v} ${a}`}}if(n==="CIRCLE"){const l=t.Circle(),c=l.Radius(),h=t.FirstParameter(),g=(t.LastParameter()-h)*Jr,d=g!==360?a:`${mt(o)} ${mt(i+1e-4)}`;return`A ${c} ${c} 0 ${Math.abs(g)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${d}`}if(n==="ELLIPSE"){const l=t.Ellipse(),c=l.MajorRadius(),h=l.MinorRadius(),v=t.FirstParameter(),d=(t.LastParameter()-v)*Jr,w=d!==360?a:`${mt(o)} ${mt(i+1e-4)}`,T=new r.gp_Dir2d_1,C=180-l.XAxis().Direction().Angle(T)*Jr;return T.delete(),`A ${mt(c)} ${mt(h)} ${mt(C)} ${Math.abs(d)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${w}`}throw new Error(`Unsupported curve type: ${n}`)},Th={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},so={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class qa{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Eh extends at{constructor(){const e=G();super(new e.Message_ProgressRange_1)}}class Jo extends at{constructor(e){const r=G();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(e.wrapped)}distanceTo(e){this.wrapped.LoadS2(e.wrapped);const r=new Eh;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class Za extends qa{when(e){return this.filters.push(e),this}inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new M(Th[e]):n=new M(e);const o=({normal:i})=>{if(!i)return!1;const a=Math.acos(Math.abs(i.dot(n)));return Math.abs(a-yt*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=co(r),o=new Jo(n),i=({element:a})=>Math.abs(o.distanceTo(a)-e)<1e-6;return this.filters.push(i),this}containsPoint(e){return this.atDistance(0,e)}withinDistance(e,r=[0,0,0]){const n=co(r),o=new Jo(n),i=({element:a})=>o.distanceTo(a)-e<1e-6;return this.filters.push(i),this}inBox(e,r){const n=ke(e,r);return this.inShape(n)}inShape(e){const r=new Jo(e),n=({element:o})=>r.distanceTo(o)<1e-6;return this.filters.push(n),this}}class ao extends Za{clone(){const e=new ao;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&so[e])return this.atAngleWith(so[e],90);if(typeof e!="string"&&e instanceof Je)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Je?ir(e):ir(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.startPoint,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class Oi extends Za{clone(){const e=new Oi;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&so[e])return this.atAngleWith(so[e]);if(typeof e!="string"&&e instanceof Je)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Je?ir(e):ir(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.center,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const xh=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},ei=2*Math.PI,Fs=t=>{const e=t%ei,r=e<0?e+ei:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-ei)};class uo extends qa{clone(){const e=new uo;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>Ke(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(Ct(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return Ke(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,a]=r,l=Math.min(n,i),c=Math.max(n,i),h=Math.min(o,a),v=Math.max(o,a);function g({element:d}){const[w,T]=d.point;return w>=l&&w<=c&&T>=h&&T<=v}return this.filters.push(g),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(Fs(lh(o,i))-Fs(yt*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return xh(e).filter(r=>this.shouldKeep(r))}}const Bs=t=>{const e=G();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},Ch=function*(e,r){const n=G(),o=new n.TopExp_Explorer_2(e,Bs(r),Bs("shape")),i=new Map;for(;o.More();){const a=o.Current(),l=a.HashCode(Na);i.get(l)||(i.set(l,!0),yield a),o.Next()}o.delete()},Ka=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class xo extends at{constructor(e){super(e)}clone(){return new this.constructor(_r(this.wrapped))}get hashCode(){return this.wrapped.HashCode(Na)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=G(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=Fe(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=Fe(th(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Fe(eh(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=Fe(rh(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=Fe(nh(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return Ch(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>_r(r))}get edges(){return this._listTopo("edge").map(e=>new ar(e))}get faces(){return this._listTopo("face").map(e=>new Ir(e))}get wires(){return this._listTopo("wire").map(e=>new Wt(e))}get boundingBox(){const e=new Jf;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const a=[];for(const l of this.faces){const c=l.triangulation(o.length/3);if(!c)continue;const{trianglesIndexes:h,vertices:v,verticesNormals:g}=c;a.push({start:n.length,count:h.length,faceId:l.hashCode}),n=n.concat(h),o=o.concat(v),i=i.concat(g)}return{triangles:n,vertices:o,normals:i,faceGroups:a}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=Ae(),i=new Set,a=[],l=[],c=()=>{const v=a.length;let g=null;return[d=>{g?(a.push(...g),g=[d.X(),d.Y(),d.Z()],a.push(...g)):g=[d.X(),d.Y(),d.Z()]},d=>{l.push({start:v/3,count:(a.length-v)/3,edgeId:d}),i.add(d)}]},h=o(new this.oc.TopLoc_Location_1);for(const v of this.faces){const g=o(this.oc.BRep_Tool.Triangulation(v.wrapped,h,0));if(g.IsNull())continue;const d=g.get();for(const w of v.edges){if(o(w),i.has(w.hashCode))continue;const T=o(new this.oc.TopLoc_Location_1),C=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(w.wrapped,g,T)),x=(n=C==null?void 0:C.get())==null?void 0:n.Nodes();if(!x)continue;o(x);const[P,D]=c();for(let O=x.Lower();O<=x.Upper();O++){const z=o(o(d.Node(x.Value(O))).Transformed(T.Transformation()));P(z)}D(w.hashCode)}}for(const v of this.edges){o(v);const g=v.hashCode;if(i.has(g))continue;const d=o(new this.oc.BRepAdaptor_Curve_2(v.wrapped)),w=o(new this.oc.GCPnts_TangentialDeflection_2(d,e,r,2,1e-9,1e-7)),[T,C]=c();for(let x=0;x<w.NbPoints();x++){const P=o(w.Value(x+1).Transformed(h.Transformation()));T(P)}C(g)}return{lines:a,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const a=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([a],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Qa extends xo{}class Ja extends xo{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new Ph(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(e=0){return this.curve.tangentAt(e)}pointAt(e=0){return this.curve.pointAt(e)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Ph extends at{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return hn(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new M(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new M(e)}_mapParameter(e){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*e}pointAt(e=.5){return new M(this.wrapped.Value(this._mapParameter(e)))}tangentAt(e=.5){const r=this._mapParameter(e),n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new M(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class ar extends Ja{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Wt extends Ja{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=Fe(o.Shape());if(o.delete(),this.delete(),!(i instanceof Wt))throw new Error("Could not offset with a wire");return i}}class kh extends at{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Ir extends xo{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new kh(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:a}=this.UVBounds,l=this._geomAdaptor(),c=new this.oc.gp_Pnt_1,h=e*(o-n)+n,v=r*(a-i)+i;l.D0(h,v,c);const g=new M(c);return l.delete(),c.delete(),g}normalAt(e){let r=0,n=0;const o=Ae();if(e){const h=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),v=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(st(e)),h,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),g={current:0},d={current:0};v.LowerDistanceParameters(g,d),r=g.current,n=d.current}else{const{uMin:h,uMax:v,vMin:g,vMax:d}=this.UVBounds;r=.5*(h+v),n=.5*(g+d)}const i=o(new this.oc.gp_Pnt_1),a=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,a),new M(a)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new M(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Wt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=Ae(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),a={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=o.get(),c=l.NbNodes();a.vertices=new Array(c*3);for(let T=1;T<=c;T++){const C=r(r(l.Node(T)).Transformed(i));a.vertices[(T-1)*3+0]=C.X(),a.vertices[(T-1)*3+1]=C.Y(),a.vertices[(T-1)*3+2]=C.Z()}const h=r(new this.oc.TColgp_Array1OfDir_2(1,c)),v=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,v,h),a.verticesNormals=new Array(h.Length()*3);for(let T=h.Lower();T<=h.Upper();T++){const C=r(r(h.Value(T)).Transformed(i));a.verticesNormals[(T-1)*3+0]=C.X(),a.verticesNormals[(T-1)*3+1]=C.Y(),a.verticesNormals[(T-1)*3+2]=C.Z()}const g=this.orientation,d=l.NbTriangles();a.trianglesIndexes=new Array(d*3);let w=0;for(let T=1;T<=d;T++){const C=r(l.Triangle(T));let x=C.Value(1),P=C.Value(2);const D=C.Value(3);if(g==="backward"){const O=x;x=P,P=O}a.trianglesIndexes[w*3+0]=x-1+e,a.trianglesIndexes[w*3+1]=P-1+e,a.trianglesIndexes[w*3+2]=D-1+e,w++}return a}}class Co extends xo{fuse(e,{optimisation:r="none"}={}){const n=Ae(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Fe(i.Shape());if(!It(a))throw new Error("Could not fuse as a 3d shape");return a}cut(e,{optimisation:r="none"}={}){const n=Ae(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Fe(i.Shape());if(!It(a))throw new Error("Could not cut as a 3d shape");return a}intersect(e){const r=Ae(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=Fe(o.Shape());if(!It(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,a;if(typeof e=="number"){a=e;const w=new Oi;i=typeof r=="function"?r(w):w}else a=e.thickness,i=e.filter;const l=Ae(),c=i.find(this),h=l(new this.oc.TopTools_ListOfShape_1);c.forEach(w=>{h.Append_1(w.wrapped)});const v=l(new this.oc.Message_ProgressRange_1),g=l(new this.oc.BRepOffsetAPI_MakeThickSolid);g.MakeThickSolidByJoin(this.wrapped,h,-a,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,v);const d=Fe(g.Shape());if(!It(d))throw new Error("Could not shell as a 3d shape");return d}_builderIter(e,r){if(typeof e=="number"){let a=0;for(const l of this._iterTopo("edge"))r(e,_r(l)),a+=1;return a}let n,o=null;typeof e=="function"?n=e:(n=a=>e.filter.shouldKeep(a)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const a of this._iterTopo("edge")){const l=_r(a),c=new ar(l),h=n(c);h&&(r(h,l),i+=1),c.delete()}return o&&o(),i}fillet(e,r){const o=Ae()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new ao)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not fillet, no edge was selected");const l=Fe(o.Shape());if(!It(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const o=Ae()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new ao)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not chamfer, no edge was selected");const l=Fe(o.Shape());if(!It(l))throw new Error("Could not chamfer as a 3d shape");return l}}class eu extends Co{}class Tr extends Co{}class tu extends Co{}class ru extends Co{}function It(t){return t instanceof eu||t instanceof Tr||t instanceof tu||t instanceof ru}function Ls(t){return t instanceof Wt}function _r(t){const e=G(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=Ka(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function Fe(t){const r=G().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,Qa],[r.TopAbs_EDGE,ar],[r.TopAbs_WIRE,Wt],[r.TopAbs_FACE,Ir],[r.TopAbs_SHELL,eu],[r.TopAbs_SOLID,Tr],[r.TopAbs_COMPSOLID,tu],[r.TopAbs_COMPOUND,ru]]).get(Ka(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(_r(t))}const nu=(t,e)=>{const r=G();return new ar(new r.BRepBuilderAPI_MakeEdge_3(st(t),st(e)).Edge())},Ah=(t,e=[0,0,0],r=[0,0,1])=>{const n=G(),[o,i]=ze(),a=o(fn(e,r)),l=o(new n.gp_Circ_2(a,t)),c=o(new n.BRepBuilderAPI_MakeEdge_8(l)),h=new ar(c.Edge());return i(),h},Rh=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const a=G(),[l,c]=ze();let h=2*Math.PI;i&&(h=-2*Math.PI);const v=l(new a.Geom2d_Line_3(l(new a.gp_Pnt2d_3(0,0)),l(new a.gp_Dir2d_4(h,t)))),g=e/t,d=v.Value(0),w=v.Value(g*Math.sqrt((2*Math.PI)**2+t**2)),T=l(new a.GCE2d_MakeSegment_1(d,w)),C=new a.Geom_CylindricalSurface_1(l(nn(n,o)),r),x=l(new a.BRepBuilderAPI_MakeEdge_30(l(new a.Handle_Geom2d_Curve_2(T.Value().get())),l(new a.Handle_Geom_Surface_2(C)))).Edge(),P=l(new a.BRepBuilderAPI_MakeWire_2(x)).Wire();return a.BRepLib.BuildCurves3d_2(P),c(),new Wt(P)},on=t=>{const e=G(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(a=>{a instanceof ar&&r.Add_1(a.wrapped),a instanceof Wt&&r.Add_2(a.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const a=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${a.get(o)||"unknown error"}`)}const i=new Wt(r.Wire());return r.delete(),n.delete(),i},Kn=(t,e)=>{const r=G(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new Ir(o)},Oh=(t,e)=>{const r=G(),[n,o]=ze(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new Ir(l)},lo=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=G(),i=fn(r,n),a=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),l=new Tr(a.Shape());return i.delete(),a.delete(),l},Mh=t=>{const e=G(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new Tr(r.Shape());return r.delete(),n};class Dh extends at{constructor(e,r,n){const o=G(),i=Ae(),a=Math.sqrt(e*r/n),l=e/a,c=r/a,h=new o.gp_GTrsf_1;h.SetAffinity_1(en([0,0,0],[0,1,0]),l);const v=i(new o.gp_GTrsf_1);v.SetAffinity_1(en([0,0,0],[0,0,1]),a);const g=i(new o.gp_GTrsf_1);g.SetAffinity_1(en([0,0,0],[1,0,0]),c),h.Multiply(v),h.Multiply(g),super(h)}applyToPoint(e){const r=G(),o=Ae()(e.XYZ());return this.wrapped.Transforms_1(o),new r.gp_Pnt_2(o)}}function Fh(t){const e=[];for(let r=t.LowerRow();r<=t.UpperRow();r++){const n=[];e.push(n);for(let o=t.LowerCol();o<=t.UpperCol();o++){const i=t.Value(r,o);n.push(i)}}return e}const Bh=(t,e,r)=>{const n=G(),o=Ae(),i=o(new n.gp_Sphere_1);i.SetRadius(1);const a=o(new n.Geom_SphericalSurface_2(i)),l=n.GeomConvert.SurfaceToBSplineSurface(a.UReversed()).get(),c=Fh(l.Poles_2()),h=new Dh(t,e,r);c.forEach((g,d)=>{g.forEach((w,T)=>{const C=h.applyToPoint(w);l.SetPole_1(d+1,T+1,C)})});const v=Fe(o(new n.BRepBuilderAPI_MakeShell_2(l.UReversed(),!1)).Shell());return Mi([v])},ke=(t,e)=>{const r=G(),n=new r.BRepPrimAPI_MakeBox_4(st(t),st(e)),o=new Tr(n.Solid());return n.delete(),o},co=t=>{const e=G(),r=st(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new Qa(o)},Pt=t=>{const e=G(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),Fe(n)},Zt=Pt;function Lh(t){const e=G(),r=Ae(),n=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return t.forEach(({wrapped:o})=>{n.Add(o)}),n.Perform(r(new e.Message_ProgressRange_1)),Fe(_r(n.SewedShape()))}function Mi(t){const e=Ae(),r=G(),n=Lh(t),o=Fe(e(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(o instanceof Tr))throw new Error("Could not make a solid of faces and shells");return o}const ou=(t,e)=>{const r=G(),[n,o]=ze(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(h=>{i.Add(h.wrapped)});const a=n(i.Face()),l=n(new r.ShapeFix_Face_2(a));l.FixOrientation_1();const c=l.Face();return o(),new Ir(c)},Uh=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Ih=t=>{let e;t?Uh(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let a;typeof r=="number"?a=Ar(1,r*yt):a=r;let l;return typeof i=="number"?l=Ar(1,i*yt):l=i,{endTangent:a,startFactor:n,endFactor:o,startTangent:l}};function Us(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let a=Math.acos(o/i);return t*n-e*r<0&&(a=-a),a}function Gh([t,e],[r,n],o,i,a,l,c){const h=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const v=Math.sin(a),g=Math.cos(a),d=(t-r)/2,w=(e-n)/2,T=(t+r)/2,C=(e+n)/2,x=g*d+v*w,P=g*w-v*d,D=x*x/(o*o)+P*P/(i*i);D>1&&(o=o*Math.sqrt(D),i=i*Math.sqrt(D));const O=o*i,z=o*P,N=i*x,Z=z*z+N*N;if(!Z)throw Error("start point can not be same as end point");let j=Math.sqrt(Math.abs((O*O-Z)/Z));l==c&&(j=-j);const K=j*z/i,ie=-j*N/o,me=g*K-v*ie+T,Te=v*K+g*ie+C,ye=(x-K)/o,xe=(x+K)/o,re=(P-ie)/i,le=(P+ie)/i,de=Us(1,0,ye,re);let ce=Us(ye,re,-xe,-le);for(;ce>h;)ce-=h;for(;ce<0;)ce+=h;c||(ce-=h);let te=de+ce;for(;te>h;)te-=h;for(;te<0;)te+=h;return{cx:me,cy:Te,startAngle:de,deltaAngle:ce,endAngle:te,clockwise:!!c,rx:o,ry:i}}const iu=(t,e)=>{const r=G(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new Tr(_r(n.Shape()));return n.delete(),o},su=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=G(),i=en(e,r),a=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*yt,!1),l=Fe(a.Shape());if(i.delete(),a.delete(),!It(l))throw new Error("Could not revolve to a 3d shape");return l};function sn(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:a,support:l,forceProfileSpineOthogonality:c}={},h=!1){const v=G(),g=i==="round"?!0:!!c,d=new v.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const C={transformed:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];C&&d.SetTransitionMode(C)}l?d.SetMode_4(l):r&&d.SetMode_1(r),n&&d.SetMode_5(n.wrapped,!1,v.BRepFill_TypeOfContact.BRepFill_NoContact),o?d.SetLaw_1(t.wrapped,o,!!a,g):d.Add_1(t.wrapped,!!a,g);const w=new v.Message_ProgressRange_1;d.Build(w),h||d.MakeSolid();const T=Fe(d.Shape());if(!It(T))throw new Error("Could not sweep to a 3d shape");if(h){const C=Fe(d.FirstShape()),x=Fe(d.LastShape());if(!Ls(C))throw new Error("Could not sweep with one start wire");if(!Ls(x))throw new Error("Could not sweep with one end wire");return d.delete(),[T,C,x]}return d.delete(),w.delete(),T}const au=(t,{profile:e,endFactor:r=1})=>{let n;const o=G();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function uu(t,e,r,n,o=!1){const i=new M(e),a=new M(r),l=nu(i,i.add(a)),c=on([l]),h=n?au(a.Length,n):null;return o?sn(t,c,{law:h},o):sn(t,c,{law:h},o)}function lu(t,e,r,n,o,i=!1){const a=new M(r),l=new M(n),c=nu(a,a.add(l)),h=on([c]),v=360/e*l.Length,g=1,d=Rh(v,l.Length,g,r,n),w=o?au(l.Length,o):null;return i?sn(t,h,{auxiliarySpine:d,law:w},i):sn(t,h,{auxiliarySpine:d,law:w},i)}const Nh=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=G(),[a,l]=ze(),c=a(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&c.AddVertex(a(co(r)).wrapped),t.forEach(g=>c.AddWire(g.wrapped)),n&&c.AddVertex(a(co(n)).wrapped);const h=a(new i.Message_ProgressRange_1);c.Build(h);const v=Fe(c.Shape());if(l(),!It(v))throw new Error("Could not loft to a 3d shape");return v};class Lr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Lr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new M(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new M(e)}face(){let e;return this.baseFace?e=Oh(this.baseFace,this.wire):e=Kn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=Kn(this.wire),o=su(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[a,l]=ze(),c=a(new M(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const g=uu(this.wire,i||this.defaultOrigin,c,n);return l(),this.delete(),g}if(o){const g=lu(this.wire,o,i||this.defaultOrigin,c,n);return l(),this.delete(),g}const h=Kn(this.wire),v=iu(h,c);return l(),this.delete(),v}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),a=e(new Je(n,i,o),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const c=sn(a.wire,this.wire,l);return this.delete(),c}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=Nh(o.map(a=>a.wire),r,n);return o.forEach(a=>a.delete()),i}}const Vh=t=>{const e=G(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new pn(r)};function Hh(t,e){const[r,n]=ze(),o=r(fn(e.origin,e.zDir,e.xDir)),i=G(),a=t.map(l=>{const c=i.GeomLib.To3d(o,l.wrapped);return new ar(new i.BRepBuilderAPI_MakeEdge_24(c).Edge())});return n(),a}const zh=(t,e)=>{const[r,n]=ze(),o=G(),i=t.map(a=>{const l=r(new o.BRepBuilderAPI_MakeEdge_30(a.wrapped,e));return new ar(l.Edge())});return n(),i},cu=(t,e)=>{const r=G();return t.map(o=>e?new Ue(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class gn extends at{transformCurves(e){return cu(e,this.wrapped)}}const fu=(t,e,r=[0,0])=>{const n=G(),o=Fr(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new gn(i)},Wh=t=>{const e=G(),[r,n]=ze(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(za(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new gn(i)},$h=(t,e=[0,0],r="center")=>{const n=G(),[o,i]=ze(),a=new n.gp_Trsf2d_1;r==="center"?a.SetMirror_1(o(je(t))):a.SetMirror_2(o(Fr(e,t)));const l=new n.gp_GTrsf2d_2(a);return i(),new gn(l)},Xh=(t,e=[0,0])=>{const r=G(),[n,o]=ze(),i=new r.gp_Trsf2d_1;i.SetRotation(n(je(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new gn(a)},Yh=(t,e=[0,0])=>{const r=G(),[n,o]=ze(),i=new r.gp_Trsf2d_1;i.SetScale(n(je(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new gn(a)};function jh(t,e,r="original"){const[n,o]=ze(),i=G();let a=n(i.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let c=null;const h=n(Fr([0,0],[0,1])),v=n(Fr([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const w=n(a.get().Cylinder());w.Direct()||(a=a.get().UReversed());const T=w.Radius();c=fu(1/T,[0,1]).wrapped}if(r==="bounds"){if(c=n(new i.gp_GTrsf2d_1),c.SetAffinity(h,l.uMax-l.uMin),l.uMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(new i.gp_XY_2(0,-l.uMin)),c.Multiply(T)}const w=n(new i.gp_GTrsf2d_1);if(w.SetAffinity(v,l.vMax-l.vMin),c.Multiply(w),l.vMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(n(new i.gp_XY_2(0,-l.vMin))),c.Multiply(T)}}const g=cu(t,c),d=zh(g,a);return o(),d}function qh(t,e){const r=G(),o=Ae()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),i=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&i.Reverse(),new Ue(new r.Handle_Geom2d_Curve_2(i))}const Po=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},Di=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${Po(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class ae{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new ae(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=Vh(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=fu(e,r,n).transformCurves(this.curves);return new ae(o)}scale(e,r){const n=r||this.boundingBox.center,o=Yh(e,n).transformCurves(this.curves);return new ae(o)}rotate(e,r){const n=Xh(e*yt,r).transformCurves(this.curves);return new ae(n)}translate(e,r=0){const n=no(e)?e:[e,r],o=Wh(n).transformCurves(this.curves);return new ae(o)}mirror(e,r=[0,0],n="center"){const o=$h(e,r,n).transformCurves(this.curves);return new ae(o)}sketchOnPlane(e,r){const n=e instanceof Je?ir(e):ir(e,r),o=Hh(this.curves,n),i=on(o);return new Lr(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=G(),o=jh(this.curves,e,r),i=on(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const a=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);a.FixEdgeCurves(),a.delete();const l=new Lr(i);if(i.isClosed){const c=l.clone().face();l.defaultOrigin=c.pointOnSurface(.5,.5),l.defaultDirection=c.normalAt(),c.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const c=i.startPoint;l.defaultOrigin=c,l.defaultDirection=e.normalAt(c),l.baseFace=e}return l}toSVGPathD(){const e=Ae(),r=this.clone().mirror([1,0],[0,0],"plane"),o=io(r.curves).flatMap(l=>Sh(e(l.adaptor()),l.lastPoint)),[i,a]=r.curves[0].firstPoint;return`M ${mt(i)} ${mt(a)} ${o.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return Po(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return Di(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1,o=vn(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,l.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return Ke(this.firstPoint,this.lastPoint)}intersects(e){const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class hu{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?mi:gi;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=vn(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*yt,o=Ar(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*yt,[o,i]=Ar(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=er(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(di(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,a]=this.pointer;return this.threePointsArcTo([i+e,a+r],[i+n,a+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,a]=e,l=[(n+i)/2,(o+a)/2],c=[-(a-o),i-n],h=Math.sqrt(c[0]**2+c[1]**2),v=[l[0]+c[0]/h*r,l[1]+c[1]/h*r];return this.saveCurve(di(this._convertToUV(this.pointer),this._convertToUV(v),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=Ct(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(vh(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,a=!1){let l=o,c=r,h=n;r<n&&(l=o+90,c=n,h=r);const v=l*yt,g=K=>Ct(this._convertToUV(K)),d=g(Ar(c,v)),w=g(Ar(h,v+Math.PI/2)),T=er(this._convertToUV(fh([1,0],v))),[,C]=hh(T),{cx:x,cy:P,startAngle:D,endAngle:O,clockwise:z,rx:N,ry:Z}=Gh(this._convertToUV(this.pointer),this._convertToUV(e),d,w,C,i,a),j=gh(N,Z,z?D:O,z?O:D,[x,P],T);return z||j.reverse(),this.saveCurve(j),this.pointer=e,this}ellipse(e,r,n,o,i=0,a=!1,l=!1){const[c,h]=this.pointer;return this.ellipseTo([e+c,r+h],n,o,i,a,l)}halfEllipseTo(e,r,n=!1){const o=ch(e,this.pointer),i=Ct(e,this.pointer);return this.ellipseTo(e,i/2,r,o*Jr,!0,n)}halfEllipse(e,r,n,o=!1){const[i,a]=this.pointer;return this.halfEllipseTo([i+e,a+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(mh(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:a}=Ih(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,c=Ct(this.pointer,e)*.25;let h;o?h=o:l?h=this._convertFromUV(l.tangentAt(1)):h=[1,0],h=er(h);const v=[this.pointer[0]+h[0]*i*c,this.pointer[1]+h[1]*i*c];let g;n==="symmetric"?g=[-h[0],-h[1]]:g=n,g=er(g);const d=[e[0]-g[0]*a*c,e[1]-g[1]*a*c];return this.cubicBezierCurveTo(e,v,d)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?mi:gi;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){Ke(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(Ke(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=Fr(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new Ue(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class Zh extends hu{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new ae(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const Kh=t=>{const e=G(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,a)=>{i.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,a===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=Fe(r.Shape());if(r.delete(),!(o instanceof Ir))throw new Error("Failed to create a face");return o},Qh=(t,e)=>{const r=G(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},Is=t=>{let e,r;try{e=Kn(t[0]),r=t.slice(1)}catch{e=Kh(t),r=t.slice(1).map(o=>Qh(o,e))}return ou(e,r)},Gs=(t,e)=>{const r=[],n=[],o=[];t.forEach(c=>{const[h,v,g]=e(c);r.push(h),n.push(v),o.push(g)});const i=Is(n),a=Is(o);return Mi([i,...r,a])};class Ns{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return Pt(e)}face(){const e=this.outerSketch.face();return ou(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const a=new M(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?Gs(this.sketches,h=>uu(h.wire,i||this.outerSketch.defaultOrigin,a,n,!0)):o?Gs(this.sketches,h=>lu(h.wire,o,i||this.outerSketch.defaultOrigin,a,n,!0)):iu(this.face(),a)}revolve(e,{origin:r}={}){return su(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,a)=>{const l=e.sketches[a];return i.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),Mi(n)}}class Ee{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new Ee(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new pn;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new Ee(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new Ee(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new Ee(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new Ee(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new Ee(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new Ns(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new Ns(n)}toSVGViewBox(e=1){return Po(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return Di(this.toSVGGroup(),this.boundingBox,e)}}class Vs{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof Lr?r.wire:r.wires);return Pt(e)}faces(){const e=this.sketches.map(r=>r.face());return Pt(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return Pt(n)}revolve(e,r){return Pt(this.sketches.map(n=>n.revolve(e,r)))}}class J{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new J(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new pn;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new J(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new J(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new J(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new J(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new J(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new Vs(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new Vs(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return Po(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof ae?n.toSVGPath():n.toSVGGroup());return Di(r.join(`
    `),this.boundingBox,e)}}const Jh=t=>{const e=t.map((o,i)=>t.slice(i+1).map((a,l)=>[l+i+1,a]).filter(([,a])=>!o.boundingBox.isOut(a.boundingBox)).map(([a])=>a)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let a=n[i];a||(a=[],r.push(a)),a.push(t[i]),o.length&&o.forEach(l=>{n[l]=a})}),r},pu=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((a,l)=>r===l?!1:a.isInside(o));return{blueprint:e,isIn:i}}),ep=(t,e)=>t.flatMap(({blueprint:r})=>Fi(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),tp=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=Fi(pu(t.map(({blueprint:o})=>o)));return[r,...n]},Fi=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?ep(e,t):tp(r,t)},mn=t=>{const e=Jh(t).map(pu);return new J(e.flatMap(Fi).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new Ee(r.map(({blueprint:n})=>n)))))},rp=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let i=Math.min(n,t/2),a=Math.min(o,e/2);const l=i&&a;l||(i=0,a=0);const c=i===a,h=new Zh([Math.min(0,-(t/2-i)),-e/2]),v=(g,d)=>{l&&(c?h.tangentArc(g,d):h.ellipse(g,d,i,a,0,!1,!0))};return i<t/2&&h.hLine(t-2*i),v(i,a),a<e/2&&h.vLine(e-2*a),v(-i,a),i<t/2&&h.hLine(-(t-2*i)),v(-i,-a),a<e/2&&h.vLine(-(e-2*a)),v(i,-a),h.close()},Qn=1e-9,Ze=(t,e)=>Ke(t,e,Qn),Kr=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},Hs=(t,e)=>{const r=t.findIndex(i=>Ze(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},zs=(t,e)=>{const r=a=>Ze(e.firstPoint,a.firstPoint)&&Ze(e.lastPoint,a.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Bi(t),n=t.findIndex(r),n===-1))throw console.error(t.map(a=>a.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*Ws(t,e,r){const n=a=>!!e.find(l=>Ze(l,a.lastPoint)),o=a=>!!r.find(l=>Ze(l.firstPoint,a.firstPoint)&&Ze(l.lastPoint,a.lastPoint)||Ze(l.firstPoint,a.lastPoint)&&Ze(l.lastPoint,a.firstPoint));let i=[];for(const a of t)n(a)?(i.push(a),yield i,i=[]):o(a)?(i.length&&(yield i,i=[]),yield[a]):i.push(a);i.length&&(yield i)}const np=t=>t[0].firstPoint,ti=t=>t[t.length-1].lastPoint,Bi=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),op=t=>(t.reverse(),t.map(Bi));function ip(t,e,r){return t.filter(n=>{const o=e.filter(l=>Ze(l.firstPoint,n)||Ze(l.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(l=>r.isInside(Kr(l)));return!(i.every(l=>l)||!i.some(l=>l))})}function sp(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((d,w)=>{e.curves.forEach((T,C)=>{const{intersections:x,commonSegments:P,commonSegmentsPoints:D}=dn(d,T,Qn/100);r.push(...x),o[w].push(...x),i[C].push(...x),n.push(...P),r.push(...D),o[w].push(...D),i[C].push(...D)})}),r=Ha(r,Qn),!r.length||r.length===1)return null;const a=([d,w])=>w.length?d.splitAt(w,Qn/100):[d];let l=Or([t.curves,o]).flatMap(a),c=Or([e.curves,i]).flatMap(a);const h=n.map(d=>[d.firstPoint,d.lastPoint]);if(r=ip(r,l,e),!r.length&&!n.length)return null;if(n.length){const d=n[0];l=zs(l,d),c=zs(c,d)}else{const d=r[0];l=Hs(l,d),c=Hs(c,d)}const v=Array.from(Ws(l,r,n));let g=Array.from(Ws(c,r,n));return(!Ze(ti(g[0]),ti(v[0]))||n.length>0&&g[0].length!==1)&&(g=op(g)),Or([v,g]).map(([d,w])=>{const T=np(d),C=ti(d);return h.find(([x,P])=>Ze(x,T)&&Ze(P,C)||Ze(x,C)&&Ze(x,T))?[d,"same"]:[d,w]})}const ap=t=>{const e=t.map(a=>a.firstPoint);let r=t.map(a=>a.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=Or([e,r]).map(([a,l],c)=>Ze(a,l)?null:c).filter(a=>a!==null);if(!n.length)return[t];const o=Or([n.slice(0,-1),n.slice(1)]).map(([a,l])=>t.slice(a,l));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function Li(t,e,{firstInside:r,secondInside:n}){const o=sp(t,e);if(!o){const h=Kr(t.curves[0]),v=e.isInside(h),g=Kr(e.curves[0]),d=t.isInside(g);return{identical:!1,firstCurveInSecond:v,secondCurveInFirst:d}}if(o.every(([,h])=>h==="same"))return{identical:!0};let i=null,a=null;const l=o.flatMap(([h,v])=>{let g=[],d=0;if(v==="same")return a===1?(a=1,[...h]):a===2||a===0?(a=null,[]):a===null?(i?i=[...i,...h]:i=h,[]):(console.error("weird situation"),[]);const w=Kr(h[0]),T=e.isInside(w);(r==="keep"&&T||r==="remove"&&!T)&&(d+=1,g.push(...h));const C=Kr(v[0]),x=t.isInside(C);if(n==="keep"&&x||n==="remove"&&!x){let P=v;d===1&&(P=Bi(v)),d+=1,g.push(...P)}return a===null&&d===1&&i&&(g=[...i,...g]),d===1&&(a=d,i=null),g}),c=ap(l).filter(h=>h.length).map(h=>new ae(h));return c.length===0?null:c.length===1?c[0]:mn(c)}const ko=(t,e)=>{const r=Li(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof ae||r instanceof J?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new J([t,e])},an=(t,e)=>{const r=Li(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof ae||r instanceof J?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new J([new Ee([t,e])]):t.clone()},Ui=(t,e)=>{const r=Li(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof ae||r instanceof J?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},wi=(t,e)=>{if(t instanceof ae&&e instanceof ae){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:a}=dn(n,o);r.push(...i),r.push(...a)})}),r=Ha(r),r.length>1}if(t instanceof Ee||t instanceof J)return t.blueprints.some(r=>wi(r,e));if(e instanceof Ee||e instanceof J)return e.blueprints.some(r=>wi(t,r));throw new Error("Bug in the generic intersects algorithm")},up=(t,e)=>{if(t instanceof Ee){if(e instanceof ae)return fo(e,t);if(e instanceof Ee)return ho(t,e)}if(e instanceof Ee){if(t instanceof ae)return fo(t,e);if(t instanceof Ee)return ho(t,e)}if(t instanceof ae&&e instanceof ae)return ko(t,e);throw new Error("Bug in the generic fuse algorithm")},$s=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((a,l)=>{const c=i.current,h=o+l+1;if(i.fusedWith.has(h))return;let v=a,g=!1;if(e.has(h)&&(v=e.get(h).current,g=!0),c.boundingBox.isOut(v.boundingBox)||!wi(c,v))return;let d;if(c instanceof J||v instanceof J?d=Nt(c,v):d=up(c,v),!(d instanceof ae||d instanceof Ee)){if(d instanceof J&&d.blueprints.length===2)return;if(d instanceof J&&d.blueprints.length===1)d=d.blueprints[0];else if(!(d instanceof J))throw console.error(d),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(h),i.current=d,g||e.set(h,i)})}),mn(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>Gt(n)))},Gt=t=>t instanceof ae?[t]:t instanceof Ee?t.blueprints:t instanceof J?t.blueprints.flatMap(e=>Gt(e)):[],fo=(t,e)=>{const r=ko(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>an(o,t));return mn([...Gt(r),...n.flatMap(o=>Gt(o))])};function lp(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const ho=(t,e)=>{const r=ko(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(a=>an(a,t.blueprints[0])),o=t.blueprints.slice(1).map(a=>an(a,e.blueprints[0])),i=lp(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([a,l])=>Gt(Ui(a,l)));return mn([...Gt(r),...n.flatMap(a=>Gt(a)),...o.flatMap(a=>Gt(a)),...i])},Nt=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof J)&&e instanceof J)return $s([t,...e.blueprints]);if(!(e instanceof J)&&t instanceof J)return $s([e,...t.blueprints]);if(t instanceof J&&e instanceof J){let r=Nt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=Nt(n,r)}),r}if(t instanceof Ee){if(e instanceof J)return Nt(e,t);if(e instanceof ae)return fo(e,t);if(e instanceof Ee)return ho(t,e)}if(e instanceof Ee){if(t instanceof J)return Nt(t,e);if(t instanceof ae)return fo(t,e);if(t instanceof Ee)return ho(t,e)}return t instanceof ae&&e instanceof ae?ko(t,e):null},po=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof J?r.blueprints:r);return e.length===1?e[0]:new J(e)},tr=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof J)return po(t.blueprints.map(n=>tr(n,e)));if(t instanceof Ee){const n=t.blueprints[0];if(e instanceof ae&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=Nt(e,new J(t.blueprints.slice(1)));return mn([n,...Gt(o)])}else{let o=tr(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=tr(o,i)}),o}}if(e instanceof J)return po(e.blueprints.map(n=>tr(t,n)));if(e instanceof Ee){let n=an(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=Nt(n,Ui(o,t))}),n}return an(t,e)};function Qr(t,e){if(t===null||e===null)return null;if(t instanceof ae&&e instanceof ae)return Ui(t,e);if(t instanceof J)return po(t.blueprints.map(r=>Qr(r,e)));if(t instanceof Ee){const r=t.blueprints[0],n=t.blueprints[1];return tr(Qr(r,e),n)}if(e instanceof J)return po(e.blueprints.map(r=>Qr(t,r)));if(e instanceof Ee){const r=e.blueprints[0],n=e.blueprints[1];return tr(Qr(r,t),n)}throw new Error("intersct 2D algorithm error")}const Xs=(t,e={})=>{const r=e.plane instanceof Je?ir(e.plane):ir(e.plane,e.origin),n=on([Ah(t,r.origin,r.zDir)]),o=new Lr(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var a=n.charCodeAt(i),l;return a>=55296&&a<=56319&&o>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(a-55296)*1024+l-56320+65536:a}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function du(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var cp=new du,fp=new du,vu=new Uint8Array(30),gu=new Uint16Array(30),hp=new Uint8Array(30),pp=new Uint16Array(30);function mu(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function dp(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}dp(cp,fp);mu(vu,gu,4,3);mu(hp,pp,2,1);vu[28]=0;gu[28]=258;function Cr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function ur(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}ur.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};ur.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};ur.prototype.addX=function(t){this.addPoint(t,null)};ur.prototype.addY=function(t){this.addPoint(null,t)};ur.prototype.addBezier=function(t,e,r,n,o,i,a,l){var c=[t,e],h=[r,n],v=[o,i],g=[a,l];this.addPoint(t,e),this.addPoint(a,l);for(var d=0;d<=1;d++){var w=6*c[d]-12*h[d]+6*v[d],T=-3*c[d]+9*h[d]-9*v[d]+3*g[d],C=3*h[d]-3*c[d];if(T===0){if(w===0)continue;var x=-C/w;0<x&&x<1&&(d===0&&this.addX(Cr(c[d],h[d],v[d],g[d],x)),d===1&&this.addY(Cr(c[d],h[d],v[d],g[d],x)));continue}var P=Math.pow(w,2)-4*C*T;if(!(P<0)){var D=(-w+Math.sqrt(P))/(2*T);0<D&&D<1&&(d===0&&this.addX(Cr(c[d],h[d],v[d],g[d],D)),d===1&&this.addY(Cr(c[d],h[d],v[d],g[d],D)));var O=(-w-Math.sqrt(P))/(2*T);0<O&&O<1&&(d===0&&this.addX(Cr(c[d],h[d],v[d],g[d],O)),d===1&&this.addY(Cr(c[d],h[d],v[d],g[d],O)))}}};ur.prototype.addQuad=function(t,e,r,n,o,i){var a=t+.6666666666666666*(r-t),l=e+2/3*(n-e),c=a+1/3*(o-t),h=l+1/3*(i-e);this.addBezier(t,e,a,l,c,h,o,i)};function We(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}We.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};We.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};We.prototype.curveTo=We.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})};We.prototype.quadTo=We.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};We.prototype.close=We.prototype.closePath=function(){this.commands.push({type:"Z"})};We.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof ur){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};We.prototype.getBoundingBox=function(){for(var t=new ur,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var a=this.commands[i];switch(a.type){case"M":t.addPoint(a.x,a.y),e=n=a.x,r=o=a.y;break;case"L":t.addPoint(a.x,a.y),n=a.x,o=a.y;break;case"Q":t.addQuad(n,o,a.x1,a.y1,a.x,a.y),n=a.x,o=a.y;break;case"C":t.addBezier(n,o,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,o=a.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+a.type)}}return t.isEmpty()&&t.addPoint(0,0),t};We.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};We.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(t)}function r(){for(var a=arguments,l="",c=0;c<arguments.length;c+=1){var h=a[c];h>=0&&c>0&&(l+=" "),l+=e(h)}return l}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n};We.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};We.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function yu(t){throw new Error(t)}function Ys(t,e){t||yu(e)}var ee={fail:yu,argument:Ys,assert:Ys},js=32768,qs=2147483648,Ur={},H={},Q={};function _t(t){return function(){return t}}H.BYTE=function(t){return ee.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};Q.BYTE=_t(1);H.CHAR=function(t){return[t.charCodeAt(0)]};Q.CHAR=_t(1);H.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};Q.CHARARRAY=function(t){return typeof t>"u"?0:t.length};H.USHORT=function(t){return[t>>8&255,t&255]};Q.USHORT=_t(2);H.SHORT=function(t){return t>=js&&(t=-(2*js-t)),[t>>8&255,t&255]};Q.SHORT=_t(2);H.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};Q.UINT24=_t(3);H.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};Q.ULONG=_t(4);H.LONG=function(t){return t>=qs&&(t=-(2*qs-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};Q.LONG=_t(4);H.FIXED=H.ULONG;Q.FIXED=Q.ULONG;H.FWORD=H.SHORT;Q.FWORD=Q.SHORT;H.UFWORD=H.USHORT;Q.UFWORD=Q.USHORT;H.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};Q.LONGDATETIME=_t(8);H.TAG=function(t){return ee.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};Q.TAG=_t(4);H.Card8=H.BYTE;Q.Card8=Q.BYTE;H.Card16=H.USHORT;Q.Card16=Q.USHORT;H.OffSize=H.BYTE;Q.OffSize=Q.BYTE;H.SID=H.USHORT;Q.SID=Q.USHORT;H.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?H.NUMBER16(t):H.NUMBER32(t)};Q.NUMBER=function(t){return H.NUMBER(t).length};H.NUMBER16=function(t){return[28,t>>8&255,t&255]};Q.NUMBER16=_t(3);H.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};Q.NUMBER32=_t(5);H.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,a=e.length;i<a;i+=1){var l=e[i];l==="e"?o+=e[++i]==="-"?"c":"b":l==="."?o+="a":l==="-"?o+="e":o+=l}o+=o.length&1?"f":"ff";for(var c=[30],h=0,v=o.length;h<v;h+=2)c.push(parseInt(o.substr(h,2),16));return c};Q.REAL=function(t){return H.REAL(t).length};H.NAME=H.CHARARRAY;Q.NAME=Q.CHARARRAY;H.STRING=H.CHARARRAY;Q.STRING=Q.CHARARRAY;Ur.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Ur.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)};H.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};Q.UTF16=function(t){return t.length*2};var bi={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Ur.MACSTRING=function(t,e,r,n){var o=bi[n];if(o!==void 0){for(var i="",a=0;a<r;a++){var l=t.getUint8(e+a);l<=127?i+=String.fromCharCode(l):i+=o[l&127]}return i}};var zn=typeof WeakMap=="function"&&new WeakMap,Wn,vp=function(t){if(!Wn){Wn={};for(var e in bi)Wn[e]=new String(e)}var r=Wn[t];if(r!==void 0){if(zn){var n=zn.get(r);if(n!==void 0)return n}var o=bi[t];if(o!==void 0){for(var i={},a=0;a<o.length;a++)i[o.charCodeAt(a)]=a+128;return zn&&zn.set(r,i),i}}};H.MACSTRING=function(t,e){var r=vp(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}};Q.MACSTRING=function(t,e){var r=H.MACSTRING(t,e);return r!==void 0?r.length:0};function _i(t){return t>=-128&&t<=127}function gp(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function mp(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(!_i(a)||a===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var l=e;l<i;++l)r.push(t[l]+256&255);return i}function yp(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(a===0||_i(a)&&i+1<o&&_i(t[i+1]))break;++i,++n}r.push(64|n-1);for(var l=e;l<i;++l){var c=t[l];r.push(c+65536>>8&255,c+256&255)}return i}H.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=gp(t,e,r):n>=-128&&n<=127?e=mp(t,e,r):e=yp(t,e,r)}return r};H.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=H.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var a=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,c=[void 0,H.BYTE,H.USHORT,H.UINT24,H.ULONG][l],h=0;h<r.length;h+=1){var v=c(r[h]);Array.prototype.push.apply(a,v)}return Array.prototype.concat(H.Card16(t.length),H.OffSize(l),a,n)};Q.INDEX=function(t){return H.INDEX(t).length};H.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),a=t[i];e=e.concat(H.OPERAND(a.value,a.type)),e=e.concat(H.OPERATOR(i))}return e};Q.DICT=function(t){return H.DICT(t).length};H.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};H.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)ee.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(H.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(H.NUMBER(t));else if(e==="offset")r=r.concat(H.NUMBER32(t));else if(e==="number")r=r.concat(H.NUMBER(t));else if(e==="real")r=r.concat(H.REAL(t));else throw new Error("Unknown operand type "+e);return r};H.OP=H.BYTE;Q.OP=Q.BYTE;var $n=typeof WeakMap=="function"&&new WeakMap;H.CHARSTRING=function(t){if($n){var e=$n.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(H[i.type](i.value))}return $n&&$n.set(t,r),r};Q.CHARSTRING=function(t){return H.CHARSTRING(t).length};H.OBJECT=function(t){var e=H[t.type];return ee.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};Q.OBJECT=function(t){var e=Q[t.type];return ee.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};H.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var a=t.fields[i],l=H[a.type];ee.argument(l!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var c=t[a.name];c===void 0&&(c=a.value);var h=l(c);a.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(h)):e=e.concat(h)}for(var v=0;v<n.length;v+=1){var g=o[v],d=e.length;ee.argument(d<65536,"Table "+t.tableName+" too big."),e[g]=d>>8,e[g+1]=d&255,e=e.concat(n[v])}return e};Q.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=Q[o.type];ee.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var a=t[o.name];a===void 0&&(a=o.value),e+=i(a),o.type==="TABLE"&&(e+=2)}return e};H.RECORD=H.TABLE;Q.RECORD=Q.TABLE;H.LITERAL=function(t){return t};Q.LITERAL=function(t){return t.length};function Xe(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),a=0;a<i.length;a+=1){var l=i[a],c=r[l];this[l]!==void 0&&(this[l]=c)}}Xe.prototype.encode=function(){return H.TABLE(this)};Xe.prototype.sizeOf=function(){return Q.TABLE(this)};function un(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function Si(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function ln(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function vo(t){t.format===1?Xe.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(un("glyph",t.glyphs))):t.format===2?Xe.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(ln("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):ee.assert(!1,"Coverage format must be 1 or 2.")}vo.prototype=Object.create(Xe.prototype);vo.prototype.constructor=vo;function go(t){Xe.call(this,"scriptListTable",ln("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return ee.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Xe("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Xe("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(un("featureIndex",o.featureIndexes)))}].concat(ln("langSys",n.langSysRecords,function(i,a){var l=i.langSys;return[{name:"langSysTag"+a,type:"TAG",value:i.tag},{name:"langSys"+a,type:"TABLE",value:new Xe("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(un("featureIndex",l.featureIndexes)))}]})))}]}))}go.prototype=Object.create(Xe.prototype);go.prototype.constructor=go;function mo(t){Xe.call(this,"featureListTable",ln("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Xe("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(un("lookupListIndex",n.lookupListIndexes)))}]}))}mo.prototype=Object.create(Xe.prototype);mo.prototype.constructor=mo;function yo(t,e){Xe.call(this,"lookupListTable",Si("lookup",t,function(r){var n=e[r.lookupType];return ee.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Xe("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Si("subtable",r.subtables,n)))}))}yo.prototype=Object.create(Xe.prototype);yo.prototype.constructor=yo;var $={Table:Xe,Record:Xe,Coverage:vo,ScriptList:go,FeatureList:mo,LookupList:yo,ushortList:un,tableList:Si,recordList:ln};function Zs(t,e){return t.getUint8(e)}function wo(t,e){return t.getUint16(e,!1)}function wp(t,e){return t.getInt16(e,!1)}function Ii(t,e){return t.getUint32(e,!1)}function wu(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function bp(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function _p(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Sp(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function Tp(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Ep={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function k(t,e){this.data=t,this.offset=e,this.relativeOffset=0}k.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};k.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};k.prototype.parseCard8=k.prototype.parseByte;k.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};k.prototype.parseCard16=k.prototype.parseUShort;k.prototype.parseSID=k.prototype.parseUShort;k.prototype.parseOffset16=k.prototype.parseUShort;k.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};k.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};k.prototype.parseULong=function(){var t=Ii(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};k.prototype.parseOffset32=k.prototype.parseULong;k.prototype.parseFixed=function(){var t=wu(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};k.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n};k.prototype.parseTag=function(){return this.parseString(4)};k.prototype.parseLongDateTime=function(){var t=Ii(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};k.prototype.parseVersion=function(t){var e=wo(this.data,this.offset+this.relativeOffset),r=wo(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};k.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Ep[t]*e};k.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};k.prototype.parseOffset16List=k.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};k.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};k.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e};k.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};k.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};k.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r};k.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r};k.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r};k.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};k.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};k.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new k(this.data,this.offset+e).parseStruct(t)};k.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new k(this.data,this.offset+e).parseStruct(t)};k.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var a=e[i];if(a===0){o[i]=void 0;continue}if(this.relativeOffset=a,t){for(var l=this.parseOffset16List(),c=new Array(l.length),h=0;h<l.length;h++)this.relativeOffset=a+l[h],c[h]=t.call(this);o[i]=c}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o};k.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};k.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:k.uShort,end:k.uShort,classId:k.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};k.list=function(t,e){return function(){return this.parseList(t,e)}};k.list32=function(t,e){return function(){return this.parseList32(t,e)}};k.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};k.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};k.pointer=function(t){return function(){return this.parsePointer(t)}};k.pointer32=function(t){return function(){return this.parsePointer32(t)}};k.tag=k.prototype.parseTag;k.byte=k.prototype.parseByte;k.uShort=k.offset16=k.prototype.parseUShort;k.uShortList=k.prototype.parseUShortList;k.uLong=k.offset32=k.prototype.parseULong;k.uLongList=k.prototype.parseULongList;k.struct=k.prototype.parseStruct;k.coverage=k.prototype.parseCoverage;k.classDef=k.prototype.parseClassDef;var Ks={reserved:k.uShort,reqFeatureIndex:k.uShort,featureIndexes:k.uShortList};k.prototype.parseScriptList=function(){return this.parsePointer(k.recordList({tag:k.tag,script:k.pointer({defaultLangSys:k.pointer(Ks),langSysRecords:k.recordList({tag:k.tag,langSys:k.pointer(Ks)})})}))||[]};k.prototype.parseFeatureList=function(){return this.parsePointer(k.recordList({tag:k.tag,feature:k.pointer({featureParams:k.offset16,lookupListIndexes:k.uShortList})}))||[]};k.prototype.parseLookupList=function(t){return this.parsePointer(k.list(k.pointer(function(){var e=this.parseUShort();ee.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(k.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};k.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();ee.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:k.offset32,featureTableSubstitutionOffset:k.offset32});return r})||[]};var oe={getByte:Zs,getCard8:Zs,getUShort:wo,getCard16:wo,getShort:wp,getULong:Ii,getFixed:wu,getTag:bp,getOffset:_p,getBytes:Sp,bytesToString:Tp,Parser:k};function xp(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),a=e.parseULong(),l=o;l<=i;l+=1)t.glyphIndexMap[l]=a,a++}function Cp(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var a=new oe.Parser(r,n+o+14),l=new oe.Parser(r,n+o+16+i*2),c=new oe.Parser(r,n+o+16+i*4),h=new oe.Parser(r,n+o+16+i*6),v=n+o+16+i*8,g=0;g<i-1;g+=1)for(var d=void 0,w=a.parseUShort(),T=l.parseUShort(),C=c.parseShort(),x=h.parseUShort(),P=T;P<=w;P+=1)x!==0?(v=h.offset+h.relativeOffset-2,v+=x,v+=(P-T)*2,d=oe.getUShort(r,v),d!==0&&(d=d+C&65535)):d=P+C&65535,t.glyphIndexMap[P]=d}function Pp(t,e){var r={};r.version=oe.getUShort(t,e),ee.argument(r.version===0,"cmap table version should be 0."),r.numTables=oe.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=oe.getUShort(t,e+4+o*8),a=oe.getUShort(t,e+4+o*8+2);if(i===3&&(a===0||a===1||a===10)||i===0&&(a===0||a===1||a===2||a===3||a===4)){n=oe.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new oe.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)xp(r,l);else if(r.format===4)Cp(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function kp(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Ap(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Rp(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new $.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var a=t.get(r),l=0;l<a.unicodes.length;l+=1)kp(i,a.unicodes[l],r);i.segments=i.segments.sort(function(D,O){return D.start-O.start})}Ap(i);var c=i.segments.length,h=0,v=[],g=[],d=[],w=[],T=[],C=[];for(r=0;r<c;r+=1){var x=i.segments[r];x.end<=65535&&x.start<=65535?(v=v.concat({name:"end_"+r,type:"USHORT",value:x.end}),g=g.concat({name:"start_"+r,type:"USHORT",value:x.start}),d=d.concat({name:"idDelta_"+r,type:"SHORT",value:x.delta}),w=w.concat({name:"idRangeOffset_"+r,type:"USHORT",value:x.offset}),x.glyphId!==void 0&&(T=T.concat({name:"glyph_"+r,type:"USHORT",value:x.glyphId}))):h+=1,!e&&x.glyphIndex!==void 0&&(C=C.concat({name:"cmap12Start_"+r,type:"ULONG",value:x.start}),C=C.concat({name:"cmap12End_"+r,type:"ULONG",value:x.end}),C=C.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:x.glyphIndex}))}if(i.segCountX2=(c-h)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(c-h)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(v),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(g),i.fields=i.fields.concat(d),i.fields=i.fields.concat(w),i.fields=i.fields.concat(T),i.cmap4Length=14+v.length*2+2+g.length*2+d.length*2+w.length*2+T.length*2,!e){var P=16+C.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:P},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:C.length/3}]),i.fields=i.fields.concat(C)}return i}var Op={parse:Pp,make:Rp},Jn=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Mp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Dp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Qs=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function bu(t){this.font=t}bu.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function bo(t,e){this.encoding=t,this.charset=e}bo.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function Fp(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var dr={line:Fp};function Bp(t,e){var r=e||new We;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function pt(t){this.bindConstructorValues(t)}pt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",Bp(this,t.path))};pt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};pt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};pt.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,a;n||(n={});var l=n.xScale,c=n.yScale;if(n.hinting&&o&&o.hinting&&(a=this.path&&o.hinting.exec(this,r)),a)i=o.hinting.getCommands(a),t=Math.round(t),e=Math.round(e),l=c=1;else{i=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=h),c===void 0&&(c=h)}for(var v=new We,g=0;g<i.length;g+=1){var d=i[g];d.type==="M"?v.moveTo(t+d.x*l,e+-d.y*c):d.type==="L"?v.lineTo(t+d.x*l,e+-d.y*c):d.type==="Q"?v.quadraticCurveTo(t+d.x1*l,e+-d.y1*c,t+d.x*l,e+-d.y*c):d.type==="C"?v.curveTo(t+d.x1*l,e+-d.y1*c,t+d.x2*l,e+-d.y2*c,t+d.x*l,e+-d.y*c):d.type==="Z"&&v.closePath()}return v};pt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return ee.argument(e.length===0,"There are still points left in the current contour."),t};pt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i};pt.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)};pt.prototype.drawPoints=function(t,e,r,n){function o(g,d,w,T){t.beginPath();for(var C=0;C<g.length;C+=1)t.moveTo(d+g[C].x*T,w+g[C].y*T),t.arc(d+g[C].x*T,w+g[C].y*T,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,a=[],l=[],c=this.path,h=0;h<c.commands.length;h+=1){var v=c.commands[h];v.x!==void 0&&a.push({x:v.x,y:-v.y}),v.x1!==void 0&&l.push({x:v.x1,y:-v.y1}),v.x2!==void 0&&l.push({x:v.x2,y:-v.y2})}t.fillStyle="blue",o(a,e,r,i),t.fillStyle="red",o(l,e,r,i)};pt.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",dr.line(t,e,-1e4,e,1e4),dr.line(t,-1e4,r,1e4,r);var i=this.xMin||0,a=this.yMin||0,l=this.xMax||0,c=this.yMax||0,h=this.advanceWidth||0;t.strokeStyle="blue",dr.line(t,e+i*o,-1e4,e+i*o,1e4),dr.line(t,e+l*o,-1e4,e+l*o,1e4),dr.line(t,-1e4,r+-a*o,1e4,r+-a*o),dr.line(t,-1e4,r+-c*o,1e4,r+-c*o),t.strokeStyle="green",dr.line(t,e+h*o,-1e4,e+h*o,1e4)};function Xn(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Gi(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Gi.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};Gi.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function Lp(t,e){return new pt({index:e,font:t})}function Up(t,e,r,n,o,i){return function(){var a=new pt({index:e,font:t});return a.path=function(){r(a,n,o);var l=i(t.glyphs,a);return l.unitsPerEm=t.unitsPerEm,l},Xn(a,"xMin","_xMin"),Xn(a,"xMax","_xMax"),Xn(a,"yMin","_yMin"),Xn(a,"yMax","_yMax"),a}}function Ip(t,e,r,n){return function(){var o=new pt({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var At={GlyphSet:Gi,glyphLoader:Lp,ttfGlyphLoader:Up,cffGlyphLoader:Ip};function _u(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!_u(t[r],e[r]))return!1;return!0}else return!1}function Ti(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Jt(t,e,r){var n=[],o=[],i=oe.getCard16(t,e),a,l;if(i!==0){var c=oe.getByte(t,e+2);a=e+(i+1)*c+2;for(var h=e+3,v=0;v<i+1;v+=1)n.push(oe.getOffset(t,h,c)),h+=c;l=a+n[i]}else l=e+2;for(var g=0;g<n.length-1;g+=1){var d=oe.getBytes(t,a+n[g],a+n[g+1]);r&&(d=r(d)),o.push(d)}return{objects:o,startOffset:e,endOffset:l}}function Gp(t,e){var r=[],n=oe.getCard16(t,e),o,i;if(n!==0){var a=oe.getByte(t,e+2);o=e+(n+1)*a+2;for(var l=e+3,c=0;c<n+1;c+=1)r.push(oe.getOffset(t,l,a)),l+=a;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function Np(t,e,r,n,o){var i=oe.getCard16(r,n),a=0;if(i!==0){var l=oe.getByte(r,n+2);a=n+(i+1)*l+2}var c=oe.getBytes(r,a+e[t],a+e[t+1]);return o&&(c=o(c)),c}function Vp(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,a=o&15;if(i===r||(e+=n[i],a===r))break;e+=n[a]}return parseFloat(e)}function Hp(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return Vp(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function zp(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Su(t,e,r){e=e!==void 0?e:0;var n=new oe.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var a=n.parseByte();a<=21?(a===12&&(a=1200+n.parseByte()),o.push([a,i]),i=[]):i.push(Hp(n,a))}return zp(o)}function rn(t,e){return e<=390?e=Jn[e]:e=t[e-391],e}function Tu(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var a=e[i];if(Array.isArray(a.type)){var l=[];l.length=a.type.length;for(var c=0;c<a.type.length;c++)o=t[a.op]!==void 0?t[a.op][c]:void 0,o===void 0&&(o=a.value!==void 0&&a.value[c]!==void 0?a.value[c]:null),a.type[c]==="SID"&&(o=rn(r,o)),l[c]=o;n[a.name]=l}else o=t[a.op],o===void 0&&(o=a.value!==void 0?a.value:null),a.type==="SID"&&(o=rn(r,o)),n[a.name]=o}return n}function Wp(t,e){var r={};return r.formatMajor=oe.getCard8(t,e),r.formatMinor=oe.getCard8(t,e+1),r.size=oe.getCard8(t,e+2),r.offsetSize=oe.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Eu=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],xu=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function $p(t,e){var r=Su(t,0,t.byteLength);return Tu(r,Eu,e)}function Cu(t,e,r,n){var o=Su(t,e,r);return Tu(o,xu,n)}function Js(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var a=new DataView(new Uint8Array(r[i]).buffer),l=$p(a,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var c=l.private[0],h=l.private[1];if(c!==0&&h!==0){var v=Cu(t,h+e,c,n);if(l._defaultWidthX=v.defaultWidthX,l._nominalWidthX=v.nominalWidthX,v.subrs!==0){var g=h+v.subrs,d=Jt(t,g+e);l._subrs=d.objects,l._subrsBias=Ti(l._subrs)}l._privateDict=v}o.push(l)}return o}function Xp(t,e,r,n){var o,i,a=new oe.Parser(t,e);r-=1;var l=[".notdef"],c=a.parseCard8();if(c===0)for(var h=0;h<r;h+=1)o=a.parseSID(),l.push(rn(n,o));else if(c===1)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard8();for(var v=0;v<=i;v+=1)l.push(rn(n,o)),o+=1}else if(c===2)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard16();for(var g=0;g<=i;g+=1)l.push(rn(n,o)),o+=1}else throw new Error("Unknown charset format "+c);return l}function Yp(t,e,r){var n,o={},i=new oe.Parser(t,e),a=i.parseCard8();if(a===0)for(var l=i.parseCard8(),c=0;c<l;c+=1)n=i.parseCard8(),o[n]=c;else if(a===1){var h=i.parseCard8();n=1;for(var v=0;v<h;v+=1)for(var g=i.parseCard8(),d=i.parseCard8(),w=g;w<=g+d;w+=1)o[w]=n,n+=1}else throw new Error("Unknown encoding format "+a);return new bo(o,r)}function ea(t,e,r){var n,o,i,a,l=new We,c=[],h=0,v=!1,g=!1,d=0,w=0,T,C,x,P;if(t.isCIDFont){var D=t.tables.cff.topDict._fdSelect[e.index],O=t.tables.cff.topDict._fdArray[D];T=O._subrs,C=O._subrsBias,x=O._defaultWidthX,P=O._nominalWidthX}else T=t.tables.cff.topDict._subrs,C=t.tables.cff.topDict._subrsBias,x=t.tables.cff.topDict._defaultWidthX,P=t.tables.cff.topDict._nominalWidthX;var z=x;function N(K,ie){g&&l.closePath(),l.moveTo(K,ie),g=!0}function Z(){var K;K=c.length%2!==0,K&&!v&&(z=c.shift()+P),h+=c.length>>1,c.length=0,v=!0}function j(K){for(var ie,me,Te,ye,xe,re,le,de,ce,te,ue,ve,he=0;he<K.length;){var Ce=K[he];switch(he+=1,Ce){case 1:Z();break;case 3:Z();break;case 4:c.length>1&&!v&&(z=c.shift()+P,v=!0),w+=c.pop(),N(d,w);break;case 5:for(;c.length>0;)d+=c.shift(),w+=c.shift(),l.lineTo(d,w);break;case 6:for(;c.length>0&&(d+=c.shift(),l.lineTo(d,w),c.length!==0);)w+=c.shift(),l.lineTo(d,w);break;case 7:for(;c.length>0&&(w+=c.shift(),l.lineTo(d,w),c.length!==0);)d+=c.shift(),l.lineTo(d,w);break;case 8:for(;c.length>0;)n=d+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),d=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,d,w);break;case 10:xe=c.pop()+C,re=T[xe],re&&j(re);break;case 11:return;case 12:switch(Ce=K[he],he+=1,Ce){case 35:n=d+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),le=i+c.shift(),de=a+c.shift(),ce=le+c.shift(),te=de+c.shift(),ue=ce+c.shift(),ve=te+c.shift(),d=ue+c.shift(),w=ve+c.shift(),c.shift(),l.curveTo(n,o,i,a,le,de),l.curveTo(ce,te,ue,ve,d,w);break;case 34:n=d+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),le=i+c.shift(),de=a,ce=le+c.shift(),te=a,ue=ce+c.shift(),ve=w,d=ue+c.shift(),l.curveTo(n,o,i,a,le,de),l.curveTo(ce,te,ue,ve,d,w);break;case 36:n=d+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),le=i+c.shift(),de=a,ce=le+c.shift(),te=a,ue=ce+c.shift(),ve=te+c.shift(),d=ue+c.shift(),l.curveTo(n,o,i,a,le,de),l.curveTo(ce,te,ue,ve,d,w);break;case 37:n=d+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),le=i+c.shift(),de=a+c.shift(),ce=le+c.shift(),te=de+c.shift(),ue=ce+c.shift(),ve=te+c.shift(),Math.abs(ue-d)>Math.abs(ve-w)?d=ue+c.shift():w=ve+c.shift(),l.curveTo(n,o,i,a,le,de),l.curveTo(ce,te,ue,ve,d,w);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+Ce),c.length=0}break;case 14:c.length>0&&!v&&(z=c.shift()+P,v=!0),g&&(l.closePath(),g=!1);break;case 18:Z();break;case 19:case 20:Z(),he+=h+7>>3;break;case 21:c.length>2&&!v&&(z=c.shift()+P,v=!0),w+=c.pop(),d+=c.pop(),N(d,w);break;case 22:c.length>1&&!v&&(z=c.shift()+P,v=!0),d+=c.pop(),N(d,w);break;case 23:Z();break;case 24:for(;c.length>2;)n=d+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),d=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,d,w);d+=c.shift(),w+=c.shift(),l.lineTo(d,w);break;case 25:for(;c.length>6;)d+=c.shift(),w+=c.shift(),l.lineTo(d,w);n=d+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),d=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,d,w);break;case 26:for(c.length%2&&(d+=c.shift());c.length>0;)n=d,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),d=i,w=a+c.shift(),l.curveTo(n,o,i,a,d,w);break;case 27:for(c.length%2&&(w+=c.shift());c.length>0;)n=d+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),d=i+c.shift(),w=a,l.curveTo(n,o,i,a,d,w);break;case 28:ie=K[he],me=K[he+1],c.push((ie<<24|me<<16)>>16),he+=2;break;case 29:xe=c.pop()+t.gsubrsBias,re=t.gsubrs[xe],re&&j(re);break;case 30:for(;c.length>0&&(n=d,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),d=i+c.shift(),w=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,d,w),c.length!==0);)n=d+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),w=a+c.shift(),d=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,d,w);break;case 31:for(;c.length>0&&(n=d+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),w=a+c.shift(),d=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,d,w),c.length!==0);)n=d,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),d=i+c.shift(),w=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,d,w);break;default:Ce<32?console.log("Glyph "+e.index+": unknown operator "+Ce):Ce<247?c.push(Ce-139):Ce<251?(ie=K[he],he+=1,c.push((Ce-247)*256+ie+108)):Ce<255?(ie=K[he],he+=1,c.push(-(Ce-251)*256-ie-108)):(ie=K[he],me=K[he+1],Te=K[he+2],ye=K[he+3],he+=4,c.push((ie<<24|me<<16|Te<<8|ye)/65536))}}}return j(r),e.advanceWidth=z,l}function jp(t,e,r,n){var o=[],i,a=new oe.Parser(t,e),l=a.parseCard8();if(l===0)for(var c=0;c<r;c++){if(i=a.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(l===3){var h=a.parseCard16(),v=a.parseCard16();if(v!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+v);for(var g,d=0;d<h;d++){if(i=a.parseCard8(),g=a.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(g>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+g);for(;v<g;v++)o.push(i);v=g}if(g!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+g)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return o}function qp(t,e,r,n){r.tables.cff={};var o=Wp(t,e),i=Jt(t,o.endOffset,oe.bytesToString),a=Jt(t,i.endOffset),l=Jt(t,a.endOffset,oe.bytesToString),c=Jt(t,l.endOffset);r.gsubrs=c.objects,r.gsubrsBias=Ti(r.gsubrs);var h=Js(t,e,a.objects,l.objects);if(h.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var v=h[0];if(r.tables.cff.topDict=v,v._privateDict&&(r.defaultWidthX=v._privateDict.defaultWidthX,r.nominalWidthX=v._privateDict.nominalWidthX),v.ros[0]!==void 0&&v.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var g=v.fdArray,d=v.fdSelect;if(g===0||d===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");g+=e;var w=Jt(t,g),T=Js(t,e,w.objects,l.objects);v._fdArray=T,d+=e,v._fdSelect=jp(t,d,r.numGlyphs,T.length)}var C=e+v.private[1],x=Cu(t,C,v.private[0],l.objects);if(r.defaultWidthX=x.defaultWidthX,r.nominalWidthX=x.nominalWidthX,x.subrs!==0){var P=C+x.subrs,D=Jt(t,P);r.subrs=D.objects,r.subrsBias=Ti(r.subrs)}else r.subrs=[],r.subrsBias=0;var O;n.lowMemory?(O=Gp(t,e+v.charStrings),r.nGlyphs=O.offsets.length):(O=Jt(t,e+v.charStrings),r.nGlyphs=O.objects.length);var z=Xp(t,e+v.charset,r.nGlyphs,l.objects);if(v.encoding===0?r.cffEncoding=new bo(Mp,z):v.encoding===1?r.cffEncoding=new bo(Dp,z):r.cffEncoding=Yp(t,e+v.encoding,z),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new At.GlyphSet(r),n.lowMemory)r._push=function(j){var K=Np(j,O.offsets,t,e+v.charStrings);r.glyphs.push(j,At.cffGlyphLoader(r,j,ea,K))};else for(var N=0;N<r.nGlyphs;N+=1){var Z=O.objects[N];r.glyphs.push(N,At.cffGlyphLoader(r,N,ea,Z))}}function Pu(t,e){var r,n=Jn.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Jn.length:(r=Jn.length+e.length,e.push(t)),r}function Zp(){return new $.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Kp(t){var e=new $.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function ku(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],a=e[i.name];a!==void 0&&!_u(a,i.value)&&(i.type==="SID"&&(a=Pu(a,r)),n[i.op]={name:i.name,type:i.type,value:a})}return n}function ta(t,e){var r=new $.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ku(Eu,t,e),r}function ra(t){var e=new $.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function Qp(t){var e=new $.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function Jp(){return new $.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function ed(t,e){for(var r=new $.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=Pu(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function td(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var a=void 0,l=void 0,c=r.commands[i];if(c.type==="Q"){var h=.3333333333333333,v=2/3;c={type:"C",x:c.x,y:c.y,x1:Math.round(h*n+v*c.x1),y1:Math.round(h*o+v*c.y1),x2:Math.round(h*c.x+v*c.x1),y2:Math.round(h*c.y+v*c.y1)}}if(c.type==="M")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="L")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="C"){var g=Math.round(c.x1-n),d=Math.round(c.y1-o),w=Math.round(c.x2-c.x1),T=Math.round(c.y2-c.y1);a=Math.round(c.x-c.x2),l=Math.round(c.y-c.y2),e.push({name:"dx1",type:"NUMBER",value:g}),e.push({name:"dy1",type:"NUMBER",value:d}),e.push({name:"dx2",type:"NUMBER",value:w}),e.push({name:"dy2",type:"NUMBER",value:T}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),o=Math.round(c.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function rd(t){for(var e=new $.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=td(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function nd(t,e){var r=new $.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ku(xu,t,e),r}function od(t,e){for(var r=new $.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},a=[],l,c=1;c<t.length;c+=1)l=t.get(c),a.push(l.name);var h=[];r.header=Zp(),r.nameIndex=Kp([e.postScriptName]);var v=ta(o,h);r.topDictIndex=ra(v),r.globalSubrIndex=Jp(),r.charsets=ed(a,h),r.charStringsIndex=rd(t),r.privateDict=nd(i,h),r.stringIndex=Qp(h);var g=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=g,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),v=ta(o,h),r.topDictIndex=ra(v),r}var id={parse:qp,make:od};function sd(t,e){var r={},n=new oe.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),ee.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function ad(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new $.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var ud={parse:sd,make:ad};function ld(t,e){var r={},n=new oe.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function cd(t){return new $.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var fd={parse:ld,make:cd};function hd(t,e,r,n,o){for(var i,a,l=new oe.Parser(t,e),c=0;c<n;c+=1){c<r&&(i=l.parseUShort(),a=l.parseShort());var h=o.get(c);h.advanceWidth=i,h.leftSideBearing=a}}function pd(t,e,r,n,o){t._hmtxTableData={};for(var i,a,l=new oe.Parser(e,r),c=0;c<o;c+=1)c<n&&(i=l.parseUShort(),a=l.parseShort()),t._hmtxTableData[c]={advanceWidth:i,leftSideBearing:a}}function dd(t,e,r,n,o,i,a){a.lowMemory?pd(t,e,r,n,o):hd(e,r,n,o,i)}function vd(t){for(var e=new $.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var gd={parse:dd,make:vd};function md(t){for(var e=new $.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function yd(t,e){var r=new oe.Parser(t,e),n=r.parseULong();ee.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],a=0;a<o;a++){for(var l="",c=e+r.parseUShort(),h=r.parseUShort(),v=c;v<c+h;++v)l+=String.fromCharCode(t.getInt8(v));i.push(l)}return i}var wd={make:md,parse:yd};function bd(t,e){var r={},n=new oe.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function _d(t){return new $.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Sd={parse:bd,make:_d},Au=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Ru={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Td={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Ou={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Ed(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return Ru[e];case 3:return Ou[e]}}var Ei="utf-16",xd={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Cd={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Mu(t,e,r){switch(t){case 0:return Ei;case 1:return Cd[r]||xd[e];case 3:if(e===1||e===10)return Ei;break}}function Pd(t,e,r){for(var n={},o=new oe.Parser(t,e),i=o.parseUShort(),a=o.parseUShort(),l=o.offset+o.parseUShort(),c=0;c<a;c++){var h=o.parseUShort(),v=o.parseUShort(),g=o.parseUShort(),d=o.parseUShort(),w=Au[d]||d,T=o.parseUShort(),C=o.parseUShort(),x=Ed(h,g,r),P=Mu(h,v,g);if(P!==void 0&&x!==void 0){var D=void 0;if(P===Ei?D=Ur.UTF16(t,l+C,T):D=Ur.MACSTRING(t,l+C,T,P),D){var O=n[w];O===void 0&&(O=n[w]={}),O[x]=D}}}return i===1&&o.parseUShort(),n}function ri(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function na(t,e,r,n,o,i){return new $.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function kd(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function oa(t,e){var r=kd(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function Ad(t,e){var r,n=[],o={},i=ri(Au);for(var a in t){var l=i[a];if(l===void 0&&(l=a),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');o[r]=t[a],n.push(r)}for(var c=ri(Ru),h=ri(Ou),v=[],g=[],d=0;d<n.length;d++){r=n[d];var w=o[r];for(var T in w){var C=w[T],x=1,P=c[T],D=Td[P],O=Mu(x,D,P),z=H.MACSTRING(C,O);z===void 0&&(x=0,P=e.indexOf(T),P<0&&(P=e.length,e.push(T)),D=4,z=H.UTF16(C));var N=oa(z,g);v.push(na(x,D,P,r,z.length,N));var Z=h[T];if(Z!==void 0){var j=H.UTF16(C),K=oa(j,g);v.push(na(3,1,Z,r,j.length,K))}}}v.sort(function(Te,ye){return Te.platformID-ye.platformID||Te.encodingID-ye.encodingID||Te.languageID-ye.languageID||Te.nameID-ye.nameID});for(var ie=new $.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:v.length},{name:"stringOffset",type:"USHORT",value:6+v.length*12}]),me=0;me<v.length;me++)ie.fields.push({name:"record_"+me,type:"RECORD",value:v[me]});return ie.fields.push({name:"strings",type:"LITERAL",value:g}),ie}var Rd={parse:Pd,make:Ad},xi=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Od(t){for(var e=0;e<xi.length;e+=1){var r=xi[e];if(t>=r.begin&&t<r.end)return e}return-1}function Md(t,e){var r={},n=new oe.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Dd(t){return new $.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var ia={parse:Md,make:Dd,unicodeRanges:xi,getUnicodeRange:Od};function Fd(t,e){var r={},n=new oe.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Qs.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=Qs.length){var a=n.parseChar();r.names.push(n.parseString(a))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function Bd(){return new $.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Ld={parse:Fd,make:Bd},wt=new Array(9);wt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(k.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(k.coverage),substitute:this.parseOffset16List()};ee.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};wt[2]=function(){var e=this.parseUShort();return ee.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),sequences:this.parseListOfLists()}};wt[3]=function(){var e=this.parseUShort();return ee.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),alternateSets:this.parseListOfLists()}};wt[4]=function(){var e=this.parseUShort();return ee.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Mr={sequenceIndex:k.uShort,lookupListIndex:k.uShort};wt[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(k.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Mr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(k.coverage),classDef:this.parsePointer(k.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Mr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,k.pointer(k.coverage)),lookupRecords:this.parseRecordList(o,Mr)}}ee.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};wt[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(k.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Mr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(k.coverage),backtrackClassDef:this.parsePointer(k.classDef),inputClassDef:this.parsePointer(k.classDef),lookaheadClassDef:this.parsePointer(k.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Mr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(k.pointer(k.coverage)),inputCoverage:this.parseList(k.pointer(k.coverage)),lookaheadCoverage:this.parseList(k.pointer(k.coverage)),lookupRecords:this.parseRecordList(Mr)};ee.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};wt[7]=function(){var e=this.parseUShort();ee.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new k(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:wt[r].call(n)}};wt[8]=function(){var e=this.parseUShort();return ee.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),backtrackCoverage:this.parseList(k.pointer(k.coverage)),lookaheadCoverage:this.parseList(k.pointer(k.coverage)),substitutes:this.parseUShortList()}};function Ud(t,e){e=e||0;var r=new k(t,e),n=r.parseVersion(1);return ee.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(wt)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(wt),variations:r.parseFeatureVariationsList()}}var Gr=new Array(9);Gr[1]=function(e){return e.substFormat===1?new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.ushortList("substitute",e.substitute)))};Gr[2]=function(e){return ee.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("seqSet",e.sequences,function(r){return new $.Table("sequenceSetTable",$.ushortList("sequence",r))})))};Gr[3]=function(e){return ee.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("altSet",e.alternateSets,function(r){return new $.Table("alternateSetTable",$.ushortList("alternate",r))})))};Gr[4]=function(e){return ee.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("ligSet",e.ligatureSets,function(r){return new $.Table("ligatureSetTable",$.tableList("ligature",r,function(n){return new $.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat($.ushortList("component",n.components,n.components.length+1)))}))})))};Gr[6]=function(e){if(e.substFormat===1){var r=new $.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("chainRuleSet",e.chainRuleSets,function(i){return new $.Table("chainRuleSetTable",$.tableList("chainRule",i,function(a){var l=$.ushortList("backtrackGlyph",a.backtrack,a.backtrack.length).concat($.ushortList("inputGlyph",a.input,a.input.length+1)).concat($.ushortList("lookaheadGlyph",a.lookahead,a.lookahead.length)).concat($.ushortList("substitution",[],a.lookupRecords.length));return a.lookupRecords.forEach(function(c,h){l=l.concat({name:"sequenceIndex"+h,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+h,type:"USHORT",value:c.lookupListIndex})}),new $.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)ee.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,a){n.push({name:"backtrackCoverage"+a,type:"TABLE",value:new $.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,a){n.push({name:"inputCoverage"+a,type:"TABLE",value:new $.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,a){n.push({name:"lookaheadCoverage"+a,type:"TABLE",value:new $.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,a){n=n.concat({name:"sequenceIndex"+a,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+a,type:"USHORT",value:i.lookupListIndex})});var o=new $.Table("chainContextTable",n);return o}ee.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Id(t){return new $.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new $.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new $.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new $.LookupList(t.lookups,Gr)}])}var Gd={parse:Ud,make:Id};function Nd(t,e){var r=new oe.Parser(t,e),n=r.parseULong();ee.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},a=0;a<o;a++){var l=r.parseTag(),c=r.parseULong(),h=r.parseULong(),v=Ur.UTF8(t,e+c,h);i[l]=v}return i}function Vd(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new $.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var a=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+a}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var Hd={parse:Nd,make:Vd};function sa(t){return Math.log(t)/Math.log(2)|0}function Ni(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function aa(t,e,r,n){return new $.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function Du(t){var e=new $.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,sa(e.numTables));e.searchRange=16*r,e.entrySelector=sa(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+aa().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<t.length;a+=1){var l=t[a];ee.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var c=l.sizeOf(),h=aa(l.tableName,Ni(l.encode()),i,c);for(n.push({name:h.tag+" Table Record",type:"RECORD",value:h}),o.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=c,ee.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(v,g){return v.value.tag>g.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function ua(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function zd(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function Wd(t){for(var e=[],r=[],n=[],o=[],i=[],a=[],l=[],c,h=0,v=0,g=0,d=0,w=0,T=0;T<t.glyphs.length;T+=1){var C=t.glyphs.get(T),x=C.unicode|0;if(isNaN(C.advanceWidth))throw new Error("Glyph "+C.name+" ("+T+"): advanceWidth is not a number.");(c>x||c===void 0)&&x>0&&(c=x),h<x&&(h=x);var P=ia.getUnicodeRange(x);if(P<32)v|=1<<P;else if(P<64)g|=1<<P-32;else if(P<96)d|=1<<P-64;else if(P<123)w|=1<<P-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(C.name!==".notdef"){var D=C.getMetrics();e.push(D.xMin),r.push(D.yMin),n.push(D.xMax),o.push(D.yMax),a.push(D.leftSideBearing),l.push(D.rightSideBearing),i.push(C.advanceWidth)}}var O={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:zd(i),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,l)};O.ascender=t.ascender,O.descender=t.descender;var z=ud.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:O.xMin,yMin:O.yMin,xMax:O.xMax,yMax:O.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),N=fd.make({ascender:O.ascender,descender:O.descender,advanceWidthMax:O.advanceWidthMax,minLeftSideBearing:O.minLeftSideBearing,minRightSideBearing:O.minRightSideBearing,xMaxExtent:O.maxLeftSideBearing+(O.xMax-O.xMin),numberOfHMetrics:t.glyphs.length}),Z=Sd.make(t.glyphs.length),j=ia.make(Object.assign({xAvgCharWidth:Math.round(O.advanceWidthAvg),usFirstCharIndex:c,usLastCharIndex:h,ulUnicodeRange1:v,ulUnicodeRange2:g,ulUnicodeRange3:d,ulUnicodeRange4:w,sTypoAscender:O.ascender,sTypoDescender:O.descender,sTypoLineGap:0,usWinAscent:O.yMax,usWinDescent:Math.abs(O.yMin),ulCodePageRange1:1,sxHeight:ua(t,"xyvw",{yMax:Math.round(O.ascender/2)}).yMax,sCapHeight:ua(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",O).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),K=gd.make(t.glyphs),ie=Op.make(t.glyphs),me=t.getEnglishName("fontFamily"),Te=t.getEnglishName("fontSubfamily"),ye=me+" "+Te,xe=t.getEnglishName("postScriptName");xe||(xe=me.replace(/\s/g,"")+"-"+Te);var re={};for(var le in t.names)re[le]=t.names[le];re.uniqueID||(re.uniqueID={en:t.getEnglishName("manufacturer")+":"+ye}),re.postScriptName||(re.postScriptName={en:xe}),re.preferredFamily||(re.preferredFamily=t.names.fontFamily),re.preferredSubfamily||(re.preferredSubfamily=t.names.fontSubfamily);var de=[],ce=Rd.make(re,de),te=de.length>0?wd.make(de):void 0,ue=Ld.make(),ve=id.make(t.glyphs,{version:t.getEnglishName("version"),fullName:ye,familyName:me,weightName:Te,postScriptName:xe,unitsPerEm:t.unitsPerEm,fontBBox:[0,O.yMin,O.ascender,O.advanceWidthMax]}),he=t.metas&&Object.keys(t.metas).length>0?Hd.make(t.metas):void 0,Ce=[z,N,Z,j,ce,ie,ue,ve,K];te&&Ce.push(te),t.tables.gsub&&Ce.push(Gd.make(t.tables.gsub)),he&&Ce.push(he);for(var nt=Du(Ce),dt=nt.encode(),ot=Ni(dt),vt=nt.fields,Rt=!1,et=0;et<vt.length;et+=1)if(vt[et].name==="head table"){vt[et].value.checkSumAdjustment=2981146554-ot,Rt=!0;break}if(!Rt)throw new Error("Could not find head table with checkSum to adjust.");return nt}var $d={make:Du,fontToTable:Wd,computeCheckSum:Ni};function ni(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function la(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function ca(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var a=r.start;if(a===e)return r;a<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function yn(t,e){this.font=t,this.tableName=e}yn.prototype={searchTag:ni,binSearch:la,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=ni(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=ni(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,a=o.featureIndexes,l=this.font.tables[this.tableName].features,c=0;c<a.length;c++)if(i=l[a[c]],i.tag===r)return i.feature;if(n){var h=l.length;return ee.assert(h===0||r>=l[h-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(i),a.push(h),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),a=[];if(i){for(var l,c=i.lookupListIndexes,h=this.font.tables[this.tableName].lookups,v=0;v<c.length;v++)l=h[c[v]],l.lookupType===n&&a.push(l);if(a.length===0&&o){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var g=h.length;return h.push(l),c.push(g),[l]}}return a},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=ca(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=la(t.glyphs,e);return r>=0?r:-1;case 2:var n=ca(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,a=o.end,l=i;l<=a;l++)e.push(l);return e}};function wn(t){yn.call(this,t,"gpos")}wn.prototype=yn.prototype;wn.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};wn.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var a=o[i],l=this.getCoverageIndex(a.coverage,e);if(!(l<0))switch(a.posFormat){case 1:for(var c=a.pairSets[l],h=0;h<c.length;h++){var v=c[h];if(v.secondGlyph===r)return v.value1&&v.value1.xAdvance||0}break;case 2:var g=this.getGlyphClass(a.classDef1,e),d=this.getGlyphClass(a.classDef2,r),w=a.classRecords[g][d];return w.value1&&w.value1.xAdvance||0}}return 0};wn.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function ut(t){yn.call(this,t,"gsub")}function Xd(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Vi(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}ut.prototype=yn.prototype;ut.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};ut.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),v=void 0;if(c.substFormat===1){var g=c.deltaGlyphId;for(v=0;v<h.length;v++){var d=h[v];n.push({sub:d,by:d+g})}}else{var w=c.substitute;for(v=0;v<h.length;v++)n.push({sub:h[v],by:w[v]})}}return n};ut.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),v=void 0;for(v=0;v<h.length;v++){var g=h[v],d=c.sequences[v];n.push({sub:g,by:d})}}return n};ut.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),v=c.alternateSets,g=0;g<h.length;g++)n.push({sub:h[g],by:v[g]});return n};ut.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),v=c.ligatureSets,g=0;g<h.length;g++)for(var d=h[g],w=v[g],T=0;T<w.length;T++){var C=w[T];n.push({sub:[d].concat(C.components),by:C.ligGlyph})}return n};ut.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=Vi(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});ee.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.substitute.splice(l,0,0)),i.substitute[l]=e.by};ut.prototype.addMultiple=function(t,e,r,n){ee.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=Vi(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});ee.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.sequences.splice(l,0,0)),i.sequences[l]=e.by};ut.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=Vi(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});ee.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by};ut.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),ee.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var a=e.sub[0],l=e.sub.slice(1),c={ligGlyph:e.by,components:l},h=this.binSearch(i.coverage.glyphs,a);if(h>=0){for(var v=i.ligatureSets[h],g=0;g<v.length;g++)if(Xd(v[g].components,l))return;v.push(c)}else h=-1-h,i.coverage.glyphs.splice(h,0,a),i.ligatureSets.splice(h,0,[c])};ut.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};ut.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function Yd(){return typeof window<"u"}function jd(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function jr(t,e){if(!t)throw e}function fa(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),e&o||(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function Fu(t,e,r){var n=new oe.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var a=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)a.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var c=0;c<t.instructionLength;c+=1)t.instructions.push(n.parseByte());var h=a[a.length-1]+1;o=[];for(var v=0;v<h;v+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var g=n.parseByte(),d=0;d<g;d+=1)o.push(i),v+=1;if(ee.argument(o.length===h,"Bad flags."),a.length>0){var w=[],T;if(h>0){for(var C=0;C<h;C+=1)i=o[C],T={},T.onCurve=!!(i&1),T.lastPointOfContour=a.indexOf(C)>=0,w.push(T);for(var x=0,P=0;P<h;P+=1)i=o[P],T=w[P],T.x=fa(n,i,x,2,16),x=T.x;for(var D=0,O=0;O<h;O+=1)i=o[O],T=w[O],T.y=fa(n,i,D,4,32),D=T.y}t.points=w}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var z=!0;z;){o=n.parseUShort();var N={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(N.dx=n.parseShort(),N.dy=n.parseShort()):N.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(N.dx=n.parseChar(),N.dy=n.parseChar()):N.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?N.xScale=N.yScale=n.parseF2Dot14():(o&64)>0?(N.xScale=n.parseF2Dot14(),N.yScale=n.parseF2Dot14()):(o&128)>0&&(N.xScale=n.parseF2Dot14(),N.scale01=n.parseF2Dot14(),N.scale10=n.parseF2Dot14(),N.yScale=n.parseF2Dot14()),t.components.push(N),z=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var Z=0;Z<t.instructionLength;Z+=1)t.instructions.push(n.parseByte())}}}function oi(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function qd(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return ee.argument(r.length===0,"There are still points left in the current contour."),e}function Bu(t){var e=new We;if(!t)return e;for(var r=qd(t),n=0;n<r.length;++n){var o=r[n],i=null,a=o[o.length-1],l=o[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var c={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5};e.moveTo(c.x,c.y)}for(var h=0;h<o.length;++h)if(i=a,a=l,l=o[(h+1)%o.length],a.onCurve)e.lineTo(a.x,a.y);else{var v=l;i.onCurve||((a.x+i.x)*.5,(a.y+i.y)*.5),l.onCurve||(v={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5}),e.quadraticCurveTo(a.x,a.y,v.x,v.y)}e.closePath()}return e}function Lu(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=oi(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[n.matchedPoints[0]],l=o.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=oi([l],c)[0],c.dx=a.x-l.x,c.dy=a.y-l.y,i=oi(o.points,c)}e.points=e.points.concat(i)}}return Bu(e.points)}function Zd(t,e,r,n){for(var o=new At.GlyphSet(n),i=0;i<r.length-1;i+=1){var a=r[i],l=r[i+1];a!==l?o.push(i,At.ttfGlyphLoader(n,i,Fu,t,e+a,Lu)):o.push(i,At.glyphLoader(n,i))}return o}function Kd(t,e,r,n){var o=new At.GlyphSet(n);return n._push=function(i){var a=r[i],l=r[i+1];a!==l?o.push(i,At.ttfGlyphLoader(n,i,Fu,t,e+a,Lu)):o.push(i,At.glyphLoader(n,i))},o}function Qd(t,e,r,n,o){return o.lowMemory?Kd(t,e,r,n):Zd(t,e,r,n)}var Jd={getPath:Bu,parse:Qd},Uu,Sr,Iu,Ci;function Gu(t){this.font=t,this.getCommands=function(e){return Jd.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function ev(t){return t}function Nu(t){return Math.sign(t)*Math.round(Math.abs(t))}function tv(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function rv(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function nv(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function ov(t){return Math.sign(t)*Math.floor(Math.abs(t))}var Vu=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},kt={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,v;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,c=e.x-e.xo,h=r.x-r.xo,a=Math.abs(o),l=Math.abs(i),v=a+l,v===0){t.x=t.xo+(c+h)/2;return}t.x=t.xo+(c*l+h*a)/v;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),v=a+l,v===0){kt.setRelative(t,t,(c+h)/2,n,!0);return}kt.setRelative(t,t,(c*l+h*a)/v,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.x=l+(t.y-c)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},Vt={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,v;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,c=e.y-e.yo,h=r.y-r.yo,a=Math.abs(o),l=Math.abs(i),v=a+l,v===0){t.y=t.yo+(c+h)/2;return}t.y=t.yo+(c*l+h*a)/v;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),v=a+l,v===0){Vt.setRelative(t,t,(c+h)/2,n,!0);return}Vt.setRelative(t,t,(c*l+h*a)/v,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.y=c+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(kt);Object.freeze(Vt);function bn(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}bn.prototype.distance=function(t,e,r,n){return this.x*kt.distance(t,e,r,n)+this.y*Vt.distance(t,e,r,n)};bn.prototype.interpolate=function(t,e,r,n){var o,i,a,l,c,h,v;if(a=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),c=Math.abs(a),h=Math.abs(l),v=c+h,v===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*h+i*c)/v,n,!0)};bn.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y,h=n.normalSlope,v=this.slope,g=t.x,d=t.y;t.x=(v*g-h*l+c-d)/(v-h),t.y=v*(t.x-g)+d};bn.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function _n(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?kt:t===0&&e===1?Vt:new bn(t,e)}function zt(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}zt.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};zt.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var cn=Object.freeze(new zt(0,0)),iv={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function rr(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=kt,this.round=Nu}}Gu.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){rr.prototype=iv,o=this._fpgmState=new rr("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,R.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{Sr(o)}catch(h){console.log("Hinting error in FPGM:"+h),this._errorState=3;return}}rr.prototype=o,n=this._prepState=new rr("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var a=n.cvt=new Array(i.length),l=e/r.unitsPerEm,c=0;c<i.length;c++)a[c]=i[c]*l;else n.cvt=[];R.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{Sr(n)}catch(h){this._errorState<2&&console.log("Hinting error in PREP:"+h),this._errorState=2}}if(!(this._errorState>1))try{return Iu(t,n)}catch(h){this._errorState<1&&(console.log("Hinting error:"+h),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};Iu=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,a,l;if(rr.prototype=e,!o)l=new rr("glyf",t.instructions),R.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),Ci(t,l,r,n),a=l.gZone;else{var c=e.font;a=[],i=[];for(var h=0;h<o.length;h++){var v=o[h],g=c.glyphs.get(v.glyphIndex);l=new rr("glyf",g.instructions),R.DEBUG&&(console.log("---EXEC COMP "+h+"---"),l.step=-1),Ci(g,l,r,n);for(var d=Math.round(v.dx*r),w=Math.round(v.dy*n),T=l.gZone,C=l.contours,x=0;x<T.length;x++){var P=T[x];P.xTouched=P.yTouched=!1,P.xo=P.x=P.x+d,P.yo=P.y=P.y+w}var D=a.length;a.push.apply(a,T);for(var O=0;O<C.length;O++)i.push(C[O]+D)}t.instructions&&!l.inhibitGridFit&&(l=new rr("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=a,l.contours=i,a.push(new zt(0,0),new zt(Math.round(t.advanceWidth*r),0)),R.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),Sr(l),a.length-=2)}return a};Ci=function(t,e,r,n){for(var o=t.points||[],i=o.length,a=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],c,h=0;h<i;h++)c=o[h],a[h]=new zt(c.x*r,c.y*n,c.lastPointOfContour,c.onCurve);for(var v,g,d=0;d<i;d++)c=a[d],v||(v=c,l.push(d)),c.lastPointOfContour?(c.nextPointOnContour=v,v.prevPointOnContour=c,v=void 0):(g=a[d+1],c.nextPointOnContour=g,g.prevPointOnContour=c);if(!e.inhibitGridFit){if(R.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var w=0;w<i;w++)console.log(w,a[w].x,a[w].y)}if(a.push(new zt(0,0),new zt(Math.round(t.advanceWidth*r),0)),Sr(e),a.length-=2,R.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var T=0;T<i;T++)console.log(T,a[T].x,a[T].y)}}};Sr=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(R.DEBUG&&t.step++,n=Uu[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function Ao(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new zt(0,0)}function Hu(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function ha(t,e){R.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function pa(t,e){R.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function da(t,e){R.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function va(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log("SPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.pv=e.dpv=_n(l,c)}function ga(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log("SFVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.fv=_n(l,c)}function sv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=_n(n,r)}function av(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=_n(n,r)}function uv(t){var e=t.stack,r=t.pv;R.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function lv(t){var e=t.stack,r=t.fv;R.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function cv(t){t.fv=t.pv,R.DEBUG&&console.log(t.step,"SFVTPV[]")}function fv(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),a=e.pop(),l=t.z0,c=t.z1,h=l[r],v=l[n],g=c[o],d=c[i],w=t.z2[a];R.DEBUG&&console.log("ISECT[], ",r,n,o,i,a);var T=h.x,C=h.y,x=v.x,P=v.y,D=g.x,O=g.y,z=d.x,N=d.y,Z=(T-x)*(O-N)-(C-P)*(D-z),j=T*P-C*x,K=D*N-O*z;w.x=(j*(D-z)-K*(T-x))/Z,w.y=(j*(O-N)-K*(C-P))/Z}function hv(t){t.rp0=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function pv(t){t.rp1=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function dv(t){t.rp2=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function vv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||Ao(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function gv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||Ao(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function mv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||Ao(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function yv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||Ao(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function wv(t){t.loop=t.stack.pop(),R.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function bv(t){R.DEBUG&&console.log(t.step,"RTG[]"),t.round=Nu}function _v(t){R.DEBUG&&console.log(t.step,"RTHG[]"),t.round=rv}function Sv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Tv(t){R.DEBUG&&console.log(t.step,"ELSE[]"),Hu(t,!1)}function Ev(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function xv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function Cv(t){var e=t.stack;R.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function ii(t){R.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function Pv(t){R.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function kv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function Av(t){var e=t.stack;R.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function Rv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var a=0;a<n;a++)Sr(t),R.DEBUG&&console.log(++t.step,a+1<n?"next loopcall":"done loopcall",a);t.ip=o,t.prog=i}function Ov(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],Sr(t),t.ip=r,t.prog=n,R.DEBUG&&console.log(++t.step,"returning from",e)}function Mv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function Dv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function Fv(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(R.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function ma(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;R.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var a=i.distance(n,cn);t&&(a=e.round(a)),o.setRelative(n,cn,a,i),o.touch(n),e.rp0=e.rp1=r}function ya(t,e){var r=e.z2,n=r.length-2,o,i,a;R.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)o=r[l],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(a=o.nextTouched(t),i===a&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,a,t)))}function wa(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=e.loop,c=e.z2;l--;){var h=r.pop(),v=c[h],g=a.distance(o,o,!1,!0);i.setRelative(v,v,g,a),i.touch(v),R.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",h)}e.loop=1}function ba(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop(),c=e.z2[e.contours[l]],h=c;R.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var v=a.distance(o,o,!1,!0);do h!==o&&i.setRelative(h,h,v,a),h=h.nextPointOnContour;while(h!==c)}function _a(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop();R.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var c;switch(l){case 0:c=e.tZone;break;case 1:c=e.gZone;break;default:throw new Error("Invalid zone")}for(var h,v=a.distance(o,o,!1,!0),g=c.length-2,d=0;d<g;d++)h=c[d],i.setRelative(h,h,v,a)}function Bv(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var a=e.pop(),l=i[a];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",a,o),n.setRelative(l,l,o),n.touch(l)}t.loop=1}function Lv(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],a=t.z1[n],l=t.fv,c=t.dpv,h=t.z2;o--;){var v=e.pop(),g=h[v];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",v,r,"<->",n),l.interpolate(g,i,a,c),l.touch(g)}t.loop=1}function Sa(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],a=e.z0[e.rp0],l=e.fv,c=e.pv;l.setRelative(i,a,n,c),l.touch(i),R.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function Uv(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,a=t.pv,l=t.z1;o--;){var c=e.pop(),h=l[c];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",c),i.setRelative(h,n,0,a),i.touch(h)}t.loop=1}function Iv(t){R.DEBUG&&console.log(t.step,"RTDG[]"),t.round=tv}function Ta(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],a=e.fv,l=e.pv,c=e.cvt[n];R.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",c,")",o);var h=l.distance(i,cn);t&&(Math.abs(h-c)<e.cvCutIn&&(h=c),h=e.round(h)),a.setRelative(i,cn,h,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),a.touch(i),e.rp0=e.rp1=o}function Gv(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];R.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function Nv(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];R.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var a=r[++e]<<8|r[++e];a&32768&&(a=-((a^65535)+1)),n.push(a)}t.ip=e}function Vv(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();R.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function Hv(t){var e=t.stack,r=t.store,n=e.pop();R.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function zv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function Wv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function Ea(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];R.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,cn,t,!1)*64)}function xa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],a=e.z0[o],l=e.dpv.distance(a,i,t,t);R.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",l),e.stack.push(Math.round(l*64))}function $v(t){R.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function Xv(t){R.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function Yv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function jv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function qv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function Zv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function Kv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function Qv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function Jv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function eg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function tg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"IF[]",e),e||(Hu(t,!0),R.DEBUG&&console.log(t.step,"EIF[]"))}function rg(t){R.DEBUG&&console.log(t.step,"EIF[]")}function ng(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function og(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function ig(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function si(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,a=e.ppem,l=e.deltaBase+(t-1)*16,c=e.deltaShift,h=e.z0;R.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var v=0;v<n;v++){var g=r.pop(),d=r.pop(),w=l+((d&240)>>4);if(w===a){var T=(d&15)-8;T>=0&&T++,R.DEBUG&&console.log(e.step,"DELTAPFIX",g,"by",T*c);var C=h[g];o.setRelative(C,C,T*c,i)}}}function sg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function ag(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function ug(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function lg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function cg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function fg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function hg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function pg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function dg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function vg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Yn(t,e){var r=e.stack,n=r.pop();R.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function gg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function ai(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,a=e.deltaShift;R.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var c=r.pop(),h=r.pop(),v=i+((h&240)>>4);if(v===o){var g=(h&15)-8;g>=0&&g++;var d=g*a;R.DEBUG&&console.log(e.step,"DELTACFIX",c,"by",d),e.cvt[c]+=d}}}function mg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=Vu;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function yg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=Vu;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function wg(t){R.DEBUG&&console.log(t.step,"ROFF[]"),t.round=ev}function bg(t){R.DEBUG&&console.log(t.step,"RUTG[]"),t.round=nv}function _g(t){R.DEBUG&&console.log(t.step,"RDTG[]"),t.round=ov}function Sg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function Ca(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.dpv=_n(l,c)}function Tg(t){var e=t.stack,r=e.pop(),n=0;R.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Eg(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();R.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function xg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function Cg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function Pg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function kg(t){var e=t.stack.pop(),r=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Kt(t,e){var r=e.stack,n=e.prog,o=e.ip;R.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function Qt(t,e){var r=e.ip,n=e.prog,o=e.stack;R.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var a=n[++r]<<8|n[++r];a&32768&&(a=-((a^65535)+1)),o.push(a)}e.ip=r}function W(t,e,r,n,o,i){var a=i.stack,l=t&&a.pop(),c=a.pop(),h=i.rp0,v=i.z0[h],g=i.z1[c],d=i.minDis,w=i.fv,T=i.dpv,C,x,P,D;x=C=T.distance(g,v,!0,!0),P=x>=0?1:-1,x=Math.abs(x),t&&(D=i.cvt[l],n&&Math.abs(x-D)<i.cvCutIn&&(x=D)),r&&x<d&&(x=d),n&&(x=i.round(x)),w.setRelative(g,v,P*x,T),w.touch(g),R.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?l+"("+i.cvt[l]+","+D+")":"",c,"(d =",C,"->",P*x,")"),i.rp1=i.rp0,i.rp2=c,e&&(i.rp0=c)}Uu=[ha.bind(void 0,Vt),ha.bind(void 0,kt),pa.bind(void 0,Vt),pa.bind(void 0,kt),da.bind(void 0,Vt),da.bind(void 0,kt),va.bind(void 0,0),va.bind(void 0,1),ga.bind(void 0,0),ga.bind(void 0,1),sv,av,uv,lv,cv,fv,hv,pv,dv,vv,gv,mv,yv,wv,bv,_v,Sv,Tv,Ev,xv,void 0,void 0,Cv,ii,Pv,kv,Av,Mv,Dv,void 0,void 0,void 0,Rv,Ov,Fv,void 0,ma.bind(void 0,0),ma.bind(void 0,1),ya.bind(void 0,Vt),ya.bind(void 0,kt),wa.bind(void 0,0),wa.bind(void 0,1),ba.bind(void 0,0),ba.bind(void 0,1),_a.bind(void 0,0),_a.bind(void 0,1),Bv,Lv,Sa.bind(void 0,0),Sa.bind(void 0,1),Uv,Iv,Ta.bind(void 0,0),Ta.bind(void 0,1),Gv,Nv,Vv,Hv,zv,Wv,Ea.bind(void 0,0),Ea.bind(void 0,1),void 0,xa.bind(void 0,0),xa.bind(void 0,1),$v,void 0,Xv,void 0,void 0,Yv,jv,qv,Zv,Kv,Qv,Jv,eg,tg,rg,ng,og,ig,si.bind(void 0,1),sg,ag,ug,lg,cg,fg,hg,pg,dg,vg,Yn.bind(void 0,0),Yn.bind(void 0,1),Yn.bind(void 0,2),Yn.bind(void 0,3),void 0,void 0,void 0,void 0,gg,si.bind(void 0,2),si.bind(void 0,3),ai.bind(void 0,1),ai.bind(void 0,2),ai.bind(void 0,3),mg,yg,void 0,void 0,wg,void 0,bg,_g,ii,ii,void 0,void 0,void 0,void 0,void 0,Sg,Ca.bind(void 0,0),Ca.bind(void 0,1),Tg,void 0,Eg,xg,Cg,Pg,kg,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Kt.bind(void 0,1),Kt.bind(void 0,2),Kt.bind(void 0,3),Kt.bind(void 0,4),Kt.bind(void 0,5),Kt.bind(void 0,6),Kt.bind(void 0,7),Kt.bind(void 0,8),Qt.bind(void 0,1),Qt.bind(void 0,2),Qt.bind(void 0,3),Qt.bind(void 0,4),Qt.bind(void 0,5),Qt.bind(void 0,6),Qt.bind(void 0,7),Qt.bind(void 0,8),W.bind(void 0,0,0,0,0,0),W.bind(void 0,0,0,0,0,1),W.bind(void 0,0,0,0,0,2),W.bind(void 0,0,0,0,0,3),W.bind(void 0,0,0,0,1,0),W.bind(void 0,0,0,0,1,1),W.bind(void 0,0,0,0,1,2),W.bind(void 0,0,0,0,1,3),W.bind(void 0,0,0,1,0,0),W.bind(void 0,0,0,1,0,1),W.bind(void 0,0,0,1,0,2),W.bind(void 0,0,0,1,0,3),W.bind(void 0,0,0,1,1,0),W.bind(void 0,0,0,1,1,1),W.bind(void 0,0,0,1,1,2),W.bind(void 0,0,0,1,1,3),W.bind(void 0,0,1,0,0,0),W.bind(void 0,0,1,0,0,1),W.bind(void 0,0,1,0,0,2),W.bind(void 0,0,1,0,0,3),W.bind(void 0,0,1,0,1,0),W.bind(void 0,0,1,0,1,1),W.bind(void 0,0,1,0,1,2),W.bind(void 0,0,1,0,1,3),W.bind(void 0,0,1,1,0,0),W.bind(void 0,0,1,1,0,1),W.bind(void 0,0,1,1,0,2),W.bind(void 0,0,1,1,0,3),W.bind(void 0,0,1,1,1,0),W.bind(void 0,0,1,1,1,1),W.bind(void 0,0,1,1,1,2),W.bind(void 0,0,1,1,1,3),W.bind(void 0,1,0,0,0,0),W.bind(void 0,1,0,0,0,1),W.bind(void 0,1,0,0,0,2),W.bind(void 0,1,0,0,0,3),W.bind(void 0,1,0,0,1,0),W.bind(void 0,1,0,0,1,1),W.bind(void 0,1,0,0,1,2),W.bind(void 0,1,0,0,1,3),W.bind(void 0,1,0,1,0,0),W.bind(void 0,1,0,1,0,1),W.bind(void 0,1,0,1,0,2),W.bind(void 0,1,0,1,0,3),W.bind(void 0,1,0,1,1,0),W.bind(void 0,1,0,1,1,1),W.bind(void 0,1,0,1,1,2),W.bind(void 0,1,0,1,1,3),W.bind(void 0,1,1,0,0,0),W.bind(void 0,1,1,0,0,1),W.bind(void 0,1,1,0,0,2),W.bind(void 0,1,1,0,0,3),W.bind(void 0,1,1,0,1,0),W.bind(void 0,1,1,0,1,1),W.bind(void 0,1,1,0,1,2),W.bind(void 0,1,1,0,1,3),W.bind(void 0,1,1,1,0,0),W.bind(void 0,1,1,1,0,1),W.bind(void 0,1,1,1,0,2),W.bind(void 0,1,1,1,0,3),W.bind(void 0,1,1,1,1,0),W.bind(void 0,1,1,1,1,1),W.bind(void 0,1,1,1,1,2),W.bind(void 0,1,1,1,1,3)];function Nr(t){this.char=t,this.state={},this.activeState=null}function Hi(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function Ag(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function bt(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Ro(t){this.eventId=t,this.subscribers=[]}function Rg(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Ro(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Ne(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Rg.call(this,t)}Nr.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};Nr.prototype.getState=function(t){return this.state[t]||null};Ne.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};Ne.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])};Ne.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(a){return a instanceof Nr});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Ne.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Nr){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};Ne.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};Ne.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};Ne.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof Nr});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};Ne.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],a=e===null||e.apply(this,i)===!0,l=[n,o];if(a){var c=r.apply(this,l);n.setState(t,c)}}),this.registeredModifiers.push(t)};Ro.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Ro.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};bt.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};bt.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};Ne.prototype.rangeToText=function(t){if(t instanceof Hi)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};Ne.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};Ne.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};Ne.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};Ne.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Ro&&n.subscribers.forEach(function(o){o.apply(r,e||[])})};Ne.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new Ag(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};Ne.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};Ne.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};Ne.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};Ne.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new bt(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Ne.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new Hi(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n};Ne.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new Hi(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),i&&n.checkEnd(t)){var a=r-i.startIndex+1,l=e.setEndOffset(a,o);e.dispatch("contextEnd",[o,l])}})};Ne.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new bt(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new Nr(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function or(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function zu(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function sr(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function eo(t){return/[A-z]/.test(t)}function Og(t){return/\s/.test(t)}function lt(t){this.font=t,this.features={}}function gr(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function Sn(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function Mg(t,e){var r=Sn(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function Dg(t,e){var r=Sn(t,e.coverage);return r===-1?null:e.substitute[r]}function ui(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var a=Sn(i,o);a!==-1&&r.push(a)}return r.length!==t.length?-1:r}function Fg(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=ui(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&sr(i[0].char);)i.shift();var a=new bt(i,0),l=ui(e.lookaheadCoverage,a),c=[].concat(t.backtrack);for(c.reverse();c.length&&sr(c[0].char);)c.shift();if(c.length<e.backtrackCoverage.length)return[];var h=new bt(c,0),v=ui(e.backtrackCoverage,h),g=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&v.length===e.backtrackCoverage.length,d=[];if(g)for(var w=0;w<e.lookupRecords.length;w++)for(var T=e.lookupRecords[w],C=T.lookupListIndex,x=this.getLookupByIndex(C),P=0;P<x.subtables.length;P++){var D=x.subtables[P],O=this.getLookupMethod(x,D),z=this.getSubstitutionType(x,D);if(z==="12")for(var N=0;N<n.length;N++){var Z=t.get(N),j=O(Z);j&&d.push(j)}}return d}function Bg(t,e){var r=t.current,n=Sn(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],a=0;a<i.length;a++){o=i[a];for(var l=0;l<o.components.length;l++){var c=t.lookahead[l],h=o.components[l];if(c!==h)break;if(l===o.components.length-1)return o}}return null}function Lg(t,e){var r=Sn(t,e.coverage);return r===-1?null:e.sequences[r]}lt.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};lt.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var a=0;a<i.length;a++){var l=i[a];if(l.tag===t){var c=l.langSys;return c.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};lt.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r};lt.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};lt.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};lt.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return Mg.apply(r,[o,e])};case"12":return function(o){return Dg.apply(r,[o,e])};case"63":return function(o){return Fg.apply(r,[o,e])};case"41":return function(o){return Bg.apply(r,[o,e])};case"21":return function(o){return Lg.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};lt.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),a=0;a<o.length;a++)for(var l=o[a],c=this.getLookupSubtables(l),h=0;h<c.length;h++){var v=c[h],g=this.getSubstitutionType(l,v),d=this.getLookupMethod(l,v),w=void 0;switch(g){case"11":w=d(e.current),w&&i.splice(r,1,new gr({id:11,tag:t.tag,substitution:w}));break;case"12":w=d(e.current),w&&i.splice(r,1,new gr({id:12,tag:t.tag,substitution:w}));break;case"63":w=d(e),Array.isArray(w)&&w.length&&i.splice(r,1,new gr({id:63,tag:t.tag,substitution:w}));break;case"41":w=d(e),w&&i.splice(r,1,new gr({id:41,tag:t.tag,substitution:w}));break;case"21":w=d(e.current),w&&i.splice(r,1,new gr({id:21,tag:t.tag,substitution:w}));break}e=new bt(i,r),!(Array.isArray(w)&&!w.length)&&(w=null)}return i.length?i:null};lt.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};lt.prototype.getLookupSubtables=function(t){return t.subtables||null};lt.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};lt.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};lt.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function Ug(t){var e=t.current,r=t.get(-1);return r===null&&or(e)||!or(r)&&or(e)}function Ig(t){var e=t.get(1);return e===null||!or(e)}var Gg={startCheck:Ug,endCheck:Ig};function Ng(t){var e=t.current,r=t.get(-1);return(or(e)||sr(e))&&!or(r)}function Vg(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!or(e)&&!sr(e)):var r=Og(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return or(o)||sr(o)}),!n)return!0}break;default:return!1}}var Hg={startCheck:Ng,endCheck:Vg};function zg(t,e,r){e[r].setState(t.tag,t.substitution)}function Wg(t,e,r){e[r].setState(t.tag,t.substitution)}function $g(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function Xg(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var Pa={11:zg,12:Wg,63:$g,41:Xg};function zi(t,e,r){t instanceof gr&&Pa[t.id]&&Pa[t.id](t,e,r)}function Yg(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=zu(n),i=sr(n);if(!o&&!i)return!0;if(o)return!1}return!1}function jg(t){if(zu(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=sr(r);if(!n)return!0}return!1}function qg(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new bt(o.map(function(l){return l.getState("glyphIndex")}),0),a=new bt(o.map(function(l){return l.char}),0);o.forEach(function(l,c){if(!sr(l.char)){i.setCurrentIndex(c),a.setCurrentIndex(c);var h=0;Yg(a)&&(h|=1),jg(a)&&(h|=2);var v;switch(h){case 1:v="fina";break;case 2:v="init";break;case 3:v="medi";break}if(n.indexOf(v)!==-1){var g=e.query.lookupFeature({tag:v,script:r,contextParams:i});if(g instanceof Error)return console.info(g.message);g.forEach(function(d,w){d instanceof gr&&(zi(d,o,w),i.context[w]=d.substitution)})}}})}}function ka(t,e){var r=t.map(function(n){return n.activeState.value});return new bt(r,e||0)}function Zg(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=ka(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});l.length&&(l.forEach(function(c){return zi(c,n,a)}),o=ka(n))})}function Kg(t){var e=t.current,r=t.get(-1);return r===null&&eo(e)||!eo(r)&&eo(e)}function Qg(t){var e=t.get(1);return e===null||!eo(e)}var Jg={startCheck:Kg,endCheck:Qg};function Aa(t,e){var r=t.map(function(n){return n.activeState.value});return new bt(r,e||0)}function em(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=Aa(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});l.length&&(l.forEach(function(c){return zi(c,n,a)}),o=Aa(n))})}function St(t){this.baseDir=t||"ltr",this.tokenizer=new Ne,this.featuresTags={}}St.prototype.setText=function(t){this.text=t};St.prototype.contextChecks={latinWordCheck:Jg,arabicWordCheck:Gg,arabicSentenceCheck:Hg};function li(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function tm(){return li.call(this,"latinWord"),li.call(this,"arabicWord"),li.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function rm(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}St.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};St.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new lt(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};St.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function Wi(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function nm(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Wi.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){qg.call(t,n)})}}function om(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){Wi.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){Zg.call(t,o)})}}}function im(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){Wi.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){em.call(t,o)})}}}St.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};St.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(nm.call(this),om.call(this)),this.checkContextReady("latinWord")&&im.call(this),this.checkContextReady("arabicSentence")&&rm.call(this)};St.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),tm.call(this),this.applyFeaturesToContexts())};St.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};St.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function Me(t){t=t||{},t.tables=t.tables||{},t.empty||(jr(t.familyName,"When creating a new Font object, familyName is required."),jr(t.styleName,"When creating a new Font object, styleName is required."),jr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),jr(t.ascender,"When creating a new Font object, ascender is required."),jr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new At.GlyphSet(this,t.glyphs||[]),this.encoding=new bu(this),this.position=new wn(this),this.substitution=new ut(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Gu(this)}})}Me.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Me.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Me.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Me.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};Me.prototype.stringToGlyphs=function(t,e){var r=this,n=new St,o=function(g){return r.charToGlyphIndex(g.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var a=n.getTextGlyphs(t),l=a.length,c=new Array(l),h=this.glyphs.get(0),v=0;v<l;v+=1)c[v]=this.glyphs.get(a[v])||h;return c};Me.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Me.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Me.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Me.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};Me.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Me.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var a=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,o),c;if(o.kerning){var h=o.script||this.position.getDefaultScriptName();c=this.position.getKerningTables(h,o.language)}for(var v=0;v<l.length;v+=1){var g=l[v];if(i.call(this,g,e,r,n,o),g.advanceWidth&&(e+=g.advanceWidth*a),o.kerning&&v<l.length-1){var d=c?this.position.getKerningValue(c,g.index,l[v+1].index):this.getKerningValue(g,l[v+1]);e+=d*a}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e};Me.prototype.getPath=function(t,e,r,n,o){var i=new We;return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var v=a.getPath(l,c,h,o,this);i.extend(v)}),i};Me.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var v=a.getPath(l,c,h,o,this);i.push(v)}),i};Me.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};Me.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)};Me.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawPoints(t,l,c,h)})};Me.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawMetrics(t,l,c,h)})};Me.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Me.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Me.prototype.toTables=function(){return $d.fontToTable(this)};Me.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Me.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r};Me.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(Yd())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i),a.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),a.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),h=jd(n);c.writeFileSync(t,h)}};Me.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Me.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Me.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var $t=new Array(10);$t[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(k.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(k.coverage),values:this.parseValueRecordList()};ee.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};$t[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();ee.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(k.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(k.pointer(k.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var a=this.parsePointer(k.classDef),l=this.parsePointer(k.classDef),c=this.parseUShort(),h=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:a,classDef2:l,class1Count:c,class2Count:h,classRecords:this.parseList(c,k.list(h,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}};$t[3]=function(){return{error:"GPOS Lookup 3 not supported"}};$t[4]=function(){return{error:"GPOS Lookup 4 not supported"}};$t[5]=function(){return{error:"GPOS Lookup 5 not supported"}};$t[6]=function(){return{error:"GPOS Lookup 6 not supported"}};$t[7]=function(){return{error:"GPOS Lookup 7 not supported"}};$t[8]=function(){return{error:"GPOS Lookup 8 not supported"}};$t[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const sm={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function am(t){const{dir:e,xAxis:r}=sm[t];return new Wu([0,0,0],e,r)}function Ra(t){const e=new M(t);let r=new M([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new M([0,1,0]),n=r.cross(e)),n.normalize()}class Wu extends at{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new M(n):Ra(r),i=fn(e,r,o);super(i)}get position(){return new M(this.wrapped.Location())}get direction(){return new M(this.wrapped.Direction())}get xAxis(){return new M(this.wrapped.XDirection())}get yAxis(){return new M(this.wrapped.YDirection())}autoAxes(){const e=Ra(this.direction);this.wrapped.SetXDirection(Ht(e))}setPosition(e){return this.wrapped.SetLocation(st(e)),this}setXAxis(e){return this.wrapped.SetYDirection(Ht(e)),this}setYAxis(e){return this.wrapped.SetYDirection(Ht(e)),this}lookAt(e){const r=new M("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const Pr=t=>t.IsNull()?[]:Fe(t).edges;function um(t,e,r=!0){const n=G(),o=Ae(),i=o(new n.HLRBRep_Algo_1);i.Add_2(t.wrapped,0);const a=o(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(a),i.Update(),i.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),c=[...Pr(l.VCompound_1()),...Pr(l.Rg1LineVCompound_1()),...Pr(l.OutLineVCompound_1())];c.forEach(v=>n.BRepLib.BuildCurves3d_2(v.wrapped));const h=r?[...Pr(l.HCompound_1()),...Pr(l.Rg1LineHCompound_1()),...Pr(l.OutLineHCompound_1())]:[];return h.forEach(v=>n.BRepLib.BuildCurves3d_2(v.wrapped)),{visible:c,hidden:h}}const wr=1e-8,Rr=(t,e)=>Ke(t,e,wr*10);function lm(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(h=>({offset:vi(h,r),original:h})),o=[];let i=null,a=n.at(-1);if(!a)return[];if(o.length===1)return o;const l=h=>{i?h.offset instanceof Ue?o.push(h.offset):Rr(h.offset.firstPoint,h.offset.lastPoint)||o.push(vn(h.offset.firstPoint,h.offset.lastPoint)):i=h},c=function*(){for(const h of n.slice(0,-1))yield h;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const h of c()){const v=a.offset.lastPoint,g=h.offset.firstPoint;if(Rr(v,g)){l(a),a=h;continue}let d=[];if(a.offset instanceof Ue&&h.offset instanceof Ue){const{intersections:T,commonSegmentsPoints:C}=dn(a.offset,h.offset,wr/100);d=[...T,...C]}if(d.length>0){let T=d[0];if(d.length>1){const P=a==null?void 0:a.original.lastPoint,D=d.map(O=>ah(O,P));T=d[D.indexOf(Math.min(...D))]}const C=a.offset.splitAt([T],wr)[0],x=h.offset.splitAt([T],wr).at(-1);if(!x)throw new Error("Bug in the splitting algo in offset");l({offset:C,original:a.original}),a={offset:x,original:h.original};continue}const w=Xa(v,g,a.original.lastPoint);l(a),o.push(w),a=h}return l(a),o}function cm(t,e){const r=lm(t,e);if(r.length<2)return null;const n=new Map,o=(h,v)=>{const g=n.get(h)||[];n.set(h,[...g,...v])};if(r.forEach((h,v)=>{r.slice(v+1).forEach((g,d)=>{const{intersections:w,commonSegmentsPoints:T}=dn(h,g,wr),C=[...w,...T].filter(x=>{const P=Rr(x,h.firstPoint)||Rr(x,h.lastPoint),D=Rr(x,g.firstPoint)||Rr(x,g.lastPoint);return!(P&&D)});C.length&&(o(v,C),o(d+v+1,C))})}),!n.size){const h=new ae(r);return t.intersects(h)?null:h}const a=r.flatMap((h,v)=>{if(!n.has(v))return h;const g=n.get(v)||[];return h.splitAt(g,wr*100)}).filter(h=>!t.curves.find(g=>g.distanceFrom(h)<Math.abs(e)-wr));if(!a.length)return null;const c=ja(a).filter(h=>h.length>1).map(h=>new ae(h)).filter(h=>h.isClosed());return c.length?c.length===1?c[0]:new J(c):null}const Oa=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=Nt(e,t[r]);return e};function to(t,e){if(t instanceof ae)return cm(t,e);if(t instanceof J)return Oa(t.blueprints.map(r=>to(r,e)));if(t instanceof Ee){const r=Oa(t.blueprints.slice(1).map(n=>to(n,e)));return tr(to(t.blueprints[0],e),r)}return null}function Ma(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],a=(c,h)=>{o({firstCurve:c,secondCurve:h,point:c.lastPoint})?i.push(...t(c,h,r)):i.push(c,h)};e.curves.slice(1).forEach(c=>{const h=i.pop();if(!h)throw new Error("Bug in the blueprint filletting algo");a(h,c)});const l=i.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(Ke(i[0].firstPoint,l.lastPoint)&&i.length>1){const c=i.pop(),h=i.shift();if(!c||!h)throw new Error("Bug in the blueprint filletting algo");a(c,h)}return new ae(i)}function $i(t,e,r,n){if(e instanceof ae)return Ma(t,e,r,n);if(e instanceof Ee)return new Ee(e.blueprints.map(o=>Ma(t,o,r,n)));if(e instanceof J){const o=e.blueprints.map(i=>$i(t,i,r,n)).filter(i=>i!==null);return new J(o)}return null}function fm(t,e,r){return $i(gi,t,e,r)}function hm(t,e,r){return $i(mi,t,e,r)}function Pi(t,e){return t instanceof ae?new ae(io(t.curves,e)):t instanceof Ee?new Ee(t.blueprints.map(r=>Pi(r,e))):t instanceof J?new J(t.blueprints.map(r=>Pi(r,e))):t}class Be{constructor(e=null){this.innerShape=e}clone(){var e;return new Be(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new pn}stretch(e,r,n){return this.innerShape?new Be(this.innerShape.stretch(e,r,n)):new Be}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Be(this.innerShape.rotate(e,r)):new Be}translate(e,r=0){return this.innerShape?new Be(this.innerShape.translate(e,r)):new Be}scale(e,r){return this.innerShape?new Be(this.innerShape.scale(e,r)):new Be}mirror(e,r,n){return this.innerShape?new Be(this.innerShape.mirror(e,r,n)):new Be}cut(e){return new Be(tr(this.innerShape,e.innerShape))}fuse(e){return new Be(Nt(this.innerShape,e.innerShape))}intersect(e){return new Be(Qr(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new uo);return new Be(fm(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new uo);return new Be(hm(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Be(to(this.innerShape,e))}approximate(e,r={}){if(e!=="svg")throw new Error("Only 'svg' is supported for now");return new Be(Pi(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof ae)){if(this.innerShape instanceof J&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof ae)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class pm extends hu{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Be(new ae(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}function dm(t){const e=new pm;return t&&e.movePointerTo(t),e}function vm(t,e,r=0){return new Be(rp(t,e,r))}const gm=vm,Da=t=>{const e=gm(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>qh(o,e)),n=ja(r).map(o=>new ae(o));return n.length===0?new Be:n.length===1?new Be(n[0]):new Be(new J(n))};function ct(t,e="front"){let r;e instanceof Wu?r=e:r=am(e);const{visible:n,hidden:o}=um(t,r);return{visible:Da(n),hidden:Da(o)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const $u=Symbol("Comlink.proxy"),mm=Symbol("Comlink.endpoint"),ym=Symbol("Comlink.releaseProxy"),ci=Symbol("Comlink.finalizer"),ro=Symbol("Comlink.thrown"),Xu=t=>typeof t=="object"&&t!==null||typeof t=="function",wm={canHandle:t=>Xu(t)&&t[$u],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Xi(t,e),[r,[r]]},deserialize(t){return t.start(),Tm(t)}},bm={canHandle:t=>Xu(t)&&ro in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Yu=new Map([["proxy",wm],["throw",bm]]);function _m(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Xi(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!_m(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:a,path:l}=Object.assign({path:[]},o.data),c=(o.data.argumentList||[]).map(mr);let h;try{const v=l.slice(0,-1).reduce((d,w)=>d[w],t),g=l.reduce((d,w)=>d[w],t);switch(a){case"GET":h=g;break;case"SET":v[l.slice(-1)[0]]=mr(o.data.value),h=!0;break;case"APPLY":h=g.apply(v,c);break;case"CONSTRUCT":{const d=new g(...c);h=km(d)}break;case"ENDPOINT":{const{port1:d,port2:w}=new MessageChannel;Xi(t,w),h=Pm(d,[d])}break;case"RELEASE":h=void 0;break;default:return}}catch(v){h={value:v,[ro]:0}}Promise.resolve(h).catch(v=>({value:v,[ro]:0})).then(v=>{const[g,d]=To(v);e.postMessage(Object.assign(Object.assign({},g),{id:i}),d),a==="RELEASE"&&(e.removeEventListener("message",n),ju(e),ci in t&&typeof t[ci]=="function"&&t[ci]())}).catch(v=>{const[g,d]=To({value:new TypeError("Unserializable return value"),[ro]:0});e.postMessage(Object.assign(Object.assign({},g),{id:i}),d)})}),e.start&&e.start()}function Sm(t){return t.constructor.name==="MessagePort"}function ju(t){Sm(t)&&t.close()}function Tm(t,e){const r=new Map;return t.addEventListener("message",function(o){const{data:i}=o;if(!i||!i.id)return;const a=r.get(i.id);if(a)try{a(i)}finally{r.delete(i.id)}}),ki(t,r,[],e)}function jn(t){if(t)throw new Error("Proxy has been released and is not useable")}function qu(t){return kr(t,new Map,{type:"RELEASE"}).then(()=>{ju(t)})}const _o=new WeakMap,So="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(_o.get(t)||0)-1;_o.set(t,e),e===0&&qu(t)});function Em(t,e){const r=(_o.get(e)||0)+1;_o.set(e,r),So&&So.register(t,e,t)}function xm(t){So&&So.unregister(t)}function ki(t,e,r=[],n=function(){}){let o=!1;const i=new Proxy(n,{get(a,l){if(jn(o),l===ym)return()=>{xm(i),qu(t),e.clear(),o=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const c=kr(t,e,{type:"GET",path:r.map(h=>h.toString())}).then(mr);return c.then.bind(c)}return ki(t,e,[...r,l])},set(a,l,c){jn(o);const[h,v]=To(c);return kr(t,e,{type:"SET",path:[...r,l].map(g=>g.toString()),value:h},v).then(mr)},apply(a,l,c){jn(o);const h=r[r.length-1];if(h===mm)return kr(t,e,{type:"ENDPOINT"}).then(mr);if(h==="bind")return ki(t,e,r.slice(0,-1));const[v,g]=Fa(c);return kr(t,e,{type:"APPLY",path:r.map(d=>d.toString()),argumentList:v},g).then(mr)},construct(a,l){jn(o);const[c,h]=Fa(l);return kr(t,e,{type:"CONSTRUCT",path:r.map(v=>v.toString()),argumentList:c},h).then(mr)}});return Em(i,t),i}function Cm(t){return Array.prototype.concat.apply([],t)}function Fa(t){const e=t.map(To);return[e.map(r=>r[0]),Cm(e.map(r=>r[1]))]}const Zu=new WeakMap;function Pm(t,e){return Zu.set(t,e),t}function km(t){return Object.assign(t,{[$u]:!0})}function To(t){for(const[e,r]of Yu)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},Zu.get(t)||[]]}function mr(t){switch(t.type){case"HANDLER":return Yu.get(t.name).deserialize(t.value);case"RAW":return t.value}}function kr(t,e,r,n){return new Promise(o=>{const i=Am();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function Am(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ku(t,e){return typeof t!="number"||isNaN(t)?{valid:!1,message:`Parameter '${e}' must be a number`}:{valid:!0}}function Rm(t,e){return t<=0?{valid:!1,message:`Parameter '${e}' must be positive`}:{valid:!0}}function Om(t,e,r){return t>=e?{valid:!1,message:`${r} (${t}) must be less than ${e}`}:{valid:!0}}function Tt(t,e){const r=Ku(t,e);return r.valid?Rm(t,e):r}function Mm(t,e,r){const n=Ku(t,r);return n.valid?Om(t,e,r):n}function Et(t,e){return r=>{const n=[];for(const o of e){const i=t(r[o],o);i.valid||n.push(i.message)}return{valid:n.length===0,errors:n}}}function Ba(t,e){return r=>{const n=r[t],o=r[e],i=Mm(n,o,t);return i.valid?{valid:!0,errors:[]}:{valid:!1,errors:[i.message]}}}function Dm(t,e){let r=!0;const n=[];if(e.params)for(const o of e.params){const{name:i,validators:a}=o;if(!a)continue;const l=t[i];for(const c of a){const h=c(l,i);if(!h.valid){r=!1,n.push(h.message);break}}}if(e.validators)for(const o of e.validators){const i=o(t);i.valid||(r=!1,n.push(...i.errors))}return{valid:r,errors:n}}function Dr({width:t=100,depth:e=100,height:r=100}){if(t===0&&e===0&&r===0)return ke([0,0,0],[1e-7,1e-7,1e-7]);const n=t/2,o=e/2;return ke([-n,-o,0],[n,o,r])}const Fm={name:"Cuboid",create:Dr,params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],validators:[Et(Tt,["width","depth","height"])],hasExplosion:!1};function Bm({radius:t=50}){return Mh(t)}const Lm={name:"Sphere",create:Bm,params:[{name:"radius",defaultValue:50}],validators:[Et(Tt,["radius"])],hasExplosion:!1};function Qu({radius:t=50,height:e=100}){return lo(t,e,[0,0,0],[0,0,-1])}const Um={name:"Cylinder",create:Qu,params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],validators:[Et(Tt,["radius","height"])],hasExplosion:!1};function Im({aLength:t=80,bLength:e=50,cLength:r=30}){return Bh(t,e,r)}const Gm={name:"Ellipsoid",create:Im,params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],validators:[Et(Tt,["aLength","bLength","cLength"])],hasExplosion:!1},Ju=t=>t.boundingBox.center;function el(t,e,r){return r.map(({position:n,direction:o,orientation:i})=>{const a=t(),l=e(a);let c=a.translate([n[0]-l[0],n[1]-l[1],n[2]-l[2]]);const h=[0,0,1],v=new M(i||o);if(v.Length>0){const g=new M(h).cross(v);if(g.Length>1e-10){const d=new M(h).getAngle(v);c=c.rotate(d,n,g)}else v.dot(new M(h))<0&&(c=c.rotate(180,n,[1,0,0]))}return c})}function tl(t,e,r,n,o,i=0,a=0,l=1){const c=new M([i,a,l]).normalized();return Array.from({length:e*r},(h,v)=>{const g=Math.floor(v/r),w=v%r*n,T=g*o,x=new Je(new M(t.origin),new M(t.xDirection).normalized(),new M(t.normal).normalized()).toWorldCoords([w,T,0]);return{position:[x.x,x.y,x.z],direction:[t.normal[0],t.normal[1],t.normal[2]],orientation:[c.x,c.y,c.z]}})}function Nm(t,e,r,n=0,o=0,i=1){return tl({origin:t,xDirection:e,normal:(()=>{const a=new M(e),l=new M([0,0,1]),c=Math.abs(a.normalized().dot(l))>.99?new M([1,0,0]):a.cross(l).normalized();return[c.x,c.y,c.z]})()},1,r,r>1?new M(e).Length/(r-1):0,0,n,o,i)}function Vm({count:t=5,vectorX:e=0,vectorY:r=50,vectorZ:n=50,originX:o=0,originY:i=0,originZ:a=0,boxWidth:l=10,boxDepth:c=10,boxHeight:h=10,orientationX:v=0,orientationY:g=0,orientationZ:d=1}){return Pt(el(()=>Dr({width:l,depth:c,height:h}),Ju,Nm([o,i,a],[e,r,n],t,v,g,d)))}const Hm={name:"DiagonalCuboidPattern",create:Vm,params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[Et(Tt,["count","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function zm({originX:t=0,originY:e=0,originZ:r=0,directionX:n=1,directionY:o=0,directionZ:i=0,normalX:a=0,normalY:l=0,normalZ:c=1,rowCount:h=3,colCount:v=3,xSpacing:g=30,ySpacing:d=30,boxWidth:w=10,boxDepth:T=10,boxHeight:C=10,orientationX:x=0,orientationY:P=0,orientationZ:D=1}){return Pt(el(()=>Dr({width:w,depth:T,height:C}),Ju,tl({origin:[t,e,r],xDirection:[n,o,i],normal:[a,l,c]},h,v,g,d,x,P,D)))}const Wm={name:"RectangularCuboidGrid",create:zm,params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[Et(Tt,["rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function rl({depth:t=100,flangeXLenght:e=50,flangeYLenght:r=50,thickness:n=5}){const o=ke([0,-t/2,0],[e,t/2,n]),i=ke([0,-t/2,0],[n,t/2,r]);return o.fuse(i)}const $m={name:"LProfile",create:rl,params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],validators:[Et(Tt,["depth","flangeXLenght","flangeYLenght","thickness"]),Ba("thickness","flangeXLenght"),Ba("thickness","flangeYLenght")],hasExplosion:!1};function nl({bottomRadius:t=50,topRadius:e=25,height:r=100}){return Xs(t,{plane:"XY",origin:[0,0,0]}).loftWith(Xs(e,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}const Xm={name:"Frustum",create:nl,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],validators:[Et(Tt,["bottomRadius","topRadius","height"])],hasExplosion:!1};function ol({bottomRadius:t=50,topRadius:e=25,frustumHeight:r=80,cylinderHeight:n=40}){return nl({bottomRadius:t,topRadius:e,height:r}).fuse(lo(e,n,[0,0,-r],[0,0,-1]))}const Ym={name:"Drill",create:ol,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],validators:[Et(Tt,["bottomRadius","topRadius","frustumHeight","cylinderHeight"])],hasExplosion:!1};function jm(t,e){return{main:t,helperSpaces:e}}function fi(t){return t.main||t}const se={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},fe={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function qn(t){let e;switch(t){case se.FRONT:e=new M([0,-1,0]);break;case se.BACK:e=new M([0,1,0]);break;case se.LEFT:e=new M([-1,0,0]);break;case se.RIGHT:e=new M([1,0,0]);break;case se.TOP:e=new M([0,0,1]);break;case se.BOTTOM:e=new M([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return e}function il(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case fe.FRONT_TOP:c=new M([r,n,l]);break;case fe.FRONT_BOTTOM:c=new M([r,n,o]);break;case fe.BACK_TOP:c=new M([r,a,l]);break;case fe.BACK_BOTTOM:c=new M([r,a,o]);break;case fe.LEFT_TOP:c=new M([r,n,l]);break;case fe.LEFT_BOTTOM:c=new M([r,n,o]);break;case fe.RIGHT_TOP:c=new M([i,n,l]);break;case fe.RIGHT_BOTTOM:c=new M([i,n,o]);break;case fe.FRONT_LEFT:c=new M([r,n,o]);break;case fe.FRONT_RIGHT:c=new M([i,n,o]);break;case fe.BACK_LEFT:c=new M([r,a,o]);break;case fe.BACK_RIGHT:c=new M([i,a,o]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function sl(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case fe.FRONT_TOP:c=new M([i,n,l]);break;case fe.FRONT_BOTTOM:c=new M([i,n,o]);break;case fe.BACK_TOP:c=new M([i,a,l]);break;case fe.BACK_BOTTOM:c=new M([i,a,o]);break;case fe.LEFT_TOP:c=new M([r,a,l]);break;case fe.LEFT_BOTTOM:c=new M([r,a,o]);break;case fe.RIGHT_TOP:c=new M([i,a,l]);break;case fe.RIGHT_BOTTOM:c=new M([i,a,o]);break;case fe.FRONT_LEFT:c=new M([r,n,l]);break;case fe.FRONT_RIGHT:c=new M([i,n,l]);break;case fe.BACK_LEFT:c=new M([r,a,l]);break;case fe.BACK_RIGHT:c=new M([i,a,l]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function qm(t){switch(t){case fe.FRONT_LEFT:return[se.FRONT,se.LEFT];case fe.FRONT_RIGHT:return[se.FRONT,se.RIGHT];case fe.FRONT_TOP:return[se.FRONT,se.TOP];case fe.FRONT_BOTTOM:return[se.FRONT,se.BOTTOM];case fe.BACK_LEFT:return[se.BACK,se.LEFT];case fe.BACK_RIGHT:return[se.BACK,se.RIGHT];case fe.BACK_TOP:return[se.BACK,se.TOP];case fe.BACK_BOTTOM:return[se.BACK,se.BOTTOM];case fe.LEFT_TOP:return[se.LEFT,se.TOP];case fe.LEFT_BOTTOM:return[se.LEFT,se.BOTTOM];case fe.RIGHT_TOP:return[se.RIGHT,se.TOP];case fe.RIGHT_BOTTOM:return[se.RIGHT,se.BOTTOM];default:throw new Error(`Unknown edge identifier: ${t}`)}}function Zm(t,e,r=.5,n=.5){const[[o,i,a],[l,c,h]]=t.bounds,v=Math.max(0,Math.min(1,r)),g=Math.max(0,Math.min(1,n));let d;switch(e){case se.FRONT:d=new M([o+(l-o)*v,i,a+(h-a)*g]);break;case se.BACK:d=new M([o+(l-o)*v,c,a+(h-a)*g]);break;case se.LEFT:d=new M([o,i+(c-i)*v,a+(h-a)*g]);break;case se.RIGHT:d=new M([l,i+(c-i)*v,a+(h-a)*g]);break;case se.TOP:d=new M([o+(l-o)*v,i+(c-i)*g,h]);break;case se.BOTTOM:d=new M([o+(l-o)*v,i+(c-i)*g,a]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return d}function Km(t,e,r=.5){const n=Math.max(0,Math.min(1,r)),o=il(t,e),i=sl(t,e);return new M([o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n,o.z+(i.z-o.z)*n])}function Qm(t,e){const{type:r,element:n,params:o={}}=e;switch(r){case"face":return Zm(t,n,o.u,o.v);case"edge":return Km(t,n,o.t);case"corner":if(n.includes("START")){const i=n.replace("_START","");return il(t,i)}else if(n.includes("END")){const i=n.replace("_END","");return sl(t,i)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new M(t.center);default:throw new Error(`Unknown position type: ${r}`)}}function Jm(t){const e=t.normalized(),r=Math.abs(e.x),n=Math.abs(e.y),o=Math.abs(e.z);let i;return r<=n&&r<=o?i=new M([0,e.z,-e.y]):n<=r&&n<=o?i=new M([e.z,0,-e.x]):i=new M([e.y,-e.x,0]),i.normalized()}function Zn(t,e,r,n={}){const o=Qm(t.boundingBox,e);let i;n.normal?i=new M(n.normal):i=e0(t,e,n);let a;n.xDir?a=new M(n.xDir):a=Jm(i);const l=new br;l.coordSystemChange({origin:o.toTuple(),zDir:i.toTuple(),xDir:a.toTuple()},"reference");const c=Fe(l.transform(r.wrapped));return l.delete(),i.delete(),a.delete(),o.delete(),c}function e0(t,e,r={}){const{type:n,element:o}=e;switch(n){case"face":return qn(o);case"edge":if(r.faceForEdge)return qn(r.faceForEdge);{const i=qm(o);return qn(i[0])}case"corner":return r.faceForCorner?qn(r.faceForCorner):new M([0,0,1]);case"center":default:return new M([0,0,1])}}function vr(t,e,r,n=!1){return n?Fe(t.wrapped).mirror(e,r):t.mirror(e,r)}function t0({width:t=50,depth:e=100,height:r=200,showHelper:n=!0,explosionFactor:o=0}){const i=Dr({width:t,depth:e,height:r}),a=Math.round(r/17.5)-1;if(a<=0)return jm(Pt([]),n?[i]:[]);const l=r/(a+1),c=a>1?(e-28)/(a-1):0,h=Dr({width:t-1,depth:20,height:.5}),v=h.boundingBox.center,g=Zn(h,{type:"face",element:se.TOP,params:{u:1.5/(t-1),v:2.25/20}},ol({bottomRadius:1.2,topRadius:.8,frustumHeight:.5*.8,cylinderHeight:.5*.2})),d=h.cut(g).cut(vr(g,"XZ",v,!0)).cut(vr(g,"YZ",v,!0)).cut(vr(vr(g,"XZ",v,!0),"YZ",v,!0)),w=d.clone(),T=rl({depth:20,flangeXLenght:4.5,flangeYLenght:4.5,thickness:.5}),C=T.boundingBox.center,x=Zn(T,{type:"face",element:se.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},Qu({radius:.800001,height:.5})),P=T.cut(x).cut(vr(x,"XZ",C,!0)),D=P.clone(),O=Zn(d,{type:"edge",element:fe.LEFT_BOTTOM,params:{t:.5}},P,{normal:[0,0,-1],xDir:[1,0,0]}),z=vr(O,"YZ",v,!0),N=[];let Z=0,j=-e/2+14,K=l-(d.boundingBox.bounds[1][2]-d.boundingBox.bounds[0][2]);for(let dt=0;dt<a;dt++){const ot=o*15;N.push(d.clone().translate([Z,j,K])),N.push(O.clone().translate([Z-ot,j,K])),N.push(z.clone().translate([Z+ot,j,K])),j+=c,K+=l}const ie=Dr({width:600,depth:20,height:.5}),me=c,Te=l,ye=Math.sqrt(me*me+Te*Te),xe=ye>.001?[0,me/ye,Te/ye]:[1,0,0],le=Zn(i,{type:"face",element:se.RIGHT},ie,{normal:[-1,0,0],xDir:xe}).intersect(i),de=le.clone(),ce=i.boundingBox.center,te=vr(le,"YZ",ce,!0),ue=o*30,ve=o*30;N.push(le.translate([ue,0,0])),N.push(te.translate([-ve,0,0]));const he=Pt(N),Ce=[{id:"ST001",name:"Stringer",quantity:a,dimensions:`${t-1}200.5cm`,material:"Steel"},{id:"LP001",name:"L-Profile",quantity:a*2,dimensions:"4.54.520cm",material:"Steel"},{id:"SS001",name:"Side Stringer",quantity:2,dimensions:"Variable",material:"Steel"}];return{main:he,helperSpaces:n?[i]:[],componentData:Ce,technicalDrawingModels:{ST001:w,LP001:D,SS001:de}}}const r0={name:"Staircase",create:t0,params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],validators:[Et(Tt,["width","depth","height"])],hasExplosion:!0};function n0({width:t,depth:e,board_thickness:r}){let n=[];const a=Math.floor(e/100),l=Math.floor((e-r)/100),c=Math.floor(e/150),h=(e-a*5)/(a+1),v=(e-r-l*5)/(l+1),g=(2*e/3-c*5)/(c+1),d=dm([-2.4,.25]).bulgeArcTo([2.4,.25],-.03).tangentArcTo([2.4,-.25]).bulgeArcTo([-2.4,-.25],-.03).tangentArcTo([-2.4,.25]).close().sketchOnPlane("XZ",-.15).extrude(.3),w=[];for(let Y=0;Y<a;Y++){const pe=d.clone().translate(h+2.5+Y*(5+h),-t/2+r/2,50);w.push(pe),n.push(pe.clone()),n.push(pe.clone().mirror("XZ"))}const T=Zt(w),C=[];for(let Y=0;Y<l;Y++){const pe=d.clone().rotate(90,[0,0,0],[1,0,0]).translate(v+2.5+Y*(5+v),-t/2+r,3*r/2);C.push(pe),n.push(pe.clone()),n.push(pe.clone().mirror("XZ"))}const x=Zt(C),P=ke([0,-t/2,0],[e,-t/2+r,50]).cut(T).cut(x);n.push(P),n.push(P.clone().mirror("XZ"));const D=ke([e,-t/2,0],[e+.2,-t/2+r,50]);n.push(D),n.push(D.clone().mirror("XZ"));const O=[];for(let Y=0;Y<l;Y++){const pe=d.clone().translate(v+2.5+Y*(5+v),t/6,2*r);O.push(pe),n.push(pe.clone()),n.push(pe.clone().mirror("XZ"))}const z=Zt(O),N=ke([0,-t/2+r,r],[e-r-.2,t/2-r,2*r]).cut(x).cut(x.mirror("XZ")).cut(z).cut(z.clone().mirror("XZ"));n.push(N);const Z=ke([e-r-.2,-t/2+r,r],[e-r,t/2-r,2*r]);n.push(Z);const j=[];for(let Y=0;Y<l;Y++){const pe=d.clone().translate(v+2.5+Y*(5+v),t/6,50);j.push(pe),n.push(pe.clone()),n.push(pe.clone().mirror("XZ"))}const K=Zt(j),ie=ke([0,t/6-r/2,2*r],[e-r-.2,t/6+r/2,50]).cut(z).cut(K);n.push(ie),n.push(ie.clone().mirror("XZ"));const me=ke([e-r-.2,t/6-r/2,2*r],[e-r,t/6+r/2,50]);n.push(me),n.push(me.clone().mirror("XZ"));const Te=[];for(let Y=0;Y<c;Y++){const pe=d.clone().translate(g+2.5+Y*(5+g),t/4,50+r);Te.push(pe),n.push(pe.clone()),n.push(pe.clone().mirror("XZ"))}const ye=Zt(Te),xe=ke([0,-t/2,50],[e,t/2,50+r]).cut(T).cut(T.mirror("XZ")).cut(K).cut(K.mirror("XZ")).cut(ye).cut(ye.clone().mirror("XZ"));n.push(xe);const re=ke([e,-t/2,50],[e+.2,t/2,50+r]);n.push(re);const le=[];for(let Y=0;Y<c;Y++){const pe=d.clone().translate(g+2.5+Y*(5+g),t/4,50+6*(r+30));le.push(pe),n.push(pe.clone()),n.push(pe.clone().mirror("XZ"))}const de=Zt(le),te=Zt([]),ue=ke([0,t/4-r/2,50+r],[2*e/3,t/4+r/2,50+6*(r+30)]).cut(ye).cut(de).cut(te);n.push(ue),n.push(ue.clone().mirror("XZ"));const ve=ke([2*e/3,t/4-r/2,50+r],[2*e/3+.2,t/4+r/2,50+6*(r+30)]);n.push(ve),n.push(ve.clone().mirror("XZ"));const he=ke([0,-t/2,50+6*(r+30)],[e,t/2,50+7*r+6*30]).cut(de).cut(de.mirror("XZ"));n.push(he);const Ce=ke([e,-t/2,50+6*(r+30)],[e+.2,t/2,50+7*r+6*30]);n.push(Ce);const nt=ke([e-r,-t/2+r+.4,r],[e,-t/6-.3,50-.4]);n.push(nt),n.push(nt.clone().mirror("XZ"));const dt=ke([e-r,-t/6+.3,r],[e,t/6-.3,50-.4]);n.push(dt);const ot=ke([e-r,-t/6-.3,r],[e,-t/6-.1,50-.4]),vt=ke([e-r,-t/2+r+.2,r],[e,-t/2+r+.4,50-.4]),Rt=ke([e-r,-t/2+r+.4,50-.4],[e,-t/6-.3,50-.2]),et=ke([e-r,-t/2+r+.4,r],[e,-t/6-.3,r+.2]);n.push(ot),n.push(vt),n.push(Rt),n.push(et),n.push(ot.clone().mirror("XZ")),n.push(vt.clone().mirror("XZ")),n.push(Rt.clone().mirror("XZ")),n.push(et.clone().mirror("XZ"));const ge=ke([e-r,-t/6+.1,r],[e,-t/6+.3,50-.4]),Re=ke([e-r,t/6-.3,r],[e,t/6-.1,50-.4]),Oe=ke([e-r,-t/6+.3,50-.4],[e,t/6-.3,50-.2]),it=ke([e-r,-t/6+.3,r],[e,t/6-.3,r+.2]);n.push(ge),n.push(Re),n.push(Oe),n.push(it);const L=lo(.5,2,[e,t/6+r,50-r],[1,0,0]).fuse(lo(1,1,[e+2,t/6+r,50-r],[1,0,0]));return n.push(L),n.push(L.clone().mirror("XZ")),n.push(L.clone().translateY(-2*r)),Zt(n)}const o0={name:"Closet",create:n0,params:[{name:"width",defaultValue:200,description:"Overall width of the closet"},{name:"depth",defaultValue:50,description:"Overall depth of the closet"},{name:"board_thickness",defaultValue:3,description:"Thickness of the boards used"}],validators:[Et(Tt,["width","depth","board_thickness"])],hasExplosion:!1,hasBoM:!0},i0={Cuboid:Fm,Sphere:Lm,Cylinder:Um,Ellipsoid:Gm,DiagonalCuboidPattern:Hm,RectangularCuboidGrid:Wm,LProfile:$m,Frustum:Xm,Drill:Ym,Closet:o0,Staircase:{...r0,hasBoM:!0}};function al(t,e){const r=i0[t];if(!r)throw new Error(`Model "${t}" not found`);const n=Dm(e,r);return n.valid?r.create(e):{error:!0,validationErrors:n.errors}}function Ye(t){if(!t||typeof t!="string")return null;const e=t.split(/[\s,]+/).map(parseFloat);if(e.length!==4||e.some(isNaN))return console.warn("Could not parse viewBox string:",t),null;const r=Math.max(0,e[2]),n=Math.max(0,e[3]);return{x:e[0],y:e[1],width:r,height:n}}function s0(t,e){const r="0 0 100 100",n=Ye(t),o=Ye(e);if(!n&&!o)return r;if(!n)return e||r;if(!o)return t||r;const i=Math.min(n.x,o.x),a=Math.min(n.y,o.y),l=Math.max(n.x+n.width,o.x+o.width),c=Math.max(n.y+n.height,o.y+o.height),h=Math.max(0,l-i),v=Math.max(0,c-a);return`${i} ${a} ${h} ${v}`}const ht=1e-6;function nr(t,e,r=ht){return!t||!e?!1:Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))<r}function La(t,e,r,n=ht){if(!t||!e||!r)return!1;if(Math.abs(t[0]-e[0])<n&&Math.abs(e[0]-r[0])<n||Math.abs(t[1]-e[1])<n&&Math.abs(e[1]-r[1])<n)return!0;const o=Math.abs((e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])),i=Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2);return i<n*n?!0:o/Math.sqrt(i)<n}function a0(t){if(!t||typeof t!="string")return console.error("Invalid input to parsePathData:",t),[];const e=/([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/ig,r=[];let n;for(;(n=e.exec(t))!==null;){const o=n[1],i=n[2].trim(),a=/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g,l=(i.match(a)||[]).map(Number);if(l.some(isNaN)){console.warn(`Skipping command due to invalid parameters: ${n[0]}`);continue}r.push({command:o,values:l})}return r}function u0(t,e,r){t.forEach(n=>{const o=n.command,i=n.values;if(o===o.toUpperCase()&&o!=="Z")for(let a=0;a<i.length;a++)switch(o){case"M":case"L":case"T":i[a]+=a%2===0?e:r;break;case"H":i[a]+=e;break;case"V":i[a]+=r;break;case"C":i[a]+=a%2===0?e:r;break;case"S":case"Q":i[a]+=a%2===0?e:r;break;case"A":a>=5&&(i[a]+=a%2!==0?e:r);break}})}function l0(t){return t.map(e=>{const r=e.values.map(n=>Math.abs(n)>1e6||Math.abs(n)<1e-4&&n!==0?n.toExponential(4):parseFloat(n.toFixed(4))).join(" ");return`${e.command}${r}`}).join("")}function c0(t){const e=fi(t);if(t&&t.technicalDrawingModels){const n=[],o=[];return Object.entries(t.technicalDrawingModels).forEach(([i,a])=>{try{const l=fi(a),c=l.boundingBox.center;console.log(`Model ${i} original center:`,c);const h=l.translate([-c[0],-c[1],-c[2]]);console.log(`Model ${i} new center:`,h.boundingBox.center),o.push(h);const v=t.componentData.find(z=>z.id===i||z.name.toLowerCase().includes(i.toLowerCase())),g=ct(h,"front"),d=ct(h,"top"),w=ct(h,"right");console.log(`${i} front view bounds:`,g.visible.toSVGViewBox()),console.log(`${i} top view bounds:`,d.visible.toSVGViewBox()),console.log(`${i} right view bounds:`,w.visible.toSVGViewBox());const T=Ye(g.visible.toSVGViewBox()),C=Ye(d.visible.toSVGViewBox()),x=Ye(w.visible.toSVGViewBox()),P=Math.max((T==null?void 0:T.width)||0,(C==null?void 0:C.width)||0,(x==null?void 0:x.width)||0),D=Math.max((T==null?void 0:T.height)||0,(C==null?void 0:C.height)||0,(x==null?void 0:x.height)||0);T&&(g.normalizedViewBox=ft(T,P,D)),C&&(d.normalizedViewBox=ft(C,P,D)),x&&(w.normalizedViewBox=ft(x,P,D));const O={front:g,top:d,right:w};n.push({name:v?v.name:i,views:O})}catch(l){console.error(`Error processing model ${i}:`,l)}}),console.log("All projections completed with",o.length,"centered models"),{parts:n}}const r=[];try{const n=fi(e),o=n.boundingBox.center;console.log("Main model original center:",o);const i=n.translate([-o[0],-o[1],-o[2]]);console.log("Main model new center:",i.boundingBox.center),r.push(i);const a=ct(i,"front"),l=ct(i,"top"),c=ct(i,"right");console.log("Standard front view bounds:",a.visible.toSVGViewBox()),console.log("Standard top view bounds:",l.visible.toSVGViewBox()),console.log("Standard right view bounds:",c.visible.toSVGViewBox());const h=Ye(a.visible.toSVGViewBox()),v=Ye(l.visible.toSVGViewBox()),g=Ye(c.visible.toSVGViewBox()),d=Math.max((h==null?void 0:h.width)||0,(v==null?void 0:v.width)||0,(g==null?void 0:g.width)||0),w=Math.max((h==null?void 0:h.height)||0,(v==null?void 0:v.height)||0,(g==null?void 0:g.height)||0);h&&(a.normalizedViewBox=ft(h,d,w)),v&&(l.normalizedViewBox=ft(v,d,w)),g&&(c.normalizedViewBox=ft(g,d,w));let T=[];if(t&&t.main&&Array.isArray(t.helperSpaces)){const C=t.main,x=C.boundingBox.center;console.log("Component main original center:",x);const P=C.translate([-x[0],-x[1],-x[2]]);console.log("Component main new center:",P.boundingBox.center),r.push(P);const D=ct(P,"front"),O=ct(P,"top"),z=ct(P,"right"),N=Ye(D.visible.toSVGViewBox()),Z=Ye(O.visible.toSVGViewBox()),j=Ye(z.visible.toSVGViewBox()),K=Math.max((N==null?void 0:N.width)||0,(Z==null?void 0:Z.width)||0,(j==null?void 0:j.width)||0),ie=Math.max((N==null?void 0:N.height)||0,(Z==null?void 0:Z.height)||0,(j==null?void 0:j.height)||0);N&&(D.normalizedViewBox=ft(N,K,ie)),Z&&(O.normalizedViewBox=ft(Z,K,ie)),j&&(z.normalizedViewBox=ft(j,K,ie)),T=[{name:"Main Component",views:{front:D,top:O,right:z}}],t.helperSpaces.forEach((Te,ye)=>{const xe=Te.boundingBox.center;console.log(`Helper space ${ye} original center:`,xe);const re=Te.translate([-xe[0],-xe[1],-xe[2]]);console.log(`Helper space ${ye} new center:`,re.boundingBox.center),r.push(re);const le=ct(re,"front"),de=ct(re,"top"),ce=ct(re,"right"),te=Ye(le.visible.toSVGViewBox()),ue=Ye(de.visible.toSVGViewBox()),ve=Ye(ce.visible.toSVGViewBox()),he=Math.max((te==null?void 0:te.width)||0,(ue==null?void 0:ue.width)||0,(ve==null?void 0:ve.width)||0),Ce=Math.max((te==null?void 0:te.height)||0,(ue==null?void 0:ue.height)||0,(ve==null?void 0:ve.height)||0);te&&(le.normalizedViewBox=ft(te,he,Ce)),ue&&(de.normalizedViewBox=ft(ue,he,Ce)),ve&&(ce.normalizedViewBox=ft(ve,he,Ce));const nt={front:le,top:de,right:ce};T.push({name:`Helper Space ${ye+1}`,views:nt})})}return console.log("All standard projections completed with",r.length,"centered models"),{standard:{frontView:a,topView:l,rightView:c},parts:T}}catch(n){return console.error("Error in standard projections:",n),{standard:{},parts:[]}}}function ft(t,e,r){if(!t||typeof t.x!="number"||typeof t.y!="number"||typeof t.width!="number"||typeof t.height!="number")return console.warn("Invalid viewBox provided to createNormalizedViewBox:",t),"0 0 100 100";const n=t.x+t.width/2,o=t.y+t.height/2,i=e>0?e:100,a=r>0?r:100,l=1.3,c=i*l,h=a*l,v=n-c/2,g=o-h/2;return`${v} ${g} ${c} ${h}`}function f0(t){const e={};if(t.standard&&t.standard.frontView){console.log("[INFO] Processing standard views for combined layout.");const{frontView:n,topView:o,rightView:i}=t.standard,a=[],l={view:n,name:"front",viewBox:Ye(n.normalizedViewBox||n.visible.toSVGViewBox(5)),visiblePaths:n.visible.toSVGPaths(),hiddenPaths:n.hidden.toSVGPaths()},c=o?{view:o,name:"top",viewBox:Ye(o.normalizedViewBox||o.visible.toSVGViewBox(5)),visiblePaths:o.visible.toSVGPaths(),hiddenPaths:o.hidden.toSVGPaths()}:null,h=i?{view:i,name:"right",viewBox:Ye(i.normalizedViewBox||i.visible.toSVGViewBox(5)),visiblePaths:i.visible.toSVGPaths(),hiddenPaths:i.hidden.toSVGPaths()}:null;if(!l.viewBox)return console.error("Front view data is missing or invalid. Cannot create standard layout."),{parts:Ua(t.parts)};let v=l.viewBox.width,g=l.viewBox.height,d={x:0,y:0},w={x:0,y:0};c&&c.viewBox?(d.x=l.viewBox.x+(l.viewBox.width-c.viewBox.width)/2,d.y=l.viewBox.y+l.viewBox.height+20,g=d.y+c.viewBox.height-l.viewBox.y,v=Math.max(v,c.viewBox.width+(d.x-l.viewBox.x))):console.log("[INFO] No valid Top view data for layout."),h&&h.viewBox?(w.x=l.viewBox.x+l.viewBox.width+20,w.y=l.viewBox.y+(l.viewBox.height-h.viewBox.height)/2,v=w.x+h.viewBox.width-l.viewBox.x,g=Math.max(g,h.viewBox.height+(w.y-l.viewBox.y))):console.log("[INFO] No valid Right view data for layout.");const T=`${l.viewBox.x} ${l.viewBox.y} ${v} ${g}`;console.log(`[INFO] Calculated Combined Layout ViewBox: ${T}`),console.log(`[INFO] Front Origin: (${l.viewBox.x}, ${l.viewBox.y})`),c&&console.log(`[INFO] Top Offset for Transform: (${d.x-c.viewBox.x}, ${d.y-c.viewBox.y})`),h&&console.log(`[INFO] Right Offset for Transform: (${w.x-h.viewBox.x}, ${w.y-h.viewBox.y})`);const C=(x,P,D,O)=>{if(!x)return;const z=`standard_${O}`,N=Eo(x.visiblePaths,`${z}_visible`,P,D),Z=Eo(x.hiddenPaths,`${z}_hidden`,P,D);N.forEach(j=>j.originalView=O),Z.forEach(j=>j.originalView=O),a.push(...N,...Z)};if(C(l,0,0,"front"),c&&c.viewBox){const x=d.x-c.viewBox.x,P=d.y-c.viewBox.y;C(c,x,P,"top")}if(h&&h.viewBox){const x=w.x-h.viewBox.x,P=w.y-h.viewBox.y;C(h,x,P,"right")}e.standardLayout={combinedViewBox:T,paths:a},console.log(`[INFO] Created standardLayout with ${a.length} total paths.`)}else console.log("[INFO] No standard projections found or frontView missing, skipping combined layout.");return e.parts=Ua(t.parts),t.componentData&&(e.componentData=t.componentData),e}function Ua(t=[]){const e=[];for(const r of t)try{const n={};for(const[o,i]of Object.entries(r.views)){const a=i.visible.toSVGPaths(),l=i.hidden.toSVGPaths(),c=`${r.name.replace(/\s+/g,"_")}_${o}`,h=Eo(a,`${c}_visible`,0,0),v=Eo(l,`${c}_hidden`,0,0),g=i.normalizedViewBox||i.visible.toSVGViewBox(5),d=i.normalizedViewBox||i.hidden.toSVGViewBox(5),w=i.normalizedViewBox||s0(g,d);console.log(`[INFO] Processed Part ${r.name} ${o} viewBox:`,w),n[o]={visible:{paths:h,viewBox:g},hidden:{paths:v,viewBox:d},combinedViewBox:w}}e.push({name:r.name,views:n})}catch(n){console.error(`[ERROR] Error processing part ${r.name}:`,n)}return e}function h0(t,e){let r,n;if(nr(t.endpoints[1],e.endpoints[0]))r=t.endpoints[0],n=e.endpoints[1];else if(nr(t.endpoints[0],e.endpoints[1]))r=e.endpoints[0],n=t.endpoints[1];else if(nr(t.endpoints[0],e.endpoints[0]))r=t.endpoints[1],n=e.endpoints[1];else if(nr(t.endpoints[1],e.endpoints[1]))r=t.endpoints[0],n=e.endpoints[0];else return console.warn("Cannot determine merge order for segments",t,e),t;const o=(t.length||0)+(e.length||0);return{type:"line",path:`M ${r[0]} ${r[1]} L ${n[0]} ${n[1]}`,length:o,endpoints:[r,n]}}function Eo(t,e="path",r=0,n=0){if(!Array.isArray(t))return console.warn("[WARN] normalizePaths received non-array input:",t),[];const o=[];let i=0;for(const a of t){let l;if(typeof a=="string")l=a;else if(Array.isArray(a)&&a.length>0&&typeof a[0]=="string")l=a[0];else if(a&&typeof a=="object"&&typeof a.d=="string")l=a.d;else{console.warn("[WARN] Skipping path due to unexpected format:",a);continue}if(!l||!l.trim())continue;let c=l;if(r!==0||n!==0)try{const d=a0(l);d.length>0?(u0(d,r,n),c=l0(d)):console.warn(`[WARN] Could not parse path data for transformation: ${l.substring(0,50)}...`)}catch(d){console.error(`[ERROR] Failed to transform path data: ${l.substring(0,50)}...`,d)}const h=p0(c);if(h){const d=`${e}_${i}_circle`;o.push({id:d,groupId:d,data:c,type:"circle",geometry:{type:"circle",center:h.center,radius:h.radius,diameter:h.radius*2}}),i++;continue}const v=d0(c),g=[];if(v.length>0){let d=v[0];for(let w=1;w<v.length;w++){const T=v[w];d&&T&&d.type==="line"&&T.type==="line"&&d.endpoints&&T.endpoints&&(nr(d.endpoints[1],T.endpoints[0])||nr(d.endpoints[0],T.endpoints[1])||nr(d.endpoints[0],T.endpoints[0])||nr(d.endpoints[1],T.endpoints[1]))&&La(d.endpoints[0],d.endpoints[1],T.endpoints[0])&&La(d.endpoints[0],d.endpoints[1],T.endpoints[1])?d=h0(d,T):(d&&g.push(d),d=T)}d&&g.push(d),g.forEach((w,T)=>{if(w&&w.path){const C=`${e}_${i}_${T}`;o.push({id:C,groupId:C,data:w.path,type:w.type,geometry:{type:w.type,length:w.length,endpoints:w.endpoints,center:w.type==="circle"?w.center:void 0,radius:w.type==="circle"?w.radius:void 0,diameter:w.type==="circle"?w.radius*2:void 0}})}else console.warn("[WARN] Skipping invalid segment during final ID assignment:",w)})}else if(!h){const d=`${e}_${i}_unknown`;o.push({id:d,groupId:d,data:c,type:"unknown",geometry:{type:"unknown"}}),console.warn(`[WARN] Path could not be decomposed or identified as circle: ${c.substring(0,50)}...`)}i++}return o}function p0(t){const e=/([Aa])\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)\s+([-\d.eE+]+)\s+([01])\s*,?\s*([01])\s+([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/g,r=/M\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/i,n=t.match(r);if(!n)return null;const o=parseFloat(n[1]),i=parseFloat(n[2]),a=[];let l;for(e.lastIndex=0;(l=e.exec(t))!==null;)a.push({rx:parseFloat(l[2]),ry:parseFloat(l[3]),xAxisRotation:parseFloat(l[4]),largeArcFlag:parseInt(l[5]),sweepFlag:parseInt(l[6]),endX:parseFloat(l[7]),endY:parseFloat(l[8]),isRelative:l[1]==="a"});if(a.length===0)return null;const c=Math.abs(a[0].rx),h=Math.abs(a[0].ry);if(c<ht||Math.abs(c-h)>ht*Math.max(c,h)||!a.every(ge=>Math.abs(Math.abs(ge.rx)-c)<ht&&Math.abs(Math.abs(ge.ry)-h)<ht))return null;let v=o,g=i;const d=t.match(/([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/ig);if(!d)return null;for(const ge of d){const Re=ge[0],Oe=(ge.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(Oe.some(isNaN)){console.warn(`Could not parse parameters for command: ${ge}`);continue}const it=Ia(Re,Oe,v,g);v=it[0],g=it[1]}if(!(Math.abs(v-o)<ht&&Math.abs(g-i)<ht)||a.length<2)return null;let T=null;v=o,g=i;for(const ge of d){const Re=ge[0],Oe=(ge.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(Oe.some(isNaN))continue;if(Re==="A"||Re==="a"){if(Oe.length<7){console.warn(`Invalid arc command parameters: ${ge}`);continue}T={rx:Math.abs(Oe[0]),ry:Math.abs(Oe[1]),xAxisRotationDeg:Oe[2],largeArcFlag:Oe[3],sweepFlag:Oe[4],endX:Re==="a"?v+Oe[5]:Oe[5],endY:Re==="a"?g+Oe[6]:Oe[6],startX:v,startY:g};break}const it=Ia(Re,Oe,v,g);v=it[0],g=it[1]}if(!T)return null;const{rx:C,ry:x,xAxisRotationDeg:P,largeArcFlag:D,sweepFlag:O,endX:z,endY:N,startX:Z,startY:j}=T,K=P*Math.PI/180,ie=Math.cos(K),me=Math.sin(K),Te=ie*(Z-z)/2+me*(j-N)/2,ye=-me*(Z-z)/2+ie*(j-N)/2,xe=C*C,re=x*x,le=Te*Te,de=ye*ye;let ce=le/xe+de/re,te=C,ue=x;if(ce>1){const ge=Math.sqrt(ce);te=ge*C,ue=ge*x}const ve=te*te,he=ue*ue;let Ce=D===O?-1:1,nt=Math.max(0,(ve*he-ve*de-he*le)/(ve*de+he*le)),dt=Ce*Math.sqrt(nt);const ot=dt*(te*ye/ue),vt=dt*-(ue*Te/te),Rt=ie*ot-me*vt+(Z+z)/2,et=me*ot+ie*vt+(j+N)/2;return{center:[Rt,et],radius:te}}function d0(t){const e=[];let r=0,n=0,o=0,i=0;const a=/([MLHVCSQTAZmlhvcsqtaz])([^MLHVCSQTAZmlhvcsqtaz]*)/g;let l;for(;(l=a.exec(t))!==null;){const c=l[1],h=(l[2].match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(h.some(isNaN)){console.warn(`Could not parse parameters for command: ${l[0]}`);continue}let v=[];switch(c){case"M":if(h.length>=2){r=h[0],n=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const d=h[g],w=h[g+1],T=Ut(r,n,d,w);T&&e.push(T),r=d,n=w}}break;case"m":if(h.length>=2){r+=h[0],n+=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const d=r+h[g],w=n+h[g+1],T=Ut(r,n,d,w);T&&e.push(T),r=d,n=w}}break;case"L":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const d=h[g],w=h[g+1],T=Ut(r,n,d,w);T&&e.push(T),r=d,n=w}break;case"l":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const d=r+h[g],w=n+h[g+1],T=Ut(r,n,d,w);T&&e.push(T),r=d,n=w}break;case"H":for(let g=0;g<h.length;g++){const d=h[g],w=Ut(r,n,d,n);w&&e.push(w),r=d}break;case"h":for(let g=0;g<h.length;g++){const d=r+h[g],w=Ut(r,n,d,n);w&&e.push(w),r=d}break;case"V":for(let g=0;g<h.length;g++){const d=h[g],w=Ut(r,n,r,d);w&&e.push(w),n=d}break;case"v":for(let g=0;g<h.length;g++){const d=n+h[g],w=Ut(r,n,r,d);w&&e.push(w),n=d}break;case"Z":case"z":if(Math.abs(r-o)>ht||Math.abs(n-i)>ht){const g=Ut(r,n,o,i);g&&e.push(g)}r=o,n=i;break;case"C":case"c":v=h.length/6;for(let g=0;g<v;++g){const d=h.slice(g*6,(g+1)*6);if(d.length===6){const w=yr(c,d,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${d.join(" ")}`,length:qr(c,d,r,n),endpoints:[[r,n],w]}),r=w[0],n=w[1]}}break;case"S":case"s":v=h.length/4;for(let g=0;g<v;++g){const d=h.slice(g*4,(g+1)*4);if(d.length===4){const w=yr(c,d,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${d.join(" ")}`,length:qr(c,d,r,n),endpoints:[[r,n],w]}),r=w[0],n=w[1]}}break;case"Q":case"q":v=h.length/4;for(let g=0;g<v;++g){const d=h.slice(g*4,(g+1)*4);if(d.length===4){const w=yr(c,d,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${d.join(" ")}`,length:qr(c,d,r,n),endpoints:[[r,n],w]}),r=w[0],n=w[1]}}break;case"T":case"t":v=h.length/2;for(let g=0;g<v;++g){const d=h.slice(g*2,(g+1)*2);if(d.length===2){const w=yr(c,d,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${d.join(" ")}`,length:qr(c,d,r,n),endpoints:[[r,n],w]}),r=w[0],n=w[1]}}break;case"A":case"a":v=h.length/7;for(let g=0;g<v;++g){const d=h.slice(g*7,(g+1)*7);if(d.length===7){const w=yr(c,d,r,n);e.push({type:"arc",path:`M ${r} ${n} ${c} ${d.join(" ")}`,length:qr(c,d,r,n),endpoints:[[r,n],w]}),r=w[0],n=w[1]}}break}}return e}function Ut(t,e,r,n){if(Math.abs(t-r)<ht&&Math.abs(e-n)<ht)return null;const o=Math.sqrt(Math.pow(r-t,2)+Math.pow(n-e,2));return{type:"line",path:`M ${t} ${e} L ${r} ${n}`,length:o,endpoints:[[t,e],[r,n]]}}function qr(t,e,r,n){const o=yr(t,e,r,n);return Math.sqrt(Math.pow(o[0]-r,2)+Math.pow(o[1]-n,2))}function Ia(t,e,r,n){if("CSQTAcsgta".includes(t))return yr(t,e,r,n);let o=r,i=n;const a=t===t.toLowerCase(),l=e.length;switch(t.toUpperCase()){case"M":case"L":l>=2&&(o=e[l-2],i=e[l-1],a&&(o+=r,i+=n));break;case"H":l>=1&&(o=e[l-1],a&&(o+=r),i=n);break;case"V":l>=1&&(o=r,i=e[l-1],a&&(i+=n));break;case"Z":o=r,i=n;break}return[o,i]}function yr(t,e,r,n){const o=t===t.toLowerCase();let i=r,a=n;const l=e.length;switch(t.toUpperCase()){case"C":l>=6&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"S":case"Q":l>=4&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"T":l>=2&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"A":l>=7&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break}return[i,a]}let Ga=!1;const v0=async()=>{if(Ga)return Promise.resolve(!0);const t=await Xf({locateFile:()=>Yf});return Ga=!0,jf(t),!0},ul=v0();function g0(t,e){return console.log(`[LOG] createProjections called for model: ${t}`),console.time(`[PERF] Total ${t} projections creation`),ul.then(()=>{const r=al(t,e);if(r&&r.error)return{error:!0,validationErrors:r.validationErrors};console.time(`[PERF] ${t} projections generation`);const n=c0(r);console.timeEnd(`[PERF] ${t} projections generation`),console.time(`[PERF] ${t} projections processing`);const o=f0(n);if(console.timeEnd(`[PERF] ${t} projections processing`),console.timeEnd(`[PERF] Total ${t} projections creation`),r&&r.componentData){const i=r.componentData.map(a=>({id:a.id,name:a.name,quantity:a.quantity,dimensions:a.dimensions,material:a.material}));o.componentData=i}return o})}function m0(t,e,r="standard"){return console.time(`[PERF] Total ${t} creation (Quality: ${r})`),ul.then(()=>{console.time(`[PERF] ${t} model function`);const n=al(t,e);if(console.timeEnd(`[PERF] ${t} model function`),n&&n.error)return{error:!0,validationErrors:n.validationErrors};if(n&&n.main&&Array.isArray(n.helperSpaces)){const l=n.main,c=n.helperSpaces,h=r==="high"?{tolerance:.01,angularTolerance:1}:{tolerance:.1,angularTolerance:15};console.log(`[INFO] Using mesh options for ${r} quality:`,h),console.time(`[PERF] ${t} main model generation (Quality: ${r})`);const v=l.mesh(h),g=l.meshEdges(h);console.timeEnd(`[PERF] ${t} main model generation (Quality: ${r})`),console.time(`[PERF] ${t} helper spaces generation (Quality: ${r})`);const d=c.map(w=>({faces:w.mesh(h),edges:w.meshEdges(h)}));return console.timeEnd(`[PERF] ${t} helper spaces generation (Quality: ${r})`),console.timeEnd(`[PERF] Total ${t} creation (Quality: ${r})`),{faces:v,edges:g,helperSpaces:d,componentData:n.componentData}}const o=r==="high"?{tolerance:.01,angularTolerance:1}:{tolerance:.1,angularTolerance:15};console.log(`[INFO] Using mesh options for ${r} quality:`,o),console.time(`[PERF] ${t} faces generation (Quality: ${r})`);const i=n.mesh(o);console.timeEnd(`[PERF] ${t} faces generation (Quality: ${r})`),i&&i.triangles&&console.log(`[INFO] ${t} (Quality: ${r}) triangles: ${i.triangles.length/3}, vertices: ${i.vertices.length/3}`),console.time(`[PERF] ${t} edges generation (Quality: ${r})`);const a=n.meshEdges(o);return console.timeEnd(`[PERF] ${t} edges generation (Quality: ${r})`),console.timeEnd(`[PERF] Total ${t} creation (Quality: ${r})`),{faces:i,edges:a,componentData:n.componentData}})}Xi({createMesh:m0,createProjections:g0})});export default y0();
