var xf=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Im=xf(O=>{var Cf=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(a,s){n=a,o=s});var i=Object.assign({},r),u="./this.program",l=(a,s)=>{throw s},f=typeof window=="object",p=typeof importScripts=="function",v=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function m(a){return r.locateFile?r.locateFile(a,y):y+a}var S,T,x;function C(a){if(a instanceof $o)return;V("exiting due to exception: "+a)}var A,L,F;v?(p?y=require("path").dirname(y)+"/":y=__dirname+"/",F=()=>{L||(A=require("fs"),L=require("path"))},S=function(s,c){return F(),s=L.normalize(s),A.readFileSync(s,c?void 0:"utf8")},x=a=>{var s=S(a,!0);return s.buffer||(s=new Uint8Array(s)),s},T=(a,s,c)=>{F(),a=L.normalize(a),A.readFile(a,function(h,d){h?c(h):s(d.buffer)})},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(a){if(!(a instanceof $o))throw a}),process.on("unhandledRejection",function(a){throw a}),l=(a,s)=>{if(wr())throw process.exitCode=a,s;C(s),process.exit(a)},r.inspect=function(){return"[Emscripten Module object]"}):(f||p)&&(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),t&&(y=t),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",S=a=>{var s=new XMLHttpRequest;return s.open("GET",a,!1),s.send(null),s.responseText},p&&(x=a=>{var s=new XMLHttpRequest;return s.open("GET",a,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),T=(a,s,c)=>{var h=new XMLHttpRequest;h.open("GET",a,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){s(h.response);return}c()},h.onerror=c,h.send(null)});var Y=r.print||console.log.bind(console),V=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(u=r.thisProgram),r.quit&&(l=r.quit);var ae=4,ee;r.wasmBinary&&(ee=r.wasmBinary);var q=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Vt("no native wasm support detected");var de,Se=!1;function xe(a,s){a||Vt(s)}var ke=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Ae(a,s,c){for(var h=s+c,d=s;a[d]&&!(d>=h);)++d;if(d-s>16&&a.buffer&&ke)return ke.decode(a.subarray(s,d));for(var w="";s<d;){var b=a[s++];if(!(b&128)){w+=String.fromCharCode(b);continue}var _=a[s++]&63;if((b&224)==192){w+=String.fromCharCode((b&31)<<6|_);continue}var E=a[s++]&63;if((b&240)==224?b=(b&15)<<12|_<<6|E:b=(b&7)<<18|_<<12|E<<6|a[s++]&63,b<65536)w+=String.fromCharCode(b);else{var k=b-65536;w+=String.fromCharCode(55296|k>>10,56320|k&1023)}}return w}function se(a,s){return a?Ae(We,a,s):""}function ye(a,s,c,h){if(!(h>0))return 0;for(var d=c,w=c+h-1,b=0;b<a.length;++b){var _=a.charCodeAt(b);if(_>=55296&&_<=57343){var E=a.charCodeAt(++b);_=65536+((_&1023)<<10)|E&1023}if(_<=127){if(c>=w)break;s[c++]=_}else if(_<=2047){if(c+1>=w)break;s[c++]=192|_>>6,s[c++]=128|_&63}else if(_<=65535){if(c+2>=w)break;s[c++]=224|_>>12,s[c++]=128|_>>6&63,s[c++]=128|_&63}else{if(c+3>=w)break;s[c++]=240|_>>18,s[c++]=128|_>>12&63,s[c++]=128|_>>6&63,s[c++]=128|_&63}}return s[c]=0,c-d}function Ce(a,s,c){return ye(a,We,s,c)}function ue(a){for(var s=0,c=0;c<a.length;++c){var h=a.charCodeAt(c);h>=55296&&h<=57343&&(h=65536+((h&1023)<<10)|a.charCodeAt(++c)&1023),h<=127?++s:h<=2047?s+=2:h<=65535?s+=3:s+=4}return s}var ge=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Oe(a,s){for(var c=a,h=c>>1,d=h+s/2;!(h>=d)&&Ht[h];)++h;if(c=h<<1,c-a>32&&ge)return ge.decode(We.subarray(a,c));for(var w="",b=0;!(b>=s/2);++b){var _=ft[a+b*2>>1];if(_==0)break;w+=String.fromCharCode(_)}return w}function He(a,s,c){if(c===void 0&&(c=2147483647),c<2)return 0;c-=2;for(var h=s,d=c<a.length*2?c/2:a.length,w=0;w<d;++w){var b=a.charCodeAt(w);ft[s>>1]=b,s+=2}return ft[s>>1]=0,s-h}function be(a){return a.length*2}function Re(a,s){for(var c=0,h="";!(c>=s/4);){var d=B[a+c*4>>2];if(d==0)break;if(++c,d>=65536){var w=d-65536;h+=String.fromCharCode(55296|w>>10,56320|w&1023)}else h+=String.fromCharCode(d)}return h}function Pt(a,s,c){if(c===void 0&&(c=2147483647),c<4)return 0;for(var h=s,d=h+c-4,w=0;w<a.length;++w){var b=a.charCodeAt(w);if(b>=55296&&b<=57343){var _=a.charCodeAt(++w);b=65536+((b&1023)<<10)|_&1023}if(B[s>>2]=b,s+=4,s+4>d)break}return B[s>>2]=0,s-h}function et(a){for(var s=0,c=0;c<a.length;++c){var h=a.charCodeAt(c);h>=55296&&h<=57343&&++c,s+=4}return s}function Ke(a){var s=ue(a)+1,c=Dt(s);return c&&ye(a,Ve,c,s),c}function lt(a,s){Ve.set(a,s)}function mr(a,s,c){for(var h=0;h<a.length;++h)Ve[s++>>0]=a.charCodeAt(h);c||(Ve[s>>0]=0)}var ct,Ve,We,ft,Ht,B,te,nt,yn;function wn(a){ct=a,r.HEAP8=Ve=new Int8Array(a),r.HEAP16=ft=new Int16Array(a),r.HEAP32=B=new Int32Array(a),r.HEAPU8=We=new Uint8Array(a),r.HEAPU16=Ht=new Uint16Array(a),r.HEAPU32=te=new Uint32Array(a),r.HEAPF32=nt=new Float32Array(a),r.HEAPF64=yn=new Float64Array(a)}r.INITIAL_MEMORY;var bn,yr=[],re=[],le=[];function wr(){return q}function zu(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Xu(r.preRun.shift());Ao(yr)}function Wu(){!r.noFSInit&&!g.init.initialized&&g.init(),g.ignorePermissions=!1,Ao(re)}function $u(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Zu(r.postRun.shift());Ao(le)}function Xu(a){yr.unshift(a)}function Yu(a){re.unshift(a)}function Zu(a){le.unshift(a)}var nr=0,Ur=null;function Gm(a){return a}function ko(a){nr++,r.monitorRunDependencies&&r.monitorRunDependencies(nr)}function _n(a){if(nr--,r.monitorRunDependencies&&r.monitorRunDependencies(nr),nr==0&&Ur){var s=Ur;Ur=null,s()}}function Vt(a){r.onAbort&&r.onAbort(a),a="Aborted("+a+")",V(a),Se=!0,a+=". Build with -sASSERTIONS for more info.";var s=new WebAssembly.RuntimeError(a);throw o(s),s}var ju="data:application/octet-stream;base64,";function zi(a){return a.startsWith(ju)}function Wi(a){return a.startsWith("file://")}var tt;tt="replicad_single.wasm",zi(tt)||(tt=m(tt));function $i(a){try{if(a==tt&&ee)return new Uint8Array(ee);if(x)return x(a);throw"both async and sync fetching of the wasm failed"}catch(s){Vt(s)}}function qu(){if(!ee&&(f||p)){if(typeof fetch=="function"&&!Wi(tt))return fetch(tt,{credentials:"same-origin"}).then(function(a){if(!a.ok)throw"failed to load wasm binary file at '"+tt+"'";return a.arrayBuffer()}).catch(function(){return $i(tt)});if(T)return new Promise(function(a,s){T(tt,function(c){a(new Uint8Array(c))},s)})}return Promise.resolve().then(function(){return $i(tt)})}function Ku(){var a={a:Sf};function s(b,_){var E=b.exports;r.asm=E,de=r.asm.oa,wn(de.buffer),bn=r.asm.va,Yu(r.asm.pa),_n()}ko();function c(b){s(b.instance)}function h(b){return qu().then(function(_){return WebAssembly.instantiate(_,a)}).then(function(_){return _}).then(b,function(_){V("failed to asynchronously prepare wasm: "+_),Vt(_)})}function d(){return!ee&&typeof WebAssembly.instantiateStreaming=="function"&&!zi(tt)&&!Wi(tt)&&!v&&typeof fetch=="function"?fetch(tt,{credentials:"same-origin"}).then(function(b){var _=WebAssembly.instantiateStreaming(b,a);return _.then(c,function(E){return V("wasm streaming compile failed: "+E),V("falling back to ArrayBuffer instantiation"),h(c)})}):h(c)}if(r.instantiateWasm)try{var w=r.instantiateWasm(a,s);return w}catch(b){return V("Module.instantiateWasm callback failed with error: "+b),!1}return d().catch(o),{}}var $e,kt;function Qu(){return r.HEAP8.length}function Ao(a){for(;a.length>0;){var s=a.shift();if(typeof s=="function"){s(r);continue}var c=s.func;typeof c=="number"?s.arg===void 0?Tn(c)():Tn(c)(s.arg):c(s.arg===void 0?null:s.arg)}}var Sn=[];function Tn(a){var s=Sn[a];return s||(a>=Sn.length&&(Sn.length=a+1),Sn[a]=s=bn.get(a)),s}function Ju(a,s,c,h){Vt("Assertion failed: "+se(a)+", at: "+[s?se(s):"unknown filename",c,h?se(h):"unknown function"])}function el(a){return Dt(a+24)+24}function tl(a){this.excPtr=a,this.ptr=a-24,this.set_type=function(s){te[this.ptr+4>>2]=s},this.get_type=function(){return te[this.ptr+4>>2]},this.set_destructor=function(s){te[this.ptr+8>>2]=s},this.get_destructor=function(){return te[this.ptr+8>>2]},this.set_refcount=function(s){B[this.ptr>>2]=s},this.set_caught=function(s){s=s?1:0,Ve[this.ptr+12>>0]=s},this.get_caught=function(){return Ve[this.ptr+12>>0]!=0},this.set_rethrown=function(s){s=s?1:0,Ve[this.ptr+13>>0]=s},this.get_rethrown=function(){return Ve[this.ptr+13>>0]!=0},this.init=function(s,c){this.set_adjusted_ptr(0),this.set_type(s),this.set_destructor(c),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var s=B[this.ptr>>2];B[this.ptr>>2]=s+1},this.release_ref=function(){var s=B[this.ptr>>2];return B[this.ptr>>2]=s-1,s===1},this.set_adjusted_ptr=function(s){te[this.ptr+16>>2]=s},this.get_adjusted_ptr=function(){return te[this.ptr+16>>2]},this.get_exception_ptr=function(){var s=ga(this.get_type());if(s)return te[this.excPtr>>2];var c=this.get_adjusted_ptr();return c!==0?c:this.excPtr}}function rl(a,s,c){var h=new tl(a);throw h.init(s,c),a}var ce={isAbs:a=>a.charAt(0)==="/",splitPath:a=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return s.exec(a).slice(1)},normalizeArray:(a,s)=>{for(var c=0,h=a.length-1;h>=0;h--){var d=a[h];d==="."?a.splice(h,1):d===".."?(a.splice(h,1),c++):c&&(a.splice(h,1),c--)}if(s)for(;c;c--)a.unshift("..");return a},normalize:a=>{var s=ce.isAbs(a),c=a.substr(-1)==="/";return a=ce.normalizeArray(a.split("/").filter(h=>!!h),!s).join("/"),!a&&!s&&(a="."),a&&c&&(a+="/"),(s?"/":"")+a},dirname:a=>{var s=ce.splitPath(a),c=s[0],h=s[1];return!c&&!h?".":(h&&(h=h.substr(0,h.length-1)),c+h)},basename:a=>{if(a==="/")return"/";a=ce.normalize(a),a=a.replace(/\/$/,"");var s=a.lastIndexOf("/");return s===-1?a:a.substr(s+1)},join:function(){var a=Array.prototype.slice.call(arguments,0);return ce.normalize(a.join("/"))},join2:(a,s)=>ce.normalize(a+"/"+s)};function nl(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var a=new Uint8Array(1);return function(){return crypto.getRandomValues(a),a[0]}}else if(v)try{var s=require("crypto");return function(){return s.randomBytes(1)[0]}}catch{}return function(){Vt("randomDevice")}}var At={resolve:function(){for(var a="",s=!1,c=arguments.length-1;c>=-1&&!s;c--){var h=c>=0?arguments[c]:g.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";a=h+"/"+a,s=ce.isAbs(h)}return a=ce.normalizeArray(a.split("/").filter(d=>!!d),!s).join("/"),(s?"/":"")+a||"."},relative:(a,s)=>{a=At.resolve(a).substr(1),s=At.resolve(s).substr(1);function c(k){for(var U=0;U<k.length&&k[U]==="";U++);for(var I=k.length-1;I>=0&&k[I]==="";I--);return U>I?[]:k.slice(U,I-U+1)}for(var h=c(a.split("/")),d=c(s.split("/")),w=Math.min(h.length,d.length),b=w,_=0;_<w;_++)if(h[_]!==d[_]){b=_;break}for(var E=[],_=b;_<h.length;_++)E.push("..");return E=E.concat(d.slice(b)),E.join("/")}},or={ttys:[],init:function(){},shutdown:function(){},register:function(a,s){or.ttys[a]={input:[],output:[],ops:s},g.registerDevice(a,or.stream_ops)},stream_ops:{open:function(a){var s=or.ttys[a.node.rdev];if(!s)throw new g.ErrnoError(43);a.tty=s,a.seekable=!1},close:function(a){a.tty.ops.flush(a.tty)},flush:function(a){a.tty.ops.flush(a.tty)},read:function(a,s,c,h,d){if(!a.tty||!a.tty.ops.get_char)throw new g.ErrnoError(60);for(var w=0,b=0;b<h;b++){var _;try{_=a.tty.ops.get_char(a.tty)}catch{throw new g.ErrnoError(29)}if(_===void 0&&w===0)throw new g.ErrnoError(6);if(_==null)break;w++,s[c+b]=_}return w&&(a.node.timestamp=Date.now()),w},write:function(a,s,c,h,d){if(!a.tty||!a.tty.ops.put_char)throw new g.ErrnoError(60);try{for(var w=0;w<h;w++)a.tty.ops.put_char(a.tty,s[c+w])}catch{throw new g.ErrnoError(29)}return h&&(a.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(a){if(!a.input.length){var s=null;if(v){var c=256,h=Buffer.alloc(c),d=0;try{d=A.readSync(process.stdin.fd,h,0,c,-1)}catch(w){if(w.toString().includes("EOF"))d=0;else throw w}d>0?s=h.slice(0,d).toString("utf-8"):s=null}else typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`));if(!s)return null;a.input=In(s,!0)}return a.input.shift()},put_char:function(a,s){s===null||s===10?(Y(Ae(a.output,0)),a.output=[]):s!=0&&a.output.push(s)},flush:function(a){a.output&&a.output.length>0&&(Y(Ae(a.output,0)),a.output=[])}},default_tty1_ops:{put_char:function(a,s){s===null||s===10?(V(Ae(a.output,0)),a.output=[]):s!=0&&a.output.push(s)},flush:function(a){a.output&&a.output.length>0&&(V(Ae(a.output,0)),a.output=[])}}};function ol(a,s){We.fill(0,a,a+s)}function il(a,s){return Math.ceil(a/s)*s}function Xi(a){a=il(a,65536);var s=va(65536,a);return s?(ol(s,a),s):0}var Q={ops_table:null,mount:function(a){return Q.createNode(null,"/",16895,0)},createNode:function(a,s,c,h){if(g.isBlkdev(c)||g.isFIFO(c))throw new g.ErrnoError(63);Q.ops_table||(Q.ops_table={dir:{node:{getattr:Q.node_ops.getattr,setattr:Q.node_ops.setattr,lookup:Q.node_ops.lookup,mknod:Q.node_ops.mknod,rename:Q.node_ops.rename,unlink:Q.node_ops.unlink,rmdir:Q.node_ops.rmdir,readdir:Q.node_ops.readdir,symlink:Q.node_ops.symlink},stream:{llseek:Q.stream_ops.llseek}},file:{node:{getattr:Q.node_ops.getattr,setattr:Q.node_ops.setattr},stream:{llseek:Q.stream_ops.llseek,read:Q.stream_ops.read,write:Q.stream_ops.write,allocate:Q.stream_ops.allocate,mmap:Q.stream_ops.mmap,msync:Q.stream_ops.msync}},link:{node:{getattr:Q.node_ops.getattr,setattr:Q.node_ops.setattr,readlink:Q.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Q.node_ops.getattr,setattr:Q.node_ops.setattr},stream:g.chrdev_stream_ops}});var d=g.createNode(a,s,c,h);return g.isDir(d.mode)?(d.node_ops=Q.ops_table.dir.node,d.stream_ops=Q.ops_table.dir.stream,d.contents={}):g.isFile(d.mode)?(d.node_ops=Q.ops_table.file.node,d.stream_ops=Q.ops_table.file.stream,d.usedBytes=0,d.contents=null):g.isLink(d.mode)?(d.node_ops=Q.ops_table.link.node,d.stream_ops=Q.ops_table.link.stream):g.isChrdev(d.mode)&&(d.node_ops=Q.ops_table.chrdev.node,d.stream_ops=Q.ops_table.chrdev.stream),d.timestamp=Date.now(),a&&(a.contents[s]=d,a.timestamp=d.timestamp),d},getFileDataAsTypedArray:function(a){return a.contents?a.contents.subarray?a.contents.subarray(0,a.usedBytes):new Uint8Array(a.contents):new Uint8Array(0)},expandFileStorage:function(a,s){var c=a.contents?a.contents.length:0;if(!(c>=s)){var h=1024*1024;s=Math.max(s,c*(c<h?2:1.125)>>>0),c!=0&&(s=Math.max(s,256));var d=a.contents;a.contents=new Uint8Array(s),a.usedBytes>0&&a.contents.set(d.subarray(0,a.usedBytes),0)}},resizeFileStorage:function(a,s){if(a.usedBytes!=s)if(s==0)a.contents=null,a.usedBytes=0;else{var c=a.contents;a.contents=new Uint8Array(s),c&&a.contents.set(c.subarray(0,Math.min(s,a.usedBytes))),a.usedBytes=s}},node_ops:{getattr:function(a){var s={};return s.dev=g.isChrdev(a.mode)?a.id:1,s.ino=a.id,s.mode=a.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=a.rdev,g.isDir(a.mode)?s.size=4096:g.isFile(a.mode)?s.size=a.usedBytes:g.isLink(a.mode)?s.size=a.link.length:s.size=0,s.atime=new Date(a.timestamp),s.mtime=new Date(a.timestamp),s.ctime=new Date(a.timestamp),s.blksize=4096,s.blocks=Math.ceil(s.size/s.blksize),s},setattr:function(a,s){s.mode!==void 0&&(a.mode=s.mode),s.timestamp!==void 0&&(a.timestamp=s.timestamp),s.size!==void 0&&Q.resizeFileStorage(a,s.size)},lookup:function(a,s){throw g.genericErrors[44]},mknod:function(a,s,c,h){return Q.createNode(a,s,c,h)},rename:function(a,s,c){if(g.isDir(a.mode)){var h;try{h=g.lookupNode(s,c)}catch{}if(h)for(var d in h.contents)throw new g.ErrnoError(55)}delete a.parent.contents[a.name],a.parent.timestamp=Date.now(),a.name=c,s.contents[c]=a,s.timestamp=a.parent.timestamp,a.parent=s},unlink:function(a,s){delete a.contents[s],a.timestamp=Date.now()},rmdir:function(a,s){var c=g.lookupNode(a,s);for(var h in c.contents)throw new g.ErrnoError(55);delete a.contents[s],a.timestamp=Date.now()},readdir:function(a){var s=[".",".."];for(var c in a.contents)a.contents.hasOwnProperty(c)&&s.push(c);return s},symlink:function(a,s,c){var h=Q.createNode(a,s,41471,0);return h.link=c,h},readlink:function(a){if(!g.isLink(a.mode))throw new g.ErrnoError(28);return a.link}},stream_ops:{read:function(a,s,c,h,d){var w=a.node.contents;if(d>=a.node.usedBytes)return 0;var b=Math.min(a.node.usedBytes-d,h);if(b>8&&w.subarray)s.set(w.subarray(d,d+b),c);else for(var _=0;_<b;_++)s[c+_]=w[d+_];return b},write:function(a,s,c,h,d,w){if(s.buffer===Ve.buffer&&(w=!1),!h)return 0;var b=a.node;if(b.timestamp=Date.now(),s.subarray&&(!b.contents||b.contents.subarray)){if(w)return b.contents=s.subarray(c,c+h),b.usedBytes=h,h;if(b.usedBytes===0&&d===0)return b.contents=s.slice(c,c+h),b.usedBytes=h,h;if(d+h<=b.usedBytes)return b.contents.set(s.subarray(c,c+h),d),h}if(Q.expandFileStorage(b,d+h),b.contents.subarray&&s.subarray)b.contents.set(s.subarray(c,c+h),d);else for(var _=0;_<h;_++)b.contents[d+_]=s[c+_];return b.usedBytes=Math.max(b.usedBytes,d+h),h},llseek:function(a,s,c){var h=s;if(c===1?h+=a.position:c===2&&g.isFile(a.node.mode)&&(h+=a.node.usedBytes),h<0)throw new g.ErrnoError(28);return h},allocate:function(a,s,c){Q.expandFileStorage(a.node,s+c),a.node.usedBytes=Math.max(a.node.usedBytes,s+c)},mmap:function(a,s,c,h,d){if(!g.isFile(a.node.mode))throw new g.ErrnoError(43);var w,b,_=a.node.contents;if(!(d&2)&&_.buffer===ct)b=!1,w=_.byteOffset;else{if((c>0||c+s<_.length)&&(_.subarray?_=_.subarray(c,c+s):_=Array.prototype.slice.call(_,c,c+s)),b=!0,w=Xi(s),!w)throw new g.ErrnoError(48);Ve.set(_,w)}return{ptr:w,allocated:b}},msync:function(a,s,c,h,d){if(!g.isFile(a.node.mode))throw new g.ErrnoError(43);return d&2||Q.stream_ops.write(a,s,0,h,c,!1),0}}};function al(a,s,c,h){var d=h?"":"al "+a;T(a,function(w){xe(w,'Loading data file "'+a+'" failed (no arrayBuffer).'),s(new Uint8Array(w)),d&&_n()},function(w){if(c)c();else throw'Loading data file "'+a+'" failed.'}),d&&ko()}var g={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(a,s={})=>{if(a=At.resolve(g.cwd(),a),!a)return{path:"",node:null};var c={follow_mount:!0,recurse_count:0};if(s=Object.assign(c,s),s.recurse_count>8)throw new g.ErrnoError(32);for(var h=ce.normalizeArray(a.split("/").filter(I=>!!I),!1),d=g.root,w="/",b=0;b<h.length;b++){var _=b===h.length-1;if(_&&s.parent)break;if(d=g.lookupNode(d,h[b]),w=ce.join2(w,h[b]),g.isMountpoint(d)&&(!_||_&&s.follow_mount)&&(d=d.mounted.root),!_||s.follow)for(var E=0;g.isLink(d.mode);){var k=g.readlink(w);w=At.resolve(ce.dirname(w),k);var U=g.lookupPath(w,{recurse_count:s.recurse_count+1});if(d=U.node,E++>40)throw new g.ErrnoError(32)}}return{path:w,node:d}},getPath:a=>{for(var s;;){if(g.isRoot(a)){var c=a.mount.mountpoint;return s?c[c.length-1]!=="/"?c+"/"+s:c+s:c}s=s?a.name+"/"+s:a.name,a=a.parent}},hashName:(a,s)=>{for(var c=0,h=0;h<s.length;h++)c=(c<<5)-c+s.charCodeAt(h)|0;return(a+c>>>0)%g.nameTable.length},hashAddNode:a=>{var s=g.hashName(a.parent.id,a.name);a.name_next=g.nameTable[s],g.nameTable[s]=a},hashRemoveNode:a=>{var s=g.hashName(a.parent.id,a.name);if(g.nameTable[s]===a)g.nameTable[s]=a.name_next;else for(var c=g.nameTable[s];c;){if(c.name_next===a){c.name_next=a.name_next;break}c=c.name_next}},lookupNode:(a,s)=>{var c=g.mayLookup(a);if(c)throw new g.ErrnoError(c,a);for(var h=g.hashName(a.id,s),d=g.nameTable[h];d;d=d.name_next){var w=d.name;if(d.parent.id===a.id&&w===s)return d}return g.lookup(a,s)},createNode:(a,s,c,h)=>{var d=new g.FSNode(a,s,c,h);return g.hashAddNode(d),d},destroyNode:a=>{g.hashRemoveNode(a)},isRoot:a=>a===a.parent,isMountpoint:a=>!!a.mounted,isFile:a=>(a&61440)===32768,isDir:a=>(a&61440)===16384,isLink:a=>(a&61440)===40960,isChrdev:a=>(a&61440)===8192,isBlkdev:a=>(a&61440)===24576,isFIFO:a=>(a&61440)===4096,isSocket:a=>(a&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:a=>{var s=g.flagModes[a];if(typeof s>"u")throw new Error("Unknown file open mode: "+a);return s},flagsToPermissionString:a=>{var s=["r","w","rw"][a&3];return a&512&&(s+="w"),s},nodePermissions:(a,s)=>g.ignorePermissions?0:s.includes("r")&&!(a.mode&292)||s.includes("w")&&!(a.mode&146)||s.includes("x")&&!(a.mode&73)?2:0,mayLookup:a=>{var s=g.nodePermissions(a,"x");return s||(a.node_ops.lookup?0:2)},mayCreate:(a,s)=>{try{var c=g.lookupNode(a,s);return 20}catch{}return g.nodePermissions(a,"wx")},mayDelete:(a,s,c)=>{var h;try{h=g.lookupNode(a,s)}catch(w){return w.errno}var d=g.nodePermissions(a,"wx");if(d)return d;if(c){if(!g.isDir(h.mode))return 54;if(g.isRoot(h)||g.getPath(h)===g.cwd())return 10}else if(g.isDir(h.mode))return 31;return 0},mayOpen:(a,s)=>a?g.isLink(a.mode)?32:g.isDir(a.mode)&&(g.flagsToPermissionString(s)!=="r"||s&512)?31:g.nodePermissions(a,g.flagsToPermissionString(s)):44,MAX_OPEN_FDS:4096,nextfd:(a=0,s=g.MAX_OPEN_FDS)=>{for(var c=a;c<=s;c++)if(!g.streams[c])return c;throw new g.ErrnoError(33)},getStream:a=>g.streams[a],createStream:(a,s,c)=>{g.FSStream||(g.FSStream=function(){this.shared={}},g.FSStream.prototype={},Object.defineProperties(g.FSStream.prototype,{object:{get:function(){return this.node},set:function(d){this.node=d}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(d){this.shared.flags=d}},position:{get:function(){return this.shared.position},set:function(d){this.shared.position=d}}})),a=Object.assign(new g.FSStream,a);var h=g.nextfd(s,c);return a.fd=h,g.streams[h]=a,a},closeStream:a=>{g.streams[a]=null},chrdev_stream_ops:{open:a=>{var s=g.getDevice(a.node.rdev);a.stream_ops=s.stream_ops,a.stream_ops.open&&a.stream_ops.open(a)},llseek:()=>{throw new g.ErrnoError(70)}},major:a=>a>>8,minor:a=>a&255,makedev:(a,s)=>a<<8|s,registerDevice:(a,s)=>{g.devices[a]={stream_ops:s}},getDevice:a=>g.devices[a],getMounts:a=>{for(var s=[],c=[a];c.length;){var h=c.pop();s.push(h),c.push.apply(c,h.mounts)}return s},syncfs:(a,s)=>{typeof a=="function"&&(s=a,a=!1),g.syncFSRequests++,g.syncFSRequests>1&&V("warning: "+g.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var c=g.getMounts(g.root.mount),h=0;function d(b){return g.syncFSRequests--,s(b)}function w(b){if(b)return w.errored?void 0:(w.errored=!0,d(b));++h>=c.length&&d(null)}c.forEach(b=>{if(!b.type.syncfs)return w(null);b.type.syncfs(b,a,w)})},mount:(a,s,c)=>{var h=c==="/",d=!c,w;if(h&&g.root)throw new g.ErrnoError(10);if(!h&&!d){var b=g.lookupPath(c,{follow_mount:!1});if(c=b.path,w=b.node,g.isMountpoint(w))throw new g.ErrnoError(10);if(!g.isDir(w.mode))throw new g.ErrnoError(54)}var _={type:a,opts:s,mountpoint:c,mounts:[]},E=a.mount(_);return E.mount=_,_.root=E,h?g.root=E:w&&(w.mounted=_,w.mount&&w.mount.mounts.push(_)),E},unmount:a=>{var s=g.lookupPath(a,{follow_mount:!1});if(!g.isMountpoint(s.node))throw new g.ErrnoError(28);var c=s.node,h=c.mounted,d=g.getMounts(h);Object.keys(g.nameTable).forEach(b=>{for(var _=g.nameTable[b];_;){var E=_.name_next;d.includes(_.mount)&&g.destroyNode(_),_=E}}),c.mounted=null;var w=c.mount.mounts.indexOf(h);c.mount.mounts.splice(w,1)},lookup:(a,s)=>a.node_ops.lookup(a,s),mknod:(a,s,c)=>{var h=g.lookupPath(a,{parent:!0}),d=h.node,w=ce.basename(a);if(!w||w==="."||w==="..")throw new g.ErrnoError(28);var b=g.mayCreate(d,w);if(b)throw new g.ErrnoError(b);if(!d.node_ops.mknod)throw new g.ErrnoError(63);return d.node_ops.mknod(d,w,s,c)},create:(a,s)=>(s=s!==void 0?s:438,s&=4095,s|=32768,g.mknod(a,s,0)),mkdir:(a,s)=>(s=s!==void 0?s:511,s&=1023,s|=16384,g.mknod(a,s,0)),mkdirTree:(a,s)=>{for(var c=a.split("/"),h="",d=0;d<c.length;++d)if(c[d]){h+="/"+c[d];try{g.mkdir(h,s)}catch(w){if(w.errno!=20)throw w}}},mkdev:(a,s,c)=>(typeof c>"u"&&(c=s,s=438),s|=8192,g.mknod(a,s,c)),symlink:(a,s)=>{if(!At.resolve(a))throw new g.ErrnoError(44);var c=g.lookupPath(s,{parent:!0}),h=c.node;if(!h)throw new g.ErrnoError(44);var d=ce.basename(s),w=g.mayCreate(h,d);if(w)throw new g.ErrnoError(w);if(!h.node_ops.symlink)throw new g.ErrnoError(63);return h.node_ops.symlink(h,d,a)},rename:(a,s)=>{var c=ce.dirname(a),h=ce.dirname(s),d=ce.basename(a),w=ce.basename(s),b,_,E;if(b=g.lookupPath(a,{parent:!0}),_=b.node,b=g.lookupPath(s,{parent:!0}),E=b.node,!_||!E)throw new g.ErrnoError(44);if(_.mount!==E.mount)throw new g.ErrnoError(75);var k=g.lookupNode(_,d),U=At.relative(a,h);if(U.charAt(0)!==".")throw new g.ErrnoError(28);if(U=At.relative(s,c),U.charAt(0)!==".")throw new g.ErrnoError(55);var I;try{I=g.lookupNode(E,w)}catch{}if(k!==I){var D=g.isDir(k.mode),N=g.mayDelete(_,d,D);if(N)throw new g.ErrnoError(N);if(N=I?g.mayDelete(E,w,D):g.mayCreate(E,w),N)throw new g.ErrnoError(N);if(!_.node_ops.rename)throw new g.ErrnoError(63);if(g.isMountpoint(k)||I&&g.isMountpoint(I))throw new g.ErrnoError(10);if(E!==_&&(N=g.nodePermissions(_,"w"),N))throw new g.ErrnoError(N);g.hashRemoveNode(k);try{_.node_ops.rename(k,E,w)}catch(X){throw X}finally{g.hashAddNode(k)}}},rmdir:a=>{var s=g.lookupPath(a,{parent:!0}),c=s.node,h=ce.basename(a),d=g.lookupNode(c,h),w=g.mayDelete(c,h,!0);if(w)throw new g.ErrnoError(w);if(!c.node_ops.rmdir)throw new g.ErrnoError(63);if(g.isMountpoint(d))throw new g.ErrnoError(10);c.node_ops.rmdir(c,h),g.destroyNode(d)},readdir:a=>{var s=g.lookupPath(a,{follow:!0}),c=s.node;if(!c.node_ops.readdir)throw new g.ErrnoError(54);return c.node_ops.readdir(c)},unlink:a=>{var s=g.lookupPath(a,{parent:!0}),c=s.node;if(!c)throw new g.ErrnoError(44);var h=ce.basename(a),d=g.lookupNode(c,h),w=g.mayDelete(c,h,!1);if(w)throw new g.ErrnoError(w);if(!c.node_ops.unlink)throw new g.ErrnoError(63);if(g.isMountpoint(d))throw new g.ErrnoError(10);c.node_ops.unlink(c,h),g.destroyNode(d)},readlink:a=>{var s=g.lookupPath(a),c=s.node;if(!c)throw new g.ErrnoError(44);if(!c.node_ops.readlink)throw new g.ErrnoError(28);return At.resolve(g.getPath(c.parent),c.node_ops.readlink(c))},stat:(a,s)=>{var c=g.lookupPath(a,{follow:!s}),h=c.node;if(!h)throw new g.ErrnoError(44);if(!h.node_ops.getattr)throw new g.ErrnoError(63);return h.node_ops.getattr(h)},lstat:a=>g.stat(a,!0),chmod:(a,s,c)=>{var h;if(typeof a=="string"){var d=g.lookupPath(a,{follow:!c});h=d.node}else h=a;if(!h.node_ops.setattr)throw new g.ErrnoError(63);h.node_ops.setattr(h,{mode:s&4095|h.mode&-4096,timestamp:Date.now()})},lchmod:(a,s)=>{g.chmod(a,s,!0)},fchmod:(a,s)=>{var c=g.getStream(a);if(!c)throw new g.ErrnoError(8);g.chmod(c.node,s)},chown:(a,s,c,h)=>{var d;if(typeof a=="string"){var w=g.lookupPath(a,{follow:!h});d=w.node}else d=a;if(!d.node_ops.setattr)throw new g.ErrnoError(63);d.node_ops.setattr(d,{timestamp:Date.now()})},lchown:(a,s,c)=>{g.chown(a,s,c,!0)},fchown:(a,s,c)=>{var h=g.getStream(a);if(!h)throw new g.ErrnoError(8);g.chown(h.node,s,c)},truncate:(a,s)=>{if(s<0)throw new g.ErrnoError(28);var c;if(typeof a=="string"){var h=g.lookupPath(a,{follow:!0});c=h.node}else c=a;if(!c.node_ops.setattr)throw new g.ErrnoError(63);if(g.isDir(c.mode))throw new g.ErrnoError(31);if(!g.isFile(c.mode))throw new g.ErrnoError(28);var d=g.nodePermissions(c,"w");if(d)throw new g.ErrnoError(d);c.node_ops.setattr(c,{size:s,timestamp:Date.now()})},ftruncate:(a,s)=>{var c=g.getStream(a);if(!c)throw new g.ErrnoError(8);if(!(c.flags&2097155))throw new g.ErrnoError(28);g.truncate(c.node,s)},utime:(a,s,c)=>{var h=g.lookupPath(a,{follow:!0}),d=h.node;d.node_ops.setattr(d,{timestamp:Math.max(s,c)})},open:(a,s,c)=>{if(a==="")throw new g.ErrnoError(44);s=typeof s=="string"?g.modeStringToFlags(s):s,c=typeof c>"u"?438:c,s&64?c=c&4095|32768:c=0;var h;if(typeof a=="object")h=a;else{a=ce.normalize(a);try{var d=g.lookupPath(a,{follow:!(s&131072)});h=d.node}catch{}}var w=!1;if(s&64)if(h){if(s&128)throw new g.ErrnoError(20)}else h=g.mknod(a,c,0),w=!0;if(!h)throw new g.ErrnoError(44);if(g.isChrdev(h.mode)&&(s&=-513),s&65536&&!g.isDir(h.mode))throw new g.ErrnoError(54);if(!w){var b=g.mayOpen(h,s);if(b)throw new g.ErrnoError(b)}s&512&&!w&&g.truncate(h,0),s&=-131713;var _=g.createStream({node:h,path:g.getPath(h),flags:s,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return _.stream_ops.open&&_.stream_ops.open(_),r.logReadFiles&&!(s&1)&&(g.readFiles||(g.readFiles={}),a in g.readFiles||(g.readFiles[a]=1)),_},close:a=>{if(g.isClosed(a))throw new g.ErrnoError(8);a.getdents&&(a.getdents=null);try{a.stream_ops.close&&a.stream_ops.close(a)}catch(s){throw s}finally{g.closeStream(a.fd)}a.fd=null},isClosed:a=>a.fd===null,llseek:(a,s,c)=>{if(g.isClosed(a))throw new g.ErrnoError(8);if(!a.seekable||!a.stream_ops.llseek)throw new g.ErrnoError(70);if(c!=0&&c!=1&&c!=2)throw new g.ErrnoError(28);return a.position=a.stream_ops.llseek(a,s,c),a.ungotten=[],a.position},read:(a,s,c,h,d)=>{if(h<0||d<0)throw new g.ErrnoError(28);if(g.isClosed(a))throw new g.ErrnoError(8);if((a.flags&2097155)===1)throw new g.ErrnoError(8);if(g.isDir(a.node.mode))throw new g.ErrnoError(31);if(!a.stream_ops.read)throw new g.ErrnoError(28);var w=typeof d<"u";if(!w)d=a.position;else if(!a.seekable)throw new g.ErrnoError(70);var b=a.stream_ops.read(a,s,c,h,d);return w||(a.position+=b),b},write:(a,s,c,h,d,w)=>{if(h<0||d<0)throw new g.ErrnoError(28);if(g.isClosed(a))throw new g.ErrnoError(8);if(!(a.flags&2097155))throw new g.ErrnoError(8);if(g.isDir(a.node.mode))throw new g.ErrnoError(31);if(!a.stream_ops.write)throw new g.ErrnoError(28);a.seekable&&a.flags&1024&&g.llseek(a,0,2);var b=typeof d<"u";if(!b)d=a.position;else if(!a.seekable)throw new g.ErrnoError(70);var _=a.stream_ops.write(a,s,c,h,d,w);return b||(a.position+=_),_},allocate:(a,s,c)=>{if(g.isClosed(a))throw new g.ErrnoError(8);if(s<0||c<=0)throw new g.ErrnoError(28);if(!(a.flags&2097155))throw new g.ErrnoError(8);if(!g.isFile(a.node.mode)&&!g.isDir(a.node.mode))throw new g.ErrnoError(43);if(!a.stream_ops.allocate)throw new g.ErrnoError(138);a.stream_ops.allocate(a,s,c)},mmap:(a,s,c,h,d)=>{if(h&2&&!(d&2)&&(a.flags&2097155)!==2)throw new g.ErrnoError(2);if((a.flags&2097155)===1)throw new g.ErrnoError(2);if(!a.stream_ops.mmap)throw new g.ErrnoError(43);return a.stream_ops.mmap(a,s,c,h,d)},msync:(a,s,c,h,d)=>!a||!a.stream_ops.msync?0:a.stream_ops.msync(a,s,c,h,d),munmap:a=>0,ioctl:(a,s,c)=>{if(!a.stream_ops.ioctl)throw new g.ErrnoError(59);return a.stream_ops.ioctl(a,s,c)},readFile:(a,s={})=>{if(s.flags=s.flags||0,s.encoding=s.encoding||"binary",s.encoding!=="utf8"&&s.encoding!=="binary")throw new Error('Invalid encoding type "'+s.encoding+'"');var c,h=g.open(a,s.flags),d=g.stat(a),w=d.size,b=new Uint8Array(w);return g.read(h,b,0,w,0),s.encoding==="utf8"?c=Ae(b,0):s.encoding==="binary"&&(c=b),g.close(h),c},writeFile:(a,s,c={})=>{c.flags=c.flags||577;var h=g.open(a,c.flags,c.mode);if(typeof s=="string"){var d=new Uint8Array(ue(s)+1),w=ye(s,d,0,d.length);g.write(h,d,0,w,void 0,c.canOwn)}else if(ArrayBuffer.isView(s))g.write(h,s,0,s.byteLength,void 0,c.canOwn);else throw new Error("Unsupported data type");g.close(h)},cwd:()=>g.currentPath,chdir:a=>{var s=g.lookupPath(a,{follow:!0});if(s.node===null)throw new g.ErrnoError(44);if(!g.isDir(s.node.mode))throw new g.ErrnoError(54);var c=g.nodePermissions(s.node,"x");if(c)throw new g.ErrnoError(c);g.currentPath=s.path},createDefaultDirectories:()=>{g.mkdir("/tmp"),g.mkdir("/home"),g.mkdir("/home/web_user")},createDefaultDevices:()=>{g.mkdir("/dev"),g.registerDevice(g.makedev(1,3),{read:()=>0,write:(s,c,h,d,w)=>d}),g.mkdev("/dev/null",g.makedev(1,3)),or.register(g.makedev(5,0),or.default_tty_ops),or.register(g.makedev(6,0),or.default_tty1_ops),g.mkdev("/dev/tty",g.makedev(5,0)),g.mkdev("/dev/tty1",g.makedev(6,0));var a=nl();g.createDevice("/dev","random",a),g.createDevice("/dev","urandom",a),g.mkdir("/dev/shm"),g.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{g.mkdir("/proc");var a=g.mkdir("/proc/self");g.mkdir("/proc/self/fd"),g.mount({mount:()=>{var s=g.createNode(a,"fd",16895,73);return s.node_ops={lookup:(c,h)=>{var d=+h,w=g.getStream(d);if(!w)throw new g.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return b.parent=b,b}},s}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?g.createDevice("/dev","stdin",r.stdin):g.symlink("/dev/tty","/dev/stdin"),r.stdout?g.createDevice("/dev","stdout",null,r.stdout):g.symlink("/dev/tty","/dev/stdout"),r.stderr?g.createDevice("/dev","stderr",null,r.stderr):g.symlink("/dev/tty1","/dev/stderr"),g.open("/dev/stdin",0),g.open("/dev/stdout",1),g.open("/dev/stderr",1)},ensureErrnoError:()=>{g.ErrnoError||(g.ErrnoError=function(s,c){this.node=c,this.setErrno=function(h){this.errno=h},this.setErrno(s),this.message="FS error"},g.ErrnoError.prototype=new Error,g.ErrnoError.prototype.constructor=g.ErrnoError,[44].forEach(a=>{g.genericErrors[a]=new g.ErrnoError(a),g.genericErrors[a].stack="<generic error, no stack>"}))},staticInit:()=>{g.ensureErrnoError(),g.nameTable=new Array(4096),g.mount(Q,{},"/"),g.createDefaultDirectories(),g.createDefaultDevices(),g.createSpecialDirectories(),g.filesystems={MEMFS:Q}},init:(a,s,c)=>{g.init.initialized=!0,g.ensureErrnoError(),r.stdin=a||r.stdin,r.stdout=s||r.stdout,r.stderr=c||r.stderr,g.createStandardStreams()},quit:()=>{g.init.initialized=!1;for(var a=0;a<g.streams.length;a++){var s=g.streams[a];s&&g.close(s)}},getMode:(a,s)=>{var c=0;return a&&(c|=365),s&&(c|=146),c},findObject:(a,s)=>{var c=g.analyzePath(a,s);return c.exists?c.object:null},analyzePath:(a,s)=>{try{var c=g.lookupPath(a,{follow:!s});a=c.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var c=g.lookupPath(a,{parent:!0});h.parentExists=!0,h.parentPath=c.path,h.parentObject=c.node,h.name=ce.basename(a),c=g.lookupPath(a,{follow:!s}),h.exists=!0,h.path=c.path,h.object=c.node,h.name=c.node.name,h.isRoot=c.path==="/"}catch(d){h.error=d.errno}return h},createPath:(a,s,c,h)=>{a=typeof a=="string"?a:g.getPath(a);for(var d=s.split("/").reverse();d.length;){var w=d.pop();if(w){var b=ce.join2(a,w);try{g.mkdir(b)}catch{}a=b}}return b},createFile:(a,s,c,h,d)=>{var w=ce.join2(typeof a=="string"?a:g.getPath(a),s),b=g.getMode(h,d);return g.create(w,b)},createDataFile:(a,s,c,h,d,w)=>{var b=s;a&&(a=typeof a=="string"?a:g.getPath(a),b=s?ce.join2(a,s):a);var _=g.getMode(h,d),E=g.create(b,_);if(c){if(typeof c=="string"){for(var k=new Array(c.length),U=0,I=c.length;U<I;++U)k[U]=c.charCodeAt(U);c=k}g.chmod(E,_|146);var D=g.open(E,577);g.write(D,c,0,c.length,0,w),g.close(D),g.chmod(E,_)}return E},createDevice:(a,s,c,h)=>{var d=ce.join2(typeof a=="string"?a:g.getPath(a),s),w=g.getMode(!!c,!!h);g.createDevice.major||(g.createDevice.major=64);var b=g.makedev(g.createDevice.major++,0);return g.registerDevice(b,{open:_=>{_.seekable=!1},close:_=>{h&&h.buffer&&h.buffer.length&&h(10)},read:(_,E,k,U,I)=>{for(var D=0,N=0;N<U;N++){var X;try{X=c()}catch{throw new g.ErrnoError(29)}if(X===void 0&&D===0)throw new g.ErrnoError(6);if(X==null)break;D++,E[k+N]=X}return D&&(_.node.timestamp=Date.now()),D},write:(_,E,k,U,I)=>{for(var D=0;D<U;D++)try{h(E[k+D])}catch{throw new g.ErrnoError(29)}return U&&(_.node.timestamp=Date.now()),D}}),g.mkdev(d,w,b)},forceLoadFile:a=>{if(a.isDevice||a.isFolder||a.link||a.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(S)try{a.contents=In(S(a.url),!0),a.usedBytes=a.contents.length}catch{throw new g.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(a,s,c,h,d)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(N){if(!(N>this.length-1||N<0)){var X=N%this.chunkSize,pe=N/this.chunkSize|0;return this.getter(pe)[X]}},w.prototype.setDataGetter=function(N){this.getter=N},w.prototype.cacheLength=function(){var N=new XMLHttpRequest;if(N.open("HEAD",c,!1),N.send(null),!(N.status>=200&&N.status<300||N.status===304))throw new Error("Couldn't load "+c+". Status: "+N.status);var X=Number(N.getResponseHeader("Content-length")),pe,De=(pe=N.getResponseHeader("Accept-Ranges"))&&pe==="bytes",Me=(pe=N.getResponseHeader("Content-Encoding"))&&pe==="gzip",R=1024*1024;De||(R=X);var $=(we,rt)=>{if(we>rt)throw new Error("invalid range ("+we+", "+rt+") or no bytes requested!");if(rt>X-1)throw new Error("only "+X+" bytes available! programmer error!");var Fe=new XMLHttpRequest;if(Fe.open("GET",c,!1),X!==R&&Fe.setRequestHeader("Range","bytes="+we+"-"+rt),Fe.responseType="arraybuffer",Fe.overrideMimeType&&Fe.overrideMimeType("text/plain; charset=x-user-defined"),Fe.send(null),!(Fe.status>=200&&Fe.status<300||Fe.status===304))throw new Error("Couldn't load "+c+". Status: "+Fe.status);return Fe.response!==void 0?new Uint8Array(Fe.response||[]):In(Fe.responseText||"",!0)},Ie=this;Ie.setDataGetter(we=>{var rt=we*R,Fe=(we+1)*R-1;if(Fe=Math.min(Fe,X-1),typeof Ie.chunks[we]>"u"&&(Ie.chunks[we]=$(rt,Fe)),typeof Ie.chunks[we]>"u")throw new Error("doXHR failed!");return Ie.chunks[we]}),(Me||!X)&&(R=X=1,X=this.getter(0).length,R=X,Y("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=X,this._chunkSize=R,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new w;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var _={isDevice:!1,contents:b}}else var _={isDevice:!1,url:c};var E=g.createFile(a,s,_,h,d);_.contents?E.contents=_.contents:_.url&&(E.contents=null,E.url=_.url),Object.defineProperties(E,{usedBytes:{get:function(){return this.contents.length}}});var k={},U=Object.keys(E.stream_ops);U.forEach(D=>{var N=E.stream_ops[D];k[D]=function(){return g.forceLoadFile(E),N.apply(null,arguments)}});function I(D,N,X,pe,De){var Me=D.node.contents;if(De>=Me.length)return 0;var R=Math.min(Me.length-De,pe);if(Me.slice)for(var $=0;$<R;$++)N[X+$]=Me[De+$];else for(var $=0;$<R;$++)N[X+$]=Me.get(De+$);return R}return k.read=(D,N,X,pe,De)=>(g.forceLoadFile(E),I(D,N,X,pe,De)),k.mmap=(D,N,X,pe,De)=>{g.forceLoadFile(E);var Me=Xi(N);if(!Me)throw new g.ErrnoError(48);return I(D,Ve,Me,N,X),{ptr:Me,allocated:!0}},E.stream_ops=k,E},createPreloadedFile:(a,s,c,h,d,w,b,_,E,k)=>{var U=s?At.resolve(ce.join2(a,s)):a;function I(D){function N(X){k&&k(),_||g.createDataFile(a,s,X,h,d,E),w&&w(),_n()}Browser.handledByPreloadPlugin(D,U,N,()=>{b&&b(),_n()})||N(D)}ko(),typeof c=="string"?al(c,D=>I(D),b):I(c)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(a,s,c)=>{s=s||(()=>{}),c=c||(()=>{});var h=g.indexedDB();try{var d=h.open(g.DB_NAME(),g.DB_VERSION)}catch(w){return c(w)}d.onupgradeneeded=()=>{Y("creating db");var w=d.result;w.createObjectStore(g.DB_STORE_NAME)},d.onsuccess=()=>{var w=d.result,b=w.transaction([g.DB_STORE_NAME],"readwrite"),_=b.objectStore(g.DB_STORE_NAME),E=0,k=0,U=a.length;function I(){k==0?s():c()}a.forEach(D=>{var N=_.put(g.analyzePath(D).object.contents,D);N.onsuccess=()=>{E++,E+k==U&&I()},N.onerror=()=>{k++,E+k==U&&I()}}),b.onerror=c},d.onerror=c},loadFilesFromDB:(a,s,c)=>{s=s||(()=>{}),c=c||(()=>{});var h=g.indexedDB();try{var d=h.open(g.DB_NAME(),g.DB_VERSION)}catch(w){return c(w)}d.onupgradeneeded=c,d.onsuccess=()=>{var w=d.result;try{var b=w.transaction([g.DB_STORE_NAME],"readonly")}catch(D){c(D);return}var _=b.objectStore(g.DB_STORE_NAME),E=0,k=0,U=a.length;function I(){k==0?s():c()}a.forEach(D=>{var N=_.get(D);N.onsuccess=()=>{g.analyzePath(D).exists&&g.unlink(D),g.createDataFile(ce.dirname(D),ce.basename(D),N.result,!0,!0,!0),E++,E+k==U&&I()},N.onerror=()=>{k++,E+k==U&&I()}}),b.onerror=c},d.onerror=c}},fe={DEFAULT_POLLMASK:5,calculateAt:function(a,s,c){if(ce.isAbs(s))return s;var h;if(a===-100)h=g.cwd();else{var d=g.getStream(a);if(!d)throw new g.ErrnoError(8);h=d.path}if(s.length==0){if(!c)throw new g.ErrnoError(44);return h}return ce.join2(h,s)},doStat:function(a,s,c){try{var h=a(s)}catch(d){if(d&&d.node&&ce.normalize(s)!==ce.normalize(g.getPath(d.node)))return-54;throw d}return B[c>>2]=h.dev,B[c+4>>2]=0,B[c+8>>2]=h.ino,B[c+12>>2]=h.mode,B[c+16>>2]=h.nlink,B[c+20>>2]=h.uid,B[c+24>>2]=h.gid,B[c+28>>2]=h.rdev,B[c+32>>2]=0,kt=[h.size>>>0,($e=h.size,+Math.abs($e)>=1?$e>0?(Math.min(+Math.floor($e/4294967296),4294967295)|0)>>>0:~~+Math.ceil(($e-+(~~$e>>>0))/4294967296)>>>0:0)],B[c+40>>2]=kt[0],B[c+44>>2]=kt[1],B[c+48>>2]=4096,B[c+52>>2]=h.blocks,B[c+56>>2]=h.atime.getTime()/1e3|0,B[c+60>>2]=0,B[c+64>>2]=h.mtime.getTime()/1e3|0,B[c+68>>2]=0,B[c+72>>2]=h.ctime.getTime()/1e3|0,B[c+76>>2]=0,kt=[h.ino>>>0,($e=h.ino,+Math.abs($e)>=1?$e>0?(Math.min(+Math.floor($e/4294967296),4294967295)|0)>>>0:~~+Math.ceil(($e-+(~~$e>>>0))/4294967296)>>>0:0)],B[c+80>>2]=kt[0],B[c+84>>2]=kt[1],0},doMsync:function(a,s,c,h,d){var w=We.slice(a,a+c);g.msync(s,w,d,c,h)},varargs:void 0,get:function(){fe.varargs+=4;var a=B[fe.varargs-4>>2];return a},getStr:function(a){var s=se(a);return s},getStreamFromFD:function(a){var s=g.getStream(a);if(!s)throw new g.ErrnoError(8);return s}};function sl(a,s){try{return a=fe.getStr(a),g.chmod(a,s),0}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function ul(a,s,c,h){try{if(s=fe.getStr(s),s=fe.calculateAt(a,s),c&-8)return-28;var d=g.lookupPath(s,{follow:!0}),w=d.node;if(!w)return-44;var b="";return c&4&&(b+="r"),c&2&&(b+="w"),c&1&&(b+="x"),b&&g.nodePermissions(w,b)?-2:0}catch(_){if(typeof g>"u"||!(_ instanceof g.ErrnoError))throw _;return-_.errno}}function ll(a){return B[ha()>>2]=a,a}function cl(a,s,c){fe.varargs=c;try{var h=fe.getStreamFromFD(a);switch(s){case 0:{var d=fe.get();if(d<0)return-28;var w;return w=g.createStream(h,d),w.fd}case 1:case 2:return 0;case 3:return h.flags;case 4:{var d=fe.get();return h.flags|=d,0}case 5:{var d=fe.get(),b=0;return ft[d+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return ll(28),-1;default:return-28}}catch(_){if(typeof g>"u"||!(_ instanceof g.ErrnoError))throw _;return-_.errno}}function fl(a,s){try{var c=fe.getStreamFromFD(a);return fe.doStat(g.stat,c.path,s)}catch(h){if(typeof g>"u"||!(h instanceof g.ErrnoError))throw h;return-h.errno}}function hl(a,s,c){fe.varargs=c;try{var h=fe.getStreamFromFD(a);switch(s){case 21509:case 21505:return h.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return h.tty?0:-59;case 21519:{if(!h.tty)return-59;var d=fe.get();return B[d>>2]=0,0}case 21520:return h.tty?-28:-59;case 21531:{var d=fe.get();return g.ioctl(h,s,d)}case 21523:return h.tty?0:-59;case 21524:return h.tty?0:-59;default:Vt("bad ioctl syscall "+s)}}catch(w){if(typeof g>"u"||!(w instanceof g.ErrnoError))throw w;return-w.errno}}function pl(a,s){try{return a=fe.getStr(a),fe.doStat(g.lstat,a,s)}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function dl(a,s,c,h){try{s=fe.getStr(s);var d=h&256,w=h&4096;return h=h&-4353,s=fe.calculateAt(a,s,w),fe.doStat(d?g.lstat:g.stat,s,c)}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return-b.errno}}function vl(a,s,c,h){fe.varargs=h;try{s=fe.getStr(s),s=fe.calculateAt(a,s);var d=h?fe.get():0;return g.open(s,c,d).fd}catch(w){if(typeof g>"u"||!(w instanceof g.ErrnoError))throw w;return-w.errno}}function gl(a,s){try{return a=fe.getStr(a),fe.doStat(g.stat,a,s)}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function ml(a,s,c,h,d){}function En(a){switch(a){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+a)}}function yl(){for(var a=new Array(256),s=0;s<256;++s)a[s]=String.fromCharCode(s);Yi=a}var Yi=void 0;function Ze(a){for(var s="",c=a;We[c];)s+=Yi[We[c++]];return s}var br={},ir={},xn={},wl=48,bl=57;function Cn(a){if(a===void 0)return"_unknown";a=a.replace(/[^a-zA-Z0-9_]/g,"$");var s=a.charCodeAt(0);return s>=wl&&s<=bl?"_"+a:a}function Pn(a,s){return a=Cn(a),new Function("body","return function "+a+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(s)}function Oo(a,s){var c=Pn(s,function(h){this.name=s,this.message=h;var d=new Error(h).stack;d!==void 0&&(this.stack=this.toString()+`
`+d.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},c}var _r=void 0;function he(a){throw new _r(a)}var Zi=void 0;function kn(a){throw new Zi(a)}function ar(a,s,c){a.forEach(function(_){xn[_]=s});function h(_){var E=c(_);E.length!==a.length&&kn("Mismatched type converter count");for(var k=0;k<a.length;++k)_t(a[k],E[k])}var d=new Array(s.length),w=[],b=0;s.forEach((_,E)=>{ir.hasOwnProperty(_)?d[E]=ir[_]:(w.push(_),br.hasOwnProperty(_)||(br[_]=[]),br[_].push(()=>{d[E]=ir[_],++b,b===w.length&&h(d)}))}),w.length===0&&h(d)}function _t(a,s,c={}){if(!("argPackAdvance"in s))throw new TypeError("registerType registeredInstance requires argPackAdvance");var h=s.name;if(a||he('type "'+h+'" must have a positive integer typeid pointer'),ir.hasOwnProperty(a)){if(c.ignoreDuplicateRegistrations)return;he("Cannot register type '"+h+"' twice")}if(ir[a]=s,delete xn[a],br.hasOwnProperty(a)){var d=br[a];delete br[a],d.forEach(w=>w())}}function _l(a,s,c,h,d){var w=En(c);s=Ze(s),_t(a,{name:s,fromWireType:function(b){return!!b},toWireType:function(b,_){return _?h:d},argPackAdvance:8,readValueFromPointer:function(b){var _;if(c===1)_=Ve;else if(c===2)_=ft;else if(c===4)_=B;else throw new TypeError("Unknown boolean type size: "+s);return this.fromWireType(_[b>>w])},destructorFunction:null})}function Sl(a){if(!(this instanceof zt)||!(a instanceof zt))return!1;for(var s=this.$$.ptrType.registeredClass,c=this.$$.ptr,h=a.$$.ptrType.registeredClass,d=a.$$.ptr;s.baseClass;)c=s.upcast(c),s=s.baseClass;for(;h.baseClass;)d=h.upcast(d),h=h.baseClass;return s===h&&c===d}function Tl(a){return{count:a.count,deleteScheduled:a.deleteScheduled,preservePointerOnDelete:a.preservePointerOnDelete,ptr:a.ptr,ptrType:a.ptrType,smartPtr:a.smartPtr,smartPtrType:a.smartPtrType}}function Ro(a){function s(c){return c.$$.ptrType.registeredClass.name}he(s(a)+" instance already deleted")}var Do=!1;function ji(a){}function El(a){a.smartPtr?a.smartPtrType.rawDestructor(a.smartPtr):a.ptrType.registeredClass.rawDestructor(a.ptr)}function qi(a){a.count.value-=1;var s=a.count.value===0;s&&El(a)}function Ki(a,s,c){if(s===c)return a;if(c.baseClass===void 0)return null;var h=Ki(a,s,c.baseClass);return h===null?null:c.downcast(h)}var Qi={};function xl(){return Object.keys(Nr).length}function Cl(){var a=[];for(var s in Nr)Nr.hasOwnProperty(s)&&a.push(Nr[s]);return a}var Ir=[];function Mo(){for(;Ir.length;){var a=Ir.pop();a.$$.deleteScheduled=!1,a.delete()}}var Gr=void 0;function Pl(a){Gr=a,Ir.length&&Gr&&Gr(Mo)}function kl(){r.getInheritedInstanceCount=xl,r.getLiveInheritedInstances=Cl,r.flushPendingDeletes=Mo,r.setDelayFunction=Pl}var Nr={};function Al(a,s){for(s===void 0&&he("ptr should not be undefined");a.baseClass;)s=a.upcast(s),a=a.baseClass;return s}function Ol(a,s){return s=Al(a,s),Nr[s]}function An(a,s){(!s.ptrType||!s.ptr)&&kn("makeClassHandle requires ptr and ptrType");var c=!!s.smartPtrType,h=!!s.smartPtr;return c!==h&&kn("Both smartPtrType and smartPtr must be specified"),s.count={value:1},Hr(Object.create(a,{$$:{value:s}}))}function Rl(a){var s=this.getPointee(a);if(!s)return this.destructor(a),null;var c=Ol(this.registeredClass,s);if(c!==void 0){if(c.$$.count.value===0)return c.$$.ptr=s,c.$$.smartPtr=a,c.clone();var h=c.clone();return this.destructor(a),h}function d(){return this.isSmartPointer?An(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:s,smartPtrType:this,smartPtr:a}):An(this.registeredClass.instancePrototype,{ptrType:this,ptr:a})}var w=this.registeredClass.getActualType(s),b=Qi[w];if(!b)return d.call(this);var _;this.isConst?_=b.constPointerType:_=b.pointerType;var E=Ki(s,this.registeredClass,_.registeredClass);return E===null?d.call(this):this.isSmartPointer?An(_.registeredClass.instancePrototype,{ptrType:_,ptr:E,smartPtrType:this,smartPtr:a}):An(_.registeredClass.instancePrototype,{ptrType:_,ptr:E})}function Hr(a){return typeof FinalizationRegistry>"u"?(Hr=s=>s,a):(Do=new FinalizationRegistry(s=>{qi(s.$$)}),Hr=s=>{var c=s.$$,h=!!c.smartPtr;if(h){var d={$$:c};Do.register(s,d,s)}return s},ji=s=>Do.unregister(s),Hr(a))}function Dl(){if(this.$$.ptr||Ro(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var a=Hr(Object.create(Object.getPrototypeOf(this),{$$:{value:Tl(this.$$)}}));return a.$$.count.value+=1,a.$$.deleteScheduled=!1,a}function Ml(){this.$$.ptr||Ro(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&he("Object already scheduled for deletion"),ji(this),qi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Fl(){return!this.$$.ptr}function Ll(){return this.$$.ptr||Ro(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&he("Object already scheduled for deletion"),Ir.push(this),Ir.length===1&&Gr&&Gr(Mo),this.$$.deleteScheduled=!0,this}function Bl(){zt.prototype.isAliasOf=Sl,zt.prototype.clone=Dl,zt.prototype.delete=Ml,zt.prototype.isDeleted=Fl,zt.prototype.deleteLater=Ll}function zt(){}function Fo(a,s,c){if(a[s].overloadTable===void 0){var h=a[s];a[s]=function(){return a[s].overloadTable.hasOwnProperty(arguments.length)||he("Function '"+c+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+a[s].overloadTable+")!"),a[s].overloadTable[arguments.length].apply(this,arguments)},a[s].overloadTable=[],a[s].overloadTable[h.argCount]=h}}function Ji(a,s,c){r.hasOwnProperty(a)?((c===void 0||r[a].overloadTable!==void 0&&r[a].overloadTable[c]!==void 0)&&he("Cannot register public name '"+a+"' twice"),Fo(r,a,a),r.hasOwnProperty(c)&&he("Cannot register multiple overloads of a function with the same number of arguments ("+c+")!"),r[a].overloadTable[c]=s):(r[a]=s,c!==void 0&&(r[a].numArguments=c))}function Ul(a,s,c,h,d,w,b,_){this.name=a,this.constructor=s,this.instancePrototype=c,this.rawDestructor=h,this.baseClass=d,this.getActualType=w,this.upcast=b,this.downcast=_,this.pureVirtualFunctions=[]}function Lo(a,s,c){for(;s!==c;)s.upcast||he("Expected null or instance of "+c.name+", got an instance of "+s.name),a=s.upcast(a),s=s.baseClass;return a}function Il(a,s){if(s===null)return this.isReference&&he("null is not a valid "+this.name),0;s.$$||he('Cannot pass "'+No(s)+'" as a '+this.name),s.$$.ptr||he("Cannot pass deleted object as a pointer of type "+this.name);var c=s.$$.ptrType.registeredClass,h=Lo(s.$$.ptr,c,this.registeredClass);return h}function Gl(a,s){var c;if(s===null)return this.isReference&&he("null is not a valid "+this.name),this.isSmartPointer?(c=this.rawConstructor(),a!==null&&a.push(this.rawDestructor,c),c):0;s.$$||he('Cannot pass "'+No(s)+'" as a '+this.name),s.$$.ptr||he("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&s.$$.ptrType.isConst&&he("Cannot convert argument of type "+(s.$$.smartPtrType?s.$$.smartPtrType.name:s.$$.ptrType.name)+" to parameter type "+this.name);var h=s.$$.ptrType.registeredClass;if(c=Lo(s.$$.ptr,h,this.registeredClass),this.isSmartPointer)switch(s.$$.smartPtr===void 0&&he("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:s.$$.smartPtrType===this?c=s.$$.smartPtr:he("Cannot convert argument of type "+(s.$$.smartPtrType?s.$$.smartPtrType.name:s.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:c=s.$$.smartPtr;break;case 2:if(s.$$.smartPtrType===this)c=s.$$.smartPtr;else{var d=s.clone();c=this.rawShare(c,Ue.toHandle(function(){d.delete()})),a!==null&&a.push(this.rawDestructor,c)}break;default:he("Unsupporting sharing policy")}return c}function Nl(a,s){if(s===null)return this.isReference&&he("null is not a valid "+this.name),0;s.$$||he('Cannot pass "'+No(s)+'" as a '+this.name),s.$$.ptr||he("Cannot pass deleted object as a pointer of type "+this.name),s.$$.ptrType.isConst&&he("Cannot convert argument of type "+s.$$.ptrType.name+" to parameter type "+this.name);var c=s.$$.ptrType.registeredClass,h=Lo(s.$$.ptr,c,this.registeredClass);return h}function On(a){return this.fromWireType(te[a>>2])}function Hl(a){return this.rawGetPointee&&(a=this.rawGetPointee(a)),a}function Vl(a){this.rawDestructor&&this.rawDestructor(a)}function zl(a){a!==null&&a.delete()}function Wl(){Ot.prototype.getPointee=Hl,Ot.prototype.destructor=Vl,Ot.prototype.argPackAdvance=8,Ot.prototype.readValueFromPointer=On,Ot.prototype.deleteObject=zl,Ot.prototype.fromWireType=Rl}function Ot(a,s,c,h,d,w,b,_,E,k,U){this.name=a,this.registeredClass=s,this.isReference=c,this.isConst=h,this.isSmartPointer=d,this.pointeeType=w,this.sharingPolicy=b,this.rawGetPointee=_,this.rawConstructor=E,this.rawShare=k,this.rawDestructor=U,!d&&s.baseClass===void 0?h?(this.toWireType=Il,this.destructorFunction=null):(this.toWireType=Nl,this.destructorFunction=null):this.toWireType=Gl}function $l(a,s,c){r.hasOwnProperty(a)||kn("Replacing nonexistant public symbol"),r[a].overloadTable!==void 0&&c!==void 0?r[a].overloadTable[c]=s:(r[a]=s,r[a].argCount=c)}function Xl(a,s,c){var h=r["dynCall_"+a];return c&&c.length?h.apply(null,[s].concat(c)):h.call(null,s)}function Yl(a,s,c){return a.includes("j")?Xl(a,s,c):Tn(s).apply(null,c)}function Zl(a,s){var c=[];return function(){return c.length=0,Object.assign(c,arguments),Yl(a,s,c)}}function sr(a,s){a=Ze(a);function c(){return a.includes("j")?Zl(a,s):Tn(s)}var h=c();return typeof h!="function"&&he("unknown function pointer with signature "+a+": "+s),h}var ea=void 0;function ta(a){var s=pa(a),c=Ze(s);return Mt(s),c}function Rn(a,s){var c=[],h={};function d(w){if(!h[w]&&!ir[w]){if(xn[w]){xn[w].forEach(d);return}c.push(w),h[w]=!0}}throw s.forEach(d),new ea(a+": "+c.map(ta).join([", "]))}function jl(a,s,c,h,d,w,b,_,E,k,U,I,D){U=Ze(U),w=sr(d,w),_&&(_=sr(b,_)),k&&(k=sr(E,k)),D=sr(I,D);var N=Cn(U);Ji(N,function(){Rn("Cannot construct "+U+" due to unbound types",[h])}),ar([a,s,c],h?[h]:[],function(X){X=X[0];var pe,De;h?(pe=X.registeredClass,De=pe.instancePrototype):De=zt.prototype;var Me=Pn(N,function(){if(Object.getPrototypeOf(this)!==R)throw new _r("Use 'new' to construct "+U);if($.constructor_body===void 0)throw new _r(U+" has no accessible constructor");var Fe=$.constructor_body[arguments.length];if(Fe===void 0)throw new _r("Tried to invoke ctor of "+U+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys($.constructor_body).toString()+") parameters instead!");return Fe.apply(this,arguments)}),R=Object.create(De,{constructor:{value:Me}});Me.prototype=R;var $=new Ul(U,Me,R,D,pe,w,_,k),Ie=new Ot(U,$,!0,!1,!1),we=new Ot(U+"*",$,!1,!1,!1),rt=new Ot(U+" const*",$,!1,!0,!1);return Qi[a]={pointerType:we,constPointerType:rt},$l(N,Me),[Ie,we,rt]})}function ra(a,s){if(!(a instanceof Function))throw new TypeError("new_ called with constructor type "+typeof a+" which is not a function");var c=Pn(a.name||"unknownFunctionName",function(){});c.prototype=a.prototype;var h=new c,d=a.apply(h,s);return d instanceof Object?d:h}function na(a){for(;a.length;){var s=a.pop(),c=a.pop();c(s)}}function Bo(a,s,c,h,d){var w=s.length;w<2&&he("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var b=s[1]!==null&&c!==null,_=!1,E=1;E<s.length;++E)if(s[E]!==null&&s[E].destructorFunction===void 0){_=!0;break}for(var k=s[0].name!=="void",U="",I="",E=0;E<w-2;++E)U+=(E!==0?", ":"")+"arg"+E,I+=(E!==0?", ":"")+"arg"+E+"Wired";var D="return function "+Cn(a)+"("+U+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+a+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;_&&(D+=`var destructors = [];
`);var N=_?"destructors":"null",X=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],pe=[he,h,d,na,s[0],s[1]];b&&(D+="var thisWired = classParam.toWireType("+N+`, this);
`);for(var E=0;E<w-2;++E)D+="var arg"+E+"Wired = argType"+E+".toWireType("+N+", arg"+E+"); // "+s[E+2].name+`
`,X.push("argType"+E),pe.push(s[E+2]);if(b&&(I="thisWired"+(I.length>0?", ":"")+I),D+=(k?"var rv = ":"")+"invoker(fn"+(I.length>0?", ":"")+I+`);
`,_)D+=`runDestructors(destructors);
`;else for(var E=b?1:2;E<s.length;++E){var De=E===1?"thisWired":"arg"+(E-2)+"Wired";s[E].destructorFunction!==null&&(D+=De+"_dtor("+De+"); // "+s[E].name+`
`,X.push(De+"_dtor"),pe.push(s[E].destructorFunction))}k&&(D+=`var ret = retType.fromWireType(rv);
return ret;
`),D+=`}
`,X.push(D);var Me=ra(Function,X).apply(null,pe);return Me}function Uo(a,s){for(var c=[],h=0;h<a;h++)c.push(B[(s>>2)+h]);return c}function ql(a,s,c,h,d,w,b){var _=Uo(c,h);s=Ze(s),w=sr(d,w),ar([],[a],function(E){E=E[0];var k=E.name+"."+s;function U(){Rn("Cannot call "+k+" due to unbound types",_)}s.startsWith("@@")&&(s=Symbol[s.substring(2)]);var I=E.registeredClass.constructor;return I[s]===void 0?(U.argCount=c-1,I[s]=U):(Fo(I,s,k),I[s].overloadTable[c-1]=U),ar([],_,function(D){var N=[D[0],null].concat(D.slice(1)),X=Bo(k,N,null,w,b);return I[s].overloadTable===void 0?(X.argCount=c-1,I[s]=X):I[s].overloadTable[c-1]=X,[]}),[]})}function Kl(a,s,c,h,d,w){xe(s>0);var b=Uo(s,c);d=sr(h,d),ar([],[a],function(_){_=_[0];var E="constructor "+_.name;if(_.registeredClass.constructor_body===void 0&&(_.registeredClass.constructor_body=[]),_.registeredClass.constructor_body[s-1]!==void 0)throw new _r("Cannot register multiple constructors with identical number of parameters ("+(s-1)+") for class '"+_.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return _.registeredClass.constructor_body[s-1]=()=>{Rn("Cannot construct "+_.name+" due to unbound types",b)},ar([],b,function(k){return k.splice(1,0,null),_.registeredClass.constructor_body[s-1]=Bo(E,k,null,d,w),[]}),[]})}function Ql(a,s,c,h,d,w,b,_){var E=Uo(c,h);s=Ze(s),w=sr(d,w),ar([],[a],function(k){k=k[0];var U=k.name+"."+s;s.startsWith("@@")&&(s=Symbol[s.substring(2)]),_&&k.registeredClass.pureVirtualFunctions.push(s);function I(){Rn("Cannot call "+U+" due to unbound types",E)}var D=k.registeredClass.instancePrototype,N=D[s];return N===void 0||N.overloadTable===void 0&&N.className!==k.name&&N.argCount===c-2?(I.argCount=c-2,I.className=k.name,D[s]=I):(Fo(D,s,U),D[s].overloadTable[c-2]=I),ar([],E,function(X){var pe=Bo(U,X,k,w,b);return D[s].overloadTable===void 0?(pe.argCount=c-2,D[s]=pe):D[s].overloadTable[c-2]=pe,[]}),[]})}var Io=[],ht=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Go(a){a>4&&--ht[a].refcount===0&&(ht[a]=void 0,Io.push(a))}function Jl(){for(var a=0,s=5;s<ht.length;++s)ht[s]!==void 0&&++a;return a}function ec(){for(var a=5;a<ht.length;++a)if(ht[a]!==void 0)return ht[a];return null}function tc(){r.count_emval_handles=Jl,r.get_first_emval=ec}var Ue={toValue:a=>(a||he("Cannot use deleted val. handle = "+a),ht[a].value),toHandle:a=>{switch(a){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var s=Io.length?Io.pop():ht.length;return ht[s]={refcount:1,value:a},s}}}};function rc(a,s){s=Ze(s),_t(a,{name:s,fromWireType:function(c){var h=Ue.toValue(c);return Go(c),h},toWireType:function(c,h){return Ue.toHandle(h)},argPackAdvance:8,readValueFromPointer:On,destructorFunction:null})}function nc(a,s,c){switch(s){case 0:return function(h){var d=c?Ve:We;return this.fromWireType(d[h])};case 1:return function(h){var d=c?ft:Ht;return this.fromWireType(d[h>>1])};case 2:return function(h){var d=c?B:te;return this.fromWireType(d[h>>2])};default:throw new TypeError("Unknown integer type: "+a)}}function oc(a,s,c,h){var d=En(c);s=Ze(s);function w(){}w.values={},_t(a,{name:s,constructor:w,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,_){return _.value},argPackAdvance:8,readValueFromPointer:nc(s,d,h),destructorFunction:null}),Ji(s,w)}function Dn(a,s){var c=ir[a];return c===void 0&&he(s+" has unknown type "+ta(a)),c}function ic(a,s,c){var h=Dn(a,"enum");s=Ze(s);var d=h.constructor,w=Object.create(h.constructor.prototype,{value:{value:c},constructor:{value:Pn(h.name+"_"+s,function(){})}});d.values[c]=w,d[s]=w}function No(a){if(a===null)return"null";var s=typeof a;return s==="object"||s==="array"||s==="function"?a.toString():""+a}function ac(a,s){switch(s){case 2:return function(c){return this.fromWireType(nt[c>>2])};case 3:return function(c){return this.fromWireType(yn[c>>3])};default:throw new TypeError("Unknown float type: "+a)}}function sc(a,s,c){var h=En(c);s=Ze(s),_t(a,{name:s,fromWireType:function(d){return d},toWireType:function(d,w){return w},argPackAdvance:8,readValueFromPointer:ac(s,h),destructorFunction:null})}function uc(a,s,c){switch(s){case 0:return c?function(d){return Ve[d]}:function(d){return We[d]};case 1:return c?function(d){return ft[d>>1]}:function(d){return Ht[d>>1]};case 2:return c?function(d){return B[d>>2]}:function(d){return te[d>>2]};default:throw new TypeError("Unknown integer type: "+a)}}function lc(a,s,c,h,d){s=Ze(s);var w=En(c),b=I=>I;if(h===0){var _=32-8*c;b=I=>I<<_>>>_}var E=s.includes("unsigned"),k=(I,D)=>{},U;E?U=function(I,D){return k(D,this.name),D>>>0}:U=function(I,D){return k(D,this.name),D},_t(a,{name:s,fromWireType:b,toWireType:U,argPackAdvance:8,readValueFromPointer:uc(s,w,h!==0),destructorFunction:null})}function cc(a,s,c){var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],d=h[s];function w(b){b=b>>2;var _=te,E=_[b],k=_[b+1];return new d(ct,k,E)}c=Ze(c),_t(a,{name:c,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function fc(a,s){s=Ze(s);var c=s==="std::string";_t(a,{name:s,fromWireType:function(h){var d=te[h>>2],w;if(c)for(var b=h+4,_=0;_<=d;++_){var E=h+4+_;if(_==d||We[E]==0){var k=E-b,U=se(b,k);w===void 0?w=U:(w+=String.fromCharCode(0),w+=U),b=E+1}}else{for(var I=new Array(d),_=0;_<d;++_)I[_]=String.fromCharCode(We[h+4+_]);w=I.join("")}return Mt(h),w},toWireType:function(h,d){d instanceof ArrayBuffer&&(d=new Uint8Array(d));var w,b=typeof d=="string";b||d instanceof Uint8Array||d instanceof Uint8ClampedArray||d instanceof Int8Array||he("Cannot pass non-string to std::string"),c&&b?w=()=>ue(d):w=()=>d.length;var _=w(),E=Dt(4+_+1);if(te[E>>2]=_,c&&b)Ce(d,E+4,_+1);else if(b)for(var k=0;k<_;++k){var U=d.charCodeAt(k);U>255&&(Mt(E),he("String has UTF-16 code units that do not fit in 8 bits")),We[E+4+k]=U}else for(var k=0;k<_;++k)We[E+4+k]=d[k];return h!==null&&h.push(Mt,E),E},argPackAdvance:8,readValueFromPointer:On,destructorFunction:function(h){Mt(h)}})}function hc(a,s,c){c=Ze(c);var h,d,w,b,_;s===2?(h=Oe,d=He,b=be,w=()=>Ht,_=1):s===4&&(h=Re,d=Pt,b=et,w=()=>te,_=2),_t(a,{name:c,fromWireType:function(E){for(var k=te[E>>2],U=w(),I,D=E+4,N=0;N<=k;++N){var X=E+4+N*s;if(N==k||U[X>>_]==0){var pe=X-D,De=h(D,pe);I===void 0?I=De:(I+=String.fromCharCode(0),I+=De),D=X+s}}return Mt(E),I},toWireType:function(E,k){typeof k!="string"&&he("Cannot pass non-string to C++ string type "+c);var U=b(k),I=Dt(4+U+s);return te[I>>2]=U>>_,d(k,I+4,U+s),E!==null&&E.push(Mt,I),I},argPackAdvance:8,readValueFromPointer:On,destructorFunction:function(E){Mt(E)}})}function pc(a,s){s=Ze(s),_t(a,{isVoid:!0,name:s,argPackAdvance:0,fromWireType:function(){},toWireType:function(c,h){}})}function dc(){return Date.now()}var vc=!0;function gc(){return vc}function mc(a,s,c){a=Ue.toValue(a),s=Dn(s,"emval::as");var h=[],d=Ue.toHandle(h);return B[c>>2]=d,s.toWireType(h,a)}function yc(a){var s=[];return B[a>>2]=Ue.toHandle(s),s}var wc={};function Ho(a){var s=wc[a];return s===void 0?Ze(a):s}var Vo=[];function bc(a,s,c,h,d){return a=Vo[a],s=Ue.toValue(s),c=Ho(c),a(s,c,yc(h),d)}function oa(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function _c(a){return a===0?Ue.toHandle(oa()):(a=Ho(a),Ue.toHandle(oa()[a]))}function Sc(a){var s=Vo.length;return Vo.push(a),s}function Tc(a,s){for(var c=new Array(a),h=0;h<a;++h)c[h]=Dn(te[s+h*ae>>2],"parameter "+h);return c}var ia=[];function Ec(a,s){var c=Tc(a,s),h=c[0],d=h.name+"_$"+c.slice(1).map(function(X){return X.name}).join("_")+"$",w=ia[d];if(w!==void 0)return w;for(var b=["retType"],_=[h],E="",k=0;k<a-1;++k)E+=(k!==0?", ":"")+"arg"+k,b.push("argType"+k),_.push(c[1+k]);for(var U=Cn("methodCaller_"+d),I="return function "+U+`(handle, name, destructors, args) {
`,D=0,k=0;k<a-1;++k)I+="    var arg"+k+" = argType"+k+".readValueFromPointer(args"+(D?"+"+D:"")+`);
`,D+=c[k+1].argPackAdvance;I+="    var rv = handle[name]("+E+`);
`;for(var k=0;k<a-1;++k)c[k+1].deleteObject&&(I+="    argType"+k+".deleteObject(arg"+k+`);
`);h.isVoid||(I+=`    return retType.toWireType(destructors, rv);
`),I+=`};
`,b.push(I);var N=ra(Function,b).apply(null,_);return w=Sc(N),ia[d]=w,w}function xc(a,s){return a=Ue.toValue(a),s=Ue.toValue(s),Ue.toHandle(a[s])}function Cc(a){a>4&&(ht[a].refcount+=1)}function Pc(a){return Ue.toHandle(Ho(a))}function kc(a){var s=Ue.toValue(a);na(s),Go(a)}function Ac(a,s,c){a=Ue.toValue(a),s=Ue.toValue(s),c=Ue.toValue(c),a[s]=c}function Oc(a,s){a=Dn(a,"_emval_take_value");var c=a.readValueFromPointer(s);return Ue.toHandle(c)}function Rc(a){return a=Ue.toValue(a),Ue.toHandle(typeof a)}function Dc(a,s){var c=new Date(B[a>>2]*1e3);B[s>>2]=c.getSeconds(),B[s+4>>2]=c.getMinutes(),B[s+8>>2]=c.getHours(),B[s+12>>2]=c.getDate(),B[s+16>>2]=c.getMonth(),B[s+20>>2]=c.getFullYear()-1900,B[s+24>>2]=c.getDay();var h=new Date(c.getFullYear(),0,1),d=(c.getTime()-h.getTime())/(1e3*60*60*24)|0;B[s+28>>2]=d,B[s+36>>2]=-(c.getTimezoneOffset()*60);var w=new Date(c.getFullYear(),6,1).getTimezoneOffset(),b=h.getTimezoneOffset(),_=(w!=b&&c.getTimezoneOffset()==Math.min(b,w))|0;B[s+32>>2]=_}function Mc(a,s,c,h,d,w){try{var b=g.getStream(d);b&&(c&2&&fe.doMsync(a,b,s,h,w),g.munmap(b))}catch(_){if(typeof g>"u"||!(_ instanceof g.ErrnoError))throw _;return-_.errno}}function Fc(a,s,c){var h=new Date().getFullYear(),d=new Date(h,0,1),w=new Date(h,6,1),b=d.getTimezoneOffset(),_=w.getTimezoneOffset(),E=Math.max(b,_);B[a>>2]=E*60,B[s>>2]=Number(b!=_);function k(X){var pe=X.toTimeString().match(/\(([A-Za-z ]+)\)$/);return pe?pe[1]:"GMT"}var U=k(d),I=k(w),D=Ke(U),N=Ke(I);_<b?(te[c>>2]=D,te[c+4>>2]=N):(te[c>>2]=N,te[c+4>>2]=D)}function zo(a,s,c){zo.called||(zo.called=!0,Fc(a,s,c))}function Lc(){Vt("")}function aa(){return 2147483648}function Bc(){return aa()}function Uc(a,s,c){We.copyWithin(a,s,s+c)}function Ic(a){try{return de.grow(a-ct.byteLength+65535>>>16),wn(de.buffer),1}catch{}}function Gc(a){var s=We.length;a=a>>>0;var c=aa();if(a>c)return!1;let h=(E,k)=>E+(k-E%k)%k;for(var d=1;d<=4;d*=2){var w=s*(1+.2/d);w=Math.min(w,a+100663296);var b=Math.min(c,h(Math.max(a,w),65536)),_=Ic(b);if(_)return!0}return!1}var Wo={};function Nc(){return u||"./this.program"}function Vr(){if(!Vr.strings){var a=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:a,_:Nc()};for(var c in Wo)Wo[c]===void 0?delete s[c]:s[c]=Wo[c];var h=[];for(var c in s)h.push(c+"="+s[c]);Vr.strings=h}return Vr.strings}function Hc(a,s){var c=0;return Vr().forEach(function(h,d){var w=s+c;te[a+d*4>>2]=w,mr(h,w),c+=h.length+1}),0}function Vc(a,s){var c=Vr();te[a>>2]=c.length;var h=0;return c.forEach(function(d){h+=d.length+1}),te[s>>2]=h,0}function zc(a){Tf(a)}function Wc(a){try{var s=fe.getStreamFromFD(a);return g.close(s),0}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return c.errno}}function $c(a,s,c,h){for(var d=0,w=0;w<c;w++){var b=te[s>>2],_=te[s+4>>2];s+=8;var E=g.read(a,Ve,b,_,h);if(E<0)return-1;if(d+=E,E<_)break}return d}function Xc(a,s,c,h){try{var d=fe.getStreamFromFD(a),w=$c(d,s,c);return B[h>>2]=w,0}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return b.errno}}function Yc(a,s){return s+2097152>>>0<4194305-!!a?(a>>>0)+s*4294967296:NaN}function Zc(a,s,c,h,d){try{var w=Yc(s,c);if(isNaN(w))return 61;var b=fe.getStreamFromFD(a);return g.llseek(b,w,h),kt=[b.position>>>0,($e=b.position,+Math.abs($e)>=1?$e>0?(Math.min(+Math.floor($e/4294967296),4294967295)|0)>>>0:~~+Math.ceil(($e-+(~~$e>>>0))/4294967296)>>>0:0)],B[d>>2]=kt[0],B[d+4>>2]=kt[1],b.getdents&&w===0&&h===0&&(b.getdents=null),0}catch(_){if(typeof g>"u"||!(_ instanceof g.ErrnoError))throw _;return _.errno}}function jc(a,s,c,h){for(var d=0,w=0;w<c;w++){var b=te[s>>2],_=te[s+4>>2];s+=8;var E=g.write(a,Ve,b,_,h);if(E<0)return-1;d+=E}return d}function qc(a,s,c,h){try{var d=fe.getStreamFromFD(a),w=jc(d,s,c);return te[h>>2]=w,0}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return b.errno}}function sa(a){for(var s=a.split("."),c=0;c<4;c++){var h=Number(s[c]);if(isNaN(h))return null;s[c]=h}return(s[0]|s[1]<<8|s[2]<<16|s[3]<<24)>>>0}function zr(a){return parseInt(a)}function Kc(a){var s,c,h,d,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,b=[];if(!w.test(a))return null;if(a==="::")return[0,0,0,0,0,0,0,0];for(a.startsWith("::")?a=a.replace("::","Z:"):a=a.replace("::",":Z:"),a.indexOf(".")>0?(a=a.replace(new RegExp("[.]","g"),":"),s=a.split(":"),s[s.length-4]=zr(s[s.length-4])+zr(s[s.length-3])*256,s[s.length-3]=zr(s[s.length-2])+zr(s[s.length-1])*256,s=s.slice(0,s.length-2)):s=a.split(":"),h=0,d=0,c=0;c<s.length;c++)if(typeof s[c]=="string")if(s[c]==="Z"){for(d=0;d<8-s.length+1;d++)b[c+d]=0;h=d-1}else b[c+h]=da(parseInt(s[c],16));else b[c+h]=s[c];return[b[1]<<16|b[0],b[3]<<16|b[2],b[5]<<16|b[4],b[7]<<16|b[6]]}var Wt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(a){var s=sa(a);if(s!==null||(s=Kc(a),s!==null))return a;var c;if(Wt.address_map.addrs[a])c=Wt.address_map.addrs[a];else{var h=Wt.address_map.id++;xe(h<65535,"exceeded max address mappings of 65535"),c="172.29."+(h&255)+"."+(h&65280),Wt.address_map.names[c]=a,Wt.address_map.addrs[a]=c}return c},lookup_addr:function(a){return Wt.address_map.names[a]?Wt.address_map.names[a]:null}};function Qc(a){var s=Dt(20),c=Dt(a.length+1);Ce(a,c,a.length+1),te[s>>2]=c;var h=Dt(4);te[h>>2]=0,te[s+4>>2]=h;var d=2;B[s+8>>2]=d,B[s+12>>2]=4;var w=Dt(12);return te[w>>2]=w+8,te[w+4>>2]=0,B[w+8>>2]=sa(Wt.lookup_name(a)),te[s+16>>2]=w,s}function Jc(a){return Qc(se(a))}function ef(a){var s=a.getExtension("ANGLE_instanced_arrays");if(s)return a.vertexAttribDivisor=function(c,h){s.vertexAttribDivisorANGLE(c,h)},a.drawArraysInstanced=function(c,h,d,w){s.drawArraysInstancedANGLE(c,h,d,w)},a.drawElementsInstanced=function(c,h,d,w,b){s.drawElementsInstancedANGLE(c,h,d,w,b)},1}function tf(a){var s=a.getExtension("OES_vertex_array_object");if(s)return a.createVertexArray=function(){return s.createVertexArrayOES()},a.deleteVertexArray=function(c){s.deleteVertexArrayOES(c)},a.bindVertexArray=function(c){s.bindVertexArrayOES(c)},a.isVertexArray=function(c){return s.isVertexArrayOES(c)},1}function rf(a){var s=a.getExtension("WEBGL_draw_buffers");if(s)return a.drawBuffers=function(c,h){s.drawBuffersWEBGL(c,h)},1}function nf(a){return!!(a.multiDrawWebgl=a.getExtension("WEBGL_multi_draw"))}var Te={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(s){Te.lastError||(Te.lastError=s)},getNewId:function(a){for(var s=Te.counter++,c=a.length;c<s;c++)a[c]=null;return s},getSource:function(a,s,c,h){for(var d="",w=0;w<s;++w){var b=h?B[h+w*4>>2]:-1;d+=se(B[c+w*4>>2],b<0?void 0:b)}return d},createContext:function(a,s){if(!a.getContextSafariWebGL2Fixed){let w=function(b,_){var E=a.getContextSafariWebGL2Fixed(b,_);return b=="webgl"==E instanceof WebGLRenderingContext?E:null};var d=w;a.getContextSafariWebGL2Fixed=a.getContext,a.getContext=w}var c=a.getContext("webgl",s);if(!c)return 0;var h=Te.registerContext(c,s);return h},registerContext:function(a,s){var c=Te.getNewId(Te.contexts),h={handle:c,attributes:s,version:s.majorVersion,GLctx:a};return a.canvas&&(a.canvas.GLctxObject=h),Te.contexts[c]=h,(typeof s.enableExtensionsByDefault>"u"||s.enableExtensionsByDefault)&&Te.initExtensions(h),c},makeContextCurrent:function(a){return Te.currentContext=Te.contexts[a],r.ctx=Qe=Te.currentContext&&Te.currentContext.GLctx,!(a&&!Qe)},getContext:function(a){return Te.contexts[a]},deleteContext:function(a){Te.currentContext===Te.contexts[a]&&(Te.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(Te.contexts[a].GLctx.canvas),Te.contexts[a]&&Te.contexts[a].GLctx.canvas&&(Te.contexts[a].GLctx.canvas.GLctxObject=void 0),Te.contexts[a]=null},initExtensions:function(a){if(a||(a=Te.currentContext),!a.initExtensionsDone){a.initExtensionsDone=!0;var s=a.GLctx;ef(s),tf(s),rf(s),s.disjointTimerQueryExt=s.getExtension("EXT_disjoint_timer_query"),nf(s);var c=s.getSupportedExtensions()||[];c.forEach(function(h){!h.includes("lose_context")&&!h.includes("debug")&&s.getExtension(h)})}}};function ua(a){return a.slice(-1)=="]"&&a.lastIndexOf("[")}function of(a){var s=a.uniformLocsById,c=a.uniformSizeAndIdsByName,h,d;if(!s)for(a.uniformLocsById=s={},a.uniformArrayNamesById={},h=0;h<Qe.getProgramParameter(a,35718);++h){var w=Qe.getActiveUniform(a,h),b=w.name,_=w.size,E=ua(b),k=E>0?b.slice(0,E):b,U=a.uniformIdCounter;for(a.uniformIdCounter+=_,c[k]=[_,U],d=0;d<_;++d)s[U]=d,a.uniformArrayNamesById[U++]=k}}function af(a,s){if(s=se(s),a=Te.programs[a]){of(a);var c=a.uniformLocsById,h=0,d=s,w=ua(s);w>0&&(h=zr(s.slice(w+1))>>>0,d=s.slice(0,w));var b=a.uniformSizeAndIdsByName[d];if(b&&h<b[0]&&(h+=b[1],c[h]=c[h]||Qe.getUniformLocation(a,s)))return h}else Te.recordError(1281);return-1}function $t(a){var s=Qe.currentProgram;if(s){var c=s.uniformLocsById[a];return typeof c=="number"&&(s.uniformLocsById[a]=c=Qe.getUniformLocation(s,s.uniformArrayNamesById[a]+(c>0?"["+c+"]":""))),c}else Te.recordError(1282)}function sf(a,s){Qe.uniform1f($t(a),s)}function uf(a,s){Qe.uniform1i($t(a),s)}var Mn=[];function lf(a,s,c){if(s<=144)for(var h=Mn[2*s-1],d=0;d<2*s;d+=2)h[d]=nt[c+4*d>>2],h[d+1]=nt[c+(4*d+4)>>2];else var h=nt.subarray(c>>2,c+s*8>>2);Qe.uniform2fv($t(a),h)}var Fn=[];function cf(a,s,c){if(s<=144)for(var h=Fn[2*s-1],d=0;d<2*s;d+=2)h[d]=B[c+4*d>>2],h[d+1]=B[c+(4*d+4)>>2];else var h=B.subarray(c>>2,c+s*8>>2);Qe.uniform2iv($t(a),h)}function ff(a,s,c){if(s<=96)for(var h=Mn[3*s-1],d=0;d<3*s;d+=3)h[d]=nt[c+4*d>>2],h[d+1]=nt[c+(4*d+4)>>2],h[d+2]=nt[c+(4*d+8)>>2];else var h=nt.subarray(c>>2,c+s*12>>2);Qe.uniform3fv($t(a),h)}function hf(a,s,c){if(s<=96)for(var h=Fn[3*s-1],d=0;d<3*s;d+=3)h[d]=B[c+4*d>>2],h[d+1]=B[c+(4*d+4)>>2],h[d+2]=B[c+(4*d+8)>>2];else var h=B.subarray(c>>2,c+s*12>>2);Qe.uniform3iv($t(a),h)}function pf(a,s,c){if(s<=72){var h=Mn[4*s-1],d=nt;c>>=2;for(var w=0;w<4*s;w+=4){var b=c+w;h[w]=d[b],h[w+1]=d[b+1],h[w+2]=d[b+2],h[w+3]=d[b+3]}}else var h=nt.subarray(c>>2,c+s*16>>2);Qe.uniform4fv($t(a),h)}function df(a,s,c){if(s<=72)for(var h=Fn[4*s-1],d=0;d<4*s;d+=4)h[d]=B[c+4*d>>2],h[d+1]=B[c+(4*d+4)>>2],h[d+2]=B[c+(4*d+8)>>2],h[d+3]=B[c+(4*d+12)>>2];else var h=B.subarray(c>>2,c+s*16>>2);Qe.uniform4iv($t(a),h)}function vf(a){}function Ln(a){return a%4===0&&(a%100!==0||a%400===0)}function gf(a,s){for(var c=0,h=0;h<=s;c+=a[h++]);return c}var la=[31,29,31,30,31,30,31,31,30,31,30,31],ca=[31,28,31,30,31,30,31,31,30,31,30,31];function mf(a,s){for(var c=new Date(a.getTime());s>0;){var h=Ln(c.getFullYear()),d=c.getMonth(),w=(h?la:ca)[d];if(s>w-c.getDate())s-=w-c.getDate()+1,c.setDate(1),d<11?c.setMonth(d+1):(c.setMonth(0),c.setFullYear(c.getFullYear()+1));else return c.setDate(c.getDate()+s),c}return c}function yf(a,s,c,h){var d=B[h+40>>2],w={tm_sec:B[h>>2],tm_min:B[h+4>>2],tm_hour:B[h+8>>2],tm_mday:B[h+12>>2],tm_mon:B[h+16>>2],tm_year:B[h+20>>2],tm_wday:B[h+24>>2],tm_yday:B[h+28>>2],tm_isdst:B[h+32>>2],tm_gmtoff:B[h+36>>2],tm_zone:d?se(d):""},b=se(c),_={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var E in _)b=b.replace(new RegExp(E,"g"),_[E]);var k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],U=["January","February","March","April","May","June","July","August","September","October","November","December"];function I(R,$,Ie){for(var we=typeof R=="number"?R.toString():R||"";we.length<$;)we=Ie[0]+we;return we}function D(R,$){return I(R,$,"0")}function N(R,$){function Ie(rt){return rt<0?-1:rt>0?1:0}var we;return(we=Ie(R.getFullYear()-$.getFullYear()))===0&&(we=Ie(R.getMonth()-$.getMonth()))===0&&(we=Ie(R.getDate()-$.getDate())),we}function X(R){switch(R.getDay()){case 0:return new Date(R.getFullYear()-1,11,29);case 1:return R;case 2:return new Date(R.getFullYear(),0,3);case 3:return new Date(R.getFullYear(),0,2);case 4:return new Date(R.getFullYear(),0,1);case 5:return new Date(R.getFullYear()-1,11,31);case 6:return new Date(R.getFullYear()-1,11,30)}}function pe(R){var $=mf(new Date(R.tm_year+1900,0,1),R.tm_yday),Ie=new Date($.getFullYear(),0,4),we=new Date($.getFullYear()+1,0,4),rt=X(Ie),Fe=X(we);return N(rt,$)<=0?N(Fe,$)<=0?$.getFullYear()+1:$.getFullYear():$.getFullYear()-1}var De={"%a":function(R){return k[R.tm_wday].substring(0,3)},"%A":function(R){return k[R.tm_wday]},"%b":function(R){return U[R.tm_mon].substring(0,3)},"%B":function(R){return U[R.tm_mon]},"%C":function(R){var $=R.tm_year+1900;return D($/100|0,2)},"%d":function(R){return D(R.tm_mday,2)},"%e":function(R){return I(R.tm_mday,2," ")},"%g":function(R){return pe(R).toString().substring(2)},"%G":function(R){return pe(R)},"%H":function(R){return D(R.tm_hour,2)},"%I":function(R){var $=R.tm_hour;return $==0?$=12:$>12&&($-=12),D($,2)},"%j":function(R){return D(R.tm_mday+gf(Ln(R.tm_year+1900)?la:ca,R.tm_mon-1),3)},"%m":function(R){return D(R.tm_mon+1,2)},"%M":function(R){return D(R.tm_min,2)},"%n":function(){return`
`},"%p":function(R){return R.tm_hour>=0&&R.tm_hour<12?"AM":"PM"},"%S":function(R){return D(R.tm_sec,2)},"%t":function(){return"	"},"%u":function(R){return R.tm_wday||7},"%U":function(R){var $=R.tm_yday+7-R.tm_wday;return D(Math.floor($/7),2)},"%V":function(R){var $=Math.floor((R.tm_yday+7-(R.tm_wday+6)%7)/7);if((R.tm_wday+371-R.tm_yday-2)%7<=2&&$++,$){if($==53){var we=(R.tm_wday+371-R.tm_yday)%7;we!=4&&(we!=3||!Ln(R.tm_year))&&($=1)}}else{$=52;var Ie=(R.tm_wday+7-R.tm_yday-1)%7;(Ie==4||Ie==5&&Ln(R.tm_year%400-1))&&$++}return D($,2)},"%w":function(R){return R.tm_wday},"%W":function(R){var $=R.tm_yday+7-(R.tm_wday+6)%7;return D(Math.floor($/7),2)},"%y":function(R){return(R.tm_year+1900).toString().substring(2)},"%Y":function(R){return R.tm_year+1900},"%z":function(R){var $=R.tm_gmtoff,Ie=$>=0;return $=Math.abs($)/60,$=$/60*100+$%60,(Ie?"+":"-")+String("0000"+$).slice(-4)},"%Z":function(R){return R.tm_zone},"%%":function(){return"%"}};b=b.replace(/%%/g,"\0\0");for(var E in De)b.includes(E)&&(b=b.replace(new RegExp(E,"g"),De[E](w)));b=b.replace(/\0\0/g,"%");var Me=In(b,!1);return Me.length>s?0:(lt(Me,a),Me.length-1)}function wf(a,s,c,h){return yf(a,s,c,h)}var fa=function(a,s,c,h){a||(a=this),this.parent=a,this.mount=a.mount,this.mounted=null,this.id=g.nextInode++,this.name=s,this.mode=c,this.node_ops={},this.stream_ops={},this.rdev=h},Bn=365,Un=146;Object.defineProperties(fa.prototype,{read:{get:function(){return(this.mode&Bn)===Bn},set:function(a){a?this.mode|=Bn:this.mode&=~Bn}},write:{get:function(){return(this.mode&Un)===Un},set:function(a){a?this.mode|=Un:this.mode&=~Un}},isFolder:{get:function(){return g.isDir(this.mode)}},isDevice:{get:function(){return g.isChrdev(this.mode)}}}),g.FSNode=fa,g.staticInit(),yl(),_r=r.BindingError=Oo(Error,"BindingError"),Zi=r.InternalError=Oo(Error,"InternalError"),Bl(),kl(),Wl(),ea=r.UnboundTypeError=Oo(Error,"UnboundTypeError"),tc();for(var Qe,bf=new Float32Array(288),Rt=0;Rt<288;++Rt)Mn[Rt]=bf.subarray(0,Rt+1);for(var _f=new Int32Array(288),Rt=0;Rt<288;++Rt)Fn[Rt]=_f.subarray(0,Rt+1);function In(a,s,c){var h=c>0?c:ue(a)+1,d=new Array(h),w=ye(a,d,0,d.length);return s&&(d.length=w),d}var Sf={ga:Qu,k:Ju,b:el,c:rl,Q:sl,R:ul,q:cl,K:fl,U:hl,I:pl,H:dl,u:vl,J:gl,z:ml,W:_l,d:jl,f:ql,e:Kl,a:Ql,V:rc,g:oc,h:ic,v:sc,j:lc,i:cc,w:fc,r:hc,X:pc,N:dc,M:gc,m:mc,ka:bc,x:Go,la:_c,ja:Ec,s:xc,E:Cc,ia:Pc,ma:kc,n:Ac,l:Oc,na:Rc,O:Dc,D:Mc,P:zo,t:Lc,C:Bc,L:Uc,o:Gc,F:Hc,G:Vc,fa:zc,p:Wc,T:Xc,y:Zc,S:qc,ha:Jc,ea:af,ca:sf,da:uf,_:lf,ba:cf,Z:ff,aa:hf,Y:pf,$:df,A:vf,B:wf};Ku(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Dt=r._malloc=function(){return(Dt=r._malloc=r.asm.qa).apply(null,arguments)},Mt=r._free=function(){return(Mt=r._free=r.asm.ra).apply(null,arguments)},ha=r.___errno_location=function(){return(ha=r.___errno_location=r.asm.sa).apply(null,arguments)},pa=r.___getTypeName=function(){return(pa=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var da=r._htons=function(){return(da=r._htons=r.asm.wa).apply(null,arguments)},va=r._emscripten_builtin_memalign=function(){return(va=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},ga=r.___cxa_is_pointer_type=function(){return(ga=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=g;var Gn;function $o(a){this.name="ExitStatus",this.message="Program terminated with exit("+a+")",this.status=a}Ur=function a(){Gn||Xo(),Gn||(Ur=a)};function Xo(a){if(nr>0||(zu(),nr>0))return;function s(){Gn||(Gn=!0,r.calledRun=!0,!Se&&(Wu(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),$u()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),s()},1)):s()}r.run=Xo;function Tf(a,s){Ef(a)}function Ef(a){wr()||(r.onExit&&r.onExit(a),Se=!0),l(a,new $o(a))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Xo(),r.ready}})(),Pf="/cad-os/assets/replicad_single-b4564eab.wasm";const ui={library:null},kf=t=>{ui.library=t},G=()=>{if(!ui.library)throw new Error("oppencascade has not been loaded");return ui.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const $r=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class st{constructor(e){this.oc=G(),e&&$r.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&($r.unregister(this._wrapped),this._wrapped.delete()),$r.register(this,e,e),this._wrapped=e}delete(){var e;$r.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const Ee=()=>{function t(e){return $r.register(t,e),e}return t},Ne=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},Es=2147483647,dt=Math.PI/180,Zr=180/Math.PI,Yo=t=>Math.round(t*1e3)/1e3,Jr=(t,e,r)=>{const n=G(),o=at(t),i=Ar(e);let u;if(r){const l=Ar(r);u=new n.gp_Ax3_3(o,i,l),l.delete()}else u=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),u},_o=(t,e,r)=>{const n=G(),o=at(t),i=Ar(e);let u;if(r){const l=Ar(r);u=new n.gp_Ax2_2(o,i,l),l.delete()}else u=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),u},jr=(t,e)=>{const r=G(),n=at(t),o=Ar(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},Af=(t=[0,0,0])=>{const e=G();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof M)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class M extends st{constructor(e=[0,0,0]){super(Af(e))}get repr(){return`x: ${Yo(this.x)}, y: ${Yo(this.y)}, z: ${Yo(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new M(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new M(this.wrapped.Subtracted(e.wrapped))}add(e){return new M(this.wrapped.Added(e.wrapped))}multiply(e){return new M(this.wrapped.Multiplied(e))}normalized(){return new M(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*Zr}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),u=this.sub(i);return o.delete(),i.delete(),u}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=jr(r,n);return this.wrapped.Rotate(o,e*dt),o.delete(),this}}const Of={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function Rf(t){return t==="X"||t==="Y"||t==="Z"?Of[t]:t}function at(t){const e=new M(t),r=e.toPnt();return e.delete(),r}function Ar(t){const e=new M(t),r=e.toDir();return e.delete(),r}class pr extends st{constructor(e){const r=G();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new M(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Ar(n),i=at(r),u=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(u,e*dt),u.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=Ee();let o,i;if(typeof e=="string"){const l=n(xs(e,r));o=l.origin,i=l.zDir}else e instanceof Je?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const u=n(_o(o,i));return this.wrapped.SetMirror_3(u),this}scale(e,r){const n=at(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=Ee(),o=n(e==="reference"?new this.oc.gp_Ax3_1:Jr(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:Jr(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=at(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Je{constructor(e,r=null,n=[0,0,1]){this.oc=G();const o=new M(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new M(r);else{const u=Jr(e,o);i=new M(u.XDirection()),u.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new M(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Je(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new M(e),r}translate(e,r=0,n=0){const o=new M(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=Rf(r),o=new M(this.zDir).rotate(e,[0,0,0],n),i=new M(this.xDir).rotate(e,[0,0,0],n);return new Je(this.origin,i,o)}rotate2DAxes(e){const r=new M(this.xDir).rotate(e,[0,0,0],this.zDir);return new Je(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=Jr(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new pr,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new pr,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new M(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new M(r);return r.delete(),n}}const Df={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},xs=(t,e=[0,0,0])=>{const r=Df[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new Je(n,r.xDir,r.normal)};let Mf=class extends st{constructor(e){const r=G();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new M(e).repr} - ${new M(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},u={current:0};return this.wrapped.Get(e,r,n,o,i,u),[[e.current,r.current,n.current],[o.current,i.current,u.current]]}get center(){const[[e,r,n],[o,i,u]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(u-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function Jt(t="XY",e=[0,0,0]){return t instanceof Je?t.clone():xs(t,e)}function Ff(t,e,r=[0,0,0],n=[0,0,1]){const o=new pr;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function Lf(t,e){const r=new pr;r.translate(e);const n=r.transform(t);return r.delete(),n}function Bf(t,e,r){const n=new pr;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function Uf(t,e,r){const n=new pr;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function to(t){return Array.isArray(t)&&t.length===2}let Nn=null;const ma=t=>{if(Nn&&!t)return Nn;const r=G().GeomAbs_CurveType;return Nn=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),Nn},sn=t=>{let e=ma().get(t);if(e||(e=ma(!0).get(t)),!e)throw new Error("unknown type");return e};function If(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function Gf(t){return Array.from(Array(t).keys())}function Cr(t){const e=Math.min(...t.map(r=>r.length));return Gf(e).map(r=>t.map(n=>n[r]))}function ro(t){return Math.round(t*100)/100}const qr=([t,e])=>`(${ro(t)},${ro(e)})`,ya=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Cs=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${ya(r,e)},${ya(n,e)}]`,[r,n]])).values()),Ye=([t,e])=>{const r=G();return new r.gp_Pnt2d_3(t,e)},Nf=([t,e])=>{const r=G();return new r.gp_Dir2d_4(t,e)},Ps=([t,e])=>{const r=G();return new r.gp_Vec2d_4(t,e)},Or=(t,e)=>{const r=G(),[n,o]=Ne(),i=new r.gp_Ax2d_2(n(Ye(t)),n(Nf(e)));return o(),i};class un extends st{constructor(e){const r=G();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${qr(e)} - ${qr(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=Ee()(Ye(e));return!this.wrapped.IsOut_1(n)}}const qe=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,Rr=([t,e],[r,n])=>[t+r,e+n],xi=([t,e],[r,n])=>[t-r,e-n],li=([t,e],r)=>[t*r,e*r],Tt=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),Hf=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function Vf([t,e],[r,n]){return t*n-e*r}const zf=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),Wf=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),jt=([t,e])=>{const r=Tt([t,e]);return[t/r,e/r]},$f=(t,e,r=[0,0])=>{const[n,o]=t,[i,u]=r,l=n-i,f=o-u,p=Math.sin(e),v=Math.cos(e),y=l*v-f*p,m=l*p+f*v;return[y+i,m+u]},Er=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},Xf=([t,e])=>{const r=Tt([t,e]),n=Math.atan2(e,t);return[r,n]};class Le extends st{constructor(e){const r=G(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=G(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new un(r),this._boundingBox}get repr(){return`${this.geomType} ${qr(this.firstPoint)} - ${qr(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=G();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=sn(e.GetType());return e.delete(),r}clone(){return new Le(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=G(),n=Ee(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(Ye(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,Tt(e,this.firstPoint),Tt(e,this.lastPoint))}distanceFromCurve(e){const r=G(),n=Ee();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return to(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=G(),o=Ee();let i,u;try{const l=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(Ye(e)),this.wrapped));i=l.LowerDistance(),u=l.LowerDistanceParameter()}catch{if(qe(e,this.firstPoint,r))return this.firstParameter;if(qe(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${qr(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return u}tangentAt(e){const r=G(),[n,o]=Ne();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const u=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,u,l);const f=[l.X(),l.Y()];return o(),f}splitAt(e,r=1e-9){const n=G(),o=Ee();let i=e.map(f=>to(f)?this.parameter(f,r):f);i=Array.from(new Map(i.map(f=>[If(f,-Math.log10(r)),f])).values()).sort((f,p)=>f-p);const u=this.firstParameter,l=this.lastParameter;return u>l&&i.reverse(),Math.abs(i[0]-u)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-l)<r*100&&(i=i.slice(0,-1)),i.length?Cr([[u,...i],[...i,l]]).map(([f,p])=>{try{if(this.geomType==="BEZIER_CURVE"){const y=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return y.Segment(f,p),new Le(new n.Handle_Geom2d_Curve_2(y))}if(this.geomType==="BSPLINE_CURVE"){const y=o(this.adaptor()).BSpline().get(),m=new n.Geom2d_BSplineCurve_1(y.Poles_2(),y.Knots_2(),y.Multiplicities_2(),y.Degree(),y.IsPeriodic());return m.Segment(f,p,r),new Le(new n.Handle_Geom2d_Curve_2(m))}const v=new n.Geom2d_TrimmedCurve(this.wrapped,f,p,!0,!0);return new Le(new n.Handle_Geom2d_Curve_2(v))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const ks=(t,e=1e-4,r="C0",n=200)=>{const o=G(),i=Ee(),u={C0:o.GeomAbs_Shape.GeomAbs_C0,C1:o.GeomAbs_Shape.GeomAbs_C1,C2:o.GeomAbs_Shape.GeomAbs_C2,C3:o.GeomAbs_Shape.GeomAbs_C3},l=i(new o.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,u[r],n,3));return new Le(l.Curve())},wa=t=>{if(sn(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=G(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const u=n.NbArcs();if(u)for(let l=1;l<=u;l++){const f=n.Arc(l);yield new Le(f)}}const i=Array.from(o());return n.delete(),i};function no(t,e={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=Ee();return t.flatMap(n=>{const o=r(n.adaptor()),i=sn(o.GetType());if(i==="ELLIPSE"||i==="CIRCLE"&&qe(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(i))return n;if(i==="BEZIER_CURVE"){const f=o.Bezier().get().Degree();if([1,2,3].includes(f))return n}if(i==="BSPLINE_CURVE"){const l=wa(o);return no(l,e)}const u=ks(o,e.tolerance,e.continuity,e.maxSegments);return no(wa(r(u.adaptor())),e)})}function*As(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*Yf(t){const e=t.NbSegments();if(!e)return;const r=G();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new Le(o),i.delete()}}const ln=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=G(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,u;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from(As(o)),u=Array.from(Yf(o))}catch(p){throw console.error(t,e,p),new Error("Intersections failed between curves")}finally{o.delete()}const l=u.filter(p=>qe(p.firstPoint,p.lastPoint,r)).map(p=>p.firstPoint);l.length&&(i.push(...l),u=u.filter(p=>!qe(p.firstPoint,p.lastPoint,r)));const f=u.flatMap(p=>[p.firstPoint,p.lastPoint]);return{intersections:i,commonSegments:u,commonSegmentsPoints:f}},Zf=(t,e=1e-9)=>{const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from(As(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},cn=(t,e)=>{const r=G(),[n,o]=Ne(),i=n(new r.GCE2d_MakeSegment_1(n(Ye(t)),n(Ye(e)))).Value(),u=new Le(i);return qe(u.firstPoint,t)||u.reverse(),o(),u},ci=(t,e,r)=>{const n=G(),[o,i]=Ne(),u=o(new n.GCE2d_MakeArcOfCircle_4(o(Ye(t)),o(Ye(e)),o(Ye(r)))).Value();i();const l=new Le(u);return qe(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},jf=(t,e,r)=>{const n=G(),[o,i]=Ne(),u=o(new n.GCE2d_MakeArcOfCircle_5(o(Ye(t)),o(Ps(e)),o(Ye(r)))).Value();i();const l=new Le(u);return qe(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},qf=(t,e,r,n,o=[0,0],i,u=!0)=>{const l=G(),[f,p]=Ne(),v=f(new l.gp_Elips2d_2(f(Or(o,i)),t,e,!0)),y=f(new l.GCE2d_MakeArcOfEllipse_1(v,r,n,u)).Value();return p(),new Le(y)},Kf=(t,e,r)=>{const n=G(),[o,i]=Ne(),u=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));u.SetValue(1,o(Ye(t))),e.forEach((f,p)=>{u.SetValue(p+2,o(Ye(f)))}),u.SetValue(e.length+2,o(Ye(r)));const l=new n.Geom2d_BezierCurve_1(u);return i(),new Le(new n.Handle_Geom2d_Curve_2(l))},Os=(t,e,r)=>{const n=li(Rr(t,e),.5),o=Tt(r,t),i=jt(xi(n,r));return ci(t,Rr(li(i,o),r),e)},Qf=(t,e,r)=>{const n=jt(xi(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:Rr(t,i),lastPoint:Rr(e,i)}},fi=(t,e)=>{const r=Ee(),n=t.geomType;if(n==="CIRCLE"){const f=r(r(t.adaptor()).Circle()),p=f.Radius(),v=f.IsDirect()?1:-1,y=e*v,m=p+y;if(m<1e-10){const A=r(f.Location()),L=[A.X(),A.Y()],F=Y=>{const[V,ae]=jt(xi(Y,L));return Rr(Y,[y*V,y*ae])};return{collapsed:!0,firstPoint:F(t.firstPoint),lastPoint:F(t.lastPoint)}}const S=G(),T=new S.gp_Circ2d_3(f.Axis(),m),x=new S.Geom2d_Circle_1(T),C=new S.Geom2d_TrimmedCurve(new S.Handle_Geom2d_Curve_2(x),t.firstParameter,t.lastParameter,!0,!0);return new Le(new S.Handle_Geom2d_Curve_2(C))}if(n==="LINE"){const{firstPoint:f,lastPoint:p}=Qf(t.firstPoint,t.lastPoint,e);return cn(f,p)}const o=G(),i=new Le(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),u=ks(i.adaptor());return Zf(u).length?{collapsed:!0,firstPoint:u.firstPoint,lastPoint:u.lastPoint}:u};function Rs(t,e,r){const n=Vf(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,u=fi(t,i),l=fi(e,i);if(!(u instanceof Le)||!(l instanceof Le))return null;let f;try{const{intersections:S}=ln(u,l,1e-9);f=S.at(-1)}catch{return null}if(!to(f))return null;const p=f,v=(S,T)=>{const[x,C]=T.tangentAt(p),A=jt([-C,x]),L=Rr(p,li(A,i)),F=S.parameter(L,1e-6);return S.splitAt([F])},[y]=v(t,u),[,m]=v(e,l);return{first:y,second:m,center:p}}function hi(t,e,r){const n=Rs(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:u}=n;return[o,Os(o.lastPoint,i.firstPoint,u),i]}function pi(t,e,r){const n=Rs(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,cn(o.lastPoint,i.firstPoint),i]}class Jf{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let u=(i<<1)+1;const l=u+1;let f=this.ids[u],p=this.values[u];const v=this.values[l];if(l<this.length&&v<p&&(u=l,f=this.ids[l],p=v),p>=n)break;this.ids[i]=f,this.values[i]=p,i=u}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const ba=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Zo=3;class Ci{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==Zo)throw new Error(`Got v${n>>4} data when expected v${Zo}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Ci(i,o,ba[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,u=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),u+=i,this._levelBounds.push(u*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const l=ba.indexOf(this.ArrayType),f=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+f+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Zo<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new Jf}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let u=4*i;const l=this._boxes[u++],f=this._boxes[u++],p=this._boxes[u++],v=this._boxes[u++],y=Math.floor(o*((l+p)/2-this.minX)/e),m=Math.floor(o*((f+v)/2-this.minY)/r);n[i]=th(y,m)}di(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,u=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;u<l;){const f=u;let p=1/0,v=1/0,y=-1/0,m=-1/0;for(let S=0;S<this.nodeSize&&u<l;S++)p=Math.min(p,this._boxes[u++]),v=Math.min(v,this._boxes[u++]),y=Math.max(y,this._boxes[u++]),m=Math.max(m,this._boxes[u++]);this._indices[this._pos>>2]=f,this._boxes[this._pos++]=p,this._boxes[this._pos++]=v,this._boxes[this._pos++]=y,this._boxes[this._pos++]=m}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const l=[],f=[];for(;u!==void 0;){const p=Math.min(u+this.nodeSize*4,Sa(u,this._levelBounds));for(let v=u;v<p;v+=4){if(n<this._boxes[v]||o<this._boxes[v+1]||e>this._boxes[v+2]||r>this._boxes[v+3])continue;const y=this._indices[v>>2]|0;u<this.numItems*4?(i===void 0||i(y))&&f.push(y):l.push(y)}u=l.pop()}return f}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const l=this._queue,f=[],p=o*o;for(;u!==void 0;){const v=Math.min(u+this.nodeSize*4,Sa(u,this._levelBounds));for(let y=u;y<v;y+=4){const m=this._indices[y>>2]|0,S=_a(e,this._boxes[y],this._boxes[y+2]),T=_a(r,this._boxes[y+1],this._boxes[y+3]),x=S*S+T*T;u<this.numItems*4?(i===void 0||i(m))&&l.push((m<<1)+1,x):l.push(m<<1,x)}for(;l.length&&l.peek()&1;)if(l.peekValue()>p||(f.push(l.pop()>>1),f.length===n))return l.clear(),f;u=l.pop()>>1}return l.clear(),f}}function _a(t,e,r){return t<e?e-t:t<=r?0:t-r}function Sa(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function di(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const u=t[n+o>>1];let l=n-1,f=o+1;for(;;){do l++;while(t[l]<u);do f--;while(t[f]>u);if(l>=f)break;eh(t,e,r,l,f)}di(t,e,r,n,f,i),di(t,e,r,f+1,o,i)}function eh(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const u=4*n,l=4*o,f=e[u],p=e[u+1],v=e[u+2],y=e[u+3];e[u]=e[l],e[u+1]=e[l+1],e[u+2]=e[l+2],e[u+3]=e[l+3],e[l]=f,e[l+1]=p,e[l+2]=v,e[l+3]=y;const m=r[n];r[n]=r[o],r[o]=m}function th(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),u=r|n>>1,l=r>>1^r,f=o>>1^n&i>>1^o,p=r&o>>1^i>>1^i;r=u,n=l,o=f,i=p,u=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,f^=r&o>>2^n&i>>2,p^=n&o>>2^(r^n)&i>>2,r=u,n=l,o=f,i=p,u=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,f^=r&o>>4^n&i>>4,p^=n&o>>4^(r^n)&i>>4,r=u,n=l,o=f,i=p,f^=r&o>>8^n&i>>8,p^=n&o>>8^(r^n)&i>>8,r=f^f>>1,n=p^p>>1;let v=t^e,y=n|65535^(v|r);return v=(v|v<<8)&16711935,v=(v|v<<4)&252645135,v=(v|v<<2)&858993459,v=(v|v<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|v)>>>0}const rh=(t,e=1e-7)=>{const r=new Ci(t.length);t.forEach(i=>{const[u,l]=i.firstPoint;r.add(u-e,l-e,u+e,l+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,u)=>{if(o.has(u))return;const l=[i];let f=u;o.add(u);let p=t.length;for(;;){if(p--<0)throw new Error("Infinite loop detected");const v=l[l.length-1].lastPoint,[y,m]=v,S=r.search(y-e,m-e,y+e,m+e),T=L=>Math.abs((f-L)%t.length),x=S.filter(L=>!o.has(L)).map(L=>[t[L],L,T(L)]).sort(([,,L],[,,F])=>T(L)-T(F));if(x.length===0){n.push(l);break}const[C,A]=x[0];l.push(C),o.add(A),f=A}}),n};function pt(t){return Math.round(t*1e5)/1e5}const jo=t=>`${ro(t.X())} ${ro(t.Y())}`,nh=(t,e)=>{const r=G(),n=sn(t.GetType()),[o,i]=e,u=`${pt(o)} ${pt(i)}`;if(n==="LINE")return`L ${u}`;if(n==="BEZIER_CURVE"){const l=t.Bezier().get(),f=l.Degree();if(f===1)return`L ${u}`;if(f===2)return`Q ${jo(l.Pole(2))} ${u}`;if(f===3){const p=jo(l.Pole(2)),v=jo(l.Pole(3));return`C ${p} ${v} ${u}`}}if(n==="CIRCLE"){const l=t.Circle(),f=l.Radius(),p=t.FirstParameter(),y=(t.LastParameter()-p)*Zr,m=y!==360?u:`${pt(o)} ${pt(i+1e-4)}`;return`A ${f} ${f} 0 ${Math.abs(y)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${m}`}if(n==="ELLIPSE"){const l=t.Ellipse(),f=l.MajorRadius(),p=l.MinorRadius(),v=t.FirstParameter(),m=(t.LastParameter()-v)*Zr,S=m!==360?u:`${pt(o)} ${pt(i+1e-4)}`,T=new r.gp_Dir2d_1,x=180-l.XAxis().Direction().Angle(T)*Zr;return T.delete(),`A ${pt(f)} ${pt(p)} ${pt(x)} ${Math.abs(m)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${S}`}throw new Error(`Unsupported curve type: ${n}`)},oh={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},oo={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Ds{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class ih extends st{constructor(){const e=G();super(new e.Message_ProgressRange_1)}}class qo extends st{constructor(e){const r=G();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(e.wrapped)}distanceTo(e){this.wrapped.LoadS2(e.wrapped);const r=new ih;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class Ms extends Ds{when(e){return this.filters.push(e),this}inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new M(oh[e]):n=new M(e);const o=({normal:i})=>{if(!i)return!1;const u=Math.acos(Math.abs(i.dot(n)));return Math.abs(u-dt*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=so(r),o=new qo(n),i=({element:u})=>Math.abs(o.distanceTo(u)-e)<1e-6;return this.filters.push(i),this}containsPoint(e){return this.atDistance(0,e)}withinDistance(e,r=[0,0,0]){const n=so(r),o=new qo(n),i=({element:u})=>o.distanceTo(u)-e<1e-6;return this.filters.push(i),this}inBox(e,r){const n=me(e,r);return this.inShape(n)}inShape(e){const r=new qo(e),n=({element:o})=>r.distanceTo(o)<1e-6;return this.filters.push(n),this}}class io extends Ms{clone(){const e=new io;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&oo[e])return this.atAngleWith(oo[e],90);if(typeof e!="string"&&e instanceof Je)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Je?Jt(e):Jt(e,r);this.parallelTo(n);const o=({element:i})=>{const u=i.startPoint,l=u.projectToPlane(n);return u.equals(l)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class Pi extends Ms{clone(){const e=new Pi;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&oo[e])return this.atAngleWith(oo[e]);if(typeof e!="string"&&e instanceof Je)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Je?Jt(e):Jt(e,r);this.parallelTo(n);const o=({element:i})=>{const u=i.center,l=u.projectToPlane(n);return u.equals(l)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const ah=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},Ko=2*Math.PI,Ta=t=>{const e=t%Ko,r=e<0?e+Ko:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-Ko)};class ao extends Ds{clone(){const e=new ao;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>qe(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(Tt(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return qe(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,u]=r,l=Math.min(n,i),f=Math.max(n,i),p=Math.min(o,u),v=Math.max(o,u);function y({element:m}){const[S,T]=m.point;return S>=l&&S<=f&&T>=p&&T<=v}return this.filters.push(y),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(Ta(zf(o,i))-Ta(dt*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return ah(e).filter(r=>this.shouldKeep(r))}}const Ea=t=>{const e=G();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},sh=function*(e,r){const n=G(),o=new n.TopExp_Explorer_2(e,Ea(r),Ea("shape")),i=new Map;for(;o.More();){const u=o.Current(),l=u.HashCode(Es);i.get(l)||(i.set(l,!0),yield u),o.Next()}o.delete()},Fs=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class So extends st{constructor(e){super(e)}clone(){return new this.constructor(dr(this.wrapped))}get hashCode(){return this.wrapped.HashCode(Es)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=G(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=Pe(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=Pe(Lf(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Pe(Ff(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=Pe(Bf(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=Pe(Uf(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return sh(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>dr(r))}get edges(){return this._listTopo("edge").map(e=>new tr(e))}get faces(){return this._listTopo("face").map(e=>new Fr(e))}get wires(){return this._listTopo("wire").map(e=>new Gt(e))}get boundingBox(){const e=new Mf;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const u=[];for(const l of this.faces){const f=l.triangulation(o.length/3);if(!f)continue;const{trianglesIndexes:p,vertices:v,verticesNormals:y}=f;u.push({start:n.length,count:p.length,faceId:l.hashCode}),n=n.concat(p),o=o.concat(v),i=i.concat(y)}return{triangles:n,vertices:o,normals:i,faceGroups:u}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=Ee(),i=new Set,u=[],l=[],f=()=>{const v=u.length;let y=null;return[m=>{y?(u.push(...y),y=[m.X(),m.Y(),m.Z()],u.push(...y)):y=[m.X(),m.Y(),m.Z()]},m=>{l.push({start:v/3,count:(u.length-v)/3,edgeId:m}),i.add(m)}]},p=o(new this.oc.TopLoc_Location_1);for(const v of this.faces){const y=o(this.oc.BRep_Tool.Triangulation(v.wrapped,p,0));if(y.IsNull())continue;const m=y.get();for(const S of v.edges){if(o(S),i.has(S.hashCode))continue;const T=o(new this.oc.TopLoc_Location_1),x=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(S.wrapped,y,T)),C=(n=x==null?void 0:x.get())==null?void 0:n.Nodes();if(!C)continue;o(C);const[A,L]=f();for(let F=C.Lower();F<=C.Upper();F++){const Y=o(o(m.Node(C.Value(F))).Transformed(T.Transformation()));A(Y)}L(S.hashCode)}}for(const v of this.edges){o(v);const y=v.hashCode;if(i.has(y))continue;const m=o(new this.oc.BRepAdaptor_Curve_2(v.wrapped)),S=o(new this.oc.GCPnts_TangentialDeflection_2(m,e,r,2,1e-9,1e-7)),[T,x]=f();for(let C=0;C<S.NbPoints();C++){const A=o(S.Value(C+1).Transformed(p.Transformation()));T(A)}x(y)}return{lines:u,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const u=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([u],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Ls extends So{}class Bs extends So{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new uh(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(e=0){return this.curve.tangentAt(e)}pointAt(e=0){return this.curve.pointAt(e)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class uh extends st{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return sn(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new M(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new M(e)}_mapParameter(e){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*e}pointAt(e=.5){return new M(this.wrapped.Value(this._mapParameter(e)))}tangentAt(e=.5){const r=this._mapParameter(e),n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new M(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class tr extends Bs{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Gt extends Bs{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=Pe(o.Shape());if(o.delete(),this.delete(),!(i instanceof Gt))throw new Error("Could not offset with a wire");return i}}class lh extends st{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Fr extends So{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new lh(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:u}=this.UVBounds,l=this._geomAdaptor(),f=new this.oc.gp_Pnt_1,p=e*(o-n)+n,v=r*(u-i)+i;l.D0(p,v,f);const y=new M(f);return l.delete(),f.delete(),y}normalAt(e){let r=0,n=0;const o=Ee();if(e){const p=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),v=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(at(e)),p,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),y={current:0},m={current:0};v.LowerDistanceParameters(y,m),r=y.current,n=m.current}else{const{uMin:p,uMax:v,vMin:y,vMax:m}=this.UVBounds;r=.5*(p+v),n=.5*(y+m)}const i=o(new this.oc.gp_Pnt_1),u=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,u),new M(u)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new M(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Gt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=Ee(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),u={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=o.get(),f=l.NbNodes();u.vertices=new Array(f*3);for(let T=1;T<=f;T++){const x=r(r(l.Node(T)).Transformed(i));u.vertices[(T-1)*3+0]=x.X(),u.vertices[(T-1)*3+1]=x.Y(),u.vertices[(T-1)*3+2]=x.Z()}const p=r(new this.oc.TColgp_Array1OfDir_2(1,f)),v=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,v,p),u.verticesNormals=new Array(p.Length()*3);for(let T=p.Lower();T<=p.Upper();T++){const x=r(r(p.Value(T)).Transformed(i));u.verticesNormals[(T-1)*3+0]=x.X(),u.verticesNormals[(T-1)*3+1]=x.Y(),u.verticesNormals[(T-1)*3+2]=x.Z()}const y=this.orientation,m=l.NbTriangles();u.trianglesIndexes=new Array(m*3);let S=0;for(let T=1;T<=m;T++){const x=r(l.Triangle(T));let C=x.Value(1),A=x.Value(2);const L=x.Value(3);if(y==="backward"){const F=C;C=A,A=F}u.trianglesIndexes[S*3+0]=C-1+e,u.trianglesIndexes[S*3+1]=A-1+e,u.trianglesIndexes[S*3+2]=L-1+e,S++}return u}}class To extends So{fuse(e,{optimisation:r="none"}={}){const n=Ee(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const u=Pe(i.Shape());if(!Ft(u))throw new Error("Could not fuse as a 3d shape");return u}cut(e,{optimisation:r="none"}={}){const n=Ee(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const u=Pe(i.Shape());if(!Ft(u))throw new Error("Could not cut as a 3d shape");return u}intersect(e){const r=Ee(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=Pe(o.Shape());if(!Ft(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,u;if(typeof e=="number"){u=e;const S=new Pi;i=typeof r=="function"?r(S):S}else u=e.thickness,i=e.filter;const l=Ee(),f=i.find(this),p=l(new this.oc.TopTools_ListOfShape_1);f.forEach(S=>{p.Append_1(S.wrapped)});const v=l(new this.oc.Message_ProgressRange_1),y=l(new this.oc.BRepOffsetAPI_MakeThickSolid);y.MakeThickSolidByJoin(this.wrapped,p,-u,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,v);const m=Pe(y.Shape());if(!Ft(m))throw new Error("Could not shell as a 3d shape");return m}_builderIter(e,r){if(typeof e=="number"){let u=0;for(const l of this._iterTopo("edge"))r(e,dr(l)),u+=1;return u}let n,o=null;typeof e=="function"?n=e:(n=u=>e.filter.shouldKeep(u)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const u of this._iterTopo("edge")){const l=dr(u),f=new tr(l),p=n(f);p&&(r(p,l),i+=1),f.delete()}return o&&o(),i}fillet(e,r){const o=Ee()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new io)}),!this._builderIter(i,(f,p)=>o.Add_2(f,p)))throw new Error("Could not fillet, no edge was selected");const l=Pe(o.Shape());if(!Ft(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const o=Ee()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new io)}),!this._builderIter(i,(f,p)=>o.Add_2(f,p)))throw new Error("Could not chamfer, no edge was selected");const l=Pe(o.Shape());if(!Ft(l))throw new Error("Could not chamfer as a 3d shape");return l}}class Us extends To{}class gr extends To{}class Is extends To{}class Gs extends To{}function Ft(t){return t instanceof Us||t instanceof gr||t instanceof Is||t instanceof Gs}function xa(t){return t instanceof Gt}function dr(t){const e=G(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=Fs(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function Pe(t){const r=G().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,Ls],[r.TopAbs_EDGE,tr],[r.TopAbs_WIRE,Gt],[r.TopAbs_FACE,Fr],[r.TopAbs_SHELL,Us],[r.TopAbs_SOLID,gr],[r.TopAbs_COMPSOLID,Is],[r.TopAbs_COMPOUND,Gs]]).get(Fs(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(dr(t))}const Ns=(t,e)=>{const r=G();return new tr(new r.BRepBuilderAPI_MakeEdge_3(at(t),at(e)).Edge())},ch=(t,e=[0,0,0],r=[0,0,1])=>{const n=G(),[o,i]=Ne(),u=o(_o(e,r)),l=o(new n.gp_Circ_2(u,t)),f=o(new n.BRepBuilderAPI_MakeEdge_8(l)),p=new tr(f.Edge());return i(),p},fh=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const u=G(),[l,f]=Ne();let p=2*Math.PI;i&&(p=-2*Math.PI);const v=l(new u.Geom2d_Line_3(l(new u.gp_Pnt2d_3(0,0)),l(new u.gp_Dir2d_4(p,t)))),y=e/t,m=v.Value(0),S=v.Value(y*Math.sqrt((2*Math.PI)**2+t**2)),T=l(new u.GCE2d_MakeSegment_1(m,S)),x=new u.Geom_CylindricalSurface_1(l(Jr(n,o)),r),C=l(new u.BRepBuilderAPI_MakeEdge_30(l(new u.Handle_Geom2d_Curve_2(T.Value().get())),l(new u.Handle_Geom_Surface_2(x)))).Edge(),A=l(new u.BRepBuilderAPI_MakeWire_2(C)).Wire();return u.BRepLib.BuildCurves3d_2(A),f(),new Gt(A)},en=t=>{const e=G(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(u=>{u instanceof tr&&r.Add_1(u.wrapped),u instanceof Gt&&r.Add_2(u.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const u=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${u.get(o)||"unknown error"}`)}const i=new Gt(r.Wire());return r.delete(),n.delete(),i},jn=(t,e)=>{const r=G(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new Fr(o)},hh=(t,e)=>{const r=G(),[n,o]=Ne(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new Fr(l)},Kr=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=G(),i=_o(r,n),u=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),l=new gr(u.Shape());return i.delete(),u.delete(),l},ph=t=>{const e=G(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new gr(r.Shape());return r.delete(),n};class dh extends st{constructor(e,r,n){const o=G(),i=Ee(),u=Math.sqrt(e*r/n),l=e/u,f=r/u,p=new o.gp_GTrsf_1;p.SetAffinity_1(jr([0,0,0],[0,1,0]),l);const v=i(new o.gp_GTrsf_1);v.SetAffinity_1(jr([0,0,0],[0,0,1]),u);const y=i(new o.gp_GTrsf_1);y.SetAffinity_1(jr([0,0,0],[1,0,0]),f),p.Multiply(v),p.Multiply(y),super(p)}applyToPoint(e){const r=G(),o=Ee()(e.XYZ());return this.wrapped.Transforms_1(o),new r.gp_Pnt_2(o)}}function vh(t){const e=[];for(let r=t.LowerRow();r<=t.UpperRow();r++){const n=[];e.push(n);for(let o=t.LowerCol();o<=t.UpperCol();o++){const i=t.Value(r,o);n.push(i)}}return e}const gh=(t,e,r)=>{const n=G(),o=Ee(),i=o(new n.gp_Sphere_1);i.SetRadius(1);const u=o(new n.Geom_SphericalSurface_2(i)),l=n.GeomConvert.SurfaceToBSplineSurface(u.UReversed()).get(),f=vh(l.Poles_2()),p=new dh(t,e,r);f.forEach((y,m)=>{y.forEach((S,T)=>{const x=p.applyToPoint(S);l.SetPole_1(m+1,T+1,x)})});const v=Pe(o(new n.BRepBuilderAPI_MakeShell_2(l.UReversed(),!1)).Shell());return ki([v])},me=(t,e)=>{const r=G(),n=new r.BRepPrimAPI_MakeBox_4(at(t),at(e)),o=new gr(n.Solid());return n.delete(),o},so=t=>{const e=G(),r=at(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new Ls(o)},Et=t=>{const e=G(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),Pe(n)},St=Et;function mh(t){const e=G(),r=Ee(),n=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return t.forEach(({wrapped:o})=>{n.Add(o)}),n.Perform(r(new e.Message_ProgressRange_1)),Pe(dr(n.SewedShape()))}function ki(t){const e=Ee(),r=G(),n=mh(t),o=Pe(e(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(o instanceof gr))throw new Error("Could not make a solid of faces and shells");return o}const Hs=(t,e)=>{const r=G(),[n,o]=Ne(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(p=>{i.Add(p.wrapped)});const u=n(i.Face()),l=n(new r.ShapeFix_Face_2(u));l.FixOrientation_1();const f=l.Face();return o(),new Fr(f)},yh=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,wh=t=>{let e;t?yh(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let u;typeof r=="number"?u=Er(1,r*dt):u=r;let l;return typeof i=="number"?l=Er(1,i*dt):l=i,{endTangent:u,startFactor:n,endFactor:o,startTangent:l}};function Ca(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let u=Math.acos(o/i);return t*n-e*r<0&&(u=-u),u}function bh([t,e],[r,n],o,i,u,l,f){const p=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const v=Math.sin(u),y=Math.cos(u),m=(t-r)/2,S=(e-n)/2,T=(t+r)/2,x=(e+n)/2,C=y*m+v*S,A=y*S-v*m,L=C*C/(o*o)+A*A/(i*i);L>1&&(o=o*Math.sqrt(L),i=i*Math.sqrt(L));const F=o*i,Y=o*A,V=i*C,ae=Y*Y+V*V;if(!ae)throw Error("start point can not be same as end point");let ee=Math.sqrt(Math.abs((F*F-ae)/ae));l==f&&(ee=-ee);const q=ee*Y/i,de=-ee*V/o,Se=y*q-v*de+T,xe=v*q+y*de+x,ke=(C-q)/o,Ae=(C+q)/o,se=(A-de)/i,ye=(A+de)/i,Ce=Ca(1,0,ke,se);let ue=Ca(ke,se,-Ae,-ye);for(;ue>p;)ue-=p;for(;ue<0;)ue+=p;f||(ue-=p);let ge=Ce+ue;for(;ge>p;)ge-=p;for(;ge<0;)ge+=p;return{cx:Se,cy:xe,startAngle:Ce,deltaAngle:ue,endAngle:ge,clockwise:!!f,rx:o,ry:i}}const Vs=(t,e)=>{const r=G(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new gr(dr(n.Shape()));return n.delete(),o},zs=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=G(),i=jr(e,r),u=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*dt,!1),l=Pe(u.Shape());if(i.delete(),u.delete(),!Ft(l))throw new Error("Could not revolve to a 3d shape");return l};function tn(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:u,support:l,forceProfileSpineOthogonality:f}={},p=!1){const v=G(),y=i==="round"?!0:!!f,m=new v.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const x={transformed:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];x&&m.SetTransitionMode(x)}l?m.SetMode_4(l):r&&m.SetMode_1(r),n&&m.SetMode_5(n.wrapped,!1,v.BRepFill_TypeOfContact.BRepFill_NoContact),o?m.SetLaw_1(t.wrapped,o,!!u,y):m.Add_1(t.wrapped,!!u,y);const S=new v.Message_ProgressRange_1;m.Build(S),p||m.MakeSolid();const T=Pe(m.Shape());if(!Ft(T))throw new Error("Could not sweep to a 3d shape");if(p){const x=Pe(m.FirstShape()),C=Pe(m.LastShape());if(!xa(x))throw new Error("Could not sweep with one start wire");if(!xa(C))throw new Error("Could not sweep with one end wire");return m.delete(),[T,x,C]}return m.delete(),S.delete(),T}const Ws=(t,{profile:e,endFactor:r=1})=>{let n;const o=G();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function $s(t,e,r,n,o=!1){const i=new M(e),u=new M(r),l=Ns(i,i.add(u)),f=en([l]),p=n?Ws(u.Length,n):null;return o?tn(t,f,{law:p},o):tn(t,f,{law:p},o)}function Xs(t,e,r,n,o,i=!1){const u=new M(r),l=new M(n),f=Ns(u,u.add(l)),p=en([f]),v=360/e*l.Length,y=1,m=fh(v,l.Length,y,r,n),S=o?Ws(l.Length,o):null;return i?tn(t,p,{auxiliarySpine:m,law:S},i):tn(t,p,{auxiliarySpine:m,law:S},i)}const _h=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=G(),[u,l]=Ne(),f=u(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&f.AddVertex(u(so(r)).wrapped),t.forEach(y=>f.AddWire(y.wrapped)),n&&f.AddVertex(u(so(n)).wrapped);const p=u(new i.Message_ProgressRange_1);f.Build(p);const v=Pe(f.Shape());if(l(),!Ft(v))throw new Error("Could not loft to a 3d shape");return v};class Dr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Dr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new M(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new M(e)}face(){let e;return this.baseFace?e=hh(this.baseFace,this.wire):e=jn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=jn(this.wire),o=zs(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[u,l]=Ne(),f=u(new M(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const y=$s(this.wire,i||this.defaultOrigin,f,n);return l(),this.delete(),y}if(o){const y=Xs(this.wire,o,i||this.defaultOrigin,f,n);return l(),this.delete(),y}const p=jn(this.wire),v=Vs(p,f);return l(),this.delete(),v}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),u=e(new Je(n,i,o),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const f=tn(u.wire,this.wire,l);return this.delete(),f}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=_h(o.map(u=>u.wire),r,n);return o.forEach(u=>u.delete()),i}}const Sh=t=>{const e=G(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new un(r)};function Th(t,e){const[r,n]=Ne(),o=r(_o(e.origin,e.zDir,e.xDir)),i=G(),u=t.map(l=>{const f=i.GeomLib.To3d(o,l.wrapped);return new tr(new i.BRepBuilderAPI_MakeEdge_24(f).Edge())});return n(),u}const Eh=(t,e)=>{const[r,n]=Ne(),o=G(),i=t.map(u=>{const l=r(new o.BRepBuilderAPI_MakeEdge_30(u.wrapped,e));return new tr(l.Edge())});return n(),i},Ys=(t,e)=>{const r=G();return t.map(o=>e?new Le(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class fn extends st{transformCurves(e){return Ys(e,this.wrapped)}}const Zs=(t,e,r=[0,0])=>{const n=G(),o=Or(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new fn(i)},xh=t=>{const e=G(),[r,n]=Ne(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(Ps(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new fn(i)},Ch=(t,e=[0,0],r="center")=>{const n=G(),[o,i]=Ne(),u=new n.gp_Trsf2d_1;r==="center"?u.SetMirror_1(o(Ye(t))):u.SetMirror_2(o(Or(e,t)));const l=new n.gp_GTrsf2d_2(u);return i(),new fn(l)},Ph=(t,e=[0,0])=>{const r=G(),[n,o]=Ne(),i=new r.gp_Trsf2d_1;i.SetRotation(n(Ye(e)),t);const u=new r.gp_GTrsf2d_2(i);return o(),new fn(u)},kh=(t,e=[0,0])=>{const r=G(),[n,o]=Ne(),i=new r.gp_Trsf2d_1;i.SetScale(n(Ye(e)),t);const u=new r.gp_GTrsf2d_2(i);return o(),new fn(u)};function Ah(t,e,r="original"){const[n,o]=Ne(),i=G();let u=n(i.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let f=null;const p=n(Or([0,0],[0,1])),v=n(Or([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const S=n(u.get().Cylinder());S.Direct()||(u=u.get().UReversed());const T=S.Radius();f=Zs(1/T,[0,1]).wrapped}if(r==="bounds"){if(f=n(new i.gp_GTrsf2d_1),f.SetAffinity(p,l.uMax-l.uMin),l.uMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(new i.gp_XY_2(0,-l.uMin)),f.Multiply(T)}const S=n(new i.gp_GTrsf2d_1);if(S.SetAffinity(v,l.vMax-l.vMin),f.Multiply(S),l.vMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(n(new i.gp_XY_2(0,-l.vMin))),f.Multiply(T)}}const y=Ys(t,f),m=Eh(y,u);return o(),m}const Eo=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},Ai=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${Eo(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class ie{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new ie(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=Sh(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=Zs(e,r,n).transformCurves(this.curves);return new ie(o)}scale(e,r){const n=r||this.boundingBox.center,o=kh(e,n).transformCurves(this.curves);return new ie(o)}rotate(e,r){const n=Ph(e*dt,r).transformCurves(this.curves);return new ie(n)}translate(e,r=0){const n=to(e)?e:[e,r],o=xh(n).transformCurves(this.curves);return new ie(o)}mirror(e,r=[0,0],n="center"){const o=Ch(e,r,n).transformCurves(this.curves);return new ie(o)}sketchOnPlane(e,r){const n=e instanceof Je?Jt(e):Jt(e,r),o=Th(this.curves,n),i=en(o);return new Dr(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=G(),o=Ah(this.curves,e,r),i=en(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const u=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);u.FixEdgeCurves(),u.delete();const l=new Dr(i);if(i.isClosed){const f=l.clone().face();l.defaultOrigin=f.pointOnSurface(.5,.5),l.defaultDirection=f.normalAt(),f.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const f=i.startPoint;l.defaultOrigin=f,l.defaultDirection=e.normalAt(f),l.baseFace=e}return l}toSVGPathD(){const e=Ee(),r=this.clone().mirror([1,0],[0,0],"plane"),o=no(r.curves).flatMap(l=>nh(e(l.adaptor()),l.lastPoint)),[i,u]=r.curves[0].firstPoint;return`M ${pt(i)} ${pt(u)} ${o.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return Eo(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return Ai(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1,o=cn(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,l.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return qe(this.firstPoint,this.lastPoint)}intersects(e){const r=G(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class Oh{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?pi:hi;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=cn(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*dt,o=Er(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*dt,[o,i]=Er(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=jt(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(ci(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,u]=this.pointer;return this.threePointsArcTo([i+e,u+r],[i+n,u+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,u]=e,l=[(n+i)/2,(o+u)/2],f=[-(u-o),i-n],p=Math.sqrt(f[0]**2+f[1]**2),v=[l[0]+f[0]/p*r,l[1]+f[1]/p*r];return this.saveCurve(ci(this._convertToUV(this.pointer),this._convertToUV(v),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=Tt(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(jf(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,u=!1){let l=o,f=r,p=n;r<n&&(l=o+90,f=n,p=r);const v=l*dt,y=q=>Tt(this._convertToUV(q)),m=y(Er(f,v)),S=y(Er(p,v+Math.PI/2)),T=jt(this._convertToUV($f([1,0],v))),[,x]=Xf(T),{cx:C,cy:A,startAngle:L,endAngle:F,clockwise:Y,rx:V,ry:ae}=bh(this._convertToUV(this.pointer),this._convertToUV(e),m,S,x,i,u),ee=qf(V,ae,Y?L:F,Y?F:L,[C,A],T);return Y||ee.reverse(),this.saveCurve(ee),this.pointer=e,this}ellipse(e,r,n,o,i=0,u=!1,l=!1){const[f,p]=this.pointer;return this.ellipseTo([e+f,r+p],n,o,i,u,l)}halfEllipseTo(e,r,n=!1){const o=Wf(e,this.pointer),i=Tt(e,this.pointer);return this.ellipseTo(e,i/2,r,o*Zr,!0,n)}halfEllipse(e,r,n,o=!1){const[i,u]=this.pointer;return this.halfEllipseTo([i+e,u+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(Kf(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:u}=wh(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,f=Tt(this.pointer,e)*.25;let p;o?p=o:l?p=this._convertFromUV(l.tangentAt(1)):p=[1,0],p=jt(p);const v=[this.pointer[0]+p[0]*i*f,this.pointer[1]+p[1]*i*f];let y;n==="symmetric"?y=[-p[0],-p[1]]:y=n,y=jt(y);const m=[e[0]-y[0]*u*f,e[1]-y[1]*u*f];return this.cubicBezierCurveTo(e,v,m)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?pi:hi;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){qe(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(qe(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=Or(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new Le(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}const Rh=t=>{const e=G(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,u)=>{i.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,u===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=Pe(r.Shape());if(r.delete(),!(o instanceof Fr))throw new Error("Failed to create a face");return o},Dh=(t,e)=>{const r=G(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},Pa=t=>{let e,r;try{e=jn(t[0]),r=t.slice(1)}catch{e=Rh(t),r=t.slice(1).map(o=>Dh(o,e))}return Hs(e,r)},ka=(t,e)=>{const r=[],n=[],o=[];t.forEach(f=>{const[p,v,y]=e(f);r.push(p),n.push(v),o.push(y)});const i=Pa(n),u=Pa(o);return ki([i,...r,u])};class Aa{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return Et(e)}face(){const e=this.outerSketch.face();return Hs(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const u=new M(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?ka(this.sketches,p=>$s(p.wire,i||this.outerSketch.defaultOrigin,u,n,!0)):o?ka(this.sketches,p=>Xs(p.wire,o,i||this.outerSketch.defaultOrigin,u,n,!0)):Vs(this.face(),u)}revolve(e,{origin:r}={}){return zs(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,u)=>{const l=e.sketches[u];return i.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),ki(n)}}class ve{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new ve(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new un;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new ve(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new ve(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new ve(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new ve(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new ve(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new Aa(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new Aa(n)}toSVGViewBox(e=1){return Eo(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return Ai(this.toSVGGroup(),this.boundingBox,e)}}class Oa{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof Dr?r.wire:r.wires);return Et(e)}faces(){const e=this.sketches.map(r=>r.face());return Et(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return Et(n)}revolve(e,r){return Et(this.sketches.map(n=>n.revolve(e,r)))}}class K{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new K(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new un;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new K(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new K(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new K(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new K(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new K(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new Oa(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new Oa(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return Eo(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof ie?n.toSVGPath():n.toSVGGroup());return Ai(r.join(`
    `),this.boundingBox,e)}}const Mh=t=>{const e=t.map((o,i)=>t.slice(i+1).map((u,l)=>[l+i+1,u]).filter(([,u])=>!o.boundingBox.isOut(u.boundingBox)).map(([u])=>u)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let u=n[i];u||(u=[],r.push(u)),u.push(t[i]),o.length&&o.forEach(l=>{n[l]=u})}),r},js=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((u,l)=>r===l?!1:u.isInside(o));return{blueprint:e,isIn:i}}),Fh=(t,e)=>t.flatMap(({blueprint:r})=>Oi(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),Lh=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=Oi(js(t.map(({blueprint:o})=>o)));return[r,...n]},Oi=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?Fh(e,t):Lh(r,t)},hn=t=>{const e=Mh(t).map(js);return new K(e.flatMap(Oi).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new ve(r.map(({blueprint:n})=>n)))))},qn=1e-9,je=(t,e)=>qe(t,e,qn),Xr=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},Ra=(t,e)=>{const r=t.findIndex(i=>je(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},Da=(t,e)=>{const r=u=>je(e.firstPoint,u.firstPoint)&&je(e.lastPoint,u.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Ri(t),n=t.findIndex(r),n===-1))throw console.error(t.map(u=>u.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*Ma(t,e,r){const n=u=>!!e.find(l=>je(l,u.lastPoint)),o=u=>!!r.find(l=>je(l.firstPoint,u.firstPoint)&&je(l.lastPoint,u.lastPoint)||je(l.firstPoint,u.lastPoint)&&je(l.lastPoint,u.firstPoint));let i=[];for(const u of t)n(u)?(i.push(u),yield i,i=[]):o(u)?(i.length&&(yield i,i=[]),yield[u]):i.push(u);i.length&&(yield i)}const Bh=t=>t[0].firstPoint,Qo=t=>t[t.length-1].lastPoint,Ri=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),Uh=t=>(t.reverse(),t.map(Ri));function Ih(t,e,r){return t.filter(n=>{const o=e.filter(l=>je(l.firstPoint,n)||je(l.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(l=>r.isInside(Xr(l)));return!(i.every(l=>l)||!i.some(l=>l))})}function Gh(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((m,S)=>{e.curves.forEach((T,x)=>{const{intersections:C,commonSegments:A,commonSegmentsPoints:L}=ln(m,T,qn/100);r.push(...C),o[S].push(...C),i[x].push(...C),n.push(...A),r.push(...L),o[S].push(...L),i[x].push(...L)})}),r=Cs(r,qn),!r.length||r.length===1)return null;const u=([m,S])=>S.length?m.splitAt(S,qn/100):[m];let l=Cr([t.curves,o]).flatMap(u),f=Cr([e.curves,i]).flatMap(u);const p=n.map(m=>[m.firstPoint,m.lastPoint]);if(r=Ih(r,l,e),!r.length&&!n.length)return null;if(n.length){const m=n[0];l=Da(l,m),f=Da(f,m)}else{const m=r[0];l=Ra(l,m),f=Ra(f,m)}const v=Array.from(Ma(l,r,n));let y=Array.from(Ma(f,r,n));return(!je(Qo(y[0]),Qo(v[0]))||n.length>0&&y[0].length!==1)&&(y=Uh(y)),Cr([v,y]).map(([m,S])=>{const T=Bh(m),x=Qo(m);return p.find(([C,A])=>je(C,T)&&je(A,x)||je(C,x)&&je(C,T))?[m,"same"]:[m,S]})}const Nh=t=>{const e=t.map(u=>u.firstPoint);let r=t.map(u=>u.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=Cr([e,r]).map(([u,l],f)=>je(u,l)?null:f).filter(u=>u!==null);if(!n.length)return[t];const o=Cr([n.slice(0,-1),n.slice(1)]).map(([u,l])=>t.slice(u,l));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function Di(t,e,{firstInside:r,secondInside:n}){const o=Gh(t,e);if(!o){const p=Xr(t.curves[0]),v=e.isInside(p),y=Xr(e.curves[0]),m=t.isInside(y);return{identical:!1,firstCurveInSecond:v,secondCurveInFirst:m}}if(o.every(([,p])=>p==="same"))return{identical:!0};let i=null,u=null;const l=o.flatMap(([p,v])=>{let y=[],m=0;if(v==="same")return u===1?(u=1,[...p]):u===2||u===0?(u=null,[]):u===null?(i?i=[...i,...p]:i=p,[]):(console.error("weird situation"),[]);const S=Xr(p[0]),T=e.isInside(S);(r==="keep"&&T||r==="remove"&&!T)&&(m+=1,y.push(...p));const x=Xr(v[0]),C=t.isInside(x);if(n==="keep"&&C||n==="remove"&&!C){let A=v;m===1&&(A=Ri(v)),m+=1,y.push(...A)}return u===null&&m===1&&i&&(y=[...i,...y]),m===1&&(u=m,i=null),y}),f=Nh(l).filter(p=>p.length).map(p=>new ie(p));return f.length===0?null:f.length===1?f[0]:hn(f)}const xo=(t,e)=>{const r=Di(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof ie||r instanceof K?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new K([t,e])},rn=(t,e)=>{const r=Di(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof ie||r instanceof K?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new K([new ve([t,e])]):t.clone()},Mi=(t,e)=>{const r=Di(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof ie||r instanceof K?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},vi=(t,e)=>{if(t instanceof ie&&e instanceof ie){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:u}=ln(n,o);r.push(...i),r.push(...u)})}),r=Cs(r),r.length>1}if(t instanceof ve||t instanceof K)return t.blueprints.some(r=>vi(r,e));if(e instanceof ve||e instanceof K)return e.blueprints.some(r=>vi(t,r));throw new Error("Bug in the generic intersects algorithm")},Hh=(t,e)=>{if(t instanceof ve){if(e instanceof ie)return uo(e,t);if(e instanceof ve)return lo(t,e)}if(e instanceof ve){if(t instanceof ie)return uo(t,e);if(t instanceof ve)return lo(t,e)}if(t instanceof ie&&e instanceof ie)return xo(t,e);throw new Error("Bug in the generic fuse algorithm")},Fa=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((u,l)=>{const f=i.current,p=o+l+1;if(i.fusedWith.has(p))return;let v=u,y=!1;if(e.has(p)&&(v=e.get(p).current,y=!0),f.boundingBox.isOut(v.boundingBox)||!vi(f,v))return;let m;if(f instanceof K||v instanceof K?m=Bt(f,v):m=Hh(f,v),!(m instanceof ie||m instanceof ve)){if(m instanceof K&&m.blueprints.length===2)return;if(m instanceof K&&m.blueprints.length===1)m=m.blueprints[0];else if(!(m instanceof K))throw console.error(m),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(p),i.current=m,y||e.set(p,i)})}),hn(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>Lt(n)))},Lt=t=>t instanceof ie?[t]:t instanceof ve?t.blueprints:t instanceof K?t.blueprints.flatMap(e=>Lt(e)):[],uo=(t,e)=>{const r=xo(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>rn(o,t));return hn([...Lt(r),...n.flatMap(o=>Lt(o))])};function Vh(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const lo=(t,e)=>{const r=xo(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(u=>rn(u,t.blueprints[0])),o=t.blueprints.slice(1).map(u=>rn(u,e.blueprints[0])),i=Vh(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([u,l])=>Lt(Mi(u,l)));return hn([...Lt(r),...n.flatMap(u=>Lt(u)),...o.flatMap(u=>Lt(u)),...i])},Bt=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof K)&&e instanceof K)return Fa([t,...e.blueprints]);if(!(e instanceof K)&&t instanceof K)return Fa([e,...t.blueprints]);if(t instanceof K&&e instanceof K){let r=Bt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=Bt(n,r)}),r}if(t instanceof ve){if(e instanceof K)return Bt(e,t);if(e instanceof ie)return uo(e,t);if(e instanceof ve)return lo(t,e)}if(e instanceof ve){if(t instanceof K)return Bt(t,e);if(t instanceof ie)return uo(t,e);if(t instanceof ve)return lo(t,e)}return t instanceof ie&&e instanceof ie?xo(t,e):null},co=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof K?r.blueprints:r);return e.length===1?e[0]:new K(e)},qt=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof K)return co(t.blueprints.map(n=>qt(n,e)));if(t instanceof ve){const n=t.blueprints[0];if(e instanceof ie&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=Bt(e,new K(t.blueprints.slice(1)));return hn([n,...Lt(o)])}else{let o=qt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=qt(o,i)}),o}}if(e instanceof K)return co(e.blueprints.map(n=>qt(t,n)));if(e instanceof ve){let n=rn(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=Bt(n,Mi(o,t))}),n}return rn(t,e)};function Yr(t,e){if(t===null||e===null)return null;if(t instanceof ie&&e instanceof ie)return Mi(t,e);if(t instanceof K)return co(t.blueprints.map(r=>Yr(r,e)));if(t instanceof ve){const r=t.blueprints[0],n=t.blueprints[1];return qt(Yr(r,e),n)}if(e instanceof K)return co(e.blueprints.map(r=>Yr(t,r)));if(e instanceof ve){const r=e.blueprints[0],n=e.blueprints[1];return qt(Yr(r,t),n)}throw new Error("intersct 2D algorithm error")}const La=(t,e={})=>{const r=e.plane instanceof Je?Jt(e.plane):Jt(e.plane,e.origin),n=en([ch(t,r.origin,r.zDir)]),o=new Dr(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var u=n.charCodeAt(i),l;return u>=55296&&u<=56319&&o>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(u-55296)*1024+l-56320+65536:u}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function qs(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var zh=new qs,Wh=new qs,Ks=new Uint8Array(30),Qs=new Uint16Array(30),$h=new Uint8Array(30),Xh=new Uint16Array(30);function Js(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function Yh(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}Yh(zh,Wh);Js(Ks,Qs,4,3);Js($h,Xh,2,1);Ks[28]=0;Qs[28]=258;function Sr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function rr(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}rr.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};rr.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};rr.prototype.addX=function(t){this.addPoint(t,null)};rr.prototype.addY=function(t){this.addPoint(null,t)};rr.prototype.addBezier=function(t,e,r,n,o,i,u,l){var f=[t,e],p=[r,n],v=[o,i],y=[u,l];this.addPoint(t,e),this.addPoint(u,l);for(var m=0;m<=1;m++){var S=6*f[m]-12*p[m]+6*v[m],T=-3*f[m]+9*p[m]-9*v[m]+3*y[m],x=3*p[m]-3*f[m];if(T===0){if(S===0)continue;var C=-x/S;0<C&&C<1&&(m===0&&this.addX(Sr(f[m],p[m],v[m],y[m],C)),m===1&&this.addY(Sr(f[m],p[m],v[m],y[m],C)));continue}var A=Math.pow(S,2)-4*x*T;if(!(A<0)){var L=(-S+Math.sqrt(A))/(2*T);0<L&&L<1&&(m===0&&this.addX(Sr(f[m],p[m],v[m],y[m],L)),m===1&&this.addY(Sr(f[m],p[m],v[m],y[m],L)));var F=(-S-Math.sqrt(A))/(2*T);0<F&&F<1&&(m===0&&this.addX(Sr(f[m],p[m],v[m],y[m],F)),m===1&&this.addY(Sr(f[m],p[m],v[m],y[m],F)))}}};rr.prototype.addQuad=function(t,e,r,n,o,i){var u=t+.6666666666666666*(r-t),l=e+2/3*(n-e),f=u+1/3*(o-t),p=l+1/3*(i-e);this.addBezier(t,e,u,l,f,p,o,i)};function ze(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}ze.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};ze.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};ze.prototype.curveTo=ze.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})};ze.prototype.quadTo=ze.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};ze.prototype.close=ze.prototype.closePath=function(){this.commands.push({type:"Z"})};ze.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof rr){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};ze.prototype.getBoundingBox=function(){for(var t=new rr,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var u=this.commands[i];switch(u.type){case"M":t.addPoint(u.x,u.y),e=n=u.x,r=o=u.y;break;case"L":t.addPoint(u.x,u.y),n=u.x,o=u.y;break;case"Q":t.addQuad(n,o,u.x1,u.y1,u.x,u.y),n=u.x,o=u.y;break;case"C":t.addBezier(n,o,u.x1,u.y1,u.x2,u.y2,u.x,u.y),n=u.x,o=u.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+u.type)}}return t.isEmpty()&&t.addPoint(0,0),t};ze.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};ze.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(t)}function r(){for(var u=arguments,l="",f=0;f<arguments.length;f+=1){var p=u[f];p>=0&&f>0&&(l+=" "),l+=e(p)}return l}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n};ze.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};ze.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function eu(t){throw new Error(t)}function Ba(t,e){t||eu(e)}var j={fail:eu,argument:Ba,assert:Ba},Ua=32768,Ia=2147483648,Mr={},H={},Z={};function mt(t){return function(){return t}}H.BYTE=function(t){return j.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};Z.BYTE=mt(1);H.CHAR=function(t){return[t.charCodeAt(0)]};Z.CHAR=mt(1);H.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};Z.CHARARRAY=function(t){return typeof t>"u"?0:t.length};H.USHORT=function(t){return[t>>8&255,t&255]};Z.USHORT=mt(2);H.SHORT=function(t){return t>=Ua&&(t=-(2*Ua-t)),[t>>8&255,t&255]};Z.SHORT=mt(2);H.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};Z.UINT24=mt(3);H.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};Z.ULONG=mt(4);H.LONG=function(t){return t>=Ia&&(t=-(2*Ia-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};Z.LONG=mt(4);H.FIXED=H.ULONG;Z.FIXED=Z.ULONG;H.FWORD=H.SHORT;Z.FWORD=Z.SHORT;H.UFWORD=H.USHORT;Z.UFWORD=Z.USHORT;H.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};Z.LONGDATETIME=mt(8);H.TAG=function(t){return j.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};Z.TAG=mt(4);H.Card8=H.BYTE;Z.Card8=Z.BYTE;H.Card16=H.USHORT;Z.Card16=Z.USHORT;H.OffSize=H.BYTE;Z.OffSize=Z.BYTE;H.SID=H.USHORT;Z.SID=Z.USHORT;H.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?H.NUMBER16(t):H.NUMBER32(t)};Z.NUMBER=function(t){return H.NUMBER(t).length};H.NUMBER16=function(t){return[28,t>>8&255,t&255]};Z.NUMBER16=mt(3);H.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};Z.NUMBER32=mt(5);H.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,u=e.length;i<u;i+=1){var l=e[i];l==="e"?o+=e[++i]==="-"?"c":"b":l==="."?o+="a":l==="-"?o+="e":o+=l}o+=o.length&1?"f":"ff";for(var f=[30],p=0,v=o.length;p<v;p+=2)f.push(parseInt(o.substr(p,2),16));return f};Z.REAL=function(t){return H.REAL(t).length};H.NAME=H.CHARARRAY;Z.NAME=Z.CHARARRAY;H.STRING=H.CHARARRAY;Z.STRING=Z.CHARARRAY;Mr.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Mr.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)};H.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};Z.UTF16=function(t){return t.length*2};var gi={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Mr.MACSTRING=function(t,e,r,n){var o=gi[n];if(o!==void 0){for(var i="",u=0;u<r;u++){var l=t.getUint8(e+u);l<=127?i+=String.fromCharCode(l):i+=o[l&127]}return i}};var Hn=typeof WeakMap=="function"&&new WeakMap,Vn,Zh=function(t){if(!Vn){Vn={};for(var e in gi)Vn[e]=new String(e)}var r=Vn[t];if(r!==void 0){if(Hn){var n=Hn.get(r);if(n!==void 0)return n}var o=gi[t];if(o!==void 0){for(var i={},u=0;u<o.length;u++)i[o.charCodeAt(u)]=u+128;return Hn&&Hn.set(r,i),i}}};H.MACSTRING=function(t,e){var r=Zh(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}};Z.MACSTRING=function(t,e){var r=H.MACSTRING(t,e);return r!==void 0?r.length:0};function mi(t){return t>=-128&&t<=127}function jh(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function qh(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var u=t[i];if(!mi(u)||u===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var l=e;l<i;++l)r.push(t[l]+256&255);return i}function Kh(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var u=t[i];if(u===0||mi(u)&&i+1<o&&mi(t[i+1]))break;++i,++n}r.push(64|n-1);for(var l=e;l<i;++l){var f=t[l];r.push(f+65536>>8&255,f+256&255)}return i}H.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=jh(t,e,r):n>=-128&&n<=127?e=qh(t,e,r):e=Kh(t,e,r)}return r};H.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=H.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var u=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,H.BYTE,H.USHORT,H.UINT24,H.ULONG][l],p=0;p<r.length;p+=1){var v=f(r[p]);Array.prototype.push.apply(u,v)}return Array.prototype.concat(H.Card16(t.length),H.OffSize(l),u,n)};Z.INDEX=function(t){return H.INDEX(t).length};H.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),u=t[i];e=e.concat(H.OPERAND(u.value,u.type)),e=e.concat(H.OPERATOR(i))}return e};Z.DICT=function(t){return H.DICT(t).length};H.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};H.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)j.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(H.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(H.NUMBER(t));else if(e==="offset")r=r.concat(H.NUMBER32(t));else if(e==="number")r=r.concat(H.NUMBER(t));else if(e==="real")r=r.concat(H.REAL(t));else throw new Error("Unknown operand type "+e);return r};H.OP=H.BYTE;Z.OP=Z.BYTE;var zn=typeof WeakMap=="function"&&new WeakMap;H.CHARSTRING=function(t){if(zn){var e=zn.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(H[i.type](i.value))}return zn&&zn.set(t,r),r};Z.CHARSTRING=function(t){return H.CHARSTRING(t).length};H.OBJECT=function(t){var e=H[t.type];return j.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};Z.OBJECT=function(t){var e=Z[t.type];return j.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};H.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var u=t.fields[i],l=H[u.type];j.argument(l!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var f=t[u.name];f===void 0&&(f=u.value);var p=l(f);u.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(p)):e=e.concat(p)}for(var v=0;v<n.length;v+=1){var y=o[v],m=e.length;j.argument(m<65536,"Table "+t.tableName+" too big."),e[y]=m>>8,e[y+1]=m&255,e=e.concat(n[v])}return e};Z.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=Z[o.type];j.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var u=t[o.name];u===void 0&&(u=o.value),e+=i(u),o.type==="TABLE"&&(e+=2)}return e};H.RECORD=H.TABLE;Z.RECORD=Z.TABLE;H.LITERAL=function(t){return t};Z.LITERAL=function(t){return t.length};function Xe(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),u=0;u<i.length;u+=1){var l=i[u],f=r[l];this[l]!==void 0&&(this[l]=f)}}Xe.prototype.encode=function(){return H.TABLE(this)};Xe.prototype.sizeOf=function(){return Z.TABLE(this)};function nn(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function yi(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function on(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function fo(t){t.format===1?Xe.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(nn("glyph",t.glyphs))):t.format===2?Xe.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(on("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):j.assert(!1,"Coverage format must be 1 or 2.")}fo.prototype=Object.create(Xe.prototype);fo.prototype.constructor=fo;function ho(t){Xe.call(this,"scriptListTable",on("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return j.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Xe("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Xe("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(nn("featureIndex",o.featureIndexes)))}].concat(on("langSys",n.langSysRecords,function(i,u){var l=i.langSys;return[{name:"langSysTag"+u,type:"TAG",value:i.tag},{name:"langSys"+u,type:"TABLE",value:new Xe("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(nn("featureIndex",l.featureIndexes)))}]})))}]}))}ho.prototype=Object.create(Xe.prototype);ho.prototype.constructor=ho;function po(t){Xe.call(this,"featureListTable",on("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Xe("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(nn("lookupListIndex",n.lookupListIndexes)))}]}))}po.prototype=Object.create(Xe.prototype);po.prototype.constructor=po;function vo(t,e){Xe.call(this,"lookupListTable",yi("lookup",t,function(r){var n=e[r.lookupType];return j.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Xe("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(yi("subtable",r.subtables,n)))}))}vo.prototype=Object.create(Xe.prototype);vo.prototype.constructor=vo;var W={Table:Xe,Record:Xe,Coverage:fo,ScriptList:ho,FeatureList:po,LookupList:vo,ushortList:nn,tableList:yi,recordList:on};function Ga(t,e){return t.getUint8(e)}function go(t,e){return t.getUint16(e,!1)}function Qh(t,e){return t.getInt16(e,!1)}function Fi(t,e){return t.getUint32(e,!1)}function tu(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function Jh(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function ep(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function tp(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function rp(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var np={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function P(t,e){this.data=t,this.offset=e,this.relativeOffset=0}P.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};P.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};P.prototype.parseCard8=P.prototype.parseByte;P.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};P.prototype.parseCard16=P.prototype.parseUShort;P.prototype.parseSID=P.prototype.parseUShort;P.prototype.parseOffset16=P.prototype.parseUShort;P.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};P.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};P.prototype.parseULong=function(){var t=Fi(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};P.prototype.parseOffset32=P.prototype.parseULong;P.prototype.parseFixed=function(){var t=tu(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};P.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n};P.prototype.parseTag=function(){return this.parseString(4)};P.prototype.parseLongDateTime=function(){var t=Fi(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};P.prototype.parseVersion=function(t){var e=go(this.data,this.offset+this.relativeOffset),r=go(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};P.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=np[t]*e};P.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};P.prototype.parseOffset16List=P.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};P.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};P.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e};P.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};P.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};P.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},u=0;u<n.length;u++){var l=n[u],f=e[l];i[l]=f.call(this)}r[o]=i}return r};P.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},u=0;u<n.length;u++){var l=n[u],f=e[l];i[l]=f.call(this)}r[o]=i}return r};P.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r};P.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};P.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};P.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new P(this.data,this.offset+e).parseStruct(t)};P.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new P(this.data,this.offset+e).parseStruct(t)};P.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var u=e[i];if(u===0){o[i]=void 0;continue}if(this.relativeOffset=u,t){for(var l=this.parseOffset16List(),f=new Array(l.length),p=0;p<l.length;p++)this.relativeOffset=u+l[p],f[p]=t.call(this);o[i]=f}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o};P.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};P.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:P.uShort,end:P.uShort,classId:P.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};P.list=function(t,e){return function(){return this.parseList(t,e)}};P.list32=function(t,e){return function(){return this.parseList32(t,e)}};P.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};P.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};P.pointer=function(t){return function(){return this.parsePointer(t)}};P.pointer32=function(t){return function(){return this.parsePointer32(t)}};P.tag=P.prototype.parseTag;P.byte=P.prototype.parseByte;P.uShort=P.offset16=P.prototype.parseUShort;P.uShortList=P.prototype.parseUShortList;P.uLong=P.offset32=P.prototype.parseULong;P.uLongList=P.prototype.parseULongList;P.struct=P.prototype.parseStruct;P.coverage=P.prototype.parseCoverage;P.classDef=P.prototype.parseClassDef;var Na={reserved:P.uShort,reqFeatureIndex:P.uShort,featureIndexes:P.uShortList};P.prototype.parseScriptList=function(){return this.parsePointer(P.recordList({tag:P.tag,script:P.pointer({defaultLangSys:P.pointer(Na),langSysRecords:P.recordList({tag:P.tag,langSys:P.pointer(Na)})})}))||[]};P.prototype.parseFeatureList=function(){return this.parsePointer(P.recordList({tag:P.tag,feature:P.pointer({featureParams:P.offset16,lookupListIndexes:P.uShortList})}))||[]};P.prototype.parseLookupList=function(t){return this.parsePointer(P.list(P.pointer(function(){var e=this.parseUShort();j.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(P.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};P.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();j.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:P.offset32,featureTableSubstitutionOffset:P.offset32});return r})||[]};var J={getByte:Ga,getCard8:Ga,getUShort:go,getCard16:go,getShort:Qh,getULong:Fi,getFixed:tu,getTag:Jh,getOffset:ep,getBytes:tp,bytesToString:rp,Parser:P};function op(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),u=e.parseULong(),l=o;l<=i;l+=1)t.glyphIndexMap[l]=u,u++}function ip(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var u=new J.Parser(r,n+o+14),l=new J.Parser(r,n+o+16+i*2),f=new J.Parser(r,n+o+16+i*4),p=new J.Parser(r,n+o+16+i*6),v=n+o+16+i*8,y=0;y<i-1;y+=1)for(var m=void 0,S=u.parseUShort(),T=l.parseUShort(),x=f.parseShort(),C=p.parseUShort(),A=T;A<=S;A+=1)C!==0?(v=p.offset+p.relativeOffset-2,v+=C,v+=(A-T)*2,m=J.getUShort(r,v),m!==0&&(m=m+x&65535)):m=A+x&65535,t.glyphIndexMap[A]=m}function ap(t,e){var r={};r.version=J.getUShort(t,e),j.argument(r.version===0,"cmap table version should be 0."),r.numTables=J.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=J.getUShort(t,e+4+o*8),u=J.getUShort(t,e+4+o*8+2);if(i===3&&(u===0||u===1||u===10)||i===0&&(u===0||u===1||u===2||u===3||u===4)){n=J.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new J.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)op(r,l);else if(r.format===4)ip(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function sp(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function up(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function lp(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new W.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var u=t.get(r),l=0;l<u.unicodes.length;l+=1)sp(i,u.unicodes[l],r);i.segments=i.segments.sort(function(L,F){return L.start-F.start})}up(i);var f=i.segments.length,p=0,v=[],y=[],m=[],S=[],T=[],x=[];for(r=0;r<f;r+=1){var C=i.segments[r];C.end<=65535&&C.start<=65535?(v=v.concat({name:"end_"+r,type:"USHORT",value:C.end}),y=y.concat({name:"start_"+r,type:"USHORT",value:C.start}),m=m.concat({name:"idDelta_"+r,type:"SHORT",value:C.delta}),S=S.concat({name:"idRangeOffset_"+r,type:"USHORT",value:C.offset}),C.glyphId!==void 0&&(T=T.concat({name:"glyph_"+r,type:"USHORT",value:C.glyphId}))):p+=1,!e&&C.glyphIndex!==void 0&&(x=x.concat({name:"cmap12Start_"+r,type:"ULONG",value:C.start}),x=x.concat({name:"cmap12End_"+r,type:"ULONG",value:C.end}),x=x.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:C.glyphIndex}))}if(i.segCountX2=(f-p)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(f-p)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(v),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(y),i.fields=i.fields.concat(m),i.fields=i.fields.concat(S),i.fields=i.fields.concat(T),i.cmap4Length=14+v.length*2+2+y.length*2+m.length*2+S.length*2+T.length*2,!e){var A=16+x.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:A},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:x.length/3}]),i.fields=i.fields.concat(x)}return i}var cp={parse:ap,make:lp},Kn=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],fp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],hp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Ha=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function ru(t){this.font=t}ru.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function mo(t,e){this.encoding=t,this.charset=e}mo.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function pp(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var ur={line:pp};function dp(t,e){var r=e||new ze;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function ut(t){this.bindConstructorValues(t)}ut.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",dp(this,t.path))};ut.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};ut.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};ut.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,u;n||(n={});var l=n.xScale,f=n.yScale;if(n.hinting&&o&&o.hinting&&(u=this.path&&o.hinting.exec(this,r)),u)i=o.hinting.getCommands(u),t=Math.round(t),e=Math.round(e),l=f=1;else{i=this.path.commands;var p=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=p),f===void 0&&(f=p)}for(var v=new ze,y=0;y<i.length;y+=1){var m=i[y];m.type==="M"?v.moveTo(t+m.x*l,e+-m.y*f):m.type==="L"?v.lineTo(t+m.x*l,e+-m.y*f):m.type==="Q"?v.quadraticCurveTo(t+m.x1*l,e+-m.y1*f,t+m.x*l,e+-m.y*f):m.type==="C"?v.curveTo(t+m.x1*l,e+-m.y1*f,t+m.x2*l,e+-m.y2*f,t+m.x*l,e+-m.y*f):m.type==="Z"&&v.closePath()}return v};ut.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return j.argument(e.length===0,"There are still points left in the current contour."),t};ut.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i};ut.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)};ut.prototype.drawPoints=function(t,e,r,n){function o(y,m,S,T){t.beginPath();for(var x=0;x<y.length;x+=1)t.moveTo(m+y[x].x*T,S+y[x].y*T),t.arc(m+y[x].x*T,S+y[x].y*T,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,u=[],l=[],f=this.path,p=0;p<f.commands.length;p+=1){var v=f.commands[p];v.x!==void 0&&u.push({x:v.x,y:-v.y}),v.x1!==void 0&&l.push({x:v.x1,y:-v.y1}),v.x2!==void 0&&l.push({x:v.x2,y:-v.y2})}t.fillStyle="blue",o(u,e,r,i),t.fillStyle="red",o(l,e,r,i)};ut.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",ur.line(t,e,-1e4,e,1e4),ur.line(t,-1e4,r,1e4,r);var i=this.xMin||0,u=this.yMin||0,l=this.xMax||0,f=this.yMax||0,p=this.advanceWidth||0;t.strokeStyle="blue",ur.line(t,e+i*o,-1e4,e+i*o,1e4),ur.line(t,e+l*o,-1e4,e+l*o,1e4),ur.line(t,-1e4,r+-u*o,1e4,r+-u*o),ur.line(t,-1e4,r+-f*o,1e4,r+-f*o),t.strokeStyle="green",ur.line(t,e+p*o,-1e4,e+p*o,1e4)};function Wn(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Li(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Li.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};Li.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function vp(t,e){return new ut({index:e,font:t})}function gp(t,e,r,n,o,i){return function(){var u=new ut({index:e,font:t});return u.path=function(){r(u,n,o);var l=i(t.glyphs,u);return l.unitsPerEm=t.unitsPerEm,l},Wn(u,"xMin","_xMin"),Wn(u,"xMax","_xMax"),Wn(u,"yMin","_yMin"),Wn(u,"yMax","_yMax"),u}}function mp(t,e,r,n){return function(){var o=new ut({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var Ct={GlyphSet:Li,glyphLoader:vp,ttfGlyphLoader:gp,cffGlyphLoader:mp};function nu(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!nu(t[r],e[r]))return!1;return!0}else return!1}function wi(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Zt(t,e,r){var n=[],o=[],i=J.getCard16(t,e),u,l;if(i!==0){var f=J.getByte(t,e+2);u=e+(i+1)*f+2;for(var p=e+3,v=0;v<i+1;v+=1)n.push(J.getOffset(t,p,f)),p+=f;l=u+n[i]}else l=e+2;for(var y=0;y<n.length-1;y+=1){var m=J.getBytes(t,u+n[y],u+n[y+1]);r&&(m=r(m)),o.push(m)}return{objects:o,startOffset:e,endOffset:l}}function yp(t,e){var r=[],n=J.getCard16(t,e),o,i;if(n!==0){var u=J.getByte(t,e+2);o=e+(n+1)*u+2;for(var l=e+3,f=0;f<n+1;f+=1)r.push(J.getOffset(t,l,u)),l+=u;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function wp(t,e,r,n,o){var i=J.getCard16(r,n),u=0;if(i!==0){var l=J.getByte(r,n+2);u=n+(i+1)*l+2}var f=J.getBytes(r,u+e[t],u+e[t+1]);return o&&(f=o(f)),f}function bp(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,u=o&15;if(i===r||(e+=n[i],u===r))break;e+=n[u]}return parseFloat(e)}function _p(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return bp(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function Sp(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function ou(t,e,r){e=e!==void 0?e:0;var n=new J.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var u=n.parseByte();u<=21?(u===12&&(u=1200+n.parseByte()),o.push([u,i]),i=[]):i.push(_p(n,u))}return Sp(o)}function Qr(t,e){return e<=390?e=Kn[e]:e=t[e-391],e}function iu(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var u=e[i];if(Array.isArray(u.type)){var l=[];l.length=u.type.length;for(var f=0;f<u.type.length;f++)o=t[u.op]!==void 0?t[u.op][f]:void 0,o===void 0&&(o=u.value!==void 0&&u.value[f]!==void 0?u.value[f]:null),u.type[f]==="SID"&&(o=Qr(r,o)),l[f]=o;n[u.name]=l}else o=t[u.op],o===void 0&&(o=u.value!==void 0?u.value:null),u.type==="SID"&&(o=Qr(r,o)),n[u.name]=o}return n}function Tp(t,e){var r={};return r.formatMajor=J.getCard8(t,e),r.formatMinor=J.getCard8(t,e+1),r.size=J.getCard8(t,e+2),r.offsetSize=J.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var au=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],su=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Ep(t,e){var r=ou(t,0,t.byteLength);return iu(r,au,e)}function uu(t,e,r,n){var o=ou(t,e,r);return iu(o,su,n)}function Va(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var u=new DataView(new Uint8Array(r[i]).buffer),l=Ep(u,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var f=l.private[0],p=l.private[1];if(f!==0&&p!==0){var v=uu(t,p+e,f,n);if(l._defaultWidthX=v.defaultWidthX,l._nominalWidthX=v.nominalWidthX,v.subrs!==0){var y=p+v.subrs,m=Zt(t,y+e);l._subrs=m.objects,l._subrsBias=wi(l._subrs)}l._privateDict=v}o.push(l)}return o}function xp(t,e,r,n){var o,i,u=new J.Parser(t,e);r-=1;var l=[".notdef"],f=u.parseCard8();if(f===0)for(var p=0;p<r;p+=1)o=u.parseSID(),l.push(Qr(n,o));else if(f===1)for(;l.length<=r;){o=u.parseSID(),i=u.parseCard8();for(var v=0;v<=i;v+=1)l.push(Qr(n,o)),o+=1}else if(f===2)for(;l.length<=r;){o=u.parseSID(),i=u.parseCard16();for(var y=0;y<=i;y+=1)l.push(Qr(n,o)),o+=1}else throw new Error("Unknown charset format "+f);return l}function Cp(t,e,r){var n,o={},i=new J.Parser(t,e),u=i.parseCard8();if(u===0)for(var l=i.parseCard8(),f=0;f<l;f+=1)n=i.parseCard8(),o[n]=f;else if(u===1){var p=i.parseCard8();n=1;for(var v=0;v<p;v+=1)for(var y=i.parseCard8(),m=i.parseCard8(),S=y;S<=y+m;S+=1)o[S]=n,n+=1}else throw new Error("Unknown encoding format "+u);return new mo(o,r)}function za(t,e,r){var n,o,i,u,l=new ze,f=[],p=0,v=!1,y=!1,m=0,S=0,T,x,C,A;if(t.isCIDFont){var L=t.tables.cff.topDict._fdSelect[e.index],F=t.tables.cff.topDict._fdArray[L];T=F._subrs,x=F._subrsBias,C=F._defaultWidthX,A=F._nominalWidthX}else T=t.tables.cff.topDict._subrs,x=t.tables.cff.topDict._subrsBias,C=t.tables.cff.topDict._defaultWidthX,A=t.tables.cff.topDict._nominalWidthX;var Y=C;function V(q,de){y&&l.closePath(),l.moveTo(q,de),y=!0}function ae(){var q;q=f.length%2!==0,q&&!v&&(Y=f.shift()+A),p+=f.length>>1,f.length=0,v=!0}function ee(q){for(var de,Se,xe,ke,Ae,se,ye,Ce,ue,ge,Oe,He,be=0;be<q.length;){var Re=q[be];switch(be+=1,Re){case 1:ae();break;case 3:ae();break;case 4:f.length>1&&!v&&(Y=f.shift()+A,v=!0),S+=f.pop(),V(m,S);break;case 5:for(;f.length>0;)m+=f.shift(),S+=f.shift(),l.lineTo(m,S);break;case 6:for(;f.length>0&&(m+=f.shift(),l.lineTo(m,S),f.length!==0);)S+=f.shift(),l.lineTo(m,S);break;case 7:for(;f.length>0&&(S+=f.shift(),l.lineTo(m,S),f.length!==0);)m+=f.shift(),l.lineTo(m,S);break;case 8:for(;f.length>0;)n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+f.shift(),l.curveTo(n,o,i,u,m,S);break;case 10:Ae=f.pop()+x,se=T[Ae],se&&ee(se);break;case 11:return;case 12:switch(Re=q[be],be+=1,Re){case 35:n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),ye=i+f.shift(),Ce=u+f.shift(),ue=ye+f.shift(),ge=Ce+f.shift(),Oe=ue+f.shift(),He=ge+f.shift(),m=Oe+f.shift(),S=He+f.shift(),f.shift(),l.curveTo(n,o,i,u,ye,Ce),l.curveTo(ue,ge,Oe,He,m,S);break;case 34:n=m+f.shift(),o=S,i=n+f.shift(),u=o+f.shift(),ye=i+f.shift(),Ce=u,ue=ye+f.shift(),ge=u,Oe=ue+f.shift(),He=S,m=Oe+f.shift(),l.curveTo(n,o,i,u,ye,Ce),l.curveTo(ue,ge,Oe,He,m,S);break;case 36:n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),ye=i+f.shift(),Ce=u,ue=ye+f.shift(),ge=u,Oe=ue+f.shift(),He=ge+f.shift(),m=Oe+f.shift(),l.curveTo(n,o,i,u,ye,Ce),l.curveTo(ue,ge,Oe,He,m,S);break;case 37:n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),ye=i+f.shift(),Ce=u+f.shift(),ue=ye+f.shift(),ge=Ce+f.shift(),Oe=ue+f.shift(),He=ge+f.shift(),Math.abs(Oe-m)>Math.abs(He-S)?m=Oe+f.shift():S=He+f.shift(),l.curveTo(n,o,i,u,ye,Ce),l.curveTo(ue,ge,Oe,He,m,S);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+Re),f.length=0}break;case 14:f.length>0&&!v&&(Y=f.shift()+A,v=!0),y&&(l.closePath(),y=!1);break;case 18:ae();break;case 19:case 20:ae(),be+=p+7>>3;break;case 21:f.length>2&&!v&&(Y=f.shift()+A,v=!0),S+=f.pop(),m+=f.pop(),V(m,S);break;case 22:f.length>1&&!v&&(Y=f.shift()+A,v=!0),m+=f.pop(),V(m,S);break;case 23:ae();break;case 24:for(;f.length>2;)n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+f.shift(),l.curveTo(n,o,i,u,m,S);m+=f.shift(),S+=f.shift(),l.lineTo(m,S);break;case 25:for(;f.length>6;)m+=f.shift(),S+=f.shift(),l.lineTo(m,S);n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+f.shift(),l.curveTo(n,o,i,u,m,S);break;case 26:for(f.length%2&&(m+=f.shift());f.length>0;)n=m,o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i,S=u+f.shift(),l.curveTo(n,o,i,u,m,S);break;case 27:for(f.length%2&&(S+=f.shift());f.length>0;)n=m+f.shift(),o=S,i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u,l.curveTo(n,o,i,u,m,S);break;case 28:de=q[be],Se=q[be+1],f.push((de<<24|Se<<16)>>16),be+=2;break;case 29:Ae=f.pop()+t.gsubrsBias,se=t.gsubrs[Ae],se&&ee(se);break;case 30:for(;f.length>0&&(n=m,o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,S),f.length!==0);)n=m+f.shift(),o=S,i=n+f.shift(),u=o+f.shift(),S=u+f.shift(),m=i+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,S);break;case 31:for(;f.length>0&&(n=m+f.shift(),o=S,i=n+f.shift(),u=o+f.shift(),S=u+f.shift(),m=i+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,S),f.length!==0);)n=m,o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,S);break;default:Re<32?console.log("Glyph "+e.index+": unknown operator "+Re):Re<247?f.push(Re-139):Re<251?(de=q[be],be+=1,f.push((Re-247)*256+de+108)):Re<255?(de=q[be],be+=1,f.push(-(Re-251)*256-de-108)):(de=q[be],Se=q[be+1],xe=q[be+2],ke=q[be+3],be+=4,f.push((de<<24|Se<<16|xe<<8|ke)/65536))}}}return ee(r),e.advanceWidth=Y,l}function Pp(t,e,r,n){var o=[],i,u=new J.Parser(t,e),l=u.parseCard8();if(l===0)for(var f=0;f<r;f++){if(i=u.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(l===3){var p=u.parseCard16(),v=u.parseCard16();if(v!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+v);for(var y,m=0;m<p;m++){if(i=u.parseCard8(),y=u.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(y>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+y);for(;v<y;v++)o.push(i);v=y}if(y!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+y)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return o}function kp(t,e,r,n){r.tables.cff={};var o=Tp(t,e),i=Zt(t,o.endOffset,J.bytesToString),u=Zt(t,i.endOffset),l=Zt(t,u.endOffset,J.bytesToString),f=Zt(t,l.endOffset);r.gsubrs=f.objects,r.gsubrsBias=wi(r.gsubrs);var p=Va(t,e,u.objects,l.objects);if(p.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+p.length);var v=p[0];if(r.tables.cff.topDict=v,v._privateDict&&(r.defaultWidthX=v._privateDict.defaultWidthX,r.nominalWidthX=v._privateDict.nominalWidthX),v.ros[0]!==void 0&&v.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var y=v.fdArray,m=v.fdSelect;if(y===0||m===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");y+=e;var S=Zt(t,y),T=Va(t,e,S.objects,l.objects);v._fdArray=T,m+=e,v._fdSelect=Pp(t,m,r.numGlyphs,T.length)}var x=e+v.private[1],C=uu(t,x,v.private[0],l.objects);if(r.defaultWidthX=C.defaultWidthX,r.nominalWidthX=C.nominalWidthX,C.subrs!==0){var A=x+C.subrs,L=Zt(t,A);r.subrs=L.objects,r.subrsBias=wi(r.subrs)}else r.subrs=[],r.subrsBias=0;var F;n.lowMemory?(F=yp(t,e+v.charStrings),r.nGlyphs=F.offsets.length):(F=Zt(t,e+v.charStrings),r.nGlyphs=F.objects.length);var Y=xp(t,e+v.charset,r.nGlyphs,l.objects);if(v.encoding===0?r.cffEncoding=new mo(fp,Y):v.encoding===1?r.cffEncoding=new mo(hp,Y):r.cffEncoding=Cp(t,e+v.encoding,Y),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Ct.GlyphSet(r),n.lowMemory)r._push=function(ee){var q=wp(ee,F.offsets,t,e+v.charStrings);r.glyphs.push(ee,Ct.cffGlyphLoader(r,ee,za,q))};else for(var V=0;V<r.nGlyphs;V+=1){var ae=F.objects[V];r.glyphs.push(V,Ct.cffGlyphLoader(r,V,za,ae))}}function lu(t,e){var r,n=Kn.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Kn.length:(r=Kn.length+e.length,e.push(t)),r}function Ap(){return new W.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Op(t){var e=new W.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function cu(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],u=e[i.name];u!==void 0&&!nu(u,i.value)&&(i.type==="SID"&&(u=lu(u,r)),n[i.op]={name:i.name,type:i.type,value:u})}return n}function Wa(t,e){var r=new W.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=cu(au,t,e),r}function $a(t){var e=new W.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function Rp(t){var e=new W.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function Dp(){return new W.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Mp(t,e){for(var r=new W.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=lu(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function Fp(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var u=void 0,l=void 0,f=r.commands[i];if(f.type==="Q"){var p=.3333333333333333,v=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(p*n+v*f.x1),y1:Math.round(p*o+v*f.y1),x2:Math.round(p*f.x+v*f.x1),y2:Math.round(p*f.y+v*f.y1)}}if(f.type==="M")u=Math.round(f.x-n),l=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="L")u=Math.round(f.x-n),l=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="C"){var y=Math.round(f.x1-n),m=Math.round(f.y1-o),S=Math.round(f.x2-f.x1),T=Math.round(f.y2-f.y1);u=Math.round(f.x-f.x2),l=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:y}),e.push({name:"dy1",type:"NUMBER",value:m}),e.push({name:"dx2",type:"NUMBER",value:S}),e.push({name:"dy2",type:"NUMBER",value:T}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(f.x),o=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function Lp(t){for(var e=new W.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=Fp(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function Bp(t,e){var r=new W.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=cu(su,t,e),r}function Up(t,e){for(var r=new W.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},u=[],l,f=1;f<t.length;f+=1)l=t.get(f),u.push(l.name);var p=[];r.header=Ap(),r.nameIndex=Op([e.postScriptName]);var v=Wa(o,p);r.topDictIndex=$a(v),r.globalSubrIndex=Dp(),r.charsets=Mp(u,p),r.charStringsIndex=Lp(t),r.privateDict=Bp(i,p),r.stringIndex=Rp(p);var y=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=y,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),v=Wa(o,p),r.topDictIndex=$a(v),r}var Ip={parse:kp,make:Up};function Gp(t,e){var r={},n=new J.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),j.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function Np(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new W.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var Hp={parse:Gp,make:Np};function Vp(t,e){var r={},n=new J.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function zp(t){return new W.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var Wp={parse:Vp,make:zp};function $p(t,e,r,n,o){for(var i,u,l=new J.Parser(t,e),f=0;f<n;f+=1){f<r&&(i=l.parseUShort(),u=l.parseShort());var p=o.get(f);p.advanceWidth=i,p.leftSideBearing=u}}function Xp(t,e,r,n,o){t._hmtxTableData={};for(var i,u,l=new J.Parser(e,r),f=0;f<o;f+=1)f<n&&(i=l.parseUShort(),u=l.parseShort()),t._hmtxTableData[f]={advanceWidth:i,leftSideBearing:u}}function Yp(t,e,r,n,o,i,u){u.lowMemory?Xp(t,e,r,n,o):$p(e,r,n,o,i)}function Zp(t){for(var e=new W.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var jp={parse:Yp,make:Zp};function qp(t){for(var e=new W.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function Kp(t,e){var r=new J.Parser(t,e),n=r.parseULong();j.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],u=0;u<o;u++){for(var l="",f=e+r.parseUShort(),p=r.parseUShort(),v=f;v<f+p;++v)l+=String.fromCharCode(t.getInt8(v));i.push(l)}return i}var Qp={make:qp,parse:Kp};function Jp(t,e){var r={},n=new J.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function ed(t){return new W.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var td={parse:Jp,make:ed},fu=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],hu={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},rd={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},pu={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function nd(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return hu[e];case 3:return pu[e]}}var bi="utf-16",od={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},id={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function du(t,e,r){switch(t){case 0:return bi;case 1:return id[r]||od[e];case 3:if(e===1||e===10)return bi;break}}function ad(t,e,r){for(var n={},o=new J.Parser(t,e),i=o.parseUShort(),u=o.parseUShort(),l=o.offset+o.parseUShort(),f=0;f<u;f++){var p=o.parseUShort(),v=o.parseUShort(),y=o.parseUShort(),m=o.parseUShort(),S=fu[m]||m,T=o.parseUShort(),x=o.parseUShort(),C=nd(p,y,r),A=du(p,v,y);if(A!==void 0&&C!==void 0){var L=void 0;if(A===bi?L=Mr.UTF16(t,l+x,T):L=Mr.MACSTRING(t,l+x,T,A),L){var F=n[S];F===void 0&&(F=n[S]={}),F[C]=L}}}return i===1&&o.parseUShort(),n}function Jo(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function Xa(t,e,r,n,o,i){return new W.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function sd(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function Ya(t,e){var r=sd(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function ud(t,e){var r,n=[],o={},i=Jo(fu);for(var u in t){var l=i[u];if(l===void 0&&(l=u),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');o[r]=t[u],n.push(r)}for(var f=Jo(hu),p=Jo(pu),v=[],y=[],m=0;m<n.length;m++){r=n[m];var S=o[r];for(var T in S){var x=S[T],C=1,A=f[T],L=rd[A],F=du(C,L,A),Y=H.MACSTRING(x,F);Y===void 0&&(C=0,A=e.indexOf(T),A<0&&(A=e.length,e.push(T)),L=4,Y=H.UTF16(x));var V=Ya(Y,y);v.push(Xa(C,L,A,r,Y.length,V));var ae=p[T];if(ae!==void 0){var ee=H.UTF16(x),q=Ya(ee,y);v.push(Xa(3,1,ae,r,ee.length,q))}}}v.sort(function(xe,ke){return xe.platformID-ke.platformID||xe.encodingID-ke.encodingID||xe.languageID-ke.languageID||xe.nameID-ke.nameID});for(var de=new W.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:v.length},{name:"stringOffset",type:"USHORT",value:6+v.length*12}]),Se=0;Se<v.length;Se++)de.fields.push({name:"record_"+Se,type:"RECORD",value:v[Se]});return de.fields.push({name:"strings",type:"LITERAL",value:y}),de}var ld={parse:ad,make:ud},_i=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function cd(t){for(var e=0;e<_i.length;e+=1){var r=_i[e];if(t>=r.begin&&t<r.end)return e}return-1}function fd(t,e){var r={},n=new J.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function hd(t){return new W.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var Za={parse:fd,make:hd,unicodeRanges:_i,getUnicodeRange:cd};function pd(t,e){var r={},n=new J.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Ha.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=Ha.length){var u=n.parseChar();r.names.push(n.parseString(u))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function dd(){return new W.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var vd={parse:pd,make:dd},vt=new Array(9);vt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(P.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(P.coverage),substitute:this.parseOffset16List()};j.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};vt[2]=function(){var e=this.parseUShort();return j.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),sequences:this.parseListOfLists()}};vt[3]=function(){var e=this.parseUShort();return j.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),alternateSets:this.parseListOfLists()}};vt[4]=function(){var e=this.parseUShort();return j.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Pr={sequenceIndex:P.uShort,lookupListIndex:P.uShort};vt[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(P.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(u,Pr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(P.coverage),classDef:this.parsePointer(P.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(u,Pr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,P.pointer(P.coverage)),lookupRecords:this.parseRecordList(o,Pr)}}j.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};vt[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(P.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Pr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(P.coverage),backtrackClassDef:this.parsePointer(P.classDef),inputClassDef:this.parsePointer(P.classDef),lookaheadClassDef:this.parsePointer(P.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Pr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(P.pointer(P.coverage)),inputCoverage:this.parseList(P.pointer(P.coverage)),lookaheadCoverage:this.parseList(P.pointer(P.coverage)),lookupRecords:this.parseRecordList(Pr)};j.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};vt[7]=function(){var e=this.parseUShort();j.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new P(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:vt[r].call(n)}};vt[8]=function(){var e=this.parseUShort();return j.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(P.coverage),backtrackCoverage:this.parseList(P.pointer(P.coverage)),lookaheadCoverage:this.parseList(P.pointer(P.coverage)),substitutes:this.parseUShortList()}};function gd(t,e){e=e||0;var r=new P(t,e),n=r.parseVersion(1);return j.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(vt)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(vt),variations:r.parseFeatureVariationsList()}}var Lr=new Array(9);Lr[1]=function(e){return e.substFormat===1?new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.ushortList("substitute",e.substitute)))};Lr[2]=function(e){return j.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.tableList("seqSet",e.sequences,function(r){return new W.Table("sequenceSetTable",W.ushortList("sequence",r))})))};Lr[3]=function(e){return j.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.tableList("altSet",e.alternateSets,function(r){return new W.Table("alternateSetTable",W.ushortList("alternate",r))})))};Lr[4]=function(e){return j.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new W.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.tableList("ligSet",e.ligatureSets,function(r){return new W.Table("ligatureSetTable",W.tableList("ligature",r,function(n){return new W.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(W.ushortList("component",n.components,n.components.length+1)))}))})))};Lr[6]=function(e){if(e.substFormat===1){var r=new W.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new W.Coverage(e.coverage)}].concat(W.tableList("chainRuleSet",e.chainRuleSets,function(i){return new W.Table("chainRuleSetTable",W.tableList("chainRule",i,function(u){var l=W.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(W.ushortList("inputGlyph",u.input,u.input.length+1)).concat(W.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(W.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(f,p){l=l.concat({name:"sequenceIndex"+p,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+p,type:"USHORT",value:f.lookupListIndex})}),new W.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)j.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,u){n.push({name:"backtrackCoverage"+u,type:"TABLE",value:new W.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,u){n.push({name:"inputCoverage"+u,type:"TABLE",value:new W.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,u){n.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new W.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,u){n=n.concat({name:"sequenceIndex"+u,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:i.lookupListIndex})});var o=new W.Table("chainContextTable",n);return o}j.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function md(t){return new W.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new W.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new W.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new W.LookupList(t.lookups,Lr)}])}var yd={parse:gd,make:md};function wd(t,e){var r=new J.Parser(t,e),n=r.parseULong();j.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},u=0;u<o;u++){var l=r.parseTag(),f=r.parseULong(),p=r.parseULong(),v=Mr.UTF8(t,e+f,p);i[l]=v}return i}function bd(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new W.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var u=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+u}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var _d={parse:wd,make:bd};function ja(t){return Math.log(t)/Math.log(2)|0}function Bi(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function qa(t,e,r,n){return new W.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function vu(t){var e=new W.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,ja(e.numTables));e.searchRange=16*r,e.entrySelector=ja(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+qa().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<t.length;u+=1){var l=t[u];j.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var f=l.sizeOf(),p=qa(l.tableName,Bi(l.encode()),i,f);for(n.push({name:p.tag+" Table Record",type:"RECORD",value:p}),o.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=f,j.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(v,y){return v.value.tag>y.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function Ka(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function Sd(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function Td(t){for(var e=[],r=[],n=[],o=[],i=[],u=[],l=[],f,p=0,v=0,y=0,m=0,S=0,T=0;T<t.glyphs.length;T+=1){var x=t.glyphs.get(T),C=x.unicode|0;if(isNaN(x.advanceWidth))throw new Error("Glyph "+x.name+" ("+T+"): advanceWidth is not a number.");(f>C||f===void 0)&&C>0&&(f=C),p<C&&(p=C);var A=Za.getUnicodeRange(C);if(A<32)v|=1<<A;else if(A<64)y|=1<<A-32;else if(A<96)m|=1<<A-64;else if(A<123)S|=1<<A-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(x.name!==".notdef"){var L=x.getMetrics();e.push(L.xMin),r.push(L.yMin),n.push(L.xMax),o.push(L.yMax),u.push(L.leftSideBearing),l.push(L.rightSideBearing),i.push(x.advanceWidth)}}var F={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:Sd(i),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,l)};F.ascender=t.ascender,F.descender=t.descender;var Y=Hp.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:F.xMin,yMin:F.yMin,xMax:F.xMax,yMax:F.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),V=Wp.make({ascender:F.ascender,descender:F.descender,advanceWidthMax:F.advanceWidthMax,minLeftSideBearing:F.minLeftSideBearing,minRightSideBearing:F.minRightSideBearing,xMaxExtent:F.maxLeftSideBearing+(F.xMax-F.xMin),numberOfHMetrics:t.glyphs.length}),ae=td.make(t.glyphs.length),ee=Za.make(Object.assign({xAvgCharWidth:Math.round(F.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:p,ulUnicodeRange1:v,ulUnicodeRange2:y,ulUnicodeRange3:m,ulUnicodeRange4:S,sTypoAscender:F.ascender,sTypoDescender:F.descender,sTypoLineGap:0,usWinAscent:F.yMax,usWinDescent:Math.abs(F.yMin),ulCodePageRange1:1,sxHeight:Ka(t,"xyvw",{yMax:Math.round(F.ascender/2)}).yMax,sCapHeight:Ka(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",F).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),q=jp.make(t.glyphs),de=cp.make(t.glyphs),Se=t.getEnglishName("fontFamily"),xe=t.getEnglishName("fontSubfamily"),ke=Se+" "+xe,Ae=t.getEnglishName("postScriptName");Ae||(Ae=Se.replace(/\s/g,"")+"-"+xe);var se={};for(var ye in t.names)se[ye]=t.names[ye];se.uniqueID||(se.uniqueID={en:t.getEnglishName("manufacturer")+":"+ke}),se.postScriptName||(se.postScriptName={en:Ae}),se.preferredFamily||(se.preferredFamily=t.names.fontFamily),se.preferredSubfamily||(se.preferredSubfamily=t.names.fontSubfamily);var Ce=[],ue=ld.make(se,Ce),ge=Ce.length>0?Qp.make(Ce):void 0,Oe=vd.make(),He=Ip.make(t.glyphs,{version:t.getEnglishName("version"),fullName:ke,familyName:Se,weightName:xe,postScriptName:Ae,unitsPerEm:t.unitsPerEm,fontBBox:[0,F.yMin,F.ascender,F.advanceWidthMax]}),be=t.metas&&Object.keys(t.metas).length>0?_d.make(t.metas):void 0,Re=[Y,V,ae,ee,ue,de,Oe,He,q];ge&&Re.push(ge),t.tables.gsub&&Re.push(yd.make(t.tables.gsub)),be&&Re.push(be);for(var Pt=vu(Re),et=Pt.encode(),Ke=Bi(et),lt=Pt.fields,mr=!1,ct=0;ct<lt.length;ct+=1)if(lt[ct].name==="head table"){lt[ct].value.checkSumAdjustment=2981146554-Ke,mr=!0;break}if(!mr)throw new Error("Could not find head table with checkSum to adjust.");return Pt}var Ed={make:vu,fontToTable:Td,computeCheckSum:Bi};function ei(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function Qa(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function Ja(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var u=r.start;if(u===e)return r;u<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function pn(t,e){this.font=t,this.tableName=e}pn.prototype={searchTag:ei,binSearch:Qa,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=ei(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=ei(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,u=o.featureIndexes,l=this.font.tables[this.tableName].features,f=0;f<u.length;f++)if(i=l[u[f]],i.tag===r)return i.feature;if(n){var p=l.length;return j.assert(p===0||r>=l[p-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(i),u.push(p),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),u=[];if(i){for(var l,f=i.lookupListIndexes,p=this.font.tables[this.tableName].lookups,v=0;v<f.length;v++)l=p[f[v]],l.lookupType===n&&u.push(l);if(u.length===0&&o){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var y=p.length;return p.push(l),f.push(y),[l]}}return u},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=Ja(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=Qa(t.glyphs,e);return r>=0?r:-1;case 2:var n=Ja(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,u=o.end,l=i;l<=u;l++)e.push(l);return e}};function dn(t){pn.call(this,t,"gpos")}dn.prototype=pn.prototype;dn.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};dn.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var u=o[i],l=this.getCoverageIndex(u.coverage,e);if(!(l<0))switch(u.posFormat){case 1:for(var f=u.pairSets[l],p=0;p<f.length;p++){var v=f[p];if(v.secondGlyph===r)return v.value1&&v.value1.xAdvance||0}break;case 2:var y=this.getGlyphClass(u.classDef1,e),m=this.getGlyphClass(u.classDef2,r),S=u.classRecords[y][m];return S.value1&&S.value1.xAdvance||0}}return 0};dn.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function ot(t){pn.call(this,t,"gsub")}function xd(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Ui(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}ot.prototype=pn.prototype;ot.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};ot.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++){var f=u[l],p=this.expandCoverage(f.coverage),v=void 0;if(f.substFormat===1){var y=f.deltaGlyphId;for(v=0;v<p.length;v++){var m=p[v];n.push({sub:m,by:m+y})}}else{var S=f.substitute;for(v=0;v<p.length;v++)n.push({sub:p[v],by:S[v]})}}return n};ot.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++){var f=u[l],p=this.expandCoverage(f.coverage),v=void 0;for(v=0;v<p.length;v++){var y=p[v],m=f.sequences[v];n.push({sub:y,by:m})}}return n};ot.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++)for(var f=u[l],p=this.expandCoverage(f.coverage),v=f.alternateSets,y=0;y<p.length;y++)n.push({sub:p[y],by:v[y]});return n};ot.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++)for(var f=u[l],p=this.expandCoverage(f.coverage),v=f.ligatureSets,y=0;y<p.length;y++)for(var m=p[y],S=v[y],T=0;T<S.length;T++){var x=S[T];n.push({sub:[m].concat(x.components),by:x.ligGlyph})}return n};ot.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=Ui(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});j.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.substitute.splice(l,0,0)),i.substitute[l]=e.by};ot.prototype.addMultiple=function(t,e,r,n){j.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=Ui(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});j.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.sequences.splice(l,0,0)),i.sequences[l]=e.by};ot.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=Ui(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});j.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by};ot.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),j.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var u=e.sub[0],l=e.sub.slice(1),f={ligGlyph:e.by,components:l},p=this.binSearch(i.coverage.glyphs,u);if(p>=0){for(var v=i.ligatureSets[p],y=0;y<v.length;y++)if(xd(v[y].components,l))return;v.push(f)}else p=-1-p,i.coverage.glyphs.splice(p,0,u),i.ligatureSets.splice(p,0,[f])};ot.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};ot.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function Cd(){return typeof window<"u"}function Pd(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Wr(t,e){if(!t)throw e}function es(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),e&o||(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function gu(t,e,r){var n=new J.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var u=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)u.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var f=0;f<t.instructionLength;f+=1)t.instructions.push(n.parseByte());var p=u[u.length-1]+1;o=[];for(var v=0;v<p;v+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var y=n.parseByte(),m=0;m<y;m+=1)o.push(i),v+=1;if(j.argument(o.length===p,"Bad flags."),u.length>0){var S=[],T;if(p>0){for(var x=0;x<p;x+=1)i=o[x],T={},T.onCurve=!!(i&1),T.lastPointOfContour=u.indexOf(x)>=0,S.push(T);for(var C=0,A=0;A<p;A+=1)i=o[A],T=S[A],T.x=es(n,i,C,2,16),C=T.x;for(var L=0,F=0;F<p;F+=1)i=o[F],T=S[F],T.y=es(n,i,L,4,32),L=T.y}t.points=S}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var Y=!0;Y;){o=n.parseUShort();var V={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(V.dx=n.parseShort(),V.dy=n.parseShort()):V.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(V.dx=n.parseChar(),V.dy=n.parseChar()):V.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?V.xScale=V.yScale=n.parseF2Dot14():(o&64)>0?(V.xScale=n.parseF2Dot14(),V.yScale=n.parseF2Dot14()):(o&128)>0&&(V.xScale=n.parseF2Dot14(),V.scale01=n.parseF2Dot14(),V.scale10=n.parseF2Dot14(),V.yScale=n.parseF2Dot14()),t.components.push(V),Y=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var ae=0;ae<t.instructionLength;ae+=1)t.instructions.push(n.parseByte())}}}function ti(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function kd(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return j.argument(r.length===0,"There are still points left in the current contour."),e}function mu(t){var e=new ze;if(!t)return e;for(var r=kd(t),n=0;n<r.length;++n){var o=r[n],i=null,u=o[o.length-1],l=o[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var f={x:(u.x+l.x)*.5,y:(u.y+l.y)*.5};e.moveTo(f.x,f.y)}for(var p=0;p<o.length;++p)if(i=u,u=l,l=o[(p+1)%o.length],u.onCurve)e.lineTo(u.x,u.y);else{var v=l;i.onCurve||((u.x+i.x)*.5,(u.y+i.y)*.5),l.onCurve||(v={x:(u.x+l.x)*.5,y:(u.y+l.y)*.5}),e.quadraticCurveTo(u.x,u.y,v.x,v.y)}e.closePath()}return e}function yu(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=ti(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[n.matchedPoints[0]],l=o.points[n.matchedPoints[1]],f={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=ti([l],f)[0],f.dx=u.x-l.x,f.dy=u.y-l.y,i=ti(o.points,f)}e.points=e.points.concat(i)}}return mu(e.points)}function Ad(t,e,r,n){for(var o=new Ct.GlyphSet(n),i=0;i<r.length-1;i+=1){var u=r[i],l=r[i+1];u!==l?o.push(i,Ct.ttfGlyphLoader(n,i,gu,t,e+u,yu)):o.push(i,Ct.glyphLoader(n,i))}return o}function Od(t,e,r,n){var o=new Ct.GlyphSet(n);return n._push=function(i){var u=r[i],l=r[i+1];u!==l?o.push(i,Ct.ttfGlyphLoader(n,i,gu,t,e+u,yu)):o.push(i,Ct.glyphLoader(n,i))},o}function Rd(t,e,r,n,o){return o.lowMemory?Od(t,e,r,n):Ad(t,e,r,n)}var Dd={getPath:mu,parse:Rd},wu,vr,bu,Si;function _u(t){this.font=t,this.getCommands=function(e){return Dd.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Md(t){return t}function Su(t){return Math.sign(t)*Math.round(Math.abs(t))}function Fd(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function Ld(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function Bd(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Ud(t){return Math.sign(t)*Math.floor(Math.abs(t))}var Tu=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},xt={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,u,l,f,p,v;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,f=e.x-e.xo,p=r.x-r.xo,u=Math.abs(o),l=Math.abs(i),v=u+l,v===0){t.x=t.xo+(f+p)/2;return}t.x=t.xo+(f*l+p*u)/v;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),l=Math.abs(i),v=u+l,v===0){xt.setRelative(t,t,(f+p)/2,n,!0);return}xt.setRelative(t,t,(f*l+p*u)/v,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y;t.x=l+(t.y-f)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},Ut={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,u,l,f,p,v;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,f=e.y-e.yo,p=r.y-r.yo,u=Math.abs(o),l=Math.abs(i),v=u+l,v===0){t.y=t.yo+(f+p)/2;return}t.y=t.yo+(f*l+p*u)/v;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),l=Math.abs(i),v=u+l,v===0){Ut.setRelative(t,t,(f+p)/2,n,!0);return}Ut.setRelative(t,t,(f*l+p*u)/v,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y;t.y=f+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(xt);Object.freeze(Ut);function vn(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}vn.prototype.distance=function(t,e,r,n){return this.x*xt.distance(t,e,r,n)+this.y*Ut.distance(t,e,r,n)};vn.prototype.interpolate=function(t,e,r,n){var o,i,u,l,f,p,v;if(u=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),f=Math.abs(u),p=Math.abs(l),v=f+p,v===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*p+i*f)/v,n,!0)};vn.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y,p=n.normalSlope,v=this.slope,y=t.x,m=t.y;t.x=(v*y-p*l+f-m)/(v-p),t.y=v*(t.x-y)+m};vn.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function gn(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?xt:t===0&&e===1?Ut:new vn(t,e)}function It(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}It.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};It.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var an=Object.freeze(new It(0,0)),Id={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Kt(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=xt,this.round=Su}}_u.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){Kt.prototype=Id,o=this._fpgmState=new Kt("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,O.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{vr(o)}catch(p){console.log("Hinting error in FPGM:"+p),this._errorState=3;return}}Kt.prototype=o,n=this._prepState=new Kt("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var u=n.cvt=new Array(i.length),l=e/r.unitsPerEm,f=0;f<i.length;f++)u[f]=i[f]*l;else n.cvt=[];O.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{vr(n)}catch(p){this._errorState<2&&console.log("Hinting error in PREP:"+p),this._errorState=2}}if(!(this._errorState>1))try{return bu(t,n)}catch(p){this._errorState<1&&(console.log("Hinting error:"+p),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};bu=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,u,l;if(Kt.prototype=e,!o)l=new Kt("glyf",t.instructions),O.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),Si(t,l,r,n),u=l.gZone;else{var f=e.font;u=[],i=[];for(var p=0;p<o.length;p++){var v=o[p],y=f.glyphs.get(v.glyphIndex);l=new Kt("glyf",y.instructions),O.DEBUG&&(console.log("---EXEC COMP "+p+"---"),l.step=-1),Si(y,l,r,n);for(var m=Math.round(v.dx*r),S=Math.round(v.dy*n),T=l.gZone,x=l.contours,C=0;C<T.length;C++){var A=T[C];A.xTouched=A.yTouched=!1,A.xo=A.x=A.x+m,A.yo=A.y=A.y+S}var L=u.length;u.push.apply(u,T);for(var F=0;F<x.length;F++)i.push(x[F]+L)}t.instructions&&!l.inhibitGridFit&&(l=new Kt("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=u,l.contours=i,u.push(new It(0,0),new It(Math.round(t.advanceWidth*r),0)),O.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),vr(l),u.length-=2)}return u};Si=function(t,e,r,n){for(var o=t.points||[],i=o.length,u=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],f,p=0;p<i;p++)f=o[p],u[p]=new It(f.x*r,f.y*n,f.lastPointOfContour,f.onCurve);for(var v,y,m=0;m<i;m++)f=u[m],v||(v=f,l.push(m)),f.lastPointOfContour?(f.nextPointOnContour=v,v.prevPointOnContour=f,v=void 0):(y=u[m+1],f.nextPointOnContour=y,y.prevPointOnContour=f);if(!e.inhibitGridFit){if(O.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var S=0;S<i;S++)console.log(S,u[S].x,u[S].y)}if(u.push(new It(0,0),new It(Math.round(t.advanceWidth*r),0)),vr(e),u.length-=2,O.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var T=0;T<i;T++)console.log(T,u[T].x,u[T].y)}}};vr=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(O.DEBUG&&t.step++,n=wu[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function Co(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new It(0,0)}function Eu(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function ts(t,e){O.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function rs(t,e){O.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function ns(t,e){O.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function os(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];O.DEBUG&&console.log("SPVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.pv=e.dpv=gn(l,f)}function is(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];O.DEBUG&&console.log("SFVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.fv=gn(l,f)}function Gd(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=gn(n,r)}function Nd(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=gn(n,r)}function Hd(t){var e=t.stack,r=t.pv;O.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Vd(t){var e=t.stack,r=t.fv;O.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function zd(t){t.fv=t.pv,O.DEBUG&&console.log(t.step,"SFVTPV[]")}function Wd(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),u=e.pop(),l=t.z0,f=t.z1,p=l[r],v=l[n],y=f[o],m=f[i],S=t.z2[u];O.DEBUG&&console.log("ISECT[], ",r,n,o,i,u);var T=p.x,x=p.y,C=v.x,A=v.y,L=y.x,F=y.y,Y=m.x,V=m.y,ae=(T-C)*(F-V)-(x-A)*(L-Y),ee=T*A-x*C,q=L*V-F*Y;S.x=(ee*(L-Y)-q*(T-C))/ae,S.y=(ee*(F-V)-q*(x-A))/ae}function $d(t){t.rp0=t.stack.pop(),O.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Xd(t){t.rp1=t.stack.pop(),O.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Yd(t){t.rp2=t.stack.pop(),O.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Zd(t){var e=t.stack.pop();switch(O.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||Co(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function jd(t){var e=t.stack.pop();switch(O.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||Co(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function qd(t){var e=t.stack.pop();switch(O.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||Co(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Kd(t){var e=t.stack.pop();switch(O.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||Co(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Qd(t){t.loop=t.stack.pop(),O.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Jd(t){O.DEBUG&&console.log(t.step,"RTG[]"),t.round=Su}function ev(t){O.DEBUG&&console.log(t.step,"RTHG[]"),t.round=Ld}function tv(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function rv(t){O.DEBUG&&console.log(t.step,"ELSE[]"),Eu(t,!1)}function nv(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function ov(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function iv(t){var e=t.stack;O.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function ri(t){O.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function av(t){O.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function sv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function uv(t){var e=t.stack;O.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function lv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var u=0;u<n;u++)vr(t),O.DEBUG&&console.log(++t.step,u+1<n?"next loopcall":"done loopcall",u);t.ip=o,t.prog=i}function cv(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],vr(t),t.ip=r,t.prog=n,O.DEBUG&&console.log(++t.step,"returning from",e)}function fv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function hv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function pv(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(O.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function as(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;O.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var u=i.distance(n,an);t&&(u=e.round(u)),o.setRelative(n,an,u,i),o.touch(n),e.rp0=e.rp1=r}function ss(t,e){var r=e.z2,n=r.length-2,o,i,u;O.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)o=r[l],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(u=o.nextTouched(t),i===u&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,u,t)))}function us(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=e.loop,f=e.z2;l--;){var p=r.pop(),v=f[p],y=u.distance(o,o,!1,!0);i.setRelative(v,v,y,u),i.touch(v),O.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",p)}e.loop=1}function ls(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=r.pop(),f=e.z2[e.contours[l]],p=f;O.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var v=u.distance(o,o,!1,!0);do p!==o&&i.setRelative(p,p,v,u),p=p.nextPointOnContour;while(p!==f)}function cs(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=r.pop();O.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var f;switch(l){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var p,v=u.distance(o,o,!1,!0),y=f.length-2,m=0;m<y;m++)p=f[m],i.setRelative(p,p,v,u)}function dv(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var u=e.pop(),l=i[u];O.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",u,o),n.setRelative(l,l,o),n.touch(l)}t.loop=1}function vv(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],u=t.z1[n],l=t.fv,f=t.dpv,p=t.z2;o--;){var v=e.pop(),y=p[v];O.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",v,r,"<->",n),l.interpolate(y,i,u,f),l.touch(y)}t.loop=1}function fs(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],u=e.z0[e.rp0],l=e.fv,f=e.pv;l.setRelative(i,u,n,f),l.touch(i),O.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function gv(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,u=t.pv,l=t.z1;o--;){var f=e.pop(),p=l[f];O.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",f),i.setRelative(p,n,0,u),i.touch(p)}t.loop=1}function mv(t){O.DEBUG&&console.log(t.step,"RTDG[]"),t.round=Fd}function hs(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],u=e.fv,l=e.pv,f=e.cvt[n];O.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",f,")",o);var p=l.distance(i,an);t&&(Math.abs(p-f)<e.cvCutIn&&(p=f),p=e.round(p)),u.setRelative(i,an,p,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),u.touch(i),e.rp0=e.rp1=o}function yv(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];O.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function wv(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];O.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var u=r[++e]<<8|r[++e];u&32768&&(u=-((u^65535)+1)),n.push(u)}t.ip=e}function bv(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();O.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function _v(t){var e=t.stack,r=t.store,n=e.pop();O.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function Sv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function Tv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function ps(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];O.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,an,t,!1)*64)}function ds(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],u=e.z0[o],l=e.dpv.distance(u,i,t,t);O.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",l),e.stack.push(Math.round(l*64))}function Ev(t){O.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function xv(t){O.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function Cv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function Pv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function kv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function Av(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function Ov(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function Rv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function Dv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function Mv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function Fv(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"IF[]",e),e||(Eu(t,!0),O.DEBUG&&console.log(t.step,"EIF[]"))}function Lv(t){O.DEBUG&&console.log(t.step,"EIF[]")}function Bv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function Uv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function Iv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function ni(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,u=e.ppem,l=e.deltaBase+(t-1)*16,f=e.deltaShift,p=e.z0;O.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var v=0;v<n;v++){var y=r.pop(),m=r.pop(),S=l+((m&240)>>4);if(S===u){var T=(m&15)-8;T>=0&&T++,O.DEBUG&&console.log(e.step,"DELTAPFIX",y,"by",T*f);var x=p[y];o.setRelative(x,x,T*f,i)}}}function Gv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function Nv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function Hv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function Vv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function zv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function Wv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function $v(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function Xv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function Yv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function Zv(t){var e=t.stack,r=e.pop();O.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function $n(t,e){var r=e.stack,n=r.pop();O.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function jv(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function oi(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,u=e.deltaShift;O.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var f=r.pop(),p=r.pop(),v=i+((p&240)>>4);if(v===o){var y=(p&15)-8;y>=0&&y++;var m=y*u;O.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",m),e.cvt[f]+=m}}}function qv(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=Tu;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Kv(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=Tu;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Qv(t){O.DEBUG&&console.log(t.step,"ROFF[]"),t.round=Md}function Jv(t){O.DEBUG&&console.log(t.step,"RUTG[]"),t.round=Bd}function eg(t){O.DEBUG&&console.log(t.step,"RDTG[]"),t.round=Ud}function tg(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function vs(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];O.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.dpv=gn(l,f)}function rg(t){var e=t.stack,r=e.pop(),n=0;O.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function ng(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();O.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function og(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function ig(t){var e=t.stack,r=e.pop(),n=e.pop();O.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function ag(t){var e=t.stack.pop();O.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function sg(t){var e=t.stack.pop(),r=t.stack.pop();switch(O.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Xt(t,e){var r=e.stack,n=e.prog,o=e.ip;O.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function Yt(t,e){var r=e.ip,n=e.prog,o=e.stack;O.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var u=n[++r]<<8|n[++r];u&32768&&(u=-((u^65535)+1)),o.push(u)}e.ip=r}function z(t,e,r,n,o,i){var u=i.stack,l=t&&u.pop(),f=u.pop(),p=i.rp0,v=i.z0[p],y=i.z1[f],m=i.minDis,S=i.fv,T=i.dpv,x,C,A,L;C=x=T.distance(y,v,!0,!0),A=C>=0?1:-1,C=Math.abs(C),t&&(L=i.cvt[l],n&&Math.abs(C-L)<i.cvCutIn&&(C=L)),r&&C<m&&(C=m),n&&(C=i.round(C)),S.setRelative(y,v,A*C,T),S.touch(y),O.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?l+"("+i.cvt[l]+","+L+")":"",f,"(d =",x,"->",A*C,")"),i.rp1=i.rp0,i.rp2=f,e&&(i.rp0=f)}wu=[ts.bind(void 0,Ut),ts.bind(void 0,xt),rs.bind(void 0,Ut),rs.bind(void 0,xt),ns.bind(void 0,Ut),ns.bind(void 0,xt),os.bind(void 0,0),os.bind(void 0,1),is.bind(void 0,0),is.bind(void 0,1),Gd,Nd,Hd,Vd,zd,Wd,$d,Xd,Yd,Zd,jd,qd,Kd,Qd,Jd,ev,tv,rv,nv,ov,void 0,void 0,iv,ri,av,sv,uv,fv,hv,void 0,void 0,void 0,lv,cv,pv,void 0,as.bind(void 0,0),as.bind(void 0,1),ss.bind(void 0,Ut),ss.bind(void 0,xt),us.bind(void 0,0),us.bind(void 0,1),ls.bind(void 0,0),ls.bind(void 0,1),cs.bind(void 0,0),cs.bind(void 0,1),dv,vv,fs.bind(void 0,0),fs.bind(void 0,1),gv,mv,hs.bind(void 0,0),hs.bind(void 0,1),yv,wv,bv,_v,Sv,Tv,ps.bind(void 0,0),ps.bind(void 0,1),void 0,ds.bind(void 0,0),ds.bind(void 0,1),Ev,void 0,xv,void 0,void 0,Cv,Pv,kv,Av,Ov,Rv,Dv,Mv,Fv,Lv,Bv,Uv,Iv,ni.bind(void 0,1),Gv,Nv,Hv,Vv,zv,Wv,$v,Xv,Yv,Zv,$n.bind(void 0,0),$n.bind(void 0,1),$n.bind(void 0,2),$n.bind(void 0,3),void 0,void 0,void 0,void 0,jv,ni.bind(void 0,2),ni.bind(void 0,3),oi.bind(void 0,1),oi.bind(void 0,2),oi.bind(void 0,3),qv,Kv,void 0,void 0,Qv,void 0,Jv,eg,ri,ri,void 0,void 0,void 0,void 0,void 0,tg,vs.bind(void 0,0),vs.bind(void 0,1),rg,void 0,ng,og,ig,ag,sg,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Xt.bind(void 0,1),Xt.bind(void 0,2),Xt.bind(void 0,3),Xt.bind(void 0,4),Xt.bind(void 0,5),Xt.bind(void 0,6),Xt.bind(void 0,7),Xt.bind(void 0,8),Yt.bind(void 0,1),Yt.bind(void 0,2),Yt.bind(void 0,3),Yt.bind(void 0,4),Yt.bind(void 0,5),Yt.bind(void 0,6),Yt.bind(void 0,7),Yt.bind(void 0,8),z.bind(void 0,0,0,0,0,0),z.bind(void 0,0,0,0,0,1),z.bind(void 0,0,0,0,0,2),z.bind(void 0,0,0,0,0,3),z.bind(void 0,0,0,0,1,0),z.bind(void 0,0,0,0,1,1),z.bind(void 0,0,0,0,1,2),z.bind(void 0,0,0,0,1,3),z.bind(void 0,0,0,1,0,0),z.bind(void 0,0,0,1,0,1),z.bind(void 0,0,0,1,0,2),z.bind(void 0,0,0,1,0,3),z.bind(void 0,0,0,1,1,0),z.bind(void 0,0,0,1,1,1),z.bind(void 0,0,0,1,1,2),z.bind(void 0,0,0,1,1,3),z.bind(void 0,0,1,0,0,0),z.bind(void 0,0,1,0,0,1),z.bind(void 0,0,1,0,0,2),z.bind(void 0,0,1,0,0,3),z.bind(void 0,0,1,0,1,0),z.bind(void 0,0,1,0,1,1),z.bind(void 0,0,1,0,1,2),z.bind(void 0,0,1,0,1,3),z.bind(void 0,0,1,1,0,0),z.bind(void 0,0,1,1,0,1),z.bind(void 0,0,1,1,0,2),z.bind(void 0,0,1,1,0,3),z.bind(void 0,0,1,1,1,0),z.bind(void 0,0,1,1,1,1),z.bind(void 0,0,1,1,1,2),z.bind(void 0,0,1,1,1,3),z.bind(void 0,1,0,0,0,0),z.bind(void 0,1,0,0,0,1),z.bind(void 0,1,0,0,0,2),z.bind(void 0,1,0,0,0,3),z.bind(void 0,1,0,0,1,0),z.bind(void 0,1,0,0,1,1),z.bind(void 0,1,0,0,1,2),z.bind(void 0,1,0,0,1,3),z.bind(void 0,1,0,1,0,0),z.bind(void 0,1,0,1,0,1),z.bind(void 0,1,0,1,0,2),z.bind(void 0,1,0,1,0,3),z.bind(void 0,1,0,1,1,0),z.bind(void 0,1,0,1,1,1),z.bind(void 0,1,0,1,1,2),z.bind(void 0,1,0,1,1,3),z.bind(void 0,1,1,0,0,0),z.bind(void 0,1,1,0,0,1),z.bind(void 0,1,1,0,0,2),z.bind(void 0,1,1,0,0,3),z.bind(void 0,1,1,0,1,0),z.bind(void 0,1,1,0,1,1),z.bind(void 0,1,1,0,1,2),z.bind(void 0,1,1,0,1,3),z.bind(void 0,1,1,1,0,0),z.bind(void 0,1,1,1,0,1),z.bind(void 0,1,1,1,0,2),z.bind(void 0,1,1,1,0,3),z.bind(void 0,1,1,1,1,0),z.bind(void 0,1,1,1,1,1),z.bind(void 0,1,1,1,1,2),z.bind(void 0,1,1,1,1,3)];function Br(t){this.char=t,this.state={},this.activeState=null}function Ii(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function ug(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function gt(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Po(t){this.eventId=t,this.subscribers=[]}function lg(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Po(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Be(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],lg.call(this,t)}Br.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};Br.prototype.getState=function(t){return this.state[t]||null};Be.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};Be.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])};Be.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(u){return u instanceof Br});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Be.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Br){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};Be.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};Be.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};Be.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof Br});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};Be.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],u=e===null||e.apply(this,i)===!0,l=[n,o];if(u){var f=r.apply(this,l);n.setState(t,f)}}),this.registeredModifiers.push(t)};Po.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Po.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};gt.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};gt.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};Be.prototype.rangeToText=function(t){if(t instanceof Ii)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};Be.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};Be.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};Be.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};Be.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Po&&n.subscribers.forEach(function(o){o.apply(r,e||[])})};Be.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new ug(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};Be.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};Be.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};Be.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};Be.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new gt(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Be.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new Ii(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n};Be.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new Ii(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),i&&n.checkEnd(t)){var u=r-i.startIndex+1,l=e.setEndOffset(u,o);e.dispatch("contextEnd",[o,l])}})};Be.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new gt(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new Br(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function Qt(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function xu(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function er(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Qn(t){return/[A-z]/.test(t)}function cg(t){return/\s/.test(t)}function it(t){this.font=t,this.features={}}function cr(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function mn(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function fg(t,e){var r=mn(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function hg(t,e){var r=mn(t,e.coverage);return r===-1?null:e.substitute[r]}function ii(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var u=mn(i,o);u!==-1&&r.push(u)}return r.length!==t.length?-1:r}function pg(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=ii(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&er(i[0].char);)i.shift();var u=new gt(i,0),l=ii(e.lookaheadCoverage,u),f=[].concat(t.backtrack);for(f.reverse();f.length&&er(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var p=new gt(f,0),v=ii(e.backtrackCoverage,p),y=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&v.length===e.backtrackCoverage.length,m=[];if(y)for(var S=0;S<e.lookupRecords.length;S++)for(var T=e.lookupRecords[S],x=T.lookupListIndex,C=this.getLookupByIndex(x),A=0;A<C.subtables.length;A++){var L=C.subtables[A],F=this.getLookupMethod(C,L),Y=this.getSubstitutionType(C,L);if(Y==="12")for(var V=0;V<n.length;V++){var ae=t.get(V),ee=F(ae);ee&&m.push(ee)}}return m}function dg(t,e){var r=t.current,n=mn(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],u=0;u<i.length;u++){o=i[u];for(var l=0;l<o.components.length;l++){var f=t.lookahead[l],p=o.components[l];if(f!==p)break;if(l===o.components.length-1)return o}}return null}function vg(t,e){var r=mn(t,e.coverage);return r===-1?null:e.sequences[r]}it.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};it.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var u=0;u<i.length;u++){var l=i[u];if(l.tag===t){var f=l.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};it.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r};it.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};it.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};it.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return fg.apply(r,[o,e])};case"12":return function(o){return hg.apply(r,[o,e])};case"63":return function(o){return pg.apply(r,[o,e])};case"41":return function(o){return dg.apply(r,[o,e])};case"21":return function(o){return vg.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};it.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),u=0;u<o.length;u++)for(var l=o[u],f=this.getLookupSubtables(l),p=0;p<f.length;p++){var v=f[p],y=this.getSubstitutionType(l,v),m=this.getLookupMethod(l,v),S=void 0;switch(y){case"11":S=m(e.current),S&&i.splice(r,1,new cr({id:11,tag:t.tag,substitution:S}));break;case"12":S=m(e.current),S&&i.splice(r,1,new cr({id:12,tag:t.tag,substitution:S}));break;case"63":S=m(e),Array.isArray(S)&&S.length&&i.splice(r,1,new cr({id:63,tag:t.tag,substitution:S}));break;case"41":S=m(e),S&&i.splice(r,1,new cr({id:41,tag:t.tag,substitution:S}));break;case"21":S=m(e.current),S&&i.splice(r,1,new cr({id:21,tag:t.tag,substitution:S}));break}e=new gt(i,r),!(Array.isArray(S)&&!S.length)&&(S=null)}return i.length?i:null};it.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};it.prototype.getLookupSubtables=function(t){return t.subtables||null};it.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};it.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};it.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function gg(t){var e=t.current,r=t.get(-1);return r===null&&Qt(e)||!Qt(r)&&Qt(e)}function mg(t){var e=t.get(1);return e===null||!Qt(e)}var yg={startCheck:gg,endCheck:mg};function wg(t){var e=t.current,r=t.get(-1);return(Qt(e)||er(e))&&!Qt(r)}function bg(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Qt(e)&&!er(e)):var r=cg(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return Qt(o)||er(o)}),!n)return!0}break;default:return!1}}var _g={startCheck:wg,endCheck:bg};function Sg(t,e,r){e[r].setState(t.tag,t.substitution)}function Tg(t,e,r){e[r].setState(t.tag,t.substitution)}function Eg(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function xg(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var gs={11:Sg,12:Tg,63:Eg,41:xg};function Gi(t,e,r){t instanceof cr&&gs[t.id]&&gs[t.id](t,e,r)}function Cg(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=xu(n),i=er(n);if(!o&&!i)return!0;if(o)return!1}return!1}function Pg(t){if(xu(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=er(r);if(!n)return!0}return!1}function kg(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new gt(o.map(function(l){return l.getState("glyphIndex")}),0),u=new gt(o.map(function(l){return l.char}),0);o.forEach(function(l,f){if(!er(l.char)){i.setCurrentIndex(f),u.setCurrentIndex(f);var p=0;Cg(u)&&(p|=1),Pg(u)&&(p|=2);var v;switch(p){case 1:v="fina";break;case 2:v="init";break;case 3:v="medi";break}if(n.indexOf(v)!==-1){var y=e.query.lookupFeature({tag:v,script:r,contextParams:i});if(y instanceof Error)return console.info(y.message);y.forEach(function(m,S){m instanceof cr&&(Gi(m,o,S),i.context[S]=m.substitution)})}}})}}function ms(t,e){var r=t.map(function(n){return n.activeState.value});return new gt(r,e||0)}function Ag(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=ms(n);o.context.forEach(function(i,u){o.setCurrentIndex(u);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});l.length&&(l.forEach(function(f){return Gi(f,n,u)}),o=ms(n))})}function Og(t){var e=t.current,r=t.get(-1);return r===null&&Qn(e)||!Qn(r)&&Qn(e)}function Rg(t){var e=t.get(1);return e===null||!Qn(e)}var Dg={startCheck:Og,endCheck:Rg};function ys(t,e){var r=t.map(function(n){return n.activeState.value});return new gt(r,e||0)}function Mg(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=ys(n);o.context.forEach(function(i,u){o.setCurrentIndex(u);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});l.length&&(l.forEach(function(f){return Gi(f,n,u)}),o=ys(n))})}function yt(t){this.baseDir=t||"ltr",this.tokenizer=new Be,this.featuresTags={}}yt.prototype.setText=function(t){this.text=t};yt.prototype.contextChecks={latinWordCheck:Dg,arabicWordCheck:yg,arabicSentenceCheck:_g};function ai(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function Fg(){return ai.call(this,"latinWord"),ai.call(this,"arabicWord"),ai.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Lg(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}yt.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};yt.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new it(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};yt.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function Ni(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Bg(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Ni.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){kg.call(t,n)})}}function Ug(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){Ni.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){Ag.call(t,o)})}}}function Ig(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){Ni.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){Mg.call(t,o)})}}}yt.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};yt.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Bg.call(this),Ug.call(this)),this.checkContextReady("latinWord")&&Ig.call(this),this.checkContextReady("arabicSentence")&&Lg.call(this)};yt.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),Fg.call(this),this.applyFeaturesToContexts())};yt.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};yt.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function _e(t){t=t||{},t.tables=t.tables||{},t.empty||(Wr(t.familyName,"When creating a new Font object, familyName is required."),Wr(t.styleName,"When creating a new Font object, styleName is required."),Wr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Wr(t.ascender,"When creating a new Font object, ascender is required."),Wr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Ct.GlyphSet(this,t.glyphs||[]),this.encoding=new ru(this),this.position=new dn(this),this.substitution=new ot(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new _u(this)}})}_e.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};_e.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};_e.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};_e.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};_e.prototype.stringToGlyphs=function(t,e){var r=this,n=new yt,o=function(y){return r.charToGlyphIndex(y.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var u=n.getTextGlyphs(t),l=u.length,f=new Array(l),p=this.glyphs.get(0),v=0;v<l;v+=1)f[v]=this.glyphs.get(u[v])||p;return f};_e.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};_e.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};_e.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};_e.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};_e.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};_e.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var u=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,o),f;if(o.kerning){var p=o.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(p,o.language)}for(var v=0;v<l.length;v+=1){var y=l[v];if(i.call(this,y,e,r,n,o),y.advanceWidth&&(e+=y.advanceWidth*u),o.kerning&&v<l.length-1){var m=f?this.position.getKerningValue(f,y.index,l[v+1].index):this.getKerningValue(y,l[v+1]);e+=m*u}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e};_e.prototype.getPath=function(t,e,r,n,o){var i=new ze;return this.forEachGlyph(t,e,r,n,o,function(u,l,f,p){var v=u.getPath(l,f,p,o,this);i.extend(v)}),i};_e.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(u,l,f,p){var v=u.getPath(l,f,p,o,this);i.push(v)}),i};_e.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};_e.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)};_e.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(u,l,f,p){u.drawPoints(t,l,f,p)})};_e.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(u,l,f,p){u.drawMetrics(t,l,f,p)})};_e.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};_e.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};_e.prototype.toTables=function(){return Ed.fontToTable(this)};_e.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};_e.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r};_e.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(Cd())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(i),u.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),u.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),p=Pd(n);f.writeFileSync(t,p)}};_e.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};_e.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};_e.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Nt=new Array(10);Nt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(P.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(P.coverage),values:this.parseValueRecordList()};j.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Nt[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();j.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(P.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(P.pointer(P.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var u=this.parsePointer(P.classDef),l=this.parsePointer(P.classDef),f=this.parseUShort(),p=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:u,classDef2:l,class1Count:f,class2Count:p,classRecords:this.parseList(f,P.list(p,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}};Nt[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Nt[4]=function(){return{error:"GPOS Lookup 4 not supported"}};Nt[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Nt[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Nt[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Nt[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Nt[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const hr=1e-8,xr=(t,e)=>qe(t,e,hr*10);function Gg(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(p=>({offset:fi(p,r),original:p})),o=[];let i=null,u=n.at(-1);if(!u)return[];if(o.length===1)return o;const l=p=>{i?p.offset instanceof Le?o.push(p.offset):xr(p.offset.firstPoint,p.offset.lastPoint)||o.push(cn(p.offset.firstPoint,p.offset.lastPoint)):i=p},f=function*(){for(const p of n.slice(0,-1))yield p;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const p of f()){const v=u.offset.lastPoint,y=p.offset.firstPoint;if(xr(v,y)){l(u),u=p;continue}let m=[];if(u.offset instanceof Le&&p.offset instanceof Le){const{intersections:T,commonSegmentsPoints:x}=ln(u.offset,p.offset,hr/100);m=[...T,...x]}if(m.length>0){let T=m[0];if(m.length>1){const A=u==null?void 0:u.original.lastPoint,L=m.map(F=>Hf(F,A));T=m[L.indexOf(Math.min(...L))]}const x=u.offset.splitAt([T],hr)[0],C=p.offset.splitAt([T],hr).at(-1);if(!C)throw new Error("Bug in the splitting algo in offset");l({offset:x,original:u.original}),u={offset:C,original:p.original};continue}const S=Os(v,y,u.original.lastPoint);l(u),o.push(S),u=p}return l(u),o}function Ng(t,e){const r=Gg(t,e);if(r.length<2)return null;const n=new Map,o=(p,v)=>{const y=n.get(p)||[];n.set(p,[...y,...v])};if(r.forEach((p,v)=>{r.slice(v+1).forEach((y,m)=>{const{intersections:S,commonSegmentsPoints:T}=ln(p,y,hr),x=[...S,...T].filter(C=>{const A=xr(C,p.firstPoint)||xr(C,p.lastPoint),L=xr(C,y.firstPoint)||xr(C,y.lastPoint);return!(A&&L)});x.length&&(o(v,x),o(m+v+1,x))})}),!n.size){const p=new ie(r);return t.intersects(p)?null:p}const u=r.flatMap((p,v)=>{if(!n.has(v))return p;const y=n.get(v)||[];return p.splitAt(y,hr*100)}).filter(p=>!t.curves.find(y=>y.distanceFrom(p)<Math.abs(e)-hr));if(!u.length)return null;const f=rh(u).filter(p=>p.length>1).map(p=>new ie(p)).filter(p=>p.isClosed());return f.length?f.length===1?f[0]:new K(f):null}const ws=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=Bt(e,t[r]);return e};function Jn(t,e){if(t instanceof ie)return Ng(t,e);if(t instanceof K)return ws(t.blueprints.map(r=>Jn(r,e)));if(t instanceof ve){const r=ws(t.blueprints.slice(1).map(n=>Jn(n,e)));return qt(Jn(t.blueprints[0],e),r)}return null}function bs(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],u=(f,p)=>{o({firstCurve:f,secondCurve:p,point:f.lastPoint})?i.push(...t(f,p,r)):i.push(f,p)};e.curves.slice(1).forEach(f=>{const p=i.pop();if(!p)throw new Error("Bug in the blueprint filletting algo");u(p,f)});const l=i.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(qe(i[0].firstPoint,l.lastPoint)&&i.length>1){const f=i.pop(),p=i.shift();if(!f||!p)throw new Error("Bug in the blueprint filletting algo");u(f,p)}return new ie(i)}function Hi(t,e,r,n){if(e instanceof ie)return bs(t,e,r,n);if(e instanceof ve)return new ve(e.blueprints.map(o=>bs(t,o,r,n)));if(e instanceof K){const o=e.blueprints.map(i=>Hi(t,i,r,n)).filter(i=>i!==null);return new K(o)}return null}function Hg(t,e,r){return Hi(hi,t,e,r)}function Vg(t,e,r){return Hi(pi,t,e,r)}function Ti(t,e){return t instanceof ie?new ie(no(t.curves,e)):t instanceof ve?new ve(t.blueprints.map(r=>Ti(r,e))):t instanceof K?new K(t.blueprints.map(r=>Ti(r,e))):t}class Ge{constructor(e=null){this.innerShape=e}clone(){var e;return new Ge(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new un}stretch(e,r,n){return this.innerShape?new Ge(this.innerShape.stretch(e,r,n)):new Ge}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Ge(this.innerShape.rotate(e,r)):new Ge}translate(e,r=0){return this.innerShape?new Ge(this.innerShape.translate(e,r)):new Ge}scale(e,r){return this.innerShape?new Ge(this.innerShape.scale(e,r)):new Ge}mirror(e,r,n){return this.innerShape?new Ge(this.innerShape.mirror(e,r,n)):new Ge}cut(e){return new Ge(qt(this.innerShape,e.innerShape))}fuse(e){return new Ge(Bt(this.innerShape,e.innerShape))}intersect(e){return new Ge(Yr(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new ao);return new Ge(Hg(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new ao);return new Ge(Vg(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Ge(Jn(this.innerShape,e))}approximate(e,r={}){if(e!=="svg")throw new Error("Only 'svg' is supported for now");return new Ge(Ti(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof ie)){if(this.innerShape instanceof K&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof ie)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class zg extends Oh{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Ge(new ie(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}function Wg(t){const e=new zg;return t&&e.movePointerTo(t),e}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cu=Symbol("Comlink.proxy"),$g=Symbol("Comlink.endpoint"),Xg=Symbol("Comlink.releaseProxy"),si=Symbol("Comlink.finalizer"),eo=Symbol("Comlink.thrown"),Pu=t=>typeof t=="object"&&t!==null||typeof t=="function",Yg={canHandle:t=>Pu(t)&&t[Cu],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Vi(t,e),[r,[r]]},deserialize(t){return t.start(),Kg(t)}},Zg={canHandle:t=>Pu(t)&&eo in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},ku=new Map([["proxy",Yg],["throw",Zg]]);function jg(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Vi(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!jg(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:u,path:l}=Object.assign({path:[]},o.data),f=(o.data.argumentList||[]).map(fr);let p;try{const v=l.slice(0,-1).reduce((m,S)=>m[S],t),y=l.reduce((m,S)=>m[S],t);switch(u){case"GET":p=y;break;case"SET":v[l.slice(-1)[0]]=fr(o.data.value),p=!0;break;case"APPLY":p=y.apply(v,f);break;case"CONSTRUCT":{const m=new y(...f);p=rm(m)}break;case"ENDPOINT":{const{port1:m,port2:S}=new MessageChannel;Vi(t,S),p=tm(m,[m])}break;case"RELEASE":p=void 0;break;default:return}}catch(v){p={value:v,[eo]:0}}Promise.resolve(p).catch(v=>({value:v,[eo]:0})).then(v=>{const[y,m]=bo(v);e.postMessage(Object.assign(Object.assign({},y),{id:i}),m),u==="RELEASE"&&(e.removeEventListener("message",n),Au(e),si in t&&typeof t[si]=="function"&&t[si]())}).catch(v=>{const[y,m]=bo({value:new TypeError("Unserializable return value"),[eo]:0});e.postMessage(Object.assign(Object.assign({},y),{id:i}),m)})}),e.start&&e.start()}function qg(t){return t.constructor.name==="MessagePort"}function Au(t){qg(t)&&t.close()}function Kg(t,e){const r=new Map;return t.addEventListener("message",function(o){const{data:i}=o;if(!i||!i.id)return;const u=r.get(i.id);if(u)try{u(i)}finally{r.delete(i.id)}}),Ei(t,r,[],e)}function Xn(t){if(t)throw new Error("Proxy has been released and is not useable")}function Ou(t){return Tr(t,new Map,{type:"RELEASE"}).then(()=>{Au(t)})}const yo=new WeakMap,wo="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(yo.get(t)||0)-1;yo.set(t,e),e===0&&Ou(t)});function Qg(t,e){const r=(yo.get(e)||0)+1;yo.set(e,r),wo&&wo.register(t,e,t)}function Jg(t){wo&&wo.unregister(t)}function Ei(t,e,r=[],n=function(){}){let o=!1;const i=new Proxy(n,{get(u,l){if(Xn(o),l===Xg)return()=>{Jg(i),Ou(t),e.clear(),o=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const f=Tr(t,e,{type:"GET",path:r.map(p=>p.toString())}).then(fr);return f.then.bind(f)}return Ei(t,e,[...r,l])},set(u,l,f){Xn(o);const[p,v]=bo(f);return Tr(t,e,{type:"SET",path:[...r,l].map(y=>y.toString()),value:p},v).then(fr)},apply(u,l,f){Xn(o);const p=r[r.length-1];if(p===$g)return Tr(t,e,{type:"ENDPOINT"}).then(fr);if(p==="bind")return Ei(t,e,r.slice(0,-1));const[v,y]=_s(f);return Tr(t,e,{type:"APPLY",path:r.map(m=>m.toString()),argumentList:v},y).then(fr)},construct(u,l){Xn(o);const[f,p]=_s(l);return Tr(t,e,{type:"CONSTRUCT",path:r.map(v=>v.toString()),argumentList:f},p).then(fr)}});return Qg(i,t),i}function em(t){return Array.prototype.concat.apply([],t)}function _s(t){const e=t.map(bo);return[e.map(r=>r[0]),em(e.map(r=>r[1]))]}const Ru=new WeakMap;function tm(t,e){return Ru.set(t,e),t}function rm(t){return Object.assign(t,{[Cu]:!0})}function bo(t){for(const[e,r]of ku)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},Ru.get(t)||[]]}function fr(t){switch(t.type){case"HANDLER":return ku.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Tr(t,e,r,n){return new Promise(o=>{const i=nm();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function nm(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Du(t,e){return typeof t!="number"||isNaN(t)?{valid:!1,message:`Parameter '${e}' must be a number`}:{valid:!0}}function om(t,e){return t<=0?{valid:!1,message:`Parameter '${e}' must be positive`}:{valid:!0}}function im(t,e,r){return t>=e?{valid:!1,message:`${r} (${t}) must be less than ${e}`}:{valid:!0}}function wt(t,e){const r=Du(t,e);return r.valid?om(t,e):r}function am(t,e,r){const n=Du(t,r);return n.valid?im(t,e,r):n}function bt(t,e){return r=>{const n=[];for(const o of e){const i=t(r[o],o);i.valid||n.push(i.message)}return{valid:n.length===0,errors:n}}}function Ss(t,e){return r=>{const n=r[t],o=r[e],i=am(n,o,t);return i.valid?{valid:!0,errors:[]}:{valid:!1,errors:[i.message]}}}function sm(t,e){let r=!0;const n=[];if(e.params)for(const o of e.params){const{name:i,validators:u}=o;if(!u)continue;const l=t[i];for(const f of u){const p=f(l,i);if(!p.valid){r=!1,n.push(p.message);break}}}if(e.validators)for(const o of e.validators){const i=o(t);i.valid||(r=!1,n.push(...i.errors))}return{valid:r,errors:n}}function kr({width:t=100,depth:e=100,height:r=100}){if(t===0&&e===0&&r===0)return me([0,0,0],[1e-7,1e-7,1e-7]);const n=t/2,o=e/2;return me([-n,-o,0],[n,o,r])}const um={name:"Cuboid",create:kr,params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],validators:[bt(wt,["width","depth","height"])],hasExplosion:!1};function lm({radius:t=50}){return ph(t)}const cm={name:"Sphere",create:lm,params:[{name:"radius",defaultValue:50}],validators:[bt(wt,["radius"])],hasExplosion:!1};function Mu({radius:t=50,height:e=100}){return Kr(t,e,[0,0,0],[0,0,-1])}const fm={name:"Cylinder",create:Mu,params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],validators:[bt(wt,["radius","height"])],hasExplosion:!1};function hm({aLength:t=80,bLength:e=50,cLength:r=30}){return gh(t,e,r)}const pm={name:"Ellipsoid",create:hm,params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],validators:[bt(wt,["aLength","bLength","cLength"])],hasExplosion:!1},Fu=t=>t.boundingBox.center;function Lu(t,e,r){return r.map(({position:n,direction:o,orientation:i})=>{const u=t(),l=e(u);let f=u.translate([n[0]-l[0],n[1]-l[1],n[2]-l[2]]);const p=[0,0,1],v=new M(i||o);if(v.Length>0){const y=new M(p).cross(v);if(y.Length>1e-10){const m=new M(p).getAngle(v);f=f.rotate(m,n,y)}else v.dot(new M(p))<0&&(f=f.rotate(180,n,[1,0,0]))}return f})}function Bu(t,e,r,n,o,i=0,u=0,l=1){const f=new M([i,u,l]).normalized();return Array.from({length:e*r},(p,v)=>{const y=Math.floor(v/r),S=v%r*n,T=y*o,C=new Je(new M(t.origin),new M(t.xDirection).normalized(),new M(t.normal).normalized()).toWorldCoords([S,T,0]);return{position:[C.x,C.y,C.z],direction:[t.normal[0],t.normal[1],t.normal[2]],orientation:[f.x,f.y,f.z]}})}function dm(t,e,r,n=0,o=0,i=1){return Bu({origin:t,xDirection:e,normal:(()=>{const u=new M(e),l=new M([0,0,1]),f=Math.abs(u.normalized().dot(l))>.99?new M([1,0,0]):u.cross(l).normalized();return[f.x,f.y,f.z]})()},1,r,r>1?new M(e).Length/(r-1):0,0,n,o,i)}function vm({count:t=5,vectorX:e=0,vectorY:r=50,vectorZ:n=50,originX:o=0,originY:i=0,originZ:u=0,boxWidth:l=10,boxDepth:f=10,boxHeight:p=10,orientationX:v=0,orientationY:y=0,orientationZ:m=1}){return Et(Lu(()=>kr({width:l,depth:f,height:p}),Fu,dm([o,i,u],[e,r,n],t,v,y,m)))}const gm={name:"DiagonalCuboidPattern",create:vm,params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[bt(wt,["count","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function mm({originX:t=0,originY:e=0,originZ:r=0,directionX:n=1,directionY:o=0,directionZ:i=0,normalX:u=0,normalY:l=0,normalZ:f=1,rowCount:p=3,colCount:v=3,xSpacing:y=30,ySpacing:m=30,boxWidth:S=10,boxDepth:T=10,boxHeight:x=10,orientationX:C=0,orientationY:A=0,orientationZ:L=1}){return Et(Lu(()=>kr({width:S,depth:T,height:x}),Fu,Bu({origin:[t,e,r],xDirection:[n,o,i],normal:[u,l,f]},p,v,y,m,C,A,L)))}const ym={name:"RectangularCuboidGrid",create:mm,params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[bt(wt,["rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function Uu({depth:t=100,flangeXLenght:e=50,flangeYLenght:r=50,thickness:n=5}){const o=me([0,-t/2,0],[e,t/2,n]),i=me([0,-t/2,0],[n,t/2,r]);return o.fuse(i)}const wm={name:"LProfile",create:Uu,params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],validators:[bt(wt,["depth","flangeXLenght","flangeYLenght","thickness"]),Ss("thickness","flangeXLenght"),Ss("thickness","flangeYLenght")],hasExplosion:!1};function Iu({bottomRadius:t=50,topRadius:e=25,height:r=100}){return La(t,{plane:"XY",origin:[0,0,0]}).loftWith(La(e,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}const bm={name:"Frustum",create:Iu,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],validators:[bt(wt,["bottomRadius","topRadius","height"])],hasExplosion:!1};function Gu({bottomRadius:t=50,topRadius:e=25,frustumHeight:r=80,cylinderHeight:n=40}){return Iu({bottomRadius:t,topRadius:e,height:r}).fuse(Kr(e,n,[0,0,-r],[0,0,-1]))}const _m={name:"Drill",create:Gu,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],validators:[bt(wt,["bottomRadius","topRadius","frustumHeight","cylinderHeight"])],hasExplosion:!1};function Sm(t,e){return{main:t,helperSpaces:e}}const ne={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},oe={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function Yn(t){let e;switch(t){case ne.FRONT:e=new M([0,-1,0]);break;case ne.BACK:e=new M([0,1,0]);break;case ne.LEFT:e=new M([-1,0,0]);break;case ne.RIGHT:e=new M([1,0,0]);break;case ne.TOP:e=new M([0,0,1]);break;case ne.BOTTOM:e=new M([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return e}function Nu(t,e){const[[r,n,o],[i,u,l]]=t.bounds;let f;switch(e){case oe.FRONT_TOP:f=new M([r,n,l]);break;case oe.FRONT_BOTTOM:f=new M([r,n,o]);break;case oe.BACK_TOP:f=new M([r,u,l]);break;case oe.BACK_BOTTOM:f=new M([r,u,o]);break;case oe.LEFT_TOP:f=new M([r,n,l]);break;case oe.LEFT_BOTTOM:f=new M([r,n,o]);break;case oe.RIGHT_TOP:f=new M([i,n,l]);break;case oe.RIGHT_BOTTOM:f=new M([i,n,o]);break;case oe.FRONT_LEFT:f=new M([r,n,o]);break;case oe.FRONT_RIGHT:f=new M([i,n,o]);break;case oe.BACK_LEFT:f=new M([r,u,o]);break;case oe.BACK_RIGHT:f=new M([i,u,o]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return f}function Hu(t,e){const[[r,n,o],[i,u,l]]=t.bounds;let f;switch(e){case oe.FRONT_TOP:f=new M([i,n,l]);break;case oe.FRONT_BOTTOM:f=new M([i,n,o]);break;case oe.BACK_TOP:f=new M([i,u,l]);break;case oe.BACK_BOTTOM:f=new M([i,u,o]);break;case oe.LEFT_TOP:f=new M([r,u,l]);break;case oe.LEFT_BOTTOM:f=new M([r,u,o]);break;case oe.RIGHT_TOP:f=new M([i,u,l]);break;case oe.RIGHT_BOTTOM:f=new M([i,u,o]);break;case oe.FRONT_LEFT:f=new M([r,n,l]);break;case oe.FRONT_RIGHT:f=new M([i,n,l]);break;case oe.BACK_LEFT:f=new M([r,u,l]);break;case oe.BACK_RIGHT:f=new M([i,u,l]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return f}function Tm(t){switch(t){case oe.FRONT_LEFT:return[ne.FRONT,ne.LEFT];case oe.FRONT_RIGHT:return[ne.FRONT,ne.RIGHT];case oe.FRONT_TOP:return[ne.FRONT,ne.TOP];case oe.FRONT_BOTTOM:return[ne.FRONT,ne.BOTTOM];case oe.BACK_LEFT:return[ne.BACK,ne.LEFT];case oe.BACK_RIGHT:return[ne.BACK,ne.RIGHT];case oe.BACK_TOP:return[ne.BACK,ne.TOP];case oe.BACK_BOTTOM:return[ne.BACK,ne.BOTTOM];case oe.LEFT_TOP:return[ne.LEFT,ne.TOP];case oe.LEFT_BOTTOM:return[ne.LEFT,ne.BOTTOM];case oe.RIGHT_TOP:return[ne.RIGHT,ne.TOP];case oe.RIGHT_BOTTOM:return[ne.RIGHT,ne.BOTTOM];default:throw new Error(`Unknown edge identifier: ${t}`)}}function Em(t,e,r=.5,n=.5){const[[o,i,u],[l,f,p]]=t.bounds,v=Math.max(0,Math.min(1,r)),y=Math.max(0,Math.min(1,n));let m;switch(e){case ne.FRONT:m=new M([o+(l-o)*v,i,u+(p-u)*y]);break;case ne.BACK:m=new M([o+(l-o)*v,f,u+(p-u)*y]);break;case ne.LEFT:m=new M([o,i+(f-i)*v,u+(p-u)*y]);break;case ne.RIGHT:m=new M([l,i+(f-i)*v,u+(p-u)*y]);break;case ne.TOP:m=new M([o+(l-o)*v,i+(f-i)*y,p]);break;case ne.BOTTOM:m=new M([o+(l-o)*v,i+(f-i)*y,u]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return m}function xm(t,e,r=.5){const n=Math.max(0,Math.min(1,r)),o=Nu(t,e),i=Hu(t,e);return new M([o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n,o.z+(i.z-o.z)*n])}function Cm(t,e){const{type:r,element:n,params:o={}}=e;switch(r){case"face":return Em(t,n,o.u,o.v);case"edge":return xm(t,n,o.t);case"corner":if(n.includes("START")){const i=n.replace("_START","");return Nu(t,i)}else if(n.includes("END")){const i=n.replace("_END","");return Hu(t,i)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new M(t.center);default:throw new Error(`Unknown position type: ${r}`)}}function Pm(t){const e=t.normalized(),r=Math.abs(e.x),n=Math.abs(e.y),o=Math.abs(e.z);let i;return r<=n&&r<=o?i=new M([0,e.z,-e.y]):n<=r&&n<=o?i=new M([e.z,0,-e.x]):i=new M([e.y,-e.x,0]),i.normalized()}function Zn(t,e,r,n={}){const o=Cm(t.boundingBox,e);let i;n.normal?i=new M(n.normal):i=km(t,e,n);let u;n.xDir?u=new M(n.xDir):u=Pm(i);const l=new pr;l.coordSystemChange({origin:o.toTuple(),zDir:i.toTuple(),xDir:u.toTuple()},"reference");const f=Pe(l.transform(r.wrapped));return l.delete(),i.delete(),u.delete(),o.delete(),f}function km(t,e,r={}){const{type:n,element:o}=e;switch(n){case"face":return Yn(o);case"edge":if(r.faceForEdge)return Yn(r.faceForEdge);{const i=Tm(o);return Yn(i[0])}case"corner":return r.faceForCorner?Yn(r.faceForCorner):new M([0,0,1]);case"center":default:return new M([0,0,1])}}function lr(t,e,r,n=!1){return n?Pe(t.wrapped).mirror(e,r):t.mirror(e,r)}const Vu=[{id:"ST001",name:"Stringer"},{id:"LP001",name:"L-Profile"},{id:"SS001",name:"Side Stringer"}];function Am({width:t=50,depth:e=100,height:r=200,showHelper:n=!0,explosionFactor:o=0}){const i=kr({width:t,depth:e,height:r}),u=Math.round(r/17.5)-1;if(u<=0)return Sm(Et([]),n?[i]:[]);const l=r/(u+1),f=u>1?(e-28)/(u-1):0,p=kr({width:t-1,depth:20,height:.5}),v=p.boundingBox.center,y=Zn(p,{type:"face",element:ne.TOP,params:{u:1.5/(t-1),v:2.25/20}},Gu({bottomRadius:1.2,topRadius:.8,frustumHeight:.5*.8,cylinderHeight:.5*.2})),m=p.cut(y).cut(lr(y,"XZ",v,!0)).cut(lr(y,"YZ",v,!0)).cut(lr(lr(y,"XZ",v,!0),"YZ",v,!0)),S=m.clone(),T=Uu({depth:20,flangeXLenght:4.5,flangeYLenght:4.5,thickness:.5}),x=T.boundingBox.center,C=Zn(T,{type:"face",element:ne.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},Mu({radius:.800001,height:.5})),A=T.cut(C).cut(lr(C,"XZ",x,!0)),L=A.clone(),F=Zn(m,{type:"edge",element:oe.LEFT_BOTTOM,params:{t:.5}},A,{normal:[0,0,-1],xDir:[1,0,0]}),Y=lr(F,"YZ",v,!0),V=[];let ae=0,ee=-e/2+14,q=l-(m.boundingBox.bounds[1][2]-m.boundingBox.bounds[0][2]);for(let et=0;et<u;et++){const Ke=o*15;V.push(m.clone().translate([ae,ee,q])),V.push(F.clone().translate([ae-Ke,ee,q])),V.push(Y.clone().translate([ae+Ke,ee,q])),ee+=f,q+=l}const de=kr({width:600,depth:20,height:.5}),Se=f,xe=l,ke=Math.sqrt(Se*Se+xe*xe),Ae=ke>.001?[0,Se/ke,xe/ke]:[1,0,0],ye=Zn(i,{type:"face",element:ne.RIGHT},de,{normal:[-1,0,0],xDir:Ae}).intersect(i),Ce=ye.clone(),ue=i.boundingBox.center,ge=lr(ye,"YZ",ue,!0),Oe=o*30,He=o*30;V.push(ye.translate([Oe,0,0])),V.push(ge.translate([-He,0,0]));const be=Et(V),Re=Vu.map(et=>{let Ke=0,lt="Variable";return et.id==="ST001"?(Ke=u,lt=`${t-1}200.5cm`):et.id==="LP001"?(Ke=u*2,lt="4.54.520cm"):et.id==="SS001"&&(Ke=2),{...et,quantity:Ke,dimensions:lt,material:"Steel"}});return{main:be,helperSpaces:n?[i]:[],componentData:Re,technicalDrawingModels:{ST001:S,LP001:L,SS001:Ce}}}const Om={name:"Staircase",create:Am,params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],validators:[bt(wt,["width","depth","height"])],hasExplosion:!0,hasTechnicalDrawingParts:!0,componentDataStructure:Vu};function Rm({width:t,depth:e,board_thickness:r}){let n=[];const u=Math.floor(e/10),l=Math.floor((e-r)/10),f=Math.floor(e/15),p=(e-u*5)/(u+1),v=(e-r-l*5)/(l+1),y=(2*e/3-f*5)/(f+1),m=Wg([-2.4,.25]).bulgeArcTo([2.4,.25],-.3).tangentArcTo([2.4,-.25]).bulgeArcTo([-2.4,-.25],-.3).tangentArcTo([-2.4,.25]).close().sketchOnPlane("XZ",-.15).extrude(.3),S=[];for(let re=0;re<u;re++){const le=m.clone().translate(p+2.5+re*(5+p),-t/2+r/2,50);S.push(le),n.push(le.clone()),n.push(le.clone().mirror("XZ"))}const T=St(S),x=[];for(let re=0;re<l;re++){const le=m.clone().rotate(90,[0,0,0],[1,0,0]).translate(v+2.5+re*(5+v),-t/2+r,3*r/2);x.push(le),n.push(le.clone()),n.push(le.clone().mirror("XZ"))}const C=St(x),A=me([0,-t/2,0],[e,-t/2+r,50]).cut(T).cut(C);n.push(A),n.push(A.clone().mirror("XZ"));const L=me([e,-t/2,0],[e+.2,-t/2+r,50]);n.push(L),n.push(L.clone().mirror("XZ"));const F=[];for(let re=0;re<l;re++){const le=m.clone().translate(v+2.5+re*(5+v),t/6,2*r);F.push(le),n.push(le.clone()),n.push(le.clone().mirror("XZ"))}const Y=St(F),V=me([0,-t/2+r,r],[e-r-.2,t/2-r,2*r]).cut(C).cut(C.mirror("XZ")).cut(Y).cut(Y.clone().mirror("XZ"));n.push(V);const ae=me([e-r-.2,-t/2+r,r],[e-r,t/2-r,2*r]);n.push(ae);const ee=[];for(let re=0;re<l;re++){const le=m.clone().translate(v+2.5+re*(5+v),t/6,50);ee.push(le),n.push(le.clone()),n.push(le.clone().mirror("XZ"))}const q=St(ee),de=me([e-r,-t/2+r+.4,r],[e,-t/6-.3,50-.4]);n.push(de),n.push(de.clone().mirror("XZ"));const Se=me([e-r,-t/6+.3,r],[e,t/6-.3,50-.4]);n.push(Se);const xe=me([0,t/6-r/2,2*r],[e-r-.2,t/6+r/2,50]).cut(Y).cut(q);n.push(xe),n.push(xe.clone().mirror("XZ"));const ke=me([e-r-.2,t/6-r/2,2*r],[e-r,t/6+r/2,50]);n.push(ke),n.push(ke.clone().mirror("XZ"));const Ae=[];for(let re=0;re<f;re++){const le=m.clone().translate(y+2.5+re*(5+y),t/4,50+r);Ae.push(le),n.push(le.clone()),n.push(le.clone().mirror("XZ"))}const se=St(Ae),ye=me([0,-t/2,50],[e,t/2,50+r]).cut(T).cut(T.mirror("XZ")).cut(q).cut(q.mirror("XZ")).cut(se).cut(se.clone().mirror("XZ"));n.push(ye);const Ce=me([e,-t/2,50],[e+.2,t/2,50+r]);n.push(Ce);const ue=[];for(let re=0;re<f;re++){const le=m.clone().translate(y+2.5+re*(5+y),t/4,50+6*(r+30));ue.push(le),n.push(le.clone()),n.push(le.clone().mirror("XZ"))}const ge=St(ue),Oe=[];for(let re=0;re<4;re++)for(let le=0;le<f;le++){const wr=m.clone().rotate(90,[0,0,0],[1,0,0]).translate(y+2.5+le*(5+y),t/4-r/2,50+2.5*r+60+re*(30+r));Oe.push(wr),n.push(wr.clone()),n.push(wr.clone().mirror("XZ"))}const He=St(Oe);Kr(.4,3,[2*e/3-y/2,-t/4,50+30+1.5*r],[0,-1,0]);const Re=St([]),Pt=me([0,t/4-r/2,50+r],[2*e/3,t/4+r/2,50+6*(r+30)]).cut(se).cut(ge).cut(He).cut(Re);n.push(Pt),n.push(Pt.clone().mirror("XZ"));const et=me([2*e/3,t/4-r/2,50+r],[2*e/3+.2,t/4+r/2,50+6*(r+30)]);n.push(et),n.push(et.clone().mirror("XZ"));const Ke=[];for(let re=0;re<f;re++){const le=m.clone().rotate(90,[0,0,0],[1,0,0]).translate(y+2.5+re*(5+y),t/4-r/2,50+2.5*r+60);Ke.push(le)}const lt=St(Ke),mr=me([0,-t/4+r/2,50+2*(30+r)],[2*e/3,t/4-r/2,50+2*30+3*r]).cut(lt),ct=me([2*e/3,-t/4+r/2,50+2*(30+r)],[2*e/3+.2,t/4-r/2,50+2*30+3*r]);for(let re=0;re<4;re++)n.push(mr.clone().translateZ(re*(30+r))),n.push(ct.clone().translateZ(re*(30+r)));const Ve=me([0,-t/2,50+6*(r+30)],[e,t/2,50+7*r+6*30]).cut(ge).cut(ge.mirror("XZ"));n.push(Ve);const We=me([e,-t/2,50+6*(r+30)],[e+.2,t/2,50+7*r+6*30]);n.push(We);const ft=me([e-r,-t/6-.3,r],[e,-t/6-.1,50-.4]),Ht=me([e-r,-t/2+r+.2,r],[e,-t/2+r+.4,50-.4]),B=me([e-r,-t/2+r+.4,50-.4],[e,-t/6-.3,50-.2]),te=me([e-r,-t/2+r+.4,r],[e,-t/6-.3,r+.2]);n.push(ft),n.push(Ht),n.push(B),n.push(te),n.push(ft.clone().mirror("XZ")),n.push(Ht.clone().mirror("XZ")),n.push(B.clone().mirror("XZ")),n.push(te.clone().mirror("XZ"));const nt=me([e-r,-t/6+.1,r],[e,-t/6+.3,50-.4]),yn=me([e-r,t/6-.3,r],[e,t/6-.1,50-.4]),wn=me([e-r,-t/6+.3,50-.4],[e,t/6-.3,50-.2]),bn=me([e-r,-t/6+.3,r],[e,t/6-.3,r+.2]);n.push(nt),n.push(yn),n.push(wn),n.push(bn);const yr=Kr(.5,2,[e,t/6+r,50-r],[1,0,0]).fuse(Kr(1,1,[e+2,t/6+r,50-r],[1,0,0]));return n.push(yr),n.push(yr.clone().mirror("XZ")),n.push(yr.clone().translateY(-2*r)),St(n)}const Dm={name:"Closet",create:Rm,params:[{name:"width",defaultValue:200,description:"Overall width of the closet"},{name:"depth",defaultValue:50,description:"Overall depth of the closet"},{name:"board_thickness",defaultValue:3,description:"Thickness of the boards used"}],validators:[bt(wt,["width","depth","board_thickness"])],hasExplosion:!1,hasBoM:!0},Mm={Cuboid:um,Sphere:cm,Cylinder:fm,Ellipsoid:pm,DiagonalCuboidPattern:gm,RectangularCuboidGrid:ym,LProfile:wm,Frustum:bm,Drill:_m,Closet:Dm,Staircase:{...Om,hasBoM:!0}};function Fm(t,e){const r=Mm[t];if(!r)throw new Error(`Model "${t}" not found`);const n=sm(e,r);return n.valid?r.create(e):{error:!0,validationErrors:n.errors}}let Ts=!1;const Lm=async()=>{if(Ts)return Promise.resolve(!0);const t=await Cf({locateFile:()=>Pf});return Ts=!0,kf(t),!0},Bm=Lm();function Um(t,e,r="standard"){return console.time(`[PERF] Total ${t} creation (Quality: ${r})`),Bm.then(()=>{console.time(`[PERF] ${t} model function`);const n=Fm(t,e);if(console.timeEnd(`[PERF] ${t} model function`),n&&n.error)return{error:!0,validationErrors:n.validationErrors};if(n&&n.main&&Array.isArray(n.helperSpaces)){const l=n.main,f=n.helperSpaces,p=r==="high"?{tolerance:.01,angularTolerance:1}:{tolerance:.1,angularTolerance:15};console.log(`[INFO] Using mesh options for ${r} quality:`,p),console.time(`[PERF] ${t} main model generation (Quality: ${r})`);const v=l.mesh(p),y=l.meshEdges(p);console.timeEnd(`[PERF] ${t} main model generation (Quality: ${r})`),console.time(`[PERF] ${t} helper spaces generation (Quality: ${r})`);const m=f.map(S=>({faces:S.mesh(p),edges:S.meshEdges(p)}));return console.timeEnd(`[PERF] ${t} helper spaces generation (Quality: ${r})`),console.timeEnd(`[PERF] Total ${t} creation (Quality: ${r})`),{faces:v,edges:y,helperSpaces:m,componentData:n.componentData}}const o=r==="high"?{tolerance:.01,angularTolerance:1}:{tolerance:.1,angularTolerance:15};console.log(`[INFO] Using mesh options for ${r} quality:`,o),console.time(`[PERF] ${t} faces generation (Quality: ${r})`);const i=n.mesh(o);console.timeEnd(`[PERF] ${t} faces generation (Quality: ${r})`),i&&i.triangles&&console.log(`[INFO] ${t} (Quality: ${r}) triangles: ${i.triangles.length/3}, vertices: ${i.vertices.length/3}`),console.time(`[PERF] ${t} edges generation (Quality: ${r})`);const u=n.meshEdges(o);return console.timeEnd(`[PERF] ${t} edges generation (Quality: ${r})`),console.timeEnd(`[PERF] Total ${t} creation (Quality: ${r})`),{faces:i,edges:u,componentData:n.componentData}})}Vi({createMesh:Um})});export default Im();
