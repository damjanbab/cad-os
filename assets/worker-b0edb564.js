(function(){"use strict";var Module=(()=>{var e=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(e=e||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,i;r.ready=new Promise(function(l,c){n=l,i=c});var o=Object.assign({},r),a="./this.program",s=(l,c)=>{throw c},u=typeof window=="object",f=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",w="";function b(l){return r.locateFile?r.locateFile(l,w):w+l}var S,x,m;function h(l){if(l instanceof rr)return;P("exiting due to exception: "+l)}var v,p,y;d?(f?w=require("path").dirname(w)+"/":w=__dirname+"/",y=()=>{p||(v=require("fs"),p=require("path"))},S=function(c,g){return y(),c=p.normalize(c),v.readFileSync(c,g?void 0:"utf8")},m=l=>{var c=S(l,!0);return c.buffer||(c=new Uint8Array(c)),c},x=(l,c,g)=>{y(),l=p.normalize(l),v.readFile(l,function(C,R){C?g(C):c(R.buffer)})},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(l){if(!(l instanceof rr))throw l}),process.on("unhandledRejection",function(l){throw l}),s=(l,c)=>{if(De())throw process.exitCode=l,c;h(c),process.exit(l)},r.inspect=function(){return"[Emscripten Module object]"}):(u||f)&&(f?w=self.location.href:typeof document<"u"&&document.currentScript&&(w=document.currentScript.src),e&&(w=e),w.indexOf("blob:")!==0?w=w.substr(0,w.replace(/[?#].*/,"").lastIndexOf("/")+1):w="",S=l=>{var c=new XMLHttpRequest;return c.open("GET",l,!1),c.send(null),c.responseText},f&&(m=l=>{var c=new XMLHttpRequest;return c.open("GET",l,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),x=(l,c,g)=>{var C=new XMLHttpRequest;C.open("GET",l,!0),C.responseType="arraybuffer",C.onload=()=>{if(C.status==200||C.status==0&&C.response){c(C.response);return}g()},C.onerror=g,C.send(null)});var E=r.print||console.log.bind(console),P=r.printErr||console.warn.bind(console);Object.assign(r,o),o=null,r.arguments&&r.arguments,r.thisProgram&&(a=r.thisProgram),r.quit&&(s=r.quit);var A=4,L;r.wasmBinary&&(L=r.wasmBinary);var B=r.noExitRuntime||!0;typeof WebAssembly!="object"&&ze("no native wasm support detected");var F,U=!1;function T(l,c){l||ze(c)}var I=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function _(l,c,g){for(var C=c+g,R=c;l[R]&&!(R>=C);)++R;if(R-c>16&&l.buffer&&I)return I.decode(l.subarray(c,R));for(var k="";c<R;){var G=l[c++];if(!(G&128)){k+=String.fromCharCode(G);continue}var N=l[c++]&63;if((G&224)==192){k+=String.fromCharCode((G&31)<<6|N);continue}var W=l[c++]&63;if((G&240)==224?G=(G&15)<<12|N<<6|W:G=(G&7)<<18|N<<12|W<<6|l[c++]&63,G<65536)k+=String.fromCharCode(G);else{var j=G-65536;k+=String.fromCharCode(55296|j>>10,56320|j&1023)}}return k}function D(l,c){return l?_(ce,l,c):""}function z(l,c,g,C){if(!(C>0))return 0;for(var R=g,k=g+C-1,G=0;G<l.length;++G){var N=l.charCodeAt(G);if(N>=55296&&N<=57343){var W=l.charCodeAt(++G);N=65536+((N&1023)<<10)|W&1023}if(N<=127){if(g>=k)break;c[g++]=N}else if(N<=2047){if(g+1>=k)break;c[g++]=192|N>>6,c[g++]=128|N&63}else if(N<=65535){if(g+2>=k)break;c[g++]=224|N>>12,c[g++]=128|N>>6&63,c[g++]=128|N&63}else{if(g+3>=k)break;c[g++]=240|N>>18,c[g++]=128|N>>12&63,c[g++]=128|N>>6&63,c[g++]=128|N&63}}return c[g]=0,g-R}function M(l,c,g){return z(l,ce,c,g)}function q(l){for(var c=0,g=0;g<l.length;++g){var C=l.charCodeAt(g);C>=55296&&C<=57343&&(C=65536+((C&1023)<<10)|l.charCodeAt(++g)&1023),C<=127?++c:C<=2047?c+=2:C<=65535?c+=3:c+=4}return c}var J=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ee(l,c){for(var g=l,C=g>>1,R=C+c/2;!(C>=R)&&Te[C];)++C;if(g=C<<1,g-l>32&&J)return J.decode(ce.subarray(l,g));for(var k="",G=0;!(G>=c/2);++G){var N=Ae[l+G*2>>1];if(N==0)break;k+=String.fromCharCode(N)}return k}function le(l,c,g){if(g===void 0&&(g=2147483647),g<2)return 0;g-=2;for(var C=c,R=g<l.length*2?g/2:l.length,k=0;k<R;++k){var G=l.charCodeAt(k);Ae[c>>1]=G,c+=2}return Ae[c>>1]=0,c-C}function oe(l){return l.length*2}function V(l,c){for(var g=0,C="";!(g>=c/4);){var R=K[l+g*4>>2];if(R==0)break;if(++g,R>=65536){var k=R-65536;C+=String.fromCharCode(55296|k>>10,56320|k&1023)}else C+=String.fromCharCode(R)}return C}function H(l,c,g){if(g===void 0&&(g=2147483647),g<4)return 0;for(var C=c,R=C+g-4,k=0;k<l.length;++k){var G=l.charCodeAt(k);if(G>=55296&&G<=57343){var N=l.charCodeAt(++k);G=65536+((G&1023)<<10)|N&1023}if(K[c>>2]=G,c+=4,c+4>R)break}return K[c>>2]=0,c-C}function X(l){for(var c=0,g=0;g<l.length;++g){var C=l.charCodeAt(g);C>=55296&&C<=57343&&++g,c+=4}return c}function Y(l){var c=q(l)+1,g=it(c);return g&&z(l,ae,g,c),g}function ie(l,c){ae.set(l,c)}function se(l,c,g){for(var C=0;C<l.length;++C)ae[c++>>0]=l.charCodeAt(C);g||(ae[c>>0]=0)}var pe,ae,ce,Ae,Te,K,he,xe,Ve;function Ze(l){pe=l,r.HEAP8=ae=new Int8Array(l),r.HEAP16=Ae=new Int16Array(l),r.HEAP32=K=new Int32Array(l),r.HEAPU8=ce=new Uint8Array(l),r.HEAPU16=Te=new Uint16Array(l),r.HEAPU32=he=new Uint32Array(l),r.HEAPF32=xe=new Float32Array(l),r.HEAPF64=Ve=new Float64Array(l)}r.INITIAL_MEMORY;var Ge,Me=[],me=[],ye=[];function De(){return B}function qe(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)ge(r.preRun.shift());Nt(Me)}function Ke(){!r.noFSInit&&!O.init.initialized&&O.init(),O.ignorePermissions=!1,Nt(me)}function at(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Re(r.postRun.shift());Nt(ye)}function ge(l){Me.unshift(l)}function de(l){me.unshift(l)}function Re(l){ye.unshift(l)}var Ie=0,Fe=null;function We(l){return l}function He(l){Ie++,r.monitorRunDependencies&&r.monitorRunDependencies(Ie)}function Ee(l){if(Ie--,r.monitorRunDependencies&&r.monitorRunDependencies(Ie),Ie==0&&Fe){var c=Fe;Fe=null,c()}}function ze(l){r.onAbort&&r.onAbort(l),l="Aborted("+l+")",P(l),U=!0,l+=". Build with -sASSERTIONS for more info.";var c=new WebAssembly.RuntimeError(l);throw i(c),c}var Br="data:application/octet-stream;base64,";function ir(l){return l.startsWith(Br)}function or(l){return l.startsWith("file://")}var Xe;Xe="replicad_single.wasm",ir(Xe)||(Xe=b(Xe));function ar(l){try{if(l==Xe&&L)return new Uint8Array(L);if(m)return m(l);throw"both async and sync fetching of the wasm failed"}catch(c){ze(c)}}function Lr(){if(!L&&(u||f)){if(typeof fetch=="function"&&!or(Xe))return fetch(Xe,{credentials:"same-origin"}).then(function(l){if(!l.ok)throw"failed to load wasm binary file at '"+Xe+"'";return l.arrayBuffer()}).catch(function(){return ar(Xe)});if(x)return new Promise(function(l,c){x(Xe,function(g){l(new Uint8Array(g))},c)})}return Promise.resolve().then(function(){return ar(Xe)})}function Fr(){var l={a:oo};function c(G,N){var W=G.exports;r.asm=W,F=r.asm.oa,Ze(F.buffer),Ge=r.asm.va,de(r.asm.pa),Ee()}He();function g(G){c(G.instance)}function C(G){return Lr().then(function(N){return WebAssembly.instantiate(N,l)}).then(function(N){return N}).then(G,function(N){P("failed to asynchronously prepare wasm: "+N),ze(N)})}function R(){return!L&&typeof WebAssembly.instantiateStreaming=="function"&&!ir(Xe)&&!or(Xe)&&!d&&typeof fetch=="function"?fetch(Xe,{credentials:"same-origin"}).then(function(G){var N=WebAssembly.instantiateStreaming(G,l);return N.then(g,function(W){return P("wasm streaming compile failed: "+W),P("falling back to ArrayBuffer instantiation"),C(g)})}):C(g)}if(r.instantiateWasm)try{var k=r.instantiateWasm(l,c);return k}catch(G){return P("Module.instantiateWasm callback failed with error: "+G),!1}return R().catch(i),{}}var Ne,et;function Ir(){return r.HEAP8.length}function Nt(l){for(;l.length>0;){var c=l.shift();if(typeof c=="function"){c(r);continue}var g=c.func;typeof g=="number"?c.arg===void 0?xt(g)():xt(g)(c.arg):g(c.arg===void 0?null:c.arg)}}var Pt=[];function xt(l){var c=Pt[l];return c||(l>=Pt.length&&(Pt.length=l+1),Pt[l]=c=Ge.get(l)),c}function Ur(l,c,g,C){ze("Assertion failed: "+D(l)+", at: "+[c?D(c):"unknown filename",g,C?D(C):"unknown function"])}function kr(l){return it(l+24)+24}function Gr(l){this.excPtr=l,this.ptr=l-24,this.set_type=function(c){he[this.ptr+4>>2]=c},this.get_type=function(){return he[this.ptr+4>>2]},this.set_destructor=function(c){he[this.ptr+8>>2]=c},this.get_destructor=function(){return he[this.ptr+8>>2]},this.set_refcount=function(c){K[this.ptr>>2]=c},this.set_caught=function(c){c=c?1:0,ae[this.ptr+12>>0]=c},this.get_caught=function(){return ae[this.ptr+12>>0]!=0},this.set_rethrown=function(c){c=c?1:0,ae[this.ptr+13>>0]=c},this.get_rethrown=function(){return ae[this.ptr+13>>0]!=0},this.init=function(c,g){this.set_adjusted_ptr(0),this.set_type(c),this.set_destructor(g),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var c=K[this.ptr>>2];K[this.ptr>>2]=c+1},this.release_ref=function(){var c=K[this.ptr>>2];return K[this.ptr>>2]=c-1,c===1},this.set_adjusted_ptr=function(c){he[this.ptr+16>>2]=c},this.get_adjusted_ptr=function(){return he[this.ptr+16>>2]},this.get_exception_ptr=function(){var c=Dr(this.get_type());if(c)return he[this.excPtr>>2];var g=this.get_adjusted_ptr();return g!==0?g:this.excPtr}}function zr(l,c,g){var C=new Gr(l);throw C.init(c,g),l}var we={isAbs:l=>l.charAt(0)==="/",splitPath:l=>{var c=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return c.exec(l).slice(1)},normalizeArray:(l,c)=>{for(var g=0,C=l.length-1;C>=0;C--){var R=l[C];R==="."?l.splice(C,1):R===".."?(l.splice(C,1),g++):g&&(l.splice(C,1),g--)}if(c)for(;g;g--)l.unshift("..");return l},normalize:l=>{var c=we.isAbs(l),g=l.substr(-1)==="/";return l=we.normalizeArray(l.split("/").filter(C=>!!C),!c).join("/"),!l&&!c&&(l="."),l&&g&&(l+="/"),(c?"/":"")+l},dirname:l=>{var c=we.splitPath(l),g=c[0],C=c[1];return!g&&!C?".":(C&&(C=C.substr(0,C.length-1)),g+C)},basename:l=>{if(l==="/")return"/";l=we.normalize(l),l=l.replace(/\/$/,"");var c=l.lastIndexOf("/");return c===-1?l:l.substr(c+1)},join:function(){var l=Array.prototype.slice.call(arguments,0);return we.normalize(l.join("/"))},join2:(l,c)=>we.normalize(l+"/"+c)};function Nr(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var l=new Uint8Array(1);return function(){return crypto.getRandomValues(l),l[0]}}else if(d)try{var c=require("crypto");return function(){return c.randomBytes(1)[0]}}catch{}return function(){ze("randomDevice")}}var tt={resolve:function(){for(var l="",c=!1,g=arguments.length-1;g>=-1&&!c;g--){var C=g>=0?arguments[g]:O.cwd();if(typeof C!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!C)return"";l=C+"/"+l,c=we.isAbs(C)}return l=we.normalizeArray(l.split("/").filter(R=>!!R),!c).join("/"),(c?"/":"")+l||"."},relative:(l,c)=>{l=tt.resolve(l).substr(1),c=tt.resolve(c).substr(1);function g(j){for(var te=0;te<j.length&&j[te]==="";te++);for(var re=j.length-1;re>=0&&j[re]==="";re--);return te>re?[]:j.slice(te,re-te+1)}for(var C=g(l.split("/")),R=g(c.split("/")),k=Math.min(C.length,R.length),G=k,N=0;N<k;N++)if(C[N]!==R[N]){G=N;break}for(var W=[],N=G;N<C.length;N++)W.push("..");return W=W.concat(R.slice(G)),W.join("/")}},ct={ttys:[],init:function(){},shutdown:function(){},register:function(l,c){ct.ttys[l]={input:[],output:[],ops:c},O.registerDevice(l,ct.stream_ops)},stream_ops:{open:function(l){var c=ct.ttys[l.node.rdev];if(!c)throw new O.ErrnoError(43);l.tty=c,l.seekable=!1},close:function(l){l.tty.ops.flush(l.tty)},flush:function(l){l.tty.ops.flush(l.tty)},read:function(l,c,g,C,R){if(!l.tty||!l.tty.ops.get_char)throw new O.ErrnoError(60);for(var k=0,G=0;G<C;G++){var N;try{N=l.tty.ops.get_char(l.tty)}catch{throw new O.ErrnoError(29)}if(N===void 0&&k===0)throw new O.ErrnoError(6);if(N==null)break;k++,c[g+G]=N}return k&&(l.node.timestamp=Date.now()),k},write:function(l,c,g,C,R){if(!l.tty||!l.tty.ops.put_char)throw new O.ErrnoError(60);try{for(var k=0;k<C;k++)l.tty.ops.put_char(l.tty,c[g+k])}catch{throw new O.ErrnoError(29)}return C&&(l.node.timestamp=Date.now()),k}},default_tty_ops:{get_char:function(l){if(!l.input.length){var c=null;if(d){var g=256,C=Buffer.alloc(g),R=0;try{R=v.readSync(process.stdin.fd,C,0,g,-1)}catch(k){if(k.toString().includes("EOF"))R=0;else throw k}R>0?c=C.slice(0,R).toString("utf-8"):c=null}else typeof window<"u"&&typeof window.prompt=="function"?(c=window.prompt("Input: "),c!==null&&(c+=`
`)):typeof readline=="function"&&(c=readline(),c!==null&&(c+=`
`));if(!c)return null;l.input=Gt(c,!0)}return l.input.shift()},put_char:function(l,c){c===null||c===10?(E(_(l.output,0)),l.output=[]):c!=0&&l.output.push(c)},flush:function(l){l.output&&l.output.length>0&&(E(_(l.output,0)),l.output=[])}},default_tty1_ops:{put_char:function(l,c){c===null||c===10?(P(_(l.output,0)),l.output=[]):c!=0&&l.output.push(c)},flush:function(l){l.output&&l.output.length>0&&(P(_(l.output,0)),l.output=[])}}};function Vr(l,c){ce.fill(0,l,l+c)}function Mr(l,c){return Math.ceil(l/c)*c}function sr(l){l=Mr(l,65536);var c=Or(65536,l);return c?(Vr(c,l),c):0}var ve={ops_table:null,mount:function(l){return ve.createNode(null,"/",16895,0)},createNode:function(l,c,g,C){if(O.isBlkdev(g)||O.isFIFO(g))throw new O.ErrnoError(63);ve.ops_table||(ve.ops_table={dir:{node:{getattr:ve.node_ops.getattr,setattr:ve.node_ops.setattr,lookup:ve.node_ops.lookup,mknod:ve.node_ops.mknod,rename:ve.node_ops.rename,unlink:ve.node_ops.unlink,rmdir:ve.node_ops.rmdir,readdir:ve.node_ops.readdir,symlink:ve.node_ops.symlink},stream:{llseek:ve.stream_ops.llseek}},file:{node:{getattr:ve.node_ops.getattr,setattr:ve.node_ops.setattr},stream:{llseek:ve.stream_ops.llseek,read:ve.stream_ops.read,write:ve.stream_ops.write,allocate:ve.stream_ops.allocate,mmap:ve.stream_ops.mmap,msync:ve.stream_ops.msync}},link:{node:{getattr:ve.node_ops.getattr,setattr:ve.node_ops.setattr,readlink:ve.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ve.node_ops.getattr,setattr:ve.node_ops.setattr},stream:O.chrdev_stream_ops}});var R=O.createNode(l,c,g,C);return O.isDir(R.mode)?(R.node_ops=ve.ops_table.dir.node,R.stream_ops=ve.ops_table.dir.stream,R.contents={}):O.isFile(R.mode)?(R.node_ops=ve.ops_table.file.node,R.stream_ops=ve.ops_table.file.stream,R.usedBytes=0,R.contents=null):O.isLink(R.mode)?(R.node_ops=ve.ops_table.link.node,R.stream_ops=ve.ops_table.link.stream):O.isChrdev(R.mode)&&(R.node_ops=ve.ops_table.chrdev.node,R.stream_ops=ve.ops_table.chrdev.stream),R.timestamp=Date.now(),l&&(l.contents[c]=R,l.timestamp=R.timestamp),R},getFileDataAsTypedArray:function(l){return l.contents?l.contents.subarray?l.contents.subarray(0,l.usedBytes):new Uint8Array(l.contents):new Uint8Array(0)},expandFileStorage:function(l,c){var g=l.contents?l.contents.length:0;if(!(g>=c)){var C=1024*1024;c=Math.max(c,g*(g<C?2:1.125)>>>0),g!=0&&(c=Math.max(c,256));var R=l.contents;l.contents=new Uint8Array(c),l.usedBytes>0&&l.contents.set(R.subarray(0,l.usedBytes),0)}},resizeFileStorage:function(l,c){if(l.usedBytes!=c)if(c==0)l.contents=null,l.usedBytes=0;else{var g=l.contents;l.contents=new Uint8Array(c),g&&l.contents.set(g.subarray(0,Math.min(c,l.usedBytes))),l.usedBytes=c}},node_ops:{getattr:function(l){var c={};return c.dev=O.isChrdev(l.mode)?l.id:1,c.ino=l.id,c.mode=l.mode,c.nlink=1,c.uid=0,c.gid=0,c.rdev=l.rdev,O.isDir(l.mode)?c.size=4096:O.isFile(l.mode)?c.size=l.usedBytes:O.isLink(l.mode)?c.size=l.link.length:c.size=0,c.atime=new Date(l.timestamp),c.mtime=new Date(l.timestamp),c.ctime=new Date(l.timestamp),c.blksize=4096,c.blocks=Math.ceil(c.size/c.blksize),c},setattr:function(l,c){c.mode!==void 0&&(l.mode=c.mode),c.timestamp!==void 0&&(l.timestamp=c.timestamp),c.size!==void 0&&ve.resizeFileStorage(l,c.size)},lookup:function(l,c){throw O.genericErrors[44]},mknod:function(l,c,g,C){return ve.createNode(l,c,g,C)},rename:function(l,c,g){if(O.isDir(l.mode)){var C;try{C=O.lookupNode(c,g)}catch{}if(C)for(var R in C.contents)throw new O.ErrnoError(55)}delete l.parent.contents[l.name],l.parent.timestamp=Date.now(),l.name=g,c.contents[g]=l,c.timestamp=l.parent.timestamp,l.parent=c},unlink:function(l,c){delete l.contents[c],l.timestamp=Date.now()},rmdir:function(l,c){var g=O.lookupNode(l,c);for(var C in g.contents)throw new O.ErrnoError(55);delete l.contents[c],l.timestamp=Date.now()},readdir:function(l){var c=[".",".."];for(var g in l.contents)l.contents.hasOwnProperty(g)&&c.push(g);return c},symlink:function(l,c,g){var C=ve.createNode(l,c,41471,0);return C.link=g,C},readlink:function(l){if(!O.isLink(l.mode))throw new O.ErrnoError(28);return l.link}},stream_ops:{read:function(l,c,g,C,R){var k=l.node.contents;if(R>=l.node.usedBytes)return 0;var G=Math.min(l.node.usedBytes-R,C);if(G>8&&k.subarray)c.set(k.subarray(R,R+G),g);else for(var N=0;N<G;N++)c[g+N]=k[R+N];return G},write:function(l,c,g,C,R,k){if(c.buffer===ae.buffer&&(k=!1),!C)return 0;var G=l.node;if(G.timestamp=Date.now(),c.subarray&&(!G.contents||G.contents.subarray)){if(k)return G.contents=c.subarray(g,g+C),G.usedBytes=C,C;if(G.usedBytes===0&&R===0)return G.contents=c.slice(g,g+C),G.usedBytes=C,C;if(R+C<=G.usedBytes)return G.contents.set(c.subarray(g,g+C),R),C}if(ve.expandFileStorage(G,R+C),G.contents.subarray&&c.subarray)G.contents.set(c.subarray(g,g+C),R);else for(var N=0;N<C;N++)G.contents[R+N]=c[g+N];return G.usedBytes=Math.max(G.usedBytes,R+C),C},llseek:function(l,c,g){var C=c;if(g===1?C+=l.position:g===2&&O.isFile(l.node.mode)&&(C+=l.node.usedBytes),C<0)throw new O.ErrnoError(28);return C},allocate:function(l,c,g){ve.expandFileStorage(l.node,c+g),l.node.usedBytes=Math.max(l.node.usedBytes,c+g)},mmap:function(l,c,g,C,R){if(!O.isFile(l.node.mode))throw new O.ErrnoError(43);var k,G,N=l.node.contents;if(!(R&2)&&N.buffer===pe)G=!1,k=N.byteOffset;else{if((g>0||g+c<N.length)&&(N.subarray?N=N.subarray(g,g+c):N=Array.prototype.slice.call(N,g,g+c)),G=!0,k=sr(c),!k)throw new O.ErrnoError(48);ae.set(N,k)}return{ptr:k,allocated:G}},msync:function(l,c,g,C,R){if(!O.isFile(l.node.mode))throw new O.ErrnoError(43);return R&2||ve.stream_ops.write(l,c,0,C,g,!1),0}}};function Hr(l,c,g,C){var R=C?"":"al "+l;x(l,function(k){T(k,'Loading data file "'+l+'" failed (no arrayBuffer).'),c(new Uint8Array(k)),R&&Ee()},function(k){if(g)g();else throw'Loading data file "'+l+'" failed.'}),R&&He()}var O={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(l,c={})=>{if(l=tt.resolve(O.cwd(),l),!l)return{path:"",node:null};var g={follow_mount:!0,recurse_count:0};if(c=Object.assign(g,c),c.recurse_count>8)throw new O.ErrnoError(32);for(var C=we.normalizeArray(l.split("/").filter(re=>!!re),!1),R=O.root,k="/",G=0;G<C.length;G++){var N=G===C.length-1;if(N&&c.parent)break;if(R=O.lookupNode(R,C[G]),k=we.join2(k,C[G]),O.isMountpoint(R)&&(!N||N&&c.follow_mount)&&(R=R.mounted.root),!N||c.follow)for(var W=0;O.isLink(R.mode);){var j=O.readlink(k);k=tt.resolve(we.dirname(k),j);var te=O.lookupPath(k,{recurse_count:c.recurse_count+1});if(R=te.node,W++>40)throw new O.ErrnoError(32)}}return{path:k,node:R}},getPath:l=>{for(var c;;){if(O.isRoot(l)){var g=l.mount.mountpoint;return c?g[g.length-1]!=="/"?g+"/"+c:g+c:g}c=c?l.name+"/"+c:l.name,l=l.parent}},hashName:(l,c)=>{for(var g=0,C=0;C<c.length;C++)g=(g<<5)-g+c.charCodeAt(C)|0;return(l+g>>>0)%O.nameTable.length},hashAddNode:l=>{var c=O.hashName(l.parent.id,l.name);l.name_next=O.nameTable[c],O.nameTable[c]=l},hashRemoveNode:l=>{var c=O.hashName(l.parent.id,l.name);if(O.nameTable[c]===l)O.nameTable[c]=l.name_next;else for(var g=O.nameTable[c];g;){if(g.name_next===l){g.name_next=l.name_next;break}g=g.name_next}},lookupNode:(l,c)=>{var g=O.mayLookup(l);if(g)throw new O.ErrnoError(g,l);for(var C=O.hashName(l.id,c),R=O.nameTable[C];R;R=R.name_next){var k=R.name;if(R.parent.id===l.id&&k===c)return R}return O.lookup(l,c)},createNode:(l,c,g,C)=>{var R=new O.FSNode(l,c,g,C);return O.hashAddNode(R),R},destroyNode:l=>{O.hashRemoveNode(l)},isRoot:l=>l===l.parent,isMountpoint:l=>!!l.mounted,isFile:l=>(l&61440)===32768,isDir:l=>(l&61440)===16384,isLink:l=>(l&61440)===40960,isChrdev:l=>(l&61440)===8192,isBlkdev:l=>(l&61440)===24576,isFIFO:l=>(l&61440)===4096,isSocket:l=>(l&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:l=>{var c=O.flagModes[l];if(typeof c>"u")throw new Error("Unknown file open mode: "+l);return c},flagsToPermissionString:l=>{var c=["r","w","rw"][l&3];return l&512&&(c+="w"),c},nodePermissions:(l,c)=>O.ignorePermissions?0:c.includes("r")&&!(l.mode&292)||c.includes("w")&&!(l.mode&146)||c.includes("x")&&!(l.mode&73)?2:0,mayLookup:l=>{var c=O.nodePermissions(l,"x");return c||(l.node_ops.lookup?0:2)},mayCreate:(l,c)=>{try{var g=O.lookupNode(l,c);return 20}catch{}return O.nodePermissions(l,"wx")},mayDelete:(l,c,g)=>{var C;try{C=O.lookupNode(l,c)}catch(k){return k.errno}var R=O.nodePermissions(l,"wx");if(R)return R;if(g){if(!O.isDir(C.mode))return 54;if(O.isRoot(C)||O.getPath(C)===O.cwd())return 10}else if(O.isDir(C.mode))return 31;return 0},mayOpen:(l,c)=>l?O.isLink(l.mode)?32:O.isDir(l.mode)&&(O.flagsToPermissionString(c)!=="r"||c&512)?31:O.nodePermissions(l,O.flagsToPermissionString(c)):44,MAX_OPEN_FDS:4096,nextfd:(l=0,c=O.MAX_OPEN_FDS)=>{for(var g=l;g<=c;g++)if(!O.streams[g])return g;throw new O.ErrnoError(33)},getStream:l=>O.streams[l],createStream:(l,c,g)=>{O.FSStream||(O.FSStream=function(){this.shared={}},O.FSStream.prototype={},Object.defineProperties(O.FSStream.prototype,{object:{get:function(){return this.node},set:function(R){this.node=R}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(R){this.shared.flags=R}},position:{get:function(){return this.shared.position},set:function(R){this.shared.position=R}}})),l=Object.assign(new O.FSStream,l);var C=O.nextfd(c,g);return l.fd=C,O.streams[C]=l,l},closeStream:l=>{O.streams[l]=null},chrdev_stream_ops:{open:l=>{var c=O.getDevice(l.node.rdev);l.stream_ops=c.stream_ops,l.stream_ops.open&&l.stream_ops.open(l)},llseek:()=>{throw new O.ErrnoError(70)}},major:l=>l>>8,minor:l=>l&255,makedev:(l,c)=>l<<8|c,registerDevice:(l,c)=>{O.devices[l]={stream_ops:c}},getDevice:l=>O.devices[l],getMounts:l=>{for(var c=[],g=[l];g.length;){var C=g.pop();c.push(C),g.push.apply(g,C.mounts)}return c},syncfs:(l,c)=>{typeof l=="function"&&(c=l,l=!1),O.syncFSRequests++,O.syncFSRequests>1&&P("warning: "+O.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var g=O.getMounts(O.root.mount),C=0;function R(G){return O.syncFSRequests--,c(G)}function k(G){if(G)return k.errored?void 0:(k.errored=!0,R(G));++C>=g.length&&R(null)}g.forEach(G=>{if(!G.type.syncfs)return k(null);G.type.syncfs(G,l,k)})},mount:(l,c,g)=>{var C=g==="/",R=!g,k;if(C&&O.root)throw new O.ErrnoError(10);if(!C&&!R){var G=O.lookupPath(g,{follow_mount:!1});if(g=G.path,k=G.node,O.isMountpoint(k))throw new O.ErrnoError(10);if(!O.isDir(k.mode))throw new O.ErrnoError(54)}var N={type:l,opts:c,mountpoint:g,mounts:[]},W=l.mount(N);return W.mount=N,N.root=W,C?O.root=W:k&&(k.mounted=N,k.mount&&k.mount.mounts.push(N)),W},unmount:l=>{var c=O.lookupPath(l,{follow_mount:!1});if(!O.isMountpoint(c.node))throw new O.ErrnoError(28);var g=c.node,C=g.mounted,R=O.getMounts(C);Object.keys(O.nameTable).forEach(G=>{for(var N=O.nameTable[G];N;){var W=N.name_next;R.includes(N.mount)&&O.destroyNode(N),N=W}}),g.mounted=null;var k=g.mount.mounts.indexOf(C);g.mount.mounts.splice(k,1)},lookup:(l,c)=>l.node_ops.lookup(l,c),mknod:(l,c,g)=>{var C=O.lookupPath(l,{parent:!0}),R=C.node,k=we.basename(l);if(!k||k==="."||k==="..")throw new O.ErrnoError(28);var G=O.mayCreate(R,k);if(G)throw new O.ErrnoError(G);if(!R.node_ops.mknod)throw new O.ErrnoError(63);return R.node_ops.mknod(R,k,c,g)},create:(l,c)=>(c=c!==void 0?c:438,c&=4095,c|=32768,O.mknod(l,c,0)),mkdir:(l,c)=>(c=c!==void 0?c:511,c&=1023,c|=16384,O.mknod(l,c,0)),mkdirTree:(l,c)=>{for(var g=l.split("/"),C="",R=0;R<g.length;++R)if(g[R]){C+="/"+g[R];try{O.mkdir(C,c)}catch(k){if(k.errno!=20)throw k}}},mkdev:(l,c,g)=>(typeof g>"u"&&(g=c,c=438),c|=8192,O.mknod(l,c,g)),symlink:(l,c)=>{if(!tt.resolve(l))throw new O.ErrnoError(44);var g=O.lookupPath(c,{parent:!0}),C=g.node;if(!C)throw new O.ErrnoError(44);var R=we.basename(c),k=O.mayCreate(C,R);if(k)throw new O.ErrnoError(k);if(!C.node_ops.symlink)throw new O.ErrnoError(63);return C.node_ops.symlink(C,R,l)},rename:(l,c)=>{var g=we.dirname(l),C=we.dirname(c),R=we.basename(l),k=we.basename(c),G,N,W;if(G=O.lookupPath(l,{parent:!0}),N=G.node,G=O.lookupPath(c,{parent:!0}),W=G.node,!N||!W)throw new O.ErrnoError(44);if(N.mount!==W.mount)throw new O.ErrnoError(75);var j=O.lookupNode(N,R),te=tt.relative(l,C);if(te.charAt(0)!==".")throw new O.ErrnoError(28);if(te=tt.relative(c,g),te.charAt(0)!==".")throw new O.ErrnoError(55);var re;try{re=O.lookupNode(W,k)}catch{}if(j!==re){var Q=O.isDir(j.mode),ne=O.mayDelete(N,R,Q);if(ne)throw new O.ErrnoError(ne);if(ne=re?O.mayDelete(W,k,Q):O.mayCreate(W,k),ne)throw new O.ErrnoError(ne);if(!N.node_ops.rename)throw new O.ErrnoError(63);if(O.isMountpoint(j)||re&&O.isMountpoint(re))throw new O.ErrnoError(10);if(W!==N&&(ne=O.nodePermissions(N,"w"),ne))throw new O.ErrnoError(ne);O.hashRemoveNode(j);try{N.node_ops.rename(j,W,k)}catch(fe){throw fe}finally{O.hashAddNode(j)}}},rmdir:l=>{var c=O.lookupPath(l,{parent:!0}),g=c.node,C=we.basename(l),R=O.lookupNode(g,C),k=O.mayDelete(g,C,!0);if(k)throw new O.ErrnoError(k);if(!g.node_ops.rmdir)throw new O.ErrnoError(63);if(O.isMountpoint(R))throw new O.ErrnoError(10);g.node_ops.rmdir(g,C),O.destroyNode(R)},readdir:l=>{var c=O.lookupPath(l,{follow:!0}),g=c.node;if(!g.node_ops.readdir)throw new O.ErrnoError(54);return g.node_ops.readdir(g)},unlink:l=>{var c=O.lookupPath(l,{parent:!0}),g=c.node;if(!g)throw new O.ErrnoError(44);var C=we.basename(l),R=O.lookupNode(g,C),k=O.mayDelete(g,C,!1);if(k)throw new O.ErrnoError(k);if(!g.node_ops.unlink)throw new O.ErrnoError(63);if(O.isMountpoint(R))throw new O.ErrnoError(10);g.node_ops.unlink(g,C),O.destroyNode(R)},readlink:l=>{var c=O.lookupPath(l),g=c.node;if(!g)throw new O.ErrnoError(44);if(!g.node_ops.readlink)throw new O.ErrnoError(28);return tt.resolve(O.getPath(g.parent),g.node_ops.readlink(g))},stat:(l,c)=>{var g=O.lookupPath(l,{follow:!c}),C=g.node;if(!C)throw new O.ErrnoError(44);if(!C.node_ops.getattr)throw new O.ErrnoError(63);return C.node_ops.getattr(C)},lstat:l=>O.stat(l,!0),chmod:(l,c,g)=>{var C;if(typeof l=="string"){var R=O.lookupPath(l,{follow:!g});C=R.node}else C=l;if(!C.node_ops.setattr)throw new O.ErrnoError(63);C.node_ops.setattr(C,{mode:c&4095|C.mode&-4096,timestamp:Date.now()})},lchmod:(l,c)=>{O.chmod(l,c,!0)},fchmod:(l,c)=>{var g=O.getStream(l);if(!g)throw new O.ErrnoError(8);O.chmod(g.node,c)},chown:(l,c,g,C)=>{var R;if(typeof l=="string"){var k=O.lookupPath(l,{follow:!C});R=k.node}else R=l;if(!R.node_ops.setattr)throw new O.ErrnoError(63);R.node_ops.setattr(R,{timestamp:Date.now()})},lchown:(l,c,g)=>{O.chown(l,c,g,!0)},fchown:(l,c,g)=>{var C=O.getStream(l);if(!C)throw new O.ErrnoError(8);O.chown(C.node,c,g)},truncate:(l,c)=>{if(c<0)throw new O.ErrnoError(28);var g;if(typeof l=="string"){var C=O.lookupPath(l,{follow:!0});g=C.node}else g=l;if(!g.node_ops.setattr)throw new O.ErrnoError(63);if(O.isDir(g.mode))throw new O.ErrnoError(31);if(!O.isFile(g.mode))throw new O.ErrnoError(28);var R=O.nodePermissions(g,"w");if(R)throw new O.ErrnoError(R);g.node_ops.setattr(g,{size:c,timestamp:Date.now()})},ftruncate:(l,c)=>{var g=O.getStream(l);if(!g)throw new O.ErrnoError(8);if(!(g.flags&2097155))throw new O.ErrnoError(28);O.truncate(g.node,c)},utime:(l,c,g)=>{var C=O.lookupPath(l,{follow:!0}),R=C.node;R.node_ops.setattr(R,{timestamp:Math.max(c,g)})},open:(l,c,g)=>{if(l==="")throw new O.ErrnoError(44);c=typeof c=="string"?O.modeStringToFlags(c):c,g=typeof g>"u"?438:g,c&64?g=g&4095|32768:g=0;var C;if(typeof l=="object")C=l;else{l=we.normalize(l);try{var R=O.lookupPath(l,{follow:!(c&131072)});C=R.node}catch{}}var k=!1;if(c&64)if(C){if(c&128)throw new O.ErrnoError(20)}else C=O.mknod(l,g,0),k=!0;if(!C)throw new O.ErrnoError(44);if(O.isChrdev(C.mode)&&(c&=-513),c&65536&&!O.isDir(C.mode))throw new O.ErrnoError(54);if(!k){var G=O.mayOpen(C,c);if(G)throw new O.ErrnoError(G)}c&512&&!k&&O.truncate(C,0),c&=-131713;var N=O.createStream({node:C,path:O.getPath(C),flags:c,seekable:!0,position:0,stream_ops:C.stream_ops,ungotten:[],error:!1});return N.stream_ops.open&&N.stream_ops.open(N),r.logReadFiles&&!(c&1)&&(O.readFiles||(O.readFiles={}),l in O.readFiles||(O.readFiles[l]=1)),N},close:l=>{if(O.isClosed(l))throw new O.ErrnoError(8);l.getdents&&(l.getdents=null);try{l.stream_ops.close&&l.stream_ops.close(l)}catch(c){throw c}finally{O.closeStream(l.fd)}l.fd=null},isClosed:l=>l.fd===null,llseek:(l,c,g)=>{if(O.isClosed(l))throw new O.ErrnoError(8);if(!l.seekable||!l.stream_ops.llseek)throw new O.ErrnoError(70);if(g!=0&&g!=1&&g!=2)throw new O.ErrnoError(28);return l.position=l.stream_ops.llseek(l,c,g),l.ungotten=[],l.position},read:(l,c,g,C,R)=>{if(C<0||R<0)throw new O.ErrnoError(28);if(O.isClosed(l))throw new O.ErrnoError(8);if((l.flags&2097155)===1)throw new O.ErrnoError(8);if(O.isDir(l.node.mode))throw new O.ErrnoError(31);if(!l.stream_ops.read)throw new O.ErrnoError(28);var k=typeof R<"u";if(!k)R=l.position;else if(!l.seekable)throw new O.ErrnoError(70);var G=l.stream_ops.read(l,c,g,C,R);return k||(l.position+=G),G},write:(l,c,g,C,R,k)=>{if(C<0||R<0)throw new O.ErrnoError(28);if(O.isClosed(l))throw new O.ErrnoError(8);if(!(l.flags&2097155))throw new O.ErrnoError(8);if(O.isDir(l.node.mode))throw new O.ErrnoError(31);if(!l.stream_ops.write)throw new O.ErrnoError(28);l.seekable&&l.flags&1024&&O.llseek(l,0,2);var G=typeof R<"u";if(!G)R=l.position;else if(!l.seekable)throw new O.ErrnoError(70);var N=l.stream_ops.write(l,c,g,C,R,k);return G||(l.position+=N),N},allocate:(l,c,g)=>{if(O.isClosed(l))throw new O.ErrnoError(8);if(c<0||g<=0)throw new O.ErrnoError(28);if(!(l.flags&2097155))throw new O.ErrnoError(8);if(!O.isFile(l.node.mode)&&!O.isDir(l.node.mode))throw new O.ErrnoError(43);if(!l.stream_ops.allocate)throw new O.ErrnoError(138);l.stream_ops.allocate(l,c,g)},mmap:(l,c,g,C,R)=>{if(C&2&&!(R&2)&&(l.flags&2097155)!==2)throw new O.ErrnoError(2);if((l.flags&2097155)===1)throw new O.ErrnoError(2);if(!l.stream_ops.mmap)throw new O.ErrnoError(43);return l.stream_ops.mmap(l,c,g,C,R)},msync:(l,c,g,C,R)=>!l||!l.stream_ops.msync?0:l.stream_ops.msync(l,c,g,C,R),munmap:l=>0,ioctl:(l,c,g)=>{if(!l.stream_ops.ioctl)throw new O.ErrnoError(59);return l.stream_ops.ioctl(l,c,g)},readFile:(l,c={})=>{if(c.flags=c.flags||0,c.encoding=c.encoding||"binary",c.encoding!=="utf8"&&c.encoding!=="binary")throw new Error('Invalid encoding type "'+c.encoding+'"');var g,C=O.open(l,c.flags),R=O.stat(l),k=R.size,G=new Uint8Array(k);return O.read(C,G,0,k,0),c.encoding==="utf8"?g=_(G,0):c.encoding==="binary"&&(g=G),O.close(C),g},writeFile:(l,c,g={})=>{g.flags=g.flags||577;var C=O.open(l,g.flags,g.mode);if(typeof c=="string"){var R=new Uint8Array(q(c)+1),k=z(c,R,0,R.length);O.write(C,R,0,k,void 0,g.canOwn)}else if(ArrayBuffer.isView(c))O.write(C,c,0,c.byteLength,void 0,g.canOwn);else throw new Error("Unsupported data type");O.close(C)},cwd:()=>O.currentPath,chdir:l=>{var c=O.lookupPath(l,{follow:!0});if(c.node===null)throw new O.ErrnoError(44);if(!O.isDir(c.node.mode))throw new O.ErrnoError(54);var g=O.nodePermissions(c.node,"x");if(g)throw new O.ErrnoError(g);O.currentPath=c.path},createDefaultDirectories:()=>{O.mkdir("/tmp"),O.mkdir("/home"),O.mkdir("/home/web_user")},createDefaultDevices:()=>{O.mkdir("/dev"),O.registerDevice(O.makedev(1,3),{read:()=>0,write:(c,g,C,R,k)=>R}),O.mkdev("/dev/null",O.makedev(1,3)),ct.register(O.makedev(5,0),ct.default_tty_ops),ct.register(O.makedev(6,0),ct.default_tty1_ops),O.mkdev("/dev/tty",O.makedev(5,0)),O.mkdev("/dev/tty1",O.makedev(6,0));var l=Nr();O.createDevice("/dev","random",l),O.createDevice("/dev","urandom",l),O.mkdir("/dev/shm"),O.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{O.mkdir("/proc");var l=O.mkdir("/proc/self");O.mkdir("/proc/self/fd"),O.mount({mount:()=>{var c=O.createNode(l,"fd",16895,73);return c.node_ops={lookup:(g,C)=>{var R=+C,k=O.getStream(R);if(!k)throw new O.ErrnoError(8);var G={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>k.path}};return G.parent=G,G}},c}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?O.createDevice("/dev","stdin",r.stdin):O.symlink("/dev/tty","/dev/stdin"),r.stdout?O.createDevice("/dev","stdout",null,r.stdout):O.symlink("/dev/tty","/dev/stdout"),r.stderr?O.createDevice("/dev","stderr",null,r.stderr):O.symlink("/dev/tty1","/dev/stderr"),O.open("/dev/stdin",0),O.open("/dev/stdout",1),O.open("/dev/stderr",1)},ensureErrnoError:()=>{O.ErrnoError||(O.ErrnoError=function(c,g){this.node=g,this.setErrno=function(C){this.errno=C},this.setErrno(c),this.message="FS error"},O.ErrnoError.prototype=new Error,O.ErrnoError.prototype.constructor=O.ErrnoError,[44].forEach(l=>{O.genericErrors[l]=new O.ErrnoError(l),O.genericErrors[l].stack="<generic error, no stack>"}))},staticInit:()=>{O.ensureErrnoError(),O.nameTable=new Array(4096),O.mount(ve,{},"/"),O.createDefaultDirectories(),O.createDefaultDevices(),O.createSpecialDirectories(),O.filesystems={MEMFS:ve}},init:(l,c,g)=>{O.init.initialized=!0,O.ensureErrnoError(),r.stdin=l||r.stdin,r.stdout=c||r.stdout,r.stderr=g||r.stderr,O.createStandardStreams()},quit:()=>{O.init.initialized=!1;for(var l=0;l<O.streams.length;l++){var c=O.streams[l];c&&O.close(c)}},getMode:(l,c)=>{var g=0;return l&&(g|=365),c&&(g|=146),g},findObject:(l,c)=>{var g=O.analyzePath(l,c);return g.exists?g.object:null},analyzePath:(l,c)=>{try{var g=O.lookupPath(l,{follow:!c});l=g.path}catch{}var C={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var g=O.lookupPath(l,{parent:!0});C.parentExists=!0,C.parentPath=g.path,C.parentObject=g.node,C.name=we.basename(l),g=O.lookupPath(l,{follow:!c}),C.exists=!0,C.path=g.path,C.object=g.node,C.name=g.node.name,C.isRoot=g.path==="/"}catch(R){C.error=R.errno}return C},createPath:(l,c,g,C)=>{l=typeof l=="string"?l:O.getPath(l);for(var R=c.split("/").reverse();R.length;){var k=R.pop();if(k){var G=we.join2(l,k);try{O.mkdir(G)}catch{}l=G}}return G},createFile:(l,c,g,C,R)=>{var k=we.join2(typeof l=="string"?l:O.getPath(l),c),G=O.getMode(C,R);return O.create(k,G)},createDataFile:(l,c,g,C,R,k)=>{var G=c;l&&(l=typeof l=="string"?l:O.getPath(l),G=c?we.join2(l,c):l);var N=O.getMode(C,R),W=O.create(G,N);if(g){if(typeof g=="string"){for(var j=new Array(g.length),te=0,re=g.length;te<re;++te)j[te]=g.charCodeAt(te);g=j}O.chmod(W,N|146);var Q=O.open(W,577);O.write(Q,g,0,g.length,0,k),O.close(Q),O.chmod(W,N)}return W},createDevice:(l,c,g,C)=>{var R=we.join2(typeof l=="string"?l:O.getPath(l),c),k=O.getMode(!!g,!!C);O.createDevice.major||(O.createDevice.major=64);var G=O.makedev(O.createDevice.major++,0);return O.registerDevice(G,{open:N=>{N.seekable=!1},close:N=>{C&&C.buffer&&C.buffer.length&&C(10)},read:(N,W,j,te,re)=>{for(var Q=0,ne=0;ne<te;ne++){var fe;try{fe=g()}catch{throw new O.ErrnoError(29)}if(fe===void 0&&Q===0)throw new O.ErrnoError(6);if(fe==null)break;Q++,W[j+ne]=fe}return Q&&(N.node.timestamp=Date.now()),Q},write:(N,W,j,te,re)=>{for(var Q=0;Q<te;Q++)try{C(W[j+Q])}catch{throw new O.ErrnoError(29)}return te&&(N.node.timestamp=Date.now()),Q}}),O.mkdev(R,k,G)},forceLoadFile:l=>{if(l.isDevice||l.isFolder||l.link||l.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(S)try{l.contents=Gt(S(l.url),!0),l.usedBytes=l.contents.length}catch{throw new O.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(l,c,g,C,R)=>{function k(){this.lengthKnown=!1,this.chunks=[]}if(k.prototype.get=function(ne){if(!(ne>this.length-1||ne<0)){var fe=ne%this.chunkSize,Pe=ne/this.chunkSize|0;return this.getter(Pe)[fe]}},k.prototype.setDataGetter=function(ne){this.getter=ne},k.prototype.cacheLength=function(){var ne=new XMLHttpRequest;if(ne.open("HEAD",g,!1),ne.send(null),!(ne.status>=200&&ne.status<300||ne.status===304))throw new Error("Couldn't load "+g+". Status: "+ne.status);var fe=Number(ne.getResponseHeader("Content-length")),Pe,Oe=(Pe=ne.getResponseHeader("Accept-Ranges"))&&Pe==="bytes",Be=(Pe=ne.getResponseHeader("Content-Encoding"))&&Pe==="gzip",Z=1024*1024;Oe||(Z=fe);var ue=(Ce,Ye)=>{if(Ce>Ye)throw new Error("invalid range ("+Ce+", "+Ye+") or no bytes requested!");if(Ye>fe-1)throw new Error("only "+fe+" bytes available! programmer error!");var Le=new XMLHttpRequest;if(Le.open("GET",g,!1),fe!==Z&&Le.setRequestHeader("Range","bytes="+Ce+"-"+Ye),Le.responseType="arraybuffer",Le.overrideMimeType&&Le.overrideMimeType("text/plain; charset=x-user-defined"),Le.send(null),!(Le.status>=200&&Le.status<300||Le.status===304))throw new Error("Couldn't load "+g+". Status: "+Le.status);return Le.response!==void 0?new Uint8Array(Le.response||[]):Gt(Le.responseText||"",!0)},ke=this;ke.setDataGetter(Ce=>{var Ye=Ce*Z,Le=(Ce+1)*Z-1;if(Le=Math.min(Le,fe-1),typeof ke.chunks[Ce]>"u"&&(ke.chunks[Ce]=ue(Ye,Le)),typeof ke.chunks[Ce]>"u")throw new Error("doXHR failed!");return ke.chunks[Ce]}),(Be||!fe)&&(Z=fe=1,fe=this.getter(0).length,Z=fe,E("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=fe,this._chunkSize=Z,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var G=new k;Object.defineProperties(G,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var N={isDevice:!1,contents:G}}else var N={isDevice:!1,url:g};var W=O.createFile(l,c,N,C,R);N.contents?W.contents=N.contents:N.url&&(W.contents=null,W.url=N.url),Object.defineProperties(W,{usedBytes:{get:function(){return this.contents.length}}});var j={},te=Object.keys(W.stream_ops);te.forEach(Q=>{var ne=W.stream_ops[Q];j[Q]=function(){return O.forceLoadFile(W),ne.apply(null,arguments)}});function re(Q,ne,fe,Pe,Oe){var Be=Q.node.contents;if(Oe>=Be.length)return 0;var Z=Math.min(Be.length-Oe,Pe);if(Be.slice)for(var ue=0;ue<Z;ue++)ne[fe+ue]=Be[Oe+ue];else for(var ue=0;ue<Z;ue++)ne[fe+ue]=Be.get(Oe+ue);return Z}return j.read=(Q,ne,fe,Pe,Oe)=>(O.forceLoadFile(W),re(Q,ne,fe,Pe,Oe)),j.mmap=(Q,ne,fe,Pe,Oe)=>{O.forceLoadFile(W);var Be=sr(ne);if(!Be)throw new O.ErrnoError(48);return re(Q,ae,Be,ne,fe),{ptr:Be,allocated:!0}},W.stream_ops=j,W},createPreloadedFile:(l,c,g,C,R,k,G,N,W,j)=>{var te=c?tt.resolve(we.join2(l,c)):l;function re(Q){function ne(fe){j&&j(),N||O.createDataFile(l,c,fe,C,R,W),k&&k(),Ee()}Browser.handledByPreloadPlugin(Q,te,ne,()=>{G&&G(),Ee()})||ne(Q)}He(),typeof g=="string"?Hr(g,Q=>re(Q),G):re(g)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(l,c,g)=>{c=c||(()=>{}),g=g||(()=>{});var C=O.indexedDB();try{var R=C.open(O.DB_NAME(),O.DB_VERSION)}catch(k){return g(k)}R.onupgradeneeded=()=>{E("creating db");var k=R.result;k.createObjectStore(O.DB_STORE_NAME)},R.onsuccess=()=>{var k=R.result,G=k.transaction([O.DB_STORE_NAME],"readwrite"),N=G.objectStore(O.DB_STORE_NAME),W=0,j=0,te=l.length;function re(){j==0?c():g()}l.forEach(Q=>{var ne=N.put(O.analyzePath(Q).object.contents,Q);ne.onsuccess=()=>{W++,W+j==te&&re()},ne.onerror=()=>{j++,W+j==te&&re()}}),G.onerror=g},R.onerror=g},loadFilesFromDB:(l,c,g)=>{c=c||(()=>{}),g=g||(()=>{});var C=O.indexedDB();try{var R=C.open(O.DB_NAME(),O.DB_VERSION)}catch(k){return g(k)}R.onupgradeneeded=g,R.onsuccess=()=>{var k=R.result;try{var G=k.transaction([O.DB_STORE_NAME],"readonly")}catch(Q){g(Q);return}var N=G.objectStore(O.DB_STORE_NAME),W=0,j=0,te=l.length;function re(){j==0?c():g()}l.forEach(Q=>{var ne=N.get(Q);ne.onsuccess=()=>{O.analyzePath(Q).exists&&O.unlink(Q),O.createDataFile(we.dirname(Q),we.basename(Q),ne.result,!0,!0,!0),W++,W+j==te&&re()},ne.onerror=()=>{j++,W+j==te&&re()}}),G.onerror=g},R.onerror=g}},be={DEFAULT_POLLMASK:5,calculateAt:function(l,c,g){if(we.isAbs(c))return c;var C;if(l===-100)C=O.cwd();else{var R=O.getStream(l);if(!R)throw new O.ErrnoError(8);C=R.path}if(c.length==0){if(!g)throw new O.ErrnoError(44);return C}return we.join2(C,c)},doStat:function(l,c,g){try{var C=l(c)}catch(R){if(R&&R.node&&we.normalize(c)!==we.normalize(O.getPath(R.node)))return-54;throw R}return K[g>>2]=C.dev,K[g+4>>2]=0,K[g+8>>2]=C.ino,K[g+12>>2]=C.mode,K[g+16>>2]=C.nlink,K[g+20>>2]=C.uid,K[g+24>>2]=C.gid,K[g+28>>2]=C.rdev,K[g+32>>2]=0,et=[C.size>>>0,(Ne=C.size,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],K[g+40>>2]=et[0],K[g+44>>2]=et[1],K[g+48>>2]=4096,K[g+52>>2]=C.blocks,K[g+56>>2]=C.atime.getTime()/1e3|0,K[g+60>>2]=0,K[g+64>>2]=C.mtime.getTime()/1e3|0,K[g+68>>2]=0,K[g+72>>2]=C.ctime.getTime()/1e3|0,K[g+76>>2]=0,et=[C.ino>>>0,(Ne=C.ino,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],K[g+80>>2]=et[0],K[g+84>>2]=et[1],0},doMsync:function(l,c,g,C,R){var k=ce.slice(l,l+g);O.msync(c,k,R,g,C)},varargs:void 0,get:function(){be.varargs+=4;var l=K[be.varargs-4>>2];return l},getStr:function(l){var c=D(l);return c},getStreamFromFD:function(l){var c=O.getStream(l);if(!c)throw new O.ErrnoError(8);return c}};function Wr(l,c){try{return l=be.getStr(l),O.chmod(l,c),0}catch(g){if(typeof O>"u"||!(g instanceof O.ErrnoError))throw g;return-g.errno}}function $r(l,c,g,C){try{if(c=be.getStr(c),c=be.calculateAt(l,c),g&-8)return-28;var R=O.lookupPath(c,{follow:!0}),k=R.node;if(!k)return-44;var G="";return g&4&&(G+="r"),g&2&&(G+="w"),g&1&&(G+="x"),G&&O.nodePermissions(k,G)?-2:0}catch(N){if(typeof O>"u"||!(N instanceof O.ErrnoError))throw N;return-N.errno}}function qr(l){return K[_r()>>2]=l,l}function jr(l,c,g){be.varargs=g;try{var C=be.getStreamFromFD(l);switch(c){case 0:{var R=be.get();if(R<0)return-28;var k;return k=O.createStream(C,R),k.fd}case 1:case 2:return 0;case 3:return C.flags;case 4:{var R=be.get();return C.flags|=R,0}case 5:{var R=be.get(),G=0;return Ae[R+G>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return qr(28),-1;default:return-28}}catch(N){if(typeof O>"u"||!(N instanceof O.ErrnoError))throw N;return-N.errno}}function Xr(l,c){try{var g=be.getStreamFromFD(l);return be.doStat(O.stat,g.path,c)}catch(C){if(typeof O>"u"||!(C instanceof O.ErrnoError))throw C;return-C.errno}}function Yr(l,c,g){be.varargs=g;try{var C=be.getStreamFromFD(l);switch(c){case 21509:case 21505:return C.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return C.tty?0:-59;case 21519:{if(!C.tty)return-59;var R=be.get();return K[R>>2]=0,0}case 21520:return C.tty?-28:-59;case 21531:{var R=be.get();return O.ioctl(C,c,R)}case 21523:return C.tty?0:-59;case 21524:return C.tty?0:-59;default:ze("bad ioctl syscall "+c)}}catch(k){if(typeof O>"u"||!(k instanceof O.ErrnoError))throw k;return-k.errno}}function Zr(l,c){try{return l=be.getStr(l),be.doStat(O.lstat,l,c)}catch(g){if(typeof O>"u"||!(g instanceof O.ErrnoError))throw g;return-g.errno}}function Kr(l,c,g,C){try{c=be.getStr(c);var R=C&256,k=C&4096;return C=C&-4353,c=be.calculateAt(l,c,k),be.doStat(R?O.lstat:O.stat,c,g)}catch(G){if(typeof O>"u"||!(G instanceof O.ErrnoError))throw G;return-G.errno}}function Qr(l,c,g,C){be.varargs=C;try{c=be.getStr(c),c=be.calculateAt(l,c);var R=C?be.get():0;return O.open(c,g,R).fd}catch(k){if(typeof O>"u"||!(k instanceof O.ErrnoError))throw k;return-k.errno}}function Jr(l,c){try{return l=be.getStr(l),be.doStat(O.stat,l,c)}catch(g){if(typeof O>"u"||!(g instanceof O.ErrnoError))throw g;return-g.errno}}function en(l,c,g,C,R){}function Et(l){switch(l){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+l)}}function tn(){for(var l=new Array(256),c=0;c<256;++c)l[c]=String.fromCharCode(c);ur=l}var ur=void 0;function $e(l){for(var c="",g=l;ce[g];)c+=ur[ce[g++]];return c}var dt={},ft={},Ct={},rn=48,nn=57;function Tt(l){if(l===void 0)return"_unknown";l=l.replace(/[^a-zA-Z0-9_]/g,"$");var c=l.charCodeAt(0);return c>=rn&&c<=nn?"_"+l:l}function _t(l,c){return l=Tt(l),new Function("body","return function "+l+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(c)}function Vt(l,c){var g=_t(c,function(C){this.name=c,this.message=C;var R=new Error(C).stack;R!==void 0&&(this.stack=this.toString()+`
`+R.replace(/^Error(:[^\n]*)?\n/,""))});return g.prototype=Object.create(l.prototype),g.prototype.constructor=g,g.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},g}var vt=void 0;function Se(l){throw new vt(l)}var lr=void 0;function At(l){throw new lr(l)}function ht(l,c,g){l.forEach(function(N){Ct[N]=c});function C(N){var W=g(N);W.length!==l.length&&At("Mismatched type converter count");for(var j=0;j<l.length;++j)Je(l[j],W[j])}var R=new Array(c.length),k=[],G=0;c.forEach((N,W)=>{ft.hasOwnProperty(N)?R[W]=ft[N]:(k.push(N),dt.hasOwnProperty(N)||(dt[N]=[]),dt[N].push(()=>{R[W]=ft[N],++G,G===k.length&&C(R)}))}),k.length===0&&C(R)}function Je(l,c,g={}){if(!("argPackAdvance"in c))throw new TypeError("registerType registeredInstance requires argPackAdvance");var C=c.name;if(l||Se('type "'+C+'" must have a positive integer typeid pointer'),ft.hasOwnProperty(l)){if(g.ignoreDuplicateRegistrations)return;Se("Cannot register type '"+C+"' twice")}if(ft[l]=c,delete Ct[l],dt.hasOwnProperty(l)){var R=dt[l];delete dt[l],R.forEach(k=>k())}}function on(l,c,g,C,R){var k=Et(g);c=$e(c),Je(l,{name:c,fromWireType:function(G){return!!G},toWireType:function(G,N){return N?C:R},argPackAdvance:8,readValueFromPointer:function(G){var N;if(g===1)N=ae;else if(g===2)N=Ae;else if(g===4)N=K;else throw new TypeError("Unknown boolean type size: "+c);return this.fromWireType(N[G>>k])},destructorFunction:null})}function an(l){if(!(this instanceof st)||!(l instanceof st))return!1;for(var c=this.$$.ptrType.registeredClass,g=this.$$.ptr,C=l.$$.ptrType.registeredClass,R=l.$$.ptr;c.baseClass;)g=c.upcast(g),c=c.baseClass;for(;C.baseClass;)R=C.upcast(R),C=C.baseClass;return c===C&&g===R}function sn(l){return{count:l.count,deleteScheduled:l.deleteScheduled,preservePointerOnDelete:l.preservePointerOnDelete,ptr:l.ptr,ptrType:l.ptrType,smartPtr:l.smartPtr,smartPtrType:l.smartPtrType}}function Mt(l){function c(g){return g.$$.ptrType.registeredClass.name}Se(c(l)+" instance already deleted")}var Ht=!1;function cr(l){}function un(l){l.smartPtr?l.smartPtrType.rawDestructor(l.smartPtr):l.ptrType.registeredClass.rawDestructor(l.ptr)}function fr(l){l.count.value-=1;var c=l.count.value===0;c&&un(l)}function hr(l,c,g){if(c===g)return l;if(g.baseClass===void 0)return null;var C=hr(l,c,g.baseClass);return C===null?null:g.downcast(C)}var pr={};function ln(){return Object.keys(yt).length}function cn(){var l=[];for(var c in yt)yt.hasOwnProperty(c)&&l.push(yt[c]);return l}var gt=[];function Wt(){for(;gt.length;){var l=gt.pop();l.$$.deleteScheduled=!1,l.delete()}}var mt=void 0;function fn(l){mt=l,gt.length&&mt&&mt(Wt)}function hn(){r.getInheritedInstanceCount=ln,r.getLiveInheritedInstances=cn,r.flushPendingDeletes=Wt,r.setDelayFunction=fn}var yt={};function pn(l,c){for(c===void 0&&Se("ptr should not be undefined");l.baseClass;)c=l.upcast(c),l=l.baseClass;return c}function dn(l,c){return c=pn(l,c),yt[c]}function Rt(l,c){(!c.ptrType||!c.ptr)&&At("makeClassHandle requires ptr and ptrType");var g=!!c.smartPtrType,C=!!c.smartPtr;return g!==C&&At("Both smartPtrType and smartPtr must be specified"),c.count={value:1},wt(Object.create(l,{$$:{value:c}}))}function vn(l){var c=this.getPointee(l);if(!c)return this.destructor(l),null;var g=dn(this.registeredClass,c);if(g!==void 0){if(g.$$.count.value===0)return g.$$.ptr=c,g.$$.smartPtr=l,g.clone();var C=g.clone();return this.destructor(l),C}function R(){return this.isSmartPointer?Rt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:c,smartPtrType:this,smartPtr:l}):Rt(this.registeredClass.instancePrototype,{ptrType:this,ptr:l})}var k=this.registeredClass.getActualType(c),G=pr[k];if(!G)return R.call(this);var N;this.isConst?N=G.constPointerType:N=G.pointerType;var W=hr(c,this.registeredClass,N.registeredClass);return W===null?R.call(this):this.isSmartPointer?Rt(N.registeredClass.instancePrototype,{ptrType:N,ptr:W,smartPtrType:this,smartPtr:l}):Rt(N.registeredClass.instancePrototype,{ptrType:N,ptr:W})}function wt(l){return typeof FinalizationRegistry>"u"?(wt=c=>c,l):(Ht=new FinalizationRegistry(c=>{fr(c.$$)}),wt=c=>{var g=c.$$,C=!!g.smartPtr;if(C){var R={$$:g};Ht.register(c,R,c)}return c},cr=c=>Ht.unregister(c),wt(l))}function gn(){if(this.$$.ptr||Mt(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var l=wt(Object.create(Object.getPrototypeOf(this),{$$:{value:sn(this.$$)}}));return l.$$.count.value+=1,l.$$.deleteScheduled=!1,l}function mn(){this.$$.ptr||Mt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Se("Object already scheduled for deletion"),cr(this),fr(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function yn(){return!this.$$.ptr}function wn(){return this.$$.ptr||Mt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Se("Object already scheduled for deletion"),gt.push(this),gt.length===1&&mt&&mt(Wt),this.$$.deleteScheduled=!0,this}function bn(){st.prototype.isAliasOf=an,st.prototype.clone=gn,st.prototype.delete=mn,st.prototype.isDeleted=yn,st.prototype.deleteLater=wn}function st(){}function $t(l,c,g){if(l[c].overloadTable===void 0){var C=l[c];l[c]=function(){return l[c].overloadTable.hasOwnProperty(arguments.length)||Se("Function '"+g+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+l[c].overloadTable+")!"),l[c].overloadTable[arguments.length].apply(this,arguments)},l[c].overloadTable=[],l[c].overloadTable[C.argCount]=C}}function dr(l,c,g){r.hasOwnProperty(l)?((g===void 0||r[l].overloadTable!==void 0&&r[l].overloadTable[g]!==void 0)&&Se("Cannot register public name '"+l+"' twice"),$t(r,l,l),r.hasOwnProperty(g)&&Se("Cannot register multiple overloads of a function with the same number of arguments ("+g+")!"),r[l].overloadTable[g]=c):(r[l]=c,g!==void 0&&(r[l].numArguments=g))}function Sn(l,c,g,C,R,k,G,N){this.name=l,this.constructor=c,this.instancePrototype=g,this.rawDestructor=C,this.baseClass=R,this.getActualType=k,this.upcast=G,this.downcast=N,this.pureVirtualFunctions=[]}function qt(l,c,g){for(;c!==g;)c.upcast||Se("Expected null or instance of "+g.name+", got an instance of "+c.name),l=c.upcast(l),c=c.baseClass;return l}function Pn(l,c){if(c===null)return this.isReference&&Se("null is not a valid "+this.name),0;c.$$||Se('Cannot pass "'+Kt(c)+'" as a '+this.name),c.$$.ptr||Se("Cannot pass deleted object as a pointer of type "+this.name);var g=c.$$.ptrType.registeredClass,C=qt(c.$$.ptr,g,this.registeredClass);return C}function xn(l,c){var g;if(c===null)return this.isReference&&Se("null is not a valid "+this.name),this.isSmartPointer?(g=this.rawConstructor(),l!==null&&l.push(this.rawDestructor,g),g):0;c.$$||Se('Cannot pass "'+Kt(c)+'" as a '+this.name),c.$$.ptr||Se("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&c.$$.ptrType.isConst&&Se("Cannot convert argument of type "+(c.$$.smartPtrType?c.$$.smartPtrType.name:c.$$.ptrType.name)+" to parameter type "+this.name);var C=c.$$.ptrType.registeredClass;if(g=qt(c.$$.ptr,C,this.registeredClass),this.isSmartPointer)switch(c.$$.smartPtr===void 0&&Se("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:c.$$.smartPtrType===this?g=c.$$.smartPtr:Se("Cannot convert argument of type "+(c.$$.smartPtrType?c.$$.smartPtrType.name:c.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:g=c.$$.smartPtr;break;case 2:if(c.$$.smartPtrType===this)g=c.$$.smartPtr;else{var R=c.clone();g=this.rawShare(g,Ue.toHandle(function(){R.delete()})),l!==null&&l.push(this.rawDestructor,g)}break;default:Se("Unsupporting sharing policy")}return g}function En(l,c){if(c===null)return this.isReference&&Se("null is not a valid "+this.name),0;c.$$||Se('Cannot pass "'+Kt(c)+'" as a '+this.name),c.$$.ptr||Se("Cannot pass deleted object as a pointer of type "+this.name),c.$$.ptrType.isConst&&Se("Cannot convert argument of type "+c.$$.ptrType.name+" to parameter type "+this.name);var g=c.$$.ptrType.registeredClass,C=qt(c.$$.ptr,g,this.registeredClass);return C}function Ot(l){return this.fromWireType(he[l>>2])}function Cn(l){return this.rawGetPointee&&(l=this.rawGetPointee(l)),l}function Tn(l){this.rawDestructor&&this.rawDestructor(l)}function _n(l){l!==null&&l.delete()}function An(){rt.prototype.getPointee=Cn,rt.prototype.destructor=Tn,rt.prototype.argPackAdvance=8,rt.prototype.readValueFromPointer=Ot,rt.prototype.deleteObject=_n,rt.prototype.fromWireType=vn}function rt(l,c,g,C,R,k,G,N,W,j,te){this.name=l,this.registeredClass=c,this.isReference=g,this.isConst=C,this.isSmartPointer=R,this.pointeeType=k,this.sharingPolicy=G,this.rawGetPointee=N,this.rawConstructor=W,this.rawShare=j,this.rawDestructor=te,!R&&c.baseClass===void 0?C?(this.toWireType=Pn,this.destructorFunction=null):(this.toWireType=En,this.destructorFunction=null):this.toWireType=xn}function Rn(l,c,g){r.hasOwnProperty(l)||At("Replacing nonexistant public symbol"),r[l].overloadTable!==void 0&&g!==void 0?r[l].overloadTable[g]=c:(r[l]=c,r[l].argCount=g)}function On(l,c,g){var C=r["dynCall_"+l];return g&&g.length?C.apply(null,[c].concat(g)):C.call(null,c)}function Dn(l,c,g){return l.includes("j")?On(l,c,g):xt(c).apply(null,g)}function Bn(l,c){var g=[];return function(){return g.length=0,Object.assign(g,arguments),Dn(l,c,g)}}function pt(l,c){l=$e(l);function g(){return l.includes("j")?Bn(l,c):xt(c)}var C=g();return typeof C!="function"&&Se("unknown function pointer with signature "+l+": "+c),C}var vr=void 0;function gr(l){var c=Ar(l),g=$e(c);return ot(c),g}function Dt(l,c){var g=[],C={};function R(k){if(!C[k]&&!ft[k]){if(Ct[k]){Ct[k].forEach(R);return}g.push(k),C[k]=!0}}throw c.forEach(R),new vr(l+": "+g.map(gr).join([", "]))}function Ln(l,c,g,C,R,k,G,N,W,j,te,re,Q){te=$e(te),k=pt(R,k),N&&(N=pt(G,N)),j&&(j=pt(W,j)),Q=pt(re,Q);var ne=Tt(te);dr(ne,function(){Dt("Cannot construct "+te+" due to unbound types",[C])}),ht([l,c,g],C?[C]:[],function(fe){fe=fe[0];var Pe,Oe;C?(Pe=fe.registeredClass,Oe=Pe.instancePrototype):Oe=st.prototype;var Be=_t(ne,function(){if(Object.getPrototypeOf(this)!==Z)throw new vt("Use 'new' to construct "+te);if(ue.constructor_body===void 0)throw new vt(te+" has no accessible constructor");var Le=ue.constructor_body[arguments.length];if(Le===void 0)throw new vt("Tried to invoke ctor of "+te+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(ue.constructor_body).toString()+") parameters instead!");return Le.apply(this,arguments)}),Z=Object.create(Oe,{constructor:{value:Be}});Be.prototype=Z;var ue=new Sn(te,Be,Z,Q,Pe,k,N,j),ke=new rt(te,ue,!0,!1,!1),Ce=new rt(te+"*",ue,!1,!1,!1),Ye=new rt(te+" const*",ue,!1,!0,!1);return pr[l]={pointerType:Ce,constPointerType:Ye},Rn(ne,Be),[ke,Ce,Ye]})}function mr(l,c){if(!(l instanceof Function))throw new TypeError("new_ called with constructor type "+typeof l+" which is not a function");var g=_t(l.name||"unknownFunctionName",function(){});g.prototype=l.prototype;var C=new g,R=l.apply(C,c);return R instanceof Object?R:C}function yr(l){for(;l.length;){var c=l.pop(),g=l.pop();g(c)}}function jt(l,c,g,C,R){var k=c.length;k<2&&Se("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var G=c[1]!==null&&g!==null,N=!1,W=1;W<c.length;++W)if(c[W]!==null&&c[W].destructorFunction===void 0){N=!0;break}for(var j=c[0].name!=="void",te="",re="",W=0;W<k-2;++W)te+=(W!==0?", ":"")+"arg"+W,re+=(W!==0?", ":"")+"arg"+W+"Wired";var Q="return function "+Tt(l)+"("+te+`) {
if (arguments.length !== `+(k-2)+`) {
throwBindingError('function `+l+" called with ' + arguments.length + ' arguments, expected "+(k-2)+` args!');
}
`;N&&(Q+=`var destructors = [];
`);var ne=N?"destructors":"null",fe=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Pe=[Se,C,R,yr,c[0],c[1]];G&&(Q+="var thisWired = classParam.toWireType("+ne+`, this);
`);for(var W=0;W<k-2;++W)Q+="var arg"+W+"Wired = argType"+W+".toWireType("+ne+", arg"+W+"); // "+c[W+2].name+`
`,fe.push("argType"+W),Pe.push(c[W+2]);if(G&&(re="thisWired"+(re.length>0?", ":"")+re),Q+=(j?"var rv = ":"")+"invoker(fn"+(re.length>0?", ":"")+re+`);
`,N)Q+=`runDestructors(destructors);
`;else for(var W=G?1:2;W<c.length;++W){var Oe=W===1?"thisWired":"arg"+(W-2)+"Wired";c[W].destructorFunction!==null&&(Q+=Oe+"_dtor("+Oe+"); // "+c[W].name+`
`,fe.push(Oe+"_dtor"),Pe.push(c[W].destructorFunction))}j&&(Q+=`var ret = retType.fromWireType(rv);
return ret;
`),Q+=`}
`,fe.push(Q);var Be=mr(Function,fe).apply(null,Pe);return Be}function Xt(l,c){for(var g=[],C=0;C<l;C++)g.push(K[(c>>2)+C]);return g}function Fn(l,c,g,C,R,k,G){var N=Xt(g,C);c=$e(c),k=pt(R,k),ht([],[l],function(W){W=W[0];var j=W.name+"."+c;function te(){Dt("Cannot call "+j+" due to unbound types",N)}c.startsWith("@@")&&(c=Symbol[c.substring(2)]);var re=W.registeredClass.constructor;return re[c]===void 0?(te.argCount=g-1,re[c]=te):($t(re,c,j),re[c].overloadTable[g-1]=te),ht([],N,function(Q){var ne=[Q[0],null].concat(Q.slice(1)),fe=jt(j,ne,null,k,G);return re[c].overloadTable===void 0?(fe.argCount=g-1,re[c]=fe):re[c].overloadTable[g-1]=fe,[]}),[]})}function In(l,c,g,C,R,k){T(c>0);var G=Xt(c,g);R=pt(C,R),ht([],[l],function(N){N=N[0];var W="constructor "+N.name;if(N.registeredClass.constructor_body===void 0&&(N.registeredClass.constructor_body=[]),N.registeredClass.constructor_body[c-1]!==void 0)throw new vt("Cannot register multiple constructors with identical number of parameters ("+(c-1)+") for class '"+N.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return N.registeredClass.constructor_body[c-1]=()=>{Dt("Cannot construct "+N.name+" due to unbound types",G)},ht([],G,function(j){return j.splice(1,0,null),N.registeredClass.constructor_body[c-1]=jt(W,j,null,R,k),[]}),[]})}function Un(l,c,g,C,R,k,G,N){var W=Xt(g,C);c=$e(c),k=pt(R,k),ht([],[l],function(j){j=j[0];var te=j.name+"."+c;c.startsWith("@@")&&(c=Symbol[c.substring(2)]),N&&j.registeredClass.pureVirtualFunctions.push(c);function re(){Dt("Cannot call "+te+" due to unbound types",W)}var Q=j.registeredClass.instancePrototype,ne=Q[c];return ne===void 0||ne.overloadTable===void 0&&ne.className!==j.name&&ne.argCount===g-2?(re.argCount=g-2,re.className=j.name,Q[c]=re):($t(Q,c,te),Q[c].overloadTable[g-2]=re),ht([],W,function(fe){var Pe=jt(te,fe,j,k,G);return Q[c].overloadTable===void 0?(Pe.argCount=g-2,Q[c]=Pe):Q[c].overloadTable[g-2]=Pe,[]}),[]})}var Yt=[],Qe=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Zt(l){l>4&&--Qe[l].refcount===0&&(Qe[l]=void 0,Yt.push(l))}function kn(){for(var l=0,c=5;c<Qe.length;++c)Qe[c]!==void 0&&++l;return l}function Gn(){for(var l=5;l<Qe.length;++l)if(Qe[l]!==void 0)return Qe[l];return null}function zn(){r.count_emval_handles=kn,r.get_first_emval=Gn}var Ue={toValue:l=>(l||Se("Cannot use deleted val. handle = "+l),Qe[l].value),toHandle:l=>{switch(l){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var c=Yt.length?Yt.pop():Qe.length;return Qe[c]={refcount:1,value:l},c}}}};function Nn(l,c){c=$e(c),Je(l,{name:c,fromWireType:function(g){var C=Ue.toValue(g);return Zt(g),C},toWireType:function(g,C){return Ue.toHandle(C)},argPackAdvance:8,readValueFromPointer:Ot,destructorFunction:null})}function Vn(l,c,g){switch(c){case 0:return function(C){var R=g?ae:ce;return this.fromWireType(R[C])};case 1:return function(C){var R=g?Ae:Te;return this.fromWireType(R[C>>1])};case 2:return function(C){var R=g?K:he;return this.fromWireType(R[C>>2])};default:throw new TypeError("Unknown integer type: "+l)}}function Mn(l,c,g,C){var R=Et(g);c=$e(c);function k(){}k.values={},Je(l,{name:c,constructor:k,fromWireType:function(G){return this.constructor.values[G]},toWireType:function(G,N){return N.value},argPackAdvance:8,readValueFromPointer:Vn(c,R,C),destructorFunction:null}),dr(c,k)}function Bt(l,c){var g=ft[l];return g===void 0&&Se(c+" has unknown type "+gr(l)),g}function Hn(l,c,g){var C=Bt(l,"enum");c=$e(c);var R=C.constructor,k=Object.create(C.constructor.prototype,{value:{value:g},constructor:{value:_t(C.name+"_"+c,function(){})}});R.values[g]=k,R[c]=k}function Kt(l){if(l===null)return"null";var c=typeof l;return c==="object"||c==="array"||c==="function"?l.toString():""+l}function Wn(l,c){switch(c){case 2:return function(g){return this.fromWireType(xe[g>>2])};case 3:return function(g){return this.fromWireType(Ve[g>>3])};default:throw new TypeError("Unknown float type: "+l)}}function $n(l,c,g){var C=Et(g);c=$e(c),Je(l,{name:c,fromWireType:function(R){return R},toWireType:function(R,k){return k},argPackAdvance:8,readValueFromPointer:Wn(c,C),destructorFunction:null})}function qn(l,c,g){switch(c){case 0:return g?function(R){return ae[R]}:function(R){return ce[R]};case 1:return g?function(R){return Ae[R>>1]}:function(R){return Te[R>>1]};case 2:return g?function(R){return K[R>>2]}:function(R){return he[R>>2]};default:throw new TypeError("Unknown integer type: "+l)}}function jn(l,c,g,C,R){c=$e(c);var k=Et(g),G=re=>re;if(C===0){var N=32-8*g;G=re=>re<<N>>>N}var W=c.includes("unsigned"),j=(re,Q)=>{},te;W?te=function(re,Q){return j(Q,this.name),Q>>>0}:te=function(re,Q){return j(Q,this.name),Q},Je(l,{name:c,fromWireType:G,toWireType:te,argPackAdvance:8,readValueFromPointer:qn(c,k,C!==0),destructorFunction:null})}function Xn(l,c,g){var C=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],R=C[c];function k(G){G=G>>2;var N=he,W=N[G],j=N[G+1];return new R(pe,j,W)}g=$e(g),Je(l,{name:g,fromWireType:k,argPackAdvance:8,readValueFromPointer:k},{ignoreDuplicateRegistrations:!0})}function Yn(l,c){c=$e(c);var g=c==="std::string";Je(l,{name:c,fromWireType:function(C){var R=he[C>>2],k;if(g)for(var G=C+4,N=0;N<=R;++N){var W=C+4+N;if(N==R||ce[W]==0){var j=W-G,te=D(G,j);k===void 0?k=te:(k+=String.fromCharCode(0),k+=te),G=W+1}}else{for(var re=new Array(R),N=0;N<R;++N)re[N]=String.fromCharCode(ce[C+4+N]);k=re.join("")}return ot(C),k},toWireType:function(C,R){R instanceof ArrayBuffer&&(R=new Uint8Array(R));var k,G=typeof R=="string";G||R instanceof Uint8Array||R instanceof Uint8ClampedArray||R instanceof Int8Array||Se("Cannot pass non-string to std::string"),g&&G?k=()=>q(R):k=()=>R.length;var N=k(),W=it(4+N+1);if(he[W>>2]=N,g&&G)M(R,W+4,N+1);else if(G)for(var j=0;j<N;++j){var te=R.charCodeAt(j);te>255&&(ot(W),Se("String has UTF-16 code units that do not fit in 8 bits")),ce[W+4+j]=te}else for(var j=0;j<N;++j)ce[W+4+j]=R[j];return C!==null&&C.push(ot,W),W},argPackAdvance:8,readValueFromPointer:Ot,destructorFunction:function(C){ot(C)}})}function Zn(l,c,g){g=$e(g);var C,R,k,G,N;c===2?(C=ee,R=le,G=oe,k=()=>Te,N=1):c===4&&(C=V,R=H,G=X,k=()=>he,N=2),Je(l,{name:g,fromWireType:function(W){for(var j=he[W>>2],te=k(),re,Q=W+4,ne=0;ne<=j;++ne){var fe=W+4+ne*c;if(ne==j||te[fe>>N]==0){var Pe=fe-Q,Oe=C(Q,Pe);re===void 0?re=Oe:(re+=String.fromCharCode(0),re+=Oe),Q=fe+c}}return ot(W),re},toWireType:function(W,j){typeof j!="string"&&Se("Cannot pass non-string to C++ string type "+g);var te=G(j),re=it(4+te+c);return he[re>>2]=te>>N,R(j,re+4,te+c),W!==null&&W.push(ot,re),re},argPackAdvance:8,readValueFromPointer:Ot,destructorFunction:function(W){ot(W)}})}function Kn(l,c){c=$e(c),Je(l,{isVoid:!0,name:c,argPackAdvance:0,fromWireType:function(){},toWireType:function(g,C){}})}function Qn(){return Date.now()}var Jn=!0;function ei(){return Jn}function ti(l,c,g){l=Ue.toValue(l),c=Bt(c,"emval::as");var C=[],R=Ue.toHandle(C);return K[g>>2]=R,c.toWireType(C,l)}function ri(l){var c=[];return K[l>>2]=Ue.toHandle(c),c}var ni={};function Qt(l){var c=ni[l];return c===void 0?$e(l):c}var Jt=[];function ii(l,c,g,C,R){return l=Jt[l],c=Ue.toValue(c),g=Qt(g),l(c,g,ri(C),R)}function wr(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function oi(l){return l===0?Ue.toHandle(wr()):(l=Qt(l),Ue.toHandle(wr()[l]))}function ai(l){var c=Jt.length;return Jt.push(l),c}function si(l,c){for(var g=new Array(l),C=0;C<l;++C)g[C]=Bt(he[c+C*A>>2],"parameter "+C);return g}var br=[];function ui(l,c){var g=si(l,c),C=g[0],R=C.name+"_$"+g.slice(1).map(function(fe){return fe.name}).join("_")+"$",k=br[R];if(k!==void 0)return k;for(var G=["retType"],N=[C],W="",j=0;j<l-1;++j)W+=(j!==0?", ":"")+"arg"+j,G.push("argType"+j),N.push(g[1+j]);for(var te=Tt("methodCaller_"+R),re="return function "+te+`(handle, name, destructors, args) {
`,Q=0,j=0;j<l-1;++j)re+="    var arg"+j+" = argType"+j+".readValueFromPointer(args"+(Q?"+"+Q:"")+`);
`,Q+=g[j+1].argPackAdvance;re+="    var rv = handle[name]("+W+`);
`;for(var j=0;j<l-1;++j)g[j+1].deleteObject&&(re+="    argType"+j+".deleteObject(arg"+j+`);
`);C.isVoid||(re+=`    return retType.toWireType(destructors, rv);
`),re+=`};
`,G.push(re);var ne=mr(Function,G).apply(null,N);return k=ai(ne),br[R]=k,k}function li(l,c){return l=Ue.toValue(l),c=Ue.toValue(c),Ue.toHandle(l[c])}function ci(l){l>4&&(Qe[l].refcount+=1)}function fi(l){return Ue.toHandle(Qt(l))}function hi(l){var c=Ue.toValue(l);yr(c),Zt(l)}function pi(l,c,g){l=Ue.toValue(l),c=Ue.toValue(c),g=Ue.toValue(g),l[c]=g}function di(l,c){l=Bt(l,"_emval_take_value");var g=l.readValueFromPointer(c);return Ue.toHandle(g)}function vi(l){return l=Ue.toValue(l),Ue.toHandle(typeof l)}function gi(l,c){var g=new Date(K[l>>2]*1e3);K[c>>2]=g.getSeconds(),K[c+4>>2]=g.getMinutes(),K[c+8>>2]=g.getHours(),K[c+12>>2]=g.getDate(),K[c+16>>2]=g.getMonth(),K[c+20>>2]=g.getFullYear()-1900,K[c+24>>2]=g.getDay();var C=new Date(g.getFullYear(),0,1),R=(g.getTime()-C.getTime())/(1e3*60*60*24)|0;K[c+28>>2]=R,K[c+36>>2]=-(g.getTimezoneOffset()*60);var k=new Date(g.getFullYear(),6,1).getTimezoneOffset(),G=C.getTimezoneOffset(),N=(k!=G&&g.getTimezoneOffset()==Math.min(G,k))|0;K[c+32>>2]=N}function mi(l,c,g,C,R,k){try{var G=O.getStream(R);G&&(g&2&&be.doMsync(l,G,c,C,k),O.munmap(G))}catch(N){if(typeof O>"u"||!(N instanceof O.ErrnoError))throw N;return-N.errno}}function yi(l,c,g){var C=new Date().getFullYear(),R=new Date(C,0,1),k=new Date(C,6,1),G=R.getTimezoneOffset(),N=k.getTimezoneOffset(),W=Math.max(G,N);K[l>>2]=W*60,K[c>>2]=Number(G!=N);function j(fe){var Pe=fe.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Pe?Pe[1]:"GMT"}var te=j(R),re=j(k),Q=Y(te),ne=Y(re);N<G?(he[g>>2]=Q,he[g+4>>2]=ne):(he[g>>2]=ne,he[g+4>>2]=Q)}function er(l,c,g){er.called||(er.called=!0,yi(l,c,g))}function wi(){ze("")}function Sr(){return 2147483648}function bi(){return Sr()}function Si(l,c,g){ce.copyWithin(l,c,c+g)}function Pi(l){try{return F.grow(l-pe.byteLength+65535>>>16),Ze(F.buffer),1}catch{}}function xi(l){var c=ce.length;l=l>>>0;var g=Sr();if(l>g)return!1;let C=(W,j)=>W+(j-W%j)%j;for(var R=1;R<=4;R*=2){var k=c*(1+.2/R);k=Math.min(k,l+100663296);var G=Math.min(g,C(Math.max(l,k),65536)),N=Pi(G);if(N)return!0}return!1}var tr={};function Ei(){return a||"./this.program"}function bt(){if(!bt.strings){var l=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",c={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:l,_:Ei()};for(var g in tr)tr[g]===void 0?delete c[g]:c[g]=tr[g];var C=[];for(var g in c)C.push(g+"="+c[g]);bt.strings=C}return bt.strings}function Ci(l,c){var g=0;return bt().forEach(function(C,R){var k=c+g;he[l+R*4>>2]=k,se(C,k),g+=C.length+1}),0}function Ti(l,c){var g=bt();he[l>>2]=g.length;var C=0;return g.forEach(function(R){C+=R.length+1}),he[c>>2]=C,0}function _i(l){ao(l)}function Ai(l){try{var c=be.getStreamFromFD(l);return O.close(c),0}catch(g){if(typeof O>"u"||!(g instanceof O.ErrnoError))throw g;return g.errno}}function Ri(l,c,g,C){for(var R=0,k=0;k<g;k++){var G=he[c>>2],N=he[c+4>>2];c+=8;var W=O.read(l,ae,G,N,C);if(W<0)return-1;if(R+=W,W<N)break}return R}function Oi(l,c,g,C){try{var R=be.getStreamFromFD(l),k=Ri(R,c,g);return K[C>>2]=k,0}catch(G){if(typeof O>"u"||!(G instanceof O.ErrnoError))throw G;return G.errno}}function Di(l,c){return c+2097152>>>0<4194305-!!l?(l>>>0)+c*4294967296:NaN}function Bi(l,c,g,C,R){try{var k=Di(c,g);if(isNaN(k))return 61;var G=be.getStreamFromFD(l);return O.llseek(G,k,C),et=[G.position>>>0,(Ne=G.position,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],K[R>>2]=et[0],K[R+4>>2]=et[1],G.getdents&&k===0&&C===0&&(G.getdents=null),0}catch(N){if(typeof O>"u"||!(N instanceof O.ErrnoError))throw N;return N.errno}}function Li(l,c,g,C){for(var R=0,k=0;k<g;k++){var G=he[c>>2],N=he[c+4>>2];c+=8;var W=O.write(l,ae,G,N,C);if(W<0)return-1;R+=W}return R}function Fi(l,c,g,C){try{var R=be.getStreamFromFD(l),k=Li(R,c,g);return he[C>>2]=k,0}catch(G){if(typeof O>"u"||!(G instanceof O.ErrnoError))throw G;return G.errno}}function Pr(l){for(var c=l.split("."),g=0;g<4;g++){var C=Number(c[g]);if(isNaN(C))return null;c[g]=C}return(c[0]|c[1]<<8|c[2]<<16|c[3]<<24)>>>0}function St(l){return parseInt(l)}function Ii(l){var c,g,C,R,k=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,G=[];if(!k.test(l))return null;if(l==="::")return[0,0,0,0,0,0,0,0];for(l.startsWith("::")?l=l.replace("::","Z:"):l=l.replace("::",":Z:"),l.indexOf(".")>0?(l=l.replace(new RegExp("[.]","g"),":"),c=l.split(":"),c[c.length-4]=St(c[c.length-4])+St(c[c.length-3])*256,c[c.length-3]=St(c[c.length-2])+St(c[c.length-1])*256,c=c.slice(0,c.length-2)):c=l.split(":"),C=0,R=0,g=0;g<c.length;g++)if(typeof c[g]=="string")if(c[g]==="Z"){for(R=0;R<8-c.length+1;R++)G[g+R]=0;C=R-1}else G[g+C]=Rr(parseInt(c[g],16));else G[g+C]=c[g];return[G[1]<<16|G[0],G[3]<<16|G[2],G[5]<<16|G[4],G[7]<<16|G[6]]}var ut={address_map:{id:1,addrs:{},names:{}},lookup_name:function(l){var c=Pr(l);if(c!==null||(c=Ii(l),c!==null))return l;var g;if(ut.address_map.addrs[l])g=ut.address_map.addrs[l];else{var C=ut.address_map.id++;T(C<65535,"exceeded max address mappings of 65535"),g="172.29."+(C&255)+"."+(C&65280),ut.address_map.names[g]=l,ut.address_map.addrs[l]=g}return g},lookup_addr:function(l){return ut.address_map.names[l]?ut.address_map.names[l]:null}};function Ui(l){var c=it(20),g=it(l.length+1);M(l,g,l.length+1),he[c>>2]=g;var C=it(4);he[C>>2]=0,he[c+4>>2]=C;var R=2;K[c+8>>2]=R,K[c+12>>2]=4;var k=it(12);return he[k>>2]=k+8,he[k+4>>2]=0,K[k+8>>2]=Pr(ut.lookup_name(l)),he[c+16>>2]=k,c}function ki(l){return Ui(D(l))}function Gi(l){var c=l.getExtension("ANGLE_instanced_arrays");if(c)return l.vertexAttribDivisor=function(g,C){c.vertexAttribDivisorANGLE(g,C)},l.drawArraysInstanced=function(g,C,R,k){c.drawArraysInstancedANGLE(g,C,R,k)},l.drawElementsInstanced=function(g,C,R,k,G){c.drawElementsInstancedANGLE(g,C,R,k,G)},1}function zi(l){var c=l.getExtension("OES_vertex_array_object");if(c)return l.createVertexArray=function(){return c.createVertexArrayOES()},l.deleteVertexArray=function(g){c.deleteVertexArrayOES(g)},l.bindVertexArray=function(g){c.bindVertexArrayOES(g)},l.isVertexArray=function(g){return c.isVertexArrayOES(g)},1}function Ni(l){var c=l.getExtension("WEBGL_draw_buffers");if(c)return l.drawBuffers=function(g,C){c.drawBuffersWEBGL(g,C)},1}function Vi(l){return!!(l.multiDrawWebgl=l.getExtension("WEBGL_multi_draw"))}var _e={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(c){_e.lastError||(_e.lastError=c)},getNewId:function(l){for(var c=_e.counter++,g=l.length;g<c;g++)l[g]=null;return c},getSource:function(l,c,g,C){for(var R="",k=0;k<c;++k){var G=C?K[C+k*4>>2]:-1;R+=D(K[g+k*4>>2],G<0?void 0:G)}return R},createContext:function(l,c){if(!l.getContextSafariWebGL2Fixed){let R=function(k,G){var N=l.getContextSafariWebGL2Fixed(k,G);return k=="webgl"==N instanceof WebGLRenderingContext?N:null};l.getContextSafariWebGL2Fixed=l.getContext,l.getContext=R}var g=l.getContext("webgl",c);if(!g)return 0;var C=_e.registerContext(g,c);return C},registerContext:function(l,c){var g=_e.getNewId(_e.contexts),C={handle:g,attributes:c,version:c.majorVersion,GLctx:l};return l.canvas&&(l.canvas.GLctxObject=C),_e.contexts[g]=C,(typeof c.enableExtensionsByDefault>"u"||c.enableExtensionsByDefault)&&_e.initExtensions(C),g},makeContextCurrent:function(l){return _e.currentContext=_e.contexts[l],r.ctx=je=_e.currentContext&&_e.currentContext.GLctx,!(l&&!je)},getContext:function(l){return _e.contexts[l]},deleteContext:function(l){_e.currentContext===_e.contexts[l]&&(_e.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(_e.contexts[l].GLctx.canvas),_e.contexts[l]&&_e.contexts[l].GLctx.canvas&&(_e.contexts[l].GLctx.canvas.GLctxObject=void 0),_e.contexts[l]=null},initExtensions:function(l){if(l||(l=_e.currentContext),!l.initExtensionsDone){l.initExtensionsDone=!0;var c=l.GLctx;Gi(c),zi(c),Ni(c),c.disjointTimerQueryExt=c.getExtension("EXT_disjoint_timer_query"),Vi(c);var g=c.getSupportedExtensions()||[];g.forEach(function(C){!C.includes("lose_context")&&!C.includes("debug")&&c.getExtension(C)})}}};function xr(l){return l.slice(-1)=="]"&&l.lastIndexOf("[")}function Mi(l){var c=l.uniformLocsById,g=l.uniformSizeAndIdsByName,C,R;if(!c)for(l.uniformLocsById=c={},l.uniformArrayNamesById={},C=0;C<je.getProgramParameter(l,35718);++C){var k=je.getActiveUniform(l,C),G=k.name,N=k.size,W=xr(G),j=W>0?G.slice(0,W):G,te=l.uniformIdCounter;for(l.uniformIdCounter+=N,g[j]=[N,te],R=0;R<N;++R)c[te]=R,l.uniformArrayNamesById[te++]=j}}function Hi(l,c){if(c=D(c),l=_e.programs[l]){Mi(l);var g=l.uniformLocsById,C=0,R=c,k=xr(c);k>0&&(C=St(c.slice(k+1))>>>0,R=c.slice(0,k));var G=l.uniformSizeAndIdsByName[R];if(G&&C<G[0]&&(C+=G[1],g[C]=g[C]||je.getUniformLocation(l,c)))return C}else _e.recordError(1281);return-1}function lt(l){var c=je.currentProgram;if(c){var g=c.uniformLocsById[l];return typeof g=="number"&&(c.uniformLocsById[l]=g=je.getUniformLocation(c,c.uniformArrayNamesById[l]+(g>0?"["+g+"]":""))),g}else _e.recordError(1282)}function Wi(l,c){je.uniform1f(lt(l),c)}function $i(l,c){je.uniform1i(lt(l),c)}var Lt=[];function qi(l,c,g){if(c<=144)for(var C=Lt[2*c-1],R=0;R<2*c;R+=2)C[R]=xe[g+4*R>>2],C[R+1]=xe[g+(4*R+4)>>2];else var C=xe.subarray(g>>2,g+c*8>>2);je.uniform2fv(lt(l),C)}var Ft=[];function ji(l,c,g){if(c<=144)for(var C=Ft[2*c-1],R=0;R<2*c;R+=2)C[R]=K[g+4*R>>2],C[R+1]=K[g+(4*R+4)>>2];else var C=K.subarray(g>>2,g+c*8>>2);je.uniform2iv(lt(l),C)}function Xi(l,c,g){if(c<=96)for(var C=Lt[3*c-1],R=0;R<3*c;R+=3)C[R]=xe[g+4*R>>2],C[R+1]=xe[g+(4*R+4)>>2],C[R+2]=xe[g+(4*R+8)>>2];else var C=xe.subarray(g>>2,g+c*12>>2);je.uniform3fv(lt(l),C)}function Yi(l,c,g){if(c<=96)for(var C=Ft[3*c-1],R=0;R<3*c;R+=3)C[R]=K[g+4*R>>2],C[R+1]=K[g+(4*R+4)>>2],C[R+2]=K[g+(4*R+8)>>2];else var C=K.subarray(g>>2,g+c*12>>2);je.uniform3iv(lt(l),C)}function Zi(l,c,g){if(c<=72){var C=Lt[4*c-1],R=xe;g>>=2;for(var k=0;k<4*c;k+=4){var G=g+k;C[k]=R[G],C[k+1]=R[G+1],C[k+2]=R[G+2],C[k+3]=R[G+3]}}else var C=xe.subarray(g>>2,g+c*16>>2);je.uniform4fv(lt(l),C)}function Ki(l,c,g){if(c<=72)for(var C=Ft[4*c-1],R=0;R<4*c;R+=4)C[R]=K[g+4*R>>2],C[R+1]=K[g+(4*R+4)>>2],C[R+2]=K[g+(4*R+8)>>2],C[R+3]=K[g+(4*R+12)>>2];else var C=K.subarray(g>>2,g+c*16>>2);je.uniform4iv(lt(l),C)}function Qi(l){}function It(l){return l%4===0&&(l%100!==0||l%400===0)}function Ji(l,c){for(var g=0,C=0;C<=c;g+=l[C++]);return g}var Er=[31,29,31,30,31,30,31,31,30,31,30,31],Cr=[31,28,31,30,31,30,31,31,30,31,30,31];function eo(l,c){for(var g=new Date(l.getTime());c>0;){var C=It(g.getFullYear()),R=g.getMonth(),k=(C?Er:Cr)[R];if(c>k-g.getDate())c-=k-g.getDate()+1,g.setDate(1),R<11?g.setMonth(R+1):(g.setMonth(0),g.setFullYear(g.getFullYear()+1));else return g.setDate(g.getDate()+c),g}return g}function to(l,c,g,C){var R=K[C+40>>2],k={tm_sec:K[C>>2],tm_min:K[C+4>>2],tm_hour:K[C+8>>2],tm_mday:K[C+12>>2],tm_mon:K[C+16>>2],tm_year:K[C+20>>2],tm_wday:K[C+24>>2],tm_yday:K[C+28>>2],tm_isdst:K[C+32>>2],tm_gmtoff:K[C+36>>2],tm_zone:R?D(R):""},G=D(g),N={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var W in N)G=G.replace(new RegExp(W,"g"),N[W]);var j=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],te=["January","February","March","April","May","June","July","August","September","October","November","December"];function re(Z,ue,ke){for(var Ce=typeof Z=="number"?Z.toString():Z||"";Ce.length<ue;)Ce=ke[0]+Ce;return Ce}function Q(Z,ue){return re(Z,ue,"0")}function ne(Z,ue){function ke(Ye){return Ye<0?-1:Ye>0?1:0}var Ce;return(Ce=ke(Z.getFullYear()-ue.getFullYear()))===0&&(Ce=ke(Z.getMonth()-ue.getMonth()))===0&&(Ce=ke(Z.getDate()-ue.getDate())),Ce}function fe(Z){switch(Z.getDay()){case 0:return new Date(Z.getFullYear()-1,11,29);case 1:return Z;case 2:return new Date(Z.getFullYear(),0,3);case 3:return new Date(Z.getFullYear(),0,2);case 4:return new Date(Z.getFullYear(),0,1);case 5:return new Date(Z.getFullYear()-1,11,31);case 6:return new Date(Z.getFullYear()-1,11,30)}}function Pe(Z){var ue=eo(new Date(Z.tm_year+1900,0,1),Z.tm_yday),ke=new Date(ue.getFullYear(),0,4),Ce=new Date(ue.getFullYear()+1,0,4),Ye=fe(ke),Le=fe(Ce);return ne(Ye,ue)<=0?ne(Le,ue)<=0?ue.getFullYear()+1:ue.getFullYear():ue.getFullYear()-1}var Oe={"%a":function(Z){return j[Z.tm_wday].substring(0,3)},"%A":function(Z){return j[Z.tm_wday]},"%b":function(Z){return te[Z.tm_mon].substring(0,3)},"%B":function(Z){return te[Z.tm_mon]},"%C":function(Z){var ue=Z.tm_year+1900;return Q(ue/100|0,2)},"%d":function(Z){return Q(Z.tm_mday,2)},"%e":function(Z){return re(Z.tm_mday,2," ")},"%g":function(Z){return Pe(Z).toString().substring(2)},"%G":function(Z){return Pe(Z)},"%H":function(Z){return Q(Z.tm_hour,2)},"%I":function(Z){var ue=Z.tm_hour;return ue==0?ue=12:ue>12&&(ue-=12),Q(ue,2)},"%j":function(Z){return Q(Z.tm_mday+Ji(It(Z.tm_year+1900)?Er:Cr,Z.tm_mon-1),3)},"%m":function(Z){return Q(Z.tm_mon+1,2)},"%M":function(Z){return Q(Z.tm_min,2)},"%n":function(){return`
`},"%p":function(Z){return Z.tm_hour>=0&&Z.tm_hour<12?"AM":"PM"},"%S":function(Z){return Q(Z.tm_sec,2)},"%t":function(){return"	"},"%u":function(Z){return Z.tm_wday||7},"%U":function(Z){var ue=Z.tm_yday+7-Z.tm_wday;return Q(Math.floor(ue/7),2)},"%V":function(Z){var ue=Math.floor((Z.tm_yday+7-(Z.tm_wday+6)%7)/7);if((Z.tm_wday+371-Z.tm_yday-2)%7<=2&&ue++,ue){if(ue==53){var Ce=(Z.tm_wday+371-Z.tm_yday)%7;Ce!=4&&(Ce!=3||!It(Z.tm_year))&&(ue=1)}}else{ue=52;var ke=(Z.tm_wday+7-Z.tm_yday-1)%7;(ke==4||ke==5&&It(Z.tm_year%400-1))&&ue++}return Q(ue,2)},"%w":function(Z){return Z.tm_wday},"%W":function(Z){var ue=Z.tm_yday+7-(Z.tm_wday+6)%7;return Q(Math.floor(ue/7),2)},"%y":function(Z){return(Z.tm_year+1900).toString().substring(2)},"%Y":function(Z){return Z.tm_year+1900},"%z":function(Z){var ue=Z.tm_gmtoff,ke=ue>=0;return ue=Math.abs(ue)/60,ue=ue/60*100+ue%60,(ke?"+":"-")+String("0000"+ue).slice(-4)},"%Z":function(Z){return Z.tm_zone},"%%":function(){return"%"}};G=G.replace(/%%/g,"\0\0");for(var W in Oe)G.includes(W)&&(G=G.replace(new RegExp(W,"g"),Oe[W](k)));G=G.replace(/\0\0/g,"%");var Be=Gt(G,!1);return Be.length>c?0:(ie(Be,l),Be.length-1)}function ro(l,c,g,C){return to(l,c,g,C)}var Tr=function(l,c,g,C){l||(l=this),this.parent=l,this.mount=l.mount,this.mounted=null,this.id=O.nextInode++,this.name=c,this.mode=g,this.node_ops={},this.stream_ops={},this.rdev=C},Ut=365,kt=146;Object.defineProperties(Tr.prototype,{read:{get:function(){return(this.mode&Ut)===Ut},set:function(l){l?this.mode|=Ut:this.mode&=~Ut}},write:{get:function(){return(this.mode&kt)===kt},set:function(l){l?this.mode|=kt:this.mode&=~kt}},isFolder:{get:function(){return O.isDir(this.mode)}},isDevice:{get:function(){return O.isChrdev(this.mode)}}}),O.FSNode=Tr,O.staticInit(),tn(),vt=r.BindingError=Vt(Error,"BindingError"),lr=r.InternalError=Vt(Error,"InternalError"),bn(),hn(),An(),vr=r.UnboundTypeError=Vt(Error,"UnboundTypeError"),zn();for(var je,no=new Float32Array(288),nt=0;nt<288;++nt)Lt[nt]=no.subarray(0,nt+1);for(var io=new Int32Array(288),nt=0;nt<288;++nt)Ft[nt]=io.subarray(0,nt+1);function Gt(l,c,g){var C=g>0?g:q(l)+1,R=new Array(C),k=z(l,R,0,R.length);return c&&(R.length=k),R}var oo={ga:Ir,k:Ur,b:kr,c:zr,Q:Wr,R:$r,q:jr,K:Xr,U:Yr,I:Zr,H:Kr,u:Qr,J:Jr,z:en,W:on,d:Ln,f:Fn,e:In,a:Un,V:Nn,g:Mn,h:Hn,v:$n,j:jn,i:Xn,w:Yn,r:Zn,X:Kn,N:Qn,M:ei,m:ti,ka:ii,x:Zt,la:oi,ja:ui,s:li,E:ci,ia:fi,ma:hi,n:pi,l:di,na:vi,O:gi,D:mi,P:er,t:wi,C:bi,L:Si,o:xi,F:Ci,G:Ti,fa:_i,p:Ai,T:Oi,y:Bi,S:Fi,ha:ki,ea:Hi,ca:Wi,da:$i,_:qi,ba:ji,Z:Xi,aa:Yi,Y:Zi,$:Ki,A:Qi,B:ro};Fr(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var it=r._malloc=function(){return(it=r._malloc=r.asm.qa).apply(null,arguments)},ot=r._free=function(){return(ot=r._free=r.asm.ra).apply(null,arguments)},_r=r.___errno_location=function(){return(_r=r.___errno_location=r.asm.sa).apply(null,arguments)},Ar=r.___getTypeName=function(){return(Ar=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var Rr=r._htons=function(){return(Rr=r._htons=r.asm.wa).apply(null,arguments)},Or=r._emscripten_builtin_memalign=function(){return(Or=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},Dr=r.___cxa_is_pointer_type=function(){return(Dr=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=O;var zt;function rr(l){this.name="ExitStatus",this.message="Program terminated with exit("+l+")",this.status=l}Fe=function l(){zt||nr(),zt||(Fe=l)};function nr(l){if(Ie>0||(qe(),Ie>0))return;function c(){zt||(zt=!0,r.calledRun=!0,!U&&(Ke(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),at()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),c()},1)):c()}r.run=nr;function ao(l,c){so(l)}function so(l){De()||(r.onExit&&r.onExit(l),U=!0),s(l,new rr(l))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return nr(),r.ready}})(),opencascadeWasm="/cad-os/assets/replicad_single-b4564eab.wasm";const OC={library:null},setOC=e=>{OC.library=e},getOC=()=>{if(!OC.library)throw new Error("oppencascade has not been loaded");return OC.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const deletetableRegistry=new globalThis.FinalizationRegistry(e=>{try{e.delete()}catch(t){console.error(t)}});class WrappingObj{constructor(t){this.oc=getOC(),t&&deletetableRegistry.register(this,t,t),this._wrapped=t}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(t){this._wrapped&&(deletetableRegistry.unregister(this._wrapped),this._wrapped.delete()),deletetableRegistry.register(this,t,t),this._wrapped=t}delete(){var t;deletetableRegistry.unregister(this.wrapped),(t=this.wrapped)==null||t.delete(),this._wrapped=null}}const GCWithScope=()=>{function e(t){return deletetableRegistry.register(e,t),t}return e},localGC=e=>{const t=new Set;return[r=>(t.add(r),r),()=>{[...t.values()].forEach(r=>r.delete()),t.clear()},e?t:void 0]},HASH_CODE_MAX=2147483647,DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI,round3=e=>Math.round(e*1e3)/1e3,makeAx3=(e,t,r)=>{const n=getOC(),i=asPnt(e),o=asDir(t);let a;if(r){const s=asDir(r);a=new n.gp_Ax3_3(i,o,s),s.delete()}else a=new n.gp_Ax3_4(i,o);return i.delete(),o.delete(),a},makeAx2=(e,t,r)=>{const n=getOC(),i=asPnt(e),o=asDir(t);let a;if(r){const s=asDir(r);a=new n.gp_Ax2_2(i,o,s),s.delete()}else a=new n.gp_Ax2_3(i,o);return i.delete(),o.delete(),a},makeAx1=(e,t)=>{const r=getOC(),n=asPnt(e),i=asDir(t),o=new r.gp_Ax1_2(n,i);return n.delete(),i.delete(),o},makeVec=(e=[0,0,0])=>{const t=getOC();if(Array.isArray(e)){if(e.length===3)return new t.gp_Vec_4(...e);if(e.length===2)return new t.gp_Vec_4(...e,0)}else{if(e instanceof Vector)return new t.gp_Vec_3(e.wrapped.XYZ());if(e.XYZ)return new t.gp_Vec_3(e.XYZ())}return new t.gp_Vec_4(0,0,0)};class Vector extends WrappingObj{constructor(t=[0,0,0]){super(makeVec(t))}get repr(){return`x: ${round3(this.x)}, y: ${round3(this.y)}, z: ${round3(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(t){return new Vector(this.wrapped.Crossed(t.wrapped))}dot(t){return this.wrapped.Dot(t.wrapped)}sub(t){return new Vector(this.wrapped.Subtracted(t.wrapped))}add(t){return new Vector(this.wrapped.Added(t.wrapped))}multiply(t){return new Vector(this.wrapped.Multiplied(t))}normalized(){return new Vector(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(t){return this.wrapped.Angle(t.wrapped)*RAD2DEG}projectToPlane(t){const r=t.origin,n=t.zDir,i=this.sub(r),o=n.multiply(i.dot(n)/n.Length**2),a=this.sub(o);return i.delete(),o.delete(),a}equals(t){return this.wrapped.IsEqual(t.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(t,r=[0,0,0],n=[0,0,1]){const i=makeAx1(r,n);return this.wrapped.Rotate(i,t*DEG2RAD),i.delete(),this}}const DIRECTIONS$1={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function makeDirection(e){return e==="X"||e==="Y"||e==="Z"?DIRECTIONS$1[e]:e}function asPnt(e){const t=new Vector(e),r=t.toPnt();return t.delete(),r}function asDir(e){const t=new Vector(e),r=t.toDir();return t.delete(),r}class Transformation extends WrappingObj{constructor(t){const r=getOC();super(t||new r.gp_Trsf_1)}translate(t,r=0,n=0){const i=new Vector(typeof t=="number"?[t,r,n]:t);return this.wrapped.SetTranslation_1(i.wrapped),this}rotate(t,r=[0,0,0],n=[0,0,1]){const i=asDir(n),o=asPnt(r),a=new this.oc.gp_Ax1_2(o,i);return this.wrapped.SetRotation_1(a,t*DEG2RAD),a.delete(),i.delete(),o.delete(),this}mirror(t="YZ",r){const n=GCWithScope();let i,o;if(typeof t=="string"){const s=n(createNamedPlane(t,r));i=s.origin,o=s.zDir}else t instanceof Plane?(i=r||t.origin,o=t.zDir):(i=r||[0,0,0],o=t);const a=n(makeAx2(i,o));return this.wrapped.SetMirror_3(a),this}scale(t,r){const n=asPnt(t);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(t,r){const n=GCWithScope(),i=n(t==="reference"?new this.oc.gp_Ax3_1:makeAx3(t.origin,t.zDir,t.xDir)),o=n(r==="reference"?new this.oc.gp_Ax3_1:makeAx3(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(i,o),this}transformPoint(t){const r=asPnt(t),n=r.Transformed(this.wrapped);return r.delete(),n}transform(t){return new this.oc.BRepBuilderAPI_Transform_2(t,this.wrapped,!0).ModifiedShape(t)}}class Plane{constructor(t,r=null,n=[0,0,1]){this.oc=getOC();const i=new Vector(n);if(i.Length===0)throw new Error("normal should be non null");this.zDir=i.normalize();let o;if(r)o=new Vector(r);else{const a=makeAx3(t,i);o=new Vector(a.XDirection()),a.delete()}if(o.Length===0)throw new Error("xDir should be non null");this.xDir=o.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new Vector(t)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Plane(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(t){this._origin=t,this._calcTransforms()}translateTo(t){const r=this.clone();return r.origin=new Vector(t),r}translate(t,r=0,n=0){const i=new Vector(typeof t=="number"?[t,r,n]:t);return this.translateTo(this.origin.add(i))}translateX(t){return this.translate(t,0,0)}translateY(t){return this.translate(0,t,0)}translateZ(t){return this.translate(0,0,t)}pivot(t,r=[1,0,0]){const n=makeDirection(r),i=new Vector(this.zDir).rotate(t,[0,0,0],n),o=new Vector(this.xDir).rotate(t,[0,0,0],n);return new Plane(this.origin,o,i)}rotate2DAxes(t){const r=new Vector(this.xDir).rotate(t,[0,0,0],this.zDir);return new Plane(this.origin,r,this.zDir)}_calcTransforms(){const t=new this.oc.gp_Ax3_1,r=makeAx3(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(t,r),this.globalToLocal=new Transformation,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new Transformation,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(t,r){this.origin=this.toWorldCoords([t,r])}toLocalCoords(t){const r=this.globalToLocal.transformPoint(t),n=new Vector(r);return r.delete(),n}toWorldCoords(t){const r=this.localToGlobal.transformPoint(t),n=new Vector(r);return r.delete(),n}}const PLANES_CONFIG={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},createNamedPlane=(e,t=[0,0,0])=>{const r=PLANES_CONFIG[e];if(!r)throw new Error(`Could not find plane ${e}`);let n;return typeof t=="number"?n=r.normal.map(i=>i*t):n=t,new Plane(n,r.xDir,r.normal)};let BoundingBox$1=class extends WrappingObj{constructor(t){const r=getOC();let n=t;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[t,r]=this.bounds;return`${new Vector(t).repr} - ${new Vector(r).repr}`}get bounds(){const t={current:0},r={current:0},n={current:0},i={current:0},o={current:0},a={current:0};return this.wrapped.Get(t,r,n,i,o,a),[[t.current,r.current,n.current],[i.current,o.current,a.current]]}get center(){const[[t,r,n],[i,o,a]]=this.bounds;return[t+(i-t)/2,r+(o-r)/2,n+(a-n)/2]}get width(){const[[t],[r]]=this.bounds;return Math.abs(r-t)}get height(){const[[,t],[,r]]=this.bounds;return Math.abs(r-t)}get depth(){const[[,,t],[,,r]]=this.bounds;return Math.abs(r-t)}add(t){this.wrapped.Add_1(t.wrapped)}isOut(t){return this.wrapped.IsOut_4(t.wrapped)}};function makePlane(e="XY",t=[0,0,0]){return e instanceof Plane?e.clone():createNamedPlane(e,t)}function rotate(e,t,r=[0,0,0],n=[0,0,1]){const i=new Transformation;i.rotate(t,r,n);const o=i.transform(e);return i.delete(),o}function translate(e,t){const r=new Transformation;r.translate(t);const n=r.transform(e);return r.delete(),n}function mirror$1(e,t,r){const n=new Transformation;n.mirror(t,r);const i=n.transform(e);return n.delete(),i}function scale(e,t,r){const n=new Transformation;n.scale(t,r);const i=n.transform(e);return n.delete(),i}function isPoint2D(e){return Array.isArray(e)&&e.length===2}let CURVE_TYPES_MAP=null;const getCurveTypesMap=e=>{if(CURVE_TYPES_MAP&&!e)return CURVE_TYPES_MAP;const r=getOC().GeomAbs_CurveType;return CURVE_TYPES_MAP=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),CURVE_TYPES_MAP},findCurveType=e=>{let t=getCurveTypesMap().get(e);if(t||(t=getCurveTypesMap(!0).get(e)),!t)throw new Error("unknown type");return t};function precisionRound(e,t){const r=Math.pow(10,t),n=t<0?e:.01/r+e;return Math.round(n*r)/r}function range$1(e){return Array.from(Array(e).keys())}function zip(e){const t=Math.min(...e.map(r=>r.length));return range$1(t).map(r=>e.map(n=>n[r]))}function round2(e){return Math.round(e*100)/100}const reprPnt=([e,t])=>`(${round2(e)},${round2(t)})`,asFixed=(e,t=1e-9)=>{let r=e;return Math.abs(e)<t&&(r=0),r.toFixed(-Math.log10(t))},removeDuplicatePoints=(e,t=1e-9)=>Array.from(new Map(e.map(([r,n])=>[`[${asFixed(r,t)},${asFixed(n,t)}]`,[r,n]])).values()),pnt=([e,t])=>{const r=getOC();return new r.gp_Pnt2d_3(e,t)},direction2d=([e,t])=>{const r=getOC();return new r.gp_Dir2d_4(e,t)},vec=([e,t])=>{const r=getOC();return new r.gp_Vec2d_4(e,t)},axis2d=(e,t)=>{const r=getOC(),[n,i]=localGC(),o=new r.gp_Ax2d_2(n(pnt(e)),n(direction2d(t)));return i(),o};class BoundingBox2d extends WrappingObj{constructor(t){const r=getOC();let n=t;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[t,r]=this.bounds;return`${reprPnt(t)} - ${reprPnt(r)}`}get bounds(){const t={current:0},r={current:0},n={current:0},i={current:0};return this.wrapped.Get(t,r,n,i),[[t.current,r.current],[n.current,i.current]]}get center(){const[[t,r],[n,i]]=this.bounds;return[t+(n-t)/2,r+(i-r)/2]}get width(){const[[t],[r]]=this.bounds;return Math.abs(r-t)}get height(){const[[,t],[,r]]=this.bounds;return Math.abs(r-t)}outsidePoint(t=1){const[r,n]=this.bounds,i=n[0]-r[0],o=n[1]-r[1];return[n[0]+i/100*t,n[1]+o/100*t*.9]}add(t){this.wrapped.Add_1(t.wrapped)}isOut(t){return this.wrapped.IsOut_4(t.wrapped)}containsPoint(t){const n=GCWithScope()(pnt(t));return!this.wrapped.IsOut_1(n)}}const samePoint$2=([e,t],[r,n],i=1e-6)=>Math.abs(e-r)<=i&&Math.abs(t-n)<=i,add2d=([e,t],[r,n])=>[e+r,t+n],subtract2d=([e,t],[r,n])=>[e-r,t-n],scalarMultiply2d=([e,t],r)=>[e*r,t*r],distance2d=([e,t],[r,n]=[0,0])=>Math.sqrt((e-r)**2+(t-n)**2),squareDistance2d=([e,t],[r,n]=[0,0])=>(e-r)**2+(t-n)**2;function crossProduct2d([e,t],[r,n]){return e*n-t*r}const angle2d=([e,t],[r,n]=[0,0])=>Math.atan2(n*e-t*r,e*r+t*n),polarAngle2d=([e,t],[r,n]=[0,0])=>Math.atan2(n-t,r-e),normalize2d=([e,t])=>{const r=distance2d([e,t]);return[e/r,t/r]},rotate2d=(e,t,r=[0,0])=>{const[n,i]=e,[o,a]=r,s=n-o,u=i-a,f=Math.sin(t),d=Math.cos(t),w=s*d-u*f,b=s*f+u*d;return[w+o,b+a]},polarToCartesian=(e,t)=>{const r=Math.cos(t)*e,n=Math.sin(t)*e;return[r,n]},cartesianToPolar=([e,t])=>{const r=distance2d([e,t]),n=Math.atan2(t,e);return[r,n]};class Curve2D extends WrappingObj{constructor(t){const r=getOC(),n=t.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const t=getOC(),r=new t.Bnd_Box2d;return t.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new BoundingBox2d(r),this._boundingBox}get repr(){return`${this.geomType} ${reprPnt(this.firstPoint)} - ${reprPnt(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(t){const r=this.innerCurve.Value(t),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const t=getOC();return new t.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const t=this.adaptor(),r=findCurveType(t.GetType());return t.delete(),r}clone(){return new Curve2D(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(t){const r=getOC(),n=GCWithScope(),i=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(pnt(t)),this.wrapped));let o=1/0;try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,distance2d(t,this.firstPoint),distance2d(t,this.lastPoint))}distanceFromCurve(t){const r=getOC(),n=GCWithScope();let i=1/0;const o=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,t.wrapped,this.firstParameter,this.lastParameter,t.firstParameter,t.lastParameter));try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,this.distanceFromPoint(t.firstPoint),this.distanceFromPoint(t.lastPoint),t.distanceFromPoint(this.firstPoint),t.distanceFromPoint(this.lastPoint))}distanceFrom(t){return isPoint2D(t)?this.distanceFromPoint(t):this.distanceFromCurve(t)}isOnCurve(t){return this.distanceFromPoint(t)<1e-9}parameter(t,r=1e-9){const n=getOC(),i=GCWithScope();let o,a;try{const s=i(new n.Geom2dAPI_ProjectPointOnCurve_2(i(pnt(t)),this.wrapped));o=s.LowerDistance(),a=s.LowerDistanceParameter()}catch{if(samePoint$2(t,this.firstPoint,r))return this.firstParameter;if(samePoint$2(t,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(o>r)throw new Error(`Point ${reprPnt(t)} not on curve ${this.repr}, ${o.toFixed(9)}`);return a}tangentAt(t){const r=getOC(),[n,i]=localGC();let o;Array.isArray(t)?o=this.parameter(t):o=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*t+this.innerCurve.FirstParameter();const a=n(new r.gp_Pnt2d_1),s=n(new r.gp_Vec2d_1);this.innerCurve.D1(o,a,s);const u=[s.X(),s.Y()];return i(),u}splitAt(t,r=1e-9){const n=getOC(),i=GCWithScope();let o=t.map(u=>isPoint2D(u)?this.parameter(u,r):u);o=Array.from(new Map(o.map(u=>[precisionRound(u,-Math.log10(r)),u])).values()).sort((u,f)=>u-f);const a=this.firstParameter,s=this.lastParameter;return a>s&&o.reverse(),Math.abs(o[0]-a)<r*100&&(o=o.slice(1)),o.length?(Math.abs(o[o.length-1]-s)<r*100&&(o=o.slice(0,-1)),o.length?zip([[a,...o],[...o,s]]).map(([u,f])=>{try{if(this.geomType==="BEZIER_CURVE"){const w=new n.Geom2d_BezierCurve_1(i(this.adaptor()).Bezier().get().Poles_2());return w.Segment(u,f),new Curve2D(new n.Handle_Geom2d_Curve_2(w))}if(this.geomType==="BSPLINE_CURVE"){const w=i(this.adaptor()).BSpline().get(),b=new n.Geom2d_BSplineCurve_1(w.Poles_2(),w.Knots_2(),w.Multiplicities_2(),w.Degree(),w.IsPeriodic());return b.Segment(u,f,r),new Curve2D(new n.Handle_Geom2d_Curve_2(b))}const d=new n.Geom2d_TrimmedCurve(this.wrapped,u,f,!0,!0);return new Curve2D(new n.Handle_Geom2d_Curve_2(d))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const approximateAsBSpline=(e,t=1e-4,r="C0",n=200)=>{const i=getOC(),o=GCWithScope(),a={C0:i.GeomAbs_Shape.GeomAbs_C0,C1:i.GeomAbs_Shape.GeomAbs_C1,C2:i.GeomAbs_Shape.GeomAbs_C2,C3:i.GeomAbs_Shape.GeomAbs_C3},s=o(new i.Geom2dConvert_ApproxCurve_2(e.ShallowCopy(),t,a[r],n,3));return new Curve2D(s.Curve())},BSplineToBezier=e=>{if(findCurveType(e.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const t=e.BSpline(),r=getOC(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(t);function*i(){const a=n.NbArcs();if(a)for(let s=1;s<=a;s++){const u=n.Arc(s);yield new Curve2D(u)}}const o=Array.from(i());return n.delete(),o};function approximateAsSvgCompatibleCurve(e,t={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=GCWithScope();return e.flatMap(n=>{const i=r(n.adaptor()),o=findCurveType(i.GetType());if(o==="ELLIPSE"||o==="CIRCLE"&&samePoint$2(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(o))return n;if(o==="BEZIER_CURVE"){const u=i.Bezier().get().Degree();if([1,2,3].includes(u))return n}if(o==="BSPLINE_CURVE"){const s=BSplineToBezier(i);return approximateAsSvgCompatibleCurve(s,t)}const a=approximateAsBSpline(i,t.tolerance,t.continuity,t.maxSegments);return approximateAsSvgCompatibleCurve(BSplineToBezier(r(a.adaptor())),t)})}function*pointsIteration(e){const t=e.NbPoints();if(t)for(let r=1;r<=t;r++){const n=e.Point(r);yield[n.X(),n.Y()]}}function*commonSegmentsIteration(e){const t=e.NbSegments();if(!t)return;const r=getOC();for(let n=1;n<=t;n++){const i=new r.Handle_Geom2d_Curve_1,o=new r.Handle_Geom2d_Curve_1;try{e.Segment(n,i,o)}catch{continue}yield new Curve2D(i),o.delete()}}const intersectCurves=(e,t,r=1e-9)=>{if(e.boundingBox.isOut(t.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=getOC(),i=new n.Geom2dAPI_InterCurveCurve_1;let o,a;try{i.Init_1(e.wrapped,t.wrapped,r),o=Array.from(pointsIteration(i)),a=Array.from(commonSegmentsIteration(i))}catch(f){throw console.error(e,t,f),new Error("Intersections failed between curves")}finally{i.delete()}const s=a.filter(f=>samePoint$2(f.firstPoint,f.lastPoint,r)).map(f=>f.firstPoint);s.length&&(o.push(...s),a=a.filter(f=>!samePoint$2(f.firstPoint,f.lastPoint,r)));const u=a.flatMap(f=>[f.firstPoint,f.lastPoint]);return{intersections:o,commonSegments:a,commonSegmentsPoints:u}},selfIntersections=(e,t=1e-9)=>{const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1;let i;try{n.Init_1(e.wrapped,e.wrapped,t),i=Array.from(pointsIteration(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return i},make2dSegmentCurve=(e,t)=>{const r=getOC(),[n,i]=localGC(),o=n(new r.GCE2d_MakeSegment_1(n(pnt(e)),n(pnt(t)))).Value(),a=new Curve2D(o);return samePoint$2(a.firstPoint,e)||a.reverse(),i(),a},make2dThreePointArc=(e,t,r)=>{const n=getOC(),[i,o]=localGC(),a=i(new n.GCE2d_MakeArcOfCircle_4(i(pnt(e)),i(pnt(t)),i(pnt(r)))).Value();o();const s=new Curve2D(a);return samePoint$2(s.firstPoint,e)||s.wrapped.get().SetTrim(s.lastParameter,s.firstParameter,!0,!0),s},make2dTangentArc=(e,t,r)=>{const n=getOC(),[i,o]=localGC(),a=i(new n.GCE2d_MakeArcOfCircle_5(i(pnt(e)),i(vec(t)),i(pnt(r)))).Value();o();const s=new Curve2D(a);return samePoint$2(s.firstPoint,e)||s.wrapped.get().SetTrim(s.lastParameter,s.firstParameter,!0,!0),s},make2dEllipseArc=(e,t,r,n,i=[0,0],o,a=!0)=>{const s=getOC(),[u,f]=localGC(),d=u(new s.gp_Elips2d_2(u(axis2d(i,o)),e,t,!0)),w=u(new s.GCE2d_MakeArcOfEllipse_1(d,r,n,a)).Value();return f(),new Curve2D(w)},make2dBezierCurve=(e,t,r)=>{const n=getOC(),[i,o]=localGC(),a=i(new n.TColgp_Array1OfPnt2d_2(1,t.length+2));a.SetValue(1,i(pnt(e))),t.forEach((u,f)=>{a.SetValue(f+2,i(pnt(u)))}),a.SetValue(t.length+2,i(pnt(r)));const s=new n.Geom2d_BezierCurve_1(a);return o(),new Curve2D(new n.Handle_Geom2d_Curve_2(s))},make2dArcFromCenter=(e,t,r)=>{const n=scalarMultiply2d(add2d(e,t),.5),i=distance2d(r,e),o=normalize2d(subtract2d(n,r));return make2dThreePointArc(e,add2d(scalarMultiply2d(o,i),r),t)},offsetEndPoints=(e,t,r)=>{const n=normalize2d(subtract2d(t,e)),i=[n[1],-n[0]],o=[i[0]*r,i[1]*r];return{firstPoint:add2d(e,o),lastPoint:add2d(t,o)}},make2dOffset=(e,t)=>{const r=GCWithScope(),n=e.geomType;if(n==="CIRCLE"){const u=r(r(e.adaptor()).Circle()),f=u.Radius(),d=u.IsDirect()?1:-1,w=t*d,b=f+w;if(b<1e-10){const v=r(u.Location()),p=[v.X(),v.Y()],y=E=>{const[P,A]=normalize2d(subtract2d(E,p));return add2d(E,[w*P,w*A])};return{collapsed:!0,firstPoint:y(e.firstPoint),lastPoint:y(e.lastPoint)}}const S=getOC(),x=new S.gp_Circ2d_3(u.Axis(),b),m=new S.Geom2d_Circle_1(x),h=new S.Geom2d_TrimmedCurve(new S.Handle_Geom2d_Curve_2(m),e.firstParameter,e.lastParameter,!0,!0);return new Curve2D(new S.Handle_Geom2d_Curve_2(h))}if(n==="LINE"){const{firstPoint:u,lastPoint:f}=offsetEndPoints(e.firstPoint,e.lastPoint,t);return make2dSegmentCurve(u,f)}const i=getOC(),o=new Curve2D(new i.Handle_Geom2d_Curve_2(new i.Geom2d_OffsetCurve(e.wrapped,t,!0))),a=approximateAsBSpline(o.adaptor());return selfIntersections(a).length?{collapsed:!0,firstPoint:a.firstPoint,lastPoint:a.lastPoint}:a};function removeCorner(e,t,r){const n=crossProduct2d(e.tangentAt(1),t.tangentAt(0));if(Math.abs(n)<1e-10)return null;const i=n>0?-1:1,o=Math.abs(r)*i,a=make2dOffset(e,o),s=make2dOffset(t,o);if(!(a instanceof Curve2D)||!(s instanceof Curve2D))return null;let u;try{const{intersections:S}=intersectCurves(a,s,1e-9);u=S.at(-1)}catch{return null}if(!isPoint2D(u))return null;const f=u,d=(S,x)=>{const[m,h]=x.tangentAt(f),v=normalize2d([-h,m]),p=add2d(f,scalarMultiply2d(v,o)),y=S.parameter(p,1e-6);return S.splitAt([y])},[w]=d(e,a),[,b]=d(t,s);return{first:w,second:b,center:f}}function filletCurves(e,t,r){const n=removeCorner(e,t,r);if(!n)return console.warn("Cannot fillet between curves",e.repr,t.repr),[e,t];const{first:i,second:o,center:a}=n;return[i,make2dArcFromCenter(i.lastPoint,o.firstPoint,a),o]}function chamferCurves(e,t,r){const n=removeCorner(e,t,r);if(!n)return console.warn("Cannot chamfer between curves",e.repr,t.repr),[e,t];const{first:i,second:o}=n;return[i,make2dSegmentCurve(i.lastPoint,o.firstPoint),o]}class FlatQueue{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,r){let n=this.length++;for(;n>0;){const i=n-1>>1,o=this.values[i];if(r>=o)break;this.ids[n]=this.ids[i],this.values[n]=o,n=i}this.ids[n]=t,this.values[n]=r}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],i=this.length>>1;let o=0;for(;o<i;){let a=(o<<1)+1;const s=a+1;let u=this.ids[a],f=this.values[a];const d=this.values[s];if(s<this.length&&d<f&&(a=s,u=this.ids[s],f=d),f>=n)break;this.ids[o]=u,this.values[o]=f,o=a}this.ids[o]=r,this.values[o]=n}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const ARRAY_TYPES=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],VERSION=3;class Flatbush{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(t,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==VERSION)throw new Error(`Got v${n>>4} data when expected v${VERSION}.`);const[i]=new Uint16Array(t,2,1),[o]=new Uint32Array(t,4,1);return new Flatbush(o,i,ARRAY_TYPES[n&15],t)}constructor(t,r=16,n=Float64Array,i){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535);let o=t,a=o;this._levelBounds=[o*4];do o=Math.ceil(o/this.nodeSize),a+=o,this._levelBounds.push(a*4);while(o!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const s=ARRAY_TYPES.indexOf(this.ArrayType),u=a*4*this.ArrayType.BYTES_PER_ELEMENT;if(s<0)throw new Error(`Unexpected typed array class: ${n}.`);i&&i instanceof ArrayBuffer?(this.data=i,this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+u,a),this._pos=a*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+u+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+u,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(VERSION<<4)+s]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t),this._queue=new FlatQueue}add(t,r,n,i){const o=this._pos>>2;return this._indices[o]=o,this._boxes[this._pos++]=t,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=i,t<this.minX&&(this.minX=t),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),i>this.maxY&&(this.maxY=i),o}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const t=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),i=(1<<16)-1;for(let o=0;o<this.numItems;o++){let a=4*o;const s=this._boxes[a++],u=this._boxes[a++],f=this._boxes[a++],d=this._boxes[a++],w=Math.floor(i*((s+f)/2-this.minX)/t),b=Math.floor(i*((u+d)/2-this.minY)/r);n[o]=hilbert(w,b)}sort(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let o=0,a=0;o<this._levelBounds.length-1;o++){const s=this._levelBounds[o];for(;a<s;){const u=a;let f=1/0,d=1/0,w=-1/0,b=-1/0;for(let S=0;S<this.nodeSize&&a<s;S++)f=Math.min(f,this._boxes[a++]),d=Math.min(d,this._boxes[a++]),w=Math.max(w,this._boxes[a++]),b=Math.max(b,this._boxes[a++]);this._indices[this._pos>>2]=u,this._boxes[this._pos++]=f,this._boxes[this._pos++]=d,this._boxes[this._pos++]=w,this._boxes[this._pos++]=b}}}search(t,r,n,i,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const s=[],u=[];for(;a!==void 0;){const f=Math.min(a+this.nodeSize*4,upperBound(a,this._levelBounds));for(let d=a;d<f;d+=4){if(n<this._boxes[d]||i<this._boxes[d+1]||t>this._boxes[d+2]||r>this._boxes[d+3])continue;const w=this._indices[d>>2]|0;a<this.numItems*4?(o===void 0||o(w))&&u.push(w):s.push(w)}a=s.pop()}return u}neighbors(t,r,n=1/0,i=1/0,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const s=this._queue,u=[],f=i*i;for(;a!==void 0;){const d=Math.min(a+this.nodeSize*4,upperBound(a,this._levelBounds));for(let w=a;w<d;w+=4){const b=this._indices[w>>2]|0,S=axisDist(t,this._boxes[w],this._boxes[w+2]),x=axisDist(r,this._boxes[w+1],this._boxes[w+3]),m=S*S+x*x;a<this.numItems*4?(o===void 0||o(b))&&s.push((b<<1)+1,m):s.push(b<<1,m)}for(;s.length&&s.peek()&1;)if(s.peekValue()>f||(u.push(s.pop()>>1),u.length===n))return s.clear(),u;a=s.pop()>>1}return s.clear(),u}}function axisDist(e,t,r){return e<t?t-e:e<=r?0:e-r}function upperBound(e,t){let r=0,n=t.length-1;for(;r<n;){const i=r+n>>1;t[i]>e?n=i:r=i+1}return t[r]}function sort(e,t,r,n,i,o){if(Math.floor(n/o)>=Math.floor(i/o))return;const a=e[n+i>>1];let s=n-1,u=i+1;for(;;){do s++;while(e[s]<a);do u--;while(e[u]>a);if(s>=u)break;swap$1(e,t,r,s,u)}sort(e,t,r,n,u,o),sort(e,t,r,u+1,i,o)}function swap$1(e,t,r,n,i){const o=e[n];e[n]=e[i],e[i]=o;const a=4*n,s=4*i,u=t[a],f=t[a+1],d=t[a+2],w=t[a+3];t[a]=t[s],t[a+1]=t[s+1],t[a+2]=t[s+2],t[a+3]=t[s+3],t[s]=u,t[s+1]=f,t[s+2]=d,t[s+3]=w;const b=r[n];r[n]=r[i],r[i]=b}function hilbert(e,t){let r=e^t,n=65535^r,i=65535^(e|t),o=e&(t^65535),a=r|n>>1,s=r>>1^r,u=i>>1^n&o>>1^i,f=r&i>>1^o>>1^o;r=a,n=s,i=u,o=f,a=r&r>>2^n&n>>2,s=r&n>>2^n&(r^n)>>2,u^=r&i>>2^n&o>>2,f^=n&i>>2^(r^n)&o>>2,r=a,n=s,i=u,o=f,a=r&r>>4^n&n>>4,s=r&n>>4^n&(r^n)>>4,u^=r&i>>4^n&o>>4,f^=n&i>>4^(r^n)&o>>4,r=a,n=s,i=u,o=f,u^=r&i>>8^n&o>>8,f^=n&i>>8^(r^n)&o>>8,r=u^u>>1,n=f^f>>1;let d=e^t,w=n|65535^(d|r);return d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,w=(w|w<<8)&16711935,w=(w|w<<4)&252645135,w=(w|w<<2)&858993459,w=(w|w<<1)&1431655765,(w<<1|d)>>>0}const stitchCurves=(e,t=1e-7)=>{const r=new Flatbush(e.length);e.forEach(o=>{const[a,s]=o.firstPoint;r.add(a-t,s-t,a+t,s+t)}),r.finish();const n=[],i=new Set;return e.forEach((o,a)=>{if(i.has(a))return;const s=[o];let u=a;i.add(a);let f=e.length;for(;;){if(f--<0)throw new Error("Infinite loop detected");const d=s[s.length-1].lastPoint,[w,b]=d,S=r.search(w-t,b-t,w+t,b+t),x=p=>Math.abs((u-p)%e.length),m=S.filter(p=>!i.has(p)).map(p=>[e[p],p,x(p)]).sort(([,,p],[,,y])=>x(p)-x(y));if(m.length===0){n.push(s);break}const[h,v]=m[0];s.push(h),i.add(v),u=v}}),n};function round5(e){return Math.round(e*1e5)/1e5}const fromPnt=e=>`${round2(e.X())} ${round2(e.Y())}`,adaptedCurveToPathElem=(e,t)=>{const r=getOC(),n=findCurveType(e.GetType()),[i,o]=t,a=`${round5(i)} ${round5(o)}`;if(n==="LINE")return`L ${a}`;if(n==="BEZIER_CURVE"){const s=e.Bezier().get(),u=s.Degree();if(u===1)return`L ${a}`;if(u===2)return`Q ${fromPnt(s.Pole(2))} ${a}`;if(u===3){const f=fromPnt(s.Pole(2)),d=fromPnt(s.Pole(3));return`C ${f} ${d} ${a}`}}if(n==="CIRCLE"){const s=e.Circle(),u=s.Radius(),f=e.FirstParameter(),w=(e.LastParameter()-f)*RAD2DEG,b=w!==360?a:`${round5(i)} ${round5(o+1e-4)}`;return`A ${u} ${u} 0 ${Math.abs(w)>180?"1":"0"} ${s.IsDirect()?"1":"0"} ${b}`}if(n==="ELLIPSE"){const s=e.Ellipse(),u=s.MajorRadius(),f=s.MinorRadius(),d=e.FirstParameter(),b=(e.LastParameter()-d)*RAD2DEG,S=b!==360?a:`${round5(i)} ${round5(o+1e-4)}`,x=new r.gp_Dir2d_1,m=180-s.XAxis().Direction().Angle(x)*RAD2DEG;return x.delete(),`A ${round5(u)} ${round5(f)} ${round5(m)} ${Math.abs(b)>180?"1":"0"} ${s.IsDirect()?"1":"0"} ${S}`}throw new Error(`Unsupported curve type: ${n}`)},DIRECTIONS={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},PLANE_TO_DIR={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Finder{constructor(){this.filters=[]}delete(){this.filters=[]}and(t){return t.forEach(r=>r(this)),this}not(t){const r=new this.constructor;t(r);const n=({element:i})=>!r.shouldKeep(i);return this.filters.push(n),this}either(t){const r=t.map(i=>{const o=new this.constructor;return i(o),o}),n=({element:i})=>r.some(o=>o.shouldKeep(i));return this.filters.push(n),this}find(t,{unique:r=!1}={}){const n=this.applyFilter(t);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class ProgressRange extends WrappingObj{constructor(){const t=getOC();super(new t.Message_ProgressRange_1)}}class DistanceQuery extends WrappingObj{constructor(t){const r=getOC();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(t.wrapped)}distanceTo(t){this.wrapped.LoadS2(t.wrapped);const r=new ProgressRange;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class Finder3d extends Finder{when(t){return this.filters.push(t),this}inList(t){const r=({element:n})=>!!t.find(i=>i.isSame(n));return this.filters.push(r),this}atAngleWith(t="Z",r=0){let n;typeof t=="string"?n=new Vector(DIRECTIONS[t]):n=new Vector(t);const i=({normal:o})=>{if(!o)return!1;const a=Math.acos(Math.abs(o.dot(n)));return Math.abs(a-DEG2RAD*r)<1e-6};return this.filters.push(i),this}atDistance(t,r=[0,0,0]){const n=makeVertex(r),i=new DistanceQuery(n),o=({element:a})=>Math.abs(i.distanceTo(a)-t)<1e-6;return this.filters.push(o),this}containsPoint(t){return this.atDistance(0,t)}withinDistance(t,r=[0,0,0]){const n=makeVertex(r),i=new DistanceQuery(n),o=({element:a})=>i.distanceTo(a)-t<1e-6;return this.filters.push(o),this}inBox(t,r){const n=makeBox(t,r);return this.inShape(n)}inShape(t){const r=new DistanceQuery(t),n=({element:i})=>r.distanceTo(i)<1e-6;return this.filters.push(n),this}}class EdgeFinder extends Finder3d{clone(){const t=new EdgeFinder;return t.filters=[...this.filters],t}inDirection(t){return this.atAngleWith(t,0)}ofLength(t){const r=({element:n})=>typeof t=="number"?Math.abs(n.length-t)<1e-9:t(n.length);return this.filters.push(r),this}ofCurveType(t){const r=({element:n})=>n.geomType===t;return this.filters.push(r),this}parallelTo(t){if(typeof t=="string"&&PLANE_TO_DIR[t])return this.atAngleWith(PLANE_TO_DIR[t],90);if(typeof t!="string"&&t instanceof Plane)return this.atAngleWith(t.zDir,90);if(typeof t!="string"&&t.normalAt){const r=t.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(t,r){const n=t instanceof Plane?makePlane(t):makePlane(t,r);this.parallelTo(n);const i=({element:o})=>{const a=o.startPoint,s=a.projectToPlane(n);return a.equals(s)};return this.filters.push(i),this}shouldKeep(t){let r=null;try{r=t.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:t}))}applyFilter(t){return t.edges.filter(r=>this.shouldKeep(r))}}class FaceFinder extends Finder3d{clone(){const t=new FaceFinder;return t.filters=[...this.filters],t}parallelTo(t){if(typeof t=="string"&&PLANE_TO_DIR[t])return this.atAngleWith(PLANE_TO_DIR[t]);if(typeof t!="string"&&t instanceof Plane)return this.atAngleWith(t.zDir);if(typeof t!="string"&&t.normalAt){const r=t.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(t){const r=({element:n})=>n.geomType===t;return this.filters.push(r),this}inPlane(t,r){const n=t instanceof Plane?makePlane(t):makePlane(t,r);this.parallelTo(n);const i=({element:o})=>{const a=o.center,s=a.projectToPlane(n);return a.equals(s)};return this.filters.push(i),this}shouldKeep(t){const r=t.normalAt();return this.filters.every(i=>i({normal:r,element:t}))}applyFilter(t){return t.faces.filter(r=>this.shouldKeep(r))}}const blueprintCorners=function(e){return e.curves.map((t,r)=>({firstCurve:t,secondCurve:e.curves[(r+1)%e.curves.length],point:t.lastPoint}))},PI_2=2*Math.PI,positiveHalfAngle=e=>{const t=e%PI_2,r=t<0?t+PI_2:t;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-PI_2)};class CornerFinder extends Finder{clone(){const t=new CornerFinder;return t.filters=[...this.filters],t}inList(t){const r=({element:n})=>!!t.find(i=>samePoint$2(i,n.point));return this.filters.push(r),this}atDistance(t,r=[0,0]){function n({element:i}){return Math.abs(distance2d(r,i.point)-t)<1e-9}return this.filters.push(n),this}atPoint(t){function r({element:n}){return samePoint$2(t,n.point)}return this.filters.push(r),this}inBox(t,r){const[n,i]=t,[o,a]=r,s=Math.min(n,o),u=Math.max(n,o),f=Math.min(i,a),d=Math.max(i,a);function w({element:b}){const[S,x]=b.point;return S>=s&&S<=u&&x>=f&&x<=d}return this.filters.push(w),this}ofAngle(t){function r({element:n}){const i=n.firstCurve.tangentAt(1),o=n.secondCurve.tangentAt(0);return Math.abs(positiveHalfAngle(angle2d(i,o))-positiveHalfAngle(DEG2RAD*t))<1e-9}return this.filters.push(r),this}shouldKeep(t){return this.filters.every(n=>n({normal:null,element:t}))}applyFilter(t){return blueprintCorners(t).filter(r=>this.shouldKeep(r))}}const asTopo=e=>{const t=getOC();return{vertex:t.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:t.TopAbs_ShapeEnum.TopAbs_WIRE,face:t.TopAbs_ShapeEnum.TopAbs_FACE,shell:t.TopAbs_ShapeEnum.TopAbs_SHELL,solid:t.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:t.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:t.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:t.TopAbs_ShapeEnum.TopAbs_EDGE,shape:t.TopAbs_ShapeEnum.TopAbs_SHAPE}[e]},iterTopo=function*(t,r){const n=getOC(),i=new n.TopExp_Explorer_2(t,asTopo(r),asTopo("shape")),o=new Map;for(;i.More();){const a=i.Current(),s=a.HashCode(HASH_CODE_MAX);o.get(s)||(o.set(s,!0),yield a),i.Next()}i.delete()},shapeType=e=>{if(e.IsNull())throw new Error("This shape has not type, it is null");return e.ShapeType()};class Shape extends WrappingObj{constructor(t){super(t)}clone(){return new this.constructor(downcast(this.wrapped))}get hashCode(){return this.wrapped.HashCode(HASH_CODE_MAX)}get isNull(){return this.wrapped.IsNull()}isSame(t){return this.wrapped.IsSame(t.wrapped)}isEqual(t){return this.wrapped.IsEqual(t.wrapped)}simplify(){const t=getOC(),r=new t.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=cast(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(t,r=0,n=0){const i=typeof t=="number"?[t,r,n]:t,o=cast(translate(this.wrapped,i));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}translateX(t){return this.translate([t,0,0])}translateY(t){return this.translate([0,t,0])}translateZ(t){return this.translate([0,0,t])}rotate(t,r=[0,0,0],n=[0,0,1]){const i=cast(rotate(this.wrapped,t,r,n));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}mirror(t,r){const n=cast(mirror$1(this.wrapped,t,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(t,r=[0,0,0]){const n=cast(scale(this.wrapped,r,t));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(t){return iterTopo(this.wrapped,t)}_listTopo(t){return Array.from(this._iterTopo(t)).map(r=>downcast(r))}get edges(){return this._listTopo("edge").map(t=>new Edge(t))}get faces(){return this._listTopo("face").map(t=>new Face(t))}get wires(){return this._listTopo("wire").map(t=>new Wire(t))}get boundingBox(){const t=new BoundingBox$1;return this.oc.BRepBndLib.Add(this.wrapped,t.wrapped,!0),t}_mesh({tolerance:t=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,t,!1,r,!1)}mesh({tolerance:t=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:t,angularTolerance:r});let n=[],i=[],o=[];const a=[];for(const s of this.faces){const u=s.triangulation(i.length/3);if(!u)continue;const{trianglesIndexes:f,vertices:d,verticesNormals:w}=u;a.push({start:n.length,count:f.length,faceId:s.hashCode}),n=n.concat(f),i=i.concat(d),o=o.concat(w)}return{triangles:n,vertices:i,normals:o,faceGroups:a}}meshEdges({tolerance:t=.001,angularTolerance:r=.1}={}){var n;const i=GCWithScope(),o=new Set,a=[],s=[],u=()=>{const d=a.length;let w=null;return[b=>{w?(a.push(...w),w=[b.X(),b.Y(),b.Z()],a.push(...w)):w=[b.X(),b.Y(),b.Z()]},b=>{s.push({start:d/3,count:(a.length-d)/3,edgeId:b}),o.add(b)}]},f=i(new this.oc.TopLoc_Location_1);for(const d of this.faces){const w=i(this.oc.BRep_Tool.Triangulation(d.wrapped,f,0));if(w.IsNull())continue;const b=w.get();for(const S of d.edges){if(i(S),o.has(S.hashCode))continue;const x=i(new this.oc.TopLoc_Location_1),m=i(this.oc.BRep_Tool.PolygonOnTriangulation_1(S.wrapped,w,x)),h=(n=m==null?void 0:m.get())==null?void 0:n.Nodes();if(!h)continue;i(h);const[v,p]=u();for(let y=h.Lower();y<=h.Upper();y++){const E=i(i(b.Node(h.Value(y))).Transformed(x.Transformation()));v(E)}p(S.hashCode)}}for(const d of this.edges){i(d);const w=d.hashCode;if(o.has(w))continue;const b=i(new this.oc.BRepAdaptor_Curve_2(d.wrapped)),S=i(new this.oc.GCPnts_TangentialDeflection_2(b,t,r,2,1e-9,1e-7)),[x,m]=u();for(let h=0;h<S.NbPoints();h++){const v=i(S.Value(h+1).Transformed(f.Transformation()));x(v)}m(w)}return{lines:a,edgeGroups:s}}blobSTEP(){const t="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const i=r.Write(t);if(r.delete(),n.delete(),i===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const o=this.oc.FS.readFile("/"+t);return this.oc.FS.unlink("/"+t),new Blob([o],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:t=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:t,angularTolerance:r});const i="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,i,!n)){const a=this.oc.FS.readFile("/"+i);return this.oc.FS.unlink("/"+i),new Blob([a],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class Vertex extends Shape{}class _1DShape extends Shape{get repr(){const{startPoint:t,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return t.delete(),r.delete(),n}get curve(){return new Curve(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(t=0){return this.curve.tangentAt(t)}pointAt(t=0){return this.curve.pointAt(t)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const t=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,t,!0,!1);const r=t.Mass();return t.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Curve extends WrappingObj{get repr(){const{startPoint:t,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return t.delete(),r.delete(),n}get curveType(){const t=this.wrapped.GetType&&this.wrapped.GetType();return findCurveType(t)}get startPoint(){const t=this.wrapped.Value(this.wrapped.FirstParameter());return new Vector(t)}get endPoint(){const t=this.wrapped.Value(this.wrapped.LastParameter());return new Vector(t)}_mapParameter(t){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*t}pointAt(t=.5){return new Vector(this.wrapped.Value(this._mapParameter(t)))}tangentAt(t=.5){const r=this._mapParameter(t),n=new this.oc.gp_Pnt_1,i=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,i);const o=new Vector(i);return n.delete(),i.delete(),o}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Edge extends _1DShape{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Wire extends _1DShape{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(t,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},i=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);i.Perform(t,0);const o=cast(i.Shape());if(i.delete(),this.delete(),!(o instanceof Wire))throw new Error("Could not offset with a wire");return o}}class Surface extends WrappingObj{get surfaceType(){const t=this.oc.GeomAbs_SurfaceType,n=new Map([[t.GeomAbs_Plane,"PLANE"],[t.GeomAbs_Cylinder,"CYLINDRE"],[t.GeomAbs_Cone,"CONE"],[t.GeomAbs_Sphere,"SPHERE"],[t.GeomAbs_Torus,"TORUS"],[t.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[t.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[t.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[t.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[t.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[t.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Face extends Shape{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Surface(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const t=this.surface,r=t.surfaceType;return t.delete(),r}get UVBounds(){const t={current:0},r={current:0},n={current:0},i={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,t,r,n,i),{uMin:t.current,uMax:r.current,vMin:n.current,vMax:i.current}}pointOnSurface(t,r){const{uMin:n,uMax:i,vMin:o,vMax:a}=this.UVBounds,s=this._geomAdaptor(),u=new this.oc.gp_Pnt_1,f=t*(i-n)+n,d=r*(a-o)+o;s.D0(f,d,u);const w=new Vector(u);return s.delete(),u.delete(),w}normalAt(t){let r=0,n=0;const i=GCWithScope();if(t){const f=i(this.oc.BRep_Tool.Surface_2(this.wrapped)),d=i(new this.oc.GeomAPI_ProjectPointOnSurf_2(i(asPnt(t)),f,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),w={current:0},b={current:0};d.LowerDistanceParameters(w,b),r=w.current,n=b.current}else{const{uMin:f,uMax:d,vMin:w,vMax:b}=this.UVBounds;r=.5*(f+d),n=.5*(w+b)}const o=i(new this.oc.gp_Pnt_1),a=i(new this.oc.gp_Vec_1);return i(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,o,a),new Vector(a)}get center(){const t=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,t,1e-7,!0);const r=new Vector(t.CentreOfMass());return t.delete(),r}outerWire(){const t=new Wire(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),t}innerWires(){const t=this.clone().outerWire(),r=this.wires.filter(n=>!t.isSame(n));return t.delete(),this.delete(),r}triangulation(t=0){const r=GCWithScope(),n=r(new this.oc.TopLoc_Location_1),i=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(i.IsNull())return null;const o=r(n.Transformation()),a={vertices:[],trianglesIndexes:[],verticesNormals:[]},s=i.get(),u=s.NbNodes();a.vertices=new Array(u*3);for(let x=1;x<=u;x++){const m=r(r(s.Node(x)).Transformed(o));a.vertices[(x-1)*3+0]=m.X(),a.vertices[(x-1)*3+1]=m.Y(),a.vertices[(x-1)*3+2]=m.Z()}const f=r(new this.oc.TColgp_Array1OfDir_2(1,u)),d=r(new this.oc.Poly_Connect_2(i));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,d,f),a.verticesNormals=new Array(f.Length()*3);for(let x=f.Lower();x<=f.Upper();x++){const m=r(r(f.Value(x)).Transformed(o));a.verticesNormals[(x-1)*3+0]=m.X(),a.verticesNormals[(x-1)*3+1]=m.Y(),a.verticesNormals[(x-1)*3+2]=m.Z()}const w=this.orientation,b=s.NbTriangles();a.trianglesIndexes=new Array(b*3);let S=0;for(let x=1;x<=b;x++){const m=r(s.Triangle(x));let h=m.Value(1),v=m.Value(2);const p=m.Value(3);if(w==="backward"){const y=h;h=v,v=y}a.trianglesIndexes[S*3+0]=h-1+t,a.trianglesIndexes[S*3+1]=v-1+t,a.trianglesIndexes[S*3+2]=p-1+t,S++}return a}}class _3DShape extends Shape{fuse(t,{optimisation:r="none"}={}){const n=GCWithScope(),i=n(new this.oc.Message_ProgressRange_1),o=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,t.wrapped,i));r==="commonFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),o.Build(i),o.SimplifyResult(!0,!0,.001);const a=cast(o.Shape());if(!isShape3D(a))throw new Error("Could not fuse as a 3d shape");return a}cut(t,{optimisation:r="none"}={}){const n=GCWithScope(),i=n(new this.oc.Message_ProgressRange_1),o=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,t.wrapped,i));r==="commonFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&o.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),o.Build(i),o.SimplifyResult(!0,!0,.001);const a=cast(o.Shape());if(!isShape3D(a))throw new Error("Could not cut as a 3d shape");return a}intersect(t){const r=GCWithScope(),n=r(new this.oc.Message_ProgressRange_1),i=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,t.wrapped,n));i.Build(n),i.SimplifyResult(!0,!0,.001);const o=cast(i.Shape());if(!isShape3D(o))throw new Error("Could not intersect as a 3d shape");return o}shell(t,r=null,n=.001){const i=typeof r=="number"?r:n;let o,a;if(typeof t=="number"){a=t;const S=new FaceFinder;o=typeof r=="function"?r(S):S}else a=t.thickness,o=t.filter;const s=GCWithScope(),u=o.find(this),f=s(new this.oc.TopTools_ListOfShape_1);u.forEach(S=>{f.Append_1(S.wrapped)});const d=s(new this.oc.Message_ProgressRange_1),w=s(new this.oc.BRepOffsetAPI_MakeThickSolid);w.MakeThickSolidByJoin(this.wrapped,f,-a,i,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,d);const b=cast(w.Shape());if(!isShape3D(b))throw new Error("Could not shell as a 3d shape");return b}_builderIter(t,r){if(typeof t=="number"){let a=0;for(const s of this._iterTopo("edge"))r(t,downcast(s)),a+=1;return a}let n,i=null;typeof t=="function"?n=t:(n=a=>t.filter.shouldKeep(a)?t.radius||1:0,t.filter&&!t.keep&&(i=()=>t.filter.delete()));let o=0;for(const a of this._iterTopo("edge")){const s=downcast(a),u=new Edge(s),f=n(u);f&&(r(f,s),o+=1),u.delete()}return i&&i(),o}fillet(t,r){const i=GCWithScope()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let o=t;if(typeof t=="number"&&r&&(o={radius:t,filter:r(new EdgeFinder)}),!this._builderIter(o,(u,f)=>i.Add_2(u,f)))throw new Error("Could not fillet, no edge was selected");const s=cast(i.Shape());if(!isShape3D(s))throw new Error("Could not fillet as a 3d shape");return s}chamfer(t,r){const i=GCWithScope()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let o=t;if(typeof t=="number"&&r&&(o={radius:t,filter:r(new EdgeFinder)}),!this._builderIter(o,(u,f)=>i.Add_2(u,f)))throw new Error("Could not chamfer, no edge was selected");const s=cast(i.Shape());if(!isShape3D(s))throw new Error("Could not chamfer as a 3d shape");return s}}class Shell extends _3DShape{}class Solid extends _3DShape{}class CompSolid extends _3DShape{}class Compound extends _3DShape{}function isShape3D(e){return e instanceof Shell||e instanceof Solid||e instanceof CompSolid||e instanceof Compound}function isWire(e){return e instanceof Wire}function downcast(e){const t=getOC(),r=t.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,t.TopoDS.Edge_1],[r.TopAbs_WIRE,t.TopoDS.Wire_1],[r.TopAbs_FACE,t.TopoDS.Face_1],[r.TopAbs_SHELL,t.TopoDS.Shell_1],[r.TopAbs_SOLID,t.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,t.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,t.TopoDS.Compound_1]]),i=shapeType(e),o=n.get(i);if(!o)throw new Error("Could not find a wrapper for this shape type");return o(e)}function cast(e){const r=getOC().TopAbs_ShapeEnum,i=new Map([[r.TopAbs_VERTEX,Vertex],[r.TopAbs_EDGE,Edge],[r.TopAbs_WIRE,Wire],[r.TopAbs_FACE,Face],[r.TopAbs_SHELL,Shell],[r.TopAbs_SOLID,Solid],[r.TopAbs_COMPSOLID,CompSolid],[r.TopAbs_COMPOUND,Compound]]).get(shapeType(e));if(!i)throw new Error("Could not find a wrapper for this shape type");return new i(downcast(e))}const makeLine=(e,t)=>{const r=getOC();return new Edge(new r.BRepBuilderAPI_MakeEdge_3(asPnt(e),asPnt(t)).Edge())},makeCircle=(e,t=[0,0,0],r=[0,0,1])=>{const n=getOC(),[i,o]=localGC(),a=i(makeAx2(t,r)),s=i(new n.gp_Circ_2(a,e)),u=i(new n.BRepBuilderAPI_MakeEdge_8(s)),f=new Edge(u.Edge());return o(),f},makeHelix=(e,t,r,n=[0,0,0],i=[0,0,1],o=!1)=>{const a=getOC(),[s,u]=localGC();let f=2*Math.PI;o&&(f=-2*Math.PI);const d=s(new a.Geom2d_Line_3(s(new a.gp_Pnt2d_3(0,0)),s(new a.gp_Dir2d_4(f,e)))),w=t/e,b=d.Value(0),S=d.Value(w*Math.sqrt((2*Math.PI)**2+e**2)),x=s(new a.GCE2d_MakeSegment_1(b,S)),m=new a.Geom_CylindricalSurface_1(s(makeAx3(n,i)),r),h=s(new a.BRepBuilderAPI_MakeEdge_30(s(new a.Handle_Geom2d_Curve_2(x.Value().get())),s(new a.Handle_Geom_Surface_2(m)))).Edge(),v=s(new a.BRepBuilderAPI_MakeWire_2(h)).Wire();return a.BRepLib.BuildCurves3d_2(v),u(),new Wire(v)},assembleWire=e=>{const t=getOC(),r=new t.BRepBuilderAPI_MakeWire_1;e.forEach(a=>{a instanceof Edge&&r.Add_1(a.wrapped),a instanceof Wire&&r.Add_2(a.wrapped)});const n=new t.Message_ProgressRange_1;r.Build(n);const i=r.Error();if(i!==t.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const a=new Map([[t.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[t.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[t.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${a.get(i)||"unknown error"}`)}const o=new Wire(r.Wire());return r.delete(),n.delete(),o},makeFace=(e,t)=>{const r=getOC(),n=new r.BRepBuilderAPI_MakeFace_15(e.wrapped,!1);if(t==null||t.forEach(o=>{n.Add(o.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const i=n.Face();return n.delete(),new Face(i)},makeNewFaceWithinFace=(e,t)=>{const r=getOC(),[n,i]=localGC(),o=n(r.BRep_Tool.Surface_2(e.wrapped)),s=n(new r.BRepBuilderAPI_MakeFace_21(o,t.wrapped,!0)).Face();return i(),new Face(s)},makeCylinder=(e,t,r=[0,0,0],n=[0,0,1])=>{const i=getOC(),o=makeAx2(r,n),a=new i.BRepPrimAPI_MakeCylinder_3(o,e,t),s=new Solid(a.Shape());return o.delete(),a.delete(),s},makeSphere=e=>{const t=getOC(),r=new t.BRepPrimAPI_MakeSphere_1(e),n=new Solid(r.Shape());return r.delete(),n};class EllpsoidTransform extends WrappingObj{constructor(t,r,n){const i=getOC(),o=GCWithScope(),a=Math.sqrt(t*r/n),s=t/a,u=r/a,f=new i.gp_GTrsf_1;f.SetAffinity_1(makeAx1([0,0,0],[0,1,0]),s);const d=o(new i.gp_GTrsf_1);d.SetAffinity_1(makeAx1([0,0,0],[0,0,1]),a);const w=o(new i.gp_GTrsf_1);w.SetAffinity_1(makeAx1([0,0,0],[1,0,0]),u),f.Multiply(d),f.Multiply(w),super(f)}applyToPoint(t){const r=getOC(),i=GCWithScope()(t.XYZ());return this.wrapped.Transforms_1(i),new r.gp_Pnt_2(i)}}function convertToJSArray(e){const t=[];for(let r=e.LowerRow();r<=e.UpperRow();r++){const n=[];t.push(n);for(let i=e.LowerCol();i<=e.UpperCol();i++){const o=e.Value(r,i);n.push(o)}}return t}const makeEllipsoid=(e,t,r)=>{const n=getOC(),i=GCWithScope(),o=i(new n.gp_Sphere_1);o.SetRadius(1);const a=i(new n.Geom_SphericalSurface_2(o)),s=n.GeomConvert.SurfaceToBSplineSurface(a.UReversed()).get(),u=convertToJSArray(s.Poles_2()),f=new EllpsoidTransform(e,t,r);u.forEach((w,b)=>{w.forEach((S,x)=>{const m=f.applyToPoint(S);s.SetPole_1(b+1,x+1,m)})});const d=cast(i(new n.BRepBuilderAPI_MakeShell_2(s.UReversed(),!1)).Shell());return makeSolid([d])},makeBox=(e,t)=>{const r=getOC(),n=new r.BRepPrimAPI_MakeBox_4(asPnt(e),asPnt(t)),i=new Solid(n.Solid());return n.delete(),i},makeVertex=e=>{const t=getOC(),r=asPnt(e),n=new t.BRepBuilderAPI_MakeVertex(r),i=n.Vertex();return n.delete(),new Vertex(i)},compoundShapes=e=>{const t=getOC(),r=new t.TopoDS_Builder,n=new t.TopoDS_Compound;return r.MakeCompound(n),e.forEach(o=>{r.Add(n,o.wrapped),o.delete()}),cast(n)};function _weld(e){const t=getOC(),r=GCWithScope(),n=r(new t.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return e.forEach(({wrapped:i})=>{n.Add(i)}),n.Perform(r(new t.Message_ProgressRange_1)),cast(downcast(n.SewedShape()))}function makeSolid(e){const t=GCWithScope(),r=getOC(),n=_weld(e),i=cast(t(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(i instanceof Solid))throw new Error("Could not make a solid of faces and shells");return i}const addHolesInFace=(e,t)=>{const r=getOC(),[n,i]=localGC(),o=n(new r.BRepBuilderAPI_MakeFace_2(e.wrapped));t.forEach(f=>{o.Add(f.wrapped)});const a=n(o.Face()),s=n(new r.ShapeFix_Face_2(a));s.FixOrientation_1();const u=s.Face();return i(),new Face(u)},isTangent=e=>e==="symmetric"||typeof e=="number"||Array.isArray(e)&&e.length===2,defaultsSplineConfig=e=>{let t;e?isTangent(e)?t={endTangent:e}:t={endTangent:0,...e}:t={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:i=1,startTangent:o}=t;let a;typeof r=="number"?a=polarToCartesian(1,r*DEG2RAD):a=r;let s;return typeof o=="number"?s=polarToCartesian(1,o*DEG2RAD):s=o,{endTangent:a,startFactor:n,endFactor:i,startTangent:s}};function radianAngle(e,t,r,n){const i=e*r+t*n,o=Math.sqrt((e*e+t*t)*(r*r+n*n));let a=Math.acos(i/o);return e*n-t*r<0&&(a=-a),a}function convertSvgEllipseParams([e,t],[r,n],i,o,a,s,u){const f=Math.PI*2;if(i<0&&(i=-i),o<0&&(o=-o),i==0||o==0)throw Error("rx and ry can not be 0");const d=Math.sin(a),w=Math.cos(a),b=(e-r)/2,S=(t-n)/2,x=(e+r)/2,m=(t+n)/2,h=w*b+d*S,v=w*S-d*b,p=h*h/(i*i)+v*v/(o*o);p>1&&(i=i*Math.sqrt(p),o=o*Math.sqrt(p));const y=i*o,E=i*v,P=o*h,A=E*E+P*P;if(!A)throw Error("start point can not be same as end point");let L=Math.sqrt(Math.abs((y*y-A)/A));s==u&&(L=-L);const B=L*E/o,F=-L*P/i,U=w*B-d*F+x,T=d*B+w*F+m,I=(h-B)/i,_=(h+B)/i,D=(v-F)/o,z=(v+F)/o,M=radianAngle(1,0,I,D);let q=radianAngle(I,D,-_,-z);for(;q>f;)q-=f;for(;q<0;)q+=f;u||(q-=f);let J=M+q;for(;J>f;)J-=f;for(;J<0;)J+=f;return{cx:U,cy:T,startAngle:M,deltaAngle:q,endAngle:J,clockwise:!!u,rx:i,ry:o}}const basicFaceExtrusion=(e,t)=>{const r=getOC(),n=new r.BRepPrimAPI_MakePrism_1(e.wrapped,t.wrapped,!1,!0),i=new Solid(downcast(n.Shape()));return n.delete(),i},revolution=(e,t=[0,0,0],r=[0,0,1],n=360)=>{const i=getOC(),o=makeAx1(t,r),a=new i.BRepPrimAPI_MakeRevol_1(e.wrapped,o,n*DEG2RAD,!1),s=cast(a.Shape());if(o.delete(),a.delete(),!isShape3D(s))throw new Error("Could not revolve to a 3d shape");return s};function genericSweep(e,t,{frenet:r=!1,auxiliarySpine:n,law:i=null,transitionMode:o="right",withContact:a,support:s,forceProfileSpineOthogonality:u}={},f=!1){const d=getOC(),w=o==="round"?!0:!!u,b=new d.BRepOffsetAPI_MakePipeShell(t.wrapped);if(o){const m={transformed:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[o];m&&b.SetTransitionMode(m)}s?b.SetMode_4(s):r&&b.SetMode_1(r),n&&b.SetMode_5(n.wrapped,!1,d.BRepFill_TypeOfContact.BRepFill_NoContact),i?b.SetLaw_1(e.wrapped,i,!!a,w):b.Add_1(e.wrapped,!!a,w);const S=new d.Message_ProgressRange_1;b.Build(S),f||b.MakeSolid();const x=cast(b.Shape());if(!isShape3D(x))throw new Error("Could not sweep to a 3d shape");if(f){const m=cast(b.FirstShape()),h=cast(b.LastShape());if(!isWire(m))throw new Error("Could not sweep with one start wire");if(!isWire(h))throw new Error("Could not sweep with one end wire");return b.delete(),[x,m,h]}return b.delete(),S.delete(),x}const buildLawFromProfile=(e,{profile:t,endFactor:r=1})=>{let n;const i=getOC();if(t==="s-curve")n=new i.Law_S,n.Set_1(0,1,e,r);else if(t==="linear")n=new i.Law_Linear,n.Set(0,1,e,r);else throw new Error("Could not generate a law function");return n.Trim(0,e,1e-6)};function complexExtrude(e,t,r,n,i=!1){const o=new Vector(t),a=new Vector(r),s=makeLine(o,o.add(a)),u=assembleWire([s]),f=n?buildLawFromProfile(a.Length,n):null;return i?genericSweep(e,u,{law:f},i):genericSweep(e,u,{law:f},i)}function twistExtrude(e,t,r,n,i,o=!1){const a=new Vector(r),s=new Vector(n),u=makeLine(a,a.add(s)),f=assembleWire([u]),d=360/t*s.Length,w=1,b=makeHelix(d,s.Length,w,r,n),S=i?buildLawFromProfile(s.Length,i):null;return o?genericSweep(e,f,{auxiliarySpine:b,law:S},o):genericSweep(e,f,{auxiliarySpine:b,law:S},o)}const loft=(e,{ruled:t=!0,startPoint:r,endPoint:n}={},i=!1)=>{const o=getOC(),[a,s]=localGC(),u=a(new o.BRepOffsetAPI_ThruSections(!i,t,1e-6));r&&u.AddVertex(a(makeVertex(r)).wrapped),e.forEach(w=>u.AddWire(w.wrapped)),n&&u.AddVertex(a(makeVertex(n)).wrapped);const f=a(new o.Message_ProgressRange_1);u.Build(f);const d=cast(u.Shape());if(s(),!isShape3D(d))throw new Error("Could not loft to a 3d shape");return d};class Sketch{constructor(t,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=t,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(t){t?this._baseFace=t.clone():this._baseFace=t}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const t=new Sketch(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(t.baseFace=this.baseFace.clone()),t}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(t){this._defaultOrigin=new Vector(t)}get defaultDirection(){return this._defaultDirection}set defaultDirection(t){this._defaultDirection=new Vector(t)}face(){let t;return this.baseFace?t=makeNewFaceWithinFace(this.baseFace,this.wire):t=makeFace(this.wire),t}wires(){return this.wire.clone()}faces(){return this.face()}revolve(t,{origin:r}={}){const n=makeFace(this.wire),i=revolution(n,r||this.defaultOrigin,t);return n.delete(),this.delete(),i}extrude(t,{extrusionDirection:r,extrusionProfile:n,twistAngle:i,origin:o}={}){const[a,s]=localGC(),u=a(new Vector(r||this.defaultDirection).normalized().multiply(t));if(n&&!i){const w=complexExtrude(this.wire,o||this.defaultOrigin,u,n);return s(),this.delete(),w}if(i){const w=twistExtrude(this.wire,i,o||this.defaultOrigin,u,n);return s(),this.delete(),w}const f=makeFace(this.wire),d=basicFaceExtrusion(f,u);return s(),this.delete(),d}sweepSketch(t,r={}){const n=this.wire.startPoint,i=this.wire.tangentAt(1e-9).multiply(-1).normalize(),o=i.cross(this.defaultDirection).multiply(-1),a=t(new Plane(n,o,i),n),s={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(s.support=this.baseFace.wrapped);const u=genericSweep(a.wire,this.wire,s);return this.delete(),u}loftWith(t,r={},n=!1){const i=Array.isArray(t)?[this,...t]:[this,t],o=loft(i.map(a=>a.wire),r,n);return i.forEach(a=>a.delete()),o}}const curvesBoundingBox=e=>{const t=getOC(),r=new t.Bnd_Box2d;return e.forEach(n=>{t.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new BoundingBox2d(r)};function curvesAsEdgesOnPlane(e,t){const[r,n]=localGC(),i=r(makeAx2(t.origin,t.zDir,t.xDir)),o=getOC(),a=e.map(s=>{const u=o.GeomLib.To3d(i,s.wrapped);return new Edge(new o.BRepBuilderAPI_MakeEdge_24(u).Edge())});return n(),a}const curvesAsEdgesOnSurface=(e,t)=>{const[r,n]=localGC(),i=getOC(),o=e.map(a=>{const s=r(new i.BRepBuilderAPI_MakeEdge_30(a.wrapped,t));return new Edge(s.Edge())});return n(),o},transformCurves=(e,t)=>{const r=getOC();return e.map(i=>t?new Curve2D(r.GeomLib.GTransform(i.wrapped,t)):i.clone())};class Transformation2D extends WrappingObj{transformCurves(t){return transformCurves(t,this.wrapped)}}const stretchTransform2d=(e,t,r=[0,0])=>{const n=getOC(),i=axis2d(r,t),o=new n.gp_GTrsf2d_1;return o.SetAffinity(i,e),i.delete(),new Transformation2D(o)},translationTransform2d=e=>{const t=getOC(),[r,n]=localGC(),i=new t.gp_Trsf2d_1;i.SetTranslation_1(r(vec(e)));const o=new t.gp_GTrsf2d_2(i);return n(),new Transformation2D(o)},mirrorTransform2d=(e,t=[0,0],r="center")=>{const n=getOC(),[i,o]=localGC(),a=new n.gp_Trsf2d_1;r==="center"?a.SetMirror_1(i(pnt(e))):a.SetMirror_2(i(axis2d(t,e)));const s=new n.gp_GTrsf2d_2(a);return o(),new Transformation2D(s)},rotateTransform2d=(e,t=[0,0])=>{const r=getOC(),[n,i]=localGC(),o=new r.gp_Trsf2d_1;o.SetRotation(n(pnt(t)),e);const a=new r.gp_GTrsf2d_2(o);return i(),new Transformation2D(a)},scaleTransform2d=(e,t=[0,0])=>{const r=getOC(),[n,i]=localGC(),o=new r.gp_Trsf2d_1;o.SetScale(n(pnt(t)),e);const a=new r.gp_GTrsf2d_2(o);return i(),new Transformation2D(a)};function curvesAsEdgesOnFace(e,t,r="original"){const[n,i]=localGC(),o=getOC();let a=n(o.BRep_Tool.Surface_2(t.wrapped));const s=t.UVBounds;let u=null;const f=n(axis2d([0,0],[0,1])),d=n(axis2d([0,0],[1,0]));if(r==="original"&&t.geomType!=="PLANE"){if(t.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const S=n(a.get().Cylinder());S.Direct()||(a=a.get().UReversed());const x=S.Radius();u=stretchTransform2d(1/x,[0,1]).wrapped}if(r==="bounds"){if(u=n(new o.gp_GTrsf2d_1),u.SetAffinity(f,s.uMax-s.uMin),s.uMin!==0){const x=n(new o.gp_GTrsf2d_1);x.SetTranslationPart(new o.gp_XY_2(0,-s.uMin)),u.Multiply(x)}const S=n(new o.gp_GTrsf2d_1);if(S.SetAffinity(d,s.vMax-s.vMin),u.Multiply(S),s.vMin!==0){const x=n(new o.gp_GTrsf2d_1);x.SetTranslationPart(n(new o.gp_XY_2(0,-s.vMin))),u.Multiply(x)}}const w=transformCurves(e,u),b=curvesAsEdgesOnSurface(w,a);return i(),b}function edgeToCurve(e,t){const r=getOC(),i=GCWithScope()(new r.BRepAdaptor_Curve2d_2(e.wrapped,t.wrapped)),o=new r.Geom2d_TrimmedCurve(i.Curve(),i.FirstParameter(),i.LastParameter(),!0,!0);return e.orientation==="backward"&&o.Reverse(),new Curve2D(new r.Handle_Geom2d_Curve_2(o))}const viewbox=(e,t=1)=>{const r=e.bounds[0][0]-t,n=-e.bounds[1][1]-t;return`${r} ${n} ${e.width+2*t} ${e.height+2*t}`},asSVG=(e,t,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${viewbox(t,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${e}
</svg>`;class Blueprint{constructor(t){this.curves=t,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(t=>t.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new Blueprint(this.curves)}get repr(){return["Blueprint",...this.curves.map(t=>t.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=curvesBoundingBox(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const t=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=t.map((n,i)=>{const o=t[(i+1)%t.length];return(o[0]-n[0])*(o[1]+n[1])}).reduce((n,i)=>n+i,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(t,r,n=[0,0]){const i=stretchTransform2d(t,r,n).transformCurves(this.curves);return new Blueprint(i)}scale(t,r){const n=r||this.boundingBox.center,i=scaleTransform2d(t,n).transformCurves(this.curves);return new Blueprint(i)}rotate(t,r){const n=rotateTransform2d(t*DEG2RAD,r).transformCurves(this.curves);return new Blueprint(n)}translate(t,r=0){const n=isPoint2D(t)?t:[t,r],i=translationTransform2d(n).transformCurves(this.curves);return new Blueprint(i)}mirror(t,r=[0,0],n="center"){const i=mirrorTransform2d(t,r,n).transformCurves(this.curves);return new Blueprint(i)}sketchOnPlane(t,r){const n=t instanceof Plane?makePlane(t):makePlane(t,r),i=curvesAsEdgesOnPlane(this.curves,n),o=assembleWire(i);return new Sketch(o,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(t,r){const n=getOC(),i=curvesAsEdgesOnFace(this.curves,t,r),o=assembleWire(i);n.BRepLib.BuildCurves3d_2(o.wrapped);const a=new n.ShapeFix_Wire_2(o.wrapped,t.wrapped,1e-9);a.FixEdgeCurves(),a.delete();const s=new Sketch(o);if(o.isClosed){const u=s.clone().face();s.defaultOrigin=u.pointOnSurface(.5,.5),s.defaultDirection=u.normalAt(),u.orientation!==t.orientation&&(s.defaultDirection=s.defaultDirection.multiply(-1)),s.baseFace=t}else{const u=o.startPoint;s.defaultOrigin=u,s.defaultDirection=t.normalAt(u),s.baseFace=t}return s}toSVGPathD(){const t=GCWithScope(),r=this.clone().mirror([1,0],[0,0],"plane"),i=approximateAsSvgCompatibleCurve(r.curves).flatMap(s=>adaptedCurveToPathElem(t(s.adaptor()),s.lastPoint)),[o,a]=r.curves[0].firstPoint;return`M ${round5(o)} ${round5(a)} ${i.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(t=1){return viewbox(this.boundingBox,t)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(t=1){return asSVG(this.toSVGPath(),this.boundingBox,t)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(t){if(!this.boundingBox.containsPoint(t))return!1;const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1,i=make2dSegmentCurve(t,this.boundingBox.outsidePoint());let o=0;return this.curves.find(s=>s.isOnCurve(t))?!1:(this.curves.forEach(s=>{s.boundingBox.isOut(i.boundingBox)||(n.Init_1(i.wrapped,s.wrapped,1e-9),o+=n.NbPoints())}),n.delete(),!!(o%2))}isClosed(){return samePoint$2(this.firstPoint,this.lastPoint)}intersects(t){const r=getOC(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(t.boundingBox))return!1;for(const i of this.curves)for(const o of t.curves)if(!i.boundingBox.isOut(o.boundingBox)&&(n.Init_1(i.wrapped,o.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class BaseSketcher2d{constructor(t=[0,0]){this.pointer=t,this.firstPoint=t,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([t,r]){return[t,r]}_convertFromUV([t,r]){return[t,r]}movePointerTo(t){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=t,this.firstPoint=t,this}saveCurve(t){if(!this._nextCorner){this.pendingCurves.push(t);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?chamferCurves:filletCurves;this.pendingCurves.push(...n(r,t,this._nextCorner.radius)),this._nextCorner=null}lineTo(t){const r=make2dSegmentCurve(this._convertToUV(this.pointer),this._convertToUV(t));return this.pointer=t,this.saveCurve(r),this}line(t,r){return this.lineTo([this.pointer[0]+t,this.pointer[1]+r])}vLine(t){return this.line(0,t)}hLine(t){return this.line(t,0)}vLineTo(t){return this.lineTo([this.pointer[0],t])}hLineTo(t){return this.lineTo([t,this.pointer[1]])}polarLineTo([t,r]){const n=r*DEG2RAD,i=polarToCartesian(t,n);return this.lineTo(i)}polarLine(t,r){const n=r*DEG2RAD,[i,o]=polarToCartesian(t,n);return this.line(i,o)}tangentLine(t){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=normalize2d(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*t,n[1]*t)}threePointsArcTo(t,r){return this.saveCurve(make2dThreePointArc(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(t))),this.pointer=t,this}threePointsArc(t,r,n,i){const[o,a]=this.pointer;return this.threePointsArcTo([o+t,a+r],[o+n,a+i])}sagittaArcTo(t,r){const[n,i]=this.pointer,[o,a]=t,s=[(n+o)/2,(i+a)/2],u=[-(a-i),o-n],f=Math.sqrt(u[0]**2+u[1]**2),d=[s[0]+u[0]/f*r,s[1]+u[1]/f*r];return this.saveCurve(make2dThreePointArc(this._convertToUV(this.pointer),this._convertToUV(d),this._convertToUV(t))),this.pointer=t,this}sagittaArc(t,r,n){return this.sagittaArcTo([t+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(t,r){return this.sagittaArc(0,t,r)}hSagittaArc(t,r){return this.sagittaArc(t,0,r)}bulgeArcTo(t,r){if(!r)return this.lineTo(t);const n=distance2d(this.pointer,t)/2,i=-r*n;return this.sagittaArcTo(t,i)}bulgeArc(t,r,n){return this.bulgeArcTo([t+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(t,r){return this.bulgeArc(0,t,r)}hBulgeArc(t,r){return this.bulgeArc(t,0,r)}tangentArcTo(t){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(make2dTangentArc(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(t))),this.pointer=t,this}tangentArc(t,r){const[n,i]=this.pointer;return this.tangentArcTo([t+n,r+i])}ellipseTo(t,r,n,i=0,o=!1,a=!1){let s=i,u=r,f=n;r<n&&(s=i+90,u=n,f=r);const d=s*DEG2RAD,w=B=>distance2d(this._convertToUV(B)),b=w(polarToCartesian(u,d)),S=w(polarToCartesian(f,d+Math.PI/2)),x=normalize2d(this._convertToUV(rotate2d([1,0],d))),[,m]=cartesianToPolar(x),{cx:h,cy:v,startAngle:p,endAngle:y,clockwise:E,rx:P,ry:A}=convertSvgEllipseParams(this._convertToUV(this.pointer),this._convertToUV(t),b,S,m,o,a),L=make2dEllipseArc(P,A,E?p:y,E?y:p,[h,v],x);return E||L.reverse(),this.saveCurve(L),this.pointer=t,this}ellipse(t,r,n,i,o=0,a=!1,s=!1){const[u,f]=this.pointer;return this.ellipseTo([t+u,r+f],n,i,o,a,s)}halfEllipseTo(t,r,n=!1){const i=polarAngle2d(t,this.pointer),o=distance2d(t,this.pointer);return this.ellipseTo(t,o/2,r,i*RAD2DEG,!0,n)}halfEllipse(t,r,n,i=!1){const[o,a]=this.pointer;return this.halfEllipseTo([o+t,a+r],n,i)}bezierCurveTo(t,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(make2dBezierCurve(this._convertToUV(this.pointer),n.map(i=>this._convertToUV(i)),this._convertToUV(t))),this.pointer=t,this}quadraticBezierCurveTo(t,r){return this.bezierCurveTo(t,[r])}cubicBezierCurveTo(t,r,n){return this.bezierCurveTo(t,[r,n])}smoothSplineTo(t,r){const{endTangent:n,startTangent:i,startFactor:o,endFactor:a}=defaultsSplineConfig(r),s=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,u=distance2d(this.pointer,t)*.25;let f;i?f=i:s?f=this._convertFromUV(s.tangentAt(1)):f=[1,0],f=normalize2d(f);const d=[this.pointer[0]+f[0]*o*u,this.pointer[1]+f[1]*o*u];let w;n==="symmetric"?w=[-f[0],-f[1]]:w=n,w=normalize2d(w);const b=[t[0]-w[0]*a*u,t[1]-w[1]*a*u];return this.cubicBezierCurveTo(t,d,b)}smoothSpline(t,r,n){return this.smoothSplineTo([t+this.pointer[0],r+this.pointer[1]],n)}customCorner(t,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:t},this}_customCornerLastWithFirst(t,r="fillet"){if(!t)return;const n=this.pendingCurves.pop(),i=this.pendingCurves.shift();if(!n||!i)throw new Error("Not enough curves to close and fillet");const o=r==="chamfer"?chamferCurves:filletCurves;this.pendingCurves.push(...o(n,i,t))}_closeSketch(){samePoint$2(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(samePoint$2(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const t=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=axis2d(this._convertToUV(this.pointer),this._convertToUV(t)),n=this.pendingCurves.map(i=>new Curve2D(i.innerCurve.Mirrored_2(r)));n.reverse(),n.map(i=>i.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class BlueprintSketcher extends BaseSketcher2d{constructor(t=[0,0]){super(),this.pointer=t,this.firstPoint=t,this.pendingCurves=[]}done(){return new Blueprint(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(t,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(t,r),this.done()}}const guessFaceFromWires=e=>{const t=getOC(),r=new t.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);e.forEach((o,a)=>{o.edges.forEach(s=>{r.Add_1(s.wrapped,t.GeomAbs_Shape.GeomAbs_C0,a===0)})});const n=new t.Message_ProgressRange_1;r.Build(n),n.delete();const i=cast(r.Shape());if(r.delete(),!(i instanceof Face))throw new Error("Failed to create a face");return i},fixWire=(e,t)=>{const r=getOC(),n=new r.ShapeFix_Wire_2(e.wrapped,t.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),e},faceFromWires=e=>{let t,r;try{t=makeFace(e[0]),r=e.slice(1)}catch{t=guessFaceFromWires(e),r=e.slice(1).map(i=>fixWire(i,t))}return addHolesInFace(t,r)},solidFromShellGenerator=(e,t)=>{const r=[],n=[],i=[];e.forEach(u=>{const[f,d,w]=t(u);r.push(f),n.push(d),i.push(w)});const o=faceFromWires(n),a=faceFromWires(i);return makeSolid([o,...r,a])};class CompoundSketch{constructor(t){this.sketches=t}delete(){this.sketches.forEach(t=>t.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const t=this.sketches.map(r=>r.wire);return compoundShapes(t)}face(){const t=this.outerSketch.face();return addHolesInFace(t,this.innerSketches.map(n=>n.wire))}extrude(t,{extrusionDirection:r,extrusionProfile:n,twistAngle:i,origin:o}={}){const a=new Vector(r||this.outerSketch.defaultDirection).normalized().multiply(t);return n&&!i?solidFromShellGenerator(this.sketches,f=>complexExtrude(f.wire,o||this.outerSketch.defaultOrigin,a,n,!0)):i?solidFromShellGenerator(this.sketches,f=>twistExtrude(f.wire,i,o||this.outerSketch.defaultOrigin,a,n,!0)):basicFaceExtrusion(this.face(),a)}revolve(t,{origin:r}={}){return revolution(this.face(),r||this.outerSketch.defaultOrigin,t)}loftWith(t,r){if(this.sketches.length!==t.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((o,a)=>{const s=t.sketches[a];return o.clone().loftWith(s.clone(),{ruled:r.ruled},!0)}),i=this.face().clone();return n.push(i,t.face()),makeSolid(n)}}class CompoundBlueprint{constructor(t){this.blueprints=t,this._boundingBox=null}clone(){return new CompoundBlueprint(this.blueprints)}get boundingBox(){if(!this._boundingBox){const t=new BoundingBox2d;this.blueprints.forEach(r=>t.add(r.boundingBox)),this._boundingBox=t}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(t=>t.repr)].join(`
`)}stretch(t,r,n){return new CompoundBlueprint(this.blueprints.map(i=>i.stretch(t,r,n)))}rotate(t,r){return new CompoundBlueprint(this.blueprints.map(n=>n.rotate(t,r)))}scale(t,r){const n=r||this.boundingBox.center;return new CompoundBlueprint(this.blueprints.map(i=>i.scale(t,n)))}translate(t,r=0){return new CompoundBlueprint(this.blueprints.map(n=>n.translate(t,r)))}mirror(t,r,n){return new CompoundBlueprint(this.blueprints.map(i=>i.mirror(t,r,n)))}sketchOnPlane(t,r){const n=this.blueprints.map(i=>i.sketchOnPlane(t,r));return new CompoundSketch(n)}sketchOnFace(t,r){const n=this.blueprints.map(i=>i.sketchOnFace(t,r));return new CompoundSketch(n)}toSVGViewBox(t=1){return viewbox(this.boundingBox,t)}toSVGPaths(){return this.blueprints.flatMap(t=>t.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(t=>t.toSVGPath()).join("")}</g>`}toSVG(t=1){return asSVG(this.toSVGGroup(),this.boundingBox,t)}}class Sketches{constructor(t){this.sketches=t}wires(){const t=this.sketches.map(r=>r instanceof Sketch?r.wire:r.wires);return compoundShapes(t)}faces(){const t=this.sketches.map(r=>r.face());return compoundShapes(t)}extrude(t,r={}){const n=this.sketches.map(i=>i.extrude(t,r));return compoundShapes(n)}revolve(t,r){return compoundShapes(this.sketches.map(n=>n.revolve(t,r)))}}class Blueprints{constructor(t){this.blueprints=t,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(t=>t.repr)].join(`
`)}clone(){return new Blueprints(this.blueprints)}get boundingBox(){if(!this._boundingBox){const t=new BoundingBox2d;this.blueprints.forEach(r=>t.add(r.boundingBox)),this._boundingBox=t}return this._boundingBox}stretch(t,r,n){return new Blueprints(this.blueprints.map(i=>i.stretch(t,r,n)))}rotate(t,r){return new Blueprints(this.blueprints.map(n=>n.rotate(t,r)))}scale(t,r){const n=r||this.boundingBox.center;return new Blueprints(this.blueprints.map(i=>i.scale(t,n)))}translate(t,r=0){return new Blueprints(this.blueprints.map(n=>n.translate(t,r)))}mirror(t,r,n){return new Blueprints(this.blueprints.map(i=>i.mirror(t,r,n)))}sketchOnPlane(t,r){return new Sketches(this.blueprints.map(n=>n.sketchOnPlane(t,r)))}sketchOnFace(t,r){return new Sketches(this.blueprints.map(n=>n.sketchOnFace(t,r)))}toSVGViewBox(t=1){return viewbox(this.boundingBox,t)}toSVGPaths(){return this.blueprints.map(t=>t.toSVGPaths())}toSVG(t=1){const r=this.blueprints.map(n=>n instanceof Blueprint?n.toSVGPath():n.toSVGGroup());return asSVG(r.join(`
    `),this.boundingBox,t)}}const groupByBoundingBoxOverlap=e=>{const t=e.map((i,o)=>e.slice(o+1).map((a,s)=>[s+o+1,a]).filter(([,a])=>!i.boundingBox.isOut(a.boundingBox)).map(([a])=>a)),r=[],n=Array(t.length);return t.forEach((i,o)=>{let a=n[o];a||(a=[],r.push(a)),a.push(e[o]),i.length&&i.forEach(s=>{n[s]=a})}),r},addContainmentInfo=e=>e.map((t,r)=>{const n=t.curves[0],i=n.value((n.lastParameter+n.firstParameter)/2),o=e.filter((a,s)=>r===s?!1:a.isInside(i));return{blueprint:t,isIn:o}}),splitMultipleOuterBlueprints=(e,t)=>e.flatMap(({blueprint:r})=>cleanEdgeCases(t.filter(({blueprint:n,isIn:i})=>n===r||i.indexOf(r)!==-1))),handleNestedBlueprints=(e,t)=>{const r=t.filter(({isIn:i})=>i.length<=1),n=cleanEdgeCases(addContainmentInfo(e.map(({blueprint:i})=>i)));return[r,...n]},cleanEdgeCases=e=>{if(!e.length)return[];const t=e.filter(({isIn:n})=>!n.length),r=e.filter(({isIn:n})=>n.length>1);return t.length===1&&r.length===0?[e]:t.length>1?splitMultipleOuterBlueprints(t,e):handleNestedBlueprints(r,e)},organiseBlueprints=e=>{const t=groupByBoundingBoxOverlap(e).map(addContainmentInfo);return new Blueprints(t.flatMap(cleanEdgeCases).map(r=>r.length===1?r[0].blueprint:(r.sort((n,i)=>n.isIn.length-i.isIn.length),new CompoundBlueprint(r.map(({blueprint:n})=>n)))))},roundedRectangleBlueprint=(e,t,r=0)=>{const{rx:n=0,ry:i=0}=typeof r=="number"?{ry:r,rx:r}:r;let o=Math.min(n,e/2),a=Math.min(i,t/2);const s=o&&a;s||(o=0,a=0);const u=o===a,f=new BlueprintSketcher([Math.min(0,-(e/2-o)),-t/2]),d=(w,b)=>{s&&(u?f.tangentArc(w,b):f.ellipse(w,b,o,a,0,!1,!0))};return o<e/2&&f.hLine(e-2*o),d(o,a),a<t/2&&f.vLine(t-2*a),d(-o,a),o<e/2&&f.hLine(-(e-2*o)),d(-o,-a),a<t/2&&f.vLine(-(t-2*a)),d(o,-a),f.close()},PRECISION$1=1e-9,samePoint$1=(e,t)=>samePoint$2(e,t,PRECISION$1),curveMidPoint=e=>{const t=(e.lastParameter+e.firstParameter)/2;return e.value(t)},rotateToStartAt=(e,t)=>{const r=e.findIndex(o=>samePoint$1(t,o.firstPoint)),n=e.slice(0,r);return e.slice(r).concat(n)},rotateToStartAtSegment=(e,t)=>{const r=a=>samePoint$1(t.firstPoint,a.firstPoint)&&samePoint$1(t.lastPoint,a.lastPoint);let n=e.findIndex(r);if(n===-1&&(e=reverseSegment(e),n=e.findIndex(r),n===-1))throw console.error(e.map(a=>a.repr),t.repr),new Error("Failed to rotate to segment start");const i=e.slice(0,n);return e.slice(n).concat(i)};function*createSegmentOnPoints(e,t,r){const n=a=>!!t.find(s=>samePoint$1(s,a.lastPoint)),i=a=>!!r.find(s=>samePoint$1(s.firstPoint,a.firstPoint)&&samePoint$1(s.lastPoint,a.lastPoint)||samePoint$1(s.firstPoint,a.lastPoint)&&samePoint$1(s.lastPoint,a.firstPoint));let o=[];for(const a of e)n(a)?(o.push(a),yield o,o=[]):i(a)?(o.length&&(yield o,o=[]),yield[a]):o.push(a);o.length&&(yield o)}const startOfSegment=e=>e[0].firstPoint,endOfSegment=e=>e[e.length-1].lastPoint,reverseSegment=e=>(e.reverse(),e.map(t=>{const r=t.clone();return r.reverse(),r})),reverseSegments=e=>(e.reverse(),e.map(reverseSegment));function removeNonCrossingPoint(e,t,r){return e.filter(n=>{const i=t.filter(s=>samePoint$1(s.firstPoint,n)||samePoint$1(s.lastPoint,n));if(i.length%2)throw console.error(i,n),new Error("Bug in the intersection algo on non crossing point");const o=i.map(s=>r.isInside(curveMidPoint(s)));return!(o.every(s=>s)||!o.some(s=>s))})}function blueprintsIntersectionSegments(e,t){let r=[];const n=[],i=new Array(e.curves.length).fill(0).map(()=>[]),o=new Array(t.curves.length).fill(0).map(()=>[]);if(e.curves.forEach((b,S)=>{t.curves.forEach((x,m)=>{const{intersections:h,commonSegments:v,commonSegmentsPoints:p}=intersectCurves(b,x,PRECISION$1/100);r.push(...h),i[S].push(...h),o[m].push(...h),n.push(...v),r.push(...p),i[S].push(...p),o[m].push(...p)})}),r=removeDuplicatePoints(r,PRECISION$1),!r.length||r.length===1)return null;const a=([b,S])=>S.length?b.splitAt(S,PRECISION$1/100):[b];let s=zip([e.curves,i]).flatMap(a),u=zip([t.curves,o]).flatMap(a);const f=n.map(b=>[b.firstPoint,b.lastPoint]);if(r=removeNonCrossingPoint(r,s,t),!r.length&&!n.length)return null;if(n.length){const b=n[0];s=rotateToStartAtSegment(s,b),u=rotateToStartAtSegment(u,b)}else{const b=r[0];s=rotateToStartAt(s,b),u=rotateToStartAt(u,b)}const d=Array.from(createSegmentOnPoints(s,r,n));let w=Array.from(createSegmentOnPoints(u,r,n));return(!samePoint$1(endOfSegment(w[0]),endOfSegment(d[0]))||n.length>0&&w[0].length!==1)&&(w=reverseSegments(w)),zip([d,w]).map(([b,S])=>{const x=startOfSegment(b),m=endOfSegment(b);return f.find(([h,v])=>samePoint$1(h,x)&&samePoint$1(v,m)||samePoint$1(h,m)&&samePoint$1(h,x))?[b,"same"]:[b,S]})}const splitPaths=e=>{const t=e.map(a=>a.firstPoint);let r=e.map(a=>a.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=zip([t,r]).map(([a,s],u)=>samePoint$1(a,s)?null:u).filter(a=>a!==null);if(!n.length)return[e];const i=zip([n.slice(0,-1),n.slice(1)]).map(([a,s])=>e.slice(a,s));let o=e.slice(n[n.length-1]);return n[0]!==0&&(o=o.concat(e.slice(0,n[0]))),i.push(o),i};function booleanOperation(e,t,{firstInside:r,secondInside:n}){const i=blueprintsIntersectionSegments(e,t);if(!i){const f=curveMidPoint(e.curves[0]),d=t.isInside(f),w=curveMidPoint(t.curves[0]),b=e.isInside(w);return{identical:!1,firstCurveInSecond:d,secondCurveInFirst:b}}if(i.every(([,f])=>f==="same"))return{identical:!0};let o=null,a=null;const s=i.flatMap(([f,d])=>{let w=[],b=0;if(d==="same")return a===1?(a=1,[...f]):a===2||a===0?(a=null,[]):a===null?(o?o=[...o,...f]:o=f,[]):(console.error("weird situation"),[]);const S=curveMidPoint(f[0]),x=t.isInside(S);(r==="keep"&&x||r==="remove"&&!x)&&(b+=1,w.push(...f));const m=curveMidPoint(d[0]),h=e.isInside(m);if(n==="keep"&&h||n==="remove"&&!h){let v=d;b===1&&(v=reverseSegment(d)),b+=1,w.push(...v)}return a===null&&b===1&&o&&(w=[...o,...w]),b===1&&(a=b,o=null),w}),u=splitPaths(s).filter(f=>f.length).map(f=>new Blueprint(f));return u.length===0?null:u.length===1?u[0]:organiseBlueprints(u)}const fuseBlueprints=(e,t)=>{const r=booleanOperation(e,t,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical?e.clone():r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():new Blueprints([e,t])},cutBlueprints=(e,t)=>{const r=booleanOperation(e,t,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new Blueprints([new CompoundBlueprint([e,t])]):e.clone()},intersectBlueprints=(e,t)=>{const r=booleanOperation(e,t,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof Blueprint||r instanceof Blueprints?r:r.identical||r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():null},genericIntersects=(e,t)=>{if(e instanceof Blueprint&&t instanceof Blueprint){let r=[];return e.curves.forEach(n=>{t.curves.forEach(i=>{const{intersections:o,commonSegmentsPoints:a}=intersectCurves(n,i);r.push(...o),r.push(...a)})}),r=removeDuplicatePoints(r),r.length>1}if(e instanceof CompoundBlueprint||e instanceof Blueprints)return e.blueprints.some(r=>genericIntersects(r,t));if(t instanceof CompoundBlueprint||t instanceof Blueprints)return t.blueprints.some(r=>genericIntersects(e,r));throw new Error("Bug in the generic intersects algorithm")},genericFuse=(e,t)=>{if(e instanceof CompoundBlueprint){if(t instanceof Blueprint)return fuseBlueprintWithCompound(t,e);if(t instanceof CompoundBlueprint)return fuseCompoundWithCompound(e,t)}if(t instanceof CompoundBlueprint){if(e instanceof Blueprint)return fuseBlueprintWithCompound(e,t);if(e instanceof CompoundBlueprint)return fuseCompoundWithCompound(e,t)}if(e instanceof Blueprint&&t instanceof Blueprint)return fuseBlueprints(e,t);throw new Error("Bug in the generic fuse algorithm")},fuseIntersectingBlueprints=e=>{const t=new Map,r=[];return e.forEach((n,i)=>{let o;t.has(i)?o=t.get(i):(o={current:n,fusedWith:new Set([i])},r.push(o)),e.slice(i+1).forEach((a,s)=>{const u=o.current,f=i+s+1;if(o.fusedWith.has(f))return;let d=a,w=!1;if(t.has(f)&&(d=t.get(f).current,w=!0),u.boundingBox.isOut(d.boundingBox)||!genericIntersects(u,d))return;let b;if(u instanceof Blueprints||d instanceof Blueprints?b=fuse2D(u,d):b=genericFuse(u,d),!(b instanceof Blueprint||b instanceof CompoundBlueprint)){if(b instanceof Blueprints&&b.blueprints.length===2)return;if(b instanceof Blueprints&&b.blueprints.length===1)b=b.blueprints[0];else if(!(b instanceof Blueprints))throw console.error(b),new Error("Bug in blueprint fusing algorigthm")}o.fusedWith.add(f),o.current=b,w||t.set(f,o)})}),organiseBlueprints(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>allBlueprints(n)))},allBlueprints=e=>e instanceof Blueprint?[e]:e instanceof CompoundBlueprint?e.blueprints:e instanceof Blueprints?e.blueprints.flatMap(t=>allBlueprints(t)):[],fuseBlueprintWithCompound=(e,t)=>{const r=fuseBlueprints(e,t.blueprints[0]),n=t.blueprints.slice(1).map(i=>cutBlueprints(i,e));return organiseBlueprints([...allBlueprints(r),...n.flatMap(i=>allBlueprints(i))])};function allPairs(e,t){const r=[];for(const n of e)for(const i of t)r.push([n,i]);return r}const fuseCompoundWithCompound=(e,t)=>{const r=fuseBlueprints(e.blueprints[0],t.blueprints[0]),n=t.blueprints.slice(1).map(a=>cutBlueprints(a,e.blueprints[0])),i=e.blueprints.slice(1).map(a=>cutBlueprints(a,t.blueprints[0])),o=allPairs(e.blueprints.slice(1),t.blueprints.slice(1)).flatMap(([a,s])=>allBlueprints(intersectBlueprints(a,s)));return organiseBlueprints([...allBlueprints(r),...n.flatMap(a=>allBlueprints(a)),...i.flatMap(a=>allBlueprints(a)),...o])},fuse2D=(e,t)=>{if(e===null)return t&&t.clone();if(t===null)return e&&e.clone();if(!(e instanceof Blueprints)&&t instanceof Blueprints)return fuseIntersectingBlueprints([e,...t.blueprints]);if(!(t instanceof Blueprints)&&e instanceof Blueprints)return fuseIntersectingBlueprints([t,...e.blueprints]);if(e instanceof Blueprints&&t instanceof Blueprints){let r=fuse2D(e.blueprints[0],t);return e.blueprints.slice(1).forEach(n=>{r=fuse2D(n,r)}),r}if(e instanceof CompoundBlueprint){if(t instanceof Blueprints)return fuse2D(t,e);if(t instanceof Blueprint)return fuseBlueprintWithCompound(t,e);if(t instanceof CompoundBlueprint)return fuseCompoundWithCompound(e,t)}if(t instanceof CompoundBlueprint){if(e instanceof Blueprints)return fuse2D(e,t);if(e instanceof Blueprint)return fuseBlueprintWithCompound(e,t);if(e instanceof CompoundBlueprint)return fuseCompoundWithCompound(e,t)}return e instanceof Blueprint&&t instanceof Blueprint?fuseBlueprints(e,t):null},mergeNonIntersecting=e=>{const t=e.flatMap(r=>r===null?[]:r instanceof Blueprints?r.blueprints:r);return t.length===1?t[0]:new Blueprints(t)},cut2D=(e,t)=>{if(e===null)return null;if(t===null)return e.clone();if(e instanceof Blueprints)return mergeNonIntersecting(e.blueprints.map(n=>cut2D(n,t)));if(e instanceof CompoundBlueprint){const n=e.blueprints[0];if(t instanceof Blueprint&&!t.intersects(n)){if(!n.isInside(t.firstPoint))return null;const i=fuse2D(t,new Blueprints(e.blueprints.slice(1)));return organiseBlueprints([n,...allBlueprints(i)])}else{let i=cut2D(e.blueprints[0],t);return e.blueprints.slice(1).forEach(o=>{i=cut2D(i,o)}),i}}if(t instanceof Blueprints)return mergeNonIntersecting(t.blueprints.map(n=>cut2D(e,n)));if(t instanceof CompoundBlueprint){let n=cutBlueprints(e,t.blueprints[0]);return t.blueprints.slice(1).forEach(i=>{n=fuse2D(n,intersectBlueprints(i,e))}),n}return cutBlueprints(e,t)};function intersect2D(e,t){if(e===null||t===null)return null;if(e instanceof Blueprint&&t instanceof Blueprint)return intersectBlueprints(e,t);if(e instanceof Blueprints)return mergeNonIntersecting(e.blueprints.map(r=>intersect2D(r,t)));if(e instanceof CompoundBlueprint){const r=e.blueprints[0],n=e.blueprints[1];return cut2D(intersect2D(r,t),n)}if(t instanceof Blueprints)return mergeNonIntersecting(t.blueprints.map(r=>intersect2D(e,r)));if(t instanceof CompoundBlueprint){const r=t.blueprints[0],n=t.blueprints[1];return cut2D(intersect2D(r,e),n)}throw new Error("intersct 2D algorithm error")}const sketchCircle=(e,t={})=>{const r=t.plane instanceof Plane?makePlane(t.plane):makePlane(t.plane,t.origin),n=assembleWire([makeCircle(e,r.origin,r.zDir)]),i=new Sketch(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),i};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var e=function(){try{var r={},n=Object.defineProperty,i=n(r,r,r)&&n}catch{}return i}(),t=function(r){if(this==null)throw TypeError();var n=String(this),i=n.length,o=r?Number(r):0;if(o!=o&&(o=0),!(o<0||o>=i)){var a=n.charCodeAt(o),s;return a>=55296&&a<=56319&&i>o+1&&(s=n.charCodeAt(o+1),s>=56320&&s<=57343)?(a-55296)*1024+s-56320+65536:a}};e?e(String.prototype,"codePointAt",{value:t,configurable:!0,writable:!0}):String.prototype.codePointAt=t}();function Tree(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var sltree=new Tree,sdtree=new Tree,length_bits=new Uint8Array(30),length_base=new Uint16Array(30),dist_bits=new Uint8Array(30),dist_base=new Uint16Array(30);function tinf_build_bits_base(e,t,r,n){var i,o;for(i=0;i<r;++i)e[i]=0;for(i=0;i<30-r;++i)e[i+r]=i/r|0;for(o=n,i=0;i<30;++i)t[i]=o,o+=1<<e[i]}function tinf_build_fixed_trees(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,r=0;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[24+144+r]=280+r;for(r=0;r<112;++r)e.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(t.table[5]=32,r=0;r<32;++r)t.trans[r]=r}tinf_build_fixed_trees(sltree,sdtree),tinf_build_bits_base(length_bits,length_base,4,3),tinf_build_bits_base(dist_bits,dist_base,2,1),length_bits[28]=0,length_base[28]=258;function derive(e,t,r,n,i){return Math.pow(1-i,3)*e+3*Math.pow(1-i,2)*i*t+3*(1-i)*Math.pow(i,2)*r+Math.pow(i,3)*n}function BoundingBox2(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}BoundingBox2.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},BoundingBox2.prototype.addPoint=function(e,t){typeof e=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},BoundingBox2.prototype.addX=function(e){this.addPoint(e,null)},BoundingBox2.prototype.addY=function(e){this.addPoint(null,e)},BoundingBox2.prototype.addBezier=function(e,t,r,n,i,o,a,s){var u=[e,t],f=[r,n],d=[i,o],w=[a,s];this.addPoint(e,t),this.addPoint(a,s);for(var b=0;b<=1;b++){var S=6*u[b]-12*f[b]+6*d[b],x=-3*u[b]+9*f[b]-9*d[b]+3*w[b],m=3*f[b]-3*u[b];if(x===0){if(S===0)continue;var h=-m/S;0<h&&h<1&&(b===0&&this.addX(derive(u[b],f[b],d[b],w[b],h)),b===1&&this.addY(derive(u[b],f[b],d[b],w[b],h)));continue}var v=Math.pow(S,2)-4*m*x;if(!(v<0)){var p=(-S+Math.sqrt(v))/(2*x);0<p&&p<1&&(b===0&&this.addX(derive(u[b],f[b],d[b],w[b],p)),b===1&&this.addY(derive(u[b],f[b],d[b],w[b],p)));var y=(-S-Math.sqrt(v))/(2*x);0<y&&y<1&&(b===0&&this.addX(derive(u[b],f[b],d[b],w[b],y)),b===1&&this.addY(derive(u[b],f[b],d[b],w[b],y)))}}},BoundingBox2.prototype.addQuad=function(e,t,r,n,i,o){var a=e+.6666666666666666*(r-e),s=t+2/3*(n-t),u=a+1/3*(i-e),f=s+1/3*(o-t);this.addBezier(e,t,a,s,u,f,i,o)};function Path(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Path.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},Path.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(e,t,r,n,i,o){this.commands.push({type:"C",x1:e,y1:t,x2:r,y2:n,x:i,y:o})},Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(e,t,r,n){this.commands.push({type:"Q",x1:e,y1:t,x:r,y:n})},Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})},Path.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof BoundingBox2){var t=e;this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),this.close();return}Array.prototype.push.apply(this.commands,e)},Path.prototype.getBoundingBox=function(){for(var e=new BoundingBox2,t=0,r=0,n=0,i=0,o=0;o<this.commands.length;o++){var a=this.commands[o];switch(a.type){case"M":e.addPoint(a.x,a.y),t=n=a.x,r=i=a.y;break;case"L":e.addPoint(a.x,a.y),n=a.x,i=a.y;break;case"Q":e.addQuad(n,i,a.x1,a.y1,a.x,a.y),n=a.x,i=a.y;break;case"C":e.addBezier(n,i,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,i=a.y;break;case"Z":n=t,i=r;break;default:throw new Error("Unexpected path command "+a.type)}}return e.isEmpty()&&e.addPoint(0,0),e},Path.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var r=this.commands[t];r.type==="M"?e.moveTo(r.x,r.y):r.type==="L"?e.lineTo(r.x,r.y):r.type==="C"?e.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?e.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},Path.prototype.toPathData=function(e){e=e!==void 0?e:2;function t(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(e)}function r(){for(var a=arguments,s="",u=0;u<arguments.length;u+=1){var f=a[u];f>=0&&u>0&&(s+=" "),s+=t(f)}return s}for(var n="",i=0;i<this.commands.length;i+=1){var o=this.commands[i];o.type==="M"?n+="M"+r(o.x,o.y):o.type==="L"?n+="L"+r(o.x,o.y):o.type==="C"?n+="C"+r(o.x1,o.y1,o.x2,o.y2,o.x,o.y):o.type==="Q"?n+="Q"+r(o.x1,o.y1,o.x,o.y):o.type==="Z"&&(n+="Z")}return n},Path.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&this.fill!=="black"&&(this.fill===null?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>",t},Path.prototype.toDOMElement=function(e){var t=this.toPathData(e),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",t),r};function fail(e){throw new Error(e)}function argument(e,t){e||fail(t)}var check={fail,argument,assert:argument},LIMIT16=32768,LIMIT32=2147483648,decode={},encode={},sizeOf={};function constant(e){return function(){return e}}encode.BYTE=function(e){return check.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},sizeOf.BYTE=constant(1),encode.CHAR=function(e){return[e.charCodeAt(0)]},sizeOf.CHAR=constant(1),encode.CHARARRAY=function(e){typeof e>"u"&&(e="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var t=[],r=0;r<e.length;r+=1)t[r]=e.charCodeAt(r);return t},sizeOf.CHARARRAY=function(e){return typeof e>"u"?0:e.length},encode.USHORT=function(e){return[e>>8&255,e&255]},sizeOf.USHORT=constant(2),encode.SHORT=function(e){return e>=LIMIT16&&(e=-(2*LIMIT16-e)),[e>>8&255,e&255]},sizeOf.SHORT=constant(2),encode.UINT24=function(e){return[e>>16&255,e>>8&255,e&255]},sizeOf.UINT24=constant(3),encode.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,e&255]},sizeOf.ULONG=constant(4),encode.LONG=function(e){return e>=LIMIT32&&(e=-(2*LIMIT32-e)),[e>>24&255,e>>16&255,e>>8&255,e&255]},sizeOf.LONG=constant(4),encode.FIXED=encode.ULONG,sizeOf.FIXED=sizeOf.ULONG,encode.FWORD=encode.SHORT,sizeOf.FWORD=sizeOf.SHORT,encode.UFWORD=encode.USHORT,sizeOf.UFWORD=sizeOf.USHORT,encode.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,e&255]},sizeOf.LONGDATETIME=constant(8),encode.TAG=function(e){return check.argument(e.length===4,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},sizeOf.TAG=constant(4),encode.Card8=encode.BYTE,sizeOf.Card8=sizeOf.BYTE,encode.Card16=encode.USHORT,sizeOf.Card16=sizeOf.USHORT,encode.OffSize=encode.BYTE,sizeOf.OffSize=sizeOf.BYTE,encode.SID=encode.USHORT,sizeOf.SID=sizeOf.USHORT,encode.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?(e=e-108,[(e>>8)+247,e&255]):e>=-1131&&e<=-108?(e=-e-108,[(e>>8)+251,e&255]):e>=-32768&&e<=32767?encode.NUMBER16(e):encode.NUMBER32(e)},sizeOf.NUMBER=function(e){return encode.NUMBER(e).length},encode.NUMBER16=function(e){return[28,e>>8&255,e&255]},sizeOf.NUMBER16=constant(3),encode.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,e&255]},sizeOf.NUMBER32=constant(5),encode.REAL=function(e){var t=e.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));t=(Math.round(e*n)/n).toString()}for(var i="",o=0,a=t.length;o<a;o+=1){var s=t[o];s==="e"?i+=t[++o]==="-"?"c":"b":s==="."?i+="a":s==="-"?i+="e":i+=s}i+=i.length&1?"f":"ff";for(var u=[30],f=0,d=i.length;f<d;f+=2)u.push(parseInt(i.substr(f,2),16));return u},sizeOf.REAL=function(e){return encode.REAL(e).length},encode.NAME=encode.CHARARRAY,sizeOf.NAME=sizeOf.CHARARRAY,encode.STRING=encode.CHARARRAY,sizeOf.STRING=sizeOf.CHARARRAY,decode.UTF8=function(e,t,r){for(var n=[],i=r,o=0;o<i;o++,t+=1)n[o]=e.getUint8(t);return String.fromCharCode.apply(null,n)},decode.UTF16=function(e,t,r){for(var n=[],i=r/2,o=0;o<i;o++,t+=2)n[o]=e.getUint16(t);return String.fromCharCode.apply(null,n)},encode.UTF16=function(e){for(var t=[],r=0;r<e.length;r+=1){var n=e.charCodeAt(r);t[t.length]=n>>8&255,t[t.length]=n&255}return t},sizeOf.UTF16=function(e){return e.length*2};var eightBitMacEncodings={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};decode.MACSTRING=function(e,t,r,n){var i=eightBitMacEncodings[n];if(i!==void 0){for(var o="",a=0;a<r;a++){var s=e.getUint8(t+a);s<=127?o+=String.fromCharCode(s):o+=i[s&127]}return o}};var macEncodingTableCache=typeof WeakMap=="function"&&new WeakMap,macEncodingCacheKeys,getMacEncodingTable=function(e){if(!macEncodingCacheKeys){macEncodingCacheKeys={};for(var t in eightBitMacEncodings)macEncodingCacheKeys[t]=new String(t)}var r=macEncodingCacheKeys[e];if(r!==void 0){if(macEncodingTableCache){var n=macEncodingTableCache.get(r);if(n!==void 0)return n}var i=eightBitMacEncodings[e];if(i!==void 0){for(var o={},a=0;a<i.length;a++)o[i.charCodeAt(a)]=a+128;return macEncodingTableCache&&macEncodingTableCache.set(r,o),o}}};encode.MACSTRING=function(e,t){var r=getMacEncodingTable(t);if(r!==void 0){for(var n=[],i=0;i<e.length;i++){var o=e.charCodeAt(i);if(o>=128&&(o=r[o],o===void 0))return;n[i]=o}return n}},sizeOf.MACSTRING=function(e,t){var r=encode.MACSTRING(e,t);return r!==void 0?r.length:0};function isByteEncodable(e){return e>=-128&&e<=127}function encodeVarDeltaRunAsZeroes(e,t,r){for(var n=0,i=e.length;t<i&&n<64&&e[t]===0;)++t,++n;return r.push(128|n-1),t}function encodeVarDeltaRunAsBytes(e,t,r){for(var n=0,i=e.length,o=t;o<i&&n<64;){var a=e[o];if(!isByteEncodable(a)||a===0&&o+1<i&&e[o+1]===0)break;++o,++n}r.push(n-1);for(var s=t;s<o;++s)r.push(e[s]+256&255);return o}function encodeVarDeltaRunAsWords(e,t,r){for(var n=0,i=e.length,o=t;o<i&&n<64;){var a=e[o];if(a===0||isByteEncodable(a)&&o+1<i&&isByteEncodable(e[o+1]))break;++o,++n}r.push(64|n-1);for(var s=t;s<o;++s){var u=e[s];r.push(u+65536>>8&255,u+256&255)}return o}encode.VARDELTAS=function(e){for(var t=0,r=[];t<e.length;){var n=e[t];n===0?t=encodeVarDeltaRunAsZeroes(e,t,r):n>=-128&&n<=127?t=encodeVarDeltaRunAsBytes(e,t,r):t=encodeVarDeltaRunAsWords(e,t,r)}return r},encode.INDEX=function(e){for(var t=1,r=[t],n=[],i=0;i<e.length;i+=1){var o=encode.OBJECT(e[i]);Array.prototype.push.apply(n,o),t+=o.length,r.push(t)}if(n.length===0)return[0,0];for(var a=[],s=1+Math.floor(Math.log(t)/Math.log(2))/8|0,u=[void 0,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][s],f=0;f<r.length;f+=1){var d=u(r[f]);Array.prototype.push.apply(a,d)}return Array.prototype.concat(encode.Card16(e.length),encode.OffSize(s),a,n)},sizeOf.INDEX=function(e){return encode.INDEX(e).length},encode.DICT=function(e){for(var t=[],r=Object.keys(e),n=r.length,i=0;i<n;i+=1){var o=parseInt(r[i],0),a=e[o];t=t.concat(encode.OPERAND(a.value,a.type)),t=t.concat(encode.OPERATOR(o))}return t},sizeOf.DICT=function(e){return encode.DICT(e).length},encode.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},encode.OPERAND=function(e,t){var r=[];if(Array.isArray(t))for(var n=0;n<t.length;n+=1)check.argument(e.length===t.length,"Not enough arguments given for type"+t),r=r.concat(encode.OPERAND(e[n],t[n]));else if(t==="SID")r=r.concat(encode.NUMBER(e));else if(t==="offset")r=r.concat(encode.NUMBER32(e));else if(t==="number")r=r.concat(encode.NUMBER(e));else if(t==="real")r=r.concat(encode.REAL(e));else throw new Error("Unknown operand type "+t);return r},encode.OP=encode.BYTE,sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap=="function"&&new WeakMap;encode.CHARSTRING=function(e){if(wmm){var t=wmm.get(e);if(t!==void 0)return t}for(var r=[],n=e.length,i=0;i<n;i+=1){var o=e[i];r=r.concat(encode[o.type](o.value))}return wmm&&wmm.set(e,r),r},sizeOf.CHARSTRING=function(e){return encode.CHARSTRING(e).length},encode.OBJECT=function(e){var t=encode[e.type];return check.argument(t!==void 0,"No encoding function for type "+e.type),t(e.value)},sizeOf.OBJECT=function(e){var t=sizeOf[e.type];return check.argument(t!==void 0,"No sizeOf function for type "+e.type),t(e.value)},encode.TABLE=function(e){for(var t=[],r=e.fields.length,n=[],i=[],o=0;o<r;o+=1){var a=e.fields[o],s=encode[a.type];check.argument(s!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var u=e[a.name];u===void 0&&(u=a.value);var f=s(u);a.type==="TABLE"?(i.push(t.length),t=t.concat([0,0]),n.push(f)):t=t.concat(f)}for(var d=0;d<n.length;d+=1){var w=i[d],b=t.length;check.argument(b<65536,"Table "+e.tableName+" too big."),t[w]=b>>8,t[w+1]=b&255,t=t.concat(n[d])}return t},sizeOf.TABLE=function(e){for(var t=0,r=e.fields.length,n=0;n<r;n+=1){var i=e.fields[n],o=sizeOf[i.type];check.argument(o!==void 0,"No sizeOf function for field type "+i.type+" ("+i.name+")");var a=e[i.name];a===void 0&&(a=i.value),t+=o(a),i.type==="TABLE"&&(t+=2)}return t},encode.RECORD=encode.TABLE,sizeOf.RECORD=sizeOf.TABLE,encode.LITERAL=function(e){return e},sizeOf.LITERAL=function(e){return e.length};function Table(e,t,r){if(t.length&&(t[0].name!=="coverageFormat"||t[0].value===1))for(var n=0;n<t.length;n+=1){var i=t[n];this[i.name]=i.value}if(this.tableName=e,this.fields=t,r)for(var o=Object.keys(r),a=0;a<o.length;a+=1){var s=o[a],u=r[s];this[s]!==void 0&&(this[s]=u)}}Table.prototype.encode=function(){return encode.TABLE(this)},Table.prototype.sizeOf=function(){return sizeOf.TABLE(this)};function ushortList(e,t,r){r===void 0&&(r=t.length);var n=new Array(t.length+1);n[0]={name:e+"Count",type:"USHORT",value:r};for(var i=0;i<t.length;i++)n[i+1]={name:e+i,type:"USHORT",value:t[i]};return n}function tableList(e,t,r){var n=t.length,i=new Array(n+1);i[0]={name:e+"Count",type:"USHORT",value:n};for(var o=0;o<n;o++)i[o+1]={name:e+o,type:"TABLE",value:r(t[o],o)};return i}function recordList(e,t,r){var n=t.length,i=[];i[0]={name:e+"Count",type:"USHORT",value:n};for(var o=0;o<n;o++)i=i.concat(r(t[o],o));return i}function Coverage(e){e.format===1?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(ushortList("glyph",e.glyphs))):e.format===2?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(recordList("rangeRecord",e.ranges,function(t){return[{name:"startGlyphID",type:"USHORT",value:t.start},{name:"endGlyphID",type:"USHORT",value:t.end},{name:"startCoverageIndex",type:"USHORT",value:t.index}]}))):check.assert(!1,"Coverage format must be 1 or 2.")}Coverage.prototype=Object.create(Table.prototype),Coverage.prototype.constructor=Coverage;function ScriptList(e){Table.call(this,"scriptListTable",recordList("scriptRecord",e,function(t,r){var n=t.script,i=n.defaultLangSys;return check.assert(!!i,"Unable to write GSUB: script "+t.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:t.tag},{name:"script"+r,type:"TABLE",value:new Table("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Table("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(ushortList("featureIndex",i.featureIndexes)))}].concat(recordList("langSys",n.langSysRecords,function(o,a){var s=o.langSys;return[{name:"langSysTag"+a,type:"TAG",value:o.tag},{name:"langSys"+a,type:"TABLE",value:new Table("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:s.reqFeatureIndex}].concat(ushortList("featureIndex",s.featureIndexes)))}]})))}]}))}ScriptList.prototype=Object.create(Table.prototype),ScriptList.prototype.constructor=ScriptList;function FeatureList(e){Table.call(this,"featureListTable",recordList("featureRecord",e,function(t,r){var n=t.feature;return[{name:"featureTag"+r,type:"TAG",value:t.tag},{name:"feature"+r,type:"TABLE",value:new Table("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(ushortList("lookupListIndex",n.lookupListIndexes)))}]}))}FeatureList.prototype=Object.create(Table.prototype),FeatureList.prototype.constructor=FeatureList;function LookupList(e,t){Table.call(this,"lookupListTable",tableList("lookup",e,function(r){var n=t[r.lookupType];return check.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Table("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(tableList("subtable",r.subtables,n)))}))}LookupList.prototype=Object.create(Table.prototype),LookupList.prototype.constructor=LookupList;var table={Table,Record:Table,Coverage,ScriptList,FeatureList,LookupList,ushortList,tableList,recordList};function getByte(e,t){return e.getUint8(t)}function getUShort(e,t){return e.getUint16(t,!1)}function getShort(e,t){return e.getInt16(t,!1)}function getULong(e,t){return e.getUint32(t,!1)}function getFixed(e,t){var r=e.getInt16(t,!1),n=e.getUint16(t+2,!1);return r+n/65535}function getTag(e,t){for(var r="",n=t;n<t+4;n+=1)r+=String.fromCharCode(e.getInt8(n));return r}function getOffset(e,t,r){for(var n=0,i=0;i<r;i+=1)n<<=8,n+=e.getUint8(t+i);return n}function getBytes(e,t,r){for(var n=[],i=t;i<r;i+=1)n.push(e.getUint8(i));return n}function bytesToString(e){for(var t="",r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return t}var typeOffsets={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(e,t){this.data=e,this.offset=t,this.relativeOffset=0}Parser.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},Parser.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},Parser.prototype.parseCard8=Parser.prototype.parseByte,Parser.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},Parser.prototype.parseCard16=Parser.prototype.parseUShort,Parser.prototype.parseSID=Parser.prototype.parseUShort,Parser.prototype.parseOffset16=Parser.prototype.parseUShort,Parser.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},Parser.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},Parser.prototype.parseULong=function(){var e=getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},Parser.prototype.parseOffset32=Parser.prototype.parseULong,Parser.prototype.parseFixed=function(){var e=getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},Parser.prototype.parseString=function(e){var t=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=e;for(var i=0;i<e;i++)n+=String.fromCharCode(t.getUint8(r+i));return n},Parser.prototype.parseTag=function(){return this.parseString(4)},Parser.prototype.parseLongDateTime=function(){var e=getULong(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},Parser.prototype.parseVersion=function(e){var t=getUShort(this.data,this.offset+this.relativeOffset),r=getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,e===void 0&&(e=4096),t+r/e/10},Parser.prototype.skip=function(e,t){t===void 0&&(t=1),this.relativeOffset+=typeOffsets[e]*t},Parser.prototype.parseULongList=function(e){e===void 0&&(e=this.parseULong());for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=r.getUint32(n),n+=4;return this.relativeOffset+=e*4,t},Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(e){e===void 0&&(e=this.parseUShort());for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=r.getUint16(n),n+=2;return this.relativeOffset+=e*2,t},Parser.prototype.parseShortList=function(e){for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=r.getInt16(n),n+=2;return this.relativeOffset+=e*2,t},Parser.prototype.parseByteList=function(e){for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=r.getUint8(n++);return this.relativeOffset+=e,t},Parser.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),n=0;n<e;n++)r[n]=t.call(this);return r},Parser.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),n=0;n<e;n++)r[n]=t.call(this);return r},Parser.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),n=Object.keys(t),i=0;i<e;i++){for(var o={},a=0;a<n.length;a++){var s=n[a],u=t[s];o[s]=u.call(this)}r[i]=o}return r},Parser.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),n=Object.keys(t),i=0;i<e;i++){for(var o={},a=0;a<n.length;a++){var s=n[a],u=t[s];o[s]=u.call(this)}r[i]=o}return r},Parser.prototype.parseStruct=function(e){if(typeof e=="function")return e.call(this);for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var i=t[n],o=e[i];r[i]=o.call(this)}return r},Parser.prototype.parseValueRecord=function(e){if(e===void 0&&(e=this.parseUShort()),e!==0){var t={};return e&1&&(t.xPlacement=this.parseShort()),e&2&&(t.yPlacement=this.parseShort()),e&4&&(t.xAdvance=this.parseShort()),e&8&&(t.yAdvance=this.parseShort()),e&16&&(t.xPlaDevice=void 0,this.parseShort()),e&32&&(t.yPlaDevice=void 0,this.parseShort()),e&64&&(t.xAdvDevice=void 0,this.parseShort()),e&128&&(t.yAdvDevice=void 0,this.parseShort()),t}},Parser.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),r=new Array(t),n=0;n<t;n++)r[n]=this.parseValueRecord(e);return r},Parser.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new Parser(this.data,this.offset+t).parseStruct(e)},Parser.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new Parser(this.data,this.offset+t).parseStruct(e)},Parser.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),r=t.length,n=this.relativeOffset,i=new Array(r),o=0;o<r;o++){var a=t[o];if(a===0){i[o]=void 0;continue}if(this.relativeOffset=a,e){for(var s=this.parseOffset16List(),u=new Array(s.length),f=0;f<s.length;f++)this.relativeOffset=a+s[f],u[f]=e.call(this);i[o]=u}else i[o]=this.parseUShortList()}return this.relativeOffset=n,i},Parser.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),r=this.parseUShort();if(t===1)return{format:1,glyphs:this.parseUShortList(r)};if(t===2){for(var n=new Array(r),i=0;i<r;i++)n[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")},Parser.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(t===2)return{format:2,ranges:this.parseRecordList({start:Parser.uShort,end:Parser.uShort,classId:Parser.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},Parser.list=function(e,t){return function(){return this.parseList(e,t)}},Parser.list32=function(e,t){return function(){return this.parseList32(e,t)}},Parser.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},Parser.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},Parser.pointer=function(e){return function(){return this.parsePointer(e)}},Parser.pointer32=function(e){return function(){return this.parsePointer32(e)}},Parser.tag=Parser.prototype.parseTag,Parser.byte=Parser.prototype.parseByte,Parser.uShort=Parser.offset16=Parser.prototype.parseUShort,Parser.uShortList=Parser.prototype.parseUShortList,Parser.uLong=Parser.offset32=Parser.prototype.parseULong,Parser.uLongList=Parser.prototype.parseULongList,Parser.struct=Parser.prototype.parseStruct,Parser.coverage=Parser.prototype.parseCoverage,Parser.classDef=Parser.prototype.parseClassDef;var langSysTable={reserved:Parser.uShort,reqFeatureIndex:Parser.uShort,featureIndexes:Parser.uShortList};Parser.prototype.parseScriptList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,script:Parser.pointer({defaultLangSys:Parser.pointer(langSysTable),langSysRecords:Parser.recordList({tag:Parser.tag,langSys:Parser.pointer(langSysTable)})})}))||[]},Parser.prototype.parseFeatureList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,feature:Parser.pointer({featureParams:Parser.offset16,lookupListIndexes:Parser.uShortList})}))||[]},Parser.prototype.parseLookupList=function(e){return this.parsePointer(Parser.list(Parser.pointer(function(){var t=this.parseUShort();check.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:t,lookupFlag:r,subtables:this.parseList(Parser.pointer(e[t])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},Parser.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var e=this.parseUShort(),t=this.parseUShort();check.argument(e===1&&t<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:Parser.offset32,featureTableSubstitutionOffset:Parser.offset32});return r})||[]};var parse={getByte,getCard8:getByte,getUShort,getCard16:getUShort,getShort,getULong,getFixed,getTag,getOffset,getBytes,bytesToString,Parser};function parseCmapTableFormat12(e,t){t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong();var r;e.groupCount=r=t.parseULong(),e.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var i=t.parseULong(),o=t.parseULong(),a=t.parseULong(),s=i;s<=o;s+=1)e.glyphIndexMap[s]=a,a++}function parseCmapTableFormat4(e,t,r,n,i){e.length=t.parseUShort(),e.language=t.parseUShort();var o;e.segCount=o=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var a=new parse.Parser(r,n+i+14),s=new parse.Parser(r,n+i+16+o*2),u=new parse.Parser(r,n+i+16+o*4),f=new parse.Parser(r,n+i+16+o*6),d=n+i+16+o*8,w=0;w<o-1;w+=1)for(var b=void 0,S=a.parseUShort(),x=s.parseUShort(),m=u.parseShort(),h=f.parseUShort(),v=x;v<=S;v+=1)h!==0?(d=f.offset+f.relativeOffset-2,d+=h,d+=(v-x)*2,b=parse.getUShort(r,d),b!==0&&(b=b+m&65535)):b=v+m&65535,e.glyphIndexMap[v]=b}function parseCmapTable(e,t){var r={};r.version=parse.getUShort(e,t),check.argument(r.version===0,"cmap table version should be 0."),r.numTables=parse.getUShort(e,t+2);for(var n=-1,i=r.numTables-1;i>=0;i-=1){var o=parse.getUShort(e,t+4+i*8),a=parse.getUShort(e,t+4+i*8+2);if(o===3&&(a===0||a===1||a===10)||o===0&&(a===0||a===1||a===2||a===3||a===4)){n=parse.getULong(e,t+4+i*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var s=new parse.Parser(e,t+n);if(r.format=s.parseUShort(),r.format===12)parseCmapTableFormat12(r,s);else if(r.format===4)parseCmapTableFormat4(r,s,e,t,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function addSegment(e,t,r){e.segments.push({end:t,start:t,delta:-(t-r),offset:0,glyphIndex:r})}function addTerminatorSegment(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(e){var t=!0,r;for(r=e.length-1;r>0;r-=1){var n=e.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),t=!1;break}}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:t?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:t?12:12+8}];t||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var o=new table.Table("cmap",i);for(o.segments=[],r=0;r<e.length;r+=1){for(var a=e.get(r),s=0;s<a.unicodes.length;s+=1)addSegment(o,a.unicodes[s],r);o.segments=o.segments.sort(function(p,y){return p.start-y.start})}addTerminatorSegment(o);var u=o.segments.length,f=0,d=[],w=[],b=[],S=[],x=[],m=[];for(r=0;r<u;r+=1){var h=o.segments[r];h.end<=65535&&h.start<=65535?(d=d.concat({name:"end_"+r,type:"USHORT",value:h.end}),w=w.concat({name:"start_"+r,type:"USHORT",value:h.start}),b=b.concat({name:"idDelta_"+r,type:"SHORT",value:h.delta}),S=S.concat({name:"idRangeOffset_"+r,type:"USHORT",value:h.offset}),h.glyphId!==void 0&&(x=x.concat({name:"glyph_"+r,type:"USHORT",value:h.glyphId}))):f+=1,!t&&h.glyphIndex!==void 0&&(m=m.concat({name:"cmap12Start_"+r,type:"ULONG",value:h.start}),m=m.concat({name:"cmap12End_"+r,type:"ULONG",value:h.end}),m=m.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:h.glyphIndex}))}if(o.segCountX2=(u-f)*2,o.searchRange=Math.pow(2,Math.floor(Math.log(u-f)/Math.log(2)))*2,o.entrySelector=Math.log(o.searchRange/2)/Math.log(2),o.rangeShift=o.segCountX2-o.searchRange,o.fields=o.fields.concat(d),o.fields.push({name:"reservedPad",type:"USHORT",value:0}),o.fields=o.fields.concat(w),o.fields=o.fields.concat(b),o.fields=o.fields.concat(S),o.fields=o.fields.concat(x),o.cmap4Length=14+d.length*2+2+w.length*2+b.length*2+S.length*2+x.length*2,!t){var v=16+m.length*4;o.cmap12Offset=12+2*2+4+o.cmap4Length,o.fields=o.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:v},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:m.length/3}]),o.fields=o.fields.concat(m)}return o}var cmap={parse:parseCmapTable,make:makeCmapTable},cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(e){this.font=e}DefaultEncoding.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var i=r.get(n),o=0;o<i.unicodes.length;o+=1)if(i.unicodes[o]===t)return n}return null};function CffEncoding(e,t){this.encoding=e,this.charset=t}CffEncoding.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.encoding[t];return this.charset.indexOf(r)};function line(e,t,r,n,i){e.beginPath(),e.moveTo(t,r),e.lineTo(n,i),e.stroke()}var draw$1={line};function getPathDefinition(e,t){var r=t||new Path;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function Glyph(e){this.bindConstructorValues(e)}Glyph.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||e.unicode!==void 0?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",getPathDefinition(this,e.path))},Glyph.prototype.addUnicode=function(e){this.unicodes.length===0&&(this.unicode=e),this.unicodes.push(e)},Glyph.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Glyph.prototype.getPath=function(e,t,r,n,i){e=e!==void 0?e:0,t=t!==void 0?t:0,r=r!==void 0?r:72;var o,a;n||(n={});var s=n.xScale,u=n.yScale;if(n.hinting&&i&&i.hinting&&(a=this.path&&i.hinting.exec(this,r)),a)o=i.hinting.getCommands(a),e=Math.round(e),t=Math.round(t),s=u=1;else{o=this.path.commands;var f=1/(this.path.unitsPerEm||1e3)*r;s===void 0&&(s=f),u===void 0&&(u=f)}for(var d=new Path,w=0;w<o.length;w+=1){var b=o[w];b.type==="M"?d.moveTo(e+b.x*s,t+-b.y*u):b.type==="L"?d.lineTo(e+b.x*s,t+-b.y*u):b.type==="Q"?d.quadraticCurveTo(e+b.x1*s,t+-b.y1*u,e+b.x*s,t+-b.y*u):b.type==="C"?d.curveTo(e+b.x1*s,t+-b.y1*u,e+b.x2*s,t+-b.y2*u,e+b.x*s,t+-b.y*u):b.type==="Z"&&d.closePath()}return d},Glyph.prototype.getContours=function(){if(this.points===void 0)return[];for(var e=[],t=[],r=0;r<this.points.length;r+=1){var n=this.points[r];t.push(n),n.lastPointOfContour&&(e.push(t),t=[])}return check.argument(t.length===0,"There are still points left in the current contour."),e},Glyph.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],r=[],n=0;n<e.length;n+=1){var i=e[n];i.type!=="Z"&&(t.push(i.x),r.push(i.y)),(i.type==="Q"||i.type==="C")&&(t.push(i.x1),r.push(i.y1)),i.type==="C"&&(t.push(i.x2),r.push(i.y2))}var o={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(o.xMin)||(o.xMin=0),isFinite(o.xMax)||(o.xMax=this.advanceWidth),isFinite(o.yMin)||(o.yMin=0),isFinite(o.yMax)||(o.yMax=0),o.rightSideBearing=this.advanceWidth-o.leftSideBearing-(o.xMax-o.xMin),o},Glyph.prototype.draw=function(e,t,r,n,i){this.getPath(t,r,n,i).draw(e)},Glyph.prototype.drawPoints=function(e,t,r,n){function i(w,b,S,x){e.beginPath();for(var m=0;m<w.length;m+=1)e.moveTo(b+w[m].x*x,S+w[m].y*x),e.arc(b+w[m].x*x,S+w[m].y*x,2,0,Math.PI*2,!1);e.closePath(),e.fill()}t=t!==void 0?t:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var o=1/this.path.unitsPerEm*n,a=[],s=[],u=this.path,f=0;f<u.commands.length;f+=1){var d=u.commands[f];d.x!==void 0&&a.push({x:d.x,y:-d.y}),d.x1!==void 0&&s.push({x:d.x1,y:-d.y1}),d.x2!==void 0&&s.push({x:d.x2,y:-d.y2})}e.fillStyle="blue",i(a,t,r,o),e.fillStyle="red",i(s,t,r,o)},Glyph.prototype.drawMetrics=function(e,t,r,n){var i;t=t!==void 0?t:0,r=r!==void 0?r:0,n=n!==void 0?n:24,i=1/this.path.unitsPerEm*n,e.lineWidth=1,e.strokeStyle="black",draw$1.line(e,t,-1e4,t,1e4),draw$1.line(e,-1e4,r,1e4,r);var o=this.xMin||0,a=this.yMin||0,s=this.xMax||0,u=this.yMax||0,f=this.advanceWidth||0;e.strokeStyle="blue",draw$1.line(e,t+o*i,-1e4,t+o*i,1e4),draw$1.line(e,t+s*i,-1e4,t+s*i,1e4),draw$1.line(e,-1e4,r+-a*i,1e4,r+-a*i),draw$1.line(e,-1e4,r+-u*i,1e4,r+-u*i),e.strokeStyle="green",draw$1.line(e,t+f*i,-1e4,t+f*i,1e4)};function defineDependentProperty(e,t,r){Object.defineProperty(e,t,{get:function(){return e.path,e[r]},set:function(n){e[r]=n},enumerable:!0,configurable:!0})}function GlyphSet(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];n.path.unitsPerEm=e.unitsPerEm,this.glyphs[r]=n}this.length=t&&t.length||0}GlyphSet.prototype.get=function(e){if(this.glyphs[e]===void 0){this.font._push(e),typeof this.glyphs[e]=="function"&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],r=this.font._IndexToUnicodeMap[e];if(r)for(var n=0;n<r.unicodes.length;n++)t.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else typeof this.glyphs[e]=="function"&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]},GlyphSet.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};function glyphLoader(e,t){return new Glyph({index:t,font:e})}function ttfGlyphLoader(e,t,r,n,i,o){return function(){var a=new Glyph({index:t,font:e});return a.path=function(){r(a,n,i);var s=o(e.glyphs,a);return s.unitsPerEm=e.unitsPerEm,s},defineDependentProperty(a,"xMin","_xMin"),defineDependentProperty(a,"xMax","_xMax"),defineDependentProperty(a,"yMin","_yMin"),defineDependentProperty(a,"yMax","_yMax"),a}}function cffGlyphLoader(e,t,r,n){return function(){var i=new Glyph({index:t,font:e});return i.path=function(){var o=r(e,i,n);return o.unitsPerEm=e.unitsPerEm,o},i}}var glyphset={GlyphSet,glyphLoader,ttfGlyphLoader,cffGlyphLoader};function equals(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r+=1)if(!equals(e[r],t[r]))return!1;return!0}else return!1}function calcCFFSubroutineBias(e){var t;return e.length<1240?t=107:e.length<33900?t=1131:t=32768,t}function parseCFFIndex(e,t,r){var n=[],i=[],o=parse.getCard16(e,t),a,s;if(o!==0){var u=parse.getByte(e,t+2);a=t+(o+1)*u+2;for(var f=t+3,d=0;d<o+1;d+=1)n.push(parse.getOffset(e,f,u)),f+=u;s=a+n[o]}else s=t+2;for(var w=0;w<n.length-1;w+=1){var b=parse.getBytes(e,a+n[w],a+n[w+1]);r&&(b=r(b)),i.push(b)}return{objects:i,startOffset:t,endOffset:s}}function parseCFFIndexLowMemory(e,t){var r=[],n=parse.getCard16(e,t),i,o;if(n!==0){var a=parse.getByte(e,t+2);i=t+(n+1)*a+2;for(var s=t+3,u=0;u<n+1;u+=1)r.push(parse.getOffset(e,s,a)),s+=a;o=i+r[n]}else o=t+2;return{offsets:r,startOffset:t,endOffset:o}}function getCffIndexObject(e,t,r,n,i){var o=parse.getCard16(r,n),a=0;if(o!==0){var s=parse.getByte(r,n+2);a=n+(o+1)*s+2}var u=parse.getBytes(r,a+t[e],a+t[e+1]);return i&&(u=i(u)),u}function parseFloatOperand(e){for(var t="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=e.parseByte(),o=i>>4,a=i&15;if(o===r||(t+=n[o],a===r))break;t+=n[a]}return parseFloat(t)}function parseOperand(e,t){var r,n,i,o;if(t===28)return r=e.parseByte(),n=e.parseByte(),r<<8|n;if(t===29)return r=e.parseByte(),n=e.parseByte(),i=e.parseByte(),o=e.parseByte(),r<<24|n<<16|i<<8|o;if(t===30)return parseFloatOperand(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return r=e.parseByte(),(t-247)*256+r+108;if(t>=251&&t<=254)return r=e.parseByte(),-(t-251)*256-r-108;throw new Error("Invalid b0 "+t)}function entriesToObject(e){for(var t={},r=0;r<e.length;r+=1){var n=e[r][0],i=e[r][1],o=void 0;if(i.length===1?o=i[0]:o=i,t.hasOwnProperty(n)&&!isNaN(t[n]))throw new Error("Object "+t+" already has key "+n);t[n]=o}return t}function parseCFFDict(e,t,r){t=t!==void 0?t:0;var n=new parse.Parser(e,t),i=[],o=[];for(r=r!==void 0?r:e.length;n.relativeOffset<r;){var a=n.parseByte();a<=21?(a===12&&(a=1200+n.parseByte()),i.push([a,o]),o=[]):o.push(parseOperand(n,a))}return entriesToObject(i)}function getCFFString(e,t){return t<=390?t=cffStandardStrings[t]:t=e[t-391],t}function interpretDict(e,t,r){for(var n={},i,o=0;o<t.length;o+=1){var a=t[o];if(Array.isArray(a.type)){var s=[];s.length=a.type.length;for(var u=0;u<a.type.length;u++)i=e[a.op]!==void 0?e[a.op][u]:void 0,i===void 0&&(i=a.value!==void 0&&a.value[u]!==void 0?a.value[u]:null),a.type[u]==="SID"&&(i=getCFFString(r,i)),s[u]=i;n[a.name]=s}else i=e[a.op],i===void 0&&(i=a.value!==void 0?a.value:null),a.type==="SID"&&(i=getCFFString(r,i)),n[a.name]=i}return n}function parseCFFHeader(e,t){var r={};return r.formatMajor=parse.getCard8(e,t),r.formatMinor=parse.getCard8(e,t+1),r.size=parse.getCard8(e,t+2),r.offsetSize=parse.getCard8(e,t+3),r.startOffset=t,r.endOffset=t+4,r}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(e,t){var r=parseCFFDict(e,0,e.byteLength);return interpretDict(r,TOP_DICT_META,t)}function parseCFFPrivateDict(e,t,r,n){var i=parseCFFDict(e,t,r);return interpretDict(i,PRIVATE_DICT_META,n)}function gatherCFFTopDicts(e,t,r,n){for(var i=[],o=0;o<r.length;o+=1){var a=new DataView(new Uint8Array(r[o]).buffer),s=parseCFFTopDict(a,n);s._subrs=[],s._subrsBias=0,s._defaultWidthX=0,s._nominalWidthX=0;var u=s.private[0],f=s.private[1];if(u!==0&&f!==0){var d=parseCFFPrivateDict(e,f+t,u,n);if(s._defaultWidthX=d.defaultWidthX,s._nominalWidthX=d.nominalWidthX,d.subrs!==0){var w=f+d.subrs,b=parseCFFIndex(e,w+t);s._subrs=b.objects,s._subrsBias=calcCFFSubroutineBias(s._subrs)}s._privateDict=d}i.push(s)}return i}function parseCFFCharset(e,t,r,n){var i,o,a=new parse.Parser(e,t);r-=1;var s=[".notdef"],u=a.parseCard8();if(u===0)for(var f=0;f<r;f+=1)i=a.parseSID(),s.push(getCFFString(n,i));else if(u===1)for(;s.length<=r;){i=a.parseSID(),o=a.parseCard8();for(var d=0;d<=o;d+=1)s.push(getCFFString(n,i)),i+=1}else if(u===2)for(;s.length<=r;){i=a.parseSID(),o=a.parseCard16();for(var w=0;w<=o;w+=1)s.push(getCFFString(n,i)),i+=1}else throw new Error("Unknown charset format "+u);return s}function parseCFFEncoding(e,t,r){var n,i={},o=new parse.Parser(e,t),a=o.parseCard8();if(a===0)for(var s=o.parseCard8(),u=0;u<s;u+=1)n=o.parseCard8(),i[n]=u;else if(a===1){var f=o.parseCard8();n=1;for(var d=0;d<f;d+=1)for(var w=o.parseCard8(),b=o.parseCard8(),S=w;S<=w+b;S+=1)i[S]=n,n+=1}else throw new Error("Unknown encoding format "+a);return new CffEncoding(i,r)}function parseCFFCharstring(e,t,r){var n,i,o,a,s=new Path,u=[],f=0,d=!1,w=!1,b=0,S=0,x,m,h,v;if(e.isCIDFont){var p=e.tables.cff.topDict._fdSelect[t.index],y=e.tables.cff.topDict._fdArray[p];x=y._subrs,m=y._subrsBias,h=y._defaultWidthX,v=y._nominalWidthX}else x=e.tables.cff.topDict._subrs,m=e.tables.cff.topDict._subrsBias,h=e.tables.cff.topDict._defaultWidthX,v=e.tables.cff.topDict._nominalWidthX;var E=h;function P(B,F){w&&s.closePath(),s.moveTo(B,F),w=!0}function A(){var B;B=u.length%2!==0,B&&!d&&(E=u.shift()+v),f+=u.length>>1,u.length=0,d=!0}function L(B){for(var F,U,T,I,_,D,z,M,q,J,ee,le,oe=0;oe<B.length;){var V=B[oe];switch(oe+=1,V){case 1:A();break;case 3:A();break;case 4:u.length>1&&!d&&(E=u.shift()+v,d=!0),S+=u.pop(),P(b,S);break;case 5:for(;u.length>0;)b+=u.shift(),S+=u.shift(),s.lineTo(b,S);break;case 6:for(;u.length>0&&(b+=u.shift(),s.lineTo(b,S),u.length!==0);)S+=u.shift(),s.lineTo(b,S);break;case 7:for(;u.length>0&&(S+=u.shift(),s.lineTo(b,S),u.length!==0);)b+=u.shift(),s.lineTo(b,S);break;case 8:for(;u.length>0;)n=b+u.shift(),i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),b=o+u.shift(),S=a+u.shift(),s.curveTo(n,i,o,a,b,S);break;case 10:_=u.pop()+m,D=x[_],D&&L(D);break;case 11:return;case 12:switch(V=B[oe],oe+=1,V){case 35:n=b+u.shift(),i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),z=o+u.shift(),M=a+u.shift(),q=z+u.shift(),J=M+u.shift(),ee=q+u.shift(),le=J+u.shift(),b=ee+u.shift(),S=le+u.shift(),u.shift(),s.curveTo(n,i,o,a,z,M),s.curveTo(q,J,ee,le,b,S);break;case 34:n=b+u.shift(),i=S,o=n+u.shift(),a=i+u.shift(),z=o+u.shift(),M=a,q=z+u.shift(),J=a,ee=q+u.shift(),le=S,b=ee+u.shift(),s.curveTo(n,i,o,a,z,M),s.curveTo(q,J,ee,le,b,S);break;case 36:n=b+u.shift(),i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),z=o+u.shift(),M=a,q=z+u.shift(),J=a,ee=q+u.shift(),le=J+u.shift(),b=ee+u.shift(),s.curveTo(n,i,o,a,z,M),s.curveTo(q,J,ee,le,b,S);break;case 37:n=b+u.shift(),i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),z=o+u.shift(),M=a+u.shift(),q=z+u.shift(),J=M+u.shift(),ee=q+u.shift(),le=J+u.shift(),Math.abs(ee-b)>Math.abs(le-S)?b=ee+u.shift():S=le+u.shift(),s.curveTo(n,i,o,a,z,M),s.curveTo(q,J,ee,le,b,S);break;default:console.log("Glyph "+t.index+": unknown operator "+1200+V),u.length=0}break;case 14:u.length>0&&!d&&(E=u.shift()+v,d=!0),w&&(s.closePath(),w=!1);break;case 18:A();break;case 19:case 20:A(),oe+=f+7>>3;break;case 21:u.length>2&&!d&&(E=u.shift()+v,d=!0),S+=u.pop(),b+=u.pop(),P(b,S);break;case 22:u.length>1&&!d&&(E=u.shift()+v,d=!0),b+=u.pop(),P(b,S);break;case 23:A();break;case 24:for(;u.length>2;)n=b+u.shift(),i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),b=o+u.shift(),S=a+u.shift(),s.curveTo(n,i,o,a,b,S);b+=u.shift(),S+=u.shift(),s.lineTo(b,S);break;case 25:for(;u.length>6;)b+=u.shift(),S+=u.shift(),s.lineTo(b,S);n=b+u.shift(),i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),b=o+u.shift(),S=a+u.shift(),s.curveTo(n,i,o,a,b,S);break;case 26:for(u.length%2&&(b+=u.shift());u.length>0;)n=b,i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),b=o,S=a+u.shift(),s.curveTo(n,i,o,a,b,S);break;case 27:for(u.length%2&&(S+=u.shift());u.length>0;)n=b+u.shift(),i=S,o=n+u.shift(),a=i+u.shift(),b=o+u.shift(),S=a,s.curveTo(n,i,o,a,b,S);break;case 28:F=B[oe],U=B[oe+1],u.push((F<<24|U<<16)>>16),oe+=2;break;case 29:_=u.pop()+e.gsubrsBias,D=e.gsubrs[_],D&&L(D);break;case 30:for(;u.length>0&&(n=b,i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),b=o+u.shift(),S=a+(u.length===1?u.shift():0),s.curveTo(n,i,o,a,b,S),u.length!==0);)n=b+u.shift(),i=S,o=n+u.shift(),a=i+u.shift(),S=a+u.shift(),b=o+(u.length===1?u.shift():0),s.curveTo(n,i,o,a,b,S);break;case 31:for(;u.length>0&&(n=b+u.shift(),i=S,o=n+u.shift(),a=i+u.shift(),S=a+u.shift(),b=o+(u.length===1?u.shift():0),s.curveTo(n,i,o,a,b,S),u.length!==0);)n=b,i=S+u.shift(),o=n+u.shift(),a=i+u.shift(),b=o+u.shift(),S=a+(u.length===1?u.shift():0),s.curveTo(n,i,o,a,b,S);break;default:V<32?console.log("Glyph "+t.index+": unknown operator "+V):V<247?u.push(V-139):V<251?(F=B[oe],oe+=1,u.push((V-247)*256+F+108)):V<255?(F=B[oe],oe+=1,u.push(-(V-251)*256-F-108)):(F=B[oe],U=B[oe+1],T=B[oe+2],I=B[oe+3],oe+=4,u.push((F<<24|U<<16|T<<8|I)/65536))}}}return L(r),t.advanceWidth=E,s}function parseCFFFDSelect(e,t,r,n){var i=[],o,a=new parse.Parser(e,t),s=a.parseCard8();if(s===0)for(var u=0;u<r;u++){if(o=a.parseCard8(),o>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+n+")");i.push(o)}else if(s===3){var f=a.parseCard16(),d=a.parseCard16();if(d!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+d);for(var w,b=0;b<f;b++){if(o=a.parseCard8(),w=a.parseCard16(),o>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+o+" (FD count "+n+")");if(w>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+w);for(;d<w;d++)i.push(o);d=w}if(w!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+w)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+s);return i}function parseCFFTable(e,t,r,n){r.tables.cff={};var i=parseCFFHeader(e,t),o=parseCFFIndex(e,i.endOffset,parse.bytesToString),a=parseCFFIndex(e,o.endOffset),s=parseCFFIndex(e,a.endOffset,parse.bytesToString),u=parseCFFIndex(e,s.endOffset);r.gsubrs=u.objects,r.gsubrsBias=calcCFFSubroutineBias(r.gsubrs);var f=gatherCFFTopDicts(e,t,a.objects,s.objects);if(f.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+f.length);var d=f[0];if(r.tables.cff.topDict=d,d._privateDict&&(r.defaultWidthX=d._privateDict.defaultWidthX,r.nominalWidthX=d._privateDict.nominalWidthX),d.ros[0]!==void 0&&d.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var w=d.fdArray,b=d.fdSelect;if(w===0||b===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");w+=t;var S=parseCFFIndex(e,w),x=gatherCFFTopDicts(e,t,S.objects,s.objects);d._fdArray=x,b+=t,d._fdSelect=parseCFFFDSelect(e,b,r.numGlyphs,x.length)}var m=t+d.private[1],h=parseCFFPrivateDict(e,m,d.private[0],s.objects);if(r.defaultWidthX=h.defaultWidthX,r.nominalWidthX=h.nominalWidthX,h.subrs!==0){var v=m+h.subrs,p=parseCFFIndex(e,v);r.subrs=p.objects,r.subrsBias=calcCFFSubroutineBias(r.subrs)}else r.subrs=[],r.subrsBias=0;var y;n.lowMemory?(y=parseCFFIndexLowMemory(e,t+d.charStrings),r.nGlyphs=y.offsets.length):(y=parseCFFIndex(e,t+d.charStrings),r.nGlyphs=y.objects.length);var E=parseCFFCharset(e,t+d.charset,r.nGlyphs,s.objects);if(d.encoding===0?r.cffEncoding=new CffEncoding(cffStandardEncoding,E):d.encoding===1?r.cffEncoding=new CffEncoding(cffExpertEncoding,E):r.cffEncoding=parseCFFEncoding(e,t+d.encoding,E),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new glyphset.GlyphSet(r),n.lowMemory)r._push=function(L){var B=getCffIndexObject(L,y.offsets,e,t+d.charStrings);r.glyphs.push(L,glyphset.cffGlyphLoader(r,L,parseCFFCharstring,B))};else for(var P=0;P<r.nGlyphs;P+=1){var A=y.objects[P];r.glyphs.push(P,glyphset.cffGlyphLoader(r,P,parseCFFCharstring,A))}}function encodeString(e,t){var r,n=cffStandardStrings.indexOf(e);return n>=0&&(r=n),n=t.indexOf(e),n>=0?r=n+cffStandardStrings.length:(r=cffStandardStrings.length+t.length,t.push(e)),r}function makeHeader(){return new table.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(e){var t=new table.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var r=0;r<e.length;r+=1)t.names.push({name:"name_"+r,type:"NAME",value:e[r]});return t}function makeDict(e,t,r){for(var n={},i=0;i<e.length;i+=1){var o=e[i],a=t[o.name];a!==void 0&&!equals(a,o.value)&&(o.type==="SID"&&(a=encodeString(a,r)),n[o.op]={name:o.name,type:o.type,value:a})}return n}function makeTopDict(e,t){var r=new table.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=makeDict(TOP_DICT_META,e,t),r}function makeTopDictIndex(e){var t=new table.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function makeStringIndex(e){var t=new table.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var r=0;r<e.length;r+=1)t.strings.push({name:"string_"+r,type:"STRING",value:e[r]});return t}function makeGlobalSubrIndex(){return new table.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(e,t){for(var r=new table.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<e.length;n+=1){var i=e[n],o=encodeString(i,t);r.fields.push({name:"glyph_"+n,type:"SID",value:o})}return r}function glyphToOps(e){var t=[],r=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var n=0,i=0,o=0;o<r.commands.length;o+=1){var a=void 0,s=void 0,u=r.commands[o];if(u.type==="Q"){var f=.3333333333333333,d=2/3;u={type:"C",x:u.x,y:u.y,x1:Math.round(f*n+d*u.x1),y1:Math.round(f*i+d*u.y1),x2:Math.round(f*u.x+d*u.x1),y2:Math.round(f*u.y+d*u.y1)}}if(u.type==="M")a=Math.round(u.x-n),s=Math.round(u.y-i),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(u.x),i=Math.round(u.y);else if(u.type==="L")a=Math.round(u.x-n),s=Math.round(u.y-i),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rlineto",type:"OP",value:5}),n=Math.round(u.x),i=Math.round(u.y);else if(u.type==="C"){var w=Math.round(u.x1-n),b=Math.round(u.y1-i),S=Math.round(u.x2-u.x1),x=Math.round(u.y2-u.y1);a=Math.round(u.x-u.x2),s=Math.round(u.y-u.y2),t.push({name:"dx1",type:"NUMBER",value:w}),t.push({name:"dy1",type:"NUMBER",value:b}),t.push({name:"dx2",type:"NUMBER",value:S}),t.push({name:"dy2",type:"NUMBER",value:x}),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:s}),t.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(u.x),i=Math.round(u.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}function makeCharStringsIndex(e){for(var t=new table.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<e.length;r+=1){var n=e.get(r),i=glyphToOps(n);t.charStrings.push({name:n.name,type:"CHARSTRING",value:i})}return t}function makePrivateDict(e,t){var r=new table.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=makeDict(PRIVATE_DICT_META,e,t),r}function makeCFFTable(e,t){for(var r=new table.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/t.unitsPerEm,i={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o={},a=[],s,u=1;u<e.length;u+=1)s=e.get(u),a.push(s.name);var f=[];r.header=makeHeader(),r.nameIndex=makeNameIndex([t.postScriptName]);var d=makeTopDict(i,f);r.topDictIndex=makeTopDictIndex(d),r.globalSubrIndex=makeGlobalSubrIndex(),r.charsets=makeCharsets(a,f),r.charStringsIndex=makeCharStringsIndex(e),r.privateDict=makePrivateDict(o,f),r.stringIndex=makeStringIndex(f);var w=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return i.charset=w,i.encoding=0,i.charStrings=i.charset+r.charsets.sizeOf(),i.private[1]=i.charStrings+r.charStringsIndex.sizeOf(),d=makeTopDict(i,f),r.topDictIndex=makeTopDictIndex(d),r}var cff={parse:parseCFFTable,make:makeCFFTable};function parseHeadTable(e,t){var r={},n=new parse.Parser(e,t);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),check.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function makeHeadTable(e){var t=Math.round(new Date().getTime()/1e3)+2082844800,r=t;return e.createdTimestamp&&(r=e.createdTimestamp+2082844800),new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}var head={parse:parseHeadTable,make:makeHeadTable};function parseHheaTable(e,t){var r={},n=new parse.Parser(e,t);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function makeHheaTable(e){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}var hhea={parse:parseHheaTable,make:makeHheaTable};function parseHmtxTableAll(e,t,r,n,i){for(var o,a,s=new parse.Parser(e,t),u=0;u<n;u+=1){u<r&&(o=s.parseUShort(),a=s.parseShort());var f=i.get(u);f.advanceWidth=o,f.leftSideBearing=a}}function parseHmtxTableOnLowMemory(e,t,r,n,i){e._hmtxTableData={};for(var o,a,s=new parse.Parser(t,r),u=0;u<i;u+=1)u<n&&(o=s.parseUShort(),a=s.parseShort()),e._hmtxTableData[u]={advanceWidth:o,leftSideBearing:a}}function parseHmtxTable(e,t,r,n,i,o,a){a.lowMemory?parseHmtxTableOnLowMemory(e,t,r,n,i):parseHmtxTableAll(t,r,n,i,o)}function makeHmtxTable(e){for(var t=new table.Table("hmtx",[]),r=0;r<e.length;r+=1){var n=e.get(r),i=n.advanceWidth||0,o=n.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:i}),t.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:o})}return t}var hmtx={parse:parseHmtxTable,make:makeHmtxTable};function makeLtagTable(e){for(var t=new table.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),r="",n=12+e.length*4,i=0;i<e.length;++i){var o=r.indexOf(e[i]);o<0&&(o=r.length,r+=e[i]),t.fields.push({name:"offset "+i,type:"USHORT",value:n+o}),t.fields.push({name:"length "+i,type:"USHORT",value:e[i].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),t}function parseLtagTable(e,t){var r=new parse.Parser(e,t),n=r.parseULong();check.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var i=r.parseULong(),o=[],a=0;a<i;a++){for(var s="",u=t+r.parseUShort(),f=r.parseUShort(),d=u;d<u+f;++d)s+=String.fromCharCode(e.getInt8(d));o.push(s)}return o}var ltag={make:makeLtagTable,parse:parseLtagTable};function parseMaxpTable(e,t){var r={},n=new parse.Parser(e,t);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function makeMaxpTable(e){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}var maxp={parse:parseMaxpTable,make:makeMaxpTable},nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],macLanguages={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},macLanguageToScript={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},windowsLanguages={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function getLanguageCode(e,t,r){switch(e){case 0:if(t===65535)return"und";if(r)return r[t];break;case 1:return macLanguages[t];case 3:return windowsLanguages[t]}}var utf16="utf-16",macScriptEncodings={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},macLanguageEncodings={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function getEncoding(e,t,r){switch(e){case 0:return utf16;case 1:return macLanguageEncodings[r]||macScriptEncodings[t];case 3:if(t===1||t===10)return utf16;break}}function parseNameTable(e,t,r){for(var n={},i=new parse.Parser(e,t),o=i.parseUShort(),a=i.parseUShort(),s=i.offset+i.parseUShort(),u=0;u<a;u++){var f=i.parseUShort(),d=i.parseUShort(),w=i.parseUShort(),b=i.parseUShort(),S=nameTableNames[b]||b,x=i.parseUShort(),m=i.parseUShort(),h=getLanguageCode(f,w,r),v=getEncoding(f,d,w);if(v!==void 0&&h!==void 0){var p=void 0;if(v===utf16?p=decode.UTF16(e,s+m,x):p=decode.MACSTRING(e,s+m,x,v),p){var y=n[S];y===void 0&&(y=n[S]={}),y[h]=p}}}return o===1&&i.parseUShort(),n}function reverseDict(e){var t={};for(var r in e)t[e[r]]=parseInt(r);return t}function makeNameRecord(e,t,r,n,i,o){return new table.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:o}])}function findSubArray(e,t){var r=e.length,n=t.length-r+1;e:for(var i=0;i<n;i++)for(;i<n;i++){for(var o=0;o<r;o++)if(t[i+o]!==e[o])continue e;return i}return-1}function addStringToPool(e,t){var r=findSubArray(e,t);if(r<0){r=t.length;for(var n=0,i=e.length;n<i;++n)t.push(e[n])}return r}function makeNameTable(e,t){var r,n=[],i={},o=reverseDict(nameTableNames);for(var a in e){var s=o[a];if(s===void 0&&(s=a),r=parseInt(s),isNaN(r))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');i[r]=e[a],n.push(r)}for(var u=reverseDict(macLanguages),f=reverseDict(windowsLanguages),d=[],w=[],b=0;b<n.length;b++){r=n[b];var S=i[r];for(var x in S){var m=S[x],h=1,v=u[x],p=macLanguageToScript[v],y=getEncoding(h,p,v),E=encode.MACSTRING(m,y);E===void 0&&(h=0,v=t.indexOf(x),v<0&&(v=t.length,t.push(x)),p=4,E=encode.UTF16(m));var P=addStringToPool(E,w);d.push(makeNameRecord(h,p,v,r,E.length,P));var A=f[x];if(A!==void 0){var L=encode.UTF16(m),B=addStringToPool(L,w);d.push(makeNameRecord(3,1,A,r,L.length,B))}}}d.sort(function(T,I){return T.platformID-I.platformID||T.encodingID-I.encodingID||T.languageID-I.languageID||T.nameID-I.nameID});for(var F=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:d.length},{name:"stringOffset",type:"USHORT",value:6+d.length*12}]),U=0;U<d.length;U++)F.fields.push({name:"record_"+U,type:"RECORD",value:d[U]});return F.fields.push({name:"strings",type:"LITERAL",value:w}),F}var _name={parse:parseNameTable,make:makeNameTable},unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(e){for(var t=0;t<unicodeRanges.length;t+=1){var r=unicodeRanges[t];if(e>=r.begin&&e<r.end)return t}return-1}function parseOS2Table(e,t){var r={},n=new parse.Parser(e,t);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var i=0;i<10;i++)r.panose[i]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function makeOS2Table(e){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}var os2={parse:parseOS2Table,make:makeOS2Table,unicodeRanges,getUnicodeRange};function parsePostTable(e,t){var r={},n=new parse.Parser(e,t);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=standardNames.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.glyphNameIndex[i]=n.parseUShort();r.names=[];for(var o=0;o<r.numberOfGlyphs;o++)if(r.glyphNameIndex[o]>=standardNames.length){var a=n.parseChar();r.names.push(n.parseString(a))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var s=0;s<r.numberOfGlyphs;s++)r.offset[s]=n.parseChar();break}return r}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var post={parse:parsePostTable,make:makePostTable},subtableParsers=new Array(9);subtableParsers[1]=function(){var t=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),substitute:this.parseOffset16List()};check.assert(!1,"0x"+t.toString(16)+": lookup type 1 format must be 1 or 2.")},subtableParsers[2]=function(){var t=this.parseUShort();return check.argument(t===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(Parser.coverage),sequences:this.parseListOfLists()}},subtableParsers[3]=function(){var t=this.parseUShort();return check.argument(t===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(Parser.coverage),alternateSets:this.parseListOfLists()}},subtableParsers[4]=function(){var t=this.parseUShort();return check.argument(t===1,"GSUB ligature table identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(Parser.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var lookupRecordDesc={sequenceIndex:Parser.uShort,lookupListIndex:Parser.uShort};subtableParsers[5]=function(){var t=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(Parser.coverage),ruleSets:this.parseListOfLists(function(){var o=this.parseUShort(),a=this.parseUShort();return{input:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(a,lookupRecordDesc)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(Parser.coverage),classDef:this.parsePointer(Parser.classDef),classSets:this.parseListOfLists(function(){var o=this.parseUShort(),a=this.parseUShort();return{classes:this.parseUShortList(o-1),lookupRecords:this.parseRecordList(a,lookupRecordDesc)}})};if(r===3){var n=this.parseUShort(),i=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(i,lookupRecordDesc)}}check.assert(!1,"0x"+t.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},subtableParsers[6]=function(){var t=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),backtrackClassDef:this.parsePointer(Parser.classDef),inputClassDef:this.parsePointer(Parser.classDef),lookaheadClassDef:this.parsePointer(Parser.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),inputCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(lookupRecordDesc)};check.assert(!1,"0x"+t.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},subtableParsers[7]=function(){var t=this.parseUShort();check.argument(t===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new Parser(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:subtableParsers[r].call(n)}},subtableParsers[8]=function(){var t=this.parseUShort();return check.argument(t===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:t,coverage:this.parsePointer(Parser.coverage),backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),substitutes:this.parseUShortList()}};function parseGsubTable(e,t){t=t||0;var r=new Parser(e,t),n=r.parseVersion(1);return check.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(subtableParsers),variations:r.parseFeatureVariationsList()}}var subtableMakers=new Array(9);subtableMakers[1]=function(t){return t.substFormat===1?new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(t.coverage)},{name:"deltaGlyphID",type:"USHORT",value:t.deltaGlyphId}]):new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new table.Coverage(t.coverage)}].concat(table.ushortList("substitute",t.substitute)))},subtableMakers[2]=function(t){return check.assert(t.substFormat===1,"Lookup type 2 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(t.coverage)}].concat(table.tableList("seqSet",t.sequences,function(r){return new table.Table("sequenceSetTable",table.ushortList("sequence",r))})))},subtableMakers[3]=function(t){return check.assert(t.substFormat===1,"Lookup type 3 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(t.coverage)}].concat(table.tableList("altSet",t.alternateSets,function(r){return new table.Table("alternateSetTable",table.ushortList("alternate",r))})))},subtableMakers[4]=function(t){return check.assert(t.substFormat===1,"Lookup type 4 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(t.coverage)}].concat(table.tableList("ligSet",t.ligatureSets,function(r){return new table.Table("ligatureSetTable",table.tableList("ligature",r,function(n){return new table.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(table.ushortList("component",n.components,n.components.length+1)))}))})))},subtableMakers[6]=function(t){if(t.substFormat===1){var r=new table.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:t.substFormat},{name:"coverage",type:"TABLE",value:new table.Coverage(t.coverage)}].concat(table.tableList("chainRuleSet",t.chainRuleSets,function(o){return new table.Table("chainRuleSetTable",table.tableList("chainRule",o,function(a){var s=table.ushortList("backtrackGlyph",a.backtrack,a.backtrack.length).concat(table.ushortList("inputGlyph",a.input,a.input.length+1)).concat(table.ushortList("lookaheadGlyph",a.lookahead,a.lookahead.length)).concat(table.ushortList("substitution",[],a.lookupRecords.length));return a.lookupRecords.forEach(function(u,f){s=s.concat({name:"sequenceIndex"+f,type:"USHORT",value:u.sequenceIndex}).concat({name:"lookupListIndex"+f,type:"USHORT",value:u.lookupListIndex})}),new table.Table("chainRuleTable",s)}))})));return r}else if(t.substFormat===2)check.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(t.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:t.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:t.backtrackCoverage.length}),t.backtrackCoverage.forEach(function(o,a){n.push({name:"backtrackCoverage"+a,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:t.inputCoverage.length}),t.inputCoverage.forEach(function(o,a){n.push({name:"inputCoverage"+a,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:t.lookaheadCoverage.length}),t.lookaheadCoverage.forEach(function(o,a){n.push({name:"lookaheadCoverage"+a,type:"TABLE",value:new table.Coverage(o)})}),n.push({name:"substitutionCount",type:"USHORT",value:t.lookupRecords.length}),t.lookupRecords.forEach(function(o,a){n=n.concat({name:"sequenceIndex"+a,type:"USHORT",value:o.sequenceIndex}).concat({name:"lookupListIndex"+a,type:"USHORT",value:o.lookupListIndex})});var i=new table.Table("chainContextTable",n);return i}check.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function makeGsubTable(e){return new table.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(e.lookups,subtableMakers)}])}var gsub={parse:parseGsubTable,make:makeGsubTable};function parseMetaTable(e,t){var r=new parse.Parser(e,t),n=r.parseULong();check.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var i=r.parseULong(),o={},a=0;a<i;a++){var s=r.parseTag(),u=r.parseULong(),f=r.parseULong(),d=decode.UTF8(e,t+u,f);o[s]=d}return o}function makeMetaTable(e){var t=Object.keys(e).length,r="",n=16+t*12,i=new table.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:t}]);for(var o in e){var a=r.length;r+=e[o],i.fields.push({name:"tag "+o,type:"TAG",value:o}),i.fields.push({name:"offset "+o,type:"ULONG",value:n+a}),i.fields.push({name:"length "+o,type:"ULONG",value:e[o].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),i}var meta={parse:parseMetaTable,make:makeMetaTable};function log2(e){return Math.log(e)/Math.log(2)|0}function computeCheckSum(e){for(;e.length%4!==0;)e.push(0);for(var t=0,r=0;r<e.length;r+=4)t+=(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3];return t%=Math.pow(2,32),t}function makeTableRecord(e,t,r,n){return new table.Record("Table Record",[{name:"tag",type:"TAG",value:e!==void 0?e:""},{name:"checkSum",type:"ULONG",value:t!==void 0?t:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function makeSfntTable(e){var t=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var r=Math.pow(2,log2(t.numTables));t.searchRange=16*r,t.entrySelector=log2(r),t.rangeShift=t.numTables*16-t.searchRange;for(var n=[],i=[],o=t.sizeOf()+makeTableRecord().sizeOf()*t.numTables;o%4!==0;)o+=1,i.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<e.length;a+=1){var s=e[a];check.argument(s.tableName.length===4,"Table name"+s.tableName+" is invalid.");var u=s.sizeOf(),f=makeTableRecord(s.tableName,computeCheckSum(s.encode()),o,u);for(n.push({name:f.tag+" Table Record",type:"RECORD",value:f}),i.push({name:s.tableName+" table",type:"RECORD",value:s}),o+=u,check.argument(!isNaN(o),"Something went wrong calculating the offset.");o%4!==0;)o+=1,i.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(d,w){return d.value.tag>w.value.tag?1:-1}),t.fields=t.fields.concat(n),t.fields=t.fields.concat(i),t}function metricsForChar(e,t,r){for(var n=0;n<t.length;n+=1){var i=e.charToGlyphIndex(t[n]);if(i>0){var o=e.glyphs.get(i);return o.getMetrics()}}return r}function average(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t/e.length}function fontToSfntTable(e){for(var t=[],r=[],n=[],i=[],o=[],a=[],s=[],u,f=0,d=0,w=0,b=0,S=0,x=0;x<e.glyphs.length;x+=1){var m=e.glyphs.get(x),h=m.unicode|0;if(isNaN(m.advanceWidth))throw new Error("Glyph "+m.name+" ("+x+"): advanceWidth is not a number.");(u>h||u===void 0)&&h>0&&(u=h),f<h&&(f=h);var v=os2.getUnicodeRange(h);if(v<32)d|=1<<v;else if(v<64)w|=1<<v-32;else if(v<96)b|=1<<v-64;else if(v<123)S|=1<<v-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(m.name!==".notdef"){var p=m.getMetrics();t.push(p.xMin),r.push(p.yMin),n.push(p.xMax),i.push(p.yMax),a.push(p.leftSideBearing),s.push(p.rightSideBearing),o.push(m.advanceWidth)}}var y={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,i),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:average(o),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,s)};y.ascender=e.ascender,y.descender=e.descender;var E=head.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:y.xMin,yMin:y.yMin,xMax:y.xMax,yMax:y.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),P=hhea.make({ascender:y.ascender,descender:y.descender,advanceWidthMax:y.advanceWidthMax,minLeftSideBearing:y.minLeftSideBearing,minRightSideBearing:y.minRightSideBearing,xMaxExtent:y.maxLeftSideBearing+(y.xMax-y.xMin),numberOfHMetrics:e.glyphs.length}),A=maxp.make(e.glyphs.length),L=os2.make(Object.assign({xAvgCharWidth:Math.round(y.advanceWidthAvg),usFirstCharIndex:u,usLastCharIndex:f,ulUnicodeRange1:d,ulUnicodeRange2:w,ulUnicodeRange3:b,ulUnicodeRange4:S,sTypoAscender:y.ascender,sTypoDescender:y.descender,sTypoLineGap:0,usWinAscent:y.yMax,usWinDescent:Math.abs(y.yMin),ulCodePageRange1:1,sxHeight:metricsForChar(e,"xyvw",{yMax:Math.round(y.ascender/2)}).yMax,sCapHeight:metricsForChar(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",y).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),B=hmtx.make(e.glyphs),F=cmap.make(e.glyphs),U=e.getEnglishName("fontFamily"),T=e.getEnglishName("fontSubfamily"),I=U+" "+T,_=e.getEnglishName("postScriptName");_||(_=U.replace(/\s/g,"")+"-"+T);var D={};for(var z in e.names)D[z]=e.names[z];D.uniqueID||(D.uniqueID={en:e.getEnglishName("manufacturer")+":"+I}),D.postScriptName||(D.postScriptName={en:_}),D.preferredFamily||(D.preferredFamily=e.names.fontFamily),D.preferredSubfamily||(D.preferredSubfamily=e.names.fontSubfamily);var M=[],q=_name.make(D,M),J=M.length>0?ltag.make(M):void 0,ee=post.make(),le=cff.make(e.glyphs,{version:e.getEnglishName("version"),fullName:I,familyName:U,weightName:T,postScriptName:_,unitsPerEm:e.unitsPerEm,fontBBox:[0,y.yMin,y.ascender,y.advanceWidthMax]}),oe=e.metas&&Object.keys(e.metas).length>0?meta.make(e.metas):void 0,V=[E,P,A,L,q,F,ee,le,B];J&&V.push(J),e.tables.gsub&&V.push(gsub.make(e.tables.gsub)),oe&&V.push(oe);for(var H=makeSfntTable(V),X=H.encode(),Y=computeCheckSum(X),ie=H.fields,se=!1,pe=0;pe<ie.length;pe+=1)if(ie[pe].name==="head table"){ie[pe].value.checkSumAdjustment=2981146554-Y,se=!0;break}if(!se)throw new Error("Could not find head table with checkSum to adjust.");return H}var sfnt={make:makeSfntTable,fontToTable:fontToSfntTable,computeCheckSum};function searchTag(e,t){for(var r=0,n=e.length-1;r<=n;){var i=r+n>>>1,o=e[i].tag;if(o===t)return i;o<t?r=i+1:n=i-1}return-r-1}function binSearch(e,t){for(var r=0,n=e.length-1;r<=n;){var i=r+n>>>1,o=e[i];if(o===t)return i;o<t?r=i+1:n=i-1}return-r-1}function searchRange(e,t){for(var r,n=0,i=e.length-1;n<=i;){var o=n+i>>>1;r=e[o];var a=r.start;if(a===t)return r;a<t?n=o+1:i=o-1}if(n>0)return r=e[n-1],t>r.end?0:r}function Layout(e,t){this.font=e,this.tableName=t}Layout.prototype={searchTag,binSearch,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map(function(t){return t.tag}):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,r=0;r<e.scripts.length;r++){var n=e.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(t=!0)}if(t)return"latn"}},getScriptTable:function(e,t){var r=this.getTable(t);if(r){e=e||"DFLT";var n=r.scripts,i=searchTag(r.scripts,e);if(i>=0)return n[i].script;if(t){var o={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,o),o.script}}},getLangSysTable:function(e,t,r){var n=this.getScriptTable(e,r);if(n){if(!t||t==="dflt"||t==="DFLT")return n.defaultLangSys;var i=searchTag(n.langSysRecords,t);if(i>=0)return n.langSysRecords[i].langSys;if(r){var o={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,o),o.langSys}}},getFeatureTable:function(e,t,r,n){var i=this.getLangSysTable(e,t,n);if(i){for(var o,a=i.featureIndexes,s=this.font.tables[this.tableName].features,u=0;u<a.length;u++)if(o=s[a[u]],o.tag===r)return o.feature;if(n){var f=s.length;return check.assert(f===0||r>=s[f-1].tag,"Features must be added in alphabetical order."),o={tag:r,feature:{params:0,lookupListIndexes:[]}},s.push(o),a.push(f),o.feature}}},getLookupTables:function(e,t,r,n,i){var o=this.getFeatureTable(e,t,r,i),a=[];if(o){for(var s,u=o.lookupListIndexes,f=this.font.tables[this.tableName].lookups,d=0;d<u.length;d++)s=f[u[d]],s.lookupType===n&&a.push(s);if(a.length===0&&i){s={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var w=f.length;return f.push(s),u.push(w),[s]}}return a},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var r=searchRange(e.ranges,t);return r?r.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var r=binSearch(e.glyphs,t);return r>=0?r:-1;case 2:var n=searchRange(e.ranges,t);return n?n.index+t-n.start:-1}},expandCoverage:function(e){if(e.format===1)return e.glyphs;for(var t=[],r=e.ranges,n=0;n<r.length;n++)for(var i=r[n],o=i.start,a=i.end,s=o;s<=a;s++)t.push(s);return t}};function Position(e){Layout.call(this,e,"gpos")}Position.prototype=Layout.prototype,Position.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},Position.prototype.getKerningValue=function(e,t,r){for(var n=0;n<e.length;n++)for(var i=e[n].subtables,o=0;o<i.length;o++){var a=i[o],s=this.getCoverageIndex(a.coverage,t);if(!(s<0))switch(a.posFormat){case 1:for(var u=a.pairSets[s],f=0;f<u.length;f++){var d=u[f];if(d.secondGlyph===r)return d.value1&&d.value1.xAdvance||0}break;case 2:var w=this.getGlyphClass(a.classDef1,t),b=this.getGlyphClass(a.classDef2,r),S=a.classRecords[w][b];return S.value1&&S.value1.xAdvance||0}}return 0},Position.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)};function Substitution(e){Layout.call(this,e,"gsub")}function arraysEqual(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function getSubstFormat(e,t,r){for(var n=e.subtables,i=0;i<n.length;i++){var o=n[i];if(o.substFormat===t)return o}if(r)return n.push(r),r}Substitution.prototype=Layout.prototype,Substitution.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Substitution.prototype.getSingle=function(e,t,r){for(var n=[],i=this.getLookupTables(t,r,e,1),o=0;o<i.length;o++)for(var a=i[o].subtables,s=0;s<a.length;s++){var u=a[s],f=this.expandCoverage(u.coverage),d=void 0;if(u.substFormat===1){var w=u.deltaGlyphId;for(d=0;d<f.length;d++){var b=f[d];n.push({sub:b,by:b+w})}}else{var S=u.substitute;for(d=0;d<f.length;d++)n.push({sub:f[d],by:S[d]})}}return n},Substitution.prototype.getMultiple=function(e,t,r){for(var n=[],i=this.getLookupTables(t,r,e,2),o=0;o<i.length;o++)for(var a=i[o].subtables,s=0;s<a.length;s++){var u=a[s],f=this.expandCoverage(u.coverage),d=void 0;for(d=0;d<f.length;d++){var w=f[d],b=u.sequences[d];n.push({sub:w,by:b})}}return n},Substitution.prototype.getAlternates=function(e,t,r){for(var n=[],i=this.getLookupTables(t,r,e,3),o=0;o<i.length;o++)for(var a=i[o].subtables,s=0;s<a.length;s++)for(var u=a[s],f=this.expandCoverage(u.coverage),d=u.alternateSets,w=0;w<f.length;w++)n.push({sub:f[w],by:d[w]});return n},Substitution.prototype.getLigatures=function(e,t,r){for(var n=[],i=this.getLookupTables(t,r,e,4),o=0;o<i.length;o++)for(var a=i[o].subtables,s=0;s<a.length;s++)for(var u=a[s],f=this.expandCoverage(u.coverage),d=u.ligatureSets,w=0;w<f.length;w++)for(var b=f[w],S=d[w],x=0;x<S.length;x++){var m=S[x];n.push({sub:[b].concat(m.components),by:m.ligGlyph})}return n},Substitution.prototype.addSingle=function(e,t,r,n){var i=this.getLookupTables(r,n,e,1,!0)[0],o=getSubstFormat(i,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});check.assert(o.coverage.format===1,"Single: unable to modify coverage table format "+o.coverage.format);var a=t.sub,s=this.binSearch(o.coverage.glyphs,a);s<0&&(s=-1-s,o.coverage.glyphs.splice(s,0,a),o.substitute.splice(s,0,0)),o.substitute[s]=t.by},Substitution.prototype.addMultiple=function(e,t,r,n){check.assert(t.by instanceof Array&&t.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=this.getLookupTables(r,n,e,2,!0)[0],o=getSubstFormat(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});check.assert(o.coverage.format===1,"Multiple: unable to modify coverage table format "+o.coverage.format);var a=t.sub,s=this.binSearch(o.coverage.glyphs,a);s<0&&(s=-1-s,o.coverage.glyphs.splice(s,0,a),o.sequences.splice(s,0,0)),o.sequences[s]=t.by},Substitution.prototype.addAlternate=function(e,t,r,n){var i=this.getLookupTables(r,n,e,3,!0)[0],o=getSubstFormat(i,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});check.assert(o.coverage.format===1,"Alternate: unable to modify coverage table format "+o.coverage.format);var a=t.sub,s=this.binSearch(o.coverage.glyphs,a);s<0&&(s=-1-s,o.coverage.glyphs.splice(s,0,a),o.alternateSets.splice(s,0,0)),o.alternateSets[s]=t.by},Substitution.prototype.addLigature=function(e,t,r,n){var i=this.getLookupTables(r,n,e,4,!0)[0],o=i.subtables[0];o||(o={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=o),check.assert(o.coverage.format===1,"Ligature: unable to modify coverage table format "+o.coverage.format);var a=t.sub[0],s=t.sub.slice(1),u={ligGlyph:t.by,components:s},f=this.binSearch(o.coverage.glyphs,a);if(f>=0){for(var d=o.ligatureSets[f],w=0;w<d.length;w++)if(arraysEqual(d[w].components,s))return;d.push(u)}else f=-1-f,o.coverage.glyphs.splice(f,0,a),o.ligatureSets.splice(f,0,[u])},Substitution.prototype.getFeature=function(e,t,r){if(/ss\d\d/.test(e))return this.getSingle(e,t,r);switch(e){case"aalt":case"salt":return this.getSingle(e,t,r).concat(this.getAlternates(e,t,r));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,r);case"ccmp":return this.getMultiple(e,t,r).concat(this.getLigatures(e,t,r));case"stch":return this.getMultiple(e,t,r)}},Substitution.prototype.add=function(e,t,r,n){if(/ss\d\d/.test(e))return this.addSingle(e,t,r,n);switch(e){case"aalt":case"salt":return typeof t.by=="number"?this.addSingle(e,t,r,n):this.addAlternate(e,t,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,r,n);case"ccmp":return t.by instanceof Array?this.addMultiple(e,t,r,n):this.addLigature(e,t,r,n)}};function isBrowser(){return typeof window<"u"}function arrayBufferToNodeBuffer(e){for(var t=new Buffer(e.byteLength),r=new Uint8Array(e),n=0;n<t.length;++n)t[n]=r[n];return t}function checkArgument(e,t){if(!e)throw t}function parseGlyphCoordinate(e,t,r,n,i){var o;return(t&n)>0?(o=e.parseByte(),t&i||(o=-o),o=r+o):(t&i)>0?o=r:o=r+e.parseShort(),o}function parseGlyph(e,t,r){var n=new parse.Parser(t,r);e.numberOfContours=n.parseShort(),e._xMin=n.parseShort(),e._yMin=n.parseShort(),e._xMax=n.parseShort(),e._yMax=n.parseShort();var i,o;if(e.numberOfContours>0){for(var a=e.endPointIndices=[],s=0;s<e.numberOfContours;s+=1)a.push(n.parseUShort());e.instructionLength=n.parseUShort(),e.instructions=[];for(var u=0;u<e.instructionLength;u+=1)e.instructions.push(n.parseByte());var f=a[a.length-1]+1;i=[];for(var d=0;d<f;d+=1)if(o=n.parseByte(),i.push(o),(o&8)>0)for(var w=n.parseByte(),b=0;b<w;b+=1)i.push(o),d+=1;if(check.argument(i.length===f,"Bad flags."),a.length>0){var S=[],x;if(f>0){for(var m=0;m<f;m+=1)o=i[m],x={},x.onCurve=!!(o&1),x.lastPointOfContour=a.indexOf(m)>=0,S.push(x);for(var h=0,v=0;v<f;v+=1)o=i[v],x=S[v],x.x=parseGlyphCoordinate(n,o,h,2,16),h=x.x;for(var p=0,y=0;y<f;y+=1)o=i[y],x=S[y],x.y=parseGlyphCoordinate(n,o,p,4,32),p=x.y}e.points=S}else e.points=[]}else if(e.numberOfContours===0)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var E=!0;E;){i=n.parseUShort();var P={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(i&1)>0?(i&2)>0?(P.dx=n.parseShort(),P.dy=n.parseShort()):P.matchedPoints=[n.parseUShort(),n.parseUShort()]:(i&2)>0?(P.dx=n.parseChar(),P.dy=n.parseChar()):P.matchedPoints=[n.parseByte(),n.parseByte()],(i&8)>0?P.xScale=P.yScale=n.parseF2Dot14():(i&64)>0?(P.xScale=n.parseF2Dot14(),P.yScale=n.parseF2Dot14()):(i&128)>0&&(P.xScale=n.parseF2Dot14(),P.scale01=n.parseF2Dot14(),P.scale10=n.parseF2Dot14(),P.yScale=n.parseF2Dot14()),e.components.push(P),E=!!(i&32)}if(i&256){e.instructionLength=n.parseUShort(),e.instructions=[];for(var A=0;A<e.instructionLength;A+=1)e.instructions.push(n.parseByte())}}}function transformPoints(e,t){for(var r=[],n=0;n<e.length;n+=1){var i=e[n],o={x:t.xScale*i.x+t.scale01*i.y+t.dx,y:t.scale10*i.x+t.yScale*i.y+t.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};r.push(o)}return r}function getContours(e){for(var t=[],r=[],n=0;n<e.length;n+=1){var i=e[n];r.push(i),i.lastPointOfContour&&(t.push(r),r=[])}return check.argument(r.length===0,"There are still points left in the current contour."),t}function getPath(e){var t=new Path;if(!e)return t;for(var r=getContours(e),n=0;n<r.length;++n){var i=r[n],o=null,a=i[i.length-1],s=i[0];if(a.onCurve)t.moveTo(a.x,a.y);else if(s.onCurve)t.moveTo(s.x,s.y);else{var u={x:(a.x+s.x)*.5,y:(a.y+s.y)*.5};t.moveTo(u.x,u.y)}for(var f=0;f<i.length;++f)if(o=a,a=s,s=i[(f+1)%i.length],a.onCurve)t.lineTo(a.x,a.y);else{var d=s;o.onCurve||((a.x+o.x)*.5,(a.y+o.y)*.5),s.onCurve||(d={x:(a.x+s.x)*.5,y:(a.y+s.y)*.5}),t.quadraticCurveTo(a.x,a.y,d.x,d.y)}t.closePath()}return t}function buildPath(e,t){if(t.isComposite)for(var r=0;r<t.components.length;r+=1){var n=t.components[r],i=e.get(n.glyphIndex);if(i.getPath(),i.points){var o=void 0;if(n.matchedPoints===void 0)o=transformPoints(i.points,n);else{if(n.matchedPoints[0]>t.points.length-1||n.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+t.name);var a=t.points[n.matchedPoints[0]],s=i.points[n.matchedPoints[1]],u={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};s=transformPoints([s],u)[0],u.dx=a.x-s.x,u.dy=a.y-s.y,o=transformPoints(i.points,u)}t.points=t.points.concat(o)}}return getPath(t.points)}function parseGlyfTableAll(e,t,r,n){for(var i=new glyphset.GlyphSet(n),o=0;o<r.length-1;o+=1){var a=r[o],s=r[o+1];a!==s?i.push(o,glyphset.ttfGlyphLoader(n,o,parseGlyph,e,t+a,buildPath)):i.push(o,glyphset.glyphLoader(n,o))}return i}function parseGlyfTableOnLowMemory(e,t,r,n){var i=new glyphset.GlyphSet(n);return n._push=function(o){var a=r[o],s=r[o+1];a!==s?i.push(o,glyphset.ttfGlyphLoader(n,o,parseGlyph,e,t+a,buildPath)):i.push(o,glyphset.glyphLoader(n,o))},i}function parseGlyfTable(e,t,r,n,i){return i.lowMemory?parseGlyfTableOnLowMemory(e,t,r,n):parseGlyfTableAll(e,t,r,n)}var glyf={getPath,parse:parseGlyfTable},instructionTable,exec,execGlyph,execComponent;function Hinting(e){this.font=e,this.getCommands=function(t){return glyf.getPath(t).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function roundOff(e){return e}function roundToGrid(e){return Math.sign(e)*Math.round(Math.abs(e))}function roundToDoubleGrid(e){return Math.sign(e)*Math.round(Math.abs(e*2))/2}function roundToHalfGrid(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function roundUpToGrid(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function roundDownToGrid(e){return Math.sign(e)*Math.floor(Math.abs(e))}var roundSuper=function(e){var t=this.srPeriod,r=this.srPhase,n=this.srThreshold,i=1;return e<0&&(e=-e,i=-1),e+=n-r,e=Math.trunc(e/t)*t,e+=r,e<0?r*i:e*i},xUnitVector={x:1,y:0,axis:"x",distance:function(e,t,r,n){return(r?e.xo:e.x)-(n?t.xo:t.x)},interpolate:function(e,t,r,n){var i,o,a,s,u,f,d;if(!n||n===this){if(i=e.xo-t.xo,o=e.xo-r.xo,u=t.x-t.xo,f=r.x-r.xo,a=Math.abs(i),s=Math.abs(o),d=a+s,d===0){e.x=e.xo+(u+f)/2;return}e.x=e.xo+(u*s+f*a)/d;return}if(i=n.distance(e,t,!0,!0),o=n.distance(e,r,!0,!0),u=n.distance(t,t,!1,!0),f=n.distance(r,r,!1,!0),a=Math.abs(i),s=Math.abs(o),d=a+s,d===0){xUnitVector.setRelative(e,e,(u+f)/2,n,!0);return}xUnitVector.setRelative(e,e,(u*s+f*a)/d,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,r,n,i){if(!n||n===this){e.x=(i?t.xo:t.x)+r;return}var o=i?t.xo:t.x,a=i?t.yo:t.y,s=o+r*n.x,u=a+r*n.y;e.x=s+(e.y-u)/n.normalSlope},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},yUnitVector={x:0,y:1,axis:"y",distance:function(e,t,r,n){return(r?e.yo:e.y)-(n?t.yo:t.y)},interpolate:function(e,t,r,n){var i,o,a,s,u,f,d;if(!n||n===this){if(i=e.yo-t.yo,o=e.yo-r.yo,u=t.y-t.yo,f=r.y-r.yo,a=Math.abs(i),s=Math.abs(o),d=a+s,d===0){e.y=e.yo+(u+f)/2;return}e.y=e.yo+(u*s+f*a)/d;return}if(i=n.distance(e,t,!0,!0),o=n.distance(e,r,!0,!0),u=n.distance(t,t,!1,!0),f=n.distance(r,r,!1,!0),a=Math.abs(i),s=Math.abs(o),d=a+s,d===0){yUnitVector.setRelative(e,e,(u+f)/2,n,!0);return}yUnitVector.setRelative(e,e,(u*s+f*a)/d,n,!0)},normalSlope:0,setRelative:function(e,t,r,n,i){if(!n||n===this){e.y=(i?t.yo:t.y)+r;return}var o=i?t.xo:t.x,a=i?t.yo:t.y,s=o+r*n.x,u=a+r*n.y;e.y=u+n.normalSlope*(e.x-s)},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};Object.freeze(xUnitVector),Object.freeze(yUnitVector);function UnitVector(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}UnitVector.prototype.distance=function(e,t,r,n){return this.x*xUnitVector.distance(e,t,r,n)+this.y*yUnitVector.distance(e,t,r,n)},UnitVector.prototype.interpolate=function(e,t,r,n){var i,o,a,s,u,f,d;if(a=n.distance(e,t,!0,!0),s=n.distance(e,r,!0,!0),i=n.distance(t,t,!1,!0),o=n.distance(r,r,!1,!0),u=Math.abs(a),f=Math.abs(s),d=u+f,d===0){this.setRelative(e,e,(i+o)/2,n,!0);return}this.setRelative(e,e,(i*f+o*u)/d,n,!0)},UnitVector.prototype.setRelative=function(e,t,r,n,i){n=n||this;var o=i?t.xo:t.x,a=i?t.yo:t.y,s=o+r*n.x,u=a+r*n.y,f=n.normalSlope,d=this.slope,w=e.x,b=e.y;e.x=(d*w-f*s+u-b)/(d-f),e.y=d*(e.x-w)+b},UnitVector.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0};function getUnitVector(e,t){var r=Math.sqrt(e*e+t*t);return e/=r,t/=r,e===1&&t===0?xUnitVector:e===0&&t===1?yUnitVector:new UnitVector(e,t)}function HPoint(e,t,r,n){this.x=this.xo=Math.round(e*64)/64,this.y=this.yo=Math.round(t*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}HPoint.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},HPoint.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var HPZero=Object.freeze(new HPoint(0,0)),defaultState={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function State(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=xUnitVector,this.round=roundToGrid}}Hinting.prototype.exec=function(e,t){if(typeof t!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==t){var i=this._fpgmState;if(!i){State.prototype=defaultState,i=this._fpgmState=new State("fpgm",r.tables.fpgm),i.funcs=[],i.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),i.step=-1);try{exec(i)}catch(f){console.log("Hinting error in FPGM:"+f),this._errorState=3;return}}State.prototype=i,n=this._prepState=new State("prep",r.tables.prep),n.ppem=t;var o=r.tables.cvt;if(o)for(var a=n.cvt=new Array(o.length),s=t/r.unitsPerEm,u=0;u<o.length;u++)a[u]=o[u]*s;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{exec(n)}catch(f){this._errorState<2&&console.log("Hinting error in PREP:"+f),this._errorState=2}}if(!(this._errorState>1))try{return execGlyph(e,n)}catch(f){this._errorState<1&&(console.log("Hinting error:"+f),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},execGlyph=function(e,t){var r=t.ppem/t.font.unitsPerEm,n=r,i=e.components,o,a,s;if(State.prototype=t,!i)s=new State("glyf",e.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),s.step=-1),execComponent(e,s,r,n),a=s.gZone;else{var u=t.font;a=[],o=[];for(var f=0;f<i.length;f++){var d=i[f],w=u.glyphs.get(d.glyphIndex);s=new State("glyf",w.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+f+"---"),s.step=-1),execComponent(w,s,r,n);for(var b=Math.round(d.dx*r),S=Math.round(d.dy*n),x=s.gZone,m=s.contours,h=0;h<x.length;h++){var v=x[h];v.xTouched=v.yTouched=!1,v.xo=v.x=v.x+b,v.yo=v.y=v.y+S}var p=a.length;a.push.apply(a,x);for(var y=0;y<m.length;y++)o.push(m[y]+p)}e.instructions&&!s.inhibitGridFit&&(s=new State("glyf",e.instructions),s.gZone=s.z0=s.z1=s.z2=a,s.contours=o,a.push(new HPoint(0,0),new HPoint(Math.round(e.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),s.step=-1),exec(s),a.length-=2)}return a},execComponent=function(e,t,r,n){for(var i=e.points||[],o=i.length,a=t.gZone=t.z0=t.z1=t.z2=[],s=t.contours=[],u,f=0;f<o;f++)u=i[f],a[f]=new HPoint(u.x*r,u.y*n,u.lastPointOfContour,u.onCurve);for(var d,w,b=0;b<o;b++)u=a[b],d||(d=u,s.push(b)),u.lastPointOfContour?(u.nextPointOnContour=d,d.prevPointOnContour=u,d=void 0):(w=a[b+1],u.nextPointOnContour=w,w.prevPointOnContour=u);if(!t.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",t.stack);for(var S=0;S<o;S++)console.log(S,a[S].x,a[S].y)}if(a.push(new HPoint(0,0),new HPoint(Math.round(e.advanceWidth*r),0)),exec(t),a.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",t.stack);for(var x=0;x<o;x++)console.log(x,a[x].x,a[x].y)}}},exec=function(e){var t=e.prog;if(t){var r=t.length,n;for(e.ip=0;e.ip<r;e.ip++){if(exports.DEBUG&&e.step++,n=instructionTable[t[e.ip]],!n)throw new Error("unknown instruction: 0x"+Number(t[e.ip]).toString(16));n(e)}}};function initTZone(e){for(var t=e.tZone=new Array(e.gZone.length),r=0;r<t.length;r++)t[r]=new HPoint(0,0)}function skip(e,t){var r=e.prog,n=e.ip,i=1,o;do if(o=r[++n],o===88)i++;else if(o===89)i--;else if(o===64)n+=r[n+1]+1;else if(o===65)n+=2*r[n+1]+1;else if(o>=176&&o<=183)n+=o-176+1;else if(o>=184&&o<=191)n+=(o-184+1)*2;else if(t&&i===1&&o===27)break;while(i>0);e.ip=n}function SVTCA(e,t){exports.DEBUG&&console.log(t.step,"SVTCA["+e.axis+"]"),t.fv=t.pv=t.dpv=e}function SPVTCA(e,t){exports.DEBUG&&console.log(t.step,"SPVTCA["+e.axis+"]"),t.pv=t.dpv=e}function SFVTCA(e,t){exports.DEBUG&&console.log(t.step,"SFVTCA["+e.axis+"]"),t.fv=e}function SPVTL(e,t){var r=t.stack,n=r.pop(),i=r.pop(),o=t.z2[n],a=t.z1[i];exports.DEBUG&&console.log("SPVTL["+e+"]",n,i);var s,u;e?(s=o.y-a.y,u=a.x-o.x):(s=a.x-o.x,u=a.y-o.y),t.pv=t.dpv=getUnitVector(s,u)}function SFVTL(e,t){var r=t.stack,n=r.pop(),i=r.pop(),o=t.z2[n],a=t.z1[i];exports.DEBUG&&console.log("SFVTL["+e+"]",n,i);var s,u;e?(s=o.y-a.y,u=a.x-o.x):(s=a.x-o.x,u=a.y-o.y),t.fv=getUnitVector(s,u)}function SPVFS(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",r,n),e.pv=e.dpv=getUnitVector(n,r)}function SFVFS(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",r,n),e.fv=getUnitVector(n,r)}function GPV(e){var t=e.stack,r=e.pv;exports.DEBUG&&console.log(e.step,"GPV[]"),t.push(r.x*16384),t.push(r.y*16384)}function GFV(e){var t=e.stack,r=e.fv;exports.DEBUG&&console.log(e.step,"GFV[]"),t.push(r.x*16384),t.push(r.y*16384)}function SFVTPV(e){e.fv=e.pv,exports.DEBUG&&console.log(e.step,"SFVTPV[]")}function ISECT(e){var t=e.stack,r=t.pop(),n=t.pop(),i=t.pop(),o=t.pop(),a=t.pop(),s=e.z0,u=e.z1,f=s[r],d=s[n],w=u[i],b=u[o],S=e.z2[a];exports.DEBUG&&console.log("ISECT[], ",r,n,i,o,a);var x=f.x,m=f.y,h=d.x,v=d.y,p=w.x,y=w.y,E=b.x,P=b.y,A=(x-h)*(y-P)-(m-v)*(p-E),L=x*v-m*h,B=p*P-y*E;S.x=(L*(p-E)-B*(x-h))/A,S.y=(L*(y-P)-B*(m-v))/A}function SRP0(e){e.rp0=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)}function SRP1(e){e.rp1=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)}function SRP2(e){e.rp2=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)}function SZP0(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP0[]",t),e.zp0=t,t){case 0:e.tZone||initTZone(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP1(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP1[]",t),e.zp1=t,t){case 0:e.tZone||initTZone(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP2(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP2[]",t),e.zp2=t,t){case 0:e.tZone||initTZone(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZPS(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZPS[]",t),e.zp0=e.zp1=e.zp2=t,t){case 0:e.tZone||initTZone(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function SLOOP(e){e.loop=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)}function RTG(e){exports.DEBUG&&console.log(e.step,"RTG[]"),e.round=roundToGrid}function RTHG(e){exports.DEBUG&&console.log(e.step,"RTHG[]"),e.round=roundToHalfGrid}function SMD(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SMD[]",t),e.minDis=t/64}function ELSE(e){exports.DEBUG&&console.log(e.step,"ELSE[]"),skip(e,!1)}function JMPR(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"JMPR[]",t),e.ip+=t-1}function SCVTCI(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCVTCI[]",t),e.cvCutIn=t/64}function DUP(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DUP[]"),t.push(t[t.length-1])}function POP(e){exports.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function CLEAR(e){exports.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0}function SWAP(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"SWAP[]"),t.push(r),t.push(n)}function DEPTH(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DEPTH[]"),t.push(t.length)}function LOOPCALL(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"LOOPCALL[]",r,n);var i=e.ip,o=e.prog;e.prog=e.funcs[r];for(var a=0;a<n;a++)exec(e),exports.DEBUG&&console.log(++e.step,a+1<n?"next loopcall":"done loopcall",a);e.ip=i,e.prog=o}function CALL(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"CALL[]",t);var r=e.ip,n=e.prog;e.prog=e.funcs[t],exec(e),e.ip=r,e.prog=n,exports.DEBUG&&console.log(++e.step,"returning from",t)}function CINDEX(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"CINDEX[]",r),t.push(t[t.length-r])}function MINDEX(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"MINDEX[]",r),t.push(t.splice(t.length-r,1)[0])}function FDEF(e){if(e.env!=="fpgm")throw new Error("FDEF not allowed here");var t=e.stack,r=e.prog,n=e.ip,i=t.pop(),o=n;for(exports.DEBUG&&console.log(e.step,"FDEF[]",i);r[++n]!==45;);e.ip=n,e.funcs[i]=r.slice(o+1,n)}function MDAP(e,t){var r=t.stack.pop(),n=t.z0[r],i=t.fv,o=t.pv;exports.DEBUG&&console.log(t.step,"MDAP["+e+"]",r);var a=o.distance(n,HPZero);e&&(a=t.round(a)),i.setRelative(n,HPZero,a,o),i.touch(n),t.rp0=t.rp1=r}function IUP(e,t){var r=t.z2,n=r.length-2,i,o,a;exports.DEBUG&&console.log(t.step,"IUP["+e.axis+"]");for(var s=0;s<n;s++)i=r[s],!e.touched(i)&&(o=i.prevTouched(e),o!==i&&(a=i.nextTouched(e),o===a&&e.setRelative(i,i,e.distance(o,o,!1,!0),e,!0),e.interpolate(i,o,a,e)))}function SHP(e,t){for(var r=t.stack,n=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[n],o=t.fv,a=t.pv,s=t.loop,u=t.z2;s--;){var f=r.pop(),d=u[f],w=a.distance(i,i,!1,!0);o.setRelative(d,d,w,a),o.touch(d),exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-s)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",f)}t.loop=1}function SHC(e,t){var r=t.stack,n=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[n],o=t.fv,a=t.pv,s=r.pop(),u=t.z2[t.contours[s]],f=u;exports.DEBUG&&console.log(t.step,"SHC["+e+"]",s);var d=a.distance(i,i,!1,!0);do f!==i&&o.setRelative(f,f,d,a),f=f.nextPointOnContour;while(f!==u)}function SHZ(e,t){var r=t.stack,n=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[n],o=t.fv,a=t.pv,s=r.pop();exports.DEBUG&&console.log(t.step,"SHZ["+e+"]",s);var u;switch(s){case 0:u=t.tZone;break;case 1:u=t.gZone;break;default:throw new Error("Invalid zone")}for(var f,d=a.distance(i,i,!1,!0),w=u.length-2,b=0;b<w;b++)f=u[b],o.setRelative(f,f,d,a)}function SHPIX(e){for(var t=e.stack,r=e.loop,n=e.fv,i=t.pop()/64,o=e.z2;r--;){var a=t.pop(),s=o[a];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-r)+": ":"")+"SHPIX[]",a,i),n.setRelative(s,s,i),n.touch(s)}e.loop=1}function IP(e){for(var t=e.stack,r=e.rp1,n=e.rp2,i=e.loop,o=e.z0[r],a=e.z1[n],s=e.fv,u=e.dpv,f=e.z2;i--;){var d=t.pop(),w=f[d];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-i)+": ":"")+"IP[]",d,r,"<->",n),s.interpolate(w,o,a,u),s.touch(w)}e.loop=1}function MSIRP(e,t){var r=t.stack,n=r.pop()/64,i=r.pop(),o=t.z1[i],a=t.z0[t.rp0],s=t.fv,u=t.pv;s.setRelative(o,a,n,u),s.touch(o),exports.DEBUG&&console.log(t.step,"MSIRP["+e+"]",n,i),t.rp1=t.rp0,t.rp2=i,e&&(t.rp0=i)}function ALIGNRP(e){for(var t=e.stack,r=e.rp0,n=e.z0[r],i=e.loop,o=e.fv,a=e.pv,s=e.z1;i--;){var u=t.pop(),f=s[u];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-i)+": ":"")+"ALIGNRP[]",u),o.setRelative(f,n,0,a),o.touch(f)}e.loop=1}function RTDG(e){exports.DEBUG&&console.log(e.step,"RTDG[]"),e.round=roundToDoubleGrid}function MIAP(e,t){var r=t.stack,n=r.pop(),i=r.pop(),o=t.z0[i],a=t.fv,s=t.pv,u=t.cvt[n];exports.DEBUG&&console.log(t.step,"MIAP["+e+"]",n,"(",u,")",i);var f=s.distance(o,HPZero);e&&(Math.abs(f-u)<t.cvCutIn&&(f=u),f=t.round(f)),a.setRelative(o,HPZero,f,s),t.zp0===0&&(o.xo=o.x,o.yo=o.y),a.touch(o),t.rp0=t.rp1=i}function NPUSHB(e){var t=e.prog,r=e.ip,n=e.stack,i=t[++r];exports.DEBUG&&console.log(e.step,"NPUSHB[]",i);for(var o=0;o<i;o++)n.push(t[++r]);e.ip=r}function NPUSHW(e){var t=e.ip,r=e.prog,n=e.stack,i=r[++t];exports.DEBUG&&console.log(e.step,"NPUSHW[]",i);for(var o=0;o<i;o++){var a=r[++t]<<8|r[++t];a&32768&&(a=-((a^65535)+1)),n.push(a)}e.ip=t}function WS(e){var t=e.stack,r=e.store;r||(r=e.store=[]);var n=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"WS",n,i),r[i]=n}function RS(e){var t=e.stack,r=e.store,n=t.pop();exports.DEBUG&&console.log(e.step,"RS",n);var i=r&&r[n]||0;t.push(i)}function WCVTP(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"WCVTP",r,n),e.cvt[n]=r/64}function RCVT(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"RCVT",r),t.push(e.cvt[r]*64)}function GC(e,t){var r=t.stack,n=r.pop(),i=t.z2[n];exports.DEBUG&&console.log(t.step,"GC["+e+"]",n),r.push(t.dpv.distance(i,HPZero,e,!1)*64)}function MD(e,t){var r=t.stack,n=r.pop(),i=r.pop(),o=t.z1[n],a=t.z0[i],s=t.dpv.distance(a,o,e,e);exports.DEBUG&&console.log(t.step,"MD["+e+"]",n,i,"->",s),t.stack.push(Math.round(s*64))}function MPPEM(e){exports.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)}function FLIPON(e){exports.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0}function LT(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"LT[]",r,n),t.push(n<r?1:0)}function LTEQ(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"LTEQ[]",r,n),t.push(n<=r?1:0)}function GT(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"GT[]",r,n),t.push(n>r?1:0)}function GTEQ(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"GTEQ[]",r,n),t.push(n>=r?1:0)}function EQ(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"EQ[]",r,n),t.push(r===n?1:0)}function NEQ(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"NEQ[]",r,n),t.push(r!==n?1:0)}function ODD(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"ODD[]",r),t.push(Math.trunc(r)%2?1:0)}function EVEN(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"EVEN[]",r),t.push(Math.trunc(r)%2?0:1)}function IF(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"IF[]",t),t||(skip(e,!0),exports.DEBUG&&console.log(e.step,"EIF[]"))}function EIF(e){exports.DEBUG&&console.log(e.step,"EIF[]")}function AND(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"AND[]",r,n),t.push(r&&n?1:0)}function OR(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"OR[]",r,n),t.push(r||n?1:0)}function NOT(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"NOT[]",r),t.push(r?0:1)}function DELTAP123(e,t){var r=t.stack,n=r.pop(),i=t.fv,o=t.pv,a=t.ppem,s=t.deltaBase+(e-1)*16,u=t.deltaShift,f=t.z0;exports.DEBUG&&console.log(t.step,"DELTAP["+e+"]",n,r);for(var d=0;d<n;d++){var w=r.pop(),b=r.pop(),S=s+((b&240)>>4);if(S===a){var x=(b&15)-8;x>=0&&x++,exports.DEBUG&&console.log(t.step,"DELTAPFIX",w,"by",x*u);var m=f[w];i.setRelative(m,m,x*u,o)}}}function SDB(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"SDB[]",r),e.deltaBase=r}function SDS(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"SDS[]",r),e.deltaShift=Math.pow(.5,r)}function ADD(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"ADD[]",r,n),t.push(n+r)}function SUB(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"SUB[]",r,n),t.push(n-r)}function DIV(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"DIV[]",r,n),t.push(n*64/r)}function MUL(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"MUL[]",r,n),t.push(n*r/64)}function ABS(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"ABS[]",r),t.push(Math.abs(r))}function NEG(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"NEG[]",r),t.push(-r)}function FLOOR(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"FLOOR[]",r),t.push(Math.floor(r/64)*64)}function CEILING(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"CEILING[]",r),t.push(Math.ceil(r/64)*64)}function ROUND(e,t){var r=t.stack,n=r.pop();exports.DEBUG&&console.log(t.step,"ROUND[]"),r.push(t.round(n/64)*64)}function WCVTF(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"WCVTF[]",r,n),e.cvt[n]=r*e.ppem/e.font.unitsPerEm}function DELTAC123(e,t){var r=t.stack,n=r.pop(),i=t.ppem,o=t.deltaBase+(e-1)*16,a=t.deltaShift;exports.DEBUG&&console.log(t.step,"DELTAC["+e+"]",n,r);for(var s=0;s<n;s++){var u=r.pop(),f=r.pop(),d=o+((f&240)>>4);if(d===i){var w=(f&15)-8;w>=0&&w++;var b=w*a;exports.DEBUG&&console.log(t.step,"DELTACFIX",u,"by",b),t.cvt[u]+=b}}}function SROUND(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SROUND[]",t),e.round=roundSuper;var r;switch(t&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=r,t&48){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*r;break;case 32:e.srPhase=.5*r;break;case 48:e.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}t&=15,t===0?e.srThreshold=0:e.srThreshold=(t/8-.5)*r}function S45ROUND(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"S45ROUND[]",t),e.round=roundSuper;var r;switch(t&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=r,t&48){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*r;break;case 32:e.srPhase=.5*r;break;case 48:e.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}t&=15,t===0?e.srThreshold=0:e.srThreshold=(t/8-.5)*r}function ROFF(e){exports.DEBUG&&console.log(e.step,"ROFF[]"),e.round=roundOff}function RUTG(e){exports.DEBUG&&console.log(e.step,"RUTG[]"),e.round=roundUpToGrid}function RDTG(e){exports.DEBUG&&console.log(e.step,"RDTG[]"),e.round=roundDownToGrid}function SCANCTRL(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANCTRL[]",t)}function SDPVTL(e,t){var r=t.stack,n=r.pop(),i=r.pop(),o=t.z2[n],a=t.z1[i];exports.DEBUG&&console.log(t.step,"SDPVTL["+e+"]",n,i);var s,u;e?(s=o.y-a.y,u=a.x-o.x):(s=a.x-o.x,u=a.y-o.y),t.dpv=getUnitVector(s,u)}function GETINFO(e){var t=e.stack,r=t.pop(),n=0;exports.DEBUG&&console.log(e.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),t.push(n)}function ROLL(e){var t=e.stack,r=t.pop(),n=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"ROLL[]"),t.push(n),t.push(r),t.push(i)}function MAX(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"MAX[]",r,n),t.push(Math.max(n,r))}function MIN(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"MIN[]",r,n),t.push(Math.min(n,r))}function SCANTYPE(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANTYPE[]",t)}function INSTCTRL(e){var t=e.stack.pop(),r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"INSTCTRL[]",t,r),t){case 1:e.inhibitGridFit=!!r;return;case 2:e.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function PUSHB(e,t){var r=t.stack,n=t.prog,i=t.ip;exports.DEBUG&&console.log(t.step,"PUSHB["+e+"]");for(var o=0;o<e;o++)r.push(n[++i]);t.ip=i}function PUSHW(e,t){var r=t.ip,n=t.prog,i=t.stack;exports.DEBUG&&console.log(t.ip,"PUSHW["+e+"]");for(var o=0;o<e;o++){var a=n[++r]<<8|n[++r];a&32768&&(a=-((a^65535)+1)),i.push(a)}t.ip=r}function MDRP_MIRP(e,t,r,n,i,o){var a=o.stack,s=e&&a.pop(),u=a.pop(),f=o.rp0,d=o.z0[f],w=o.z1[u],b=o.minDis,S=o.fv,x=o.dpv,m,h,v,p;h=m=x.distance(w,d,!0,!0),v=h>=0?1:-1,h=Math.abs(h),e&&(p=o.cvt[s],n&&Math.abs(h-p)<o.cvCutIn&&(h=p)),r&&h<b&&(h=b),n&&(h=o.round(h)),S.setRelative(w,d,v*h,x),S.touch(w),exports.DEBUG&&console.log(o.step,(e?"MIRP[":"MDRP[")+(t?"M":"m")+(r?">":"_")+(n?"R":"_")+(i===0?"Gr":i===1?"Bl":i===2?"Wh":"")+"]",e?s+"("+o.cvt[s]+","+p+")":"",u,"(d =",m,"->",v*h,")"),o.rp1=o.rp0,o.rp2=u,t&&(o.rp0=u)}instructionTable=[SVTCA.bind(void 0,yUnitVector),SVTCA.bind(void 0,xUnitVector),SPVTCA.bind(void 0,yUnitVector),SPVTCA.bind(void 0,xUnitVector),SFVTCA.bind(void 0,yUnitVector),SFVTCA.bind(void 0,xUnitVector),SPVTL.bind(void 0,0),SPVTL.bind(void 0,1),SFVTL.bind(void 0,0),SFVTL.bind(void 0,1),SPVFS,SFVFS,GPV,GFV,SFVTPV,ISECT,SRP0,SRP1,SRP2,SZP0,SZP1,SZP2,SZPS,SLOOP,RTG,RTHG,SMD,ELSE,JMPR,SCVTCI,void 0,void 0,DUP,POP,CLEAR,SWAP,DEPTH,CINDEX,MINDEX,void 0,void 0,void 0,LOOPCALL,CALL,FDEF,void 0,MDAP.bind(void 0,0),MDAP.bind(void 0,1),IUP.bind(void 0,yUnitVector),IUP.bind(void 0,xUnitVector),SHP.bind(void 0,0),SHP.bind(void 0,1),SHC.bind(void 0,0),SHC.bind(void 0,1),SHZ.bind(void 0,0),SHZ.bind(void 0,1),SHPIX,IP,MSIRP.bind(void 0,0),MSIRP.bind(void 0,1),ALIGNRP,RTDG,MIAP.bind(void 0,0),MIAP.bind(void 0,1),NPUSHB,NPUSHW,WS,RS,WCVTP,RCVT,GC.bind(void 0,0),GC.bind(void 0,1),void 0,MD.bind(void 0,0),MD.bind(void 0,1),MPPEM,void 0,FLIPON,void 0,void 0,LT,LTEQ,GT,GTEQ,EQ,NEQ,ODD,EVEN,IF,EIF,AND,OR,NOT,DELTAP123.bind(void 0,1),SDB,SDS,ADD,SUB,DIV,MUL,ABS,NEG,FLOOR,CEILING,ROUND.bind(void 0,0),ROUND.bind(void 0,1),ROUND.bind(void 0,2),ROUND.bind(void 0,3),void 0,void 0,void 0,void 0,WCVTF,DELTAP123.bind(void 0,2),DELTAP123.bind(void 0,3),DELTAC123.bind(void 0,1),DELTAC123.bind(void 0,2),DELTAC123.bind(void 0,3),SROUND,S45ROUND,void 0,void 0,ROFF,void 0,RUTG,RDTG,POP,POP,void 0,void 0,void 0,void 0,void 0,SCANCTRL,SDPVTL.bind(void 0,0),SDPVTL.bind(void 0,1),GETINFO,void 0,ROLL,MAX,MIN,SCANTYPE,INSTCTRL,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,PUSHB.bind(void 0,1),PUSHB.bind(void 0,2),PUSHB.bind(void 0,3),PUSHB.bind(void 0,4),PUSHB.bind(void 0,5),PUSHB.bind(void 0,6),PUSHB.bind(void 0,7),PUSHB.bind(void 0,8),PUSHW.bind(void 0,1),PUSHW.bind(void 0,2),PUSHW.bind(void 0,3),PUSHW.bind(void 0,4),PUSHW.bind(void 0,5),PUSHW.bind(void 0,6),PUSHW.bind(void 0,7),PUSHW.bind(void 0,8),MDRP_MIRP.bind(void 0,0,0,0,0,0),MDRP_MIRP.bind(void 0,0,0,0,0,1),MDRP_MIRP.bind(void 0,0,0,0,0,2),MDRP_MIRP.bind(void 0,0,0,0,0,3),MDRP_MIRP.bind(void 0,0,0,0,1,0),MDRP_MIRP.bind(void 0,0,0,0,1,1),MDRP_MIRP.bind(void 0,0,0,0,1,2),MDRP_MIRP.bind(void 0,0,0,0,1,3),MDRP_MIRP.bind(void 0,0,0,1,0,0),MDRP_MIRP.bind(void 0,0,0,1,0,1),MDRP_MIRP.bind(void 0,0,0,1,0,2),MDRP_MIRP.bind(void 0,0,0,1,0,3),MDRP_MIRP.bind(void 0,0,0,1,1,0),MDRP_MIRP.bind(void 0,0,0,1,1,1),MDRP_MIRP.bind(void 0,0,0,1,1,2),MDRP_MIRP.bind(void 0,0,0,1,1,3),MDRP_MIRP.bind(void 0,0,1,0,0,0),MDRP_MIRP.bind(void 0,0,1,0,0,1),MDRP_MIRP.bind(void 0,0,1,0,0,2),MDRP_MIRP.bind(void 0,0,1,0,0,3),MDRP_MIRP.bind(void 0,0,1,0,1,0),MDRP_MIRP.bind(void 0,0,1,0,1,1),MDRP_MIRP.bind(void 0,0,1,0,1,2),MDRP_MIRP.bind(void 0,0,1,0,1,3),MDRP_MIRP.bind(void 0,0,1,1,0,0),MDRP_MIRP.bind(void 0,0,1,1,0,1),MDRP_MIRP.bind(void 0,0,1,1,0,2),MDRP_MIRP.bind(void 0,0,1,1,0,3),MDRP_MIRP.bind(void 0,0,1,1,1,0),MDRP_MIRP.bind(void 0,0,1,1,1,1),MDRP_MIRP.bind(void 0,0,1,1,1,2),MDRP_MIRP.bind(void 0,0,1,1,1,3),MDRP_MIRP.bind(void 0,1,0,0,0,0),MDRP_MIRP.bind(void 0,1,0,0,0,1),MDRP_MIRP.bind(void 0,1,0,0,0,2),MDRP_MIRP.bind(void 0,1,0,0,0,3),MDRP_MIRP.bind(void 0,1,0,0,1,0),MDRP_MIRP.bind(void 0,1,0,0,1,1),MDRP_MIRP.bind(void 0,1,0,0,1,2),MDRP_MIRP.bind(void 0,1,0,0,1,3),MDRP_MIRP.bind(void 0,1,0,1,0,0),MDRP_MIRP.bind(void 0,1,0,1,0,1),MDRP_MIRP.bind(void 0,1,0,1,0,2),MDRP_MIRP.bind(void 0,1,0,1,0,3),MDRP_MIRP.bind(void 0,1,0,1,1,0),MDRP_MIRP.bind(void 0,1,0,1,1,1),MDRP_MIRP.bind(void 0,1,0,1,1,2),MDRP_MIRP.bind(void 0,1,0,1,1,3),MDRP_MIRP.bind(void 0,1,1,0,0,0),MDRP_MIRP.bind(void 0,1,1,0,0,1),MDRP_MIRP.bind(void 0,1,1,0,0,2),MDRP_MIRP.bind(void 0,1,1,0,0,3),MDRP_MIRP.bind(void 0,1,1,0,1,0),MDRP_MIRP.bind(void 0,1,1,0,1,1),MDRP_MIRP.bind(void 0,1,1,0,1,2),MDRP_MIRP.bind(void 0,1,1,0,1,3),MDRP_MIRP.bind(void 0,1,1,1,0,0),MDRP_MIRP.bind(void 0,1,1,1,0,1),MDRP_MIRP.bind(void 0,1,1,1,0,2),MDRP_MIRP.bind(void 0,1,1,1,0,3),MDRP_MIRP.bind(void 0,1,1,1,1,0),MDRP_MIRP.bind(void 0,1,1,1,1,1),MDRP_MIRP.bind(void 0,1,1,1,1,2),MDRP_MIRP.bind(void 0,1,1,1,1,3)];function Token(e){this.char=e,this.state={},this.activeState=null}function ContextRange(e,t,r){this.contextName=r,this.startIndex=e,this.endOffset=t}function ContextChecker(e,t,r){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=r}function ContextParams(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function Event(e){this.eventId=e,this.subscribers=[]}function initializeCoreEvents(e){var t=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(i){Object.defineProperty(t.events,i,{value:new Event(i)})}),e&&r.forEach(function(i){var o=e[i];typeof o=="function"&&t.events[i].subscribe(o)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(i){t.events[i].subscribe(t.updateContextsRanges)})}function Tokenizer(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],initializeCoreEvents.call(this,e)}Token.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState},Token.prototype.getState=function(e){return this.state[e]||null},Tokenizer.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length},Tokenizer.prototype.composeRUD=function(e){var t=this,r=!0,n=e.map(function(o){return t[o[0]].apply(t,o.slice(1).concat(r))}),i=function(o){return typeof o=="object"&&o.hasOwnProperty("FAIL")};if(n.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(i)};this.dispatch("composeRUD",[n.filter(function(o){return!i(o)})])},Tokenizer.prototype.replaceRange=function(e,t,r,n){t=t!==null?t:this.tokens.length;var i=r.every(function(a){return a instanceof Token});if(!isNaN(e)&&this.inboundIndex(e)&&i){var o=this.tokens.splice.apply(this.tokens,[e,t].concat(r));return n||this.dispatch("replaceToken",[e,t,r]),[o,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Tokenizer.prototype.replaceToken=function(e,t,r){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof Token){var n=this.tokens.splice(e,1,t);return r||this.dispatch("replaceToken",[e,t]),[n[0],t]}else return{FAIL:"replaceToken: invalid token or index."}},Tokenizer.prototype.removeRange=function(e,t,r){t=isNaN(t)?this.tokens.length:t;var n=this.tokens.splice(e,t);return r||this.dispatch("removeRange",[n,e,t]),n},Tokenizer.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var r=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[r,e]),r}else return{FAIL:"removeToken: invalid token index."}},Tokenizer.prototype.insertToken=function(e,t,r){var n=e.every(function(i){return i instanceof Token});return n?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),r||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}},Tokenizer.prototype.registerModifier=function(e,t,r){this.events.newToken.subscribe(function(n,i){var o=[n,i],a=t===null||t.apply(this,o)===!0,s=[n,i];if(a){var u=r.apply(this,s);n.setState(e,u)}}),this.registeredModifiers.push(e)},Event.prototype.subscribe=function(e){return typeof e=="function"?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Event.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)},ContextParams.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)},ContextParams.prototype.get=function(e){switch(!0){case e===0:return this.current;case(e<0&&Math.abs(e)<=this.backtrack.length):return this.backtrack.slice(e)[0];case(e>0&&e<=this.lookahead.length):return this.lookahead[e-1];default:return null}},Tokenizer.prototype.rangeToText=function(e){if(e instanceof ContextRange)return this.getRangeTokens(e).map(function(t){return t.char}).join("")},Tokenizer.prototype.getText=function(){return this.tokens.map(function(e){return e.char}).join("")},Tokenizer.prototype.getContext=function(e){var t=this.registeredContexts[e];return t||null},Tokenizer.prototype.on=function(e,t){var r=this.events[e];return r?r.subscribe(t):null},Tokenizer.prototype.dispatch=function(e,t){var r=this,n=this.events[e];n instanceof Event&&n.subscribers.forEach(function(i){i.apply(r,t||[])})},Tokenizer.prototype.registerContextChecker=function(e,t,r){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if(typeof t!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new ContextChecker(e,t,r);return this.registeredContexts[e]=n,this.contextCheckers.push(n),n},Tokenizer.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))},Tokenizer.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}},Tokenizer.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];r.ranges=[]}},Tokenizer.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map(function(n){return n.char}),t=0;t<e.length;t++){var r=new ContextParams(e,t);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Tokenizer.prototype.setEndOffset=function(e,t){var r=this.getContext(t).openRange.startIndex,n=new ContextRange(r,e,t),i=this.getContext(t).ranges;return n.rangeId=t+"."+i.length,i.push(n),this.getContext(t).openRange=null,n},Tokenizer.prototype.runContextCheck=function(e){var t=this,r=e.index;this.contextCheckers.forEach(function(n){var i=n.contextName,o=t.getContext(i).openRange;if(!o&&n.checkStart(e)&&(o=new ContextRange(r,null,i),t.getContext(i).openRange=o,t.dispatch("contextStart",[i,r])),o&&n.checkEnd(e)){var a=r-o.startIndex+1,s=t.setEndOffset(a,i);t.dispatch("contextEnd",[i,s])}})},Tokenizer.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var r=0;r<t.length;r++){var n=t[r],i=new ContextParams(t,r);this.dispatch("next",[i]),this.runContextCheck(i);var o=new Token(n);this.tokens.push(o),this.dispatch("newToken",[o,i])}return this.dispatch("end",[this.tokens]),this.tokens};function isArabicChar(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function isIsolatedArabicChar(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function isTashkeelArabicChar(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function isLatinChar(e){return/[A-z]/.test(e)}function isWhiteSpace(e){return/\s/.test(e)}function FeatureQuery(e){this.font=e,this.features={}}function SubstitutionAction(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function lookupCoverage(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var r=t.ranges,n=0;n<r.length;n++){var i=r[n];if(e>=i.start&&e<=i.end){var o=e-i.start;return i.index+o}}break;default:return-1}return-1}function singleSubstitutionFormat1(e,t){var r=lookupCoverage(e,t.coverage);return r===-1?null:e+t.deltaGlyphId}function singleSubstitutionFormat2(e,t){var r=lookupCoverage(e,t.coverage);return r===-1?null:t.substitute[r]}function lookupCoverageList(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],o=t.current;o=Array.isArray(o)?o[0]:o;var a=lookupCoverage(o,i);a!==-1&&r.push(a)}return r.length!==e.length?-1:r}function chainingSubstitutionFormat3(e,t){var r=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<r)return[];var n=lookupCoverageList(t.inputCoverage,e);if(n===-1)return[];var i=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var o=e.lookahead.slice(i);o.length&&isTashkeelArabicChar(o[0].char);)o.shift();var a=new ContextParams(o,0),s=lookupCoverageList(t.lookaheadCoverage,a),u=[].concat(e.backtrack);for(u.reverse();u.length&&isTashkeelArabicChar(u[0].char);)u.shift();if(u.length<t.backtrackCoverage.length)return[];var f=new ContextParams(u,0),d=lookupCoverageList(t.backtrackCoverage,f),w=n.length===t.inputCoverage.length&&s.length===t.lookaheadCoverage.length&&d.length===t.backtrackCoverage.length,b=[];if(w)for(var S=0;S<t.lookupRecords.length;S++)for(var x=t.lookupRecords[S],m=x.lookupListIndex,h=this.getLookupByIndex(m),v=0;v<h.subtables.length;v++){var p=h.subtables[v],y=this.getLookupMethod(h,p),E=this.getSubstitutionType(h,p);if(E==="12")for(var P=0;P<n.length;P++){var A=e.get(P),L=y(A);L&&b.push(L)}}return b}function ligatureSubstitutionFormat1(e,t){var r=e.current,n=lookupCoverage(r,t.coverage);if(n===-1)return null;for(var i,o=t.ligatureSets[n],a=0;a<o.length;a++){i=o[a];for(var s=0;s<i.components.length;s++){var u=e.lookahead[s],f=i.components[s];if(u!==f)break;if(s===i.components.length-1)return i}}return null}function decompositionSubstitutionFormat1(e,t){var r=lookupCoverage(e,t.coverage);return r===-1?null:t.sequences[r]}FeatureQuery.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var r=e[t];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},FeatureQuery.prototype.getScriptFeaturesIndexes=function(e){var t=this.font.tables;if(!t.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var i=r[n];if(i.tag===e&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var o=i.langSysRecords;if(o)for(var a=0;a<o.length;a++){var s=o[a];if(s.tag===e){var u=s.langSys;return u.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},FeatureQuery.prototype.mapTagsToFeatures=function(e,t){for(var r={},n=0;n<e.length;n++){var i=e[n].tag,o=e[n].feature;r[i]=o}this.features[t].tags=r},FeatureQuery.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var r=this.getScriptFeaturesIndexes(e);if(!r)return null;var n=this.font.tables.gsub;return t=r.map(function(i){return n.features[i]}),this.features[e]=t,this.mapTagsToFeatures(t,e),t},FeatureQuery.prototype.getSubstitutionType=function(e,t){var r=e.lookupType.toString(),n=t.substFormat.toString();return r+n},FeatureQuery.prototype.getLookupMethod=function(e,t){var r=this,n=this.getSubstitutionType(e,t);switch(n){case"11":return function(i){return singleSubstitutionFormat1.apply(r,[i,t])};case"12":return function(i){return singleSubstitutionFormat2.apply(r,[i,t])};case"63":return function(i){return chainingSubstitutionFormat3.apply(r,[i,t])};case"41":return function(i){return ligatureSubstitutionFormat1.apply(r,[i,t])};case"21":return function(i){return decompositionSubstitutionFormat1.apply(r,[i,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}},FeatureQuery.prototype.lookupFeature=function(e){var t=e.contextParams,r=t.index,n=this.getFeature({tag:e.tag,script:e.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var i=this.getFeatureLookups(n),o=[].concat(t.context),a=0;a<i.length;a++)for(var s=i[a],u=this.getLookupSubtables(s),f=0;f<u.length;f++){var d=u[f],w=this.getSubstitutionType(s,d),b=this.getLookupMethod(s,d),S=void 0;switch(w){case"11":S=b(t.current),S&&o.splice(r,1,new SubstitutionAction({id:11,tag:e.tag,substitution:S}));break;case"12":S=b(t.current),S&&o.splice(r,1,new SubstitutionAction({id:12,tag:e.tag,substitution:S}));break;case"63":S=b(t),Array.isArray(S)&&S.length&&o.splice(r,1,new SubstitutionAction({id:63,tag:e.tag,substitution:S}));break;case"41":S=b(t),S&&o.splice(r,1,new SubstitutionAction({id:41,tag:e.tag,substitution:S}));break;case"21":S=b(t.current),S&&o.splice(r,1,new SubstitutionAction({id:21,tag:e.tag,substitution:S}));break}t=new ContextParams(o,r),!(Array.isArray(S)&&!S.length)&&(S=null)}return o.length?o:null},FeatureQuery.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var r=this.features[e.script].some(function(n){return n.tag===e.tag});return t&&r},FeatureQuery.prototype.getLookupSubtables=function(e){return e.subtables||null},FeatureQuery.prototype.getLookupByIndex=function(e){var t=this.font.tables.gsub.lookups;return t[e]||null},FeatureQuery.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))},FeatureQuery.prototype.getFeature=function(t){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(t.script)||this.getScriptFeatures(t.script);var r=this.features[t.script];return r?r.tags[t.tag]?this.features[t.script].tags[t.tag]:null:{FAIL:"No feature for script "+t.script}};function arabicWordStartCheck(e){var t=e.current,r=e.get(-1);return r===null&&isArabicChar(t)||!isArabicChar(r)&&isArabicChar(t)}function arabicWordEndCheck(e){var t=e.get(1);return t===null||!isArabicChar(t)}var arabicWordCheck={startCheck:arabicWordStartCheck,endCheck:arabicWordEndCheck};function arabicSentenceStartCheck(e){var t=e.current,r=e.get(-1);return(isArabicChar(t)||isTashkeelArabicChar(t))&&!isArabicChar(r)}function arabicSentenceEndCheck(e){var t=e.get(1);switch(!0){case t===null:return!0;case(!isArabicChar(t)&&!isTashkeelArabicChar(t)):var r=isWhiteSpace(t);if(!r)return!0;if(r){var n=!1;if(n=e.lookahead.some(function(i){return isArabicChar(i)||isTashkeelArabicChar(i)}),!n)return!0}break;default:return!1}}var arabicSentenceCheck={startCheck:arabicSentenceStartCheck,endCheck:arabicSentenceEndCheck};function singleSubstitutionFormat1$1(e,t,r){t[r].setState(e.tag,e.substitution)}function singleSubstitutionFormat2$1(e,t,r){t[r].setState(e.tag,e.substitution)}function chainingSubstitutionFormat3$1(e,t,r){e.substitution.forEach(function(n,i){var o=t[r+i];o.setState(e.tag,n)})}function ligatureSubstitutionFormat1$1(e,t,r){var n=t[r];n.setState(e.tag,e.substitution.ligGlyph);for(var i=e.substitution.components.length,o=0;o<i;o++)n=t[r+o+1],n.setState("deleted",!0)}var SUBSTITUTIONS={11:singleSubstitutionFormat1$1,12:singleSubstitutionFormat2$1,63:chainingSubstitutionFormat3$1,41:ligatureSubstitutionFormat1$1};function applySubstitution(e,t,r){e instanceof SubstitutionAction&&SUBSTITUTIONS[e.id]&&SUBSTITUTIONS[e.id](e,t,r)}function willConnectPrev(e){for(var t=[].concat(e.backtrack),r=t.length-1;r>=0;r--){var n=t[r],i=isIsolatedArabicChar(n),o=isTashkeelArabicChar(n);if(!i&&!o)return!0;if(i)return!1}return!1}function willConnectNext(e){if(isIsolatedArabicChar(e.current))return!1;for(var t=0;t<e.lookahead.length;t++){var r=e.lookahead[t],n=isTashkeelArabicChar(r);if(!n)return!0}return!1}function arabicPresentationForms(e){var t=this,r="arab",n=this.featuresTags[r],i=this.tokenizer.getRangeTokens(e);if(i.length!==1){var o=new ContextParams(i.map(function(s){return s.getState("glyphIndex")}),0),a=new ContextParams(i.map(function(s){return s.char}),0);i.forEach(function(s,u){if(!isTashkeelArabicChar(s.char)){o.setCurrentIndex(u),a.setCurrentIndex(u);var f=0;willConnectPrev(a)&&(f|=1),willConnectNext(a)&&(f|=2);var d;switch(f){case 1:d="fina";break;case 2:d="init";break;case 3:d="medi";break}if(n.indexOf(d)!==-1){var w=t.query.lookupFeature({tag:d,script:r,contextParams:o});if(w instanceof Error)return console.info(w.message);w.forEach(function(b,S){b instanceof SubstitutionAction&&(applySubstitution(b,i,S),o.context[S]=b.substitution)})}}})}}function getContextParams(e,t){var r=e.map(function(n){return n.activeState.value});return new ContextParams(r,t||0)}function arabicRequiredLigatures(e){var t=this,r="arab",n=this.tokenizer.getRangeTokens(e),i=getContextParams(n);i.context.forEach(function(o,a){i.setCurrentIndex(a);var s=t.query.lookupFeature({tag:"rlig",script:r,contextParams:i});s.length&&(s.forEach(function(u){return applySubstitution(u,n,a)}),i=getContextParams(n))})}function latinWordStartCheck(e){var t=e.current,r=e.get(-1);return r===null&&isLatinChar(t)||!isLatinChar(r)&&isLatinChar(t)}function latinWordEndCheck(e){var t=e.get(1);return t===null||!isLatinChar(t)}var latinWordCheck={startCheck:latinWordStartCheck,endCheck:latinWordEndCheck};function getContextParams$1(e,t){var r=e.map(function(n){return n.activeState.value});return new ContextParams(r,t||0)}function latinLigature(e){var t=this,r="latn",n=this.tokenizer.getRangeTokens(e),i=getContextParams$1(n);i.context.forEach(function(o,a){i.setCurrentIndex(a);var s=t.query.lookupFeature({tag:"liga",script:r,contextParams:i});s.length&&(s.forEach(function(u){return applySubstitution(u,n,a)}),i=getContextParams$1(n))})}function Bidi(e){this.baseDir=e||"ltr",this.tokenizer=new Tokenizer,this.featuresTags={}}Bidi.prototype.setText=function(e){this.text=e},Bidi.prototype.contextChecks={latinWordCheck,arabicWordCheck,arabicSentenceCheck};function registerContextChecker(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function tokenizeText(){return registerContextChecker.call(this,"latinWord"),registerContextChecker.call(this,"arabicWord"),registerContextChecker.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function reverseArabicSentences(){var e=this,t=this.tokenizer.getContextRanges("arabicSentence");t.forEach(function(r){var n=e.tokenizer.getRangeTokens(r);e.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}Bidi.prototype.registerFeatures=function(e,t){var r=this,n=t.filter(function(i){return r.query.supports({script:e,tag:i})});this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(n):this.featuresTags[e]=n},Bidi.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new FeatureQuery(e));for(var r=0;r<t.length;r++){var n=t[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},Bidi.prototype.registerModifier=function(e,t,r){this.tokenizer.registerModifier(e,t,r)};function checkGlyphIndexStatus(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function applyArabicPresentationForms(){var e=this,t="arab";if(this.featuresTags.hasOwnProperty(t)){checkGlyphIndexStatus.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){arabicPresentationForms.call(e,n)})}}function applyArabicRequireLigatures(){var e=this,t="arab";if(this.featuresTags.hasOwnProperty(t)){var r=this.featuresTags[t];if(r.indexOf("rlig")!==-1){checkGlyphIndexStatus.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(i){arabicRequiredLigatures.call(e,i)})}}}function applyLatinLigatures(){var e=this,t="latn";if(this.featuresTags.hasOwnProperty(t)){var r=this.featuresTags[t];if(r.indexOf("liga")!==-1){checkGlyphIndexStatus.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(i){latinLigature.call(e,i)})}}}Bidi.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)},Bidi.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(applyArabicPresentationForms.call(this),applyArabicRequireLigatures.call(this)),this.checkContextReady("latinWord")&&applyLatinLigatures.call(this),this.checkContextReady("arabicSentence")&&reverseArabicSentences.call(this)},Bidi.prototype.processText=function(e){(!this.text||this.text!==e)&&(this.setText(e),tokenizeText.call(this),this.applyFeaturesToContexts())},Bidi.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()},Bidi.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var i=n.activeState.value;t.push(Array.isArray(i)?i[0]:i)}}return t};function Font(e){e=e||{},e.tables=e.tables||{},e.empty||(checkArgument(e.familyName,"When creating a new Font object, familyName is required."),checkArgument(e.styleName,"When creating a new Font object, styleName is required."),checkArgument(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),checkArgument(e.ascender,"When creating a new Font object, ascender is required."),checkArgument(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new glyphset.GlyphSet(this,e.glyphs||[]),this.encoding=new DefaultEncoding(this),this.position=new Position(this),this.substitution=new Substitution(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Hinting(this)}})}Font.prototype.hasChar=function(e){return this.encoding.charToGlyphIndex(e)!==null},Font.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},Font.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Font.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map(function(t){return t.script==="latn"?{script:"latn",tags:t.tags.filter(function(r){return e[r]})}:t})},Font.prototype.stringToGlyphs=function(e,t){var r=this,n=new Bidi,i=function(w){return r.charToGlyphIndex(w.char)};n.registerModifier("glyphIndex",null,i);var o=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;n.applyFeatures(this,o);for(var a=n.getTextGlyphs(e),s=a.length,u=new Array(s),f=this.glyphs.get(0),d=0;d<s;d+=1)u[d]=this.glyphs.get(a[d])||f;return u},Font.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},Font.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Font.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},Font.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,e,t):this.kerningPairs[e+","+t]||0},Font.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Font.prototype.forEachGlyph=function(e,t,r,n,i,o){t=t!==void 0?t:0,r=r!==void 0?r:0,n=n!==void 0?n:72,i=Object.assign({},this.defaultRenderOptions,i);var a=1/this.unitsPerEm*n,s=this.stringToGlyphs(e,i),u;if(i.kerning){var f=i.script||this.position.getDefaultScriptName();u=this.position.getKerningTables(f,i.language)}for(var d=0;d<s.length;d+=1){var w=s[d];if(o.call(this,w,t,r,n,i),w.advanceWidth&&(t+=w.advanceWidth*a),i.kerning&&d<s.length-1){var b=u?this.position.getKerningValue(u,w.index,s[d+1].index):this.getKerningValue(w,s[d+1]);t+=b*a}i.letterSpacing?t+=i.letterSpacing*n:i.tracking&&(t+=i.tracking/1e3*n)}return t},Font.prototype.getPath=function(e,t,r,n,i){var o=new Path;return this.forEachGlyph(e,t,r,n,i,function(a,s,u,f){var d=a.getPath(s,u,f,i,this);o.extend(d)}),o},Font.prototype.getPaths=function(e,t,r,n,i){var o=[];return this.forEachGlyph(e,t,r,n,i,function(a,s,u,f){var d=a.getPath(s,u,f,i,this);o.push(d)}),o},Font.prototype.getAdvanceWidth=function(e,t,r){return this.forEachGlyph(e,0,0,t,r,function(){})},Font.prototype.draw=function(e,t,r,n,i,o){this.getPath(t,r,n,i,o).draw(e)},Font.prototype.drawPoints=function(e,t,r,n,i,o){this.forEachGlyph(t,r,n,i,o,function(a,s,u,f){a.drawPoints(e,s,u,f)})},Font.prototype.drawMetrics=function(e,t,r,n,i,o){this.forEachGlyph(t,r,n,i,o,function(a,s,u,f){a.drawMetrics(e,s,u,f)})},Font.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},Font.prototype.validate=function(){var e=this;function t(n,i){}function r(n){var i=e.getEnglishName(n);i&&i.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},Font.prototype.toTables=function(){return sfnt.fontToTable(this)},Font.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Font.prototype.toArrayBuffer=function(){for(var e=this.toTables(),t=e.encode(),r=new ArrayBuffer(t.length),n=new Uint8Array(r),i=0;i<t.length;i++)n[i]=t[i];return r},Font.prototype.download=function(e){var t=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");e=e||t.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(isBrowser())if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(n),o=new Blob([i],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.download=e;var s=document.createEvent("MouseEvents");s.initEvent("click",!0,!1),a.dispatchEvent(s)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var u=require("fs"),f=arrayBufferToNodeBuffer(n);u.writeFileSync(e,f)}},Font.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Font.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Font.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var subtableParsers$1=new Array(10);subtableParsers$1[1]=function(){var t=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(Parser.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(Parser.coverage),values:this.parseValueRecordList()};check.assert(!1,"0x"+t.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},subtableParsers$1[2]=function(){var t=this.offset+this.relativeOffset,r=this.parseUShort();check.assert(r===1||r===2,"0x"+t.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(Parser.coverage),i=this.parseUShort(),o=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:o,pairSets:this.parseList(Parser.pointer(Parser.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(o)}})))};if(r===2){var a=this.parsePointer(Parser.classDef),s=this.parsePointer(Parser.classDef),u=this.parseUShort(),f=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:i,valueFormat2:o,classDef1:a,classDef2:s,class1Count:u,class2Count:f,classRecords:this.parseList(u,Parser.list(f,function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(o)}}))}}},subtableParsers$1[3]=function(){return{error:"GPOS Lookup 3 not supported"}},subtableParsers$1[4]=function(){return{error:"GPOS Lookup 4 not supported"}},subtableParsers$1[5]=function(){return{error:"GPOS Lookup 5 not supported"}},subtableParsers$1[6]=function(){return{error:"GPOS Lookup 6 not supported"}},subtableParsers$1[7]=function(){return{error:"GPOS Lookup 7 not supported"}},subtableParsers$1[8]=function(){return{error:"GPOS Lookup 8 not supported"}},subtableParsers$1[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);const PROJECTION_PLANES={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function lookFromPlane(e){const{dir:t,xAxis:r}=PROJECTION_PLANES[e];return new ProjectionCamera([0,0,0],t,r)}function defaultXDir(e){const t=new Vector(e);let r=new Vector([0,0,1]),n=r.cross(t);return n.Length===0&&(r=new Vector([0,1,0]),n=r.cross(t)),n.normalize()}class ProjectionCamera extends WrappingObj{constructor(t=[0,0,0],r=[0,0,1],n){const i=n?new Vector(n):defaultXDir(r),o=makeAx2(t,r,i);super(o)}get position(){return new Vector(this.wrapped.Location())}get direction(){return new Vector(this.wrapped.Direction())}get xAxis(){return new Vector(this.wrapped.XDirection())}get yAxis(){return new Vector(this.wrapped.YDirection())}autoAxes(){const t=defaultXDir(this.direction);this.wrapped.SetXDirection(asDir(t))}setPosition(t){return this.wrapped.SetLocation(asPnt(t)),this}setXAxis(t){return this.wrapped.SetYDirection(asDir(t)),this}setYAxis(t){return this.wrapped.SetYDirection(asDir(t)),this}lookAt(t){const r=new Vector("boundingBox"in t?t.boundingBox.center:t),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const getEdges=e=>e.IsNull()?[]:cast(e).edges;function makeProjectedEdges(e,t,r=!0){const n=getOC(),i=GCWithScope(),o=i(new n.HLRBRep_Algo_1);o.Add_2(e.wrapped,0);const a=i(new n.HLRAlgo_Projector_2(t.wrapped));o.Projector_1(a),o.Update(),o.Hide_1();const s=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(o)),u=[...getEdges(s.VCompound_1()),...getEdges(s.Rg1LineVCompound_1()),...getEdges(s.OutLineVCompound_1())];u.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped));const f=r?[...getEdges(s.HCompound_1()),...getEdges(s.Rg1LineHCompound_1()),...getEdges(s.OutLineHCompound_1())]:[];return f.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped)),{visible:u,hidden:f}}const PRECISION=1e-8,samePoint=(e,t)=>samePoint$2(e,t,PRECISION*10);function rawOffsets(e,t){const r=e.orientation==="clockwise"?-t:t,n=e.curves.map(f=>({offset:make2dOffset(f,r),original:f})),i=[];let o=null,a=n.at(-1);if(!a)return[];if(i.length===1)return i;const s=f=>{o?f.offset instanceof Curve2D?i.push(f.offset):samePoint(f.offset.firstPoint,f.offset.lastPoint)||i.push(make2dSegmentCurve(f.offset.firstPoint,f.offset.lastPoint)):o=f},u=function*(){for(const f of n.slice(0,-1))yield f;if(!o)throw new Error("Bug in the offset algorithm");yield o};for(const f of u()){const d=a.offset.lastPoint,w=f.offset.firstPoint;if(samePoint(d,w)){s(a),a=f;continue}let b=[];if(a.offset instanceof Curve2D&&f.offset instanceof Curve2D){const{intersections:x,commonSegmentsPoints:m}=intersectCurves(a.offset,f.offset,PRECISION/100);b=[...x,...m]}if(b.length>0){let x=b[0];if(b.length>1){const v=a==null?void 0:a.original.lastPoint,p=b.map(y=>squareDistance2d(y,v));x=b[p.indexOf(Math.min(...p))]}const m=a.offset.splitAt([x],PRECISION)[0],h=f.offset.splitAt([x],PRECISION).at(-1);if(!h)throw new Error("Bug in the splitting algo in offset");s({offset:m,original:a.original}),a={offset:h,original:f.original};continue}const S=make2dArcFromCenter(d,w,a.original.lastPoint);s(a),i.push(S),a=f}return s(a),i}function offsetBlueprint(e,t){const r=rawOffsets(e,t);if(r.length<2)return null;const n=new Map,i=(f,d)=>{const w=n.get(f)||[];n.set(f,[...w,...d])};if(r.forEach((f,d)=>{r.slice(d+1).forEach((w,b)=>{const{intersections:S,commonSegmentsPoints:x}=intersectCurves(f,w,PRECISION),m=[...S,...x].filter(h=>{const v=samePoint(h,f.firstPoint)||samePoint(h,f.lastPoint),p=samePoint(h,w.firstPoint)||samePoint(h,w.lastPoint);return!(v&&p)});m.length&&(i(d,m),i(b+d+1,m))})}),!n.size){const f=new Blueprint(r);return e.intersects(f)?null:f}const a=r.flatMap((f,d)=>{if(!n.has(d))return f;const w=n.get(d)||[];return f.splitAt(w,PRECISION*100)}).filter(f=>!e.curves.find(w=>w.distanceFrom(f)<Math.abs(t)-PRECISION));if(!a.length)return null;const u=stitchCurves(a).filter(f=>f.length>1).map(f=>new Blueprint(f)).filter(f=>f.isClosed());return u.length?u.length===1?u[0]:new Blueprints(u):null}const fuseAll=e=>{let t=e[0];for(let r=1;r<e.length;r++)t=fuse2D(t,e[r]);return t};function offset(e,t){if(e instanceof Blueprint)return offsetBlueprint(e,t);if(e instanceof Blueprints)return fuseAll(e.blueprints.map(r=>offset(r,t)));if(e instanceof CompoundBlueprint){const r=fuseAll(e.blueprints.slice(1).map(n=>offset(n,t)));return cut2D(offset(e.blueprints[0],t),r)}return null}function modifyCorners(e,t,r,n){let i=()=>!0;n&&(i=n.shouldKeep.bind(n));const o=[t.curves[0]],a=(u,f)=>{i({firstCurve:u,secondCurve:f,point:u.lastPoint})?o.push(...e(u,f,r)):o.push(u,f)};t.curves.slice(1).forEach(u=>{const f=o.pop();if(!f)throw new Error("Bug in the blueprint filletting algo");a(f,u)});const s=o.at(-1);if(!s)throw new Error("Bug in the blueprint corner algo");if(samePoint$2(o[0].firstPoint,s.lastPoint)&&o.length>1){const u=o.pop(),f=o.shift();if(!u||!f)throw new Error("Bug in the blueprint filletting algo");a(u,f)}return new Blueprint(o)}function modifyCorner2D(e,t,r,n){if(t instanceof Blueprint)return modifyCorners(e,t,r,n);if(t instanceof CompoundBlueprint)return new CompoundBlueprint(t.blueprints.map(i=>modifyCorners(e,i,r,n)));if(t instanceof Blueprints){const i=t.blueprints.map(o=>modifyCorner2D(e,o,r,n)).filter(o=>o!==null);return new Blueprints(i)}return null}function fillet2D(e,t,r){return modifyCorner2D(filletCurves,e,t,r)}function chamfer2D(e,t,r){return modifyCorner2D(chamferCurves,e,t,r)}function approximateForSVG(e,t){return e instanceof Blueprint?new Blueprint(approximateAsSvgCompatibleCurve(e.curves,t)):e instanceof CompoundBlueprint?new CompoundBlueprint(e.blueprints.map(r=>approximateForSVG(r,t))):e instanceof Blueprints?new Blueprints(e.blueprints.map(r=>approximateForSVG(r,t))):e}class Drawing{constructor(t=null){this.innerShape=t}clone(){var t;return new Drawing(((t=this.innerShape)==null?void 0:t.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new BoundingBox2d}stretch(t,r,n){return this.innerShape?new Drawing(this.innerShape.stretch(t,r,n)):new Drawing}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(t,r){return this.innerShape?new Drawing(this.innerShape.rotate(t,r)):new Drawing}translate(t,r=0){return this.innerShape?new Drawing(this.innerShape.translate(t,r)):new Drawing}scale(t,r){return this.innerShape?new Drawing(this.innerShape.scale(t,r)):new Drawing}mirror(t,r,n){return this.innerShape?new Drawing(this.innerShape.mirror(t,r,n)):new Drawing}cut(t){return new Drawing(cut2D(this.innerShape,t.innerShape))}fuse(t){return new Drawing(fuse2D(this.innerShape,t.innerShape))}intersect(t){return new Drawing(intersect2D(this.innerShape,t.innerShape))}fillet(t,r){const n=r&&r(new CornerFinder);return new Drawing(fillet2D(this.innerShape,t,n))}chamfer(t,r){const n=r&&r(new CornerFinder);return new Drawing(chamfer2D(this.innerShape,t,n))}sketchOnPlane(t,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(t,r)}sketchOnFace(t,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(t,r)}toSVG(t){var r;return((r=this.innerShape)==null?void 0:r.toSVG(t))||""}toSVGViewBox(t=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(t))||""}toSVGPaths(){var t;return((t=this.innerShape)==null?void 0:t.toSVGPaths())||[]}offset(t){return new Drawing(offset(this.innerShape,t))}approximate(t,r={}){if(t!=="svg")throw new Error("Only 'svg' is supported for now");return new Drawing(approximateForSVG(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof Blueprint)){if(this.innerShape instanceof Blueprints&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof Blueprint)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}function drawRoundedRectangle(e,t,r=0){return new Drawing(roundedRectangleBlueprint(e,t,r))}const drawRectangle=drawRoundedRectangle,edgesToDrawing=e=>{const t=drawRectangle(1e3,1e3).sketchOnPlane().face(),r=e.map(i=>edgeToCurve(i,t)),n=stitchCurves(r).map(i=>new Blueprint(i));return n.length===0?new Drawing:n.length===1?new Drawing(n[0]):new Drawing(new Blueprints(n))};function drawProjection(e,t="front"){let r;t instanceof ProjectionCamera?r=t:r=lookFromPlane(t);const{visible:n,hidden:i}=makeProjectedEdges(e,r);return{visible:edgesToDrawing(n),hidden:edgesToDrawing(i)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),finalizer=Symbol("Comlink.finalizer"),throwMarker=Symbol("Comlink.thrown"),isObject=e=>typeof e=="object"&&e!==null||typeof e=="function",proxyTransferHandler={canHandle:e=>isObject(e)&&e[proxyMarker],serialize(e){const{port1:t,port2:r}=new MessageChannel;return expose(e,t),[r,[r]]},deserialize(e){return e.start(),wrap(e)}},throwTransferHandler={canHandle:e=>isObject(e)&&throwMarker in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},transferHandlers=new Map([["proxy",proxyTransferHandler],["throw",throwTransferHandler]]);function isAllowedOrigin(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function expose(e,t=globalThis,r=["*"]){t.addEventListener("message",function n(i){if(!i||!i.data)return;if(!isAllowedOrigin(r,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:a,path:s}=Object.assign({path:[]},i.data),u=(i.data.argumentList||[]).map(fromWireValue);let f;try{const d=s.slice(0,-1).reduce((b,S)=>b[S],e),w=s.reduce((b,S)=>b[S],e);switch(a){case"GET":f=w;break;case"SET":d[s.slice(-1)[0]]=fromWireValue(i.data.value),f=!0;break;case"APPLY":f=w.apply(d,u);break;case"CONSTRUCT":{const b=new w(...u);f=proxy(b)}break;case"ENDPOINT":{const{port1:b,port2:S}=new MessageChannel;expose(e,S),f=transfer(b,[b])}break;case"RELEASE":f=void 0;break;default:return}}catch(d){f={value:d,[throwMarker]:0}}Promise.resolve(f).catch(d=>({value:d,[throwMarker]:0})).then(d=>{const[w,b]=toWireValue(d);t.postMessage(Object.assign(Object.assign({},w),{id:o}),b),a==="RELEASE"&&(t.removeEventListener("message",n),closeEndPoint(t),finalizer in e&&typeof e[finalizer]=="function"&&e[finalizer]())}).catch(d=>{const[w,b]=toWireValue({value:new TypeError("Unserializable return value"),[throwMarker]:0});t.postMessage(Object.assign(Object.assign({},w),{id:o}),b)})}),t.start&&t.start()}function isMessagePort(e){return e.constructor.name==="MessagePort"}function closeEndPoint(e){isMessagePort(e)&&e.close()}function wrap(e,t){const r=new Map;return e.addEventListener("message",function(i){const{data:o}=i;if(!o||!o.id)return;const a=r.get(o.id);if(a)try{a(o)}finally{r.delete(o.id)}}),createProxy(e,r,[],t)}function throwIfProxyReleased(e){if(e)throw new Error("Proxy has been released and is not useable")}function releaseEndpoint(e){return requestResponseMessage(e,new Map,{type:"RELEASE"}).then(()=>{closeEndPoint(e)})}const proxyCounter=new WeakMap,proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(proxyCounter.get(e)||0)-1;proxyCounter.set(e,t),t===0&&releaseEndpoint(e)});function registerProxy(e,t){const r=(proxyCounter.get(t)||0)+1;proxyCounter.set(t,r),proxyFinalizers&&proxyFinalizers.register(e,t,e)}function unregisterProxy(e){proxyFinalizers&&proxyFinalizers.unregister(e)}function createProxy(e,t,r=[],n=function(){}){let i=!1;const o=new Proxy(n,{get(a,s){if(throwIfProxyReleased(i),s===releaseProxy)return()=>{unregisterProxy(o),releaseEndpoint(e),t.clear(),i=!0};if(s==="then"){if(r.length===0)return{then:()=>o};const u=requestResponseMessage(e,t,{type:"GET",path:r.map(f=>f.toString())}).then(fromWireValue);return u.then.bind(u)}return createProxy(e,t,[...r,s])},set(a,s,u){throwIfProxyReleased(i);const[f,d]=toWireValue(u);return requestResponseMessage(e,t,{type:"SET",path:[...r,s].map(w=>w.toString()),value:f},d).then(fromWireValue)},apply(a,s,u){throwIfProxyReleased(i);const f=r[r.length-1];if(f===createEndpoint)return requestResponseMessage(e,t,{type:"ENDPOINT"}).then(fromWireValue);if(f==="bind")return createProxy(e,t,r.slice(0,-1));const[d,w]=processArguments(u);return requestResponseMessage(e,t,{type:"APPLY",path:r.map(b=>b.toString()),argumentList:d},w).then(fromWireValue)},construct(a,s){throwIfProxyReleased(i);const[u,f]=processArguments(s);return requestResponseMessage(e,t,{type:"CONSTRUCT",path:r.map(d=>d.toString()),argumentList:u},f).then(fromWireValue)}});return registerProxy(o,e),o}function myFlat(e){return Array.prototype.concat.apply([],e)}function processArguments(e){const t=e.map(toWireValue);return[t.map(r=>r[0]),myFlat(t.map(r=>r[1]))]}const transferCache=new WeakMap;function transfer(e,t){return transferCache.set(e,t),e}function proxy(e){return Object.assign(e,{[proxyMarker]:!0})}function toWireValue(e){for(const[t,r]of transferHandlers)if(r.canHandle(e)){const[n,i]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},i]}return[{type:"RAW",value:e},transferCache.get(e)||[]]}function fromWireValue(e){switch(e.type){case"HANDLER":return transferHandlers.get(e.name).deserialize(e.value);case"RAW":return e.value}}function requestResponseMessage(e,t,r,n){return new Promise(i=>{const o=generateUUID();t.set(o,i),e.start&&e.start(),e.postMessage(Object.assign({id:o},r),n)})}function generateUUID(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function isNumber(e,t){return typeof e!="number"||isNaN(e)?{valid:!1,message:`Parameter '${t}' must be a number`}:{valid:!0}}function isGreaterThanZero(e,t){return e<=0?{valid:!1,message:`Parameter '${t}' must be positive`}:{valid:!0}}function isLessThan(e,t,r){return e>=t?{valid:!1,message:`${r} (${e}) must be less than ${t}`}:{valid:!0}}function isPositive(e,t){const r=isNumber(e,t);return r.valid?isGreaterThanZero(e,t):r}function lessThan(e,t,r){const n=isNumber(e,r);return n.valid?isLessThan(e,t,r):n}function validateAll(e,t){return r=>{const n=[];for(const i of t){const o=e(r[i],i);o.valid||n.push(o.message)}return{valid:n.length===0,errors:n}}}function validateLessThan(e,t){return r=>{const n=r[e],i=r[t],o=lessThan(n,i,e);return o.valid?{valid:!0,errors:[]}:{valid:!1,errors:[o.message]}}}function validateModelParams(e,t){let r=!0;const n=[];if(t.params)for(const i of t.params){const{name:o,validators:a}=i;if(!a)continue;const s=e[o];for(const u of a){const f=u(s,o);if(!f.valid){r=!1,n.push(f.message);break}}}if(t.validators)for(const i of t.validators){const o=i(e);o.valid||(r=!1,n.push(...o.errors))}return{valid:r,errors:n}}function createCuboid({width:e=100,depth:t=100,height:r=100}){if(e===0&&t===0&&r===0)return makeBox([0,0,0],[1e-7,1e-7,1e-7]);const n=e/2,i=t/2;return makeBox([-n,-i,0],[n,i,r])}const cuboidModel={name:"Cuboid",create:createCuboid,params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],validators:[validateAll(isPositive,["width","depth","height"])],hasExplosion:!1};function createSphere({radius:e=50}){return makeSphere(e)}const sphereModel={name:"Sphere",create:createSphere,params:[{name:"radius",defaultValue:50}],validators:[validateAll(isPositive,["radius"])],hasExplosion:!1};function createCylinder({radius:e=50,height:t=100}){return makeCylinder(e,t,[0,0,0],[0,0,-1])}const cylinderModel={name:"Cylinder",create:createCylinder,params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],validators:[validateAll(isPositive,["radius","height"])],hasExplosion:!1};function createEllipsoid({aLength:e=80,bLength:t=50,cLength:r=30}){return makeEllipsoid(e,t,r)}const ellipsoidModel={name:"Ellipsoid",create:createEllipsoid,params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],validators:[validateAll(isPositive,["aLength","bLength","cLength"])],hasExplosion:!1},centerSelector=e=>e.boundingBox.center;function placeModelsAtPoints(e,t,r){return r.map(({position:n,direction:i,orientation:o})=>{const a=e(),s=t(a);let u=a.translate([n[0]-s[0],n[1]-s[1],n[2]-s[2]]);const f=[0,0,1],d=new Vector(o||i);if(d.Length>0){const w=new Vector(f).cross(d);if(w.Length>1e-10){const b=new Vector(f).getAngle(d);u=u.rotate(b,n,w)}else d.dot(new Vector(f))<0&&(u=u.rotate(180,n,[1,0,0]))}return u})}function createRectangularGrid(e,t,r,n,i,o=0,a=0,s=1){const u=new Vector([o,a,s]).normalized();return Array.from({length:t*r},(f,d)=>{const w=Math.floor(d/r),S=d%r*n,x=w*i,h=new Plane(new Vector(e.origin),new Vector(e.xDirection).normalized(),new Vector(e.normal).normalized()).toWorldCoords([S,x,0]);return{position:[h.x,h.y,h.z],direction:[e.normal[0],e.normal[1],e.normal[2]],orientation:[u.x,u.y,u.z]}})}function createLinearPattern(e,t,r,n=0,i=0,o=1){return createRectangularGrid({origin:e,xDirection:t,normal:(()=>{const a=new Vector(t),s=new Vector([0,0,1]),u=Math.abs(a.normalized().dot(s))>.99?new Vector([1,0,0]):a.cross(s).normalized();return[u.x,u.y,u.z]})()},1,r,r>1?new Vector(t).Length/(r-1):0,0,n,i,o)}function createLinearCuboidPattern({count:e=5,vectorX:t=0,vectorY:r=50,vectorZ:n=50,originX:i=0,originY:o=0,originZ:a=0,boxWidth:s=10,boxDepth:u=10,boxHeight:f=10,orientationX:d=0,orientationY:w=0,orientationZ:b=1}){return compoundShapes(placeModelsAtPoints(()=>createCuboid({width:s,depth:u,height:f}),centerSelector,createLinearPattern([i,o,a],[t,r,n],e,d,w,b)))}const linearCuboidPatternModel={name:"DiagonalCuboidPattern",create:createLinearCuboidPattern,params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[validateAll(isPositive,["count","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function createRectangularCuboidGrid({originX:e=0,originY:t=0,originZ:r=0,directionX:n=1,directionY:i=0,directionZ:o=0,normalX:a=0,normalY:s=0,normalZ:u=1,rowCount:f=3,colCount:d=3,xSpacing:w=30,ySpacing:b=30,boxWidth:S=10,boxDepth:x=10,boxHeight:m=10,orientationX:h=0,orientationY:v=0,orientationZ:p=1}){return compoundShapes(placeModelsAtPoints(()=>createCuboid({width:S,depth:x,height:m}),centerSelector,createRectangularGrid({origin:[e,t,r],xDirection:[n,i,o],normal:[a,s,u]},f,d,w,b,h,v,p)))}const rectangularCuboidGridModel={name:"RectangularCuboidGrid",create:createRectangularCuboidGrid,params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[validateAll(isPositive,["rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function createLProfile({depth:e=100,flangeXLenght:t=50,flangeYLenght:r=50,thickness:n=5}){const i=makeBox([0,-e/2,0],[t,e/2,n]),o=makeBox([0,-e/2,0],[n,e/2,r]);return i.fuse(o)}const lProfileModel={name:"LProfile",create:createLProfile,params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],validators:[validateAll(isPositive,["depth","flangeXLenght","flangeYLenght","thickness"]),validateLessThan("thickness","flangeXLenght"),validateLessThan("thickness","flangeYLenght")],hasExplosion:!1};function createFrustum({bottomRadius:e=50,topRadius:t=25,height:r=100}){return sketchCircle(e,{plane:"XY",origin:[0,0,0]}).loftWith(sketchCircle(t,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}const frustumModel={name:"Frustum",create:createFrustum,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],validators:[validateAll(isPositive,["bottomRadius","topRadius","height"])],hasExplosion:!1};function createDrill({bottomRadius:e=50,topRadius:t=25,frustumHeight:r=80,cylinderHeight:n=40}){return createFrustum({bottomRadius:e,topRadius:t,height:r}).fuse(makeCylinder(t,n,[0,0,-r],[0,0,-1]))}const drillModel={name:"Drill",create:createDrill,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],validators:[validateAll(isPositive,["bottomRadius","topRadius","frustumHeight","cylinderHeight"])],hasExplosion:!1};function modelWithHelpers(e,t){return{main:e,helperSpaces:t}}function exportableModel(e){return e.main||e}const FACES={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},EDGES={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function getFaceNormal(e){let t;switch(e){case FACES.FRONT:t=new Vector([0,-1,0]);break;case FACES.BACK:t=new Vector([0,1,0]);break;case FACES.LEFT:t=new Vector([-1,0,0]);break;case FACES.RIGHT:t=new Vector([1,0,0]);break;case FACES.TOP:t=new Vector([0,0,1]);break;case FACES.BOTTOM:t=new Vector([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return t}function getEdgeStartPoint(e,t){const[[r,n,i],[o,a,s]]=e.bounds;let u;switch(t){case EDGES.FRONT_TOP:u=new Vector([r,n,s]);break;case EDGES.FRONT_BOTTOM:u=new Vector([r,n,i]);break;case EDGES.BACK_TOP:u=new Vector([r,a,s]);break;case EDGES.BACK_BOTTOM:u=new Vector([r,a,i]);break;case EDGES.LEFT_TOP:u=new Vector([r,n,s]);break;case EDGES.LEFT_BOTTOM:u=new Vector([r,n,i]);break;case EDGES.RIGHT_TOP:u=new Vector([o,n,s]);break;case EDGES.RIGHT_BOTTOM:u=new Vector([o,n,i]);break;case EDGES.FRONT_LEFT:u=new Vector([r,n,i]);break;case EDGES.FRONT_RIGHT:u=new Vector([o,n,i]);break;case EDGES.BACK_LEFT:u=new Vector([r,a,i]);break;case EDGES.BACK_RIGHT:u=new Vector([o,a,i]);break;default:throw new Error(`Unknown edge identifier: ${t}`)}return u}function getEdgeEndPoint(e,t){const[[r,n,i],[o,a,s]]=e.bounds;let u;switch(t){case EDGES.FRONT_TOP:u=new Vector([o,n,s]);break;case EDGES.FRONT_BOTTOM:u=new Vector([o,n,i]);break;case EDGES.BACK_TOP:u=new Vector([o,a,s]);break;case EDGES.BACK_BOTTOM:u=new Vector([o,a,i]);break;case EDGES.LEFT_TOP:u=new Vector([r,a,s]);break;case EDGES.LEFT_BOTTOM:u=new Vector([r,a,i]);break;case EDGES.RIGHT_TOP:u=new Vector([o,a,s]);break;case EDGES.RIGHT_BOTTOM:u=new Vector([o,a,i]);break;case EDGES.FRONT_LEFT:u=new Vector([r,n,s]);break;case EDGES.FRONT_RIGHT:u=new Vector([o,n,s]);break;case EDGES.BACK_LEFT:u=new Vector([r,a,s]);break;case EDGES.BACK_RIGHT:u=new Vector([o,a,s]);break;default:throw new Error(`Unknown edge identifier: ${t}`)}return u}function getEdgeConnectingFaces(e){switch(e){case EDGES.FRONT_LEFT:return[FACES.FRONT,FACES.LEFT];case EDGES.FRONT_RIGHT:return[FACES.FRONT,FACES.RIGHT];case EDGES.FRONT_TOP:return[FACES.FRONT,FACES.TOP];case EDGES.FRONT_BOTTOM:return[FACES.FRONT,FACES.BOTTOM];case EDGES.BACK_LEFT:return[FACES.BACK,FACES.LEFT];case EDGES.BACK_RIGHT:return[FACES.BACK,FACES.RIGHT];case EDGES.BACK_TOP:return[FACES.BACK,FACES.TOP];case EDGES.BACK_BOTTOM:return[FACES.BACK,FACES.BOTTOM];case EDGES.LEFT_TOP:return[FACES.LEFT,FACES.TOP];case EDGES.LEFT_BOTTOM:return[FACES.LEFT,FACES.BOTTOM];case EDGES.RIGHT_TOP:return[FACES.RIGHT,FACES.TOP];case EDGES.RIGHT_BOTTOM:return[FACES.RIGHT,FACES.BOTTOM];default:throw new Error(`Unknown edge identifier: ${e}`)}}function getPointOnFace(e,t,r=.5,n=.5){const[[i,o,a],[s,u,f]]=e.bounds,d=Math.max(0,Math.min(1,r)),w=Math.max(0,Math.min(1,n));let b;switch(t){case FACES.FRONT:b=new Vector([i+(s-i)*d,o,a+(f-a)*w]);break;case FACES.BACK:b=new Vector([i+(s-i)*d,u,a+(f-a)*w]);break;case FACES.LEFT:b=new Vector([i,o+(u-o)*d,a+(f-a)*w]);break;case FACES.RIGHT:b=new Vector([s,o+(u-o)*d,a+(f-a)*w]);break;case FACES.TOP:b=new Vector([i+(s-i)*d,o+(u-o)*w,f]);break;case FACES.BOTTOM:b=new Vector([i+(s-i)*d,o+(u-o)*w,a]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return b}function getPointOnEdge(e,t,r=.5){const n=Math.max(0,Math.min(1,r)),i=getEdgeStartPoint(e,t),o=getEdgeEndPoint(e,t);return new Vector([i.x+(o.x-i.x)*n,i.y+(o.y-i.y)*n,i.z+(o.z-i.z)*n])}function getPointOnBoundingBox(e,t){const{type:r,element:n,params:i={}}=t;switch(r){case"face":return getPointOnFace(e,n,i.u,i.v);case"edge":return getPointOnEdge(e,n,i.t);case"corner":if(n.includes("START")){const o=n.replace("_START","");return getEdgeStartPoint(e,o)}else if(n.includes("END")){const o=n.replace("_END","");return getEdgeEndPoint(e,o)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new Vector(e.center);default:throw new Error(`Unknown position type: ${r}`)}}function findPerpendicularVector(e){const t=e.normalized(),r=Math.abs(t.x),n=Math.abs(t.y),i=Math.abs(t.z);let o;return r<=n&&r<=i?o=new Vector([0,t.z,-t.y]):n<=r&&n<=i?o=new Vector([t.z,0,-t.x]):o=new Vector([t.y,-t.x,0]),o.normalized()}function constraintModelsByPoints(e,t,r,n={}){const i=getPointOnBoundingBox(e.boundingBox,t);let o;n.normal?o=new Vector(n.normal):o=getNormalForPointSpec(e,t,n);let a;n.xDir?a=new Vector(n.xDir):a=findPerpendicularVector(o);const s=new Transformation;s.coordSystemChange({origin:i.toTuple(),zDir:o.toTuple(),xDir:a.toTuple()},"reference");const u=cast(s.transform(r.wrapped));return s.delete(),o.delete(),a.delete(),i.delete(),u}function getNormalForPointSpec(e,t,r={}){const{type:n,element:i}=t;switch(n){case"face":return getFaceNormal(i);case"edge":if(r.faceForEdge)return getFaceNormal(r.faceForEdge);{const o=getEdgeConnectingFaces(i);return getFaceNormal(o[0])}case"corner":return r.faceForCorner?getFaceNormal(r.faceForCorner):new Vector([0,0,1]);case"center":default:return new Vector([0,0,1])}}function mirror(e,t,r,n=!1){return n?cast(e.wrapped).mirror(t,r):e.mirror(t,r)}function createStaircase({width:e=50,depth:t=100,height:r=200,showHelper:n=!0,explosionFactor:i=0}){const o=createCuboid({width:e,depth:t,height:r}),a=Math.round(r/17.5)-1;if(a<=0)return modelWithHelpers(compoundShapes([]),n?[o]:[]);const s=r/(a+1),u=a>1?(t-28)/(a-1):0,f=createCuboid({width:e-1,depth:20,height:.5}),d=f.boundingBox.center,w=constraintModelsByPoints(f,{type:"face",element:FACES.TOP,params:{u:1.5/(e-1),v:2.25/20}},createDrill({bottomRadius:1.2,topRadius:.8,frustumHeight:.5*.8,cylinderHeight:.5*.2})),b=f.cut(w).cut(mirror(w,"XZ",d,!0)).cut(mirror(w,"YZ",d,!0)).cut(mirror(mirror(w,"XZ",d,!0),"YZ",d,!0)),S=b.clone(),x=createLProfile({depth:20,flangeXLenght:4.5,flangeYLenght:4.5,thickness:.5}),m=x.boundingBox.center,h=constraintModelsByPoints(x,{type:"face",element:FACES.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},createCylinder({radius:.800001,height:.5})),v=x.cut(h).cut(mirror(h,"XZ",m,!0)),p=v.clone(),y=constraintModelsByPoints(b,{type:"edge",element:EDGES.LEFT_BOTTOM,params:{t:.5}},v,{normal:[0,0,-1],xDir:[1,0,0]}),E=mirror(y,"YZ",d,!0),P=[];let A=0,L=-t/2+14,B=s-(b.boundingBox.bounds[1][2]-b.boundingBox.bounds[0][2]);for(let X=0;X<a;X++){const Y=i*15;P.push(b.clone().translate([A,L,B])),P.push(y.clone().translate([A-Y,L,B])),P.push(E.clone().translate([A+Y,L,B])),L+=u,B+=s}const F=createCuboid({width:600,depth:20,height:.5}),U=u,T=s,I=Math.sqrt(U*U+T*T),_=I>.001?[0,U/I,T/I]:[1,0,0],z=constraintModelsByPoints(o,{type:"face",element:FACES.RIGHT},F,{normal:[-1,0,0],xDir:_}).intersect(o),M=z.clone(),q=o.boundingBox.center,J=mirror(z,"YZ",q,!0),ee=i*30,le=i*30;P.push(z.translate([ee,0,0])),P.push(J.translate([-le,0,0]));const oe=compoundShapes(P),V=[{id:"ST001",name:"Stringer",quantity:a,dimensions:`${e-1}200.5cm`,material:"Steel"},{id:"LP001",name:"L-Profile",quantity:a*2,dimensions:"4.54.520cm",material:"Steel"},{id:"SS001",name:"Side Stringer",quantity:2,dimensions:"Variable",material:"Steel"}];return{main:oe,helperSpaces:n?[o]:[],componentData:V,technicalDrawingModels:{ST001:S,LP001:p,SS001:M}}}const staircaseModel={name:"Staircase",create:createStaircase,params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],validators:[validateAll(isPositive,["width","depth","height"])],hasExplosion:!0},modelRegistry={Cuboid:cuboidModel,Sphere:sphereModel,Cylinder:cylinderModel,Ellipsoid:ellipsoidModel,DiagonalCuboidPattern:linearCuboidPatternModel,RectangularCuboidGrid:rectangularCuboidGridModel,LProfile:lProfileModel,Frustum:frustumModel,Drill:drillModel,Staircase:staircaseModel};function createModelWithValidation(e,t){const r=modelRegistry[e];if(!r)throw new Error(`Model "${e}" not found`);const n=validateModelParams(t,r);return n.valid?r.create(t):{error:!0,validationErrors:n.errors}}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var o=Function.bind.apply(t,i);return new o}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var cloneExports={},clone={get exports(){return cloneExports},set exports(e){cloneExports=e}};(function(e){var t=function(){function r(u,f,d,w){typeof f=="object"&&(d=f.depth,w=f.prototype,f.filter,f=f.circular);var b=[],S=[],x=typeof Buffer<"u";typeof f>"u"&&(f=!0),typeof d>"u"&&(d=1/0);function m(h,v){if(h===null)return null;if(v==0)return h;var p,y;if(typeof h!="object")return h;if(r.__isArray(h))p=[];else if(r.__isRegExp(h))p=new RegExp(h.source,s(h)),h.lastIndex&&(p.lastIndex=h.lastIndex);else if(r.__isDate(h))p=new Date(h.getTime());else{if(x&&Buffer.isBuffer(h))return Buffer.allocUnsafe?p=Buffer.allocUnsafe(h.length):p=new Buffer(h.length),h.copy(p),p;typeof w>"u"?(y=Object.getPrototypeOf(h),p=Object.create(y)):(p=Object.create(w),y=w)}if(f){var E=b.indexOf(h);if(E!=-1)return S[E];b.push(h),S.push(p)}for(var P in h){var A;y&&(A=Object.getOwnPropertyDescriptor(y,P)),!(A&&A.set==null)&&(p[P]=m(h[P],v-1))}return p}return m(u,d)}r.clonePrototype=function(f){if(f===null)return null;var d=function(){};return d.prototype=f,new d};function n(u){return Object.prototype.toString.call(u)}r.__objToStr=n;function i(u){return typeof u=="object"&&n(u)==="[object Date]"}r.__isDate=i;function o(u){return typeof u=="object"&&n(u)==="[object Array]"}r.__isArray=o;function a(u){return typeof u=="object"&&n(u)==="[object RegExp]"}r.__isRegExp=a;function s(u){var f="";return u.global&&(f+="g"),u.ignoreCase&&(f+="i"),u.multiline&&(f+="m"),f}return r.__getRegExpFlags=s,r}();e.exports&&(e.exports=t)})(clone);function sortKD(e,t,r,n,i,o){if(!(i-n<=r)){var a=Math.floor((n+i)/2);select(e,t,a,n,i,o%2),sortKD(e,t,r,n,a-1,o+1),sortKD(e,t,r,a+1,i,o+1)}}function select(e,t,r,n,i,o){for(;i>n;){if(i-n>600){var a=i-n+1,s=r-n+1,u=Math.log(a),f=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*f*(a-f)/a)*(s-a/2<0?-1:1),w=Math.max(n,Math.floor(r-s*f/a+d)),b=Math.min(i,Math.floor(r+(a-s)*f/a+d));select(e,t,r,w,b,o)}var S=t[2*r+o],x=n,m=i;for(swapItem(e,t,n,r),t[2*i+o]>S&&swapItem(e,t,n,i);x<m;){for(swapItem(e,t,x,m),x++,m--;t[2*x+o]<S;)x++;for(;t[2*m+o]>S;)m--}t[2*n+o]===S?swapItem(e,t,n,m):(m++,swapItem(e,t,m,i)),m<=r&&(n=m+1),r<=m&&(i=m-1)}}function swapItem(e,t,r,n){swap(e,r,n),swap(t,2*r,2*n),swap(t,2*r+1,2*n+1)}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function range(e,t,r,n,i,o,a){for(var s=[0,e.length-1,0],u=[],f,d;s.length;){var w=s.pop(),b=s.pop(),S=s.pop();if(b-S<=a){for(var x=S;x<=b;x++)f=t[2*x],d=t[2*x+1],f>=r&&f<=i&&d>=n&&d<=o&&u.push(e[x]);continue}var m=Math.floor((S+b)/2);f=t[2*m],d=t[2*m+1],f>=r&&f<=i&&d>=n&&d<=o&&u.push(e[m]);var h=(w+1)%2;(w===0?r<=f:n<=d)&&(s.push(S),s.push(m-1),s.push(h)),(w===0?i>=f:o>=d)&&(s.push(m+1),s.push(b),s.push(h))}return u}function within(e,t,r,n,i,o){for(var a=[0,e.length-1,0],s=[],u=i*i;a.length;){var f=a.pop(),d=a.pop(),w=a.pop();if(d-w<=o){for(var b=w;b<=d;b++)sqDist(t[2*b],t[2*b+1],r,n)<=u&&s.push(e[b]);continue}var S=Math.floor((w+d)/2),x=t[2*S],m=t[2*S+1];sqDist(x,m,r,n)<=u&&s.push(e[S]);var h=(f+1)%2;(f===0?r-i<=x:n-i<=m)&&(a.push(w),a.push(S-1),a.push(h)),(f===0?r+i>=x:n+i>=m)&&(a.push(S+1),a.push(d),a.push(h))}return s}function sqDist(e,t,r,n){var i=e-r,o=t-n;return i*i+o*o}function kdbush(e,t,r,n,i){return new KDBush(e,t,r,n,i)}function KDBush(e,t,r,n,i){t=t||defaultGetX,r=r||defaultGetY,i=i||Array,this.nodeSize=n||64,this.points=e,this.ids=new i(e.length),this.coords=new i(e.length*2);for(var o=0;o<e.length;o++)this.ids[o]=o,this.coords[2*o]=t(e[o]),this.coords[2*o+1]=r(e[o]);sortKD(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}KDBush.prototype={range:function(e,t,r,n){return range(this.ids,this.coords,e,t,r,n,this.nodeSize)},within:function(e,t,r){return within(this.ids,this.coords,e,t,r,this.nodeSize)}};function defaultGetX(e){return e[0]}function defaultGetY(e){return e[1]}var src=Object.freeze({__proto__:null,default:kdbush}),require$$1=getAugmentedNamespace(src),graham_scan_minExports={},graham_scan_min={get exports(){return graham_scan_minExports},set exports(e){graham_scan_minExports=e}},hasRequiredGraham_scan_min;function requireGraham_scan_min(){return hasRequiredGraham_scan_min||(hasRequiredGraham_scan_min=1,function(e){function t(){this.anchorPoint=void 0,this.reverse=!1,this.points=[]}t.prototype={constructor:t,Point:function(r,n){this.x=r,this.y=n},_findPolarAngle:function(r,n){var i,o,a=57.295779513082;if(!r||!n||(i=n.x-r.x,o=n.y-r.y,i==0&&o==0))return 0;var s=Math.atan2(o,i)*a;return this.reverse?0>=s&&(s+=360):s>=0&&(s+=360),s},addPoint:function(r,n){var i=this.anchorPoint===void 0||this.anchorPoint.y>n||this.anchorPoint.y===n&&this.anchorPoint.x>r;i?(this.anchorPoint!==void 0&&this.points.push(new this.Point(this.anchorPoint.x,this.anchorPoint.y)),this.anchorPoint=new this.Point(r,n)):this.points.push(new this.Point(r,n))},_sortPoints:function(){var r=this;return this.points.sort(function(n,i){var o=r._findPolarAngle(r.anchorPoint,n),a=r._findPolarAngle(r.anchorPoint,i);return a>o?-1:o>a?1:0})},_checkPoints:function(r,n,i){var o,a=this._findPolarAngle(r,n),s=this._findPolarAngle(r,i);return a>s?(o=a-s,!(o>180)):s>a?(o=s-a,o>180):!0},getHull:function(){var r,n,i=[];if(this.reverse=this.points.every(function(f){return f.x<0&&f.y<0}),r=this._sortPoints(),n=r.length,3>n)return r.unshift(this.anchorPoint),r;for(i.push(r.shift(),r.shift());;){var o,a,s;if(i.push(r.shift()),o=i[i.length-3],a=i[i.length-2],s=i[i.length-1],this._checkPoints(o,a,s)&&i.splice(i.length-2,1),r.length==0){if(n==i.length){var u=this.anchorPoint;return i=i.filter(function(f){return!!f}),i.some(function(f){return f.x==u.x&&f.y==u.y})||i.unshift(this.anchorPoint),i}r=i,n=r.length,i=[],i.push(r.shift(),r.shift())}}}},e.exports=t}(graham_scan_min)),graham_scan_minExports}var bezierJsExports={},bezierJs={get exports(){return bezierJsExports},set exports(e){bezierJsExports=e}},bezierExports={},bezier={get exports(){return bezierExports},set exports(e){bezierExports=e}},utilsExports={},utils={get exports(){return utilsExports},set exports(e){utilsExports=e}},hasRequiredUtils;function requireUtils(){return hasRequiredUtils||(hasRequiredUtils=1,function(){var e=Math.abs,t=Math.cos,r=Math.sin,n=Math.acos,i=Math.atan2,o=Math.sqrt,a=Math.pow,s=function(h){return h<0?-a(-h,1/3):a(h,1/3)},u=Math.PI,f=2*u,d=u/2,w=1e-6,b=Number.MAX_SAFE_INTEGER||9007199254740991,S=Number.MIN_SAFE_INTEGER||-9007199254740991,x={x:0,y:0,z:0},m={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(h,v){var p=v(h),y=p.x*p.x+p.y*p.y;return typeof p.z<"u"&&(y+=p.z*p.z),o(y)},compute:function(h,v,p){if(h===0)return v[0];var y=v.length-1;if(h===1)return v[y];var E=v,P=1-h;if(y===0)return v[0];if(y===1)return I={x:P*E[0].x+h*E[1].x,y:P*E[0].y+h*E[1].y},p&&(I.z=P*E[0].z+h*E[1].z),I;if(y<4){var A=P*P,L=h*h,B,F,U,T=0;y===2?(E=[E[0],E[1],E[2],x],B=A,F=P*h*2,U=L):y===3&&(B=A*P,F=A*h*3,U=P*L*3,T=h*L);var I={x:B*E[0].x+F*E[1].x+U*E[2].x+T*E[3].x,y:B*E[0].y+F*E[1].y+U*E[2].y+T*E[3].y};return p&&(I.z=B*E[0].z+F*E[1].z+U*E[2].z+T*E[3].z),I}for(var _=JSON.parse(JSON.stringify(v));_.length>1;){for(var D=0;D<_.length-1;D++)_[D]={x:_[D].x+(_[D+1].x-_[D].x)*h,y:_[D].y+(_[D+1].y-_[D].y)*h},typeof _[D].z<"u"&&(_[D]=_[D].z+(_[D+1].z-_[D].z)*h);_.splice(_.length-1,1)}return _[0]},computeWithRatios:function(h,v,p,y){var E=1-h,P=p,A=v,L,B=P[0],F=P[1],U=P[2],T=P[3];if(B*=E,F*=h,A.length===2)return L=B+F,{x:(B*A[0].x+F*A[1].x)/L,y:(B*A[0].y+F*A[1].y)/L,z:y?(B*A[0].z+F*A[1].z)/L:!1};if(B*=E,F*=2*E,U*=h*h,A.length===3)return L=B+F+U,{x:(B*A[0].x+F*A[1].x+U*A[2].x)/L,y:(B*A[0].y+F*A[1].y+U*A[2].y)/L,z:y?(B*A[0].z+F*A[1].z+U*A[2].z)/L:!1};if(B*=E,F*=1.5*E,U*=3*E,T*=h*h*h,A.length===4)return L=B+F+U+T,{x:(B*A[0].x+F*A[1].x+U*A[2].x+T*A[3].x)/L,y:(B*A[0].y+F*A[1].y+U*A[2].y+T*A[3].y)/L,z:y?(B*A[0].z+F*A[1].z+U*A[2].z+T*A[3].z)/L:!1}},derive:function(h,v){for(var p=[],y=h,E=y.length,P=E-1;E>1;E--,P--){for(var A=[],L=0,B;L<P;L++)B={x:P*(y[L+1].x-y[L].x),y:P*(y[L+1].y-y[L].y)},v&&(B.z=P*(y[L+1].z-y[L].z)),A.push(B);p.push(A),y=A}return p},between:function(h,v,p){return v<=h&&h<=p||m.approximately(h,v)||m.approximately(h,p)},approximately:function(h,v,p){return e(h-v)<=(p||w)},length:function(h){var v=.5,p=0,y=m.Tvalues.length,E,P;for(E=0;E<y;E++)P=v*m.Tvalues[E]+v,p+=m.Cvalues[E]*m.arcfn(P,h);return v*p},map:function(h,v,p,y,E){var P=p-v,A=E-y,L=h-v,B=L/P;return y+A*B},lerp:function(h,v,p){var y={x:v.x+h*(p.x-v.x),y:v.y+h*(p.y-v.y)};return v.z&&p.z&&(y.z=v.z+h*(p.z-v.z)),y},pointToString:function(h){var v=h.x+"/"+h.y;return typeof h.z<"u"&&(v+="/"+h.z),v},pointsToString:function(h){return"["+h.map(m.pointToString).join(", ")+"]"},copy:function(h){return JSON.parse(JSON.stringify(h))},angle:function(h,v,p){var y=v.x-h.x,E=v.y-h.y,P=p.x-h.x,A=p.y-h.y,L=y*A-E*P,B=y*P+E*A;return i(L,B)},round:function(h,v){var p=""+h,y=p.indexOf(".");return parseFloat(p.substring(0,y+1+v))},dist:function(h,v){var p=h.x-v.x,y=h.y-v.y;return o(p*p+y*y)},closest:function(h,v){var p=a(2,63),y,E;return h.forEach(function(P,A){E=m.dist(v,P),E<p&&(p=E,y=A)}),{mdist:p,mpos:y}},abcratio:function(h,v){if(v!==2&&v!==3)return!1;if(typeof h>"u")h=.5;else if(h===0||h===1)return h;var p=a(h,v)+a(1-h,v),y=p-1;return e(y/p)},projectionratio:function(h,v){if(v!==2&&v!==3)return!1;if(typeof h>"u")h=.5;else if(h===0||h===1)return h;var p=a(1-h,v),y=a(h,v)+p;return p/y},lli8:function(h,v,p,y,E,P,A,L){var B=(h*y-v*p)*(E-A)-(h-p)*(E*L-P*A),F=(h*y-v*p)*(P-L)-(v-y)*(E*L-P*A),U=(h-p)*(P-L)-(v-y)*(E-A);return U==0?!1:{x:B/U,y:F/U}},lli4:function(h,v,p,y){var E=h.x,P=h.y,A=v.x,L=v.y,B=p.x,F=p.y,U=y.x,T=y.y;return m.lli8(E,P,A,L,B,F,U,T)},lli:function(h,v){return m.lli4(h,h.c,v,v.c)},makeline:function(h,v){var p=requireBezier(),y=h.x,E=h.y,P=v.x,A=v.y,L=(P-y)/3,B=(A-E)/3;return new p(y,E,y+L,E+B,y+2*L,E+2*B,P,A)},findbbox:function(h){var v=b,p=b,y=S,E=S;return h.forEach(function(P){var A=P.bbox();v>A.x.min&&(v=A.x.min),p>A.y.min&&(p=A.y.min),y<A.x.max&&(y=A.x.max),E<A.y.max&&(E=A.y.max)}),{x:{min:v,mid:(v+y)/2,max:y,size:y-v},y:{min:p,mid:(p+E)/2,max:E,size:E-p}}},shapeintersections:function(h,v,p,y,E){if(!m.bboxoverlap(v,y))return[];var P=[],A=[h.startcap,h.forward,h.back,h.endcap],L=[p.startcap,p.forward,p.back,p.endcap];return A.forEach(function(B){B.virtual||L.forEach(function(F){if(!F.virtual){var U=B.intersects(F,E);U.length>0&&(U.c1=B,U.c2=F,U.s1=h,U.s2=p,P.push(U))}})}),P},makeshape:function(h,v,p){var y=v.points.length,E=h.points.length,P=m.makeline(v.points[y-1],h.points[0]),A=m.makeline(h.points[E-1],v.points[0]),L={startcap:P,forward:h,back:v,endcap:A,bbox:m.findbbox([P,h,v,A])},B=m;return L.intersections=function(F){return B.shapeintersections(L,L.bbox,F,F.bbox,p)},L},getminmax:function(h,v,p){if(!p)return{min:0,max:0};var y=b,E=S,P,A;p.indexOf(0)===-1&&(p=[0].concat(p)),p.indexOf(1)===-1&&p.push(1);for(var L=0,B=p.length;L<B;L++)P=p[L],A=h.get(P),A[v]<y&&(y=A[v]),A[v]>E&&(E=A[v]);return{min:y,mid:(y+E)/2,max:E,size:E-y}},align:function(h,v){var p=v.p1.x,y=v.p1.y,E=-i(v.p2.y-y,v.p2.x-p),P=function(A){return{x:(A.x-p)*t(E)-(A.y-y)*r(E),y:(A.x-p)*r(E)+(A.y-y)*t(E)}};return h.map(P)},roots:function(h,v){v=v||{p1:{x:0,y:0},p2:{x:1,y:0}};var p=h.length-1,M=m.align(h,v),y=function(xe){return 0<=xe&&xe<=1};if(p===2){var I=M[0].y,_=M[1].y,D=M[2].y,T=I-2*_+D;if(T!==0){var E=-o(_*_-I*D),P=-I+_,V=-(E+P)/T,A=-(-E+P)/T;return[V,A].filter(y)}else if(_!==D&&T===0)return[(2*_-D)/(2*_-2*D)].filter(y);return[]}var L=M[0].y,B=M[1].y,F=M[2].y,U=M[3].y,T=-L+3*B-3*F+U,I=3*L-6*B+3*F,_=-3*L+3*B,D=L;if(m.approximately(T,0)){if(m.approximately(I,0))return m.approximately(_,0)?[]:[-D/_].filter(y);var J=o(_*_-4*I*D),z=2*I;return[(J-_)/z,(-_-J)/z].filter(y)}I/=T,_/=T,D/=T;var M=(3*_-I*I)/3,q=M/3,J=(2*I*I*I-9*I*_+27*D)/27,ee=J/2,le=ee*ee+q*q*q,oe,V,H,X,Y;if(le<0){var ie=-M/3,se=ie*ie*ie,pe=o(se),ae=-J/(2*pe),ce=ae<-1?-1:ae>1?1:ae,Ae=n(ce),Te=s(pe),K=2*Te;return H=K*t(Ae/3)-I/3,X=K*t((Ae+f)/3)-I/3,Y=K*t((Ae+2*f)/3)-I/3,[H,X,Y].filter(y)}else{if(le===0)return oe=ee<0?s(-ee):-s(ee),H=2*oe-I/3,X=-oe-I/3,[H,X].filter(y);var he=o(le);return oe=s(-ee+he),V=s(ee+he),[oe-V-I/3].filter(y)}},droots:function(h){if(h.length===3){var v=h[0],p=h[1],y=h[2],E=v-2*p+y;if(E!==0){var P=-o(p*p-v*y),A=-v+p,L=-(P+A)/E,B=-(-P+A)/E;return[L,B]}else if(p!==y&&E===0)return[(2*p-y)/(2*(p-y))];return[]}if(h.length===2){var v=h[0],p=h[1];return v!==p?[v/(v-p)]:[]}},curvature:function(h,v,p,y){var E=m.derive(v),P=E[0],A=E[1],L,B,F,U,T=0,I=0,_=m.compute(h,P),D=m.compute(h,A),z=_.x*_.x+_.y*_.y;if(p?(L=o(a(_.y*D.z-D.y*_.z,2)+a(_.z*D.x-D.z*_.x,2)+a(_.x*D.y-D.x*_.y,2)),B=a(z+_.z*_.z,3/2)):(L=_.x*D.y-_.y*D.x,B=a(z,3/2)),L===0||B===0)return{k:0,r:0};if(T=L/B,I=B/L,!y){var M=m.curvature(h-.001,v,p,!0).k,q=m.curvature(h+.001,v,p,!0).k;U=(q-T+(T-M))/2,F=(e(q-T)+e(T-M))/2}return{k:T,r:I,dk:U,adk:F}},inflections:function(h){if(h.length<4)return[];var v=m.align(h,{p1:h[0],p2:h.slice(-1)[0]}),p=v[2].x*v[1].y,y=v[3].x*v[1].y,E=v[1].x*v[2].y,T=v[3].x*v[2].y,P=18*(-3*p+2*y+3*E-T),A=18*(3*p-y-3*E),L=18*(E-p);if(m.approximately(P,0)){if(!m.approximately(A,0)){var B=-L/A;if(0<=B&&B<=1)return[B]}return[]}var F=A*A-4*P*L,U=Math.sqrt(F),T=2*P;return m.approximately(T,0)?[]:[(U-A)/T,-(A+U)/T].filter(function(I){return 0<=I&&I<=1})},bboxoverlap:function(h,v){var p=["x","y"],y=p.length,E,P,A,L,B;for(E=0;E<y;E++)if(P=p[E],A=h[P].mid,L=v[P].mid,B=(h[P].size+v[P].size)/2,e(A-L)>=B)return!1;return!0},expandbox:function(h,v){v.x.min<h.x.min&&(h.x.min=v.x.min),v.y.min<h.y.min&&(h.y.min=v.y.min),v.z&&v.z.min<h.z.min&&(h.z.min=v.z.min),v.x.max>h.x.max&&(h.x.max=v.x.max),v.y.max>h.y.max&&(h.y.max=v.y.max),v.z&&v.z.max>h.z.max&&(h.z.max=v.z.max),h.x.mid=(h.x.min+h.x.max)/2,h.y.mid=(h.y.min+h.y.max)/2,h.z&&(h.z.mid=(h.z.min+h.z.max)/2),h.x.size=h.x.max-h.x.min,h.y.size=h.y.max-h.y.min,h.z&&(h.z.size=h.z.max-h.z.min)},pairiteration:function(h,v,p){var y=h.bbox(),E=v.bbox(),P=1e5,A=p||.5;if(y.x.size+y.y.size<A&&E.x.size+E.y.size<A)return[(P*(h._t1+h._t2)/2|0)/P+"/"+(P*(v._t1+v._t2)/2|0)/P];var L=h.split(.5),B=v.split(.5),F=[{left:L.left,right:B.left},{left:L.left,right:B.right},{left:L.right,right:B.right},{left:L.right,right:B.left}];F=F.filter(function(T){return m.bboxoverlap(T.left.bbox(),T.right.bbox())});var U=[];return F.length===0||(F.forEach(function(T){U=U.concat(m.pairiteration(T.left,T.right,A))}),U=U.filter(function(T,I){return U.indexOf(T)===I})),U},getccenter:function(h,v,p){var y=v.x-h.x,E=v.y-h.y,P=p.x-v.x,A=p.y-v.y,L=y*t(d)-E*r(d),B=y*r(d)+E*t(d),F=P*t(d)-A*r(d),U=P*r(d)+A*t(d),T=(h.x+v.x)/2,I=(h.y+v.y)/2,_=(v.x+p.x)/2,D=(v.y+p.y)/2,z=T+L,M=I+B,q=_+F,J=D+U,ee=m.lli8(T,I,z,M,_,D,q,J),le=m.dist(ee,h),oe=i(h.y-ee.y,h.x-ee.x),V=i(v.y-ee.y,v.x-ee.x),H=i(p.y-ee.y,p.x-ee.x),X;return oe<H?((oe>V||V>H)&&(oe+=f),oe>H&&(X=H,H=oe,oe=X)):H<V&&V<oe?(X=H,H=oe,oe=X):H+=f,ee.s=oe,ee.e=H,ee.r=le,ee},numberSort:function(h,v){return h-v}};utils.exports=m}()),utilsExports}var polyBezierExports={},polyBezier={get exports(){return polyBezierExports},set exports(e){polyBezierExports=e}},hasRequiredPolyBezier;function requirePolyBezier(){return hasRequiredPolyBezier||(hasRequiredPolyBezier=1,function(){var e=requireUtils(),t=function(r){this.curves=[],this._3d=!1,r&&(this.curves=r,this._3d=this.curves[0]._3d)};t.prototype={valueOf:function(){return this.toString()},toString:function(){return"["+this.curves.map(function(r){return e.pointsToString(r.points)}).join(", ")+"]"},addCurve:function(r){this.curves.push(r),this._3d=this._3d||r._3d},length:function(){return this.curves.map(function(r){return r.length()}).reduce(function(r,n){return r+n})},curve:function(r){return this.curves[r]},bbox:function(){for(var r=this.curves,n=r[0].bbox(),i=1;i<r.length;i++)e.expandbox(n,r[i].bbox());return n},offset:function(r){var n=[];return this.curves.forEach(function(i){n=n.concat(i.offset(r))}),new t(n)}},polyBezier.exports=t}()),polyBezierExports}var normaliseSvg,hasRequiredNormaliseSvg;function requireNormaliseSvg(){if(hasRequiredNormaliseSvg)return normaliseSvg;hasRequiredNormaliseSvg=1;function e(t){t=t.replace(/,/g," ").replace(/-/g," - ").replace(/-\s+/g,"-").replace(/([a-zA-Z])/g," $1 ");var r=t.replace(/([a-zA-Z])\s?/g,"|$1").split("|"),n=r.length,i,o,a,s,u=[],f,d,w=0,b=0,S=0,x=0,m=0,h=0,v=0,p=0,y="";for(i=1;i<n;i++)if(o=r[i],a=o.substring(0,1),s=a.toLowerCase(),u=o.replace(a,"").trim().split(" "),u=u.filter(function(E){return E!==""}).map(parseFloat),f=u.length,s==="m"){if(y+="M ",a==="m"?(S+=u[0],x+=u[1]):(S=u[0],x=u[1]),w=S,b=x,y+=S+" "+x+" ",f>2)for(d=0;d<f;d+=2)a==="m"?(S+=u[d],x+=u[d+1]):(S=u[d],x=u[d+1]),y+=["L",S,x,""].join(" ")}else if(s==="l")for(d=0;d<f;d+=2)a==="l"?(S+=u[d],x+=u[d+1]):(S=u[d],x=u[d+1]),y+=["L",S,x,""].join(" ");else if(s==="h")for(d=0;d<f;d++)a==="h"?S+=u[d]:S=u[d],y+=["L",S,x,""].join(" ");else if(s==="v")for(d=0;d<f;d++)a==="v"?x+=u[d]:x=u[d],y+=["L",S,x,""].join(" ");else if(s==="q")for(d=0;d<f;d+=4)a==="q"?(m=S+u[d],h=x+u[d+1],S+=u[d+2],x+=u[d+3]):(m=u[d],h=u[d+1],S=u[d+2],x=u[d+3]),y+=["Q",m,h,S,x,""].join(" ");else if(s==="t")for(d=0;d<f;d+=2)m=S+(S-m),h=x+(x-h),a==="t"?(S+=u[d],x+=u[d+1]):(S=u[d],x=u[d+1]),y+=["Q",m,h,S,x,""].join(" ");else if(s==="c")for(d=0;d<f;d+=6)a==="c"?(m=S+u[d],h=x+u[d+1],v=S+u[d+2],p=x+u[d+3],S+=u[d+4],x+=u[d+5]):(m=u[d],h=u[d+1],v=u[d+2],p=u[d+3],S=u[d+4],x=u[d+5]),y+=["C",m,h,v,p,S,x,""].join(" ");else if(s==="s")for(d=0;d<f;d+=4)m=S+(S-v),h=x+(x-p),a==="s"?(v=S+u[d],p=x+u[d+1],S+=u[d+2],x+=u[d+3]):(v=u[d],p=u[d+1],S=u[d+2],x=u[d+3]),y+=["C",m,h,v,p,S,x,""].join(" ");else s==="z"&&(y+="Z ",S=w,x=b);return y.trim()}return normaliseSvg=e,normaliseSvg}var svgToBeziers,hasRequiredSvgToBeziers;function requireSvgToBeziers(){if(hasRequiredSvgToBeziers)return svgToBeziers;hasRequiredSvgToBeziers=1;var e=requireNormaliseSvg(),t={x:!1,y:!1};function r(i,o,a){if(o!=="Z"){if(o==="M"){t={x:a[0],y:a[1]};return}var s=[!1,t.x,t.y].concat(a),u=i.bind.apply(i,s),f=new u,d=a.slice(-2);return t={x:d[0],y:d[1]},f}}function n(i,o){for(var a=e(o).split(" "),s,u=new RegExp("[MLCQZ]",""),f,d,w=[],b={C:6,Q:4,L:2,M:2};a.length;)s=a.splice(0,1)[0],u.test(s)&&(d=a.splice(0,b[s]).map(parseFloat),f=r(i,s,d),f&&w.push(f));return new i.PolyBezier(w)}return svgToBeziers=n,svgToBeziers}var hasRequiredBezier;function requireBezier(){return hasRequiredBezier||(hasRequiredBezier=1,function(){var e=Math.abs,t=Math.min,r=Math.max,n=Math.cos,i=Math.sin,o=Math.acos,a=Math.sqrt,s=Math.PI,u={x:0,y:0,z:0},f=requireUtils(),d=requirePolyBezier(),w=function(m){var h=m&&m.forEach?m:[].slice.call(arguments),v=!1;if(typeof h[0]=="object"){v=h.length;var p=[];h.forEach(function(T){["x","y","z"].forEach(function(I){typeof T[I]<"u"&&p.push(T[I])})}),h=p}var y=!1,E=h.length;if(v){if(v>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");y=!0}}else if(E!==6&&E!==8&&E!==9&&E!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var P=!y&&(E===9||E===12)||m&&m[0]&&typeof m[0].z<"u";this._3d=P;for(var A=[],L=0,B=P?3:2;L<E;L+=B){var F={x:h[L],y:h[L+1]};P&&(F.z=h[L+2]),A.push(F)}this.order=A.length-1,this.points=A;var U=["x","y"];P&&U.push("z"),this.dims=U,this.dimlen=U.length,function(T){for(var I=T.order,_=T.points,D=f.align(_,{p1:_[0],p2:_[I]}),z=0;z<D.length;z++)if(e(D[z].y)>1e-4){T._linear=!1;return}T._linear=!0}(this),this._t1=0,this._t2=1,this.update()},b=requireSvgToBeziers();w.SVGtoBeziers=function(m){return b(w,m)};function S(m,h,v,p,y){typeof y>"u"&&(y=.5);var E=f.projectionratio(y,m),P=1-E,A={x:E*h.x+P*p.x,y:E*h.y+P*p.y},L=f.abcratio(y,m),B={x:v.x+(v.x-A.x)/L,y:v.y+(v.y-A.y)/L};return{A:B,B:v,C:A}}w.quadraticFromPoints=function(m,h,v,p){if(typeof p>"u"&&(p=.5),p===0)return new w(h,h,v);if(p===1)return new w(m,h,h);var y=S(2,m,h,v,p);return new w(m,y.A,v)},w.cubicFromPoints=function(m,h,v,p,y){typeof p>"u"&&(p=.5);var E=S(3,m,h,v,p);typeof y>"u"&&(y=f.dist(h,E.C));var P=y*(1-p)/p,A=f.dist(m,v),L=(v.x-m.x)/A,B=(v.y-m.y)/A,F=y*L,U=y*B,T=P*L,I=P*B,_={x:h.x-F,y:h.y-U},D={x:h.x+T,y:h.y+I},z=E.A,M={x:z.x+(_.x-z.x)/(1-p),y:z.y+(_.y-z.y)/(1-p)},q={x:z.x+(D.x-z.x)/p,y:z.y+(D.y-z.y)/p},J={x:m.x+(M.x-m.x)/p,y:m.y+(M.y-m.y)/p},ee={x:v.x+(q.x-v.x)/(1-p),y:v.y+(q.y-v.y)/(1-p)};return new w(m,J,ee,v)};var x=function(){return f};w.getUtils=x,w.PolyBezier=d,w.prototype={getUtils:x,valueOf:function(){return this.toString()},toString:function(){return f.pointsToString(this.points)},toSVG:function(m){if(this._3d)return!1;for(var h=this.points,v=h[0].x,p=h[0].y,y=["M",v,p,this.order===2?"Q":"C"],E=1,P=h.length;E<P;E++)y.push(h[E].x),y.push(h[E].y);return y.join(" ")},setRatios:function(m){if(m.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=m,this._lut=[]},verify:function(){var m=this.coordDigest();m!==this._print&&(this._print=m,this.update())},coordDigest:function(){return this.points.map(function(m,h){return""+h+m.x+m.y+(m.z?m.z:0)}).join("")},update:function(m){this._lut=[],this.dpoints=f.derive(this.points,this._3d),this.computedirection()},computedirection:function(){var m=this.points,h=f.angle(m[0],m[this.order],m[1]);this.clockwise=h>0},length:function(){return f.length(this.derivative.bind(this))},_lut:[],getLUT:function(m){if(this.verify(),m=m||100,this._lut.length===m)return this._lut;this._lut=[],m--;for(var h=0;h<=m;h++)this._lut.push(this.compute(h/m));return this._lut},on:function(m,h){h=h||5;for(var v=this.getLUT(),p=[],y,E=0,P=0;P<v.length;P++)y=v[P],f.dist(y,m)<h&&(p.push(y),E+=P/v.length);return p.length?E/=p.length:!1},project:function(m){var h=this.getLUT(),v=h.length-1,p=f.closest(h,m),y=p.mdist,E=p.mpos,P,A,L,B,F=(E-1)/v,U=(E+1)/v,T=.1/v;for(y+=1,A=F,P=A;A<U+T;A+=T)L=this.compute(A),B=f.dist(m,L),B<y&&(y=B,P=A);return L=this.compute(P),L.t=P,L.d=y,L},get:function(m){return this.compute(m)},point:function(m){return this.points[m]},compute:function(m){return this.ratios?f.computeWithRatios(m,this.points,this.ratios,this._3d):f.compute(m,this.points,this._3d,this.ratios)},raise:function(){for(var m=this.points,h=[m[0]],v,p=m.length,y,E,v=1;v<p;v++)y=m[v],E=m[v-1],h[v]={x:(p-v)/p*y.x+v/p*E.x,y:(p-v)/p*y.y+v/p*E.y};return h[p]=m[p-1],new w(h)},derivative:function(m){var h=1-m,v,p,y=0,E=this.dpoints[0];this.order===2&&(E=[E[0],E[1],u],v=h,p=m),this.order===3&&(v=h*h,p=h*m*2,y=m*m);var P={x:v*E[0].x+p*E[1].x+y*E[2].x,y:v*E[0].y+p*E[1].y+y*E[2].y};return this._3d&&(P.z=v*E[0].z+p*E[1].z+y*E[2].z),P},curvature:function(m){return f.curvature(m,this.points,this._3d)},inflections:function(){return f.inflections(this.points)},normal:function(m){return this._3d?this.__normal3(m):this.__normal2(m)},__normal2:function(m){var h=this.derivative(m),v=a(h.x*h.x+h.y*h.y);return{x:-h.y/v,y:h.x/v}},__normal3:function(m){var h=this.derivative(m),v=this.derivative(m+.01),p=a(h.x*h.x+h.y*h.y+h.z*h.z),y=a(v.x*v.x+v.y*v.y+v.z*v.z);h.x/=p,h.y/=p,h.z/=p,v.x/=y,v.y/=y,v.z/=y;var E={x:v.y*h.z-v.z*h.y,y:v.z*h.x-v.x*h.z,z:v.x*h.y-v.y*h.x},P=a(E.x*E.x+E.y*E.y+E.z*E.z);E.x/=P,E.y/=P,E.z/=P;var A=[E.x*E.x,E.x*E.y-E.z,E.x*E.z+E.y,E.x*E.y+E.z,E.y*E.y,E.y*E.z-E.x,E.x*E.z-E.y,E.y*E.z+E.x,E.z*E.z],L={x:A[0]*h.x+A[1]*h.y+A[2]*h.z,y:A[3]*h.x+A[4]*h.y+A[5]*h.z,z:A[6]*h.x+A[7]*h.y+A[8]*h.z};return L},hull:function(m){var h=this.points,v=[],p,y=[],E=0,P=0,A=0;for(y[E++]=h[0],y[E++]=h[1],y[E++]=h[2],this.order===3&&(y[E++]=h[3]);h.length>1;){for(v=[],P=0,A=h.length-1;P<A;P++)p=f.lerp(m,h[P],h[P+1]),y[E++]=p,v.push(p);h=v}return y},split:function(m,h){if(m===0&&h)return this.split(h).left;if(h===1)return this.split(m).right;var v=this.hull(m),p={left:this.order===2?new w([v[0],v[3],v[5]]):new w([v[0],v[4],v[7],v[9]]),right:this.order===2?new w([v[5],v[4],v[2]]):new w([v[9],v[8],v[6],v[3]]),span:v};if(p.left._t1=f.map(0,0,1,this._t1,this._t2),p.left._t2=f.map(m,0,1,this._t1,this._t2),p.right._t1=f.map(m,0,1,this._t1,this._t2),p.right._t2=f.map(1,0,1,this._t1,this._t2),!h)return p;h=f.map(h,m,1,0,1);var y=p.right.split(h);return y.left},extrema:function(){var m=this.dims,h={},v=[],p,y;return m.forEach(function(E){y=function(P){return P[E]},p=this.dpoints[0].map(y),h[E]=f.droots(p),this.order===3&&(p=this.dpoints[1].map(y),h[E]=h[E].concat(f.droots(p))),h[E]=h[E].filter(function(P){return P>=0&&P<=1}),v=v.concat(h[E].sort(f.numberSort))}.bind(this)),v=v.sort(f.numberSort).filter(function(E,P){return v.indexOf(E)===P}),h.values=v,h},bbox:function(){var m=this.extrema(),h={};return this.dims.forEach(function(v){h[v]=f.getminmax(this,v,m[v])}.bind(this)),h},overlaps:function(m){var h=this.bbox(),v=m.bbox();return f.bboxoverlap(h,v)},offset:function(m,h){if(typeof h<"u"){var v=this.get(m),p=this.normal(m),y={c:v,n:p,x:v.x+p.x*h,y:v.y+p.y*h};return this._3d&&(y.z=v.z+p.z*h),y}if(this._linear){var E=this.normal(0),P=this.points.map(function(L){var B={x:L.x+m*E.x,y:L.y+m*E.y};return L.z&&p.z&&(B.z=L.z+m*E.z),B});return[new w(P)]}var A=this.reduce();return A.map(function(L){return L._linear?L.offset(m)[0]:L.scale(m)})},simple:function(){if(this.order===3){var m=f.angle(this.points[0],this.points[3],this.points[1]),h=f.angle(this.points[0],this.points[3],this.points[2]);if(m>0&&h<0||m<0&&h>0)return!1}var v=this.normal(0),p=this.normal(1),y=v.x*p.x+v.y*p.y;this._3d&&(y+=v.z*p.z);var E=e(o(y));return E<s/3},reduce:function(){var m,h=0,v=0,p=.01,y,E=[],P=[],A=this.extrema().values;for(A.indexOf(0)===-1&&(A=[0].concat(A)),A.indexOf(1)===-1&&A.push(1),h=A[0],m=1;m<A.length;m++)v=A[m],y=this.split(h,v),y._t1=h,y._t2=v,E.push(y),h=v;return E.forEach(function(L){for(h=0,v=0;v<=1;)for(v=h+p;v<=1+p;v+=p)if(y=L.split(h,v),!y.simple()){if(v-=p,e(h-v)<p)return[];y=L.split(h,v),y._t1=f.map(h,0,1,L._t1,L._t2),y._t2=f.map(v,0,1,L._t1,L._t2),P.push(y),h=v;break}h<1&&(y=L.split(h,1),y._t1=f.map(h,0,1,L._t1,L._t2),y._t2=L._t2,P.push(y))}),P},scale:function(m){var h=this.order,v=!1;if(typeof m=="function"&&(v=m),v&&h===2)return this.raise().scale(v);var p=this.clockwise,y=v?v(0):m,E=v?v(1):m,P=[this.offset(0,10),this.offset(1,10)],A=f.lli4(P[0],P[0].c,P[1],P[1].c);if(!A)throw new Error("cannot scale this curve. Try reducing it first.");var L=this.points,B=[];return[0,1].forEach(function(F){var U=B[F*h]=f.copy(L[F*h]);U.x+=(F?E:y)*P[F].n.x,U.y+=(F?E:y)*P[F].n.y}.bind(this)),v?([0,1].forEach(function(F){if(!(this.order===2&&F)){var U=L[F+1],T={x:U.x-A.x,y:U.y-A.y},I=v?v((F+1)/h):m;v&&!p&&(I=-I);var _=a(T.x*T.x+T.y*T.y);T.x/=_,T.y/=_,B[F+1]={x:U.x+I*T.x,y:U.y+I*T.y}}}.bind(this)),new w(B)):([0,1].forEach(function(F){if(!(this.order===2&&F)){var U=B[F*h],T=this.derivative(F),I={x:U.x+T.x,y:U.y+T.y};B[F+1]=f.lli4(U,I,A,L[F+1])}}.bind(this)),new w(B))},outline:function(m,h,v,p){h=typeof h>"u"?m:h;var y=this.reduce(),E=y.length,P=[],A=[],L,B=0,F=this.length(),U=typeof v<"u"&&typeof p<"u";function T(le,oe,V,H,X){return function(Y){var ie=H/V,se=(H+X)/V,pe=oe-le;return f.map(Y,0,1,le+ie*pe,le+se*pe)}}y.forEach(function(le){ee=le.length(),U?(P.push(le.scale(T(m,v,F,B,ee))),A.push(le.scale(T(-h,-p,F,B,ee)))):(P.push(le.scale(m)),A.push(le.scale(-h))),B+=ee}),A=A.map(function(le){return L=le.points,L[3]?le.points=[L[3],L[2],L[1],L[0]]:le.points=[L[2],L[1],L[0]],le}).reverse();var I=P[0].points[0],_=P[E-1].points[P[E-1].points.length-1],D=A[E-1].points[A[E-1].points.length-1],z=A[0].points[0],M=f.makeline(D,I),q=f.makeline(_,z),J=[M].concat(P).concat([q]).concat(A),ee=J.length;return new d(J)},outlineshapes:function(m,h,v){h=h||m;for(var p=this.outline(m,h).curves,y=[],E=1,P=p.length;E<P/2;E++){var A=f.makeshape(p[E],p[P-E],v);A.startcap.virtual=E>1,A.endcap.virtual=E<P/2-1,y.push(A)}return y},intersects:function(m,h){return m?m.p1&&m.p2?this.lineIntersects(m):(m instanceof w&&(m=m.reduce()),this.curveintersects(this.reduce(),m,h)):this.selfintersects(h)},lineIntersects:function(m){var h=t(m.p1.x,m.p2.x),v=t(m.p1.y,m.p2.y),p=r(m.p1.x,m.p2.x),y=r(m.p1.y,m.p2.y),E=this;return f.roots(this.points,m).filter(function(P){var A=E.get(P);return f.between(A.x,h,p)&&f.between(A.y,v,y)})},selfintersects:function(m){var h=this.reduce(),v,p=h.length-2,y=[],E,P,A;for(v=0;v<p;v++)P=h.slice(v,v+1),A=h.slice(v+2),E=this.curveintersects(P,A,m),y=y.concat(E);return y},curveintersects:function(m,h,v){var p=[];m.forEach(function(E){h.forEach(function(P){E.overlaps(P)&&p.push({left:E,right:P})})});var y=[];return p.forEach(function(E){var P=f.pairiteration(E.left,E.right,v);P.length>0&&(y=y.concat(P))}),y},arcs:function(m){m=m||.5;var h=[];return this._iterate(m,h)},_error:function(m,h,v,p){var y=(p-v)/4,E=this.get(v+y),P=this.get(p-y),A=f.dist(m,h),L=f.dist(m,E),B=f.dist(m,P);return e(L-A)+e(B-A)},_iterate:function(m,h){var v=0,p=1,y;do{y=0,p=1;var E=this.get(v),P,A,L,B,F=!1,U=!1,T,I=p,_=1;do{U=F,B=L,I=(v+p)/2,P=this.get(I),A=this.get(p),L=f.getccenter(E,P,A),L.interval={start:v,end:p};var D=this._error(L,E,v,p);if(F=D<=m,T=U&&!F,T||(_=p),F){if(p>=1){if(L.interval.end=_=1,B=L,p>1){var z={x:L.x+L.r*n(L.e),y:L.y+L.r*i(L.e)};L.e+=f.angle({x:L.x,y:L.y},z,this.get(1))}break}p=p+(p-v)/2}else p=I}while(!T&&y++<100);if(y>=100)break;B=B||L,h.push(B),v=_}while(p<1);return h}},bezier.exports=w}()),bezierExports}var hasRequiredBezierJs;function requireBezierJs(){return hasRequiredBezierJs||(hasRequiredBezierJs=1,function(e){e.exports=requireBezier()}(bezierJs)),bezierJsExports}var MakerJs;(function(MakerJs){MakerJs.version="debug",MakerJs.environmentTypes={BrowserUI:"browser",NodeJs:"node",WebWorker:"worker",Unknown:"unknown"};var EPSILON=Number.EPSILON||Math.pow(2,-52);function tryEval(name){try{var value=eval(name);return value}catch(e){}}function detectEnvironment(){return tryEval("WorkerGlobalScope")&&tryEval("self")?MakerJs.environmentTypes.WebWorker:tryEval("window")&&tryEval("document")?MakerJs.environmentTypes.BrowserUI:tryEval("global")&&tryEval("process")?MakerJs.environmentTypes.NodeJs:MakerJs.environmentTypes.Unknown}MakerJs.environment=detectEnvironment(),MakerJs.unitType={Centimeter:"cm",Foot:"foot",Inch:"inch",Meter:"m",Millimeter:"mm"};function split(e,t){var r=e.indexOf(t);return r<0?[e]:r>0?[e.substr(0,r),e.substr(r+1)]:["",e]}function splitDecimal(e){var t=e.toString();return t.indexOf("e")>0&&(t=e.toFixed(20).match(/.*[^(0+$)]/)[0]),split(t,".")}MakerJs.splitDecimal=splitDecimal;function round(e,t){if(t===void 0&&(t=1e-7),e%1===0)return e;var r=1/t;return Math.round((e+EPSILON)*r)/r}MakerJs.round=round;function createRouteKey(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i;r%2===0?i=(r>0?".":"")+n:i=JSON.stringify([n]),t.push(i)}return t.join("")}MakerJs.createRouteKey=createRouteKey;function travel(e,t){if(!e||!t)return null;var r;Array.isArray(t)?r=t:r=JSON.parse(t);for(var n=r.slice(),i=e,o=e.origin||[0,0];n.length;){var a=n.shift();if(i=i[a],!i)return null;i.origin&&n.length&&(o=MakerJs.point.add(o,i.origin))}return{result:i,offset:o}}MakerJs.travel=travel;var clone=cloneExports;function cloneObject(e){return clone(e)}MakerJs.cloneObject=cloneObject;function extendObject(e,t){if(e&&t)for(var r in t)typeof t[r]<"u"&&(e[r]=t[r]);return e}MakerJs.extendObject=extendObject;function isFunction(e){return typeof e=="function"}MakerJs.isFunction=isFunction;function isNumber(e){return typeof e=="number"}MakerJs.isNumber=isNumber;function isObject(e){return typeof e=="object"}MakerJs.isObject=isObject;function isPoint(e){return e&&Array.isArray(e)&&e.length==2&&isNumber(e[0])&&isNumber(e[1])}MakerJs.isPoint=isPoint;function isPath(e){return e&&e.type&&isPoint(e.origin)}MakerJs.isPath=isPath;function isPathLine(e){return isPath(e)&&e.type==MakerJs.pathType.Line&&isPoint(e.end)}MakerJs.isPathLine=isPathLine;function isPathCircle(e){return isPath(e)&&e.type==MakerJs.pathType.Circle&&isNumber(e.radius)}MakerJs.isPathCircle=isPathCircle;function isPathArc(e){return isPath(e)&&e.type==MakerJs.pathType.Arc&&isNumber(e.radius)&&isNumber(e.startAngle)&&isNumber(e.endAngle)}MakerJs.isPathArc=isPathArc;function isPathArcInBezierCurve(e){return isPathArc(e)&&isObject(e.bezierData)&&isNumber(e.bezierData.startT)&&isNumber(e.bezierData.endT)}MakerJs.isPathArcInBezierCurve=isPathArcInBezierCurve,MakerJs.pathType={Line:"line",Circle:"circle",Arc:"arc",BezierSeed:"bezier-seed"};function isModel(e){return e&&(e.paths||e.models)}MakerJs.isModel=isModel;function isChain(e){var t=e;return t&&t.links&&Array.isArray(t.links)&&isNumber(t.pathLength)}MakerJs.isChain=isChain;var Cascade=function(){function e(t,r){this._module=t,this.$initial=r;for(var n in this._module)this._shadow(n);this.$result=r}return e.prototype._shadow=function(t){var r=this;this[t]=function(){return r._apply(r._module[t],arguments)}},e.prototype._apply=function(t,r){var n=[].slice.call(r);return n.unshift(this.$result),this.$result=t.apply(void 0,n),this},e.prototype.$reset=function(){return this.$result=this.$initial,this},e}();function $(e){if(isModel(e))return new Cascade(MakerJs.model,e);if(isPath(e))return new Cascade(MakerJs.path,e);if(isPoint(e))return new Cascade(MakerJs.point,e)}MakerJs.$=$})(MakerJs||(MakerJs={}));var dist=MakerJs,MakerJs;(function(e){(function(t){function r(p){return e.splitDecimal(p)[1]}function n(p,y){return y?+(e.splitDecimal(p)[0]+"."+y):p}function i(p,y){return p<0&&y<0||p>0&&y>0?n(y,r(p)):y}function o(p){var y=Math.floor(p/360);if(y===0)return p;var E=p-360*y;return i(p,E)}t.noRevolutions=o;function a(p){return o(p)*Math.PI/180}t.toRadians=a;function s(p){return p*180/Math.PI}t.toDegrees=s;function u(p){if(p.endAngle<p.startAngle){var y=Math.ceil((p.startAngle-p.endAngle)/360),E=y*360+p.endAngle;return i(p.endAngle,E)}return p.endAngle}t.ofArcEnd=u;function f(p,y){return y===void 0&&(y=.5),p.startAngle+d(p)*y}t.ofArcMiddle=f;function d(p){var y=t.ofArcEnd(p),E=y-p.startAngle;return e.round(E)>360?o(E):E}t.ofArcSpan=d;function w(p){return o(s(S(p.origin,p.end)))}t.ofLineInDegrees=w;function b(p,y){return s(S(p,y))}t.ofPointInDegrees=b;function S(p,y){var E=e.point.subtract(y,p),P=E[0],A=E[1];return Math.atan2(-A,-P)+Math.PI}t.ofPointInRadians=S;function x(p,y,E){return E&&(p=360-p),y&&(p=(p<180?180:540)-p),p}t.mirror=x;var m={};m[e.pathType.Arc]=function(p,y,E){var P=y!=E,A=P?p.endAngle-90:p.startAngle+90,L=e.point.fromArc(p)[P?1:0],B=e.point.rotate(e.point.add(L,[p.radius,0]),A,L);return new e.paths.Line(y?[B,L]:[L,B])},m[e.pathType.Line]=function(p,y,E){return E?new e.paths.Line(p.end,p.origin):p};function h(p,y){if(p){var E=p.walkedPath.pathContext,P=m[E.type];if(P)return P(E,y,p.reversed)}}function v(p,y){if(arguments.length<2)return null;var E=[p,y].map(function(A,L){return h(A,L===0)}),P=o(w(E[1])-w(E[0]));return P>180&&(P-=360),P}t.ofChainLinkJoint=v})(e.angle||(e.angle={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(F,U,T){var I=i(F);if(!U)return I;for(var _=2;_--;)T?I[_]-=U[_]:I[_]+=U[_];return I}t.add=r;function n(F,U){function T(I){return(F[I]+U[I])/2}return[T(0),T(1)]}t.average=n;function i(F){return F?[F[0],F[1]]:t.zero()}t.clone=i;function o(F,U){for(var T={index:0,distance:-1},I=0;I<U.length;I++){var _=e.measure.pointDistance(F,U[I]);(T.distance==-1||_<T.distance)&&(T.distance=_,T.index=I)}return U[T.index]}t.closest=o;var a={};a[Math.PI/2]=!0,a[3*Math.PI/2]=!0;var s={};s[Math.PI]=!0,s[2*Math.PI]=!0;function u(F,U){return[F in a?0:e.round(U*Math.cos(F)),F in s?0:e.round(U*Math.sin(F))]}t.fromPolar=u;function f(F,U){return r(U.origin,u(e.angle.toRadians(F),U.radius))}t.fromAngleOnCircle=f;function d(F){return[f(F.startAngle,F),f(F.endAngle,F)]}t.fromArc=d;var w={};w[e.pathType.Arc]=function(F){return t.fromArc(F)},w[e.pathType.Line]=function(F){return[F.origin,F.end]},w[e.pathType.BezierSeed]=w[e.pathType.Line];function b(F,U){var T=null,I=w[F.type];return I&&(T=I(F),U&&(T=T.map(function(_){return r(_,U)}))),T}t.fromPathEnds=b;function S(F,U){var T=F.origin[0],I=U.slope*T+U.yIntercept;return[T,I]}function x(F,U,T){T===void 0&&(T={});var I=e.measure.lineSlope(F),_=e.measure.lineSlope(U);if(e.measure.isSlopeParallel(I,_))return e.measure.isSlopeEqual(I,_)&&(T.out_AreOverlapped=e.measure.isLineOverlapping(F,U,T.excludeTangents)),null;var D;if(!I.hasSlope)D=S(F,_);else if(!_.hasSlope)D=S(U,I);else{var z=(_.yIntercept-I.yIntercept)/(I.slope-_.slope),M=I.slope*z+I.yIntercept;D=[z,M]}return D}t.fromSlopeIntersection=x;function m(F,U){return t.add(F.origin,t.fromPolar(e.angle.toRadians(U),F.radius))}var h={};h[e.pathType.Arc]=function(F,U){var T=e.angle.ofArcMiddle(F,U);return m(F,T)},h[e.pathType.Circle]=function(F,U){return m(F,360*U)},h[e.pathType.Line]=function(F,U){function T(I,_){return I+(_-I)*U}return[T(F.origin[0],F.end[0]),T(F.origin[1],F.end[1])]},h[e.pathType.BezierSeed]=function(F,U){return e.models.BezierCurve.computePoint(F,U)};function v(F,U){U===void 0&&(U=.5);var T=null,I=h[F.type];return I&&(T=I(F,U)),T}t.middle=v;function p(F,U,T){var I=i(F);return U&&(I[0]=-I[0]),T&&(I[1]=-I[1]),I}t.mirror=p;function y(F,U){return[e.round(F[0],U),e.round(F[1],U)]}t.rounded=y;function E(F,U,T){T===void 0&&(T=[0,0]);var I=e.angle.ofPointInRadians(T,F),_=e.measure.pointDistance(T,F),D=u(I+e.angle.toRadians(U),_);return r(T,D)}t.rotate=E;function P(F,U){for(var T=i(F),I=2;I--;)T[I]*=U;return T}t.scale=P;function A(F,U,T){return[F[0]*U,F[1]*T]}t.distort=A;function L(F,U){return r(F,U,!0)}t.subtract=L;function B(){return[0,0]}t.zero=B})(e.point||(e.point={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(_,D,z,M){return M===void 0&&(M=!1),e.model.addPath(D,_,z,M),_}t.addTo=r;function n(_,D){_&&D&&typeof _.layer<"u"&&(D.layer=_.layer),_&&D&&"bezierData"in _&&(D.bezierData=_.bezierData)}var i={};i[e.pathType.Circle]=function(_,D,z){D.radius=_.radius},i[e.pathType.Arc]=function(_,D,z){i[e.pathType.Circle](_,D,z),D.startAngle=_.startAngle,D.endAngle=_.endAngle},i[e.pathType.Line]=function(_,D,z){D.end=e.point.add(_.end,z)},i[e.pathType.BezierSeed]=function(_,D,z){i[e.pathType.Line](_,D,z),D.controls=_.controls.map(function(M){return e.point.add(M,z)})};function o(_,D){var z={type:_.type,origin:e.point.add(_.origin,D)},M=i[_.type];return M&&M(_,z,D),n(_,z),z}t.clone=o;function a(_,D){var z=i[_.type];return z&&(D.origin=e.point.clone(_.origin),z(_,D)),n(_,D),_}t.copyProps=a;var s={};s[e.pathType.Line]=function(_,D,z,M){return new e.paths.Line(D,e.point.mirror(_.end,z,M))},s[e.pathType.Circle]=function(_,D,z,M){return new e.paths.Circle(D,_.radius)},s[e.pathType.Arc]=function(_,D,z,M){var q=e.angle.mirror(_.startAngle,z,M),J=e.angle.mirror(e.angle.ofArcEnd(_),z,M),ee=z!=M;return new e.paths.Arc(D,_.radius,ee?J:q,ee?q:J)},s[e.pathType.BezierSeed]=function(_,D,z,M){var q=s[e.pathType.Line](_,D,z,M);return q.type=e.pathType.BezierSeed,q.controls=_.controls.map(function(J){return e.point.mirror(J,z,M)}),q};function u(_,D){return _.layer=D,_}t.layer=u;function f(_,D,z){var M=null;if(_){var q=e.point.mirror(_.origin,D,z),J=s[_.type];J&&(M=J(_,q,D,z))}return n(_,M),M}t.mirror=f;var d={};d[e.pathType.Line]=function(_,D){var z=e.point.subtract(_.end,_.origin);_.end=e.point.add(D,z)};function w(_,D){if(_){var z=d[_.type];z&&z(_,D),_.origin=D}return _}t.move=w;var b={};b[e.pathType.Line]=function(_,D,z){_.end=e.point.add(_.end,D,z)},b[e.pathType.BezierSeed]=function(_,D,z){b[e.pathType.Line](_,D,z),_.controls=_.controls.map(function(M){return e.point.add(M,D,z)})};function S(_,D,z){if(_&&D){_.origin=e.point.add(_.origin,D,z);var M=b[_.type];M&&M(_,D,z)}return _}t.moveRelative=S;function x(_,D,z){var M=!1;function q(J,ee){D[ee]&&S(J,D[ee],M)}_.map(q),z(),M=!0,_.map(q)}t.moveTemporary=x;var m={};m[e.pathType.Line]=function(_,D,z){_.end=e.point.rotate(_.end,D,z)},m[e.pathType.Arc]=function(_,D,z){_.startAngle=e.angle.noRevolutions(_.startAngle+D),_.endAngle=e.angle.noRevolutions(_.endAngle+D)},m[e.pathType.BezierSeed]=function(_,D,z){m[e.pathType.Line](_,D,z),_.controls=_.controls.map(function(M){return e.point.rotate(M,D,z)})};function h(_,D,z){if(z===void 0&&(z=[0,0]),!_||!D)return _;_.origin=e.point.rotate(_.origin,D,z);var M=m[_.type];return M&&M(_,D,z),_}t.rotate=h;var v={};v[e.pathType.Line]=function(_,D){_.end=e.point.scale(_.end,D)},v[e.pathType.BezierSeed]=function(_,D){v[e.pathType.Line](_,D),_.controls=_.controls.map(function(z){return e.point.scale(z,D)})},v[e.pathType.Circle]=function(_,D){_.radius*=D},v[e.pathType.Arc]=v[e.pathType.Circle];function p(_,D){if(!_||D===1||!D)return _;_.origin=e.point.scale(_.origin,D);var z=v[_.type];return z&&z(_,D),_}t.scale=p;var y={};y[e.pathType.Arc]=function(_,D,z){return new e.models.EllipticArc(_,D,z)},y[e.pathType.Circle]=function(_,D,z){var M=new e.models.Ellipse(_.radius*D,_.radius*z);return M.origin=e.point.distort(_.origin,D,z),M},y[e.pathType.Line]=function(_,D,z){return new e.paths.Line([_.origin,_.end].map(function(M){return e.point.distort(M,D,z)}))},y[e.pathType.BezierSeed]=function(_,D,z){var M=e.point.distort;return{type:e.pathType.BezierSeed,origin:M(_.origin,D,z),controls:_.controls.map(function(q){return M(q,D,z)}),end:M(_.end,D,z)}};function E(_,D,z){if(!_||!D||!z)return null;var M=y[_.type];if(M){var q=M(_,D,z);return typeof _.layer<"u"&&(q.layer=_.layer),q}return null}t.distort=E;function P(_,D,z,M){var q=e.point.fromSlopeIntersection(_,D);if(q){let le=function(oe,V){var H;V?H=oe.origin:H=oe.end,H[0]=q[0],H[1]=q[1]};var J=[_,D],ee=[z,M];arguments.length===2&&J.forEach(function(oe,V){ee[V]=e.point.closest(q,[oe.origin,oe.end])===oe.origin}),J.forEach(function(oe,V){le(oe,ee[V])})}return q}t.converge=P;var A={};A[e.pathType.Arc]=function(_,D,z,M){var q=e.angle.ofArcSpan(_),J=(D+z)*q/D-q;M?_.startAngle-=J:_.endAngle+=J},A[e.pathType.Circle]=function(_,D,z,M){_.radius*=(D+z)/D},A[e.pathType.Line]=function(_,D,z,M){var q=e.point.scale(e.point.subtract(_.end,_.origin),z/D);M?_.origin=e.point.subtract(_.origin,q):_.end=e.point.add(_.end,q)};function L(_,D,z){if(z===void 0&&(z=!1),!_||!D)return null;var M=A[_.type];if(M){var q=e.measure.pathLength(_);return!q||-D>=q?null:(M(_,q,D,z),_)}return null}t.alterLength=L;function B(_,D){if(D==1)return[e.point.middle(_)];var z=[],M=D;_.type!=e.pathType.Circle&&M--;for(var q=0;q<D;q++)z.push(e.point.middle(_,q/M));return z}t.toPoints=B;var F={};F[e.pathType.Line]=function(_){return 2},F[e.pathType.Circle]=function(_,D){var z=e.measure.pathLength(_);return z?(D=D||z,Math.max(8,Math.ceil(z/(D||z)))):0},F[e.pathType.Arc]=function(_,D){var z=e.measure.pathLength(_);if(!z)return 0;var M=Math.ceil(e.angle.ofArcSpan(_)/45)+1;return Math.max(M,Math.ceil(z/(D||z)))};function U(_,D){if(_.type==e.pathType.BezierSeed){var z=new e.models.BezierCurve(_),M;return e.model.findChains(z,function(ee,le,oe){if(ee.length==1){var V=ee[0];switch(V.links[0].walkedPath.pathId){case"arc_0":case"line_0":break;default:e.chain.reverse(V)}M=e.chain.toKeyPoints(V)}else le.length===1&&(M=U(le[0].pathContext))}),M}else{var q=F[_.type];if(q){var J=q(_,D);if(J)return B(_,J)}}return[]}t.toKeyPoints=U;function T(_){var D=e.measure.pathExtents(_),z=e.point.average(D.high,D.low),M=e.point.subtract(_.origin||[0,0],z);return w(_,M),_}t.center=T;function I(_){var D=e.measure.pathExtents(_),z=e.point.subtract(_.origin||[0,0],D.low);return w(_,z),_}t.zero=I})(e.path||(e.path={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r={};r[e.pathType.Arc]=function(i,o){var a=e.angle.ofPointInDegrees(i.origin,o);if(e.measure.isAngleEqual(a,i.startAngle)||e.measure.isAngleEqual(a,i.endAngle))return null;function s(){for(var w=e.angle.noRevolutions(i.startAngle),b=w+e.angle.ofArcEnd(i)-i.startAngle,S=[0,1,-1],x=0;x<S.length;x++){var m=360*S[x];if(e.measure.isBetween(a+m,w,b,!0))return i.startAngle+a+m-w}return null}var u=s();if(u==null)return null;var f=i.endAngle;i.endAngle=u;var d=e.cloneObject(i);return d.startAngle=u,d.endAngle=f,d},r[e.pathType.Circle]=function(i,o){i.type=e.pathType.Arc;var a=i,s=e.angle.ofPointInDegrees(i.origin,o);return a.startAngle=s,a.endAngle=s+360,null},r[e.pathType.Line]=function(i,o){if(!e.measure.isBetweenPoints(o,i,!0))return null;var a=i.end;i.end=o;var s=e.cloneObject(i);return s.origin=o,s.end=a,s};function n(i,o){if(i&&o){var a=r[i.type];if(a){var s=a(i,o);return s&&"layer"in i&&(s.layer=i.layer),s}}return null}t.breakAtPoint=n})(e.path||(e.path={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function s(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];var d,w;function b(F){var U=e.angle.ofPointInDegrees(F,u[B?1:0]),T=e.angle.ofPointInDegrees(F,u[B?0:1]);return T<U&&(T+=360),{origin:F,startAngle:U,endAngle:T,size:T-U}}switch(u.length){case 5:var S=u[0],x=u[1];this.radius=u[2];var m=u[3],B=u[4],h,v=e.measure.pointDistance(S,x)/2;if(e.round(this.radius-v)<=0)this.radius=v,h=b(e.point.average(S,x));else{for(var p=(w=(d=e.path.intersection(new n(S,this.radius),new n(x,this.radius)))===null||d===void 0?void 0:d.intersectionPoints)!==null&&w!==void 0?w:[S,x],y=[],E=p.length;E--;)h=b(p[E]),y.length==0||h.size>y[0].size?y.push(h):y.unshift(h);var P=m?1:0;h=y[P]}this.origin=h.origin,this.startAngle=h.startAngle,this.endAngle=h.endAngle;break;case 4:this.origin=u[0],this.radius=u[1],this.startAngle=u[2],this.endAngle=u[3];break;case 3:if(e.isPoint(u[2])){n.apply(this,u);for(var A=[],L=0;L<3;L++)A.push(e.angle.ofPointInDegrees(this.origin,u[L]));this.startAngle=A[0],this.endAngle=A[2],e.measure.isBetweenArcAngles(A[1],this,!1)||(this.startAngle=A[2],this.endAngle=A[0]);break}case 2:var B=u[2];n.call(this,u[0],u[1]),this.startAngle=e.angle.ofPointInDegrees(this.origin,u[B?1:0]),this.endAngle=e.angle.ofPointInDegrees(this.origin,u[B?0:1]);break}this.type=e.pathType.Arc}return s}();t.Arc=r;var n=function(){function s(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];switch(this.type=e.pathType.Circle,u.length){case 1:this.origin=[0,0],this.radius=u[0];break;case 2:e.isNumber(u[1])?(this.origin=u[0],this.radius=u[1]):(this.origin=e.point.average(u[0],u[1]),this.radius=e.measure.pointDistance(this.origin,u[0]));break;default:for(var d=[new i(u[0],u[1]),new i(u[1],u[2])],w=[],b=2;b--;){var S=e.point.middle(d[b]);w.push(e.path.rotate(d[b],90,S))}var x=e.point.fromSlopeIntersection(w[0],w[1]);if(x)this.origin=x,this.radius=e.measure.pointDistance(this.origin,u[0]);else throw"invalid parameters - attempted to construct a circle from 3 points on a line: "+JSON.stringify(u);break}}return s}();t.Circle=n;var i=function(){function s(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];switch(this.type=e.pathType.Line,u.length){case 1:var d=u[0];this.origin=d[0],this.end=d[1];break;case 2:this.origin=u[0],this.end=u[1];break}}return s}();t.Line=i;var o=function(){function s(u){var f=e.point.fromArc(u);this.type=e.pathType.Line,this.origin=f[0],this.end=f[1]}return s}();t.Chord=o;var a=function(){function s(u,f,d){this.type=e.pathType.Line,this.origin=e.point.clone(u.origin),this.end=e.point.clone(u.end);var w=e.angle.ofLineInDegrees(this);function b(m){var h=e.point.add(u.origin,e.point.fromPolar(e.angle.toRadians(w+m),f));return{origin:h,nearness:e.measure.pointDistance(h,d)}}var S=[b(-90),b(90)],x=S[0].nearness<S[1].nearness?S[0].origin:S[1].origin;e.path.move(this,x)}return s}();t.Parallel=a})(e.paths||(e.paths={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(T,I,_,D){return _||(_=e.point.zero()),D||(D=e.point.clone(_)),T.caption={text:I,anchor:new e.paths.Line(_,D)},T}t.addCaption=r;function n(T,I,_,D){D===void 0&&(D=!1);var z=D?_:w(T,_);return T.paths=T.paths||{},T.paths[z]=I,T}t.addPath=n;function i(T,I,_,D){D===void 0&&(D=!1);var z=D?_:d(T,_);return T.models=T.models||{},T.models[z]=I,T}t.addModel=i;function o(T,I,_,D){return D===void 0&&(D=!1),i(I,T,_,D),T}t.addTo=o;function a(T){return e.cloneObject(T)}t.clone=a;function s(T){var I=0;if(T.models)for(var _ in T.models)I++;return I}t.countChildModels=s;function u(T){var I=[];function _(D,z,M){D.caption&&I.push({text:D.caption.text,anchor:e.path.clone(D.caption.anchor,e.point.add(D.origin,z)),layer:D.caption.anchor.layer||M})}return _(T,T.origin,T.layer),t.walk(T,{afterChildWalk:function(D){return _(D.childModel,D.offset,D.layer)}}),I}t.getAllCaptionsOffset=u;function f(T,I){if(!T)return I;for(var _=0,D=I;D in T;)_++,D=[I,_].join("_");return D}function d(T,I){return f(T.models,I)}t.getSimilarModelId=d;function w(T,I){return f(T.paths,I)}t.getSimilarPathId=w;function b(T,I){return T.layer=I,T}t.layer=b;function S(T,I){function _(D,z){if(D){var M=e.point.add(D.origin,z);if(D.type===e.models.BezierCurve.typeName&&e.path.moveRelative(D.seed,M),D.paths)for(var q in D.paths)e.path.moveRelative(D.paths[q],M);if(D.models)for(var q in D.models)_(D.models[q],M);D.caption&&e.path.moveRelative(D.caption.anchor,M),D.origin=e.point.zero()}}return _(T,I?e.point.subtract([0,0],I):[0,0]),I&&(T.origin=I),T}t.originate=S;function x(T,I,_){I===void 0&&(I=!0),_===void 0&&(_=!0);var D=e.measure.modelExtents(T),z=T.origin||[0,0];return I&&(z[0]-=D.center[0]),_&&(z[1]-=D.center[1]),T.origin=z,T}t.center=x;function m(T,I,_){var D={};if(!T)return null;if(T.origin&&(D.origin=e.point.mirror(T.origin,I,_)),T.type&&(D.type=T.type),"layer"in T&&(D.layer=T.layer),T.units&&(D.units=T.units),T.type===e.models.BezierCurve.typeName&&(D.type=e.models.BezierCurve.typeName,D.seed=e.path.mirror(T.seed,I,_)),T.paths){D.paths={};for(var z in T.paths){var M=T.paths[z];if(M){var q=e.path.mirror(M,I,_);q&&(D.paths[z]=q)}}}if(T.models){D.models={};for(var z in T.models){var J=T.models[z];if(J){var ee=m(J,I,_);ee&&(D.models[z]=ee)}}}return T.caption&&(D.caption=e.cloneObject(T.caption),D.caption.anchor=e.path.mirror(T.caption.anchor,I,_)),D}t.mirror=m;function h(T,I){return T.origin=e.point.clone(I),T}t.move=h;function v(T,I){return T&&(T.origin=e.point.add(T.origin||e.point.zero(),I)),T}t.moveRelative=v;function p(T,I){var _=[];F(T,{onPath:function(M){_.push(M)}});for(var D=0;D<_.length;D++){var z=_[D];delete z.modelContext.paths[z.pathId],z.modelContext.paths[I+z.pathId]=z.pathContext}return T}t.prefixPathIds=p;function y(T,I,_){if(_===void 0&&(_=[0,0]),!T||!I)return T;var D=e.point.subtract(_,T.origin);if(T.type===e.models.BezierCurve.typeName&&e.path.rotate(T.seed,I,D),T.paths)for(var z in T.paths)e.path.rotate(T.paths[z],I,D);if(T.models)for(var z in T.models)y(T.models[z],I,D);return T.caption&&e.path.rotate(T.caption.anchor,I,D),T}t.rotate=y;function E(T,I,_){if(_===void 0&&(_=!1),_&&T.origin&&(T.origin=e.point.scale(T.origin,I)),T.type===e.models.BezierCurve.typeName&&e.path.scale(T.seed,I),T.paths)for(var D in T.paths)e.path.scale(T.paths[D],I);if(T.models)for(var D in T.models)E(T.models[D],I,!0);return T.caption&&e.path.scale(T.caption.anchor,I),T}t.scale=E;function P(T,I,_,D,z,M,q){var J=e.path.distort(I,z,M);if(D=D||I.layer,D&&(J.layer=D),e.isPath(J))if(J.type===e.pathType.BezierSeed){var ee=new e.models.BezierCurve(J,q);i(T,ee,_)}else n(T,J,_);else i(T,J,_)}function A(T,I,_,D,z){D===void 0&&(D=!1);var M={};if(T.layer&&(M.layer=T.layer),D&&T.origin&&(M.origin=e.point.distort(T.origin,I,_)),T.type===e.models.BezierCurve.typeName){var q=T,J=e.models.BezierCurve.getBezierSeeds(q,{byLayers:!0}),ee=function(ie){var se=J[ie];se.forEach(function(pe,ae){P(M,pe,ae.toString(),ie,I,_,z)})};for(var le in J)ee(le)}else if(T.paths)for(var oe in T.paths){var V=T.paths[oe];P(M,V,oe,null,I,_,z)}if(T.models)for(var H in T.models){var X=T.models[H],Y=A(X,I,_,!0,z);i(M,Y,H)}return T.caption&&(M.caption=e.cloneObject(T.caption),M.caption.anchor=e.path.distort(T.caption.anchor,I,_)),M}t.distort=A;function L(T,I){if(T.units&&e.units.isValidUnit(T.units)&&e.units.isValidUnit(I)){var _=e.units.conversionScale(T.units,I);_!=1&&(E(T,_),T.units=I)}return T}t.convertUnits=L;function B(T,I){if(T.paths)for(var _ in T.paths)T.paths[_]&&I(T,_,T.paths[_]);if(T.models)for(var D in T.models)T.models[D]&&B(T.models[D],I)}t.walkPaths=B;function F(T,I){if(!T)return;function _(D,z,M,q,J){var ee=e.point.add(D.origin,M);if(z=z??"",D.paths)for(var le in D.paths){var oe=D.paths[le];if(oe){var V={modelContext:D,layer:oe.layer!=null?oe.layer:z,offset:ee,pathContext:oe,pathId:le,route:q.concat(["paths",le]),routeKey:J+(J?".":"")+"paths"+JSON.stringify([le])};I.onPath&&I.onPath(V)}}if(D.models)for(var H in D.models){var X=D.models[H];if(X){var Y={parentModel:D,layer:X.layer!=null?X.layer:z,offset:ee,route:q.concat(["models",H]),routeKey:J+(J?".":"")+"models"+JSON.stringify([H]),childId:H,childModel:X};I.beforeChildWalk&&!I.beforeChildWalk(Y)||(_(Y.childModel,Y.layer,ee,Y.route,Y.routeKey),I.afterChildWalk&&I.afterChildWalk(Y))}}}return _(T,T.layer,[0,0],[],""),T}t.walk=F;function U(T,I,_){I===void 0&&(I=!0),_===void 0&&(_=!0);var D=e.measure.modelExtents(T),z=T.origin||[0,0];return I&&(z[0]-=D.low[0]),_&&(z[1]-=D.low[1]),T.origin=z,T}t.zero=U})(e.model||(e.model={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(x,m){var h=e.cloneObject(x);if(!h)return null;var v=e.path.breakAtPoint(h,m);if(v){for(var p=[h,v],y=2;y--;)if(e.round(e.measure.pathLength(p[y]),1e-4)==0)return null;return p}else if(x.type==e.pathType.Circle)return[h];return null}function n(x,m,h){var v=[];return x.forEach(function(p){e.measure.isPointOnPath(p,m,1e-5,null,h)&&v.push(p)}),v}function i(x,m,h){var v=h.pathContext,p=x.segments;if(e.measure.isPathEqual(p[0].absolutePath,v,1e-4,null,h.offset)){p[0].overlapped=!0,p[0].duplicate=!0,m.push(p[0]);return}for(var y={},E={path1Offset:x.offset,path2Offset:h.offset},P=e.path.intersection(x.pathContext,v,E),A=P?P.intersectionPoints:null,L=e.point.fromPathEnds(v,h.offset)||[],B=0;B<p.length;B++){var F=A?L.concat(A):L,U=n(F,p[B].absolutePath,y);if(E.out_AreOverlapped&&(p[B].overlapped=!0,m.push(p[B])),U.length>0){for(var T=null,I=0;!T&&I<U.length;)T=r(p[B].absolutePath,U[I]),I++;if(T){if(x.broken=!0,p[B].absolutePath=T[0],T[1]){var _={absolutePath:T[1],pathId:p[0].pathId,overlapped:p[B].overlapped,uniqueForeignIntersectionPoints:[]};p[B].overlapped&&m.push(_),p.push(_)}B--}}}}function o(x,m,h,v,p){var y={farPoint:v,measureAtlas:p},E=e.point.add(e.point.middle(x),h);return e.measure.isPointInsideModel(E,m,y)}t.isPathInsideModel=o;function a(x,m){var h=new e.measure.Atlas(x);h.measureModels();var v;return m?(v=new e.measure.Atlas(m),v.measureModels()):(m=x,v=h),s(x,m||x,!1,h,v),x}t.breakPathsAtIntersections=a;function s(x,m,h,v,p,y){var E=[],P=[],A={onPath:function(L){var B={absolutePath:e.path.clone(L.pathContext,L.offset),pathId:L.pathId,overlapped:!1,uniqueForeignIntersectionPoints:[]},F=L;F.broken=!1,F.segments=[B];var U={onPath:function(D){L.pathContext!==D.pathContext&&e.measure.isMeasurementOverlapping(v.pathMap[L.routeKey],p.pathMap[D.routeKey])&&i(F,P,D)},beforeChildWalk:function(D){var z=p.modelMap[D.routeKey];return z&&e.measure.isMeasurementOverlapping(v.pathMap[L.routeKey],z)}};if(t.walk(m,U),h)for(var T=0;T<F.segments.length;T++){var I=e.point.middle(F.segments[T].absolutePath),_={measureAtlas:p,farPoint:y};F.segments[T].isInside=e.measure.isPointInsideModel(I,m,_),F.segments[T].uniqueForeignIntersectionPoints=_.out_intersectionPoints}E.push(F)}};return t.walk(x,A),{crossedPaths:E,overlappedSegments:P}}function u(x,m,h){function v(E,P){e.measure.isPathEqual(E.absolutePath,P.absolutePath,h)&&(E.duplicate=P.duplicate=!0)}function p(E){for(var P=0;P<m.length;P++)v(m[P],E)}for(var y=0;y<x.length;y++)p(x[y])}function f(x,m,h,v,p,y){function E(B,F,U){var T=t.getSimilarPathId(B,F),I=T==F?x.routeKey:e.createRouteKey(x.route.slice(0,-1).concat([T]));if(U.addedPath=e.cloneObject(x.pathContext),U.addedPath.type=U.absolutePath.type,e.path.copyProps(U.absolutePath,U.addedPath),e.path.moveRelative(U.addedPath,x.offset,!0),B.paths[T]=U.addedPath,x.broken){var _=e.measure.pathExtents(U.absolutePath);p.pathMap[I]=_,p.modelsMeasured=!1}else p.pathMap[I]=A}function P(B,F,U){U.isInside&&m||!U.isInside&&h?E(B,F,U):(p.modelsMeasured=!1,y(U.absolutePath,x.routeKey,"segment is "+(U.isInside?"inside":"outside")+" intersectionPoints="+JSON.stringify(U.uniqueForeignIntersectionPoints)))}var A=p.pathMap[x.routeKey];delete x.modelContext.paths[x.pathId],delete p.pathMap[x.routeKey];for(var L=0;L<x.segments.length;L++)x.segments[L].duplicate?v?E(x.modelContext,x.pathId,x.segments[L]):y(x.segments[L].absolutePath,x.routeKey,"segment is duplicate"):P(x.modelContext,x.pathId,x.segments[L])}function d(x,m,h,v,p,y,E){h===void 0&&(h=!1),v===void 0&&(v=!0),p===void 0&&(p=!1),y===void 0&&(y=!0);var P={trimDeadEnds:!0,pointMatchingDistance:.005,out_deleted:[{paths:{}},{paths:{}}]};if(e.extendObject(P,E),P.measureA=P.measureA||new e.measure.Atlas(x),P.measureB=P.measureB||new e.measure.Atlas(m),P.measureA.measureModels(),P.measureB.measureModels(),!P.farPoint){var A=e.measure.increase(e.measure.increase({high:[null,null],low:[null,null]},P.measureA.modelMap[""]),P.measureB.modelMap[""]);P.farPoint=e.point.add(A.high,[1,1])}var L=s(x,m,!0,P.measureA,P.measureB,P.farPoint),B=s(m,x,!0,P.measureB,P.measureA,P.farPoint);u(L.overlappedSegments,B.overlappedSegments,P.pointMatchingDistance);function F(_,D,z,M){t.addPath(P.out_deleted[_],D,"deleted");var q=D;q.reason=M,q.routeKey=z}for(var U=0;U<L.crossedPaths.length;U++)f(L.crossedPaths[U],h,v,!0,P.measureA,function(_,D,z){return F(0,_,D,z)});for(var U=0;U<B.crossedPaths.length;U++)f(B.crossedPaths[U],p,y,!1,P.measureB,function(D,z,M){return F(1,D,z,M)});var T={models:{a:x,b:m}};if(P.trimDeadEnds){var I;!h&&!p&&(I=function(_){for(var D=0;D<L.overlappedSegments.length;D++)if(L.overlappedSegments[D].duplicate&&_.pathContext===L.overlappedSegments[D].addedPath)return!1;return!0}),t.removeDeadEnds(T,null,I,function(_,D){var z=_.route[1]==="a"?0:1;F(z,_.pathContext,_.routeKey,D)})}return e.extendObject(E,P),T}t.combine=d;function w(x,m){return d(x,m,!0,!1,!0,!1)}t.combineIntersection=w;function b(x,m){return d(x,m,!1,!0,!0,!1)}t.combineSubtraction=b;function S(x,m){return d(x,m,!1,!0,!1,!0)}t.combineUnion=S})(e.model||(e.model={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){var t=function(){function o(a){this.comparer=a,this.collections=[]}return o.prototype.addItemToCollection=function(a,s){var u=this.findCollection(a);if(u)u.push(s);else{var f={key:a,items:[s]};this.collections.push(f)}},o.prototype.findCollection=function(a,s){for(var u=0;u<this.collections.length;u++){var f=this.collections[u];if(this.comparer(a,f.key))return s&&s(u),f.items}return null},o.prototype.removeCollection=function(a){var s=this;return!!this.findCollection(a,function(u){s.collections.splice(u,1)})},o.prototype.removeItemFromCollection=function(a,s){var u=this.findCollection(a);if(u){for(var f=0;f<u.length;f++)if(u[f]===s)return u.splice(f,1),!0;return!1}},o.prototype.getCollectionsOfMultiple=function(a){for(var s=0;s<this.collections.length;s++){var u=this.collections[s];u.items.length>1&&a(u.key,u.items)}},o}();e.Collector=t;var r=require$$1,n=r.default||r,i=function(){function o(){this.reset()}return o.prototype.reset=function(){this.insertedCount=0,this.graph={},this.index={},this.merged={},this.values=[]},o.prototype.insertValue=function(a){return this.values.push(a),this.values.length-1},o.prototype.insertValueIdAtPoint=function(a,s){var u=s[0],f=s[1];this.graph[u]||(this.graph[u]={});var d=this.graph[u],w=f in d,b,S;return w?(S=d[f],S in this.merged&&(S=this.merged[S]),b=this.index[S],b.valueIds.push(a)):(d[f]=S=this.insertedCount++,b={pointId:S,point:s,valueIds:[a]},this.index[S]=b),{existed:w,pointId:S}},o.prototype.mergePoints=function(a){var s=this,u=[],f=[];for(var d in this.index){var w=this.index[d],b=w.point;w.kdId=u.length,u.push(b),f.push(w)}this.kdbush=n(u);var S=function(m){if(m in x.merged)return"continue";var h=x.index[m],v=x.kdbush.within(h.point[0],h.point[1],a);v.forEach(function(p){p!==h.kdId&&s.mergeIndexElements(h,f[p])})},x=this;for(var d in this.index)S(d)},o.prototype.mergeNearestSinglePoints=function(a){var s=this,u=[];for(var f in this.index){var d=this.index[f];d.valueIds.length===1&&u.push(d)}this.kdbush=n(u.map(function(w){return w.point})),u.forEach(function(w){if(!(w.pointId in s.merged)){var b=s.kdbush.within(w.point[0],w.point[1],a),S=[];b.forEach(function(h){var v=u[h];v.pointId!==w.pointId&&S.push({el:v,distance:e.measure.pointDistance(v.point,w.point)})}),S.sort(function(h,v){return h.distance-v.distance});for(var x=0;x<S.length;x++){var m=S[x].el;if(!(m.pointId in s.merged)){m.merged&&m.merged.length>0?s.mergeIndexElements(m,w):s.mergeIndexElements(w,m);return}}}})},o.prototype.mergeIndexElements=function(a,s){return a.merged=a.merged||[],a.merged.push(s.pointId),this.merged[s.pointId]=a.pointId,a.valueIds.push.apply(a.valueIds,s.valueIds),delete this.index[s.pointId],a.pointId},o.prototype.forEachPoint=function(a){for(var s=this,u=0;u<this.insertedCount;u++){var f=this.index[u];if(f){var d=f.valueIds.length;d>0&&a(f.point,f.valueIds.map(function(w){return s.values[w]}),u,f)}}},o.prototype.getIdOfPoint=function(a){var s=this.graph[a[0]];if(s){var u=s[a[1]];if(u>=0)return u in this.merged?this.merged[u]:u}},o.prototype.getElementAtPoint=function(a){var s=this.getIdOfPoint(a);if(s>=0)return this.index[s]},o}();e.PointGraph=i})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(i,o,a){var s=0;do{var u=i[s];do for(var f=!1,d=s+1;d<i.length;d++){var w=i[d];if(f=o(u.pathContext,w.pathContext,!1),f){a(u.pathContext,w.pathContext),delete w.modelContext.paths[w.pathId],i.splice(d,1);break}}while(f);s++}while(s<i.length)}function n(i,o){function a(S,x){if(Math.abs(S.radius-x.radius)<=w.scalarMatchingDistance){var m=e.measure.pointDistance(S.origin,x.origin);return m<=w.pointMatchingDistance}return!1}var s=new e.Collector(a),u=new e.Collector(a),f=new e.Collector(e.measure.isSlopeEqual),d={};d[e.pathType.Arc]=function(S){s.addItemToCollection(S.pathContext,S)},d[e.pathType.Circle]=function(S){u.addItemToCollection(S.pathContext,S)},d[e.pathType.Line]=function(S){var x=e.measure.lineSlope(S.pathContext);f.addItemToCollection(x,S)};var w={scalarMatchingDistance:.001,pointMatchingDistance:.005};e.extendObject(w,o);var b={onPath:function(S){var x=d[S.pathContext.type];x&&x(S)}};return t.walk(i,b),s.getCollectionsOfMultiple(function(S,x){r(x,e.measure.isArcOverlapping,function(m,h){var v=e.measure.isBetweenArcAngles(m.endAngle,h,!1),p=e.measure.isBetweenArcAngles(h.endAngle,m,!1);if(v&&p){m.endAngle=m.startAngle+360;return}var y=v?[m,h]:[h,m];m.startAngle=e.angle.noRevolutions(y[0].startAngle),m.endAngle=y[1].endAngle})}),u.getCollectionsOfMultiple(function(S,x){for(var m=1;m<x.length;m++){var h=x[m];delete h.modelContext.paths[h.pathId]}}),f.getCollectionsOfMultiple(function(S,x){r(x,e.measure.isLineOverlapping,function(m,h){var v={paths:{lineA:m,lineB:h}},p=e.measure.modelExtents(v);S.hasSlope?S.slope<0?(m.origin=[p.low[0],p.high[1]],m.end=[p.high[0],p.low[1]]):S.slope>0?(m.origin=p.low,m.end=p.high):(m.origin[0]=p.low[0],m.end[0]=p.high[0]):(m.origin[1]=p.low[1],m.end[1]=p.high[1])})}),i}t.simplify=n})(e.model||(e.model={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r={};r[e.pathType.Arc]=function(o,a,s){return new e.models.OvalArc(o.startAngle,o.endAngle,o.radius,a,!1,s)},r[e.pathType.Circle]=function(o,a,s){return new e.models.Ring(o.radius+a,o.radius-a)},r[e.pathType.Line]=function(o,a,s){return new e.models.Slot(o.origin,o.end,a,s)};function n(o,a,s){if(!o)return null;var u=null,f=r[o.type];return f&&(u=f(o,a,s),u.origin=o.origin),u}t.expand=n;function i(o,a,s,u){var f=e.angle.ofArcSpan(o),d=1;f>=270?d=4:f>180?d=3:(f>150||a)&&(d=2);for(var w=e.angle.toRadians(f/d),b=e.models.Polygon.circumscribedRadius(o.radius,w),S=e.point.fromArc(o),x=[e.point.subtract(S[0],o.origin)],m=e.angle.toRadians(o.startAngle)+w/2,h=0;h<d;h++)x.push(e.point.fromPolar(m,b)),m+=w;x.push(e.point.subtract(S[1],o.origin));var v=new e.models.ConnectTheDots(u,x);return v.origin=o.origin,typeof s=="string"&&s.length&&e.model.prefixPathIds(v,s),v}t.straighten=i})(e.path||(e.path={}))})(MakerJs||(MakerJs={})),function(e){(function(t){function r(a,s,u,f){if(u===void 0&&(u=0),f===void 0&&(f={}),s<=0)return null;var d={models:{expansions:{models:{}},caps:{models:{}}}},w=!0,b=f.farPoint,S={onPath:function(v){if(!(f.pointMatchingDistance&&e.measure.pathLength(v.pathContext)<f.pointMatchingDistance)){var p=e.path.expand(v.pathContext,s,!0);if(p){t.moveRelative(p,v.offset);var y=t.getSimilarModelId(d.models.expansions,v.pathId);if(t.prefixPathIds(p,v.pathId+"_"),t.originate(p),w||(t.combine(d,p,!1,!0,!1,!0,f),f.measureA.modelsMeasured=!1,b=f.farPoint,delete f.farPoint,delete f.measureB),d.models.expansions.models[y]=p,p.models){var E=p.models.Caps;E&&(delete p.models.Caps,d.models.caps.models[y]=E)}w=!1}}}};if(t.walk(a,S),u){var x=d.models.caps,m={models:{}};d.models.straightcaps=m,t.simplify(x);for(var h in x.models)m.models[h]={models:{}},t.walk(x.models[h],{onPath:function(v){var p=v.pathContext,y=e.path.straighten(p,u==2,v.pathId+"_",!0);t.combine(d,y,!1,!0,!1,!0,f),f.measureA.modelsMeasured=!1,b=f.farPoint,delete f.farPoint,delete f.measureB,m.models[h].models[v.pathId]=y,delete v.modelContext.paths[v.pathId]}});delete d.models.caps}return f.farPoint=b,d}t.expandPaths=r;function n(a){var s=[];return t.findChains(a,function(u,f,d){s=u.filter(function(w){return w.endless})}),s}function i(a){var s=n(a);if(s.length==0)return null;var u={models:{}};return s.forEach(function(f,d){u.models[d]=e.chain.toNewModel(f)}),u}function o(a,s,u,f,d){u===void 0&&(u=0),f===void 0&&(f=!1),d===void 0&&(d={});var w=r(a,s,u,d);if(!w)return null;var b=i(a);if(b){var S=0,x={models:{}},m=n(w);return m.forEach(function(h){var v=h.links[0].walkedPath,p=e.measure.isPointInsideModel(e.point.middle(v.pathContext),b,v.offset);(f&&p||!f&&!p)&&(x.models[S++]=e.chain.toNewModel(h))}),x}else return w}t.outline=o})(e.model||(e.model={}))}(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=e.unitType.Millimeter;function n(){a(e.unitType.Centimeter,10),a(e.unitType.Meter,1e3),a(e.unitType.Inch,25.4),a(e.unitType.Foot,25.4*12)}var i;function o(f,d,w){function b(S){return i[S]||(i[S]={}),i[S]}b(f)[d]=w,b(d)[f]=1/w}function a(f,d){o(f,r,d)}function s(f,d){return f==d?1:(i||(i={},n()),i[f][d]||o(f,d,i[f][r]*i[r][d]),i[f]&&i[f][d])}t.conversionScale=s;function u(f){for(var d in e.unitType)if(e.unitType[d]==f)return!0;return!1}t.isValidUnit=u})(e.units||(e.units={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(S,x,m){m===void 0&&(m=1e-4);var h=e.angle.noRevolutions(S),v=e.angle.noRevolutions(x),p=e.angle.noRevolutions(e.round(v-h,m));return p==0}t.isAngleEqual=r;var n={};n[e.pathType.Line]=function(S,x,m){return o(S.origin,x.origin,m)&&o(S.end,x.end,m)||o(S.origin,x.end,m)&&o(S.end,x.origin,m)},n[e.pathType.Circle]=function(S,x,m){return o(S.origin,x.origin,m)&&S.radius==x.radius},n[e.pathType.Arc]=function(S,x,m){return n[e.pathType.Circle](S,x,m)&&r(S.startAngle,x.startAngle)&&r(S.endAngle,x.endAngle)};function i(S,x,m,h,v){var p=!1;if(S.type==x.type){var y=n[S.type];if(y){let E=function(){p=y(S,x,m)};h||v?e.path.moveTemporary([S,x],[h,v],E):E()}}return p}t.isPathEqual=i;function o(S,x,m){if(m){if(!S||!x)return!1;var h=t.pointDistance(S,x);return h<=m}else return e.round(S[0]-x[0])==0&&e.round(S[1]-x[1])==0}t.isPointEqual=o;function a(S,x,m){for(var h=0;h<x.length;h++)if(o(x[h],S,m))return!1;return!0}t.isPointDistinct=a;function s(S,x,m){return m===void 0&&(m=0),x.hasSlope?Math.abs(S[1]-(x.slope*S[0]+x.yIntercept))<=m:Math.abs(S[0]-x.line.origin[0])<=m}t.isPointOnSlope=s;function u(S,x,m){m===void 0&&(m=0);var h=Math.abs(t.pointDistance(S,x.origin)-x.radius);return h<=m}t.isPointOnCircle=u;var f={};f[e.pathType.Circle]=function(S,x,m){return u(S,x,m)},f[e.pathType.Arc]=function(S,x,m){if(f[e.pathType.Circle](S,x,m)){var h=e.angle.ofPointInDegrees(x.origin,S);return t.isBetweenArcAngles(h,x,!1)}return!1},f[e.pathType.Line]=function(S,x,m,h){var v=h&&h.cachedLineSlope||t.lineSlope(x);return h&&!h.cachedLineSlope&&(h.cachedLineSlope=v),s(S,v,m)&&t.isBetweenPoints(S,x,!1)};function d(S,x,m,h,v){m===void 0&&(m=0);var p=f[x.type];if(p){var y=h?e.path.clone(x,h):x;return p(S,y,m,v)}return!1}t.isPointOnPath=d;function w(S,x){if(!b(S,x))return!1;if(!S.hasSlope&&!x.hasSlope)return e.round(S.line.origin[0]-x.line.origin[0])==0;var m=[S,x],h=m.map(function(E){return e.angle.toDegrees(Math.atan(E.slope))}),v=m.map(function(E){return e.path.clone(E.line)}),p=v[0].origin;v.forEach(function(E,P){return e.path.rotate(E,-h[P],p)});var y=v.map(function(E){return(E.origin[1]+E.end[1])/2});return e.round(y[0]-y[1],1e-5)==0}t.isSlopeEqual=w;function b(S,x){return!!(!S.hasSlope&&!x.hasSlope||S.hasSlope&&x.hasSlope&&e.round(S.slope-x.slope,1e-5)==0)}t.isSlopeParallel=b})(e.measure||(e.measure={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(V,H,X){function Y(ie,se,pe){if(se)for(var ae=2;ae--;)se[ae]!=null&&(ie[ae]==null?ie[ae]=se[ae]:ie[ae]=pe(ie[ae],se[ae]))}return H&&(Y(V.low,H.low,Math.min),Y(V.high,H.high,Math.max)),X&&U(V),V}t.increase=r;function n(V,H){if(v(V.origin,H)<=V.radius)return!0;var X=new e.paths.Line(e.point.middle(V),H),Y={},ie=e.path.intersection(X,new e.paths.Chord(V),Y);return!!(ie||Y.out_AreOverlapped)}t.isArcConcaveTowardsPoint=n;function i(V,H,X){return o(V,H,X)}t.isArcOverlapping=i;function o(V,H,X){function Y(ie,se){function pe(ae){return s(ae,ie,X)}return pe(se.startAngle)||pe(se.endAngle)}return Y(V,H)||Y(H,V)||V.startAngle==H.startAngle&&V.endAngle==H.endAngle}t.isArcSpanOverlapping=o;function a(V,H,X,Y){return Y?Math.min(H,X)<V&&V<Math.max(H,X):Math.min(H,X)<=V&&V<=Math.max(H,X)}t.isBetween=a;function s(V,H,X){var Y=e.angle.noRevolutions(H.startAngle),ie=e.angle.ofArcSpan(H),se=Y+ie;return V=e.angle.noRevolutions(V),a(V,Y,se,X)||a(V,Y+360,se+360,X)||a(V,Y-360,se-360,X)}t.isBetweenArcAngles=s;function u(V,H,X){for(var Y=!1,ie=2;ie--;){if(e.round(H.origin[ie]-H.end[ie],1e-6)==0){if(Y)return!1;Y=!0;continue}var se=e.round(H.origin[ie]),pe=e.round(H.end[ie]);if(!a(e.round(V[ie]),se,pe,X))return!1}return!0}t.isBetweenPoints=u;function f(V,H){for(var X=h(V),Y=0;Y<V.controls.length;Y++)if(!t.isPointOnSlope(V.controls[Y],X)&&(!H||u(V.controls[Y],V,!1)))return!1;return!0}t.isBezierSeedLinear=f;var d=requireGraham_scan_min();function w(V){return V.join(",")}function b(V,H){if(!V.endless||V.links.length===1)return null;var X=e.chain.toKeyPoints(V);return S(X,H)}t.isChainClockwise=b;function S(V,H){var X=new d,Y=[];function ie(ce){X.addPoint(ce[0],ce[1]),Y.push(w(ce))}V.forEach(ie);var se=X.getHull(),pe=se.slice(0,3).map(function(ce){return w([ce.x,ce.y])}),ae=[];switch(Y.forEach(function(ce){~pe.indexOf(ce)&&ae.push(ce)}),ae.indexOf(pe[1])){case 0:ae.unshift(ae.pop());break;case 2:ae.push(ae.shift());break}return H&&(H.hullPoints=se.map(function(ce){return[ce.x,ce.y]}),H.keyPoints=V),pe[0]!=ae[0]}t.isPointArrayClockwise=S;function x(V,H,X){function Y(ie,se,pe){function ae(ce){return u(ce,se,X)}return ae(pe.origin)||ae(pe.end)}return Y(0,V,H)||Y(1,H,V)}t.isLineOverlapping=x;function m(V,H){for(var X=2;X--;)if(!(e.round(V.low[X]-H.high[X])<=0&&e.round(V.high[X]-H.low[X])>=0))return!1;return!0}t.isMeasurementOverlapping=m;function h(V){var H=V.end[0]-V.origin[0];if(e.round(H,1e-6)==0)return{line:V,hasSlope:!1};var X=V.end[1]-V.origin[1],Y=X/H,ie=V.origin[1]-Y*V.origin[0];return{line:V,hasSlope:!0,slope:Y,yIntercept:ie}}t.lineSlope=h;function v(V,H){var X=H[0]-V[0],Y=H[1]-V[1];return Math.sqrt(X*X+Y*Y)}t.pointDistance=v;function p(V,H,X){return[X(V[0],H[0]),X(V[1],H[1])]}var y={};y[e.pathType.Line]=function(V){return{low:p(V.origin,V.end,Math.min),high:p(V.origin,V.end,Math.max)}},y[e.pathType.Circle]=function(V){var H=V.radius;return{low:e.point.add(V.origin,[-H,-H]),high:e.point.add(V.origin,[H,H])}},y[e.pathType.Arc]=function(V){var H=V.radius,X=e.point.fromArc(V);function Y(ie,se,pe){for(var ae=p(X[0],X[1],pe),ce=2;ce--;)s(ie[ce],V,!1)&&(ae[ce]=se+V.origin[ce]);return ae}return{low:Y([180,270],-H,Math.min),high:Y([360,90],H,Math.max)}};function E(V,H){if(V){var X=y[V.type];if(X){var Y=X(V);return H&&(Y.high=e.point.add(Y.high,H),Y.low=e.point.add(Y.low,H)),Y}}return{low:null,high:null}}t.pathExtents=E;var P={};P[e.pathType.Line]=function(V){return v(V.origin,V.end)},P[e.pathType.Circle]=function(V){return 2*Math.PI*V.radius},P[e.pathType.Arc]=function(V){var H=P[e.pathType.Circle](V),X=e.angle.ofArcSpan(V)/360;return H*=X,H},P[e.pathType.BezierSeed]=function(V){return e.models.BezierCurve.computeLength(V)};function A(V){if(V){var H=P[V.type];if(H)return H(V)}return 0}t.pathLength=A;function L(V){var H=0;return e.model.walk(V,{onPath:function(X){H+=A(X.pathContext)}}),H}t.modelPathLength=L;function B(V){return{high:e.point.clone(V.high),low:e.point.clone(V.low)}}function F(V,H){function X(se,pe){if(pe){var ae=se.slice(0,-2),ce=e.createRouteKey(ae);ce in H.modelMap?r(H.modelMap[ce],pe):H.modelMap[ce]=B(pe)}}H||(H=new T(V));var Y={onPath:function(se){se.routeKey in H.pathMap||(H.pathMap[se.routeKey]=E(se.pathContext,se.offset)),X(se.route,H.pathMap[se.routeKey])},afterChildWalk:function(se){X(se.route,H.modelMap[se.routeKey])}};e.model.walk(V,Y),H.modelsMeasured=!0;var ie=H.modelMap[""];return ie&&U(ie)}t.modelExtents=F;function U(V){var H=V;return H.center=e.point.average(H.high,H.low),H.width=H.high[0]-H.low[0],H.height=H.high[1]-H.low[1],H}t.augment=U;var T=function(){function V(H){this.modelContext=H,this.modelsMeasured=!1,this.modelMap={},this.pathMap={}}return V.prototype.measureModels=function(){this.modelsMeasured||F(this.modelContext,this)},V}();t.Atlas=T;function I(V,H){return H>=V?H-V:H<0?H+V:H}function _(V,H){return V.slope*H+V.yIntercept}function D(V,H){var X=h(V);return[H,_(X,H)]}function z(V){for(var H=1;H<3;H++)if(!t.isPointEqual(V[0].center,V[H].center,1e-6)||e.round(V[0].width-V[H].width)!==0)return!1;return!0}function M(V,H,X,Y){e.model.rotate(H,X);var ie=F(H),se={index:V,rotation:Y,center:e.point.rotate(ie.center,Y),width:ie.height,height:ie.width,bottom:new e.paths.Line(ie.low,[ie.high[0],ie.low[1]]),middle:new e.paths.Line([ie.low[0],ie.center[1]],[ie.high[0],ie.center[1]]),top:new e.paths.Line(ie.high,[ie.low[0],ie.high[1]])};return[se.top,se.middle,se.bottom].forEach(function(pe){return e.path.rotate(pe,Y)}),se}function q(V,H){var X=V[1].origin,Y=X[0],ie=V[3].origin[0],se=V[0].origin[0],pe=Y-se;if(se-ie>2*pe)return null;var ae=(Y-ie)/3;if(pe<ae)return null;var ce=Math.min(ae,pe),Ae=e.solvers.equilateralSide(ce),Te=[e.point.fromSlopeIntersection(V[1],V[2]),e.point.fromSlopeIntersection(V[4],V[5])],K=Te.map(function(ye){return Math.abs(ye[1]-X[1])}),he=K[0]>K[1]?0:1,xe=K[he];if(xe>Ae){var Ve=e.solvers.equilateralAltitude(xe),Ze=Y-2*Ve;if(se>Ze+Ve||ie<Ze-Ve)return null;var Ge=ie-Ze+Ve,Me=2*Ve-H[he+1].width,me=Math.min(Ge,Me)/2;return{origin:D(H[2-he].middle,Ze+me),radius:xe,type:"peak "+he}}else return{origin:[Y-2*ce,X[1]],radius:Ae,type:"side"}}function J(V){var H=e.cloneObject(V);e.model.originate(H);var X=F(H),Y=[],ie={paths:{}};e.model.center(H);function se(Ge,Me,me){return{radius:Ge,paths:new e.models.Polygon(6,Ge,30).paths,origin:e.point.add(Me,X.center),notes:me}}for(var pe=[[90,-90],[-60,-30],[-60,30]];pe.length;){var ae=pe.shift(),ce=M(Y.length,H,ae[0],ae[1]),Ae=e.solvers.equilateralSide(ce.width/2);if(Ae>=ce.height)return se(Ae,ce.center,"solved by bound "+Y.length);Y.push(ce)}if(z(Y))return se(e.solvers.equilateralSide(Y[0].width/2),Y[0].center,"solved as circular");var Te=Y.map(function(Ge){return Ge.top}).concat(Y.map(function(Ge){return Ge.bottom}));Te.forEach(function(Ge,Me){ie.paths[Me]=Ge,e.path.converge(Te[I(6,Me+2)],Ge,!0)}),Y.forEach(function(Ge,Me){ie.paths["m"+Me]=Ge.middle});for(var K=Y.slice(),he,xe=0;xe<6;xe++){xe>0&&(Te.push(Te.shift()),K.push(K.shift()),e.model.rotate(ie,-60));var Ve=q(Te,K);Ve&&(!he||Ve.radius<he.radius)&&(he=Ve,he.index=xe)}var Ze=e.point.rotate(he.origin,he.index*60);return se(he.radius,Ze,"solved by "+he.index+" as "+he.type)}t.boundingHexagon=J;function ee(V,H){var X=0;return H.forEach(function(Y){t.isPointDistinct(Y,V,1e-8)&&(V.push(Y),X++)}),X}function le(V,H,X){if(H)return H;var Y=F(V).high;return Y?e.point.add(Y,[1,1]):[7654321,1234567]}function oe(V,H,X){X===void 0&&(X={}),X.farPoint||(X.farPoint=le(H,X.farPoint,X.measureAtlas)),X.out_intersectionPoints=[];var Y,ie=new e.paths.Line(V,X.farPoint),se=E(ie),pe={onPath:function(ae){if(!(X.measureAtlas&&!m(se,X.measureAtlas.pathMap[ae.routeKey]))){var ce={path2Offset:ae.offset},Ae=e.path.intersection(ie,ae.pathContext,ce);if(Ae){var Te=ee(X.out_intersectionPoints,Ae.intersectionPoints);Te%2==1&&(Y=!Y)}}},beforeChildWalk:function(ae){if(!X.measureAtlas)return!0;var ce=X.measureAtlas.modelMap[ae.routeKey];return ce&&m(se,ce)}};return e.model.walk(H,pe),!!Y}t.isPointInsideModel=oe})(e.measure||(e.measure={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(i,o){o===void 0&&(o={});function a(s,u){if(e.isNumber(u)){var f=e.round(u,o.accuracy);return f}if(e.isPoint(u)){var d=e.point.rounded(u,o.accuracy);return d}return u}return JSON.stringify(i,o.accuracy&&a,o.indentation)}t.toJson=r;function n(i){if(e.isModel(i))return i.units}t.tryGetModelUnits=n,t.colors={black:0,red:1,yellow:2,lime:3,aqua:4,blue:5,fuchsia:6,white:7,gray:9,maroon:14,orange:30,olive:58,green:94,teal:134,navy:174,purple:214,silver:254}})(e.exporter||(e.exporter={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(n){for(var i=[],o=/-?(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,a;(a=o.exec(n))!==null;)a.index===o.lastIndex&&o.lastIndex++,a[0]!==""&&i.push(parseFloat(a[0]));return i}t.parseNumericList=r})(e.importer||(e.importer={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(o,a){a===void 0&&(a={});var s={fontSize:9},u=[],f={entities:[],header:{},tables:{}};if(e.extendObject(s,a),e.isModel(o)){var d=o;d.exporterOptions&&e.extendObject(s,d.exporterOptions.toDXF)}function w(T){if(s.layerOptions&&s.layerOptions[T])return s.layerOptions[T];if(T in t.colors)return{color:t.colors[T]}}function b(T,I){var _=T&&T.layer||I||"0";return u.indexOf(_)<0&&u.push(_),_}var S={};S[e.pathType.Line]=function(T,I,_){var D={type:"LINE",layer:b(T,_),vertices:[{x:e.round(T.origin[0]+I[0],s.accuracy),y:e.round(T.origin[1]+I[1],s.accuracy)},{x:e.round(T.end[0]+I[0],s.accuracy),y:e.round(T.end[1]+I[1],s.accuracy)}]};return D},S[e.pathType.Circle]=function(T,I,_){var D={type:"CIRCLE",layer:b(T,_),center:{x:e.round(T.origin[0]+I[0],s.accuracy),y:e.round(T.origin[1]+I[1],s.accuracy)},radius:e.round(T.radius,s.accuracy)};return D},S[e.pathType.Arc]=function(T,I,_){var D={type:"ARC",layer:b(T,_),center:{x:e.round(T.origin[0]+I[0],s.accuracy),y:e.round(T.origin[1]+I[1],s.accuracy)},radius:e.round(T.radius,s.accuracy),startAngle:e.round(T.startAngle,s.accuracy),endAngle:e.round(T.endAngle,s.accuracy)};return D};function x(T,I,_){var D={type:"VERTEX",layer:b(null,I),x:e.round(T[0],s.accuracy),y:e.round(T[1],s.accuracy),bulge:_};return D}function m(T){var I={type:"POLYLINE",layer:b(null,T.layer),shape:T.chain.endless,vertices:[]};if(T.chain.links.forEach(function(z,M){var q;if(z.walkedPath.pathContext.type===e.pathType.Arc){var J=z.walkedPath.pathContext;q=e.round(Math.tan(e.angle.toRadians(e.angle.ofArcSpan(J))/4),s.accuracy),z.reversed&&(q*=-1)}var ee=z.endPoints[z.reversed?1:0];I.vertices.push(x(ee,T.layer,q))}),!T.chain.endless){var _=T.chain.links[T.chain.links.length-1],D=_.endPoints[_.reversed?0:1];I.vertices.push(x(D,T.layer))}return I}function h(T){var I=b(null,T.layer),_=w(I),D=e.point.middle(T.anchor),z={type:"TEXT",startPoint:x(D,null),endPoint:x(D,null),layer:I,textHeight:_&&_.fontSize||s.fontSize,text:T.text,halign:4,valign:0,rotation:e.angle.ofPointInDegrees(T.anchor.origin,T.anchor.end)};return z}function v(T,I){var _={name:T,color:I};return _}function p(){var T={lineTypes:{CONTINUOUS:{name:"CONTINUOUS",description:"______",patternLength:0}}},I="lineType";f.tables[I]=T}function y(){var T={layers:{}};u.forEach(function(_){var D=w(_);D&&(T.layers[_]=v(_,D.color))});var I="layer";f.tables[I]=T}function E(){if(s.units){var T=i[s.units];f.header.$INSUNITS=T}}function P(T,I,_){var D=f.entities;D.push.apply(D,I.map(m)),T.forEach(function(z){var M=S[z.pathContext.type];if(M){var q=M(z.pathContext,z.offset,z.layer);D.push(q)}}),D.push.apply(D,_.map(h))}if(!s.units){var A=t.tryGetModelUnits(o);A&&(s.units=A)}e.extendObject(a,s);var L=[],B=[];if(s.usePOLYLINE){var F=function(T,I,_){T.forEach(function(D){if(D.endless&&D.links.length===1&&D.links[0].walkedPath.pathContext.type===e.pathType.Circle){B.push(D.links[0].walkedPath);return}var z={chain:D,layer:_};L.push(z)}),B.push.apply(B,I)};e.model.findChains(d,F,{byLayers:!0,pointMatchingDistance:s.pointMatchingDistance})}else{var U={onPath:function(T){B.push(T)}};e.model.walk(d,U)}return P(B,L,e.model.getAllCaptionsOffset(d)),E(),p(),y(),n(f)}t.toDXF=r;function n(o){var a=[];function s(){for(var p=[],y=0;y<arguments.length;y++)p[y]=arguments[y];a.push.apply(a,p)}var u={};u.LINE=function(p){s("0","LINE","8",p.layer,"10",p.vertices[0].x,"20",p.vertices[0].y,"11",p.vertices[1].x,"21",p.vertices[1].y)},u.CIRCLE=function(p){s("0","CIRCLE","8",p.layer,"10",p.center.x,"20",p.center.y,"40",p.radius)},u.ARC=function(p){s("0","ARC","8",p.layer,"10",p.center.x,"20",p.center.y,"40",p.radius,"50",p.startAngle,"51",p.endAngle)},u.VERTEX=function(p){s("0","VERTEX","8",p.layer,"10",p.x,"20",p.y),p.bulge!==void 0&&s("42",p.bulge)},u.POLYLINE=function(p){s("0","POLYLINE","8",p.layer,"66",1,"70",p.shape?1:0),p.vertices.forEach(function(y){return u.VERTEX(y)}),s("0","SEQEND")},u.TEXT=function(p){s("0","TEXT","10",p.startPoint.x,"20",p.startPoint.y,"11",p.endPoint.x,"21",p.endPoint.y,"40",p.textHeight,"1",p.text,"50",p.rotation,"8",p.layer,"72",p.halign,"73",p.valign)};function f(p){s("0","SECTION"),p(),s("0","ENDSEC")}function d(p){s("0","TABLE"),p(),s("0","ENDTAB")}function w(){s("2","TABLES"),d(x),d(m)}function b(p){s("0","LAYER","2",p.name,"70","0","62",p.color,"6","CONTINUOUS")}function S(p){s("0","LTYPE","72","65","70","64","2",p.name,"3",p.description,"73","0","40",p.patternLength)}function x(){var p="lineType",y=o.tables[p];s("2","LTYPE");for(var E in y.lineTypes){var P=y.lineTypes[E];S(P)}}function m(){var p="layer",y=o.tables[p];s("2","LAYER");for(var E in y.layers){var P=y.layers[E];b(P)}}function h(){s("2","HEADER");for(var p in o.header){var y=o.header[p];s("9",p,"70",y)}}function v(p){s("2","ENTITIES"),p.forEach(function(y){var E=u[y.type];E&&E(y)})}return f(h),f(w),f(function(){return v(o.entities)}),s("0","EOF"),a.join(`
`)}var i={};i[""]=0,i[e.unitType.Inch]=1,i[e.unitType.Foot]=2,i[e.unitType.Millimeter]=4,i[e.unitType.Centimeter]=5,i[e.unitType.Meter]=6})(e.exporter||(e.exporter={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=Math.sqrt(3)/2;function n(u){return u*r}t.equilateralAltitude=n;function i(u){return u/r}t.equilateralSide=i;function o(u,f,d){return e.angle.toDegrees(Math.acos((f*f+d*d-u*u)/(2*f*d)))}t.solveTriangleSSS=o;function a(u,f,d){var w=180-u-d;return f*Math.sin(e.angle.toRadians(u))/Math.sin(e.angle.toRadians(w))}t.solveTriangleASA=a;function s(u,f,d){d===void 0&&(d=!1);var w=new e.paths.Line(u.origin,f.origin),b=e.measure.pointDistance(u.origin,f.origin);if(u.radius>=b+f.radius||f.radius>=b+u.radius||d&&u.radius+f.radius>=b)return null;var S;if(!d&&e.round(u.radius-f.radius)==0)S=[90,270];else{var x=b/2,m=new e.paths.Circle([x,0],x),h=new e.paths.Circle(u.radius>f.radius?[0,0]:[b,0],d?u.radius+f.radius:Math.abs(u.radius-f.radius)),v=e.path.intersection(h,m);if(!v||!v.path1Angles)return null;S=v.path1Angles}var p=e.angle.ofLineInDegrees(w);return S.map(function(y){return e.angle.noRevolutions(y+p)})}t.circleTangentAngles=s})(e.solvers||(e.solvers={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r={};r[e.pathType.Arc]={},r[e.pathType.Circle]={},r[e.pathType.Line]={},r[e.pathType.Arc][e.pathType.Arc]=function(w,b,S,x){var m=null;return n([w,b],S,x,function(){var h=d(w,b,S);if(h){var v=u(h[0],w,S),p=u(h[1],b,S);if(v&&p)if(v.length===1||p.length===1)for(var y=0;y<v.length;y++)for(var E=0;E<p.length;E++){var P=e.point.fromAngleOnCircle(v[y],w),A=e.point.fromAngleOnCircle(p[E],b);if(e.measure.isPointEqual(P,A,1e-4)){m={intersectionPoints:[P],path1Angles:[v[y]],path2Angles:[p[E]]};return}}else m={intersectionPoints:s(v,w),path1Angles:v,path2Angles:p}}else S.out_AreOverlapped&&(S.out_AreOverlapped=e.measure.isArcOverlapping(w,b,S.excludeTangents))}),m},r[e.pathType.Arc][e.pathType.Circle]=function(w,b,S,x){var m=null;return n([w,b],S,x,function(){var h=d(w,b,S);if(h){var v=u(h[0],w,S);if(v){var p;if(v.length==2)p=h[1];else{var y=a(h[0],v[0]);p=[h[1][y]]}m={intersectionPoints:s(v,w),path1Angles:v,path2Angles:p}}}}),m},r[e.pathType.Arc][e.pathType.Line]=function(w,b,S,x){var m=null;return n([w,b],S,x,function(){var h=f(b,w,S);if(h){var v=u(h,w,S);v&&(m={intersectionPoints:s(v,w),path1Angles:v})}}),m},r[e.pathType.Circle][e.pathType.Arc]=function(w,b,S){var x=r[e.pathType.Arc][e.pathType.Circle](b,w,S,!0);return x?i(x):null},r[e.pathType.Circle][e.pathType.Circle]=function(w,b,S,x){var m=null;return n([w,b],S,x,function(){var h=d(w,b,S);h&&(m={intersectionPoints:s(h[0],w),path1Angles:h[0],path2Angles:h[1]})}),m},r[e.pathType.Circle][e.pathType.Line]=function(w,b,S,x){var m=null;return n([w,b],S,x,function(){var h=f(b,w,S);h&&(m={intersectionPoints:s(h,w),path1Angles:h})}),m},r[e.pathType.Line][e.pathType.Arc]=function(w,b,S){var x=r[e.pathType.Arc][e.pathType.Line](b,w,S,!0);return x?i(x):null},r[e.pathType.Line][e.pathType.Circle]=function(w,b,S){var x=r[e.pathType.Circle][e.pathType.Line](b,w,S,!0);return x?i(x):null},r[e.pathType.Line][e.pathType.Line]=function(w,b,S,x){var m=null;return n([w,b],S,x,function(){var h=e.point.fromSlopeIntersection(w,b,S);h&&e.measure.isBetweenPoints(h,w,S.excludeTangents)&&e.measure.isBetweenPoints(h,b,S.excludeTangents)&&(m={intersectionPoints:[h]})}),m};function n(w,b,S,x){var m=S?[b.path2Offset,b.path1Offset]:[b.path1Offset,b.path2Offset];t.moveTemporary(w,m,x)}function i(w){var b=w.path1Angles;return w.path2Angles?w.path1Angles=w.path2Angles:delete w.path1Angles,b&&(w.path2Angles=b),w}function o(w,b,S){if(S===void 0&&(S={}),w&&b){var x=r[w.type][b.type];if(x)return x(w,b,S)}return null}t.intersection=o;function a(w,b){for(var S=2;S--;)if(w[S]===b)return S}function s(w,b){for(var S=[],x=0;x<w.length;x++)S.push(e.point.fromAngleOnCircle(w[x],b));return S}function u(w,b,S){if(!w)return null;for(var x=[],m=0;m<w.length;m++)e.measure.isBetweenArcAngles(w[m],b,S.excludeTangents)&&x.push(w[m]);return x.length==0?null:x}function f(w,b,S){var x=e.round(b.radius);if(b.radius<=0)return null;var m=new e.paths.Line(e.point.subtract(w.origin,b.origin),e.point.subtract(w.end,b.origin)),h=e.angle.ofLineInDegrees(w),v=h>=180?h-360:h;t.rotate(m,-v,e.point.zero());function p(F){var U=F+v;return e.round(e.angle.noRevolutions(U))}var y=e.round(m.origin[1]),E=Math.abs(y);if(E>x)return null;var P=[];if(E==x){if(S.excludeTangents)return null;P.push(p(y>0?90:270))}else{let F=function(U,T){e.measure.isBetween(e.round(U),e.round(m.origin[0]),e.round(m.end[0]),S.excludeTangents)&&P.push(p(T))};var A=Math.asin(y/x),L=e.angle.toDegrees(A),B=Math.cos(A)*x;F(-B,180-L),F(B,L)}return P.length>0?P:null}function d(w,b,S){if(w.radius<=0||b.radius<=0)return null;if(w.radius==b.radius&&e.measure.isPointEqual(w.origin,b.origin,1e-4))return S.out_AreOverlapped=!0,null;e.point.subtract(e.point.zero(),w.origin);var x=new e.paths.Circle(e.point.zero(),w.radius),m=new e.paths.Circle(e.point.subtract(b.origin,w.origin),b.radius),h=e.angle.ofPointInDegrees(e.point.zero(),m.origin);t.rotate(m,-h,e.point.zero());function v(A){var L=A+h;return e.angle.noRevolutions(L)}var p=m.origin[0];if(e.round(m.radius-p-x.radius)==0)return S.excludeTangents?null:[[v(180)],[v(180)]];if(e.round(m.radius+p-x.radius)==0)return S.excludeTangents?null:[[v(0)],[v(0)]];if(e.round(p-m.radius-x.radius)==0)return S.excludeTangents?null:[[v(0)],[v(180)]];if(e.round(p-m.radius)>x.radius||e.round(p+m.radius)<x.radius||e.round(p-m.radius)<-x.radius)return null;function y(A){return[v(A),v(e.angle.mirror(A,!1,!0))]}var E=e.solvers.solveTriangleSSS(m.radius,x.radius,p),P=e.solvers.solveTriangleSSS(x.radius,p,m.radius);return[y(E),y(180-P)]}})(e.path||(e.path={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r={};r[e.pathType.Arc]=function(h){return["startAngle","endAngle"]},r[e.pathType.Line]=function(h){return["origin","end"]};function n(h){var v=e.point.fromPathEnds(h);if(v){let E=function(P){return{point:v[P],propertyName:p[P]}};var p=null,y=r[h.type];if(y)return p=y(h),[E(0),E(1)]}return null}function i(h,v,p){var y=n(h),E=n(v),P=null;function A(B,F,U){return{path:B,isStart:U==0,propertyName:F[U].propertyName,point:F[U].point,oppositePoint:F[1-U].point}}function L(B,F){return e.measure.isPointEqual(y[B].point,E[F].point,1e-4)?(P=[A(h,y,B),A(v,E,F)],!0):!1}return L(0,0)||L(0,1)||L(1,0)||L(1,1),P}function o(h,v,p,y){for(var E=new e.paths.Circle(v,h),P=0;P<2;P++){var A=t.intersection(E,p[P].path);if(!A)return!1;if(p[P].shardPoint=A.intersectionPoints[0],e.measure.isPointEqual(p[P].point,A.intersectionPoints[0],1e-4))if(A.intersectionPoints.length>1)p[P].shardPoint=A.intersectionPoints[1];else return!1}return!0}function a(h,v){var p=t.clone(h),y=t.breakAtPoint(p,v);return[p,y]}var s={};s[e.pathType.Arc]=function(h,v,p,y,E){var P=h.radius,A=a(h,y)[E?0:1];return A?(e.measure.isArcConcaveTowardsPoint(A,p)?P-=v:P+=v,e.round(P)<=0?null:new e.paths.Arc(h.origin,P,h.startAngle,h.endAngle)):null},s[e.pathType.Line]=function(h,v,p,y,E){return new e.paths.Parallel(h,v,p)};function u(h,v,p){var y=null,E=s[h.path.type];return E&&(y=E(h.path,v,p,h.shardPoint,h.isStart)),y}var f={};f[e.pathType.Arc]=function(h,v,p,y){var E=new e.paths.Line(h.origin,y),P=e.angle.ofLineInDegrees(E),A=P;return e.measure.isArcConcaveTowardsPoint(h,y)||(A+=180),{filletAngle:e.angle.noRevolutions(A),clipPath:function(){h[v]=P}}},f[e.pathType.Line]=function(h,v,p,y){var E=new e.paths.Line([0,0],[0,1]),P=e.angle.ofLineInDegrees(h);t.rotate(E,P,[0,0]),t.moveRelative(E,y);var A=e.point.fromSlopeIntersection(h,E);return A?{filletAngle:e.angle.ofPointInDegrees(y,A),clipPath:function(){h[v]=A}}:null};function d(h,v,p){var y=null,E=f[h.path.type];return E&&(y=E(h.path,h.propertyName,v,p)),b(h,y)||(y=null),y}function w(h,v){var p={filletAngle:e.angle.ofPointInDegrees(v,h.shardPoint),clipPath:function(){h.path[h.propertyName]=h.shardPoint}};return b(h,p)||(p=null),p}function b(h,v){var p=!1;if(v){var y=h.path[h.propertyName];v.clipPath(),e.measure.pathLength(h.path)>0&&(p=!0),h.path[h.propertyName]=y}return p}function S(h){for(var v=0,p=[],y=0;y<h.length;y++){var E=e.measure.pathLength(h[y]);p.push(E),v+=E}return p[0]/v}function x(h,v,p,y){if(e.isPathLine(h)&&e.isPathLine(v)&&p&&p>0){var E={pointMatchingDistance:.005};e.extendObject(E,y);var P=i(h,v);if(P){var A=S([h,v]),L=new e.paths.Line(P[0].oppositePoint,P[1].oppositePoint),B=e.point.middle(L,A),F=e.angle.ofPointInDegrees(P[0].point,B),U=e.point.add(P[0].point,e.point.fromPolar(e.angle.toRadians(F),p));if(!o(p,U,P))return null;for(var T=[],I=0;I<2;I++){var _=w(P[I],U);if(!_)return null;T.push(_)}var D=new e.paths.Arc(U,p,T[0].filletAngle,T[1].filletAngle);return e.round(e.angle.noRevolutions(e.angle.ofArcMiddle(D)))==e.round(F)&&(D.startAngle=T[1].filletAngle,D.endAngle=T[0].filletAngle),T[0].clipPath(),T[1].clipPath(),D}}return null}t.dogbone=x;function m(h,v,p,y){if(h&&v&&p&&p>0){var E={pointMatchingDistance:.005};e.extendObject(E,y);var P=i(h,v);if(P){if(!o(p,P[0].point,P))return null;for(var A=[],L=0;L<2;L++){var B=P[1-L].shardPoint;if(!B)return null;var F=u(P[L],p,B);A.push(F)}var U=t.intersection(A[0],A[1]);if(U){var T;U.intersectionPoints.length==1?T=U.intersectionPoints[0]:T=e.point.closest(P[0].point,U.intersectionPoints);for(var I=[],L=0;L<2;L++){var _=d(P[L],p,T);if(!_)return null;I.push(_)}if(e.round(I[0].filletAngle-I[1].filletAngle)==0)return null;var D=new e.paths.Arc(T,p,I[0].filletAngle,I[1].filletAngle),z=e.angle.ofArcSpan(D);return z==180?null:(z>180&&(D.startAngle=I[1].filletAngle,D.endAngle=I[0].filletAngle),I[0].clipPath(),I[1].clipPath(),D)}}}return null}t.fillet=m})(e.path||(e.path={}))})(MakerJs||(MakerJs={})),function(e){(function(t){function r(o,a){return i(!1,o,a)}t.dogbone=r;function n(o,a){return i(!0,o,a)}t.fillet=n;function i(o,a,s){var u={paths:{}},f=0,d=a.links;function w(S,x){var m=d[S].walkedPath,h=d[x].walkedPath;m.modelContext===h.modelContext&&m.modelContext.type==e.models.BezierCurve.typeName||e.path.moveTemporary([m.pathContext,h.pathContext],[m.offset,h.offset],function(){var v;if(e.isObject(s)){var p=e.angle.ofChainLinkJoint(d[S],d[x]);if(e.round(p)===0)return;v=p>0?s.left:s.right}else v=s;if(!(!v||v<0)){var y;o?y=e.path.fillet(m.pathContext,h.pathContext,v):y=e.path.dogbone(m.pathContext,h.pathContext,v),y&&(u.paths["fillet"+f]=y,f++)}})}for(var b=1;b<d.length;b++)w(b-1,b);return a.endless&&w(b-1,0),f?u:null}})(e.chain||(e.chain={}))}(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(i,o){function a(){return i.apply(this,o)}return a.prototype=i.prototype,new a}t.construct=r;function n(i){var o=[],a=i.metaParameters;if(a)for(var s=0;s<a.length;s++){var u=a[s].value;Array.isArray(u)&&(u=u[0]),o.push(u)}return o}t.getParameterValues=n})(e.kit||(e.kit={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(d,w){return d[0].walkedPath.pathContext===w?d[1]:d[0]}function n(d,w,b){function S(x,m,h){for(;x;){m.links.push(x),m.pathLength+=x.pathLength;var v=x.reversed?0:1,p=x.endPoints[v],y=d.getElementAtPoint(p);if(!y||y.valueIds.length===0)break;var E=y.valueIds.map(function(A){return d.values[A]}),P=r(E,x.walkedPath.pathContext);if(y.valueIds.splice(0,2),!P)break;if(P.walkedPath.pathContext===h.walkedPath.pathContext){m.links.length>1&&(m.endless=!0);break}x=P}}d.forEachPoint(function(x,m,h,v){if(v.valueIds.length>0){var p={links:[],pathLength:0};if(S(m[0],p,m[0]),p.endless)w(p,!1);else{p.links.reverse();var y=p.links[0];p.links.map(function(P){P.reversed=!P.reversed}),p.pathLength-=p.links[p.links.length-1].pathLength;var E=p.links.pop();S(E,p,y),p.links.length>1?w(p,!0):b(p.links[0].walkedPath)}}})}function i(d){var w=null;return a(d,function(b,S,x){w=b[0]},{byLayers:!1}),w}t.findSingleChain=i;function o(d,w){var b=w===d.reversed?1:0;return d.endPoints[b]}function a(d){for(var w=[],b=1;b<arguments.length;b++)w[b-1]=arguments[b];var S,x;switch(w.length){case 1:typeof w[0]=="function"?x=w[0]:S=w[0];break;case 2:x=w[0],S=w[1];break}var m={pointMatchingDistance:.005};e.extendObject(m,S);var h={},v={},p={},y={onPath:function(U){var T=m.byLayers?U.layer:"";h[T]||(h[T]=new e.PointGraph);var I=h[T],_=e.measure.pathLength(U.pathContext);if(U.pathContext.type===e.pathType.Circle||U.pathContext.type===e.pathType.Arc&&e.round(e.angle.ofArcSpan(U.pathContext)-360)===0||U.pathContext.type===e.pathType.BezierSeed&&e.measure.isPointEqual(U.pathContext.origin,U.pathContext.end,m.pointMatchingDistance)){var D={links:[{walkedPath:U,reversed:null,endPoints:null,pathLength:_}],endless:!0,pathLength:_};v[T]||(v[T]=[]),v[T].push(D)}else{if(_<m.pointMatchingDistance/5){p[T]||(p[T]=[]),p[T].push(U);return}for(var z=e.point.fromPathEnds(U.pathContext,U.offset),M=0;M<2;M++){var q={walkedPath:U,endPoints:z,reversed:M!=0,pathLength:_},J=I.insertValue(q);I.insertValueIdAtPoint(J,z[M])}}}};m.shallow&&(y.beforeChildWalk=function(){return!1});var E;m.unifyBeziers&&(E=u(d),f(E,!0)),t.walk(d,y);var P=function(U){var T=h[U];T.mergeNearestSinglePoints(m.pointMatchingDistance),A=[],v[U]||(v[U]=[]),n(T,function(I,_){_?I.endless=e.measure.isPointEqual(o(I.links[0],!0),o(I.links[I.links.length-1],!1),m.pointMatchingDistance):I.endless=!!I.endless,v[U].push(I)},function(I){A.push(I)}),v[U].sort(function(I,_){return _.pathLength-I.pathLength}),m.contain&&(L=e.isObject(m.contain)?m.contain:{alternateDirection:!1},B=s(v[U],L),v[U]=B),x&&x(v[U],A,U,p[U])},A,L,B;for(var F in h)P(F);return E&&f(E,!1),m.byLayers?v:v[""]}t.findChains=a;function s(d,w){var b=d.map(function(m){return e.chain.toNewModel(m)}),S=[];d.forEach(function(m,h){if(m.endless){var v=m.links[0].walkedPath,p=e.path.clone(v.pathContext,v.offset);d.forEach(function(y,E){m!==y&&y.endless&&e.measure.isPointInsideModel(e.point.middle(p),b[E])&&(S[h]=y)})}});var x=[];if(d.forEach(function(m,h){var v=S[h];v?(v.contains||(v.contains=[]),v.contains.push(m)):x.push(m)}),w.alternateDirection){let m=function(h,v){h.forEach(function(p,y){var E=e.measure.isChainClockwise(p);E!==null&&(!E&&v||E&&!v)&&e.chain.reverse(p),p.contains&&m(p.contains,!v)})};m(x,!0)}return x}function u(d){var w=[];function b(m){m.childModel.type===e.models.BezierCurve.typeName&&w.push(m)}var S={beforeChildWalk:function(m){return b(m),!0}},x={childId:"",childModel:d,layer:d.layer,offset:d.origin,parentModel:null,route:[],routeKey:""};return b(x),t.walk(d,S),w}function f(d,w){var b="tempPaths",S="tempLayer";d.forEach(function(x){var m=x.childModel;if(w){x.layer!=null&&x.layer!==""&&(m[S]=m.layer,m.layer=x.layer);var h=e.models.BezierCurve.getBezierSeeds(m,{byLayers:!0});for(var v in h){var p=h[v];if(p.length>0){m[b]=m.paths;var y={};p.forEach(function(E,P){E.layer=v,y["seed_"+P]=E}),m.paths=y}}}else b in m&&(m.paths=m[b],delete m[b]),S in m&&(m[S]==null?delete m.layer:m.layer=m[S],delete m[S])})}})(e.model||(e.model={}))})(MakerJs||(MakerJs={})),function(e){(function(t){function r(f,d){if(d===void 0&&(d=1),!!f.endless){for(var w=Math.abs(d),b=0;b<w;b++)d<0?f.links.push(f.links.shift()):f.links.unshift(f.links.pop());return f}}t.cycle=r;function n(f){return f.links.reverse(),f.links.forEach(function(d){return d.reversed=!d.reversed}),f}t.reverse=n;function i(f,d){if(f.endless){for(var w=-1,b=0;b<f.links.length;b++)if(f.links[b].walkedPath.routeKey==d){w=b;break}return w>0&&r(f,w),f}}t.startAt=i;function o(f,d){d===void 0&&(d=!1);for(var w={paths:{}},b=0;b<f.links.length;b++){var S=f.links[b].walkedPath;if(S.pathContext.type===e.pathType.BezierSeed){d&&delete S.modelContext.paths[S.pathId],w.models||(w.models={});var x=e.model.getSimilarModelId(w,S.pathId);w.models[x]=e.model.moveRelative(new e.models.BezierCurve(S.pathContext),S.offset)}else{var m;d?(m=S.pathContext,delete S.modelContext.paths[S.pathId]):m=e.path.clone(S.pathContext);var h=e.model.getSimilarPathId(w,S.pathId);w.paths[h]=e.path.moveRelative(m,S.offset)}}return w}t.toNewModel=o;function a(f,d){!f||d.length<2||e.measure.isPointEqual(d[0],d[d.length-1],1e-5)&&d.pop()}function s(f,d,w){var b=[],S=0,x=0,m;Array.isArray(d)&&(m=d);for(var h=0;h<f.links.length;h++){for(var v=f.links[h],p=v.walkedPath,y=v.pathLength;e.round(y-x)>0;){var E=x/y;if(v.reversed&&(E=1-E),b.push(e.point.add(e.point.middle(p.pathContext,E),p.offset)),w&&b.length>=w)return b;var P;if(m){if(P=m[S],S++,S>m.length)return b}else P=d;x+=P}x-=y}return a(f.endless,b),b}t.toPoints=s;function u(f,d){for(var w=[],b=0;b<f.links.length;b++){var S=f.links[b],x=S.walkedPath,m=e.path.toKeyPoints(x.pathContext,d);if(m.length>0){S.reversed&&m.reverse(),b>0&&m.shift();var h=m.map(function(v){return e.point.add(v,x.offset)});w.push.apply(w,h)}}return a(f.endless,w),w}t.toKeyPoints=u})(e.chain||(e.chain={}))}(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function i(o,a){this.modelContext=o,this.options=a,this.pointMap=new e.PointGraph,this.list=[],this.removed=[],this.ordinals={},this.load()}return i.prototype.load=function(){var o=this,a={onPath:function(s){var u=e.point.fromPathEnds(s.pathContext,s.offset);if(u){var f=s;f.endPoints=u;for(var d=o.pointMap.insertValue(f),w=2;w--;)o.pointMap.insertValueIdAtPoint(d,u[w])}}};t.walk(this.modelContext,a),this.options.pointMatchingDistance&&this.pointMap.mergePoints(this.options.pointMatchingDistance)},i.prototype.findDeadEnds=function(){var o=this,a=0;this.pointMap.forEachPoint(function(f,d,w,b){o.ordinals[w]=a++,o.list.push(b)}),a=0;for(var s=function(){var f=u.list[a];f.valueIds.length===1?u.removePath(f,f.valueIds[0],a):u.options.keep&&f.valueIds.length%2&&f.valueIds.forEach(function(d){var w=o.pointMap.values[d];o.options.keep(w)||o.removePath(f,d,a)}),a++},u=this;a<this.list.length;)s();return this.removed},i.prototype.removePath=function(o,a,s){var u=this.pointMap.values[a],f=this.getOtherPointId(u.endPoints,o.pointId),d=this.pointMap.index[f];this.removed.push(u),this.removeValue(o,a),this.removeValue(d,a),d.valueIds.length>0&&this.appendQueue(d,s)},i.prototype.removeValue=function(o,a){var s=o.valueIds.indexOf(a);s>=0&&o.valueIds.splice(s,1)},i.prototype.appendQueue=function(o,a){var s=this.ordinals[o.pointId];s<a&&(this.list[s]=null,this.list.push(o),this.ordinals[o.pointId]=this.list.length)},i.prototype.getOtherPointId=function(o,a){for(var s=0;s<o.length;s++){var u=this.pointMap.getIdOfPoint(o[s]);if(a!==u)return u}},i}();function n(i,o,a,s){var u={pointMatchingDistance:o||.005,keep:a},f=new r(i,u),d=f.findDeadEnds();return d.length<f.pointMap.values.length&&d.forEach(function(w){s(w,"dead end"),delete w.modelContext.paths[w.pathId]}),i}t.removeDeadEnds=n})(e.model||(e.model={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o){this.name=i,this.attrs=o,this.innerText=""}return n.escapeString=function(i){var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};for(var a in o)i=i.split(a).join(o[a]);return i},n.prototype.getOpeningTag=function(i){var o="";function a(u,f){f==null||typeof f>"u"||((Array.isArray(f)||typeof f=="object")&&(f=JSON.stringify(f)),typeof f=="string"&&(f=n.escapeString(f)),o+=" "+u+'="'+f+'"')}for(var s in this.attrs)a(s,this.attrs[s]);return"<"+this.name+o+(i?"/":"")+">"},n.prototype.getInnerText=function(){return this.innerTextEscaped?this.innerText:n.escapeString(this.innerText)},n.prototype.getClosingTag=function(){return"</"+this.name+">"},n.prototype.toString=function(){var i=!this.innerText;return i&&!this.closingTags?this.getOpeningTag(!0):this.getOpeningTag(!1)+this.getInnerText()+this.getClosingTag()},n}();t.XmlTag=r})(e.exporter||(e.exporter={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(b,S,x){return x?b+"("+S+")":S}function n(b,S){if(S){var x=new e.paths.Circle([0,0],b.radius),m=e.measure.pathLength(x);if(m)return Math.ceil(m/S)}}function i(b,S,x){var m="",h="",v=!0,p=!1,y=!1,E={};E[e.pathType.Circle]=function(T,I){var _={center:e.point.rounded(e.point.add(T.origin,I.walkedPath.offset),x),radius:e.round(T.radius,x),resolution:n(T,S)};m=r("CAG.circle",JSON.stringify(_),!0),p=!0},E[e.pathType.Line]=function(T,I){var _=I.endPoints.map(function(D){return e.point.rounded(D,x)});I.reversed&&_.reverse(),m=r("new CSG.Path2D",JSON.stringify(_),!0)},E[e.pathType.Arc]=function(T,I){var _=e.angle.ofArcEnd(T);I.reversed&&(y=!0);var D={center:e.point.rounded(e.point.add(T.origin,I.walkedPath.offset),x),radius:e.round(T.radius,x),startangle:e.round(T.startAngle,x),endangle:e.round(_,x),resolution:n(T,S)};m=r("new CSG.Path2D.arc",JSON.stringify(D),!0)};var P={};P[e.pathType.Line]=function(T,I){var _=y!=I.reversed,D=e.point.rounded(I.endPoints[_?0:1],x);A(r(".appendPoint",JSON.stringify(D),!0))},P[e.pathType.Arc]=function(T,I){var _=y!=I.reversed,D=e.angle.ofArcEnd(T),z={radius:e.round(T.radius,x),clockwise:_,large:Math.abs(D-T.startAngle)>180,resolution:n(T,S)},M=e.point.rounded(I.endPoints[_?0:1],x);A(r(".appendArc",JSON.stringify(M)+","+JSON.stringify(z),!0))};function A(T){y?h=T+h:h+=T}for(var L=0;L<b.links.length;L++){var B=b.links[L],F=B.walkedPath.pathContext,U=v?E[F.type]:P[F.type];if(U&&U(F,B),p)return m;v=!1}return m+h+".close().innerToCAG()"}function o(b,S,x){return function(h){b&&b({progress:S+h.progress*x/100})}}function a(b,S,x){function m(p,y){var E=e.chain.toKeyPoints(p,y);return E.push(E[0]),b.fromPoints(E)}function h(p,y){return p.union(y)}function v(p,y){return p.subtract(y)}return s(m,h,v,S,x)}t.toJscadCAG=a;function s(b,S,x,m,h){h===void 0&&(h={});var v={},p={total:0,complete:0};function y(I,_,D){var z=D.shift();return D.forEach(function(M){return z=S(z,M)}),p.complete++,h.statusCallback&&h.statusCallback({progress:I+_*p.complete/p.total}),z}function E(I,_){var D=[];return _.forEach(function(z){z.endless&&(z.contains&&P(I,z.contains),p.total++,D.unshift(b(z,h.maxArcFacet)))}),D}function P(I,_){_.forEach(function(D){if(D.endless){var z={cag:b(D,h.maxArcFacet),subtracts:[]};if(D.contains){var M=E(I,D.contains);M.length>0&&z.subtracts.push(M)}p.total++,I in v||(v[I]=[]),v[I].unshift(z)}})}var A={pointMatchingDistance:h.pointMatchingDistance,byLayers:h.byLayers,contain:!0};h.statusCallback&&h.statusCallback({progress:25});var L=e.model.findChains(m,A);if(Array.isArray(L))P("",L);else for(var B in L)P(B,L[B]);h.statusCallback&&h.statusCallback({progress:50});var F=0;for(var B in v)F+=v[B].length;if(F===0)throw h.statusCallback&&h.statusCallback({progress:100}),"No closed geometries found.";var U={};for(var B in v){var T=v[B].map(function(_){var D=_.cag;return _.subtracts.forEach(function(z){var M=y(50,50,z);D=x(D,M)}),D});U[B]=y(50,50,T)}return h.statusCallback&&h.statusCallback({progress:100}),A.byLayers?U:U[""]}function u(b,S,x){function m(p){return a(b,S,p)}function h(p,y,E){var P=p.extrude({offset:[0,0,y]});return E&&(P=P.translate([0,0,E])),P}function v(p,y){return p.union(y)}return f(m,h,v,S,x)}t.toJscadCSG=u;function f(b,S,x,m,h){h===void 0&&(h={});var v=h.statusCallback;function p(U,T){return e.isNumber(U)?U:T}m.exporterOptions&&e.extendObject(h,m.exporterOptions.toJscadCSG),h.byLayers=h.byLayers||h.layerOptions&&!0,h.statusCallback=o(v,0,50);var y=b(h),E=[];if(h.byLayers)for(var P in y){var A=h.layerOptions[P],L=S(y[P],A.extrude||h.extrude,p(A.z,h.z));E.push(L)}else{var L=S(y,h.extrude,h.z);E.push(L)}h.statusCallback=o(v,50,100);var B={total:E.length-1,complete:0},F=E.shift();return E.forEach(function(U,T){F=x(F,U),B.complete++,h.statusCallback({progress:B.complete/B.total})}),F}function d(b,S){S===void 0&&(S={});function x(L,B){return y(i(L,B,S.accuracy))}function m(L,B){return L+".union(".concat(B,")")}function h(L,B){return L+".subtract(".concat(B,")")}function v(L){return s(x,m,h,b,S)}function p(L,B,F){var U=L+".extrude({ offset: [0, 0, ".concat(B,"] })");return F&&(U=U+".translate([0, 0, ".concat(F,"])")),U}function y(L){return"".concat(P).concat(E).concat(L).concat(P)}var E=new Array((S.indent||0)+1).join(" "),P=S.indent?`
`:"",A=f(v,p,m,b,S).trim();return"function ".concat(S.functionName||"main","(){").concat(y("return ".concat(A,";")),"}").concat(P)}t.toJscadScript=d;function w(b,S,x,m){var h=m.statusCallback;m.statusCallback=o(h,0,50);var v=u(b,x,m);return S.serialize(v,{binary:!1,statusCallback:o(h,50,50)})}t.toJscadSTL=w})(e.exporter||(e.exporter={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(n,i,o){if(i){var a={fontName:"Courier",fontSize:9,origin:[0,0],stroke:"#000"};e.extendObject(a,o);var s=1,u=a.units||i.units;u?s=e.units.conversionScale(u,e.unitType.Inch):s=1/100,s*=72;var f=e.model.scale(e.cloneObject(i),s),d=e.measure.modelExtents(f),w=-d.low[0],b=[w,d.high[1]];b=e.point.add(b,a.origin),e.model.findChains(f,function(S,x,m){function h(v){var p=t.pathToSVGPathData(v.pathContext,v.offset,b);n.path(p).stroke(a.stroke)}S.map(function(v){if(v.links.length>1){var p=t.chainToSVGPathData(v,b);n.path(p).stroke(a.stroke)}else{var y=v.links[0].walkedPath;if(y.pathContext.type===e.pathType.Circle){var E;e.path.moveTemporary([y.pathContext],[y.offset],function(){E=e.path.mirror(y.pathContext,!1,!0)}),e.path.moveRelative(E,b),n.circle(E.origin[0],E.origin[1],y.pathContext.radius).stroke(a.stroke)}else h(y)}}),x.map(h)},{byLayers:!1}),n.font(a.fontName).fontSize(a.fontSize),e.model.getAllCaptionsOffset(f).forEach(function(S){var x=e.angle.ofLineInDegrees(S.anchor),m=e.path.mirror(S.anchor,!1,!0);e.path.moveRelative(m,b);var h=S.text,v=[n.widthOfString(h)/2,n.heightOfString(h)/2],p=e.point.middle(m),y=e.point.subtract(p,v);n.rotate(-x,{origin:p}),n.text(h,y[0],y[1]),n.rotate(x,{origin:p})})}}t.toPDF=r})(e.exporter||(e.exporter={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r={};r[e.pathType.Arc]=function(m,h,v,p,y){p.push("A"),x(p,m.radius,h,y,e.angle.ofArcSpan(m)>180,v?m.startAngle>m.endAngle:m.startAngle<m.endAngle)},r[e.pathType.Line]=function(m,h,v,p,y){p.push("L",e.round(h[0],y),e.round(h[1],y))},r[e.pathType.BezierSeed]=function(m,h,v,p,y){S(p,m,y,v)};function n(m){return e.point.mirror(m,!1,!0)}function i(m){var h=e.angle.ofArcSpan(m);m.startAngle=e.angle.noRevolutions(m.startAngle),m.endAngle=m.startAngle+h}function o(m,h,v){function p(T){return e.point.add(T,h)}for(var y=m.links[0],E=p(n(y.endPoints[y.reversed?1:0])),P=["M",e.round(E[0],v),e.round(E[1],v)],A=0;A<m.links.length;A++){var L=m.links[A],B=L.walkedPath.pathContext,F=r[B.type];if(F){var U;e.path.moveTemporary([B],[L.walkedPath.offset],function(){U=e.path.mirror(B,!1,!0)}),e.path.moveRelative(U,h),F(U,p(n(L.endPoints[L.reversed?0:1])),L.reversed,P,v)}}return m.endless&&P.push("Z"),P.join(" ")}t.chainToSVGPathData=o;function a(m,h,v){return["M",e.round(m[0],v),e.round(m[1],v)].concat(h)}var s={};s[e.pathType.Line]=function(m,h){return a(m.origin,e.point.rounded(m.end,h),h)},s[e.pathType.Circle]=function(m,h,v){return a(m.origin,b(m.radius,h,v),h)},s[e.pathType.Arc]=function(m,h){i(m);var v=e.point.fromArc(m);if(e.measure.isPointEqual(v[0],v[1]))return s[e.pathType.Circle](m,h);var p=["A"];return x(p,m.radius,v[1],h,e.angle.ofArcSpan(m)>180,m.startAngle>m.endAngle),a(v[0],p,h)},s[e.pathType.BezierSeed]=function(m,h){var v=[];return S(v,m,h),a(m.origin,v,h)};function u(m,h,v,p,y){var E=s[m.type];if(E){var P;e.path.moveTemporary([m],[h],function(){P=e.path.mirror(m,!1,!0)}),e.path.moveRelative(P,v);var A=E(P,p,y);return A.join(" ")}return""}t.pathToSVGPathData=u;function f(m,h,v,p){var y={};return v.unifyBeziers=!0,e.model.findChains(m,function(E,P,A){function L(F,U){var T=u(F.pathContext,F.offset,h,p,U);y[A].push(T)}y[A]=[];function B(F,U){F.forEach(function(T){if(T.links.length>1){var I=o(T,h,p);y[A].push(I)}else L(T.links[0].walkedPath,U);T.contains&&B(T.contains,!U)})}B(E,!0),P.forEach(function(F){return L(F)})},v),y}function d(m){for(var h=[],v=1;v<arguments.length;v++)h[v-1]=arguments[v];var p={fillRule:"evenodd"};typeof h[0]=="boolean"?(p.byLayers=h[0],p.origin=h[1],p.accuracy=h[2]):e.isObject(h[0])&&e.extendObject(p,h[0]);var y={byLayers:p.byLayers,contain:!1};p.fillRule==="nonzero"&&(y.contain={alternateDirection:!0});var E=e.measure.modelExtents(m);p.origin||(p.origin=[-E.low[0],E.high[1]]);var P=f(m,p.origin,y,p.accuracy),A={};for(var L in P)A[L]=P[L].join(" ");return y.byLayers?A:A[""]}t.toSVGPathData=d;function w(m,h){function v(me,ye,De){De===void 0&&(De=!1),!De&&typeof ye=="string"&&ye.length>0?(ye in I||(I[ye]=[]),I[ye].push(me)):T.push(me)}function p(me){var ye=[];function De(qe,Ke){Ke!==void 0&&ye.push(qe+":"+Ke)}return De("stroke",me.stroke),De("stroke-width",me.strokeWidth),De("fill",me.fill),ye.join(";")}function y(me,ye){ye&&e.extendObject(me,{stroke:ye.stroke,"stroke-width":ye.strokeWidth,fill:ye.fill,style:ye.cssStyle||p(ye),class:ye.className})}function E(me){if(B.layerOptions&&B.layerOptions[me])return B.layerOptions[me];if(me in t.colors)return{stroke:me}}function P(me,ye,De,qe,Ke){qe===void 0&&(qe=null),Ke===void 0&&(Ke=!1),me!=="text"&&y(ye,E(De)),B.scalingStroke||(ye["vector-effect"]="non-scaling-stroke");var at=new t.XmlTag(me,ye);at.closingTags=B.closingTags,qe&&(at.innerText=qe),v(at.toString(),De,Ke)}function A(me){var ye=n(me);return e.point.scale(ye,B.scale)}function L(me,ye){var De=e.path.mirror(me,!1,!0);return e.path.moveRelative(e.path.scale(De,B.scale),ye)}var B={accuracy:.001,annotate:!1,origin:null,scale:1,stroke:"#000",strokeLineCap:"round",strokeWidth:"0.25mm",fill:"none",fillRule:"evenodd",fontSize:"9pt",useSvgPathOnly:!0,viewBox:!0};e.extendObject(B,h);var F,U=e.isModel(m);U&&(F=m,F.exporterOptions&&e.extendObject(B,F.exporterOptions.toSVG));var T=[],I={};if(U)F=m;else if(Array.isArray(m)){var _={};m.forEach(function(me,ye){_[ye]=me}),F={paths:_}}else e.isPath(m)&&(F={paths:{modelToMeasure:m}});var D=e.measure.modelExtents(F),z=e.model.getAllCaptionsOffset(F);if(z.forEach(function(me){e.measure.increase(D,e.measure.pathExtents(me.anchor),!0)}),!B.units){var M=t.tryGetModelUnits(m);M&&(B.units=M)}var q=t.svgUnit[B.units];if(q&&B.viewBox&&(B.scale*=q.scaleConversion),D&&!B.origin){var J=-D.low[0]*B.scale;B.origin=[J,D.high[1]*B.scale]}e.extendObject(h,B);var ee={};if(D&&B.viewBox){var le=e.round(D.width*B.scale,B.accuracy),oe=e.round(D.height*B.scale,B.accuracy),V=[0,0,le,oe],H=q?q.svgUnitType:"";ee={width:le+H,height:oe+H,viewBox:V.join(" ")}}ee.xmlns="http://www.w3.org/2000/svg";var X=new t.XmlTag("svg",e.extendObject(ee,B.svgAttrs));v(X.getOpeningTag(!1));var Y={id:"svgGroup","stroke-linecap":B.strokeLineCap,"fill-rule":B.fillRule,"font-size":B.fontSize};y(Y,B);var ie=new t.XmlTag("g",Y);if(v(ie.getOpeningTag(!1)),B.useSvgPathOnly){var se={byLayers:!0};B.fillRule==="nonzero"&&(se.contain={alternateDirection:!0});var pe=f(F,B.origin,se,B.accuracy);for(var ae in pe){var ce=pe[ae].join(" "),Ae={d:ce};ae.length>0&&(Ae.id=ae),P("path",Ae,ae,null,!0)}}else{let me=function(ge,de,Re){P("text",{id:ge+"_text",x:e.round(de[0],B.accuracy),y:e.round(de[1],B.accuracy)},Re,ge)},ye=function(ge,de,Re,Ie,Fe,We,He,Ee,ze){P("path",{id:ge,"data-route":We,d:["M",e.round(de,B.accuracy),e.round(Re,B.accuracy)].concat(Ie).join(" ")},Fe),Ee&&me(ge,He,Fe)},De=function(ge,de,Re,Ie,Fe,We,He){var Ee=b(Re,B.accuracy);ye(ge,de[0],de[1],Ee,Ie,Fe,de,We)},qe=function(ge,de,Re,Ie,Fe){var We="flow";Te[e.pathType.Circle]("",new e.paths.Circle(Re,ge.size/2),de,We,null,!1,null);var He=[-1*ge.size,ge.size/2],Ee=[He,e.point.mirror(He,!1,!0)].map(function(ze){return new e.paths.Line(e.point.add(e.point.rotate(ze,Fe),Ie),Ie)});Ee.forEach(function(ze){return Te[e.pathType.Line]("",ze,de,We,null,!1,null)})},Ke=function(ge,de){K.attrs={id:ge},v(K.getOpeningTag(!1),de.layer)},at=function(ge){v(K.getClosingTag(),ge.layer)};var Te={};Te[e.pathType.Line]=function(ge,de,Re,Ie,Fe,We,He){var Ee=de.origin,ze=de.end;P("line",{id:ge,class:Ie,"data-route":Fe,x1:e.round(Ee[0],B.accuracy),y1:e.round(Ee[1],B.accuracy),x2:e.round(ze[0],B.accuracy),y2:e.round(ze[1],B.accuracy)},Re),We&&me(ge,e.point.middle(de),Re),He&&qe(He,Re,de.origin,de.end,e.angle.ofLineInDegrees(de))},Te[e.pathType.Circle]=function(ge,de,Re,Ie,Fe,We,He){var Ee=de.origin;P("circle",{id:ge,class:Ie,"data-route":Fe,r:de.radius,cx:e.round(Ee[0],B.accuracy),cy:e.round(Ee[1],B.accuracy)},Re),We&&me(ge,Ee,Re)},Te[e.pathType.Arc]=function(ge,de,Re,Ie,Fe,We,He){i(de);var Ee=e.point.fromArc(de);if(e.measure.isPointEqual(Ee[0],Ee[1]))De(ge,de.origin,de.radius,Re,Fe,We);else{var ze=["A"];x(ze,de.radius,Ee[1],B.accuracy,e.angle.ofArcSpan(de)>180,de.startAngle>de.endAngle),ye(ge,Ee[0][0],Ee[0][1],ze,Re,Fe,e.point.middle(de),We),He&&qe(He,Re,Ee[1],Ee[0],e.angle.noRevolutions(de.startAngle-90))}},Te[e.pathType.BezierSeed]=function(ge,de,Re,Ie,Fe,We,He){var Ee=[];S(Ee,de,B.accuracy),ye(ge,de.origin[0],de.origin[1],Ee,Re,Fe,e.point.middle(de),We)};var K=new t.XmlTag("g"),he={beforeChildWalk:function(ge){return Ke(ge.childId,ge.childModel),!0},onPath:function(ge){var de=Te[ge.pathContext.type];if(de){var Re=e.point.add(A(ge.offset),B.origin);de(ge.pathId,L(ge.pathContext,Re),ge.layer,null,ge.route,B.annotate,B.flow)}},afterChildWalk:function(ge){at(ge.childModel)}};Ke("0",F),e.model.walk(F,he);for(var xe in I){var Ve=new t.XmlTag("g",{id:xe});y(Ve.attrs,E(xe));for(var Ze=0;Ze<I[xe].length;Ze++)Ve.innerText+=I[xe][Ze];Ve.innerTextEscaped=!0,v(Ve.toString())}at(F)}var Ge=z.map(function(me){var ye=L(me.anchor,B.origin),De=e.point.rounded(e.point.middle(ye),B.accuracy),qe=new t.XmlTag("text",{"alignment-baseline":"middle","text-anchor":"middle",transform:"rotate(".concat(e.angle.ofLineInDegrees(ye),",").concat(De[0],",").concat(De[1],")"),x:De[0],y:De[1]});return y(qe.attrs,E(me.layer)),qe.innerText=me.text,qe.toString()});if(Ge.length){var Me=new t.XmlTag("g",{id:"captions"});y(Me.attrs,E(Me.attrs.id)),Me.innerText=Ge.join(""),Me.innerTextEscaped=!0,v(Me.toString())}return v(ie.getClosingTag()),v(X.getClosingTag()),T.join("")}t.toSVG=w;function b(m,h,v){var p=e.round(m,h),y=["m",-p,0];function E(P){y.push("a"),x(y,p,[2*p*P,0],h,!1,!v)}return E(1),E(-1),y.push("z"),y}function S(m,h,v,p){if(h.controls.length===1)m.push("Q",e.round(h.controls[0][0],v),e.round(h.controls[0][1],v));else{var y=p?[h.controls[1],h.controls[0]]:h.controls;m.push("C",e.round(y[0][0],v),e.round(y[0][1],v),e.round(y[1][0],v),e.round(y[1][1],v))}var E=p?h.origin:h.end;m.push(e.round(E[0],v),e.round(E[1],v))}function x(m,h,v,p,y,E){var P=e.round(h,p),A=v;m.push(P,P),m.push(0),m.push(y?1:0),m.push(E?0:1),m.push(e.round(A[0],p),e.round(A[1],p))}t.svgUnit={},t.svgUnit[e.unitType.Inch]={svgUnitType:"in",scaleConversion:1},t.svgUnit[e.unitType.Millimeter]={svgUnitType:"mm",scaleConversion:1},t.svgUnit[e.unitType.Centimeter]={svgUnitType:"cm",scaleConversion:1},t.svgUnit[e.unitType.Foot]={svgUnitType:"in",scaleConversion:12},t.svgUnit[e.unitType.Meter]={svgUnitType:"cm",scaleConversion:100}})(e.exporter||(e.exporter={}))})(MakerJs||(MakerJs={})),function(e){(function(t){function r(n,i){i===void 0&&(i={});var o={};function a(P){o.paths||(o.paths={}),o.paths["p_"+ ++S]=P}function s(P){o.models||(o.models={}),o.models["p_"+ ++S]=P}function u(P,A,L){A===void 0&&(A=0),L===void 0&&(L=P.from),A<0&&(A=A+P.data.length);var B=e.point.mirror([P.data[0+A],P.data[1+A]],!1,!0);return P.absolute?B:e.point.add(B,L)}function f(P,A){return e.measure.isPointEqual(P.from,A)||a(new e.paths.Line(P.from,A)),A}var d={};d.M=function(P){if(w=u(P),P.data.length>2){P.from=w;for(var A=2;A<P.data.length;A=A+2)P.from=f(P,u(P,A));return P.from}else return w},d.Z=function(P){return f(P,w)},d.H=function(P){var A=e.point.clone(P.from);return P.absolute?A[0]=P.data[0]:A[0]+=P.data[0],f(P,A)},d.V=function(P){var A=e.point.clone(P.from);return P.absolute?A[1]=-P.data[0]:A[1]-=P.data[0],f(P,A)},d.L=function(P){for(var A,L=0;L<P.data.length;L=L+2)A=u(P,L),P.from=f(P,A);return P.from},d.A=function(P){for(var A,L,B,F,U,T,I,_,D,z,M,q=0;q<P.data.length;q=q+7)A=P.data[0+q],L=P.data[1+q],B=P.data[2+q],F=P.data[3+q]===1,U=P.data[4+q]===1,T=u(P,5+q),I=A!==L,_=new e.paths.Line(P.from,e.point.rotate(T,B,P.from)),I&&(_=e.path.distort(_,1,A/L)),D=new e.paths.Arc(_.origin,_.end,A,F,U),I?(A<D.radius&&(z=D.radius/A,A*=z,L*=z),M=new e.models.EllipticArc(D,1,L/A,i.bezierAccuracy),e.model.rotate(M,-B,P.from),s(M)):(e.path.rotate(D,-B,P.from),a(D)),P.from=T;return T},d.C=function(P){for(var A,L,B=P.from,F,U=0;U<P.data.length;U=U+6)P.from=B,A=u(P,0+U,B),L=u(P,2+U,B),F=u(P,4+U,B),s(new e.models.BezierCurve(B,A,L,F,i.bezierAccuracy)),B=F;return F},d.S=function(P){var A,L,B,F=P.from,U;P.prev.command==="C"||P.prev.command==="S"?L=u(P.prev,-4):L=P.from;for(var T=0;T<P.data.length;T=T+4)P.from=F,A=e.point.rotate(L,180,F),B=u(P,0+T),U=u(P,2+T),s(new e.models.BezierCurve(F,A,B,U,i.bezierAccuracy)),F=U,L=B;return U},d.Q=function(P){for(var A,L=P.from,B,F=0;F<P.data.length;F=F+4)P.from=L,A=u(P,0+F),B=u(P,2+F),s(new e.models.BezierCurve(L,A,B,i.bezierAccuracy)),L=B;return B},d.T=function(P){var A,L,B;P.prev.command==="Q"?(L=u(P.prev,-4),A=e.point.rotate(L,180,P.from)):P.prev.command==="T"?(P.prev.absolute=!0,A=u(P.prev,-2)):A=P.from;for(var F=0;F<P.data.length;F=F+2)B=u(P,0+F),s(new e.models.BezierCurve(P.from,A,B,i.bezierAccuracy)),P.from=B,A=e.point.rotate(A,180,P.from);var U=e.point.mirror(A,!1,!0);return P.data.push.apply(P.data,U),B};for(var w=[0,0],b=[0,0],S=0,x,m=/([achlmqstvz])([0-9e\.,\+-\s]*)/ig,h;(h=m.exec(n))!==null;){h.index===m.lastIndex&&m.lastIndex++;var v=h[1],p=h[2],y={command:v.toUpperCase(),data:[],from:b,prev:x};v===y.command&&(y.absolute=!0),y.data=t.parseNumericList(p);var E=d[y.command];E&&(b=E(y)),x=y}return o}t.fromSVGPathData=r})(e.importer||(e.importer={}))}(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(v,p){var y=new e.measure.Atlas(v),E=e.measure.modelExtents(v,y),P=E.high[1],A=[],L={},B={beforeChildWalk:function(D){var z=D.childModel,M=y.modelMap[D.routeKey];if(M){var q=e.measure.augment(M);e.model.originate(z,[q.center[0],P*p]);var J=z.origin[0]-E.low[0];L[D.childId]=J;var ee=J/E.width;return A.push({childId:D.childId,xRatio:ee}),!1}}};e.model.walk(v,B),A.sort(function(D,z){return D.xRatio-z.xRatio});var F=A[0],U=A[A.length-1];if(A.length>1){var T=F.xRatio,I=U.xRatio,_=I-T;A.forEach(function(D){return D.xRatio=(D.xRatio-T)/_})}return{cpa:A,firstX:L[F.childId],lastX:E.width-L[U.childId]}}function n(v,p,y){p.forEach(function(E){var P=v.models[E.childId];P.origin=E.origin,y&&e.model.rotate(P,E.angle,E.origin)})}var i={};i[e.pathType.Arc]=function(v,p,y){var E=e.angle.ofArcSpan(v);y.forEach(function(P){return P.angle=p?v.endAngle-P.xRatio*E-90:v.startAngle+P.xRatio*E+90})},i[e.pathType.Line]=function(v,p,y){var E=e.angle.ofLineInDegrees(v);y.forEach(function(P){return P.angle=E})};function o(v,p,y,E,P,A){y===void 0&&(y=0),E===void 0&&(E=!1),P===void 0&&(P=!1),A===void 0&&(A=!0);var L=r(v,y),B=L.cpa,F=p;if(P&&B.length>1){var U=e.measure.pathLength(p);L.firstX+L.lastX<U&&(F=e.path.clone(p),e.path.alterLength(F,-L.firstX,!0),e.path.alterLength(F,-L.lastX))}B.forEach(function(I){return I.origin=e.point.middle(F,E?1-I.xRatio:I.xRatio)});var T=i[F.type];return T&&T(F,E,B),n(v,B,A),v}t.childrenOnPath=o;function a(v,p){var y=new e.paths.Arc([0,0],0,0,0);return v.map(function(E,P){var A;return P===0?A=e.angle.ofPointInDegrees(E,v[P+1])+90:P===v.length-1?A=e.angle.ofPointInDegrees(v[P-1],E)+90:(y.origin=E,y.startAngle=e.angle.ofPointInDegrees(E,v[P+1]),y.endAngle=e.angle.ofPointInDegrees(E,v[P-1]),A=e.angle.ofArcMiddle(y)),A+p})}function s(v,p,y,E,P,A){y===void 0&&(y=0),E===void 0&&(E=!1),P===void 0&&(P=!1),A===void 0&&(A=!0);var L=r(v,y),B=L.cpa,F=p.pathLength,U;if(B.length>1){P&&(F-=L.firstX+L.lastX);var T=B.map(function(z){return(E?1-z.xRatio:z.xRatio)*F}),I;if(E&&T.reverse(),I=T.map(function(z,M){return Math.abs(z-(M==0?0:T[M-1]))}),P?I[0]+=E?L.lastX:L.firstX:I.shift(),U=e.chain.toPoints(p,I),U.length<B.length){var _=p.links[p.links.length-1];U.push(_.endPoints[_.reversed?0:1])}P&&U.shift()}else U=e.chain.toPoints(p,.5*F),U.length=2,U.push(p.links[p.links.length-1].endPoints[p.links[p.links.length-1].reversed?0:1]);E&&U.reverse();var D=a(U,-90);return B.length>1?B.forEach(function(z,M){z.angle=D[M],z.origin=U[M]}):(B[0].angle=D[1],B[0].origin=U[1]),n(v,B,A),v}t.childrenOnChain=s;function u(v,p,y,E){var P={},A,L;e.isModel(v)?(A=P.models={},L=e.model.rotate):(A=P.paths={},L=e.path.rotate);for(var B=0;B<p;B++)A[B]=L(e.cloneObject(v),B*y,E);return P}t.cloneToRadial=u;function f(v,p,y,E){var P={},A,L,B;e.isModel(p)?(L=e.measure.modelExtents,A=P.models={},B=e.model.move):(L=e.measure.pathExtents,A=P.paths={},B=e.path.move);for(var F=L(p),U=F.high[v]-F.low[v],T=0;T<y;T++){var I=[0,0];I[v]=T*(U+E),A[T]=B(e.cloneObject(p),I)}return P}function d(v,p,y){return y===void 0&&(y=0),f(1,v,p,y)}t.cloneToColumn=d;function w(v,p,y){return y===void 0&&(y=0),f(0,v,p,y)}t.cloneToRow=w;function b(v,p,y,E){var P=S(E);return d(w(v,p,P[0]),y,P[1])}t.cloneToGrid=b;function S(v){return Array.isArray(v)?v:[v,v]}function x(v,p,y,E){var P;e.isModel(v)?P=v:P={paths:{0:v}};for(var A=E(P),L={models:{}},B=0;B<y;B++){var F=B%2;L.models[B]=e.model.move(w(v,p+F,A.xMargin),[F*A.x,B*A.y])}return L}function m(v,p,y,E){var P=S(E);function A(L){var B=e.measure.modelExtents(L),F=P[0]||0,U=P[1]||0;return{x:(B.width+F)/-2,y:B.height+U,xMargin:F}}return x(v,p,y,A)}t.cloneToBrick=m;function h(v,p,y,E){E===void 0&&(E=0);function P(A){var L=e.measure.boundingHexagon(A),B=2*e.solvers.equilateralAltitude(L.radius),F=B+E;return{x:F/-2,y:e.solvers.equilateralAltitude(F),xMargin:E}}return x(v,p,y,P)}t.cloneToHoneycomb=h})(e.layout||(e.layout={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=!1;function n(){if(!r)try{var p=Bezier.prototype;r=!0}catch{throw"Bezier library not found. If you are using Node, try running 'npm install' or if you are in the browser, download http://pomax.github.io/bezierjs/bezier.js to your website and add a script tag."}}var i;function o(p){var y=[p.origin];y.push.apply(y,p.controls),y.push(p.end);var E=y.map(function(P){var A={x:P[0],y:P[1]};return A});return i?Bezier.apply(i,E):(n(),i=new Bezier(E)),i}function a(p,y){var E=p.points.map(f),P=new h(E);return y&&(P.parentRange=y),P}function s(p){var y=[];return y.push.apply(y,p.origin),y.push.apply(y,p.controls[0]),p.controls.length>1&&y.push.apply(y,p.controls[1]),y.push.apply(y,p.end),n(),new Bezier(y)}function u(p){var y=p.extrema().values.map(function(E){return e.round(E)}).filter(function(E,P,A){return A.indexOf(E)===P}).sort();return y.length===0?[0,1]:(y[0]!==0&&y.unshift(0),y[y.length-1]!==1&&y.push(1),y)}function f(p){return[p.x,p.y]}var d=function(){function p(y,E,P){this.t=E,this.point=e.point.add(f(y.get(E)),P)}return p}();function w(p,y,E,P,A){var L=E-y;function B(F){var U=y+L*F,T=f(p.get(U)),I=e.point.middle(P,A?1-F:F);return e.measure.pointDistance(I,T)}return B(.25)+B(.75)}function b(p,y,E,P){for(var A,L,B=new d(p,y),F=new d(p,E),U=F,T=B,I=0,_=U,D;I<100;){var z=f(p.get((B.t+_.t)/2));try{A=new e.paths.Arc(B.point,z,_.point)}catch{if(L)return L;break}D===void 0&&(D=e.measure.isPointEqual(B.point,e.point.fromAngleOnCircle(A.endAngle,A)));var M=w(p,y,_.t,A,D);if(M<=P?(A.bezierData={startT:y,endT:_.t},T=_,L=A):U=_,T.t===U.t||L&&L!==A&&e.angle.ofArcSpan(A)-e.angle.ofArcSpan(L)<.5)return L;I++,_=new d(p,(T.t+U.t)/2)}var q=new e.paths.Line(B.point,_.point);return q.bezierData={startT:y,endT:_.t},q}function S(p,y,E,P,A,L){for(var B=0,F;P<A;){F=b(y,P,A,E),P=F.bezierData.endT;var U=e.measure.pathLength(F);U<1e-4||(p.paths[F.type+"_"+(L+B)]=F,B++)}return B}function x(p,y,E,P){var A=o(p.seed),L=[y.bezierData.startT,y.bezierData.endT].map(function(T){return new d(A,T,P)}),B=E.slice(),F=B.map(function(T){return e.measure.pointDistance(T,L[0].point)});F[0]>F[1]&&B.reverse();for(var U=2;U--;)if(!e.measure.isPointEqual(B[U],L[U].point))return null;return y.bezierData}function m(p,y,E,P){var A=[y.links[0],y.links[y.links.length-1]];A[0].walkedPath.pathContext.bezierData.startT>A[1].walkedPath.pathContext.bezierData.startT&&(e.chain.reverse(y),A.reverse());var L=A.map(function(F){return x(p,F.walkedPath.pathContext,F.endPoints,F.walkedPath.offset)}),B={startT:L[0]?L[0].startT:null,endT:L[1]?L[1].endT:null};return B.startT!==null&&B.endT!==null?B:y.links.length>2?(B.startT===null&&(P(y.links[0].walkedPath.pathContext,E,!0),B.startT=y.links[1].walkedPath.pathContext.bezierData.startT),B.endT===null&&(P(y.links[y.links.length-1].walkedPath.pathContext,E,!0),B.endT=y.links[y.links.length-2].walkedPath.pathContext.bezierData.endT),B):null}var h=function(){function p(){for(var y=[],E=0;E<arguments.length;E++)y[E]=arguments[E];switch(this.type=e.pathType.BezierSeed,y.length){case 1:var P=y[0];this.origin=P[0],P.length===3?(this.controls=[P[1]],this.end=P[2]):P.length===4?(this.controls=[P[1],P[2]],this.end=P[3]):this.end=P[1];break;case 3:Array.isArray(y[1])?this.controls=y[1]:this.controls=[y[1]],this.end=y[2];break;case 4:this.controls=[y[1],y[2]],this.end=y[3];break}}return p}(),v=function(){function p(){for(var y=[],E=0;E<arguments.length;E++)y[E]=arguments[E];this.type=p.typeName;var P=Array.isArray(y[0]);switch(y.length){case 2:if(P)this.accuracy=y[1];else{this.seed=y[0],this.accuracy=y[1];break}case 1:if(P){var A=y[0];this.seed=new h(A)}else this.seed=y[0];break;default:switch(y.length){case 4:if(e.isPoint(y[3])){this.seed=new h(y);break}else this.accuracy=y[3];case 3:P&&(this.seed=new h(y.slice(0,3)));break;case 5:this.accuracy=y[4],this.seed=new h(y.slice(0,4));break}break}if(this.paths={},e.measure.isBezierSeedLinear(this.seed)){var L=new e.paths.Line(e.point.clone(this.seed.origin),e.point.clone(this.seed.end));L.bezierData={startT:0,endT:1},this.paths={0:L};return}var B=s(this.seed),F=u(B);if(this.paths={},!this.accuracy){var U=B.length();this.accuracy=U/100}for(var T=0,I=1;I<F.length;I++){var _=F[I]-F[I-1];T+=S(this,B,this.accuracy*_,F[I-1],F[I],T)}}return p.getBezierSeeds=function(y,E){E===void 0&&(E={}),E.shallow=!0,E.unifyBeziers=!1;var P={},A=function(L,B,F){F===void 0&&(F=!1),P[B]||(P[B]=[]),P[B].push(F?e.path.clone(L):L)};return e.model.findChains(y,function(L,B,F){L.forEach(function(U){var T=m(y,U,F,A);if(T){var I=o(y.seed),_=I.split(T.startT,T.endT);A(a(_),F)}else U.links.forEach(function(D){return A(D.walkedPath.pathContext,F,!0)})}),B.forEach(function(U){if(U.pathContext.type===e.pathType.Line)return A(U.pathContext,F,!0);var T=x(y,U.pathContext,e.point.fromPathEnds(U.pathContext),U.offset);if(T){var I=o(y.seed),_=I.split(T.startT,T.endT);A(a(_),F)}else A(U.pathContext,F,!0)})},E),E.byLayers?P:P[""]},p.computeLength=function(y){var E=s(y);return E.length()},p.computePoint=function(y,E){var P=o(y),A=P.compute(E);return f(A)},p.typeName="BezierCurve",p}();t.BezierCurve=v,v.metaParameters=[{title:"points",type:"select",value:[[[100,0],[-80,-60],[100,220],[100,60]],[[0,0],[100,0],[100,100]],[[0,0],[20,0],[80,100],[100,100]]]}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=45;function n(u){return 4*(Math.tan(u/4)/3)}function i(u){var f=e.angle.ofArcSpan(u),d=n(e.angle.toRadians(f)),w=[u.radius,u.radius*d],b=e.point.rotate(e.point.mirror(w,!1,!0),f,[0,0]);return[w,b].map(function(S){return e.point.add(u.origin,e.point.rotate(S,u.startAngle,[0,0]))})}function o(u){var f=e.angle.ofArcSpan(u);if(f<=90){var d=e.point.fromPathEnds(u),w=i(u);return{type:e.pathType.BezierSeed,origin:d[0],controls:w,end:d[1]}}return null}var a=function(){function u(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];var w=this;this.models={};var b=360/r,S,x=e.isPoint(f[0]),m=function(h){switch(h){case 2:x&&(w.origin=f[0]);break;case 3:w.origin=f[0];break;case 4:w.origin=[f[0],f[1]];break}for(var v=360/b,p=new e.paths.Arc([0,0],1,0,v),y=0;y<b;y++){var E=o(p);switch(h){case 1:E=e.path.scale(E,f[0]);break;case 2:x?E=e.path.scale(E,f[1]):E=e.path.distort(E,f[0],f[1]);break;case 3:E=e.path.distort(E,f[1],f[2]);break;case 4:E=e.path.distort(E,f[2],f[3]);break}w.models["Curve_"+(1+y)]=new t.BezierCurve(E,S),p.startAngle+=v,p.endAngle+=v}};switch(f.length){case 2:m(2);break;case 3:x?m(3):(S=f[2],m(2));break;case 4:x?(S=f[3],m(3)):m(4);break;case 5:S=f[4],m(4);break}}return u}();t.Ellipse=a,a.metaParameters=[{title:"radiusX",type:"range",min:1,max:50,value:50},{title:"radiusY",type:"range",min:1,max:50,value:25}];var s=function(){function u(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.models={};var w,b,S,x;e.isPathArc(f[0])?(w=f[0],S=f[1],x=f[2],b=f[3]):(w=new e.paths.Arc([0,0],1,f[0],f[1]),S=f[2],x=f[3],b=f[4]);for(var m=e.angle.ofArcSpan(w),h=Math.ceil(m/r),v=m/h,p=e.path.clone(w),y=0;y<h;y++){p.startAngle=w.startAngle+y*v,p.endAngle=p.startAngle+v;var E=o(p);E=e.path.distort(E,S,x),this.models["Curve_"+(1+y)]=new t.BezierCurve(E,b)}}return u}();t.EllipticArc=s,s.metaParameters=[{title:"startAngle",type:"range",min:0,max:90,value:0},{title:"endAngle",type:"range",min:90,max:360,value:180},{title:"radiusX",type:"range",min:1,max:50,value:50},{title:"radiusY",type:"range",min:1,max:50,value:25}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){function r(i){var o;if(Array.isArray(i)){if(e.isPoint(i[0]))return i;o=i}else o=e.importer.parseNumericList(i);for(var a=[],s=0;s<o.length;s+=2)a.push([o[s],o[s+1]]);return a}var n=function(){function i(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var s=this;this.paths={};var u,f;switch(o.length){case 1:u=!0,f=r(o[0]);break;case 2:u=o[0],f=r(o[1]);break}for(var d=function(b,S,x){x===void 0&&(x=!1),!(x&&e.measure.pointDistance(f[b],f[S])==0)&&(s.paths["ShapeLine"+w]=new e.paths.Line(f[b],f[S]))},w=1;w<f.length;w++)d(w-1,w);u&&f.length>2&&d(f.length-1,0,!0)}return i}();t.ConnectTheDots=n,n.metaParameters=[{title:"closed",type:"bool",value:!0},{title:"points",type:"select",value:[[[0,0],[40,40],[60,20],[100,100],[60,60],[40,80]],[[0,0],[100,0],[50,87]],[-10,0,10,0,0,20],"-10 0 10 0 0 20"]}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a,s){this.paths={},this.paths=new t.ConnectTheDots(!0,n.getPoints(i,o,a,s)).paths}return n.circumscribedRadius=function(i,o){return i/Math.cos(o/2)},n.getPoints=function(i,o,a,s){a===void 0&&(a=0),s===void 0&&(s=!1);var u=[],f=e.angle.toRadians(a),d=2*Math.PI/i;s&&(o=n.circumscribedRadius(o,d));for(var w=0;w<i;w++)u.push(e.point.fromPolar(d*w+f,o));return u},n}();t.Polygon=r,r.metaParameters=[{title:"number of sides",type:"range",min:3,max:24,value:6},{title:"radius",type:"range",min:1,max:100,value:50},{title:"offset angle",type:"range",min:0,max:180,value:0},{title:"radius on flats (vs radius on vertexes)",type:"bool",value:!1}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a){this.paths={};for(var s=0;s<o.length;s++){var u=a?a[s]:s.toString();this.paths[u]=new e.paths.Circle(o[s],i)}}return n}();t.Holes=r,r.metaParameters=[{title:"holeRadius",type:"range",min:.1,max:10,step:.1,value:1},{title:"points",type:"select",value:[[[0,0],[10,10],[20,20],[30,30],[40,40],[50,50],[60,60],[70,70],[80,80]],[[0,0],[0,25],[0,50],[0,75],[0,100],[25,50],[50,50],[75,50],[100,100],[100,75],[100,50],[100,25],[100,0]]]}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a,s){s===void 0&&(s=0),this.paths={};var u=t.Polygon.getPoints(a,i,s),f=u.map(function(d,w){return"bolt "+w});this.paths=new t.Holes(o,u,f).paths}return n}();t.BoltCircle=r,r.metaParameters=[{title:"bolt circle radius",type:"range",min:1,max:100,value:50},{title:"hole radius",type:"range",min:1,max:50,value:5},{title:"bolt count",type:"range",min:3,max:24,value:12},{title:"offset angle",type:"range",min:0,max:180,value:0}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a){this.paths={};var s=[[0,0],[i,0],[i,o],[0,o]],u=["BottomLeft_bolt","BottomRight_bolt","TopRight_bolt","TopLeft_bolt"];this.paths=new t.Holes(a,s,u).paths}return n}();t.BoltRectangle=r,r.metaParameters=[{title:"width",type:"range",min:1,max:100,value:100},{title:"height",type:"range",min:1,max:100,value:50},{title:"hole radius",type:"range",min:1,max:50,value:5}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a,s,u){s===void 0&&(s=0),u===void 0&&(u=!1),this.paths={};var f=Math.min(o,i)/2,d;switch(s){case-1:case 1:d=f/2;break;case 0:default:d=f*Math.SQRT2/2;break}a=Math.min(a,d);var w,b,S,x,m;switch(s){case-1:w=0,b=a,S=0,x=a*2,m=[180,0,0,180];break;case 1:w=a,b=0,S=a*2,x=0,m=[270,270,90,90];break;case 0:default:w=b=a/Math.SQRT2,S=x=w*2,m=[225,315,45,135];break}u?(this.paths.Left=new e.paths.Line([0,0],[0,o-x]),this.paths.Right=new e.paths.Line([i,0],[i,o-x])):(this.paths.Left=new e.paths.Line([0,x],[0,o-x]),this.paths.Right=new e.paths.Line([i,x],[i,o-x]),this.paths.Bottom=new e.paths.Line([S,0],[i-S,0]),this.paths.BottomLeft=new e.paths.Arc([w,b],a,m[0]-90,m[0]+90),this.paths.BottomRight=new e.paths.Arc([i-w,b],a,m[1]-90,m[1]+90)),this.paths.TopRight=new e.paths.Arc([i-w,o-b],a,m[2]-90,m[2]+90),this.paths.TopLeft=new e.paths.Arc([w,o-b],a,m[3]-90,m[3]+90),this.paths.Top=new e.paths.Line([S,o],[i-S,o])}return n}();t.Dogbone=r,r.metaParameters=[{title:"width",type:"range",min:1,max:100,value:50},{title:"height",type:"range",min:1,max:100,value:100},{title:"radius",type:"range",min:0,max:50,value:5},{title:"style",type:"select",value:[0,1,-1]},{title:"bottomless",type:"bool",value:!1}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a,s){this.paths={};var u=i/2;a<0&&(a=0),a===void 0&&(a=u),a=Math.min(a,u),a=Math.min(a,o);var f=Math.max(u-a,0),d=Math.max(o-a,0);s||(this.paths.Bottom=new e.paths.Line([-u,0],[u,0])),d&&(this.paths.Left=new e.paths.Line([-u,0],[-u,d]),this.paths.Right=new e.paths.Line([u,0],[u,d])),a>0&&(this.paths.TopLeft=new e.paths.Arc([-f,d],a,90,180),this.paths.TopRight=new e.paths.Arc([f,d],a,0,90)),f&&(this.paths.Top=new e.paths.Line([-f,o],[f,o]))}return n}();t.Dome=r,r.metaParameters=[{title:"width",type:"range",min:1,max:100,value:50},{title:"height",type:"range",min:1,max:100,value:100},{title:"radius",type:"range",min:0,max:50,value:25},{title:"bottomless",type:"bool",value:!1}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];this.paths={};var a,s,u=0;switch(i.length){case 3:a=i[0],s=i[1],u=i[2];break;case 2:u=i[1];case 1:var f=e.measure.modelExtents(i[0]);this.origin=e.point.subtract(f.low,[u,u]),a=f.high[0]-f.low[0]+2*u,s=f.high[1]-f.low[1]+2*u;break}var d=Math.min(s,a)/2;u=Math.min(u,d);var w=a-u,b=s-u;u>0&&(this.paths.BottomLeft=new e.paths.Arc([u,u],u,180,270),this.paths.BottomRight=new e.paths.Arc([w,u],u,270,0),this.paths.TopRight=new e.paths.Arc([w,b],u,0,90),this.paths.TopLeft=new e.paths.Arc([u,b],u,90,180)),w-u>0&&(this.paths.Bottom=new e.paths.Line([u,0],[w,0]),this.paths.Top=new e.paths.Line([w,s],[u,s])),b-u>0&&(this.paths.Right=new e.paths.Line([a,u],[a,b]),this.paths.Left=new e.paths.Line([0,b],[0,u]))}return n}();t.RoundRectangle=r,r.metaParameters=[{title:"width",type:"range",min:1,max:100,value:50},{title:"height",type:"range",min:1,max:100,value:100},{title:"radius",type:"range",min:0,max:50,value:11}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o){this.paths={},this.paths=new t.RoundRectangle(i,o,Math.min(o/2,i/2)).paths}return n}();t.Oval=r,r.metaParameters=[{title:"width",type:"range",min:1,max:100,value:50},{title:"height",type:"range",min:1,max:100,value:100}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a,s,u,f){u===void 0&&(u=!1),f===void 0&&(f=!1);var d=this;this.paths={};var w;if(f&&(w={models:{}},this.models={Caps:w}),!(s<=0||a<=0)&&(i=e.angle.noRevolutions(i),o=e.angle.noRevolutions(o),e.round(i-o)!=0)){o<i&&(o+=360);var b=function(p,y,E,P){var A;return f?(A={paths:{}},w.models[p]=A):A=d,A.paths[p]=new e.paths.Arc(e.point.fromPolar(e.angle.toRadians(y),a),s,y+E,y+P)},S=function(p,y){return d.paths[p]=new e.paths.Arc([0,0],a+y,i,o)};S("Outer",s);var x=a-s>0;x&&S("Inner",-s);var m=[];m.push(b("StartCap",i,180,0)),m.push(b("EndCap",o,0,180));var h=e.measure.pointDistance(m[0].origin,m[1].origin);if(h/2<s){var v=e.path.intersection(m[0],m[1]);v&&((!x||!u)&&(m[0].startAngle=v.path1Angles[0],m[1].endAngle=v.path2Angles[0]),!u&&x&&v.intersectionPoints.length==2&&(b("StartCap2",i,180,0).endAngle=v.path1Angles[1],b("EndCap2",o,0,180).startAngle=v.path2Angles[1]+360))}}}return n}();t.OvalArc=r,r.metaParameters=[{title:"start angle",type:"range",min:-360,max:360,step:1,value:180},{title:"end angle",type:"range",min:-360,max:360,step:1,value:0},{title:"sweep",type:"range",min:0,max:100,step:1,value:50},{title:"radius",type:"range",min:0,max:100,step:1,value:15},{title:"self intersect",type:"bool",value:!1}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];this.paths={};var a,s;if(i.length===2&&!e.isObject(i[0]))a=i[0],s=i[1];else{var u=0,f;e.isModel(i[0])?(f=e.measure.modelExtents(i[0]),i.length===2&&(u=i[1])):f=i[0],this.origin=e.point.subtract(f.low,[u,u]),a=f.high[0]-f.low[0]+2*u,s=f.high[1]-f.low[1]+2*u}this.paths=new t.ConnectTheDots(!0,[[0,0],[a,0],[a,s],[0,s]]).paths}return n}();t.Rectangle=r,r.metaParameters=[{title:"width",type:"range",min:1,max:100,value:50},{title:"height",type:"range",min:1,max:100,value:100}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o){this.paths={};var a={Ring_outer:i,Ring_inner:o};for(var s in a){var u=a[s];u===void 0||u<=0||(this.paths[s]=new e.paths.Circle(e.point.zero(),u))}}return n}();t.Ring=r,r.metaParameters=[{title:"outer radius",type:"range",min:0,max:100,step:1,value:50},{title:"inner radius",type:"range",min:0,max:100,step:1,value:20}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a){this.paths={};var s=new e.paths.Arc([0,0],i,0,360),u=new e.paths.Arc([o,0],a,0,360),f=e.solvers.circleTangentAngles(s,u);f?(f=f.sort(function(d,w){return d-w}),s.startAngle=f[0],s.endAngle=f[1],u.startAngle=f[1],u.endAngle=f[0],this.paths.Left=s,this.paths.Right=u,this.paths.Top=new e.paths.Line(e.point.fromAngleOnCircle(f[0],s),e.point.fromAngleOnCircle(f[0],u)),this.paths.Bottom=new e.paths.Line(e.point.fromAngleOnCircle(f[1],s),e.point.fromAngleOnCircle(f[1],u))):this.paths.Belt=new e.paths.Circle(Math.max(i,a))}return n}();t.Belt=r,r.metaParameters=[{title:"left radius",type:"range",min:0,max:100,value:30},{title:"distance between centers",type:"range",min:0,max:100,value:50},{title:"right radius",type:"range",min:0,max:100,value:15}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o){this.paths={};function a(x,m){return x+(m*m-x*x)/(2*x)}var s=o/2,u=i/2,f,d,w,b;i>o?(f=a(s,u),d=270,w=360-e.angle.toDegrees(Math.acos(u/f)),b=[0,f]):(f=a(u,s),d=180-e.angle.toDegrees(Math.asin(s/f)),w=180,b=[f,0]);var S=new e.paths.Arc(b,f,d,w);this.paths.curve_start=S,this.paths.curve_end=e.path.moveRelative(e.path.mirror(S,!0,!0),[i,o])}return n}();t.SCurve=r,r.metaParameters=[{title:"width",type:"range",min:1,max:100,value:50},{title:"height",type:"range",min:1,max:100,value:100}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a,s){s===void 0&&(s=!1);var u=this;this.paths={};var f;s&&(f={models:{}},this.models={Caps:f});var d=function(S,x){var m;s?(m={paths:{}},f.models[S]=m):m=u,m.paths[S]=x},w=e.angle.ofPointInDegrees(i,o),b=e.measure.pointDistance(i,o);this.paths.Top=new e.paths.Line([0,a],[b,a]),this.paths.Bottom=new e.paths.Line([0,-a],[b,-a]),d("StartCap",new e.paths.Arc([0,0],a,90,270)),d("EndCap",new e.paths.Arc([b,0],a,270,90)),e.model.rotate(this,w,[0,0]),this.origin=i}return n}();t.Slot=r,r.metaParameters=[{title:"origin",type:"select",value:[[0,0],[10,0],[10,10]]},{title:"end",type:"select",value:[[80,0],[0,30],[10,30]]},{title:"radius",type:"range",min:1,max:50,value:10}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i){this.paths={},this.paths=new t.Rectangle(i,i).paths}return n}();t.Square=r,r.metaParameters=[{title:"side",type:"range",min:1,max:100,value:100}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a,s){s===void 0&&(s=2),this.paths={},a||(a=o*n.InnerRadiusRatio(i,s));for(var u=t.Polygon.getPoints(i,o),f=t.Polygon.getPoints(i,a,180/i),d=[],w=0;w<i;w++)d.push(u[w]),d.push(f[w]);var b=new t.ConnectTheDots(!0,d);this.paths=b.paths,delete b.paths}return n.InnerRadiusRatio=function(i,o){return i>0&&o>1&&o<i/2?Math.cos(Math.PI*o/i)/Math.cos(Math.PI*(o-1)/i):0},n}();t.Star=r,r.metaParameters=[{title:"number of sides",type:"range",min:3,max:24,value:8},{title:"outer radius",type:"range",min:1,max:100,value:50},{title:"inner radius",type:"range",min:0,max:100,value:15},{title:"skip points (when inner radius is zero)",type:"range",min:0,max:12,value:2}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={}));var MakerJs;(function(e){(function(t){var r=function(){function n(i,o,a,s,u,f,d){s===void 0&&(s=!1),u===void 0&&(u=!1);var w=this;this.models={};var b=0,S,x,m=function(h,v,p,y,E){var P=n.glyphToModel(h,y,f);if(P.origin=[v,0],u&&(P.paths||P.models)){var A=e.measure.modelExtents(P);if(A){var L=A.high[0]-A.low[0];e.model.originate(P,[A.low[0]+L/2,0])}}if(s&&b>0){var B={},F;S?F={models:{deleted:S,char:x}}:F=x,e.model.combine(F,P,!1,!0,!1,!0,B),S=B.out_deleted[1]}w.models[b]=P,b++,x=P};i.forEachGlyph(o,0,0,a,d,m)}return n.glyphToModel=function(i,o,a){var s={},u,f,d=0;function w(x){s.paths||(s.paths={}),s.paths["p_"+ ++d]=x}function b(x){s.models||(s.models={}),s.models["p_"+ ++d]=x}var S=i.getPath(0,0,o);return S.commands.map(function(x,m){var h=[[x.x,x.y],[x.x1,x.y1],[x.x2,x.y2]].map(function(v){if(v[0]!==void 0)return e.point.mirror(v,!1,!0)});switch(x.type){case"M":u=h[0];break;case"Z":h[0]=u;case"L":e.measure.isPointEqual(f,h[0])||w(new e.paths.Line(f,h[0]));break;case"C":b(new t.BezierCurve(f,h[1],h[2],h[0],a));break;case"Q":b(new t.BezierCurve(f,h[1],h[0],a));break}f=h[0]}),s},n}();t.Text=r,r.metaParameters=[{title:"font",type:"font",value:"*"},{title:"text",type:"text",value:"Hello"},{title:"font size",type:"range",min:10,max:200,value:72},{title:"combine",type:"bool",value:!1},{title:"center character origin",type:"bool",value:!1}]})(e.models||(e.models={}))})(MakerJs||(MakerJs={})),MakerJs.version="0.18.1";var Bezier=requireBezierJs();function createOrthographicProjections(e){const t=exportableModel(e);if(e&&e.technicalDrawingModels){const n=[],i=[];return Object.entries(e.technicalDrawingModels).forEach(([o,a])=>{try{const s=exportableModel(a),u=s.boundingBox.center;console.log(`Model ${o} original center:`,u);const f=s.translate([-u[0],-u[1],-u[2]]);console.log(`Model ${o} new center:`,f.boundingBox.center),i.push(f);const d=e.componentData.find(E=>E.id===o||E.name.toLowerCase().includes(o.toLowerCase())),w=drawProjection(f,"front"),b=drawProjection(f,"top"),S=drawProjection(f,"right");console.log(`${o} front view bounds:`,w.visible.toSVGViewBox()),console.log(`${o} top view bounds:`,b.visible.toSVGViewBox()),console.log(`${o} right view bounds:`,S.visible.toSVGViewBox());const x=parseViewBox(w.visible.toSVGViewBox()),m=parseViewBox(b.visible.toSVGViewBox()),h=parseViewBox(S.visible.toSVGViewBox()),v=Math.max(x.width,m.width,h.width),p=Math.max(x.height,m.height,h.height);w.normalizedViewBox=createNormalizedViewBox(x,v,p),b.normalizedViewBox=createNormalizedViewBox(m,v,p),S.normalizedViewBox=createNormalizedViewBox(h,v,p);const y={front:w,top:b,right:S};n.push({name:d?d.name:o,views:y})}catch(s){console.error(`Error processing model ${o}:`,s)}}),console.log("All projections completed with",i.length,"centered models"),{parts:n}}const r=[];try{const n=exportableModel(t),i=n.boundingBox.center;console.log("Main model original center:",i);const o=n.translate([-i[0],-i[1],-i[2]]);console.log("Main model new center:",o.boundingBox.center),r.push(o);const a=drawProjection(o,"front"),s=drawProjection(o,"top"),u=drawProjection(o,"right");console.log("Standard front view bounds:",a.visible.toSVGViewBox()),console.log("Standard top view bounds:",s.visible.toSVGViewBox()),console.log("Standard right view bounds:",u.visible.toSVGViewBox());const f=parseViewBox(a.visible.toSVGViewBox()),d=parseViewBox(s.visible.toSVGViewBox()),w=parseViewBox(u.visible.toSVGViewBox()),b=Math.max(f.width,d.width,w.width),S=Math.max(f.height,d.height,w.height);a.normalizedViewBox=createNormalizedViewBox(f,b,S),s.normalizedViewBox=createNormalizedViewBox(d,b,S),u.normalizedViewBox=createNormalizedViewBox(w,b,S);let x=[];if(e&&e.main&&Array.isArray(e.helperSpaces)){const m=e.main,h=m.boundingBox.center;console.log("Component main original center:",h);const v=m.translate([-h[0],-h[1],-h[2]]);console.log("Component main new center:",v.boundingBox.center),r.push(v);const p=drawProjection(v,"front"),y=drawProjection(v,"top"),E=drawProjection(v,"right"),P=parseViewBox(p.visible.toSVGViewBox()),A=parseViewBox(y.visible.toSVGViewBox()),L=parseViewBox(E.visible.toSVGViewBox()),B=Math.max(P.width,A.width,L.width),F=Math.max(P.height,A.height,L.height);p.normalizedViewBox=createNormalizedViewBox(P,B,F),y.normalizedViewBox=createNormalizedViewBox(A,B,F),E.normalizedViewBox=createNormalizedViewBox(L,B,F),x=[{name:"Main Component",views:{front:p,top:y,right:E}}],e.helperSpaces.forEach((T,I)=>{const _=T.boundingBox.center;console.log(`Helper space ${I} original center:`,_);const D=T.translate([-_[0],-_[1],-_[2]]);console.log(`Helper space ${I} new center:`,D.boundingBox.center),r.push(D);const z=drawProjection(D,"front"),M=drawProjection(D,"top"),q=drawProjection(D,"right"),J=parseViewBox(z.visible.toSVGViewBox()),ee=parseViewBox(M.visible.toSVGViewBox()),le=parseViewBox(q.visible.toSVGViewBox()),oe=Math.max(J.width,ee.width,le.width),V=Math.max(J.height,ee.height,le.height);z.normalizedViewBox=createNormalizedViewBox(J,oe,V),M.normalizedViewBox=createNormalizedViewBox(ee,oe,V),q.normalizedViewBox=createNormalizedViewBox(le,oe,V);const H={front:z,top:M,right:q};x.push({name:`Helper Space ${I+1}`,views:H})})}return console.log("All standard projections completed with",r.length,"centered models"),{standard:{frontView:a,topView:s,rightView:u},parts:x}}catch(n){return console.error("Error in standard projections:",n),{standard:{},parts:[]}}}function createNormalizedViewBox(e,t,r){const n=e.x+e.width/2,i=e.y+e.height/2,o=t,a=r,s=n-o/2,u=i-a/2;return`${s} ${u} ${o} ${a}`}function processProjectionsForRendering(e){const t={};if(e.standard)for(const[n,i]of Object.entries(e.standard))try{const o=i.visible.toSVGPaths(),a=i.hidden.toSVGPaths(),s=i.normalizedViewBox||i.visible.toSVGViewBox(5),u=i.normalizedViewBox||i.hidden.toSVGViewBox(5),f=i.normalizedViewBox||combineViewBoxes(s,u);console.log(`Processed ${n} viewBox:`,f);const d=normalizePaths(o,"visible"),w=normalizePaths(a,"hidden"),b=createMakerJSModel(o,a);t[n]={visible:{paths:d,viewBox:s},hidden:{paths:w,viewBox:u},combinedViewBox:f,makerModel:b}}catch(o){console.error(`Error processing view ${n}:`,o)}const r=[];for(const n of e.parts||[])try{const i={};for(const[o,a]of Object.entries(n.views)){const s=a.visible.toSVGPaths(),u=a.hidden.toSVGPaths(),f=`${n.name.replace(/\s+/g,"_")}_${o}`,d=normalizePaths(s,`${f}_visible`),w=normalizePaths(u,`${f}_hidden`),b=createMakerJSModel(s,u),S=a.normalizedViewBox||a.visible.toSVGViewBox(5),x=a.normalizedViewBox||a.hidden.toSVGViewBox(5),m=a.normalizedViewBox||combineViewBoxes(S,x);console.log(`Processed ${n.name} ${o} viewBox:`,m),i[o]={visible:{paths:d,viewBox:S},hidden:{paths:w,viewBox:x},combinedViewBox:m,makerModel:b}}r.push({name:n.name,views:i})}catch(i){console.error(`Error processing part ${n.name}:`,i)}return{standard:Object.keys(t).length>0?t:void 0,parts:r}}function normalizePath(e,t,r=0){let n;typeof e=="string"?n=e:Array.isArray(e)?e.every(o=>typeof o=="string")?n=e.join(" "):e.length>0?n=String(e[0]):n="":e&&typeof e=="object"&&e.d?n=e.d:n=String(e);const i=parsePathGeometry(n);return{id:`${t}_${r}`,data:n,type:i.type,geometry:i}}function parsePathGeometry(e){if(!e||typeof e!="string")return{type:"unknown",original:e};const t=e.match(/M\s+(-?[\d.]+)\s+(-?[\d.]+)\s+L\s+(-?[\d.]+)\s+(-?[\d.]+)/);if(t){const[,n,i,o,a]=t.map(parseFloat);return{type:"line",endpoints:[[n,i],[o,a]],length:Math.sqrt((o-n)*(o-n)+(a-i)*(a-i))}}const r=e.match(/M\s+(-?[\d.]+)\s+(-?[\d.]+)\s+A\s+(-?[\d.]+)\s+(-?[\d.]+)/);if(r){const[,n,i,o,a]=r.map(parseFloat);return{type:"circle",center:[n,i],radius:(Math.abs(o)+Math.abs(a))/2}}return{type:"unknown"}}function normalizePaths(e,t="path"){return Array.isArray(e)?e.map((r,n)=>normalizePath(r,t,n)):[]}function createMakerJSModel(e,t){const r={models:{},paths:{}};return Array.isArray(e)&&e.forEach((n,i)=>{convertPathToMakerJS(n,r,`visible_${i}`)}),Array.isArray(t)&&t.forEach((n,i)=>{convertPathToMakerJS(n,r,`hidden_${i}`)}),r}function convertPathToMakerJS(e,t,r){let n;typeof e=="string"?n=e:Array.isArray(e)?n=e.length>0?String(e[0]):"":e&&typeof e=="object"&&e.d?n=e.d:n=String(e);try{if(n.startsWith("M")&&n.includes("L")&&!n.includes("A")){const i=n.match(/M\s+(-?[\d.]+)\s+(-?[\d.]+)\s+L\s+(-?[\d.]+)\s+(-?[\d.]+)/);if(i){const[,o,a,s,u]=i.map(parseFloat);t.paths[r]=new dist.paths.Line([o,a],[s,u]);return}}else if(n.includes("A")){const i=n.match(/M\s+(-?[\d.]+)\s+(-?[\d.]+)\s+A\s+(-?[\d.]+)\s+(-?[\d.]+)/);if(i){const[,o,a,s,u]=i.map(parseFloat);if(Math.abs(s-u)<.001){t.paths[r]=new dist.paths.Circle([o,a],s);return}}}}catch(i){console.error("Error converting path to MakerJS:",i)}t.paths[r]={type:"svgPath",d:n}}function combineViewBoxes(e,t){const r="0 0 100 100",n=parseViewBox(e)||parseViewBox(r),i=parseViewBox(t)||parseViewBox(r);if(!n&&!i)return r;if(!n)return t||r;if(!i)return e||r;const o=Math.min(n.x,i.x),a=Math.min(n.y,i.y),s=Math.max(n.x+n.width,i.x+i.width),u=Math.max(n.y+n.height,i.y+i.height);return`${o} ${a} ${s-o} ${u-a}`}function parseViewBox(e){if(!e||typeof e!="string")return null;const t=e.split(" ").map(parseFloat);return t.length!==4||t.some(isNaN)?null:{x:t[0],y:t[1],width:t[2],height:t[3]}}let loaded=!1;const init=async()=>{if(loaded)return Promise.resolve(!0);const e=await Module({locateFile:()=>opencascadeWasm});return loaded=!0,setOC(e),!0},started=init();function createProjections(e,t){return console.log(`[LOG] createProjections called for model: ${e}`),console.time(`[PERF] Total ${e} projections creation`),started.then(()=>{const r=createModelWithValidation(e,t);if(r&&r.error)return{error:!0,validationErrors:r.validationErrors};console.time(`[PERF] ${e} projections generation`);const n=createOrthographicProjections(r);console.timeEnd(`[PERF] ${e} projections generation`),console.time(`[PERF] ${e} projections processing`);const i=processProjectionsForRendering(n);if(console.timeEnd(`[PERF] ${e} projections processing`),console.timeEnd(`[PERF] Total ${e} projections creation`),r&&r.componentData){const o=r.componentData.map(a=>({id:a.id,name:a.name,quantity:a.quantity,dimensions:a.dimensions,material:a.material}));i.componentData=o}return i})}function createMesh(e,t){return console.time(`[PERF] Total ${e} creation`),started.then(()=>{console.time(`[PERF] ${e} model function`);const r=createModelWithValidation(e,t);if(console.timeEnd(`[PERF] ${e} model function`),r&&r.error)return{error:!0,validationErrors:r.validationErrors};if(r&&r.main&&Array.isArray(r.helperSpaces)){const a=r.main,s=r.helperSpaces,u={tolerance:.1,angularTolerance:15};console.time(`[PERF] ${e} main model generation`);const f=a.mesh(u),d=a.meshEdges(u);console.timeEnd(`[PERF] ${e} main model generation`),console.time(`[PERF] ${e} helper spaces generation`);const w=s.map(b=>({faces:b.mesh(u),edges:b.meshEdges(u)}));return console.timeEnd(`[PERF] ${e} helper spaces generation`),console.timeEnd(`[PERF] Total ${e} creation`),{faces:f,edges:d,helperSpaces:w,componentData:r.componentData}}const n={tolerance:.1,angularTolerance:15};console.time(`[PERF] ${e} faces generation`);const i=r.mesh(n);console.timeEnd(`[PERF] ${e} faces generation`),i&&i.triangles&&console.log(`[INFO] ${e} triangles: ${i.triangles.length/3}, vertices: ${i.vertices.length/3}`),console.time(`[PERF] ${e} edges generation`);const o=r.meshEdges(n);return console.timeEnd(`[PERF] ${e} edges generation`),console.timeEnd(`[PERF] Total ${e} creation`),{faces:i,edges:o,componentData:r.componentData}})}expose({createMesh,createProjections})})();
