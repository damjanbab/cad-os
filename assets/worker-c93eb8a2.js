(function(){"use strict";var Zu=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(s,a){n=s,o=a});var i=Object.assign({},r),u="./this.program",l=(s,a)=>{throw a},f=typeof window=="object",p=typeof importScripts=="function",v=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function m(s){return r.locateFile?r.locateFile(s,y):y+s}var S,T,x;function k(s){if(s instanceof Di)return;$("exiting due to exception: "+s)}var A,F,D;v?(p?y=require("path").dirname(y)+"/":y=__dirname+"/",D=()=>{F||(A=require("fs"),F=require("path"))},S=function(a,c){return D(),a=F.normalize(a),A.readFileSync(a,c?void 0:"utf8")},x=s=>{var a=S(s,!0);return a.buffer||(a=new Uint8Array(a)),a},T=(s,a,c)=>{D(),s=F.normalize(s),A.readFile(s,function(h,d){h?c(h):a(d.buffer)})},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof Di))throw s}),process.on("unhandledRejection",function(s){throw s}),l=(s,a)=>{if(_u())throw process.exitCode=s,a;k(a),process.exit(s)},r.inspect=function(){return"[Emscripten Module object]"}):(f||p)&&(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),t&&(y=t),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",S=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.send(null),a.responseText},p&&(x=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),T=(s,a,c)=>{var h=new XMLHttpRequest;h.open("GET",s,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){a(h.response);return}c()},h.onerror=c,h.send(null)});var X=r.print||console.log.bind(console),$=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(u=r.thisProgram),r.quit&&(l=r.quit);var ie=4,oe;r.wasmBinary&&(oe=r.wasmBinary);var re=r.noExitRuntime||!0;typeof WebAssembly!="object"&&$t("no native wasm support detected");var he,Re=!1;function Be(s,a){s||$t(a)}var we=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function pe(s,a,c){for(var h=a+c,d=a;s[d]&&!(d>=h);)++d;if(d-a>16&&s.buffer&&we)return we.decode(s.subarray(a,d));for(var w="";a<d;){var b=s[a++];if(!(b&128)){w+=String.fromCharCode(b);continue}var _=s[a++]&63;if((b&224)==192){w+=String.fromCharCode((b&31)<<6|_);continue}var E=s[a++]&63;if((b&240)==224?b=(b&15)<<12|_<<6|E:b=(b&7)<<18|_<<12|E<<6|s[a++]&63,b<65536)w+=String.fromCharCode(b);else{var P=b-65536;w+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return w}function J(s,a){return s?pe($e,s,a):""}function be(s,a,c,h){if(!(h>0))return 0;for(var d=c,w=c+h-1,b=0;b<s.length;++b){var _=s.charCodeAt(b);if(_>=55296&&_<=57343){var E=s.charCodeAt(++b);_=65536+((_&1023)<<10)|E&1023}if(_<=127){if(c>=w)break;a[c++]=_}else if(_<=2047){if(c+1>=w)break;a[c++]=192|_>>6,a[c++]=128|_&63}else if(_<=65535){if(c+2>=w)break;a[c++]=224|_>>12,a[c++]=128|_>>6&63,a[c++]=128|_&63}else{if(c+3>=w)break;a[c++]=240|_>>18,a[c++]=128|_>>12&63,a[c++]=128|_>>6&63,a[c++]=128|_&63}}return a[c]=0,c-d}function Te(s,a,c){return be(s,$e,a,c)}function fe(s){for(var a=0,c=0;c<s.length;++c){var h=s.charCodeAt(c);h>=55296&&h<=57343&&(h=65536+((h&1023)<<10)|s.charCodeAt(++c)&1023),h<=127?++a:h<=2047?a+=2:h<=65535?a+=3:a+=4}return a}var me=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Me(s,a){for(var c=s,h=c>>1,d=h+a/2;!(h>=d)&&rn[h];)++h;if(c=h<<1,c-s>32&&me)return me.decode($e.subarray(s,c));for(var w="",b=0;!(b>=a/2);++b){var _=Wt[s+b*2>>1];if(_==0)break;w+=String.fromCharCode(_)}return w}function Ge(s,a,c){if(c===void 0&&(c=2147483647),c<2)return 0;c-=2;for(var h=a,d=c<s.length*2?c/2:s.length,w=0;w<d;++w){var b=s.charCodeAt(w);Wt[a>>1]=b,a+=2}return Wt[a>>1]=0,a-h}function _e(s){return s.length*2}function Ue(s,a){for(var c=0,h="";!(c>=a/4);){var d=U[s+c*4>>2];if(d==0)break;if(++c,d>=65536){var w=d-65536;h+=String.fromCharCode(55296|w>>10,56320|w&1023)}else h+=String.fromCharCode(d)}return h}function en(s,a,c){if(c===void 0&&(c=2147483647),c<4)return 0;for(var h=a,d=h+c-4,w=0;w<s.length;++w){var b=s.charCodeAt(w);if(b>=55296&&b<=57343){var _=s.charCodeAt(++w);b=65536+((b&1023)<<10)|_&1023}if(U[a>>2]=b,a+=4,a+4>d)break}return U[a>>2]=0,a-h}function vi(s){for(var a=0,c=0;c<s.length;++c){var h=s.charCodeAt(c);h>=55296&&h<=57343&&++c,a+=4}return a}function Kn(s){var a=fe(s)+1,c=Ot(a);return c&&be(s,He,c,a),c}function tn(s,a){He.set(s,a)}function Qn(s,a,c){for(var h=0;h<s.length;++h)He[a++>>0]=s.charCodeAt(h);c||(He[a>>0]=0)}var kt,He,$e,Wt,rn,U,ne,ut,vu;function gu(s){kt=s,r.HEAP8=He=new Int8Array(s),r.HEAP16=Wt=new Int16Array(s),r.HEAP32=U=new Int32Array(s),r.HEAPU8=$e=new Uint8Array(s),r.HEAPU16=rn=new Uint16Array(s),r.HEAPU32=ne=new Uint32Array(s),r.HEAPF32=ut=new Float32Array(s),r.HEAPF64=vu=new Float64Array(s)}r.INITIAL_MEMORY;var mu,yu=[],wu=[],bu=[];function _u(){return re}function hv(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)vv(r.preRun.shift());mi(yu)}function pv(){!r.noFSInit&&!g.init.initialized&&g.init(),g.ignorePermissions=!1,mi(wu)}function dv(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)mv(r.postRun.shift());mi(bu)}function vv(s){yu.unshift(s)}function gv(s){wu.unshift(s)}function mv(s){bu.unshift(s)}var ir=0,nn=null;function jm(s){return s}function gi(s){ir++,r.monitorRunDependencies&&r.monitorRunDependencies(ir)}function Jn(s){if(ir--,r.monitorRunDependencies&&r.monitorRunDependencies(ir),ir==0&&nn){var a=nn;nn=null,a()}}function $t(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",$(s),Re=!0,s+=". Build with -sASSERTIONS for more info.";var a=new WebAssembly.RuntimeError(s);throw o(a),a}var yv="data:application/octet-stream;base64,";function Su(s){return s.startsWith(yv)}function Tu(s){return s.startsWith("file://")}var qe;qe="replicad_single.wasm",Su(qe)||(qe=m(qe));function Eu(s){try{if(s==qe&&oe)return new Uint8Array(oe);if(x)return x(s);throw"both async and sync fetching of the wasm failed"}catch(a){$t(a)}}function wv(){if(!oe&&(f||p)){if(typeof fetch=="function"&&!Tu(qe))return fetch(qe,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+qe+"'";return s.arrayBuffer()}).catch(function(){return Eu(qe)});if(T)return new Promise(function(s,a){T(qe,function(c){s(new Uint8Array(c))},a)})}return Promise.resolve().then(function(){return Eu(qe)})}function bv(){var s={a:Wm};function a(b,_){var E=b.exports;r.asm=E,he=r.asm.oa,gu(he.buffer),mu=r.asm.va,gv(r.asm.pa),Jn()}gi();function c(b){a(b.instance)}function h(b){return wv().then(function(_){return WebAssembly.instantiate(_,s)}).then(function(_){return _}).then(b,function(_){$("failed to asynchronously prepare wasm: "+_),$t(_)})}function d(){return!oe&&typeof WebAssembly.instantiateStreaming=="function"&&!Su(qe)&&!Tu(qe)&&!v&&typeof fetch=="function"?fetch(qe,{credentials:"same-origin"}).then(function(b){var _=WebAssembly.instantiateStreaming(b,s);return _.then(c,function(E){return $("wasm streaming compile failed: "+E),$("falling back to ArrayBuffer instantiation"),h(c)})}):h(c)}if(r.instantiateWasm)try{var w=r.instantiateWasm(s,a);return w}catch(b){return $("Module.instantiateWasm callback failed with error: "+b),!1}return d().catch(o),{}}var Ne,Ct;function _v(){return r.HEAP8.length}function mi(s){for(;s.length>0;){var a=s.shift();if(typeof a=="function"){a(r);continue}var c=a.func;typeof c=="number"?a.arg===void 0?to(c)():to(c)(a.arg):c(a.arg===void 0?null:a.arg)}}var eo=[];function to(s){var a=eo[s];return a||(s>=eo.length&&(eo.length=s+1),eo[s]=a=mu.get(s)),a}function Sv(s,a,c,h){$t("Assertion failed: "+J(s)+", at: "+[a?J(a):"unknown filename",c,h?J(h):"unknown function"])}function Tv(s){return Ot(s+24)+24}function Ev(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(a){ne[this.ptr+4>>2]=a},this.get_type=function(){return ne[this.ptr+4>>2]},this.set_destructor=function(a){ne[this.ptr+8>>2]=a},this.get_destructor=function(){return ne[this.ptr+8>>2]},this.set_refcount=function(a){U[this.ptr>>2]=a},this.set_caught=function(a){a=a?1:0,He[this.ptr+12>>0]=a},this.get_caught=function(){return He[this.ptr+12>>0]!=0},this.set_rethrown=function(a){a=a?1:0,He[this.ptr+13>>0]=a},this.get_rethrown=function(){return He[this.ptr+13>>0]!=0},this.init=function(a,c){this.set_adjusted_ptr(0),this.set_type(a),this.set_destructor(c),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var a=U[this.ptr>>2];U[this.ptr>>2]=a+1},this.release_ref=function(){var a=U[this.ptr>>2];return U[this.ptr>>2]=a-1,a===1},this.set_adjusted_ptr=function(a){ne[this.ptr+16>>2]=a},this.get_adjusted_ptr=function(){return ne[this.ptr+16>>2]},this.get_exception_ptr=function(){var a=qu(this.get_type());if(a)return ne[this.excPtr>>2];var c=this.get_adjusted_ptr();return c!==0?c:this.excPtr}}function xv(s,a,c){var h=new Ev(s);throw h.init(a,c),s}var se={isAbs:s=>s.charAt(0)==="/",splitPath:s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return a.exec(s).slice(1)},normalizeArray:(s,a)=>{for(var c=0,h=s.length-1;h>=0;h--){var d=s[h];d==="."?s.splice(h,1):d===".."?(s.splice(h,1),c++):c&&(s.splice(h,1),c--)}if(a)for(;c;c--)s.unshift("..");return s},normalize:s=>{var a=se.isAbs(s),c=s.substr(-1)==="/";return s=se.normalizeArray(s.split("/").filter(h=>!!h),!a).join("/"),!s&&!a&&(s="."),s&&c&&(s+="/"),(a?"/":"")+s},dirname:s=>{var a=se.splitPath(s),c=a[0],h=a[1];return!c&&!h?".":(h&&(h=h.substr(0,h.length-1)),c+h)},basename:s=>{if(s==="/")return"/";s=se.normalize(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},join:function(){var s=Array.prototype.slice.call(arguments,0);return se.normalize(s.join("/"))},join2:(s,a)=>se.normalize(s+"/"+a)};function kv(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var s=new Uint8Array(1);return function(){return crypto.getRandomValues(s),s[0]}}else if(v)try{var a=require("crypto");return function(){return a.randomBytes(1)[0]}}catch{}return function(){$t("randomDevice")}}var Pt={resolve:function(){for(var s="",a=!1,c=arguments.length-1;c>=-1&&!a;c--){var h=c>=0?arguments[c]:g.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";s=h+"/"+s,a=se.isAbs(h)}return s=se.normalizeArray(s.split("/").filter(d=>!!d),!a).join("/"),(a?"/":"")+s||"."},relative:(s,a)=>{s=Pt.resolve(s).substr(1),a=Pt.resolve(a).substr(1);function c(P){for(var L=0;L<P.length&&P[L]==="";L++);for(var B=P.length-1;B>=0&&P[B]==="";B--);return L>B?[]:P.slice(L,B-L+1)}for(var h=c(s.split("/")),d=c(a.split("/")),w=Math.min(h.length,d.length),b=w,_=0;_<w;_++)if(h[_]!==d[_]){b=_;break}for(var E=[],_=b;_<h.length;_++)E.push("..");return E=E.concat(d.slice(b)),E.join("/")}},sr={ttys:[],init:function(){},shutdown:function(){},register:function(s,a){sr.ttys[s]={input:[],output:[],ops:a},g.registerDevice(s,sr.stream_ops)},stream_ops:{open:function(s){var a=sr.ttys[s.node.rdev];if(!a)throw new g.ErrnoError(43);s.tty=a,s.seekable=!1},close:function(s){s.tty.ops.flush(s.tty)},flush:function(s){s.tty.ops.flush(s.tty)},read:function(s,a,c,h,d){if(!s.tty||!s.tty.ops.get_char)throw new g.ErrnoError(60);for(var w=0,b=0;b<h;b++){var _;try{_=s.tty.ops.get_char(s.tty)}catch{throw new g.ErrnoError(29)}if(_===void 0&&w===0)throw new g.ErrnoError(6);if(_==null)break;w++,a[c+b]=_}return w&&(s.node.timestamp=Date.now()),w},write:function(s,a,c,h,d){if(!s.tty||!s.tty.ops.put_char)throw new g.ErrnoError(60);try{for(var w=0;w<h;w++)s.tty.ops.put_char(s.tty,a[c+w])}catch{throw new g.ErrnoError(29)}return h&&(s.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(s){if(!s.input.length){var a=null;if(v){var c=256,h=Buffer.alloc(c),d=0;try{d=A.readSync(process.stdin.fd,h,0,c,-1)}catch(w){if(w.toString().includes("EOF"))d=0;else throw w}d>0?a=h.slice(0,d).toString("utf-8"):a=null}else typeof window<"u"&&typeof window.prompt=="function"?(a=window.prompt("Input: "),a!==null&&(a+=`
`)):typeof readline=="function"&&(a=readline(),a!==null&&(a+=`
`));if(!a)return null;s.input=mo(a,!0)}return s.input.shift()},put_char:function(s,a){a===null||a===10?(X(pe(s.output,0)),s.output=[]):a!=0&&s.output.push(a)},flush:function(s){s.output&&s.output.length>0&&(X(pe(s.output,0)),s.output=[])}},default_tty1_ops:{put_char:function(s,a){a===null||a===10?($(pe(s.output,0)),s.output=[]):a!=0&&s.output.push(a)},flush:function(s){s.output&&s.output.length>0&&($(pe(s.output,0)),s.output=[])}}};function Cv(s,a){$e.fill(0,s,s+a)}function Pv(s,a){return Math.ceil(s/a)*a}function xu(s){s=Pv(s,65536);var a=ju(65536,s);return a?(Cv(a,s),a):0}var K={ops_table:null,mount:function(s){return K.createNode(null,"/",16895,0)},createNode:function(s,a,c,h){if(g.isBlkdev(c)||g.isFIFO(c))throw new g.ErrnoError(63);K.ops_table||(K.ops_table={dir:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,lookup:K.node_ops.lookup,mknod:K.node_ops.mknod,rename:K.node_ops.rename,unlink:K.node_ops.unlink,rmdir:K.node_ops.rmdir,readdir:K.node_ops.readdir,symlink:K.node_ops.symlink},stream:{llseek:K.stream_ops.llseek}},file:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:{llseek:K.stream_ops.llseek,read:K.stream_ops.read,write:K.stream_ops.write,allocate:K.stream_ops.allocate,mmap:K.stream_ops.mmap,msync:K.stream_ops.msync}},link:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr,readlink:K.node_ops.readlink},stream:{}},chrdev:{node:{getattr:K.node_ops.getattr,setattr:K.node_ops.setattr},stream:g.chrdev_stream_ops}});var d=g.createNode(s,a,c,h);return g.isDir(d.mode)?(d.node_ops=K.ops_table.dir.node,d.stream_ops=K.ops_table.dir.stream,d.contents={}):g.isFile(d.mode)?(d.node_ops=K.ops_table.file.node,d.stream_ops=K.ops_table.file.stream,d.usedBytes=0,d.contents=null):g.isLink(d.mode)?(d.node_ops=K.ops_table.link.node,d.stream_ops=K.ops_table.link.stream):g.isChrdev(d.mode)&&(d.node_ops=K.ops_table.chrdev.node,d.stream_ops=K.ops_table.chrdev.stream),d.timestamp=Date.now(),s&&(s.contents[a]=d,s.timestamp=d.timestamp),d},getFileDataAsTypedArray:function(s){return s.contents?s.contents.subarray?s.contents.subarray(0,s.usedBytes):new Uint8Array(s.contents):new Uint8Array(0)},expandFileStorage:function(s,a){var c=s.contents?s.contents.length:0;if(!(c>=a)){var h=1024*1024;a=Math.max(a,c*(c<h?2:1.125)>>>0),c!=0&&(a=Math.max(a,256));var d=s.contents;s.contents=new Uint8Array(a),s.usedBytes>0&&s.contents.set(d.subarray(0,s.usedBytes),0)}},resizeFileStorage:function(s,a){if(s.usedBytes!=a)if(a==0)s.contents=null,s.usedBytes=0;else{var c=s.contents;s.contents=new Uint8Array(a),c&&s.contents.set(c.subarray(0,Math.min(a,s.usedBytes))),s.usedBytes=a}},node_ops:{getattr:function(s){var a={};return a.dev=g.isChrdev(s.mode)?s.id:1,a.ino=s.id,a.mode=s.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=s.rdev,g.isDir(s.mode)?a.size=4096:g.isFile(s.mode)?a.size=s.usedBytes:g.isLink(s.mode)?a.size=s.link.length:a.size=0,a.atime=new Date(s.timestamp),a.mtime=new Date(s.timestamp),a.ctime=new Date(s.timestamp),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},setattr:function(s,a){a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&K.resizeFileStorage(s,a.size)},lookup:function(s,a){throw g.genericErrors[44]},mknod:function(s,a,c,h){return K.createNode(s,a,c,h)},rename:function(s,a,c){if(g.isDir(s.mode)){var h;try{h=g.lookupNode(a,c)}catch{}if(h)for(var d in h.contents)throw new g.ErrnoError(55)}delete s.parent.contents[s.name],s.parent.timestamp=Date.now(),s.name=c,a.contents[c]=s,a.timestamp=s.parent.timestamp,s.parent=a},unlink:function(s,a){delete s.contents[a],s.timestamp=Date.now()},rmdir:function(s,a){var c=g.lookupNode(s,a);for(var h in c.contents)throw new g.ErrnoError(55);delete s.contents[a],s.timestamp=Date.now()},readdir:function(s){var a=[".",".."];for(var c in s.contents)s.contents.hasOwnProperty(c)&&a.push(c);return a},symlink:function(s,a,c){var h=K.createNode(s,a,41471,0);return h.link=c,h},readlink:function(s){if(!g.isLink(s.mode))throw new g.ErrnoError(28);return s.link}},stream_ops:{read:function(s,a,c,h,d){var w=s.node.contents;if(d>=s.node.usedBytes)return 0;var b=Math.min(s.node.usedBytes-d,h);if(b>8&&w.subarray)a.set(w.subarray(d,d+b),c);else for(var _=0;_<b;_++)a[c+_]=w[d+_];return b},write:function(s,a,c,h,d,w){if(a.buffer===He.buffer&&(w=!1),!h)return 0;var b=s.node;if(b.timestamp=Date.now(),a.subarray&&(!b.contents||b.contents.subarray)){if(w)return b.contents=a.subarray(c,c+h),b.usedBytes=h,h;if(b.usedBytes===0&&d===0)return b.contents=a.slice(c,c+h),b.usedBytes=h,h;if(d+h<=b.usedBytes)return b.contents.set(a.subarray(c,c+h),d),h}if(K.expandFileStorage(b,d+h),b.contents.subarray&&a.subarray)b.contents.set(a.subarray(c,c+h),d);else for(var _=0;_<h;_++)b.contents[d+_]=a[c+_];return b.usedBytes=Math.max(b.usedBytes,d+h),h},llseek:function(s,a,c){var h=a;if(c===1?h+=s.position:c===2&&g.isFile(s.node.mode)&&(h+=s.node.usedBytes),h<0)throw new g.ErrnoError(28);return h},allocate:function(s,a,c){K.expandFileStorage(s.node,a+c),s.node.usedBytes=Math.max(s.node.usedBytes,a+c)},mmap:function(s,a,c,h,d){if(!g.isFile(s.node.mode))throw new g.ErrnoError(43);var w,b,_=s.node.contents;if(!(d&2)&&_.buffer===kt)b=!1,w=_.byteOffset;else{if((c>0||c+a<_.length)&&(_.subarray?_=_.subarray(c,c+a):_=Array.prototype.slice.call(_,c,c+a)),b=!0,w=xu(a),!w)throw new g.ErrnoError(48);He.set(_,w)}return{ptr:w,allocated:b}},msync:function(s,a,c,h,d){if(!g.isFile(s.node.mode))throw new g.ErrnoError(43);return d&2||K.stream_ops.write(s,a,0,h,c,!1),0}}};function Av(s,a,c,h){var d=h?"":"al "+s;T(s,function(w){Be(w,'Loading data file "'+s+'" failed (no arrayBuffer).'),a(new Uint8Array(w)),d&&Jn()},function(w){if(c)c();else throw'Loading data file "'+s+'" failed.'}),d&&gi()}var g={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(s,a={})=>{if(s=Pt.resolve(g.cwd(),s),!s)return{path:"",node:null};var c={follow_mount:!0,recurse_count:0};if(a=Object.assign(c,a),a.recurse_count>8)throw new g.ErrnoError(32);for(var h=se.normalizeArray(s.split("/").filter(B=>!!B),!1),d=g.root,w="/",b=0;b<h.length;b++){var _=b===h.length-1;if(_&&a.parent)break;if(d=g.lookupNode(d,h[b]),w=se.join2(w,h[b]),g.isMountpoint(d)&&(!_||_&&a.follow_mount)&&(d=d.mounted.root),!_||a.follow)for(var E=0;g.isLink(d.mode);){var P=g.readlink(w);w=Pt.resolve(se.dirname(w),P);var L=g.lookupPath(w,{recurse_count:a.recurse_count+1});if(d=L.node,E++>40)throw new g.ErrnoError(32)}}return{path:w,node:d}},getPath:s=>{for(var a;;){if(g.isRoot(s)){var c=s.mount.mountpoint;return a?c[c.length-1]!=="/"?c+"/"+a:c+a:c}a=a?s.name+"/"+a:s.name,s=s.parent}},hashName:(s,a)=>{for(var c=0,h=0;h<a.length;h++)c=(c<<5)-c+a.charCodeAt(h)|0;return(s+c>>>0)%g.nameTable.length},hashAddNode:s=>{var a=g.hashName(s.parent.id,s.name);s.name_next=g.nameTable[a],g.nameTable[a]=s},hashRemoveNode:s=>{var a=g.hashName(s.parent.id,s.name);if(g.nameTable[a]===s)g.nameTable[a]=s.name_next;else for(var c=g.nameTable[a];c;){if(c.name_next===s){c.name_next=s.name_next;break}c=c.name_next}},lookupNode:(s,a)=>{var c=g.mayLookup(s);if(c)throw new g.ErrnoError(c,s);for(var h=g.hashName(s.id,a),d=g.nameTable[h];d;d=d.name_next){var w=d.name;if(d.parent.id===s.id&&w===a)return d}return g.lookup(s,a)},createNode:(s,a,c,h)=>{var d=new g.FSNode(s,a,c,h);return g.hashAddNode(d),d},destroyNode:s=>{g.hashRemoveNode(s)},isRoot:s=>s===s.parent,isMountpoint:s=>!!s.mounted,isFile:s=>(s&61440)===32768,isDir:s=>(s&61440)===16384,isLink:s=>(s&61440)===40960,isChrdev:s=>(s&61440)===8192,isBlkdev:s=>(s&61440)===24576,isFIFO:s=>(s&61440)===4096,isSocket:s=>(s&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:s=>{var a=g.flagModes[s];if(typeof a>"u")throw new Error("Unknown file open mode: "+s);return a},flagsToPermissionString:s=>{var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a},nodePermissions:(s,a)=>g.ignorePermissions?0:a.includes("r")&&!(s.mode&292)||a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73)?2:0,mayLookup:s=>{var a=g.nodePermissions(s,"x");return a||(s.node_ops.lookup?0:2)},mayCreate:(s,a)=>{try{var c=g.lookupNode(s,a);return 20}catch{}return g.nodePermissions(s,"wx")},mayDelete:(s,a,c)=>{var h;try{h=g.lookupNode(s,a)}catch(w){return w.errno}var d=g.nodePermissions(s,"wx");if(d)return d;if(c){if(!g.isDir(h.mode))return 54;if(g.isRoot(h)||g.getPath(h)===g.cwd())return 10}else if(g.isDir(h.mode))return 31;return 0},mayOpen:(s,a)=>s?g.isLink(s.mode)?32:g.isDir(s.mode)&&(g.flagsToPermissionString(a)!=="r"||a&512)?31:g.nodePermissions(s,g.flagsToPermissionString(a)):44,MAX_OPEN_FDS:4096,nextfd:(s=0,a=g.MAX_OPEN_FDS)=>{for(var c=s;c<=a;c++)if(!g.streams[c])return c;throw new g.ErrnoError(33)},getStream:s=>g.streams[s],createStream:(s,a,c)=>{g.FSStream||(g.FSStream=function(){this.shared={}},g.FSStream.prototype={},Object.defineProperties(g.FSStream.prototype,{object:{get:function(){return this.node},set:function(d){this.node=d}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(d){this.shared.flags=d}},position:{get:function(){return this.shared.position},set:function(d){this.shared.position=d}}})),s=Object.assign(new g.FSStream,s);var h=g.nextfd(a,c);return s.fd=h,g.streams[h]=s,s},closeStream:s=>{g.streams[s]=null},chrdev_stream_ops:{open:s=>{var a=g.getDevice(s.node.rdev);s.stream_ops=a.stream_ops,s.stream_ops.open&&s.stream_ops.open(s)},llseek:()=>{throw new g.ErrnoError(70)}},major:s=>s>>8,minor:s=>s&255,makedev:(s,a)=>s<<8|a,registerDevice:(s,a)=>{g.devices[s]={stream_ops:a}},getDevice:s=>g.devices[s],getMounts:s=>{for(var a=[],c=[s];c.length;){var h=c.pop();a.push(h),c.push.apply(c,h.mounts)}return a},syncfs:(s,a)=>{typeof s=="function"&&(a=s,s=!1),g.syncFSRequests++,g.syncFSRequests>1&&$("warning: "+g.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var c=g.getMounts(g.root.mount),h=0;function d(b){return g.syncFSRequests--,a(b)}function w(b){if(b)return w.errored?void 0:(w.errored=!0,d(b));++h>=c.length&&d(null)}c.forEach(b=>{if(!b.type.syncfs)return w(null);b.type.syncfs(b,s,w)})},mount:(s,a,c)=>{var h=c==="/",d=!c,w;if(h&&g.root)throw new g.ErrnoError(10);if(!h&&!d){var b=g.lookupPath(c,{follow_mount:!1});if(c=b.path,w=b.node,g.isMountpoint(w))throw new g.ErrnoError(10);if(!g.isDir(w.mode))throw new g.ErrnoError(54)}var _={type:s,opts:a,mountpoint:c,mounts:[]},E=s.mount(_);return E.mount=_,_.root=E,h?g.root=E:w&&(w.mounted=_,w.mount&&w.mount.mounts.push(_)),E},unmount:s=>{var a=g.lookupPath(s,{follow_mount:!1});if(!g.isMountpoint(a.node))throw new g.ErrnoError(28);var c=a.node,h=c.mounted,d=g.getMounts(h);Object.keys(g.nameTable).forEach(b=>{for(var _=g.nameTable[b];_;){var E=_.name_next;d.includes(_.mount)&&g.destroyNode(_),_=E}}),c.mounted=null;var w=c.mount.mounts.indexOf(h);c.mount.mounts.splice(w,1)},lookup:(s,a)=>s.node_ops.lookup(s,a),mknod:(s,a,c)=>{var h=g.lookupPath(s,{parent:!0}),d=h.node,w=se.basename(s);if(!w||w==="."||w==="..")throw new g.ErrnoError(28);var b=g.mayCreate(d,w);if(b)throw new g.ErrnoError(b);if(!d.node_ops.mknod)throw new g.ErrnoError(63);return d.node_ops.mknod(d,w,a,c)},create:(s,a)=>(a=a!==void 0?a:438,a&=4095,a|=32768,g.mknod(s,a,0)),mkdir:(s,a)=>(a=a!==void 0?a:511,a&=1023,a|=16384,g.mknod(s,a,0)),mkdirTree:(s,a)=>{for(var c=s.split("/"),h="",d=0;d<c.length;++d)if(c[d]){h+="/"+c[d];try{g.mkdir(h,a)}catch(w){if(w.errno!=20)throw w}}},mkdev:(s,a,c)=>(typeof c>"u"&&(c=a,a=438),a|=8192,g.mknod(s,a,c)),symlink:(s,a)=>{if(!Pt.resolve(s))throw new g.ErrnoError(44);var c=g.lookupPath(a,{parent:!0}),h=c.node;if(!h)throw new g.ErrnoError(44);var d=se.basename(a),w=g.mayCreate(h,d);if(w)throw new g.ErrnoError(w);if(!h.node_ops.symlink)throw new g.ErrnoError(63);return h.node_ops.symlink(h,d,s)},rename:(s,a)=>{var c=se.dirname(s),h=se.dirname(a),d=se.basename(s),w=se.basename(a),b,_,E;if(b=g.lookupPath(s,{parent:!0}),_=b.node,b=g.lookupPath(a,{parent:!0}),E=b.node,!_||!E)throw new g.ErrnoError(44);if(_.mount!==E.mount)throw new g.ErrnoError(75);var P=g.lookupNode(_,d),L=Pt.relative(s,h);if(L.charAt(0)!==".")throw new g.ErrnoError(28);if(L=Pt.relative(a,c),L.charAt(0)!==".")throw new g.ErrnoError(55);var B;try{B=g.lookupNode(E,w)}catch{}if(P!==B){var M=g.isDir(P.mode),G=g.mayDelete(_,d,M);if(G)throw new g.ErrnoError(G);if(G=B?g.mayDelete(E,w,M):g.mayCreate(E,w),G)throw new g.ErrnoError(G);if(!_.node_ops.rename)throw new g.ErrnoError(63);if(g.isMountpoint(P)||B&&g.isMountpoint(B))throw new g.ErrnoError(10);if(E!==_&&(G=g.nodePermissions(_,"w"),G))throw new g.ErrnoError(G);g.hashRemoveNode(P);try{_.node_ops.rename(P,E,w)}catch(W){throw W}finally{g.hashAddNode(P)}}},rmdir:s=>{var a=g.lookupPath(s,{parent:!0}),c=a.node,h=se.basename(s),d=g.lookupNode(c,h),w=g.mayDelete(c,h,!0);if(w)throw new g.ErrnoError(w);if(!c.node_ops.rmdir)throw new g.ErrnoError(63);if(g.isMountpoint(d))throw new g.ErrnoError(10);c.node_ops.rmdir(c,h),g.destroyNode(d)},readdir:s=>{var a=g.lookupPath(s,{follow:!0}),c=a.node;if(!c.node_ops.readdir)throw new g.ErrnoError(54);return c.node_ops.readdir(c)},unlink:s=>{var a=g.lookupPath(s,{parent:!0}),c=a.node;if(!c)throw new g.ErrnoError(44);var h=se.basename(s),d=g.lookupNode(c,h),w=g.mayDelete(c,h,!1);if(w)throw new g.ErrnoError(w);if(!c.node_ops.unlink)throw new g.ErrnoError(63);if(g.isMountpoint(d))throw new g.ErrnoError(10);c.node_ops.unlink(c,h),g.destroyNode(d)},readlink:s=>{var a=g.lookupPath(s),c=a.node;if(!c)throw new g.ErrnoError(44);if(!c.node_ops.readlink)throw new g.ErrnoError(28);return Pt.resolve(g.getPath(c.parent),c.node_ops.readlink(c))},stat:(s,a)=>{var c=g.lookupPath(s,{follow:!a}),h=c.node;if(!h)throw new g.ErrnoError(44);if(!h.node_ops.getattr)throw new g.ErrnoError(63);return h.node_ops.getattr(h)},lstat:s=>g.stat(s,!0),chmod:(s,a,c)=>{var h;if(typeof s=="string"){var d=g.lookupPath(s,{follow:!c});h=d.node}else h=s;if(!h.node_ops.setattr)throw new g.ErrnoError(63);h.node_ops.setattr(h,{mode:a&4095|h.mode&-4096,timestamp:Date.now()})},lchmod:(s,a)=>{g.chmod(s,a,!0)},fchmod:(s,a)=>{var c=g.getStream(s);if(!c)throw new g.ErrnoError(8);g.chmod(c.node,a)},chown:(s,a,c,h)=>{var d;if(typeof s=="string"){var w=g.lookupPath(s,{follow:!h});d=w.node}else d=s;if(!d.node_ops.setattr)throw new g.ErrnoError(63);d.node_ops.setattr(d,{timestamp:Date.now()})},lchown:(s,a,c)=>{g.chown(s,a,c,!0)},fchown:(s,a,c)=>{var h=g.getStream(s);if(!h)throw new g.ErrnoError(8);g.chown(h.node,a,c)},truncate:(s,a)=>{if(a<0)throw new g.ErrnoError(28);var c;if(typeof s=="string"){var h=g.lookupPath(s,{follow:!0});c=h.node}else c=s;if(!c.node_ops.setattr)throw new g.ErrnoError(63);if(g.isDir(c.mode))throw new g.ErrnoError(31);if(!g.isFile(c.mode))throw new g.ErrnoError(28);var d=g.nodePermissions(c,"w");if(d)throw new g.ErrnoError(d);c.node_ops.setattr(c,{size:a,timestamp:Date.now()})},ftruncate:(s,a)=>{var c=g.getStream(s);if(!c)throw new g.ErrnoError(8);if(!(c.flags&2097155))throw new g.ErrnoError(28);g.truncate(c.node,a)},utime:(s,a,c)=>{var h=g.lookupPath(s,{follow:!0}),d=h.node;d.node_ops.setattr(d,{timestamp:Math.max(a,c)})},open:(s,a,c)=>{if(s==="")throw new g.ErrnoError(44);a=typeof a=="string"?g.modeStringToFlags(a):a,c=typeof c>"u"?438:c,a&64?c=c&4095|32768:c=0;var h;if(typeof s=="object")h=s;else{s=se.normalize(s);try{var d=g.lookupPath(s,{follow:!(a&131072)});h=d.node}catch{}}var w=!1;if(a&64)if(h){if(a&128)throw new g.ErrnoError(20)}else h=g.mknod(s,c,0),w=!0;if(!h)throw new g.ErrnoError(44);if(g.isChrdev(h.mode)&&(a&=-513),a&65536&&!g.isDir(h.mode))throw new g.ErrnoError(54);if(!w){var b=g.mayOpen(h,a);if(b)throw new g.ErrnoError(b)}a&512&&!w&&g.truncate(h,0),a&=-131713;var _=g.createStream({node:h,path:g.getPath(h),flags:a,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return _.stream_ops.open&&_.stream_ops.open(_),r.logReadFiles&&!(a&1)&&(g.readFiles||(g.readFiles={}),s in g.readFiles||(g.readFiles[s]=1)),_},close:s=>{if(g.isClosed(s))throw new g.ErrnoError(8);s.getdents&&(s.getdents=null);try{s.stream_ops.close&&s.stream_ops.close(s)}catch(a){throw a}finally{g.closeStream(s.fd)}s.fd=null},isClosed:s=>s.fd===null,llseek:(s,a,c)=>{if(g.isClosed(s))throw new g.ErrnoError(8);if(!s.seekable||!s.stream_ops.llseek)throw new g.ErrnoError(70);if(c!=0&&c!=1&&c!=2)throw new g.ErrnoError(28);return s.position=s.stream_ops.llseek(s,a,c),s.ungotten=[],s.position},read:(s,a,c,h,d)=>{if(h<0||d<0)throw new g.ErrnoError(28);if(g.isClosed(s))throw new g.ErrnoError(8);if((s.flags&2097155)===1)throw new g.ErrnoError(8);if(g.isDir(s.node.mode))throw new g.ErrnoError(31);if(!s.stream_ops.read)throw new g.ErrnoError(28);var w=typeof d<"u";if(!w)d=s.position;else if(!s.seekable)throw new g.ErrnoError(70);var b=s.stream_ops.read(s,a,c,h,d);return w||(s.position+=b),b},write:(s,a,c,h,d,w)=>{if(h<0||d<0)throw new g.ErrnoError(28);if(g.isClosed(s))throw new g.ErrnoError(8);if(!(s.flags&2097155))throw new g.ErrnoError(8);if(g.isDir(s.node.mode))throw new g.ErrnoError(31);if(!s.stream_ops.write)throw new g.ErrnoError(28);s.seekable&&s.flags&1024&&g.llseek(s,0,2);var b=typeof d<"u";if(!b)d=s.position;else if(!s.seekable)throw new g.ErrnoError(70);var _=s.stream_ops.write(s,a,c,h,d,w);return b||(s.position+=_),_},allocate:(s,a,c)=>{if(g.isClosed(s))throw new g.ErrnoError(8);if(a<0||c<=0)throw new g.ErrnoError(28);if(!(s.flags&2097155))throw new g.ErrnoError(8);if(!g.isFile(s.node.mode)&&!g.isDir(s.node.mode))throw new g.ErrnoError(43);if(!s.stream_ops.allocate)throw new g.ErrnoError(138);s.stream_ops.allocate(s,a,c)},mmap:(s,a,c,h,d)=>{if(h&2&&!(d&2)&&(s.flags&2097155)!==2)throw new g.ErrnoError(2);if((s.flags&2097155)===1)throw new g.ErrnoError(2);if(!s.stream_ops.mmap)throw new g.ErrnoError(43);return s.stream_ops.mmap(s,a,c,h,d)},msync:(s,a,c,h,d)=>!s||!s.stream_ops.msync?0:s.stream_ops.msync(s,a,c,h,d),munmap:s=>0,ioctl:(s,a,c)=>{if(!s.stream_ops.ioctl)throw new g.ErrnoError(59);return s.stream_ops.ioctl(s,a,c)},readFile:(s,a={})=>{if(a.flags=a.flags||0,a.encoding=a.encoding||"binary",a.encoding!=="utf8"&&a.encoding!=="binary")throw new Error('Invalid encoding type "'+a.encoding+'"');var c,h=g.open(s,a.flags),d=g.stat(s),w=d.size,b=new Uint8Array(w);return g.read(h,b,0,w,0),a.encoding==="utf8"?c=pe(b,0):a.encoding==="binary"&&(c=b),g.close(h),c},writeFile:(s,a,c={})=>{c.flags=c.flags||577;var h=g.open(s,c.flags,c.mode);if(typeof a=="string"){var d=new Uint8Array(fe(a)+1),w=be(a,d,0,d.length);g.write(h,d,0,w,void 0,c.canOwn)}else if(ArrayBuffer.isView(a))g.write(h,a,0,a.byteLength,void 0,c.canOwn);else throw new Error("Unsupported data type");g.close(h)},cwd:()=>g.currentPath,chdir:s=>{var a=g.lookupPath(s,{follow:!0});if(a.node===null)throw new g.ErrnoError(44);if(!g.isDir(a.node.mode))throw new g.ErrnoError(54);var c=g.nodePermissions(a.node,"x");if(c)throw new g.ErrnoError(c);g.currentPath=a.path},createDefaultDirectories:()=>{g.mkdir("/tmp"),g.mkdir("/home"),g.mkdir("/home/web_user")},createDefaultDevices:()=>{g.mkdir("/dev"),g.registerDevice(g.makedev(1,3),{read:()=>0,write:(a,c,h,d,w)=>d}),g.mkdev("/dev/null",g.makedev(1,3)),sr.register(g.makedev(5,0),sr.default_tty_ops),sr.register(g.makedev(6,0),sr.default_tty1_ops),g.mkdev("/dev/tty",g.makedev(5,0)),g.mkdev("/dev/tty1",g.makedev(6,0));var s=kv();g.createDevice("/dev","random",s),g.createDevice("/dev","urandom",s),g.mkdir("/dev/shm"),g.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{g.mkdir("/proc");var s=g.mkdir("/proc/self");g.mkdir("/proc/self/fd"),g.mount({mount:()=>{var a=g.createNode(s,"fd",16895,73);return a.node_ops={lookup:(c,h)=>{var d=+h,w=g.getStream(d);if(!w)throw new g.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return b.parent=b,b}},a}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?g.createDevice("/dev","stdin",r.stdin):g.symlink("/dev/tty","/dev/stdin"),r.stdout?g.createDevice("/dev","stdout",null,r.stdout):g.symlink("/dev/tty","/dev/stdout"),r.stderr?g.createDevice("/dev","stderr",null,r.stderr):g.symlink("/dev/tty1","/dev/stderr"),g.open("/dev/stdin",0),g.open("/dev/stdout",1),g.open("/dev/stderr",1)},ensureErrnoError:()=>{g.ErrnoError||(g.ErrnoError=function(a,c){this.node=c,this.setErrno=function(h){this.errno=h},this.setErrno(a),this.message="FS error"},g.ErrnoError.prototype=new Error,g.ErrnoError.prototype.constructor=g.ErrnoError,[44].forEach(s=>{g.genericErrors[s]=new g.ErrnoError(s),g.genericErrors[s].stack="<generic error, no stack>"}))},staticInit:()=>{g.ensureErrnoError(),g.nameTable=new Array(4096),g.mount(K,{},"/"),g.createDefaultDirectories(),g.createDefaultDevices(),g.createSpecialDirectories(),g.filesystems={MEMFS:K}},init:(s,a,c)=>{g.init.initialized=!0,g.ensureErrnoError(),r.stdin=s||r.stdin,r.stdout=a||r.stdout,r.stderr=c||r.stderr,g.createStandardStreams()},quit:()=>{g.init.initialized=!1;for(var s=0;s<g.streams.length;s++){var a=g.streams[s];a&&g.close(a)}},getMode:(s,a)=>{var c=0;return s&&(c|=365),a&&(c|=146),c},findObject:(s,a)=>{var c=g.analyzePath(s,a);return c.exists?c.object:null},analyzePath:(s,a)=>{try{var c=g.lookupPath(s,{follow:!a});s=c.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var c=g.lookupPath(s,{parent:!0});h.parentExists=!0,h.parentPath=c.path,h.parentObject=c.node,h.name=se.basename(s),c=g.lookupPath(s,{follow:!a}),h.exists=!0,h.path=c.path,h.object=c.node,h.name=c.node.name,h.isRoot=c.path==="/"}catch(d){h.error=d.errno}return h},createPath:(s,a,c,h)=>{s=typeof s=="string"?s:g.getPath(s);for(var d=a.split("/").reverse();d.length;){var w=d.pop();if(w){var b=se.join2(s,w);try{g.mkdir(b)}catch{}s=b}}return b},createFile:(s,a,c,h,d)=>{var w=se.join2(typeof s=="string"?s:g.getPath(s),a),b=g.getMode(h,d);return g.create(w,b)},createDataFile:(s,a,c,h,d,w)=>{var b=a;s&&(s=typeof s=="string"?s:g.getPath(s),b=a?se.join2(s,a):s);var _=g.getMode(h,d),E=g.create(b,_);if(c){if(typeof c=="string"){for(var P=new Array(c.length),L=0,B=c.length;L<B;++L)P[L]=c.charCodeAt(L);c=P}g.chmod(E,_|146);var M=g.open(E,577);g.write(M,c,0,c.length,0,w),g.close(M),g.chmod(E,_)}return E},createDevice:(s,a,c,h)=>{var d=se.join2(typeof s=="string"?s:g.getPath(s),a),w=g.getMode(!!c,!!h);g.createDevice.major||(g.createDevice.major=64);var b=g.makedev(g.createDevice.major++,0);return g.registerDevice(b,{open:_=>{_.seekable=!1},close:_=>{h&&h.buffer&&h.buffer.length&&h(10)},read:(_,E,P,L,B)=>{for(var M=0,G=0;G<L;G++){var W;try{W=c()}catch{throw new g.ErrnoError(29)}if(W===void 0&&M===0)throw new g.ErrnoError(6);if(W==null)break;M++,E[P+G]=W}return M&&(_.node.timestamp=Date.now()),M},write:(_,E,P,L,B)=>{for(var M=0;M<L;M++)try{h(E[P+M])}catch{throw new g.ErrnoError(29)}return L&&(_.node.timestamp=Date.now()),M}}),g.mkdev(d,w,b)},forceLoadFile:s=>{if(s.isDevice||s.isFolder||s.link||s.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(S)try{s.contents=mo(S(s.url),!0),s.usedBytes=s.contents.length}catch{throw new g.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(s,a,c,h,d)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(G){if(!(G>this.length-1||G<0)){var W=G%this.chunkSize,le=G/this.chunkSize|0;return this.getter(le)[W]}},w.prototype.setDataGetter=function(G){this.getter=G},w.prototype.cacheLength=function(){var G=new XMLHttpRequest;if(G.open("HEAD",c,!1),G.send(null),!(G.status>=200&&G.status<300||G.status===304))throw new Error("Couldn't load "+c+". Status: "+G.status);var W=Number(G.getResponseHeader("Content-length")),le,ke=(le=G.getResponseHeader("Accept-Ranges"))&&le==="bytes",Pe=(le=G.getResponseHeader("Content-Encoding"))&&le==="gzip",O=1024*1024;ke||(O=W);var z=(de,Ze)=>{if(de>Ze)throw new Error("invalid range ("+de+", "+Ze+") or no bytes requested!");if(Ze>W-1)throw new Error("only "+W+" bytes available! programmer error!");var Ae=new XMLHttpRequest;if(Ae.open("GET",c,!1),W!==O&&Ae.setRequestHeader("Range","bytes="+de+"-"+Ze),Ae.responseType="arraybuffer",Ae.overrideMimeType&&Ae.overrideMimeType("text/plain; charset=x-user-defined"),Ae.send(null),!(Ae.status>=200&&Ae.status<300||Ae.status===304))throw new Error("Couldn't load "+c+". Status: "+Ae.status);return Ae.response!==void 0?new Uint8Array(Ae.response||[]):mo(Ae.responseText||"",!0)},Fe=this;Fe.setDataGetter(de=>{var Ze=de*O,Ae=(de+1)*O-1;if(Ae=Math.min(Ae,W-1),typeof Fe.chunks[de]>"u"&&(Fe.chunks[de]=z(Ze,Ae)),typeof Fe.chunks[de]>"u")throw new Error("doXHR failed!");return Fe.chunks[de]}),(Pe||!W)&&(O=W=1,W=this.getter(0).length,O=W,X("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=W,this._chunkSize=O,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new w;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var _={isDevice:!1,contents:b}}else var _={isDevice:!1,url:c};var E=g.createFile(s,a,_,h,d);_.contents?E.contents=_.contents:_.url&&(E.contents=null,E.url=_.url),Object.defineProperties(E,{usedBytes:{get:function(){return this.contents.length}}});var P={},L=Object.keys(E.stream_ops);L.forEach(M=>{var G=E.stream_ops[M];P[M]=function(){return g.forceLoadFile(E),G.apply(null,arguments)}});function B(M,G,W,le,ke){var Pe=M.node.contents;if(ke>=Pe.length)return 0;var O=Math.min(Pe.length-ke,le);if(Pe.slice)for(var z=0;z<O;z++)G[W+z]=Pe[ke+z];else for(var z=0;z<O;z++)G[W+z]=Pe.get(ke+z);return O}return P.read=(M,G,W,le,ke)=>(g.forceLoadFile(E),B(M,G,W,le,ke)),P.mmap=(M,G,W,le,ke)=>{g.forceLoadFile(E);var Pe=xu(G);if(!Pe)throw new g.ErrnoError(48);return B(M,He,Pe,G,W),{ptr:Pe,allocated:!0}},E.stream_ops=P,E},createPreloadedFile:(s,a,c,h,d,w,b,_,E,P)=>{var L=a?Pt.resolve(se.join2(s,a)):s;function B(M){function G(W){P&&P(),_||g.createDataFile(s,a,W,h,d,E),w&&w(),Jn()}Browser.handledByPreloadPlugin(M,L,G,()=>{b&&b(),Jn()})||G(M)}gi(),typeof c=="string"?Av(c,M=>B(M),b):B(c)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,a,c)=>{a=a||(()=>{}),c=c||(()=>{});var h=g.indexedDB();try{var d=h.open(g.DB_NAME(),g.DB_VERSION)}catch(w){return c(w)}d.onupgradeneeded=()=>{X("creating db");var w=d.result;w.createObjectStore(g.DB_STORE_NAME)},d.onsuccess=()=>{var w=d.result,b=w.transaction([g.DB_STORE_NAME],"readwrite"),_=b.objectStore(g.DB_STORE_NAME),E=0,P=0,L=s.length;function B(){P==0?a():c()}s.forEach(M=>{var G=_.put(g.analyzePath(M).object.contents,M);G.onsuccess=()=>{E++,E+P==L&&B()},G.onerror=()=>{P++,E+P==L&&B()}}),b.onerror=c},d.onerror=c},loadFilesFromDB:(s,a,c)=>{a=a||(()=>{}),c=c||(()=>{});var h=g.indexedDB();try{var d=h.open(g.DB_NAME(),g.DB_VERSION)}catch(w){return c(w)}d.onupgradeneeded=c,d.onsuccess=()=>{var w=d.result;try{var b=w.transaction([g.DB_STORE_NAME],"readonly")}catch(M){c(M);return}var _=b.objectStore(g.DB_STORE_NAME),E=0,P=0,L=s.length;function B(){P==0?a():c()}s.forEach(M=>{var G=_.get(M);G.onsuccess=()=>{g.analyzePath(M).exists&&g.unlink(M),g.createDataFile(se.dirname(M),se.basename(M),G.result,!0,!0,!0),E++,E+P==L&&B()},G.onerror=()=>{P++,E+P==L&&B()}}),b.onerror=c},d.onerror=c}},ae={DEFAULT_POLLMASK:5,calculateAt:function(s,a,c){if(se.isAbs(a))return a;var h;if(s===-100)h=g.cwd();else{var d=g.getStream(s);if(!d)throw new g.ErrnoError(8);h=d.path}if(a.length==0){if(!c)throw new g.ErrnoError(44);return h}return se.join2(h,a)},doStat:function(s,a,c){try{var h=s(a)}catch(d){if(d&&d.node&&se.normalize(a)!==se.normalize(g.getPath(d.node)))return-54;throw d}return U[c>>2]=h.dev,U[c+4>>2]=0,U[c+8>>2]=h.ino,U[c+12>>2]=h.mode,U[c+16>>2]=h.nlink,U[c+20>>2]=h.uid,U[c+24>>2]=h.gid,U[c+28>>2]=h.rdev,U[c+32>>2]=0,Ct=[h.size>>>0,(Ne=h.size,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],U[c+40>>2]=Ct[0],U[c+44>>2]=Ct[1],U[c+48>>2]=4096,U[c+52>>2]=h.blocks,U[c+56>>2]=h.atime.getTime()/1e3|0,U[c+60>>2]=0,U[c+64>>2]=h.mtime.getTime()/1e3|0,U[c+68>>2]=0,U[c+72>>2]=h.ctime.getTime()/1e3|0,U[c+76>>2]=0,Ct=[h.ino>>>0,(Ne=h.ino,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],U[c+80>>2]=Ct[0],U[c+84>>2]=Ct[1],0},doMsync:function(s,a,c,h,d){var w=$e.slice(s,s+c);g.msync(a,w,d,c,h)},varargs:void 0,get:function(){ae.varargs+=4;var s=U[ae.varargs-4>>2];return s},getStr:function(s){var a=J(s);return a},getStreamFromFD:function(s){var a=g.getStream(s);if(!a)throw new g.ErrnoError(8);return a}};function Rv(s,a){try{return s=ae.getStr(s),g.chmod(s,a),0}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function Ov(s,a,c,h){try{if(a=ae.getStr(a),a=ae.calculateAt(s,a),c&-8)return-28;var d=g.lookupPath(a,{follow:!0}),w=d.node;if(!w)return-44;var b="";return c&4&&(b+="r"),c&2&&(b+="w"),c&1&&(b+="x"),b&&g.nodePermissions(w,b)?-2:0}catch(_){if(typeof g>"u"||!(_ instanceof g.ErrnoError))throw _;return-_.errno}}function Mv(s){return U[$u()>>2]=s,s}function Dv(s,a,c){ae.varargs=c;try{var h=ae.getStreamFromFD(s);switch(a){case 0:{var d=ae.get();if(d<0)return-28;var w;return w=g.createStream(h,d),w.fd}case 1:case 2:return 0;case 3:return h.flags;case 4:{var d=ae.get();return h.flags|=d,0}case 5:{var d=ae.get(),b=0;return Wt[d+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Mv(28),-1;default:return-28}}catch(_){if(typeof g>"u"||!(_ instanceof g.ErrnoError))throw _;return-_.errno}}function Fv(s,a){try{var c=ae.getStreamFromFD(s);return ae.doStat(g.stat,c.path,a)}catch(h){if(typeof g>"u"||!(h instanceof g.ErrnoError))throw h;return-h.errno}}function Lv(s,a,c){ae.varargs=c;try{var h=ae.getStreamFromFD(s);switch(a){case 21509:case 21505:return h.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return h.tty?0:-59;case 21519:{if(!h.tty)return-59;var d=ae.get();return U[d>>2]=0,0}case 21520:return h.tty?-28:-59;case 21531:{var d=ae.get();return g.ioctl(h,a,d)}case 21523:return h.tty?0:-59;case 21524:return h.tty?0:-59;default:$t("bad ioctl syscall "+a)}}catch(w){if(typeof g>"u"||!(w instanceof g.ErrnoError))throw w;return-w.errno}}function Bv(s,a){try{return s=ae.getStr(s),ae.doStat(g.lstat,s,a)}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function Uv(s,a,c,h){try{a=ae.getStr(a);var d=h&256,w=h&4096;return h=h&-4353,a=ae.calculateAt(s,a,w),ae.doStat(d?g.lstat:g.stat,a,c)}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return-b.errno}}function Iv(s,a,c,h){ae.varargs=h;try{a=ae.getStr(a),a=ae.calculateAt(s,a);var d=h?ae.get():0;return g.open(a,c,d).fd}catch(w){if(typeof g>"u"||!(w instanceof g.ErrnoError))throw w;return-w.errno}}function Gv(s,a){try{return s=ae.getStr(s),ae.doStat(g.stat,s,a)}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return-c.errno}}function Nv(s,a,c,h,d){}function ro(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function Vv(){for(var s=new Array(256),a=0;a<256;++a)s[a]=String.fromCharCode(a);ku=s}var ku=void 0;function Ye(s){for(var a="",c=s;$e[c];)a+=ku[$e[c++]];return a}var Er={},ar={},no={},Hv=48,zv=57;function oo(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return a>=Hv&&a<=zv?"_"+s:s}function io(s,a){return s=oo(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(a)}function yi(s,a){var c=io(a,function(h){this.name=a,this.message=h;var d=new Error(h).stack;d!==void 0&&(this.stack=this.toString()+`
`+d.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(s.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},c}var xr=void 0;function ue(s){throw new xr(s)}var Cu=void 0;function so(s){throw new Cu(s)}function ur(s,a,c){s.forEach(function(_){no[_]=a});function h(_){var E=c(_);E.length!==s.length&&so("Mismatched type converter count");for(var P=0;P<s.length;++P)vt(s[P],E[P])}var d=new Array(a.length),w=[],b=0;a.forEach((_,E)=>{ar.hasOwnProperty(_)?d[E]=ar[_]:(w.push(_),Er.hasOwnProperty(_)||(Er[_]=[]),Er[_].push(()=>{d[E]=ar[_],++b,b===w.length&&h(d)}))}),w.length===0&&h(d)}function vt(s,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var h=a.name;if(s||ue('type "'+h+'" must have a positive integer typeid pointer'),ar.hasOwnProperty(s)){if(c.ignoreDuplicateRegistrations)return;ue("Cannot register type '"+h+"' twice")}if(ar[s]=a,delete no[s],Er.hasOwnProperty(s)){var d=Er[s];delete Er[s],d.forEach(w=>w())}}function Wv(s,a,c,h,d){var w=ro(c);a=Ye(a),vt(s,{name:a,fromWireType:function(b){return!!b},toWireType:function(b,_){return _?h:d},argPackAdvance:8,readValueFromPointer:function(b){var _;if(c===1)_=He;else if(c===2)_=Wt;else if(c===4)_=U;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(_[b>>w])},destructorFunction:null})}function $v(s){if(!(this instanceof Yt)||!(s instanceof Yt))return!1;for(var a=this.$$.ptrType.registeredClass,c=this.$$.ptr,h=s.$$.ptrType.registeredClass,d=s.$$.ptr;a.baseClass;)c=a.upcast(c),a=a.baseClass;for(;h.baseClass;)d=h.upcast(d),h=h.baseClass;return a===h&&c===d}function Yv(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function wi(s){function a(c){return c.$$.ptrType.registeredClass.name}ue(a(s)+" instance already deleted")}var bi=!1;function Pu(s){}function Xv(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function Au(s){s.count.value-=1;var a=s.count.value===0;a&&Xv(s)}function Ru(s,a,c){if(a===c)return s;if(c.baseClass===void 0)return null;var h=Ru(s,a,c.baseClass);return h===null?null:c.downcast(h)}var Ou={};function jv(){return Object.keys(an).length}function qv(){var s=[];for(var a in an)an.hasOwnProperty(a)&&s.push(an[a]);return s}var on=[];function _i(){for(;on.length;){var s=on.pop();s.$$.deleteScheduled=!1,s.delete()}}var sn=void 0;function Zv(s){sn=s,on.length&&sn&&sn(_i)}function Kv(){r.getInheritedInstanceCount=jv,r.getLiveInheritedInstances=qv,r.flushPendingDeletes=_i,r.setDelayFunction=Zv}var an={};function Qv(s,a){for(a===void 0&&ue("ptr should not be undefined");s.baseClass;)a=s.upcast(a),s=s.baseClass;return a}function Jv(s,a){return a=Qv(s,a),an[a]}function ao(s,a){(!a.ptrType||!a.ptr)&&so("makeClassHandle requires ptr and ptrType");var c=!!a.smartPtrType,h=!!a.smartPtr;return c!==h&&so("Both smartPtrType and smartPtr must be specified"),a.count={value:1},un(Object.create(s,{$$:{value:a}}))}function eg(s){var a=this.getPointee(s);if(!a)return this.destructor(s),null;var c=Jv(this.registeredClass,a);if(c!==void 0){if(c.$$.count.value===0)return c.$$.ptr=a,c.$$.smartPtr=s,c.clone();var h=c.clone();return this.destructor(s),h}function d(){return this.isSmartPointer?ao(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:a,smartPtrType:this,smartPtr:s}):ao(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var w=this.registeredClass.getActualType(a),b=Ou[w];if(!b)return d.call(this);var _;this.isConst?_=b.constPointerType:_=b.pointerType;var E=Ru(a,this.registeredClass,_.registeredClass);return E===null?d.call(this):this.isSmartPointer?ao(_.registeredClass.instancePrototype,{ptrType:_,ptr:E,smartPtrType:this,smartPtr:s}):ao(_.registeredClass.instancePrototype,{ptrType:_,ptr:E})}function un(s){return typeof FinalizationRegistry>"u"?(un=a=>a,s):(bi=new FinalizationRegistry(a=>{Au(a.$$)}),un=a=>{var c=a.$$,h=!!c.smartPtr;if(h){var d={$$:c};bi.register(a,d,a)}return a},Pu=a=>bi.unregister(a),un(s))}function tg(){if(this.$$.ptr||wi(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=un(Object.create(Object.getPrototypeOf(this),{$$:{value:Yv(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function rg(){this.$$.ptr||wi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ue("Object already scheduled for deletion"),Pu(this),Au(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ng(){return!this.$$.ptr}function og(){return this.$$.ptr||wi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ue("Object already scheduled for deletion"),on.push(this),on.length===1&&sn&&sn(_i),this.$$.deleteScheduled=!0,this}function ig(){Yt.prototype.isAliasOf=$v,Yt.prototype.clone=tg,Yt.prototype.delete=rg,Yt.prototype.isDeleted=ng,Yt.prototype.deleteLater=og}function Yt(){}function Si(s,a,c){if(s[a].overloadTable===void 0){var h=s[a];s[a]=function(){return s[a].overloadTable.hasOwnProperty(arguments.length)||ue("Function '"+c+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[a].overloadTable+")!"),s[a].overloadTable[arguments.length].apply(this,arguments)},s[a].overloadTable=[],s[a].overloadTable[h.argCount]=h}}function Mu(s,a,c){r.hasOwnProperty(s)?((c===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[c]!==void 0)&&ue("Cannot register public name '"+s+"' twice"),Si(r,s,s),r.hasOwnProperty(c)&&ue("Cannot register multiple overloads of a function with the same number of arguments ("+c+")!"),r[s].overloadTable[c]=a):(r[s]=a,c!==void 0&&(r[s].numArguments=c))}function sg(s,a,c,h,d,w,b,_){this.name=s,this.constructor=a,this.instancePrototype=c,this.rawDestructor=h,this.baseClass=d,this.getActualType=w,this.upcast=b,this.downcast=_,this.pureVirtualFunctions=[]}function Ti(s,a,c){for(;a!==c;)a.upcast||ue("Expected null or instance of "+c.name+", got an instance of "+a.name),s=a.upcast(s),a=a.baseClass;return s}function ag(s,a){if(a===null)return this.isReference&&ue("null is not a valid "+this.name),0;a.$$||ue('Cannot pass "'+Pi(a)+'" as a '+this.name),a.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name);var c=a.$$.ptrType.registeredClass,h=Ti(a.$$.ptr,c,this.registeredClass);return h}function ug(s,a){var c;if(a===null)return this.isReference&&ue("null is not a valid "+this.name),this.isSmartPointer?(c=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,c),c):0;a.$$||ue('Cannot pass "'+Pi(a)+'" as a '+this.name),a.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&a.$$.ptrType.isConst&&ue("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);var h=a.$$.ptrType.registeredClass;if(c=Ti(a.$$.ptr,h,this.registeredClass),this.isSmartPointer)switch(a.$$.smartPtr===void 0&&ue("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:a.$$.smartPtrType===this?c=a.$$.smartPtr:ue("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:c=a.$$.smartPtr;break;case 2:if(a.$$.smartPtrType===this)c=a.$$.smartPtr;else{var d=a.clone();c=this.rawShare(c,De.toHandle(function(){d.delete()})),s!==null&&s.push(this.rawDestructor,c)}break;default:ue("Unsupporting sharing policy")}return c}function lg(s,a){if(a===null)return this.isReference&&ue("null is not a valid "+this.name),0;a.$$||ue('Cannot pass "'+Pi(a)+'" as a '+this.name),a.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name),a.$$.ptrType.isConst&&ue("Cannot convert argument of type "+a.$$.ptrType.name+" to parameter type "+this.name);var c=a.$$.ptrType.registeredClass,h=Ti(a.$$.ptr,c,this.registeredClass);return h}function uo(s){return this.fromWireType(ne[s>>2])}function cg(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function fg(s){this.rawDestructor&&this.rawDestructor(s)}function hg(s){s!==null&&s.delete()}function pg(){At.prototype.getPointee=cg,At.prototype.destructor=fg,At.prototype.argPackAdvance=8,At.prototype.readValueFromPointer=uo,At.prototype.deleteObject=hg,At.prototype.fromWireType=eg}function At(s,a,c,h,d,w,b,_,E,P,L){this.name=s,this.registeredClass=a,this.isReference=c,this.isConst=h,this.isSmartPointer=d,this.pointeeType=w,this.sharingPolicy=b,this.rawGetPointee=_,this.rawConstructor=E,this.rawShare=P,this.rawDestructor=L,!d&&a.baseClass===void 0?h?(this.toWireType=ag,this.destructorFunction=null):(this.toWireType=lg,this.destructorFunction=null):this.toWireType=ug}function dg(s,a,c){r.hasOwnProperty(s)||so("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&c!==void 0?r[s].overloadTable[c]=a:(r[s]=a,r[s].argCount=c)}function vg(s,a,c){var h=r["dynCall_"+s];return c&&c.length?h.apply(null,[a].concat(c)):h.call(null,a)}function gg(s,a,c){return s.includes("j")?vg(s,a,c):to(a).apply(null,c)}function mg(s,a){var c=[];return function(){return c.length=0,Object.assign(c,arguments),gg(s,a,c)}}function lr(s,a){s=Ye(s);function c(){return s.includes("j")?mg(s,a):to(a)}var h=c();return typeof h!="function"&&ue("unknown function pointer with signature "+s+": "+a),h}var Du=void 0;function Fu(s){var a=Yu(s),c=Ye(a);return Mt(a),c}function lo(s,a){var c=[],h={};function d(w){if(!h[w]&&!ar[w]){if(no[w]){no[w].forEach(d);return}c.push(w),h[w]=!0}}throw a.forEach(d),new Du(s+": "+c.map(Fu).join([", "]))}function yg(s,a,c,h,d,w,b,_,E,P,L,B,M){L=Ye(L),w=lr(d,w),_&&(_=lr(b,_)),P&&(P=lr(E,P)),M=lr(B,M);var G=oo(L);Mu(G,function(){lo("Cannot construct "+L+" due to unbound types",[h])}),ur([s,a,c],h?[h]:[],function(W){W=W[0];var le,ke;h?(le=W.registeredClass,ke=le.instancePrototype):ke=Yt.prototype;var Pe=io(G,function(){if(Object.getPrototypeOf(this)!==O)throw new xr("Use 'new' to construct "+L);if(z.constructor_body===void 0)throw new xr(L+" has no accessible constructor");var Ae=z.constructor_body[arguments.length];if(Ae===void 0)throw new xr("Tried to invoke ctor of "+L+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(z.constructor_body).toString()+") parameters instead!");return Ae.apply(this,arguments)}),O=Object.create(ke,{constructor:{value:Pe}});Pe.prototype=O;var z=new sg(L,Pe,O,M,le,w,_,P),Fe=new At(L,z,!0,!1,!1),de=new At(L+"*",z,!1,!1,!1),Ze=new At(L+" const*",z,!1,!0,!1);return Ou[s]={pointerType:de,constPointerType:Ze},dg(G,Pe),[Fe,de,Ze]})}function Lu(s,a){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var c=io(s.name||"unknownFunctionName",function(){});c.prototype=s.prototype;var h=new c,d=s.apply(h,a);return d instanceof Object?d:h}function Bu(s){for(;s.length;){var a=s.pop(),c=s.pop();c(a)}}function Ei(s,a,c,h,d){var w=a.length;w<2&&ue("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var b=a[1]!==null&&c!==null,_=!1,E=1;E<a.length;++E)if(a[E]!==null&&a[E].destructorFunction===void 0){_=!0;break}for(var P=a[0].name!=="void",L="",B="",E=0;E<w-2;++E)L+=(E!==0?", ":"")+"arg"+E,B+=(E!==0?", ":"")+"arg"+E+"Wired";var M="return function "+oo(s)+"("+L+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;_&&(M+=`var destructors = [];
`);var G=_?"destructors":"null",W=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],le=[ue,h,d,Bu,a[0],a[1]];b&&(M+="var thisWired = classParam.toWireType("+G+`, this);
`);for(var E=0;E<w-2;++E)M+="var arg"+E+"Wired = argType"+E+".toWireType("+G+", arg"+E+"); // "+a[E+2].name+`
`,W.push("argType"+E),le.push(a[E+2]);if(b&&(B="thisWired"+(B.length>0?", ":"")+B),M+=(P?"var rv = ":"")+"invoker(fn"+(B.length>0?", ":"")+B+`);
`,_)M+=`runDestructors(destructors);
`;else for(var E=b?1:2;E<a.length;++E){var ke=E===1?"thisWired":"arg"+(E-2)+"Wired";a[E].destructorFunction!==null&&(M+=ke+"_dtor("+ke+"); // "+a[E].name+`
`,W.push(ke+"_dtor"),le.push(a[E].destructorFunction))}P&&(M+=`var ret = retType.fromWireType(rv);
return ret;
`),M+=`}
`,W.push(M);var Pe=Lu(Function,W).apply(null,le);return Pe}function xi(s,a){for(var c=[],h=0;h<s;h++)c.push(U[(a>>2)+h]);return c}function wg(s,a,c,h,d,w,b){var _=xi(c,h);a=Ye(a),w=lr(d,w),ur([],[s],function(E){E=E[0];var P=E.name+"."+a;function L(){lo("Cannot call "+P+" due to unbound types",_)}a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var B=E.registeredClass.constructor;return B[a]===void 0?(L.argCount=c-1,B[a]=L):(Si(B,a,P),B[a].overloadTable[c-1]=L),ur([],_,function(M){var G=[M[0],null].concat(M.slice(1)),W=Ei(P,G,null,w,b);return B[a].overloadTable===void 0?(W.argCount=c-1,B[a]=W):B[a].overloadTable[c-1]=W,[]}),[]})}function bg(s,a,c,h,d,w){Be(a>0);var b=xi(a,c);d=lr(h,d),ur([],[s],function(_){_=_[0];var E="constructor "+_.name;if(_.registeredClass.constructor_body===void 0&&(_.registeredClass.constructor_body=[]),_.registeredClass.constructor_body[a-1]!==void 0)throw new xr("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+_.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return _.registeredClass.constructor_body[a-1]=()=>{lo("Cannot construct "+_.name+" due to unbound types",b)},ur([],b,function(P){return P.splice(1,0,null),_.registeredClass.constructor_body[a-1]=Ei(E,P,null,d,w),[]}),[]})}function _g(s,a,c,h,d,w,b,_){var E=xi(c,h);a=Ye(a),w=lr(d,w),ur([],[s],function(P){P=P[0];var L=P.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),_&&P.registeredClass.pureVirtualFunctions.push(a);function B(){lo("Cannot call "+L+" due to unbound types",E)}var M=P.registeredClass.instancePrototype,G=M[a];return G===void 0||G.overloadTable===void 0&&G.className!==P.name&&G.argCount===c-2?(B.argCount=c-2,B.className=P.name,M[a]=B):(Si(M,a,L),M[a].overloadTable[c-2]=B),ur([],E,function(W){var le=Ei(L,W,P,w,b);return M[a].overloadTable===void 0?(le.argCount=c-2,M[a]=le):M[a].overloadTable[c-2]=le,[]}),[]})}var ki=[],lt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ci(s){s>4&&--lt[s].refcount===0&&(lt[s]=void 0,ki.push(s))}function Sg(){for(var s=0,a=5;a<lt.length;++a)lt[a]!==void 0&&++s;return s}function Tg(){for(var s=5;s<lt.length;++s)if(lt[s]!==void 0)return lt[s];return null}function Eg(){r.count_emval_handles=Sg,r.get_first_emval=Tg}var De={toValue:s=>(s||ue("Cannot use deleted val. handle = "+s),lt[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var a=ki.length?ki.pop():lt.length;return lt[a]={refcount:1,value:s},a}}}};function xg(s,a){a=Ye(a),vt(s,{name:a,fromWireType:function(c){var h=De.toValue(c);return Ci(c),h},toWireType:function(c,h){return De.toHandle(h)},argPackAdvance:8,readValueFromPointer:uo,destructorFunction:null})}function kg(s,a,c){switch(a){case 0:return function(h){var d=c?He:$e;return this.fromWireType(d[h])};case 1:return function(h){var d=c?Wt:rn;return this.fromWireType(d[h>>1])};case 2:return function(h){var d=c?U:ne;return this.fromWireType(d[h>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Cg(s,a,c,h){var d=ro(c);a=Ye(a);function w(){}w.values={},vt(s,{name:a,constructor:w,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,_){return _.value},argPackAdvance:8,readValueFromPointer:kg(a,d,h),destructorFunction:null}),Mu(a,w)}function co(s,a){var c=ar[s];return c===void 0&&ue(a+" has unknown type "+Fu(s)),c}function Pg(s,a,c){var h=co(s,"enum");a=Ye(a);var d=h.constructor,w=Object.create(h.constructor.prototype,{value:{value:c},constructor:{value:io(h.name+"_"+a,function(){})}});d.values[c]=w,d[a]=w}function Pi(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function Ag(s,a){switch(a){case 2:return function(c){return this.fromWireType(ut[c>>2])};case 3:return function(c){return this.fromWireType(vu[c>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Rg(s,a,c){var h=ro(c);a=Ye(a),vt(s,{name:a,fromWireType:function(d){return d},toWireType:function(d,w){return w},argPackAdvance:8,readValueFromPointer:Ag(a,h),destructorFunction:null})}function Og(s,a,c){switch(a){case 0:return c?function(d){return He[d]}:function(d){return $e[d]};case 1:return c?function(d){return Wt[d>>1]}:function(d){return rn[d>>1]};case 2:return c?function(d){return U[d>>2]}:function(d){return ne[d>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function Mg(s,a,c,h,d){a=Ye(a);var w=ro(c),b=B=>B;if(h===0){var _=32-8*c;b=B=>B<<_>>>_}var E=a.includes("unsigned"),P=(B,M)=>{},L;E?L=function(B,M){return P(M,this.name),M>>>0}:L=function(B,M){return P(M,this.name),M},vt(s,{name:a,fromWireType:b,toWireType:L,argPackAdvance:8,readValueFromPointer:Og(a,w,h!==0),destructorFunction:null})}function Dg(s,a,c){var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],d=h[a];function w(b){b=b>>2;var _=ne,E=_[b],P=_[b+1];return new d(kt,P,E)}c=Ye(c),vt(s,{name:c,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function Fg(s,a){a=Ye(a);var c=a==="std::string";vt(s,{name:a,fromWireType:function(h){var d=ne[h>>2],w;if(c)for(var b=h+4,_=0;_<=d;++_){var E=h+4+_;if(_==d||$e[E]==0){var P=E-b,L=J(b,P);w===void 0?w=L:(w+=String.fromCharCode(0),w+=L),b=E+1}}else{for(var B=new Array(d),_=0;_<d;++_)B[_]=String.fromCharCode($e[h+4+_]);w=B.join("")}return Mt(h),w},toWireType:function(h,d){d instanceof ArrayBuffer&&(d=new Uint8Array(d));var w,b=typeof d=="string";b||d instanceof Uint8Array||d instanceof Uint8ClampedArray||d instanceof Int8Array||ue("Cannot pass non-string to std::string"),c&&b?w=()=>fe(d):w=()=>d.length;var _=w(),E=Ot(4+_+1);if(ne[E>>2]=_,c&&b)Te(d,E+4,_+1);else if(b)for(var P=0;P<_;++P){var L=d.charCodeAt(P);L>255&&(Mt(E),ue("String has UTF-16 code units that do not fit in 8 bits")),$e[E+4+P]=L}else for(var P=0;P<_;++P)$e[E+4+P]=d[P];return h!==null&&h.push(Mt,E),E},argPackAdvance:8,readValueFromPointer:uo,destructorFunction:function(h){Mt(h)}})}function Lg(s,a,c){c=Ye(c);var h,d,w,b,_;a===2?(h=Me,d=Ge,b=_e,w=()=>rn,_=1):a===4&&(h=Ue,d=en,b=vi,w=()=>ne,_=2),vt(s,{name:c,fromWireType:function(E){for(var P=ne[E>>2],L=w(),B,M=E+4,G=0;G<=P;++G){var W=E+4+G*a;if(G==P||L[W>>_]==0){var le=W-M,ke=h(M,le);B===void 0?B=ke:(B+=String.fromCharCode(0),B+=ke),M=W+a}}return Mt(E),B},toWireType:function(E,P){typeof P!="string"&&ue("Cannot pass non-string to C++ string type "+c);var L=b(P),B=Ot(4+L+a);return ne[B>>2]=L>>_,d(P,B+4,L+a),E!==null&&E.push(Mt,B),B},argPackAdvance:8,readValueFromPointer:uo,destructorFunction:function(E){Mt(E)}})}function Bg(s,a){a=Ye(a),vt(s,{isVoid:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(c,h){}})}function Ug(){return Date.now()}var Ig=!0;function Gg(){return Ig}function Ng(s,a,c){s=De.toValue(s),a=co(a,"emval::as");var h=[],d=De.toHandle(h);return U[c>>2]=d,a.toWireType(h,s)}function Vg(s){var a=[];return U[s>>2]=De.toHandle(a),a}var Hg={};function Ai(s){var a=Hg[s];return a===void 0?Ye(s):a}var Ri=[];function zg(s,a,c,h,d){return s=Ri[s],a=De.toValue(a),c=Ai(c),s(a,c,Vg(h),d)}function Uu(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Wg(s){return s===0?De.toHandle(Uu()):(s=Ai(s),De.toHandle(Uu()[s]))}function $g(s){var a=Ri.length;return Ri.push(s),a}function Yg(s,a){for(var c=new Array(s),h=0;h<s;++h)c[h]=co(ne[a+h*ie>>2],"parameter "+h);return c}var Iu=[];function Xg(s,a){var c=Yg(s,a),h=c[0],d=h.name+"_$"+c.slice(1).map(function(W){return W.name}).join("_")+"$",w=Iu[d];if(w!==void 0)return w;for(var b=["retType"],_=[h],E="",P=0;P<s-1;++P)E+=(P!==0?", ":"")+"arg"+P,b.push("argType"+P),_.push(c[1+P]);for(var L=oo("methodCaller_"+d),B="return function "+L+`(handle, name, destructors, args) {
`,M=0,P=0;P<s-1;++P)B+="    var arg"+P+" = argType"+P+".readValueFromPointer(args"+(M?"+"+M:"")+`);
`,M+=c[P+1].argPackAdvance;B+="    var rv = handle[name]("+E+`);
`;for(var P=0;P<s-1;++P)c[P+1].deleteObject&&(B+="    argType"+P+".deleteObject(arg"+P+`);
`);h.isVoid||(B+=`    return retType.toWireType(destructors, rv);
`),B+=`};
`,b.push(B);var G=Lu(Function,b).apply(null,_);return w=$g(G),Iu[d]=w,w}function jg(s,a){return s=De.toValue(s),a=De.toValue(a),De.toHandle(s[a])}function qg(s){s>4&&(lt[s].refcount+=1)}function Zg(s){return De.toHandle(Ai(s))}function Kg(s){var a=De.toValue(s);Bu(a),Ci(s)}function Qg(s,a,c){s=De.toValue(s),a=De.toValue(a),c=De.toValue(c),s[a]=c}function Jg(s,a){s=co(s,"_emval_take_value");var c=s.readValueFromPointer(a);return De.toHandle(c)}function em(s){return s=De.toValue(s),De.toHandle(typeof s)}function tm(s,a){var c=new Date(U[s>>2]*1e3);U[a>>2]=c.getSeconds(),U[a+4>>2]=c.getMinutes(),U[a+8>>2]=c.getHours(),U[a+12>>2]=c.getDate(),U[a+16>>2]=c.getMonth(),U[a+20>>2]=c.getFullYear()-1900,U[a+24>>2]=c.getDay();var h=new Date(c.getFullYear(),0,1),d=(c.getTime()-h.getTime())/(1e3*60*60*24)|0;U[a+28>>2]=d,U[a+36>>2]=-(c.getTimezoneOffset()*60);var w=new Date(c.getFullYear(),6,1).getTimezoneOffset(),b=h.getTimezoneOffset(),_=(w!=b&&c.getTimezoneOffset()==Math.min(b,w))|0;U[a+32>>2]=_}function rm(s,a,c,h,d,w){try{var b=g.getStream(d);b&&(c&2&&ae.doMsync(s,b,a,h,w),g.munmap(b))}catch(_){if(typeof g>"u"||!(_ instanceof g.ErrnoError))throw _;return-_.errno}}function nm(s,a,c){var h=new Date().getFullYear(),d=new Date(h,0,1),w=new Date(h,6,1),b=d.getTimezoneOffset(),_=w.getTimezoneOffset(),E=Math.max(b,_);U[s>>2]=E*60,U[a>>2]=Number(b!=_);function P(W){var le=W.toTimeString().match(/\(([A-Za-z ]+)\)$/);return le?le[1]:"GMT"}var L=P(d),B=P(w),M=Kn(L),G=Kn(B);_<b?(ne[c>>2]=M,ne[c+4>>2]=G):(ne[c>>2]=G,ne[c+4>>2]=M)}function Oi(s,a,c){Oi.called||(Oi.called=!0,nm(s,a,c))}function om(){$t("")}function Gu(){return 2147483648}function im(){return Gu()}function sm(s,a,c){$e.copyWithin(s,a,a+c)}function am(s){try{return he.grow(s-kt.byteLength+65535>>>16),gu(he.buffer),1}catch{}}function um(s){var a=$e.length;s=s>>>0;var c=Gu();if(s>c)return!1;let h=(E,P)=>E+(P-E%P)%P;for(var d=1;d<=4;d*=2){var w=a*(1+.2/d);w=Math.min(w,s+100663296);var b=Math.min(c,h(Math.max(s,w),65536)),_=am(b);if(_)return!0}return!1}var Mi={};function lm(){return u||"./this.program"}function ln(){if(!ln.strings){var s=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:s,_:lm()};for(var c in Mi)Mi[c]===void 0?delete a[c]:a[c]=Mi[c];var h=[];for(var c in a)h.push(c+"="+a[c]);ln.strings=h}return ln.strings}function cm(s,a){var c=0;return ln().forEach(function(h,d){var w=a+c;ne[s+d*4>>2]=w,Qn(h,w),c+=h.length+1}),0}function fm(s,a){var c=ln();ne[s>>2]=c.length;var h=0;return c.forEach(function(d){h+=d.length+1}),ne[a>>2]=h,0}function hm(s){$m(s)}function pm(s){try{var a=ae.getStreamFromFD(s);return g.close(a),0}catch(c){if(typeof g>"u"||!(c instanceof g.ErrnoError))throw c;return c.errno}}function dm(s,a,c,h){for(var d=0,w=0;w<c;w++){var b=ne[a>>2],_=ne[a+4>>2];a+=8;var E=g.read(s,He,b,_,h);if(E<0)return-1;if(d+=E,E<_)break}return d}function vm(s,a,c,h){try{var d=ae.getStreamFromFD(s),w=dm(d,a,c);return U[h>>2]=w,0}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return b.errno}}function gm(s,a){return a+2097152>>>0<4194305-!!s?(s>>>0)+a*4294967296:NaN}function mm(s,a,c,h,d){try{var w=gm(a,c);if(isNaN(w))return 61;var b=ae.getStreamFromFD(s);return g.llseek(b,w,h),Ct=[b.position>>>0,(Ne=b.position,+Math.abs(Ne)>=1?Ne>0?(Math.min(+Math.floor(Ne/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ne-+(~~Ne>>>0))/4294967296)>>>0:0)],U[d>>2]=Ct[0],U[d+4>>2]=Ct[1],b.getdents&&w===0&&h===0&&(b.getdents=null),0}catch(_){if(typeof g>"u"||!(_ instanceof g.ErrnoError))throw _;return _.errno}}function ym(s,a,c,h){for(var d=0,w=0;w<c;w++){var b=ne[a>>2],_=ne[a+4>>2];a+=8;var E=g.write(s,He,b,_,h);if(E<0)return-1;d+=E}return d}function wm(s,a,c,h){try{var d=ae.getStreamFromFD(s),w=ym(d,a,c);return ne[h>>2]=w,0}catch(b){if(typeof g>"u"||!(b instanceof g.ErrnoError))throw b;return b.errno}}function Nu(s){for(var a=s.split("."),c=0;c<4;c++){var h=Number(a[c]);if(isNaN(h))return null;a[c]=h}return(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)>>>0}function cn(s){return parseInt(s)}function bm(s){var a,c,h,d,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,b=[];if(!w.test(s))return null;if(s==="::")return[0,0,0,0,0,0,0,0];for(s.startsWith("::")?s=s.replace("::","Z:"):s=s.replace("::",":Z:"),s.indexOf(".")>0?(s=s.replace(new RegExp("[.]","g"),":"),a=s.split(":"),a[a.length-4]=cn(a[a.length-4])+cn(a[a.length-3])*256,a[a.length-3]=cn(a[a.length-2])+cn(a[a.length-1])*256,a=a.slice(0,a.length-2)):a=s.split(":"),h=0,d=0,c=0;c<a.length;c++)if(typeof a[c]=="string")if(a[c]==="Z"){for(d=0;d<8-a.length+1;d++)b[c+d]=0;h=d-1}else b[c+h]=Xu(parseInt(a[c],16));else b[c+h]=a[c];return[b[1]<<16|b[0],b[3]<<16|b[2],b[5]<<16|b[4],b[7]<<16|b[6]]}var Xt={address_map:{id:1,addrs:{},names:{}},lookup_name:function(s){var a=Nu(s);if(a!==null||(a=bm(s),a!==null))return s;var c;if(Xt.address_map.addrs[s])c=Xt.address_map.addrs[s];else{var h=Xt.address_map.id++;Be(h<65535,"exceeded max address mappings of 65535"),c="172.29."+(h&255)+"."+(h&65280),Xt.address_map.names[c]=s,Xt.address_map.addrs[s]=c}return c},lookup_addr:function(s){return Xt.address_map.names[s]?Xt.address_map.names[s]:null}};function _m(s){var a=Ot(20),c=Ot(s.length+1);Te(s,c,s.length+1),ne[a>>2]=c;var h=Ot(4);ne[h>>2]=0,ne[a+4>>2]=h;var d=2;U[a+8>>2]=d,U[a+12>>2]=4;var w=Ot(12);return ne[w>>2]=w+8,ne[w+4>>2]=0,U[w+8>>2]=Nu(Xt.lookup_name(s)),ne[a+16>>2]=w,a}function Sm(s){return _m(J(s))}function Tm(s){var a=s.getExtension("ANGLE_instanced_arrays");if(a)return s.vertexAttribDivisor=function(c,h){a.vertexAttribDivisorANGLE(c,h)},s.drawArraysInstanced=function(c,h,d,w){a.drawArraysInstancedANGLE(c,h,d,w)},s.drawElementsInstanced=function(c,h,d,w,b){a.drawElementsInstancedANGLE(c,h,d,w,b)},1}function Em(s){var a=s.getExtension("OES_vertex_array_object");if(a)return s.createVertexArray=function(){return a.createVertexArrayOES()},s.deleteVertexArray=function(c){a.deleteVertexArrayOES(c)},s.bindVertexArray=function(c){a.bindVertexArrayOES(c)},s.isVertexArray=function(c){return a.isVertexArrayOES(c)},1}function xm(s){var a=s.getExtension("WEBGL_draw_buffers");if(a)return s.drawBuffers=function(c,h){a.drawBuffersWEBGL(c,h)},1}function km(s){return!!(s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw"))}var Se={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(a){Se.lastError||(Se.lastError=a)},getNewId:function(s){for(var a=Se.counter++,c=s.length;c<a;c++)s[c]=null;return a},getSource:function(s,a,c,h){for(var d="",w=0;w<a;++w){var b=h?U[h+w*4>>2]:-1;d+=J(U[c+w*4>>2],b<0?void 0:b)}return d},createContext:function(s,a){if(!s.getContextSafariWebGL2Fixed){let d=function(w,b){var _=s.getContextSafariWebGL2Fixed(w,b);return w=="webgl"==_ instanceof WebGLRenderingContext?_:null};s.getContextSafariWebGL2Fixed=s.getContext,s.getContext=d}var c=s.getContext("webgl",a);if(!c)return 0;var h=Se.registerContext(c,a);return h},registerContext:function(s,a){var c=Se.getNewId(Se.contexts),h={handle:c,attributes:a,version:a.majorVersion,GLctx:s};return s.canvas&&(s.canvas.GLctxObject=h),Se.contexts[c]=h,(typeof a.enableExtensionsByDefault>"u"||a.enableExtensionsByDefault)&&Se.initExtensions(h),c},makeContextCurrent:function(s){return Se.currentContext=Se.contexts[s],r.ctx=je=Se.currentContext&&Se.currentContext.GLctx,!(s&&!je)},getContext:function(s){return Se.contexts[s]},deleteContext:function(s){Se.currentContext===Se.contexts[s]&&(Se.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(Se.contexts[s].GLctx.canvas),Se.contexts[s]&&Se.contexts[s].GLctx.canvas&&(Se.contexts[s].GLctx.canvas.GLctxObject=void 0),Se.contexts[s]=null},initExtensions:function(s){if(s||(s=Se.currentContext),!s.initExtensionsDone){s.initExtensionsDone=!0;var a=s.GLctx;Tm(a),Em(a),xm(a),a.disjointTimerQueryExt=a.getExtension("EXT_disjoint_timer_query"),km(a);var c=a.getSupportedExtensions()||[];c.forEach(function(h){!h.includes("lose_context")&&!h.includes("debug")&&a.getExtension(h)})}}};function Vu(s){return s.slice(-1)=="]"&&s.lastIndexOf("[")}function Cm(s){var a=s.uniformLocsById,c=s.uniformSizeAndIdsByName,h,d;if(!a)for(s.uniformLocsById=a={},s.uniformArrayNamesById={},h=0;h<je.getProgramParameter(s,35718);++h){var w=je.getActiveUniform(s,h),b=w.name,_=w.size,E=Vu(b),P=E>0?b.slice(0,E):b,L=s.uniformIdCounter;for(s.uniformIdCounter+=_,c[P]=[_,L],d=0;d<_;++d)a[L]=d,s.uniformArrayNamesById[L++]=P}}function Pm(s,a){if(a=J(a),s=Se.programs[s]){Cm(s);var c=s.uniformLocsById,h=0,d=a,w=Vu(a);w>0&&(h=cn(a.slice(w+1))>>>0,d=a.slice(0,w));var b=s.uniformSizeAndIdsByName[d];if(b&&h<b[0]&&(h+=b[1],c[h]=c[h]||je.getUniformLocation(s,a)))return h}else Se.recordError(1281);return-1}function jt(s){var a=je.currentProgram;if(a){var c=a.uniformLocsById[s];return typeof c=="number"&&(a.uniformLocsById[s]=c=je.getUniformLocation(a,a.uniformArrayNamesById[s]+(c>0?"["+c+"]":""))),c}else Se.recordError(1282)}function Am(s,a){je.uniform1f(jt(s),a)}function Rm(s,a){je.uniform1i(jt(s),a)}var fo=[];function Om(s,a,c){if(a<=144)for(var h=fo[2*a-1],d=0;d<2*a;d+=2)h[d]=ut[c+4*d>>2],h[d+1]=ut[c+(4*d+4)>>2];else var h=ut.subarray(c>>2,c+a*8>>2);je.uniform2fv(jt(s),h)}var ho=[];function Mm(s,a,c){if(a<=144)for(var h=ho[2*a-1],d=0;d<2*a;d+=2)h[d]=U[c+4*d>>2],h[d+1]=U[c+(4*d+4)>>2];else var h=U.subarray(c>>2,c+a*8>>2);je.uniform2iv(jt(s),h)}function Dm(s,a,c){if(a<=96)for(var h=fo[3*a-1],d=0;d<3*a;d+=3)h[d]=ut[c+4*d>>2],h[d+1]=ut[c+(4*d+4)>>2],h[d+2]=ut[c+(4*d+8)>>2];else var h=ut.subarray(c>>2,c+a*12>>2);je.uniform3fv(jt(s),h)}function Fm(s,a,c){if(a<=96)for(var h=ho[3*a-1],d=0;d<3*a;d+=3)h[d]=U[c+4*d>>2],h[d+1]=U[c+(4*d+4)>>2],h[d+2]=U[c+(4*d+8)>>2];else var h=U.subarray(c>>2,c+a*12>>2);je.uniform3iv(jt(s),h)}function Lm(s,a,c){if(a<=72){var h=fo[4*a-1],d=ut;c>>=2;for(var w=0;w<4*a;w+=4){var b=c+w;h[w]=d[b],h[w+1]=d[b+1],h[w+2]=d[b+2],h[w+3]=d[b+3]}}else var h=ut.subarray(c>>2,c+a*16>>2);je.uniform4fv(jt(s),h)}function Bm(s,a,c){if(a<=72)for(var h=ho[4*a-1],d=0;d<4*a;d+=4)h[d]=U[c+4*d>>2],h[d+1]=U[c+(4*d+4)>>2],h[d+2]=U[c+(4*d+8)>>2],h[d+3]=U[c+(4*d+12)>>2];else var h=U.subarray(c>>2,c+a*16>>2);je.uniform4iv(jt(s),h)}function Um(s){}function po(s){return s%4===0&&(s%100!==0||s%400===0)}function Im(s,a){for(var c=0,h=0;h<=a;c+=s[h++]);return c}var Hu=[31,29,31,30,31,30,31,31,30,31,30,31],zu=[31,28,31,30,31,30,31,31,30,31,30,31];function Gm(s,a){for(var c=new Date(s.getTime());a>0;){var h=po(c.getFullYear()),d=c.getMonth(),w=(h?Hu:zu)[d];if(a>w-c.getDate())a-=w-c.getDate()+1,c.setDate(1),d<11?c.setMonth(d+1):(c.setMonth(0),c.setFullYear(c.getFullYear()+1));else return c.setDate(c.getDate()+a),c}return c}function Nm(s,a,c,h){var d=U[h+40>>2],w={tm_sec:U[h>>2],tm_min:U[h+4>>2],tm_hour:U[h+8>>2],tm_mday:U[h+12>>2],tm_mon:U[h+16>>2],tm_year:U[h+20>>2],tm_wday:U[h+24>>2],tm_yday:U[h+28>>2],tm_isdst:U[h+32>>2],tm_gmtoff:U[h+36>>2],tm_zone:d?J(d):""},b=J(c),_={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var E in _)b=b.replace(new RegExp(E,"g"),_[E]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],L=["January","February","March","April","May","June","July","August","September","October","November","December"];function B(O,z,Fe){for(var de=typeof O=="number"?O.toString():O||"";de.length<z;)de=Fe[0]+de;return de}function M(O,z){return B(O,z,"0")}function G(O,z){function Fe(Ze){return Ze<0?-1:Ze>0?1:0}var de;return(de=Fe(O.getFullYear()-z.getFullYear()))===0&&(de=Fe(O.getMonth()-z.getMonth()))===0&&(de=Fe(O.getDate()-z.getDate())),de}function W(O){switch(O.getDay()){case 0:return new Date(O.getFullYear()-1,11,29);case 1:return O;case 2:return new Date(O.getFullYear(),0,3);case 3:return new Date(O.getFullYear(),0,2);case 4:return new Date(O.getFullYear(),0,1);case 5:return new Date(O.getFullYear()-1,11,31);case 6:return new Date(O.getFullYear()-1,11,30)}}function le(O){var z=Gm(new Date(O.tm_year+1900,0,1),O.tm_yday),Fe=new Date(z.getFullYear(),0,4),de=new Date(z.getFullYear()+1,0,4),Ze=W(Fe),Ae=W(de);return G(Ze,z)<=0?G(Ae,z)<=0?z.getFullYear()+1:z.getFullYear():z.getFullYear()-1}var ke={"%a":function(O){return P[O.tm_wday].substring(0,3)},"%A":function(O){return P[O.tm_wday]},"%b":function(O){return L[O.tm_mon].substring(0,3)},"%B":function(O){return L[O.tm_mon]},"%C":function(O){var z=O.tm_year+1900;return M(z/100|0,2)},"%d":function(O){return M(O.tm_mday,2)},"%e":function(O){return B(O.tm_mday,2," ")},"%g":function(O){return le(O).toString().substring(2)},"%G":function(O){return le(O)},"%H":function(O){return M(O.tm_hour,2)},"%I":function(O){var z=O.tm_hour;return z==0?z=12:z>12&&(z-=12),M(z,2)},"%j":function(O){return M(O.tm_mday+Im(po(O.tm_year+1900)?Hu:zu,O.tm_mon-1),3)},"%m":function(O){return M(O.tm_mon+1,2)},"%M":function(O){return M(O.tm_min,2)},"%n":function(){return`
`},"%p":function(O){return O.tm_hour>=0&&O.tm_hour<12?"AM":"PM"},"%S":function(O){return M(O.tm_sec,2)},"%t":function(){return"	"},"%u":function(O){return O.tm_wday||7},"%U":function(O){var z=O.tm_yday+7-O.tm_wday;return M(Math.floor(z/7),2)},"%V":function(O){var z=Math.floor((O.tm_yday+7-(O.tm_wday+6)%7)/7);if((O.tm_wday+371-O.tm_yday-2)%7<=2&&z++,z){if(z==53){var de=(O.tm_wday+371-O.tm_yday)%7;de!=4&&(de!=3||!po(O.tm_year))&&(z=1)}}else{z=52;var Fe=(O.tm_wday+7-O.tm_yday-1)%7;(Fe==4||Fe==5&&po(O.tm_year%400-1))&&z++}return M(z,2)},"%w":function(O){return O.tm_wday},"%W":function(O){var z=O.tm_yday+7-(O.tm_wday+6)%7;return M(Math.floor(z/7),2)},"%y":function(O){return(O.tm_year+1900).toString().substring(2)},"%Y":function(O){return O.tm_year+1900},"%z":function(O){var z=O.tm_gmtoff,Fe=z>=0;return z=Math.abs(z)/60,z=z/60*100+z%60,(Fe?"+":"-")+String("0000"+z).slice(-4)},"%Z":function(O){return O.tm_zone},"%%":function(){return"%"}};b=b.replace(/%%/g,"\0\0");for(var E in ke)b.includes(E)&&(b=b.replace(new RegExp(E,"g"),ke[E](w)));b=b.replace(/\0\0/g,"%");var Pe=mo(b,!1);return Pe.length>a?0:(tn(Pe,s),Pe.length-1)}function Vm(s,a,c,h){return Nm(s,a,c,h)}var Wu=function(s,a,c,h){s||(s=this),this.parent=s,this.mount=s.mount,this.mounted=null,this.id=g.nextInode++,this.name=a,this.mode=c,this.node_ops={},this.stream_ops={},this.rdev=h},vo=365,go=146;Object.defineProperties(Wu.prototype,{read:{get:function(){return(this.mode&vo)===vo},set:function(s){s?this.mode|=vo:this.mode&=~vo}},write:{get:function(){return(this.mode&go)===go},set:function(s){s?this.mode|=go:this.mode&=~go}},isFolder:{get:function(){return g.isDir(this.mode)}},isDevice:{get:function(){return g.isChrdev(this.mode)}}}),g.FSNode=Wu,g.staticInit(),Vv(),xr=r.BindingError=yi(Error,"BindingError"),Cu=r.InternalError=yi(Error,"InternalError"),ig(),Kv(),pg(),Du=r.UnboundTypeError=yi(Error,"UnboundTypeError"),Eg();for(var je,Hm=new Float32Array(288),Rt=0;Rt<288;++Rt)fo[Rt]=Hm.subarray(0,Rt+1);for(var zm=new Int32Array(288),Rt=0;Rt<288;++Rt)ho[Rt]=zm.subarray(0,Rt+1);function mo(s,a,c){var h=c>0?c:fe(s)+1,d=new Array(h),w=be(s,d,0,d.length);return a&&(d.length=w),d}var Wm={ga:_v,k:Sv,b:Tv,c:xv,Q:Rv,R:Ov,q:Dv,K:Fv,U:Lv,I:Bv,H:Uv,u:Iv,J:Gv,z:Nv,W:Wv,d:yg,f:wg,e:bg,a:_g,V:xg,g:Cg,h:Pg,v:Rg,j:Mg,i:Dg,w:Fg,r:Lg,X:Bg,N:Ug,M:Gg,m:Ng,ka:zg,x:Ci,la:Wg,ja:Xg,s:jg,E:qg,ia:Zg,ma:Kg,n:Qg,l:Jg,na:em,O:tm,D:rm,P:Oi,t:om,C:im,L:sm,o:um,F:cm,G:fm,fa:hm,p:pm,T:vm,y:mm,S:wm,ha:Sm,ea:Pm,ca:Am,da:Rm,_:Om,ba:Mm,Z:Dm,aa:Fm,Y:Lm,$:Bm,A:Um,B:Vm};bv(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Ot=r._malloc=function(){return(Ot=r._malloc=r.asm.qa).apply(null,arguments)},Mt=r._free=function(){return(Mt=r._free=r.asm.ra).apply(null,arguments)},$u=r.___errno_location=function(){return($u=r.___errno_location=r.asm.sa).apply(null,arguments)},Yu=r.___getTypeName=function(){return(Yu=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var Xu=r._htons=function(){return(Xu=r._htons=r.asm.wa).apply(null,arguments)},ju=r._emscripten_builtin_memalign=function(){return(ju=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},qu=r.___cxa_is_pointer_type=function(){return(qu=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=g;var yo;function Di(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}nn=function s(){yo||Fi(),yo||(nn=s)};function Fi(s){if(ir>0||(hv(),ir>0))return;function a(){yo||(yo=!0,r.calledRun=!0,!Re&&(pv(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),dv()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),a()},1)):a()}r.run=Fi;function $m(s,a){Ym(s)}function Ym(s){_u()||(r.onExit&&r.onExit(s),Re=!0),l(s,new Di(s))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Fi(),r.ready}})(),Ku="/cad-os/assets/replicad_single-b4564eab.wasm";const wo={library:null},Qu=t=>{wo.library=t},I=()=>{if(!wo.library)throw new Error("oppencascade has not been loaded");return wo.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const kr=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class Ke{constructor(e){this.oc=I(),e&&kr.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(kr.unregister(this._wrapped),this._wrapped.delete()),kr.register(this,e,e),this._wrapped=e}delete(){var e;kr.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const ve=()=>{function t(e){return kr.register(t,e),e}return t},Oe=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},Li=2147483647,rt=Math.PI/180,Cr=180/Math.PI,bo=t=>Math.round(t*1e3)/1e3,Pr=(t,e,r)=>{const n=I(),o=Qe(t),i=gt(e);let u;if(r){const l=gt(r);u=new n.gp_Ax3_3(o,i,l),l.delete()}else u=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),u},Ar=(t,e,r)=>{const n=I(),o=Qe(t),i=gt(e);let u;if(r){const l=gt(r);u=new n.gp_Ax2_2(o,i,l),l.delete()}else u=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),u},Rr=(t,e)=>{const r=I(),n=Qe(t),o=gt(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},Ju=(t=[0,0,0])=>{const e=I();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof R)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class R extends Ke{constructor(e=[0,0,0]){super(Ju(e))}get repr(){return`x: ${bo(this.x)}, y: ${bo(this.y)}, z: ${bo(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new R(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new R(this.wrapped.Subtracted(e.wrapped))}add(e){return new R(this.wrapped.Added(e.wrapped))}multiply(e){return new R(this.wrapped.Multiplied(e))}normalized(){return new R(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*Cr}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),u=this.sub(i);return o.delete(),i.delete(),u}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Rr(r,n);return this.wrapped.Rotate(o,e*rt),o.delete(),this}}const el={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function tl(t){return t==="X"||t==="Y"||t==="Z"?el[t]:t}function Qe(t){const e=new R(t),r=e.toPnt();return e.delete(),r}function gt(t){const e=new R(t),r=e.toDir();return e.delete(),r}class qt extends Ke{constructor(e){const r=I();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new R(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=gt(n),i=Qe(r),u=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(u,e*rt),u.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=ve();let o,i;if(typeof e=="string"){const l=n(Bi(e,r));o=l.origin,i=l.zDir}else e instanceof Xe?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const u=n(Ar(o,i));return this.wrapped.SetMirror_3(u),this}scale(e,r){const n=Qe(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=ve(),o=n(e==="reference"?new this.oc.gp_Ax3_1:Pr(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:Pr(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=Qe(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Xe{constructor(e,r=null,n=[0,0,1]){this.oc=I();const o=new R(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new R(r);else{const u=Pr(e,o);i=new R(u.XDirection()),u.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new R(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Xe(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new R(e),r}translate(e,r=0,n=0){const o=new R(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=tl(r),o=new R(this.zDir).rotate(e,[0,0,0],n),i=new R(this.xDir).rotate(e,[0,0,0],n);return new Xe(this.origin,i,o)}rotate2DAxes(e){const r=new R(this.xDir).rotate(e,[0,0,0],this.zDir);return new Xe(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=Pr(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new qt,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new qt,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new R(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new R(r);return r.delete(),n}}const rl={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},Bi=(t,e=[0,0,0])=>{const r=rl[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new Xe(n,r.xDir,r.normal)};let nl=class extends Ke{constructor(e){const r=I();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new R(e).repr} - ${new R(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},u={current:0};return this.wrapped.Get(e,r,n,o,i,u),[[e.current,r.current,n.current],[o.current,i.current,u.current]]}get center(){const[[e,r,n],[o,i,u]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(u-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function Dt(t="XY",e=[0,0,0]){return t instanceof Xe?t.clone():Bi(t,e)}function ol(t,e,r=[0,0,0],n=[0,0,1]){const o=new qt;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function il(t,e){const r=new qt;r.translate(e);const n=r.transform(t);return r.delete(),n}function sl(t,e,r){const n=new qt;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function al(t,e,r){const n=new qt;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function fn(t){return Array.isArray(t)&&t.length===2}let hn=null;const Ui=t=>{if(hn&&!t)return hn;const r=I().GeomAbs_CurveType;return hn=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),hn},Or=t=>{let e=Ui().get(t);if(e||(e=Ui(!0).get(t)),!e)throw new Error("unknown type");return e};function ul(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function ll(t){return Array.from(Array(t).keys())}function cr(t){const e=Math.min(...t.map(r=>r.length));return ll(e).map(r=>t.map(n=>n[r]))}function pn(t){return Math.round(t*100)/100}const Mr=([t,e])=>`(${pn(t)},${pn(e)})`,Ii=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Gi=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${Ii(r,e)},${Ii(n,e)}]`,[r,n]])).values()),Ve=([t,e])=>{const r=I();return new r.gp_Pnt2d_3(t,e)},cl=([t,e])=>{const r=I();return new r.gp_Dir2d_4(t,e)},Ni=([t,e])=>{const r=I();return new r.gp_Vec2d_4(t,e)},fr=(t,e)=>{const r=I(),[n,o]=Oe(),i=new r.gp_Ax2d_2(n(Ve(t)),n(cl(e)));return o(),i};class Dr extends Ke{constructor(e){const r=I();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${Mr(e)} - ${Mr(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=ve()(Ve(e));return!this.wrapped.IsOut_1(n)}}const ze=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,hr=([t,e],[r,n])=>[t+r,e+n],_o=([t,e],[r,n])=>[t-r,e-n],So=([t,e],r)=>[t*r,e*r],ct=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),fl=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function hl([t,e],[r,n]){return t*n-e*r}const pl=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),dl=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),Ft=([t,e])=>{const r=ct([t,e]);return[t/r,e/r]},vl=(t,e,r=[0,0])=>{const[n,o]=t,[i,u]=r,l=n-i,f=o-u,p=Math.sin(e),v=Math.cos(e),y=l*v-f*p,m=l*p+f*v;return[y+i,m+u]},pr=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},gl=([t,e])=>{const r=ct([t,e]),n=Math.atan2(e,t);return[r,n]};class Ee extends Ke{constructor(e){const r=I(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=I(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new Dr(r),this._boundingBox}get repr(){return`${this.geomType} ${Mr(this.firstPoint)} - ${Mr(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=I();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=Or(e.GetType());return e.delete(),r}clone(){return new Ee(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=I(),n=ve(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(Ve(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,ct(e,this.firstPoint),ct(e,this.lastPoint))}distanceFromCurve(e){const r=I(),n=ve();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return fn(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=I(),o=ve();let i,u;try{const l=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(Ve(e)),this.wrapped));i=l.LowerDistance(),u=l.LowerDistanceParameter()}catch{if(ze(e,this.firstPoint,r))return this.firstParameter;if(ze(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${Mr(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return u}tangentAt(e){const r=I(),[n,o]=Oe();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const u=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,u,l);const f=[l.X(),l.Y()];return o(),f}splitAt(e,r=1e-9){const n=I(),o=ve();let i=e.map(f=>fn(f)?this.parameter(f,r):f);i=Array.from(new Map(i.map(f=>[ul(f,-Math.log10(r)),f])).values()).sort((f,p)=>f-p);const u=this.firstParameter,l=this.lastParameter;return u>l&&i.reverse(),Math.abs(i[0]-u)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-l)<r*100&&(i=i.slice(0,-1)),i.length?cr([[u,...i],[...i,l]]).map(([f,p])=>{try{if(this.geomType==="BEZIER_CURVE"){const y=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return y.Segment(f,p),new Ee(new n.Handle_Geom2d_Curve_2(y))}if(this.geomType==="BSPLINE_CURVE"){const y=o(this.adaptor()).BSpline().get(),m=new n.Geom2d_BSplineCurve_1(y.Poles_2(),y.Knots_2(),y.Multiplicities_2(),y.Degree(),y.IsPeriodic());return m.Segment(f,p,r),new Ee(new n.Handle_Geom2d_Curve_2(m))}const v=new n.Geom2d_TrimmedCurve(this.wrapped,f,p,!0,!0);return new Ee(new n.Handle_Geom2d_Curve_2(v))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const Vi=(t,e=1e-4,r="C0",n=200)=>{const o=I(),i=ve(),u={C0:o.GeomAbs_Shape.GeomAbs_C0,C1:o.GeomAbs_Shape.GeomAbs_C1,C2:o.GeomAbs_Shape.GeomAbs_C2,C3:o.GeomAbs_Shape.GeomAbs_C3},l=i(new o.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,u[r],n,3));return new Ee(l.Curve())},Hi=t=>{if(Or(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=I(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const u=n.NbArcs();if(u)for(let l=1;l<=u;l++){const f=n.Arc(l);yield new Ee(f)}}const i=Array.from(o());return n.delete(),i};function dn(t,e={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=ve();return t.flatMap(n=>{const o=r(n.adaptor()),i=Or(o.GetType());if(i==="ELLIPSE"||i==="CIRCLE"&&ze(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(i))return n;if(i==="BEZIER_CURVE"){const f=o.Bezier().get().Degree();if([1,2,3].includes(f))return n}if(i==="BSPLINE_CURVE"){const l=Hi(o);return dn(l,e)}const u=Vi(o,e.tolerance,e.continuity,e.maxSegments);return dn(Hi(r(u.adaptor())),e)})}function*zi(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*ml(t){const e=t.NbSegments();if(!e)return;const r=I();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new Ee(o),i.delete()}}const Fr=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=I(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,u;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from(zi(o)),u=Array.from(ml(o))}catch(p){throw console.error(t,e,p),new Error("Intersections failed between curves")}finally{o.delete()}const l=u.filter(p=>ze(p.firstPoint,p.lastPoint,r)).map(p=>p.firstPoint);l.length&&(i.push(...l),u=u.filter(p=>!ze(p.firstPoint,p.lastPoint,r)));const f=u.flatMap(p=>[p.firstPoint,p.lastPoint]);return{intersections:i,commonSegments:u,commonSegmentsPoints:f}},yl=(t,e=1e-9)=>{const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from(zi(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},Lr=(t,e)=>{const r=I(),[n,o]=Oe(),i=n(new r.GCE2d_MakeSegment_1(n(Ve(t)),n(Ve(e)))).Value(),u=new Ee(i);return ze(u.firstPoint,t)||u.reverse(),o(),u},To=(t,e,r)=>{const n=I(),[o,i]=Oe(),u=o(new n.GCE2d_MakeArcOfCircle_4(o(Ve(t)),o(Ve(e)),o(Ve(r)))).Value();i();const l=new Ee(u);return ze(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},wl=(t,e,r)=>{const n=I(),[o,i]=Oe(),u=o(new n.GCE2d_MakeArcOfCircle_5(o(Ve(t)),o(Ni(e)),o(Ve(r)))).Value();i();const l=new Ee(u);return ze(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},bl=(t,e,r,n,o=[0,0],i,u=!0)=>{const l=I(),[f,p]=Oe(),v=f(new l.gp_Elips2d_2(f(fr(o,i)),t,e,!0)),y=f(new l.GCE2d_MakeArcOfEllipse_1(v,r,n,u)).Value();return p(),new Ee(y)},_l=(t,e,r)=>{const n=I(),[o,i]=Oe(),u=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));u.SetValue(1,o(Ve(t))),e.forEach((f,p)=>{u.SetValue(p+2,o(Ve(f)))}),u.SetValue(e.length+2,o(Ve(r)));const l=new n.Geom2d_BezierCurve_1(u);return i(),new Ee(new n.Handle_Geom2d_Curve_2(l))},Wi=(t,e,r)=>{const n=So(hr(t,e),.5),o=ct(r,t),i=Ft(_o(n,r));return To(t,hr(So(i,o),r),e)},Sl=(t,e,r)=>{const n=Ft(_o(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:hr(t,i),lastPoint:hr(e,i)}},Eo=(t,e)=>{const r=ve(),n=t.geomType;if(n==="CIRCLE"){const f=r(r(t.adaptor()).Circle()),p=f.Radius(),v=f.IsDirect()?1:-1,y=e*v,m=p+y;if(m<1e-10){const A=r(f.Location()),F=[A.X(),A.Y()],D=X=>{const[$,ie]=Ft(_o(X,F));return hr(X,[y*$,y*ie])};return{collapsed:!0,firstPoint:D(t.firstPoint),lastPoint:D(t.lastPoint)}}const S=I(),T=new S.gp_Circ2d_3(f.Axis(),m),x=new S.Geom2d_Circle_1(T),k=new S.Geom2d_TrimmedCurve(new S.Handle_Geom2d_Curve_2(x),t.firstParameter,t.lastParameter,!0,!0);return new Ee(new S.Handle_Geom2d_Curve_2(k))}if(n==="LINE"){const{firstPoint:f,lastPoint:p}=Sl(t.firstPoint,t.lastPoint,e);return Lr(f,p)}const o=I(),i=new Ee(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),u=Vi(i.adaptor());return yl(u).length?{collapsed:!0,firstPoint:u.firstPoint,lastPoint:u.lastPoint}:u};function $i(t,e,r){const n=hl(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,u=Eo(t,i),l=Eo(e,i);if(!(u instanceof Ee)||!(l instanceof Ee))return null;let f;try{const{intersections:S}=Fr(u,l,1e-9);f=S.at(-1)}catch{return null}if(!fn(f))return null;const p=f,v=(S,T)=>{const[x,k]=T.tangentAt(p),A=Ft([-k,x]),F=hr(p,So(A,i)),D=S.parameter(F,1e-6);return S.splitAt([D])},[y]=v(t,u),[,m]=v(e,l);return{first:y,second:m,center:p}}function xo(t,e,r){const n=$i(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:u}=n;return[o,Wi(o.lastPoint,i.firstPoint,u),i]}function ko(t,e,r){const n=$i(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,Lr(o.lastPoint,i.firstPoint),i]}class Tl{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let u=(i<<1)+1;const l=u+1;let f=this.ids[u],p=this.values[u];const v=this.values[l];if(l<this.length&&v<p&&(u=l,f=this.ids[l],p=v),p>=n)break;this.ids[i]=f,this.values[i]=p,i=u}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Yi=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Co=3;class Po{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==Co)throw new Error(`Got v${n>>4} data when expected v${Co}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Po(i,o,Yi[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,u=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),u+=i,this._levelBounds.push(u*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const l=Yi.indexOf(this.ArrayType),f=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+f+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Co<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new Tl}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let u=4*i;const l=this._boxes[u++],f=this._boxes[u++],p=this._boxes[u++],v=this._boxes[u++],y=Math.floor(o*((l+p)/2-this.minX)/e),m=Math.floor(o*((f+v)/2-this.minY)/r);n[i]=xl(y,m)}Ao(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,u=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;u<l;){const f=u;let p=1/0,v=1/0,y=-1/0,m=-1/0;for(let S=0;S<this.nodeSize&&u<l;S++)p=Math.min(p,this._boxes[u++]),v=Math.min(v,this._boxes[u++]),y=Math.max(y,this._boxes[u++]),m=Math.max(m,this._boxes[u++]);this._indices[this._pos>>2]=f,this._boxes[this._pos++]=p,this._boxes[this._pos++]=v,this._boxes[this._pos++]=y,this._boxes[this._pos++]=m}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const l=[],f=[];for(;u!==void 0;){const p=Math.min(u+this.nodeSize*4,ji(u,this._levelBounds));for(let v=u;v<p;v+=4){if(n<this._boxes[v]||o<this._boxes[v+1]||e>this._boxes[v+2]||r>this._boxes[v+3])continue;const y=this._indices[v>>2]|0;u<this.numItems*4?(i===void 0||i(y))&&f.push(y):l.push(y)}u=l.pop()}return f}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const l=this._queue,f=[],p=o*o;for(;u!==void 0;){const v=Math.min(u+this.nodeSize*4,ji(u,this._levelBounds));for(let y=u;y<v;y+=4){const m=this._indices[y>>2]|0,S=Xi(e,this._boxes[y],this._boxes[y+2]),T=Xi(r,this._boxes[y+1],this._boxes[y+3]),x=S*S+T*T;u<this.numItems*4?(i===void 0||i(m))&&l.push((m<<1)+1,x):l.push(m<<1,x)}for(;l.length&&l.peek()&1;)if(l.peekValue()>p||(f.push(l.pop()>>1),f.length===n))return l.clear(),f;u=l.pop()>>1}return l.clear(),f}}function Xi(t,e,r){return t<e?e-t:t<=r?0:t-r}function ji(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function Ao(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const u=t[n+o>>1];let l=n-1,f=o+1;for(;;){do l++;while(t[l]<u);do f--;while(t[f]>u);if(l>=f)break;El(t,e,r,l,f)}Ao(t,e,r,n,f,i),Ao(t,e,r,f+1,o,i)}function El(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const u=4*n,l=4*o,f=e[u],p=e[u+1],v=e[u+2],y=e[u+3];e[u]=e[l],e[u+1]=e[l+1],e[u+2]=e[l+2],e[u+3]=e[l+3],e[l]=f,e[l+1]=p,e[l+2]=v,e[l+3]=y;const m=r[n];r[n]=r[o],r[o]=m}function xl(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),u=r|n>>1,l=r>>1^r,f=o>>1^n&i>>1^o,p=r&o>>1^i>>1^i;r=u,n=l,o=f,i=p,u=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,f^=r&o>>2^n&i>>2,p^=n&o>>2^(r^n)&i>>2,r=u,n=l,o=f,i=p,u=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,f^=r&o>>4^n&i>>4,p^=n&o>>4^(r^n)&i>>4,r=u,n=l,o=f,i=p,f^=r&o>>8^n&i>>8,p^=n&o>>8^(r^n)&i>>8,r=f^f>>1,n=p^p>>1;let v=t^e,y=n|65535^(v|r);return v=(v|v<<8)&16711935,v=(v|v<<4)&252645135,v=(v|v<<2)&858993459,v=(v|v<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|v)>>>0}const qi=(t,e=1e-7)=>{const r=new Po(t.length);t.forEach(i=>{const[u,l]=i.firstPoint;r.add(u-e,l-e,u+e,l+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,u)=>{if(o.has(u))return;const l=[i];let f=u;o.add(u);let p=t.length;for(;;){if(p--<0)throw new Error("Infinite loop detected");const v=l[l.length-1].lastPoint,[y,m]=v,S=r.search(y-e,m-e,y+e,m+e),T=F=>Math.abs((f-F)%t.length),x=S.filter(F=>!o.has(F)).map(F=>[t[F],F,T(F)]).sort(([,,F],[,,D])=>T(F)-T(D));if(x.length===0){n.push(l);break}const[k,A]=x[0];l.push(k),o.add(A),f=A}}),n};function nt(t){return Math.round(t*1e5)/1e5}const Ro=t=>`${pn(t.X())} ${pn(t.Y())}`,kl=(t,e)=>{const r=I(),n=Or(t.GetType()),[o,i]=e,u=`${nt(o)} ${nt(i)}`;if(n==="LINE")return`L ${u}`;if(n==="BEZIER_CURVE"){const l=t.Bezier().get(),f=l.Degree();if(f===1)return`L ${u}`;if(f===2)return`Q ${Ro(l.Pole(2))} ${u}`;if(f===3){const p=Ro(l.Pole(2)),v=Ro(l.Pole(3));return`C ${p} ${v} ${u}`}}if(n==="CIRCLE"){const l=t.Circle(),f=l.Radius(),p=t.FirstParameter(),y=(t.LastParameter()-p)*Cr,m=y!==360?u:`${nt(o)} ${nt(i+1e-4)}`;return`A ${f} ${f} 0 ${Math.abs(y)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${m}`}if(n==="ELLIPSE"){const l=t.Ellipse(),f=l.MajorRadius(),p=l.MinorRadius(),v=t.FirstParameter(),m=(t.LastParameter()-v)*Cr,S=m!==360?u:`${nt(o)} ${nt(i+1e-4)}`,T=new r.gp_Dir2d_1,x=180-l.XAxis().Direction().Angle(T)*Cr;return T.delete(),`A ${nt(f)} ${nt(p)} ${nt(x)} ${Math.abs(m)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${S}`}throw new Error(`Unsupported curve type: ${n}`)},Cl={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},vn={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Zi{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Pl extends Ke{constructor(){const e=I();super(new e.Message_ProgressRange_1)}}class Oo extends Ke{constructor(e){const r=I();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(e.wrapped)}distanceTo(e){this.wrapped.LoadS2(e.wrapped);const r=new Pl;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class Ki extends Zi{when(e){return this.filters.push(e),this}inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new R(Cl[e]):n=new R(e);const o=({normal:i})=>{if(!i)return!1;const u=Math.acos(Math.abs(i.dot(n)));return Math.abs(u-rt*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=_n(r),o=new Oo(n),i=({element:u})=>Math.abs(o.distanceTo(u)-e)<1e-6;return this.filters.push(i),this}containsPoint(e){return this.atDistance(0,e)}withinDistance(e,r=[0,0,0]){const n=_n(r),o=new Oo(n),i=({element:u})=>o.distanceTo(u)-e<1e-6;return this.filters.push(i),this}inBox(e,r){const n=Ur(e,r);return this.inShape(n)}inShape(e){const r=new Oo(e),n=({element:o})=>r.distanceTo(o)<1e-6;return this.filters.push(n),this}}class gn extends Ki{clone(){const e=new gn;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&vn[e])return this.atAngleWith(vn[e],90);if(typeof e!="string"&&e instanceof Xe)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Xe?Dt(e):Dt(e,r);this.parallelTo(n);const o=({element:i})=>{const u=i.startPoint,l=u.projectToPlane(n);return u.equals(l)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class Mo extends Ki{clone(){const e=new Mo;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&vn[e])return this.atAngleWith(vn[e]);if(typeof e!="string"&&e instanceof Xe)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Xe?Dt(e):Dt(e,r);this.parallelTo(n);const o=({element:i})=>{const u=i.center,l=u.projectToPlane(n);return u.equals(l)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const Al=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},Do=2*Math.PI,Qi=t=>{const e=t%Do,r=e<0?e+Do:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-Do)};class mn extends Zi{clone(){const e=new mn;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>ze(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(ct(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return ze(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,u]=r,l=Math.min(n,i),f=Math.max(n,i),p=Math.min(o,u),v=Math.max(o,u);function y({element:m}){const[S,T]=m.point;return S>=l&&S<=f&&T>=p&&T<=v}return this.filters.push(y),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(Qi(pl(o,i))-Qi(rt*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return Al(e).filter(r=>this.shouldKeep(r))}}const Ji=t=>{const e=I();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},Rl=function*(e,r){const n=I(),o=new n.TopExp_Explorer_2(e,Ji(r),Ji("shape")),i=new Map;for(;o.More();){const u=o.Current(),l=u.HashCode(Li);i.get(l)||(i.set(l,!0),yield u),o.Next()}o.delete()},es=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class yn extends Ke{constructor(e){super(e)}clone(){return new this.constructor(Kt(this.wrapped))}get hashCode(){return this.wrapped.HashCode(Li)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=I(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=ye(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=ye(il(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=ye(ol(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=ye(sl(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=ye(al(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return Rl(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>Kt(r))}get edges(){return this._listTopo("edge").map(e=>new Lt(e))}get faces(){return this._listTopo("face").map(e=>new dr(e))}get wires(){return this._listTopo("wire").map(e=>new mt(e))}get boundingBox(){const e=new nl;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const u=[];for(const l of this.faces){const f=l.triangulation(o.length/3);if(!f)continue;const{trianglesIndexes:p,vertices:v,verticesNormals:y}=f;u.push({start:n.length,count:p.length,faceId:l.hashCode}),n=n.concat(p),o=o.concat(v),i=i.concat(y)}return{triangles:n,vertices:o,normals:i,faceGroups:u}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=ve(),i=new Set,u=[],l=[],f=()=>{const v=u.length;let y=null;return[m=>{y?(u.push(...y),y=[m.X(),m.Y(),m.Z()],u.push(...y)):y=[m.X(),m.Y(),m.Z()]},m=>{l.push({start:v/3,count:(u.length-v)/3,edgeId:m}),i.add(m)}]},p=o(new this.oc.TopLoc_Location_1);for(const v of this.faces){const y=o(this.oc.BRep_Tool.Triangulation(v.wrapped,p,0));if(y.IsNull())continue;const m=y.get();for(const S of v.edges){if(o(S),i.has(S.hashCode))continue;const T=o(new this.oc.TopLoc_Location_1),x=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(S.wrapped,y,T)),k=(n=x==null?void 0:x.get())==null?void 0:n.Nodes();if(!k)continue;o(k);const[A,F]=f();for(let D=k.Lower();D<=k.Upper();D++){const X=o(o(m.Node(k.Value(D))).Transformed(T.Transformation()));A(X)}F(S.hashCode)}}for(const v of this.edges){o(v);const y=v.hashCode;if(i.has(y))continue;const m=o(new this.oc.BRepAdaptor_Curve_2(v.wrapped)),S=o(new this.oc.GCPnts_TangentialDeflection_2(m,e,r,2,1e-9,1e-7)),[T,x]=f();for(let k=0;k<S.NbPoints();k++){const A=o(S.Value(k+1).Transformed(p.Transformation()));T(A)}x(y)}return{lines:u,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const u=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([u],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class ts extends yn{}class rs extends yn{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new Ol(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(e=0){return this.curve.tangentAt(e)}pointAt(e=0){return this.curve.pointAt(e)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Ol extends Ke{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return Or(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new R(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new R(e)}_mapParameter(e){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*e}pointAt(e=.5){return new R(this.wrapped.Value(this._mapParameter(e)))}tangentAt(e=.5){const r=this._mapParameter(e),n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new R(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Lt extends rs{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class mt extends rs{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=ye(o.Shape());if(o.delete(),this.delete(),!(i instanceof mt))throw new Error("Could not offset with a wire");return i}}class Ml extends Ke{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class dr extends yn{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Ml(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:u}=this.UVBounds,l=this._geomAdaptor(),f=new this.oc.gp_Pnt_1,p=e*(o-n)+n,v=r*(u-i)+i;l.D0(p,v,f);const y=new R(f);return l.delete(),f.delete(),y}normalAt(e){let r=0,n=0;const o=ve();if(e){const p=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),v=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(Qe(e)),p,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),y={current:0},m={current:0};v.LowerDistanceParameters(y,m),r=y.current,n=m.current}else{const{uMin:p,uMax:v,vMin:y,vMax:m}=this.UVBounds;r=.5*(p+v),n=.5*(y+m)}const i=o(new this.oc.gp_Pnt_1),u=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,u),new R(u)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new R(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new mt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=ve(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),u={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=o.get(),f=l.NbNodes();u.vertices=new Array(f*3);for(let T=1;T<=f;T++){const x=r(r(l.Node(T)).Transformed(i));u.vertices[(T-1)*3+0]=x.X(),u.vertices[(T-1)*3+1]=x.Y(),u.vertices[(T-1)*3+2]=x.Z()}const p=r(new this.oc.TColgp_Array1OfDir_2(1,f)),v=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,v,p),u.verticesNormals=new Array(p.Length()*3);for(let T=p.Lower();T<=p.Upper();T++){const x=r(r(p.Value(T)).Transformed(i));u.verticesNormals[(T-1)*3+0]=x.X(),u.verticesNormals[(T-1)*3+1]=x.Y(),u.verticesNormals[(T-1)*3+2]=x.Z()}const y=this.orientation,m=l.NbTriangles();u.trianglesIndexes=new Array(m*3);let S=0;for(let T=1;T<=m;T++){const x=r(l.Triangle(T));let k=x.Value(1),A=x.Value(2);const F=x.Value(3);if(y==="backward"){const D=k;k=A,A=D}u.trianglesIndexes[S*3+0]=k-1+e,u.trianglesIndexes[S*3+1]=A-1+e,u.trianglesIndexes[S*3+2]=F-1+e,S++}return u}}class wn extends yn{fuse(e,{optimisation:r="none"}={}){const n=ve(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const u=ye(i.Shape());if(!yt(u))throw new Error("Could not fuse as a 3d shape");return u}cut(e,{optimisation:r="none"}={}){const n=ve(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const u=ye(i.Shape());if(!yt(u))throw new Error("Could not cut as a 3d shape");return u}intersect(e){const r=ve(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=ye(o.Shape());if(!yt(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,u;if(typeof e=="number"){u=e;const S=new Mo;i=typeof r=="function"?r(S):S}else u=e.thickness,i=e.filter;const l=ve(),f=i.find(this),p=l(new this.oc.TopTools_ListOfShape_1);f.forEach(S=>{p.Append_1(S.wrapped)});const v=l(new this.oc.Message_ProgressRange_1),y=l(new this.oc.BRepOffsetAPI_MakeThickSolid);y.MakeThickSolidByJoin(this.wrapped,p,-u,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,v);const m=ye(y.Shape());if(!yt(m))throw new Error("Could not shell as a 3d shape");return m}_builderIter(e,r){if(typeof e=="number"){let u=0;for(const l of this._iterTopo("edge"))r(e,Kt(l)),u+=1;return u}let n,o=null;typeof e=="function"?n=e:(n=u=>e.filter.shouldKeep(u)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const u of this._iterTopo("edge")){const l=Kt(u),f=new Lt(l),p=n(f);p&&(r(p,l),i+=1),f.delete()}return o&&o(),i}fillet(e,r){const o=ve()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new gn)}),!this._builderIter(i,(f,p)=>o.Add_2(f,p)))throw new Error("Could not fillet, no edge was selected");const l=ye(o.Shape());if(!yt(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const o=ve()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new gn)}),!this._builderIter(i,(f,p)=>o.Add_2(f,p)))throw new Error("Could not chamfer, no edge was selected");const l=ye(o.Shape());if(!yt(l))throw new Error("Could not chamfer as a 3d shape");return l}}class ns extends wn{}class Zt extends wn{}class os extends wn{}class is extends wn{}function yt(t){return t instanceof ns||t instanceof Zt||t instanceof os||t instanceof is}function ss(t){return t instanceof mt}function Kt(t){const e=I(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=es(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function ye(t){const r=I().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,ts],[r.TopAbs_EDGE,Lt],[r.TopAbs_WIRE,mt],[r.TopAbs_FACE,dr],[r.TopAbs_SHELL,ns],[r.TopAbs_SOLID,Zt],[r.TopAbs_COMPSOLID,os],[r.TopAbs_COMPOUND,is]]).get(es(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(Kt(t))}const as=(t,e)=>{const r=I();return new Lt(new r.BRepBuilderAPI_MakeEdge_3(Qe(t),Qe(e)).Edge())},Dl=(t,e=[0,0,0],r=[0,0,1])=>{const n=I(),[o,i]=Oe(),u=o(Ar(e,r)),l=o(new n.gp_Circ_2(u,t)),f=o(new n.BRepBuilderAPI_MakeEdge_8(l)),p=new Lt(f.Edge());return i(),p},Fl=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const u=I(),[l,f]=Oe();let p=2*Math.PI;i&&(p=-2*Math.PI);const v=l(new u.Geom2d_Line_3(l(new u.gp_Pnt2d_3(0,0)),l(new u.gp_Dir2d_4(p,t)))),y=e/t,m=v.Value(0),S=v.Value(y*Math.sqrt((2*Math.PI)**2+t**2)),T=l(new u.GCE2d_MakeSegment_1(m,S)),x=new u.Geom_CylindricalSurface_1(l(Pr(n,o)),r),k=l(new u.BRepBuilderAPI_MakeEdge_30(l(new u.Handle_Geom2d_Curve_2(T.Value().get())),l(new u.Handle_Geom_Surface_2(x)))).Edge(),A=l(new u.BRepBuilderAPI_MakeWire_2(k)).Wire();return u.BRepLib.BuildCurves3d_2(A),f(),new mt(A)},Br=t=>{const e=I(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(u=>{u instanceof Lt&&r.Add_1(u.wrapped),u instanceof mt&&r.Add_2(u.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const u=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${u.get(o)||"unknown error"}`)}const i=new mt(r.Wire());return r.delete(),n.delete(),i},bn=(t,e)=>{const r=I(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new dr(o)},Ll=(t,e)=>{const r=I(),[n,o]=Oe(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new dr(l)},us=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=I(),i=Ar(r,n),u=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),l=new Zt(u.Shape());return i.delete(),u.delete(),l},Bl=t=>{const e=I(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new Zt(r.Shape());return r.delete(),n};class Ul extends Ke{constructor(e,r,n){const o=I(),i=ve(),u=Math.sqrt(e*r/n),l=e/u,f=r/u,p=new o.gp_GTrsf_1;p.SetAffinity_1(Rr([0,0,0],[0,1,0]),l);const v=i(new o.gp_GTrsf_1);v.SetAffinity_1(Rr([0,0,0],[0,0,1]),u);const y=i(new o.gp_GTrsf_1);y.SetAffinity_1(Rr([0,0,0],[1,0,0]),f),p.Multiply(v),p.Multiply(y),super(p)}applyToPoint(e){const r=I(),o=ve()(e.XYZ());return this.wrapped.Transforms_1(o),new r.gp_Pnt_2(o)}}function Il(t){const e=[];for(let r=t.LowerRow();r<=t.UpperRow();r++){const n=[];e.push(n);for(let o=t.LowerCol();o<=t.UpperCol();o++){const i=t.Value(r,o);n.push(i)}}return e}const Gl=(t,e,r)=>{const n=I(),o=ve(),i=o(new n.gp_Sphere_1);i.SetRadius(1);const u=o(new n.Geom_SphericalSurface_2(i)),l=n.GeomConvert.SurfaceToBSplineSurface(u.UReversed()).get(),f=Il(l.Poles_2()),p=new Ul(t,e,r);f.forEach((y,m)=>{y.forEach((S,T)=>{const x=p.applyToPoint(S);l.SetPole_1(m+1,T+1,x)})});const v=ye(o(new n.BRepBuilderAPI_MakeShell_2(l.UReversed(),!1)).Shell());return Fo([v])},Ur=(t,e)=>{const r=I(),n=new r.BRepPrimAPI_MakeBox_4(Qe(t),Qe(e)),o=new Zt(n.Solid());return n.delete(),o},_n=t=>{const e=I(),r=Qe(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new ts(o)},wt=t=>{const e=I(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),ye(n)};function Nl(t){const e=I(),r=ve(),n=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return t.forEach(({wrapped:o})=>{n.Add(o)}),n.Perform(r(new e.Message_ProgressRange_1)),ye(Kt(n.SewedShape()))}function Fo(t){const e=ve(),r=I(),n=Nl(t),o=ye(e(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(o instanceof Zt))throw new Error("Could not make a solid of faces and shells");return o}const ls=(t,e)=>{const r=I(),[n,o]=Oe(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(p=>{i.Add(p.wrapped)});const u=n(i.Face()),l=n(new r.ShapeFix_Face_2(u));l.FixOrientation_1();const f=l.Face();return o(),new dr(f)},Vl=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Hl=t=>{let e;t?Vl(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let u;typeof r=="number"?u=pr(1,r*rt):u=r;let l;return typeof i=="number"?l=pr(1,i*rt):l=i,{endTangent:u,startFactor:n,endFactor:o,startTangent:l}};function cs(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let u=Math.acos(o/i);return t*n-e*r<0&&(u=-u),u}function zl([t,e],[r,n],o,i,u,l,f){const p=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const v=Math.sin(u),y=Math.cos(u),m=(t-r)/2,S=(e-n)/2,T=(t+r)/2,x=(e+n)/2,k=y*m+v*S,A=y*S-v*m,F=k*k/(o*o)+A*A/(i*i);F>1&&(o=o*Math.sqrt(F),i=i*Math.sqrt(F));const D=o*i,X=o*A,$=i*k,ie=X*X+$*$;if(!ie)throw Error("start point can not be same as end point");let oe=Math.sqrt(Math.abs((D*D-ie)/ie));l==f&&(oe=-oe);const re=oe*X/i,he=-oe*$/o,Re=y*re-v*he+T,Be=v*re+y*he+x,we=(k-re)/o,pe=(k+re)/o,J=(A-he)/i,be=(A+he)/i,Te=cs(1,0,we,J);let fe=cs(we,J,-pe,-be);for(;fe>p;)fe-=p;for(;fe<0;)fe+=p;f||(fe-=p);let me=Te+fe;for(;me>p;)me-=p;for(;me<0;)me+=p;return{cx:Re,cy:Be,startAngle:Te,deltaAngle:fe,endAngle:me,clockwise:!!f,rx:o,ry:i}}const fs=(t,e)=>{const r=I(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new Zt(Kt(n.Shape()));return n.delete(),o},hs=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=I(),i=Rr(e,r),u=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*rt,!1),l=ye(u.Shape());if(i.delete(),u.delete(),!yt(l))throw new Error("Could not revolve to a 3d shape");return l};function Ir(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:u,support:l,forceProfileSpineOthogonality:f}={},p=!1){const v=I(),y=i==="round"?!0:!!f,m=new v.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const x={transformed:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:v.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];x&&m.SetTransitionMode(x)}l?m.SetMode_4(l):r&&m.SetMode_1(r),n&&m.SetMode_5(n.wrapped,!1,v.BRepFill_TypeOfContact.BRepFill_NoContact),o?m.SetLaw_1(t.wrapped,o,!!u,y):m.Add_1(t.wrapped,!!u,y);const S=new v.Message_ProgressRange_1;m.Build(S),p||m.MakeSolid();const T=ye(m.Shape());if(!yt(T))throw new Error("Could not sweep to a 3d shape");if(p){const x=ye(m.FirstShape()),k=ye(m.LastShape());if(!ss(x))throw new Error("Could not sweep with one start wire");if(!ss(k))throw new Error("Could not sweep with one end wire");return m.delete(),[T,x,k]}return m.delete(),S.delete(),T}const ps=(t,{profile:e,endFactor:r=1})=>{let n;const o=I();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function ds(t,e,r,n,o=!1){const i=new R(e),u=new R(r),l=as(i,i.add(u)),f=Br([l]),p=n?ps(u.Length,n):null;return o?Ir(t,f,{law:p},o):Ir(t,f,{law:p},o)}function vs(t,e,r,n,o,i=!1){const u=new R(r),l=new R(n),f=as(u,u.add(l)),p=Br([f]),v=360/e*l.Length,y=1,m=Fl(v,l.Length,y,r,n),S=o?ps(l.Length,o):null;return i?Ir(t,p,{auxiliarySpine:m,law:S},i):Ir(t,p,{auxiliarySpine:m,law:S},i)}const Wl=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=I(),[u,l]=Oe(),f=u(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&f.AddVertex(u(_n(r)).wrapped),t.forEach(y=>f.AddWire(y.wrapped)),n&&f.AddVertex(u(_n(n)).wrapped);const p=u(new i.Message_ProgressRange_1);f.Build(p);const v=ye(f.Shape());if(l(),!yt(v))throw new Error("Could not loft to a 3d shape");return v};class vr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new vr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new R(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new R(e)}face(){let e;return this.baseFace?e=Ll(this.baseFace,this.wire):e=bn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=bn(this.wire),o=hs(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[u,l]=Oe(),f=u(new R(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const y=ds(this.wire,i||this.defaultOrigin,f,n);return l(),this.delete(),y}if(o){const y=vs(this.wire,o,i||this.defaultOrigin,f,n);return l(),this.delete(),y}const p=bn(this.wire),v=fs(p,f);return l(),this.delete(),v}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),u=e(new Xe(n,i,o),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const f=Ir(u.wire,this.wire,l);return this.delete(),f}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=Wl(o.map(u=>u.wire),r,n);return o.forEach(u=>u.delete()),i}}const $l=t=>{const e=I(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new Dr(r)};function Yl(t,e){const[r,n]=Oe(),o=r(Ar(e.origin,e.zDir,e.xDir)),i=I(),u=t.map(l=>{const f=i.GeomLib.To3d(o,l.wrapped);return new Lt(new i.BRepBuilderAPI_MakeEdge_24(f).Edge())});return n(),u}const Xl=(t,e)=>{const[r,n]=Oe(),o=I(),i=t.map(u=>{const l=r(new o.BRepBuilderAPI_MakeEdge_30(u.wrapped,e));return new Lt(l.Edge())});return n(),i},gs=(t,e)=>{const r=I();return t.map(o=>e?new Ee(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class Gr extends Ke{transformCurves(e){return gs(e,this.wrapped)}}const ms=(t,e,r=[0,0])=>{const n=I(),o=fr(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new Gr(i)},jl=t=>{const e=I(),[r,n]=Oe(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(Ni(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new Gr(i)},ql=(t,e=[0,0],r="center")=>{const n=I(),[o,i]=Oe(),u=new n.gp_Trsf2d_1;r==="center"?u.SetMirror_1(o(Ve(t))):u.SetMirror_2(o(fr(e,t)));const l=new n.gp_GTrsf2d_2(u);return i(),new Gr(l)},Zl=(t,e=[0,0])=>{const r=I(),[n,o]=Oe(),i=new r.gp_Trsf2d_1;i.SetRotation(n(Ve(e)),t);const u=new r.gp_GTrsf2d_2(i);return o(),new Gr(u)},Kl=(t,e=[0,0])=>{const r=I(),[n,o]=Oe(),i=new r.gp_Trsf2d_1;i.SetScale(n(Ve(e)),t);const u=new r.gp_GTrsf2d_2(i);return o(),new Gr(u)};function Ql(t,e,r="original"){const[n,o]=Oe(),i=I();let u=n(i.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let f=null;const p=n(fr([0,0],[0,1])),v=n(fr([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const S=n(u.get().Cylinder());S.Direct()||(u=u.get().UReversed());const T=S.Radius();f=ms(1/T,[0,1]).wrapped}if(r==="bounds"){if(f=n(new i.gp_GTrsf2d_1),f.SetAffinity(p,l.uMax-l.uMin),l.uMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(new i.gp_XY_2(0,-l.uMin)),f.Multiply(T)}const S=n(new i.gp_GTrsf2d_1);if(S.SetAffinity(v,l.vMax-l.vMin),f.Multiply(S),l.vMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(n(new i.gp_XY_2(0,-l.vMin))),f.Multiply(T)}}const y=gs(t,f),m=Xl(y,u);return o(),m}function Jl(t,e){const r=I(),o=ve()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),i=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&i.Reverse(),new Ee(new r.Handle_Geom2d_Curve_2(i))}const Sn=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},Lo=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${Sn(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class ee{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new ee(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=$l(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=ms(e,r,n).transformCurves(this.curves);return new ee(o)}scale(e,r){const n=r||this.boundingBox.center,o=Kl(e,n).transformCurves(this.curves);return new ee(o)}rotate(e,r){const n=Zl(e*rt,r).transformCurves(this.curves);return new ee(n)}translate(e,r=0){const n=fn(e)?e:[e,r],o=jl(n).transformCurves(this.curves);return new ee(o)}mirror(e,r=[0,0],n="center"){const o=ql(e,r,n).transformCurves(this.curves);return new ee(o)}sketchOnPlane(e,r){const n=e instanceof Xe?Dt(e):Dt(e,r),o=Yl(this.curves,n),i=Br(o);return new vr(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=I(),o=Ql(this.curves,e,r),i=Br(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const u=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);u.FixEdgeCurves(),u.delete();const l=new vr(i);if(i.isClosed){const f=l.clone().face();l.defaultOrigin=f.pointOnSurface(.5,.5),l.defaultDirection=f.normalAt(),f.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const f=i.startPoint;l.defaultOrigin=f,l.defaultDirection=e.normalAt(f),l.baseFace=e}return l}toSVGPathD(){const e=ve(),r=this.clone().mirror([1,0],[0,0],"plane"),o=dn(r.curves).flatMap(l=>kl(e(l.adaptor()),l.lastPoint)),[i,u]=r.curves[0].firstPoint;return`M ${nt(i)} ${nt(u)} ${o.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return Sn(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return Lo(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1,o=Lr(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,l.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return ze(this.firstPoint,this.lastPoint)}intersects(e){const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class ec{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?ko:xo;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=Lr(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*rt,o=pr(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*rt,[o,i]=pr(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=Ft(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(To(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,u]=this.pointer;return this.threePointsArcTo([i+e,u+r],[i+n,u+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,u]=e,l=[(n+i)/2,(o+u)/2],f=[-(u-o),i-n],p=Math.sqrt(f[0]**2+f[1]**2),v=[l[0]+f[0]/p*r,l[1]+f[1]/p*r];return this.saveCurve(To(this._convertToUV(this.pointer),this._convertToUV(v),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=ct(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(wl(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,u=!1){let l=o,f=r,p=n;r<n&&(l=o+90,f=n,p=r);const v=l*rt,y=re=>ct(this._convertToUV(re)),m=y(pr(f,v)),S=y(pr(p,v+Math.PI/2)),T=Ft(this._convertToUV(vl([1,0],v))),[,x]=gl(T),{cx:k,cy:A,startAngle:F,endAngle:D,clockwise:X,rx:$,ry:ie}=zl(this._convertToUV(this.pointer),this._convertToUV(e),m,S,x,i,u),oe=bl($,ie,X?F:D,X?D:F,[k,A],T);return X||oe.reverse(),this.saveCurve(oe),this.pointer=e,this}ellipse(e,r,n,o,i=0,u=!1,l=!1){const[f,p]=this.pointer;return this.ellipseTo([e+f,r+p],n,o,i,u,l)}halfEllipseTo(e,r,n=!1){const o=dl(e,this.pointer),i=ct(e,this.pointer);return this.ellipseTo(e,i/2,r,o*Cr,!0,n)}halfEllipse(e,r,n,o=!1){const[i,u]=this.pointer;return this.halfEllipseTo([i+e,u+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(_l(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:u}=Hl(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,f=ct(this.pointer,e)*.25;let p;o?p=o:l?p=this._convertFromUV(l.tangentAt(1)):p=[1,0],p=Ft(p);const v=[this.pointer[0]+p[0]*i*f,this.pointer[1]+p[1]*i*f];let y;n==="symmetric"?y=[-p[0],-p[1]]:y=n,y=Ft(y);const m=[e[0]-y[0]*u*f,e[1]-y[1]*u*f];return this.cubicBezierCurveTo(e,v,m)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?ko:xo;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){ze(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(ze(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=fr(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new Ee(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class tc extends ec{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new ee(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const rc=t=>{const e=I(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,u)=>{i.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,u===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=ye(r.Shape());if(r.delete(),!(o instanceof dr))throw new Error("Failed to create a face");return o},nc=(t,e)=>{const r=I(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},ys=t=>{let e,r;try{e=bn(t[0]),r=t.slice(1)}catch{e=rc(t),r=t.slice(1).map(o=>nc(o,e))}return ls(e,r)},ws=(t,e)=>{const r=[],n=[],o=[];t.forEach(f=>{const[p,v,y]=e(f);r.push(p),n.push(v),o.push(y)});const i=ys(n),u=ys(o);return Fo([i,...r,u])};class bs{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return wt(e)}face(){const e=this.outerSketch.face();return ls(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const u=new R(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?ws(this.sketches,p=>ds(p.wire,i||this.outerSketch.defaultOrigin,u,n,!0)):o?ws(this.sketches,p=>vs(p.wire,o,i||this.outerSketch.defaultOrigin,u,n,!0)):fs(this.face(),u)}revolve(e,{origin:r}={}){return hs(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,u)=>{const l=e.sketches[u];return i.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),Fo(n)}}class ce{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new ce(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Dr;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new ce(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new ce(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new ce(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new ce(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new ce(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new bs(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new bs(n)}toSVGViewBox(e=1){return Sn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return Lo(this.toSVGGroup(),this.boundingBox,e)}}class _s{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof vr?r.wire:r.wires);return wt(e)}faces(){const e=this.sketches.map(r=>r.face());return wt(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return wt(n)}revolve(e,r){return wt(this.sketches.map(n=>n.revolve(e,r)))}}class j{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new j(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Dr;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new j(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new j(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new j(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new j(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new j(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new _s(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new _s(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return Sn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof ee?n.toSVGPath():n.toSVGGroup());return Lo(r.join(`
    `),this.boundingBox,e)}}const oc=t=>{const e=t.map((o,i)=>t.slice(i+1).map((u,l)=>[l+i+1,u]).filter(([,u])=>!o.boundingBox.isOut(u.boundingBox)).map(([u])=>u)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let u=n[i];u||(u=[],r.push(u)),u.push(t[i]),o.length&&o.forEach(l=>{n[l]=u})}),r},Ss=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((u,l)=>r===l?!1:u.isInside(o));return{blueprint:e,isIn:i}}),ic=(t,e)=>t.flatMap(({blueprint:r})=>Bo(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),sc=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=Bo(Ss(t.map(({blueprint:o})=>o)));return[r,...n]},Bo=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?ic(e,t):sc(r,t)},Nr=t=>{const e=oc(t).map(Ss);return new j(e.flatMap(Bo).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new ce(r.map(({blueprint:n})=>n)))))},ac=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let i=Math.min(n,t/2),u=Math.min(o,e/2);const l=i&&u;l||(i=0,u=0);const f=i===u,p=new tc([Math.min(0,-(t/2-i)),-e/2]),v=(y,m)=>{l&&(f?p.tangentArc(y,m):p.ellipse(y,m,i,u,0,!1,!0))};return i<t/2&&p.hLine(t-2*i),v(i,u),u<e/2&&p.vLine(e-2*u),v(-i,u),i<t/2&&p.hLine(-(t-2*i)),v(-i,-u),u<e/2&&p.vLine(-(e-2*u)),v(i,-u),p.close()},Tn=1e-9,We=(t,e)=>ze(t,e,Tn),Vr=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},Ts=(t,e)=>{const r=t.findIndex(i=>We(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},Es=(t,e)=>{const r=u=>We(e.firstPoint,u.firstPoint)&&We(e.lastPoint,u.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Io(t),n=t.findIndex(r),n===-1))throw console.error(t.map(u=>u.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*xs(t,e,r){const n=u=>!!e.find(l=>We(l,u.lastPoint)),o=u=>!!r.find(l=>We(l.firstPoint,u.firstPoint)&&We(l.lastPoint,u.lastPoint)||We(l.firstPoint,u.lastPoint)&&We(l.lastPoint,u.firstPoint));let i=[];for(const u of t)n(u)?(i.push(u),yield i,i=[]):o(u)?(i.length&&(yield i,i=[]),yield[u]):i.push(u);i.length&&(yield i)}const uc=t=>t[0].firstPoint,Uo=t=>t[t.length-1].lastPoint,Io=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),lc=t=>(t.reverse(),t.map(Io));function cc(t,e,r){return t.filter(n=>{const o=e.filter(l=>We(l.firstPoint,n)||We(l.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(l=>r.isInside(Vr(l)));return!(i.every(l=>l)||!i.some(l=>l))})}function fc(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((m,S)=>{e.curves.forEach((T,x)=>{const{intersections:k,commonSegments:A,commonSegmentsPoints:F}=Fr(m,T,Tn/100);r.push(...k),o[S].push(...k),i[x].push(...k),n.push(...A),r.push(...F),o[S].push(...F),i[x].push(...F)})}),r=Gi(r,Tn),!r.length||r.length===1)return null;const u=([m,S])=>S.length?m.splitAt(S,Tn/100):[m];let l=cr([t.curves,o]).flatMap(u),f=cr([e.curves,i]).flatMap(u);const p=n.map(m=>[m.firstPoint,m.lastPoint]);if(r=cc(r,l,e),!r.length&&!n.length)return null;if(n.length){const m=n[0];l=Es(l,m),f=Es(f,m)}else{const m=r[0];l=Ts(l,m),f=Ts(f,m)}const v=Array.from(xs(l,r,n));let y=Array.from(xs(f,r,n));return(!We(Uo(y[0]),Uo(v[0]))||n.length>0&&y[0].length!==1)&&(y=lc(y)),cr([v,y]).map(([m,S])=>{const T=uc(m),x=Uo(m);return p.find(([k,A])=>We(k,T)&&We(A,x)||We(k,x)&&We(k,T))?[m,"same"]:[m,S]})}const hc=t=>{const e=t.map(u=>u.firstPoint);let r=t.map(u=>u.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=cr([e,r]).map(([u,l],f)=>We(u,l)?null:f).filter(u=>u!==null);if(!n.length)return[t];const o=cr([n.slice(0,-1),n.slice(1)]).map(([u,l])=>t.slice(u,l));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function Go(t,e,{firstInside:r,secondInside:n}){const o=fc(t,e);if(!o){const p=Vr(t.curves[0]),v=e.isInside(p),y=Vr(e.curves[0]),m=t.isInside(y);return{identical:!1,firstCurveInSecond:v,secondCurveInFirst:m}}if(o.every(([,p])=>p==="same"))return{identical:!0};let i=null,u=null;const l=o.flatMap(([p,v])=>{let y=[],m=0;if(v==="same")return u===1?(u=1,[...p]):u===2||u===0?(u=null,[]):u===null?(i?i=[...i,...p]:i=p,[]):(console.error("weird situation"),[]);const S=Vr(p[0]),T=e.isInside(S);(r==="keep"&&T||r==="remove"&&!T)&&(m+=1,y.push(...p));const x=Vr(v[0]),k=t.isInside(x);if(n==="keep"&&k||n==="remove"&&!k){let A=v;m===1&&(A=Io(v)),m+=1,y.push(...A)}return u===null&&m===1&&i&&(y=[...i,...y]),m===1&&(u=m,i=null),y}),f=hc(l).filter(p=>p.length).map(p=>new ee(p));return f.length===0?null:f.length===1?f[0]:Nr(f)}const En=(t,e)=>{const r=Go(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof ee||r instanceof j?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new j([t,e])},Hr=(t,e)=>{const r=Go(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof ee||r instanceof j?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new j([new ce([t,e])]):t.clone()},No=(t,e)=>{const r=Go(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof ee||r instanceof j?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},Vo=(t,e)=>{if(t instanceof ee&&e instanceof ee){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:u}=Fr(n,o);r.push(...i),r.push(...u)})}),r=Gi(r),r.length>1}if(t instanceof ce||t instanceof j)return t.blueprints.some(r=>Vo(r,e));if(e instanceof ce||e instanceof j)return e.blueprints.some(r=>Vo(t,r));throw new Error("Bug in the generic intersects algorithm")},pc=(t,e)=>{if(t instanceof ce){if(e instanceof ee)return xn(e,t);if(e instanceof ce)return kn(t,e)}if(e instanceof ce){if(t instanceof ee)return xn(t,e);if(t instanceof ce)return kn(t,e)}if(t instanceof ee&&e instanceof ee)return En(t,e);throw new Error("Bug in the generic fuse algorithm")},ks=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((u,l)=>{const f=i.current,p=o+l+1;if(i.fusedWith.has(p))return;let v=u,y=!1;if(e.has(p)&&(v=e.get(p).current,y=!0),f.boundingBox.isOut(v.boundingBox)||!Vo(f,v))return;let m;if(f instanceof j||v instanceof j?m=_t(f,v):m=pc(f,v),!(m instanceof ee||m instanceof ce)){if(m instanceof j&&m.blueprints.length===2)return;if(m instanceof j&&m.blueprints.length===1)m=m.blueprints[0];else if(!(m instanceof j))throw console.error(m),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(p),i.current=m,y||e.set(p,i)})}),Nr(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>bt(n)))},bt=t=>t instanceof ee?[t]:t instanceof ce?t.blueprints:t instanceof j?t.blueprints.flatMap(e=>bt(e)):[],xn=(t,e)=>{const r=En(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>Hr(o,t));return Nr([...bt(r),...n.flatMap(o=>bt(o))])};function dc(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const kn=(t,e)=>{const r=En(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(u=>Hr(u,t.blueprints[0])),o=t.blueprints.slice(1).map(u=>Hr(u,e.blueprints[0])),i=dc(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([u,l])=>bt(No(u,l)));return Nr([...bt(r),...n.flatMap(u=>bt(u)),...o.flatMap(u=>bt(u)),...i])},_t=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof j)&&e instanceof j)return ks([t,...e.blueprints]);if(!(e instanceof j)&&t instanceof j)return ks([e,...t.blueprints]);if(t instanceof j&&e instanceof j){let r=_t(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=_t(n,r)}),r}if(t instanceof ce){if(e instanceof j)return _t(e,t);if(e instanceof ee)return xn(e,t);if(e instanceof ce)return kn(t,e)}if(e instanceof ce){if(t instanceof j)return _t(t,e);if(t instanceof ee)return xn(t,e);if(t instanceof ce)return kn(t,e)}return t instanceof ee&&e instanceof ee?En(t,e):null},Cn=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof j?r.blueprints:r);return e.length===1?e[0]:new j(e)},Bt=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof j)return Cn(t.blueprints.map(n=>Bt(n,e)));if(t instanceof ce){const n=t.blueprints[0];if(e instanceof ee&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=_t(e,new j(t.blueprints.slice(1)));return Nr([n,...bt(o)])}else{let o=Bt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=Bt(o,i)}),o}}if(e instanceof j)return Cn(e.blueprints.map(n=>Bt(t,n)));if(e instanceof ce){let n=Hr(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=_t(n,No(o,t))}),n}return Hr(t,e)};function zr(t,e){if(t===null||e===null)return null;if(t instanceof ee&&e instanceof ee)return No(t,e);if(t instanceof j)return Cn(t.blueprints.map(r=>zr(r,e)));if(t instanceof ce){const r=t.blueprints[0],n=t.blueprints[1];return Bt(zr(r,e),n)}if(e instanceof j)return Cn(e.blueprints.map(r=>zr(t,r)));if(e instanceof ce){const r=e.blueprints[0],n=e.blueprints[1];return Bt(zr(r,t),n)}throw new Error("intersct 2D algorithm error")}const Cs=(t,e={})=>{const r=e.plane instanceof Xe?Dt(e.plane):Dt(e.plane,e.origin),n=Br([Dl(t,r.origin,r.zDir)]),o=new vr(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var u=n.charCodeAt(i),l;return u>=55296&&u<=56319&&o>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(u-55296)*1024+l-56320+65536:u}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function Ps(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var vc=new Ps,gc=new Ps,As=new Uint8Array(30),Rs=new Uint16Array(30),mc=new Uint8Array(30),yc=new Uint16Array(30);function Os(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function wc(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}wc(vc,gc),Os(As,Rs,4,3),Os(mc,yc,2,1),As[28]=0,Rs[28]=258;function gr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function Ut(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Ut.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Ut.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},Ut.prototype.addX=function(t){this.addPoint(t,null)},Ut.prototype.addY=function(t){this.addPoint(null,t)},Ut.prototype.addBezier=function(t,e,r,n,o,i,u,l){var f=[t,e],p=[r,n],v=[o,i],y=[u,l];this.addPoint(t,e),this.addPoint(u,l);for(var m=0;m<=1;m++){var S=6*f[m]-12*p[m]+6*v[m],T=-3*f[m]+9*p[m]-9*v[m]+3*y[m],x=3*p[m]-3*f[m];if(T===0){if(S===0)continue;var k=-x/S;0<k&&k<1&&(m===0&&this.addX(gr(f[m],p[m],v[m],y[m],k)),m===1&&this.addY(gr(f[m],p[m],v[m],y[m],k)));continue}var A=Math.pow(S,2)-4*x*T;if(!(A<0)){var F=(-S+Math.sqrt(A))/(2*T);0<F&&F<1&&(m===0&&this.addX(gr(f[m],p[m],v[m],y[m],F)),m===1&&this.addY(gr(f[m],p[m],v[m],y[m],F)));var D=(-S-Math.sqrt(A))/(2*T);0<D&&D<1&&(m===0&&this.addX(gr(f[m],p[m],v[m],y[m],D)),m===1&&this.addY(gr(f[m],p[m],v[m],y[m],D)))}}},Ut.prototype.addQuad=function(t,e,r,n,o,i){var u=t+.6666666666666666*(r-t),l=e+2/3*(n-e),f=u+1/3*(o-t),p=l+1/3*(i-e);this.addBezier(t,e,u,l,f,p,o,i)};function Le(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Le.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},Le.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},Le.prototype.curveTo=Le.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})},Le.prototype.quadTo=Le.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})},Le.prototype.close=Le.prototype.closePath=function(){this.commands.push({type:"Z"})},Le.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof Ut){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)},Le.prototype.getBoundingBox=function(){for(var t=new Ut,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var u=this.commands[i];switch(u.type){case"M":t.addPoint(u.x,u.y),e=n=u.x,r=o=u.y;break;case"L":t.addPoint(u.x,u.y),n=u.x,o=u.y;break;case"Q":t.addQuad(n,o,u.x1,u.y1,u.x,u.y),n=u.x,o=u.y;break;case"C":t.addBezier(n,o,u.x1,u.y1,u.x2,u.y2,u.x,u.y),n=u.x,o=u.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+u.type)}}return t.isEmpty()&&t.addPoint(0,0),t},Le.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},Le.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(t)}function r(){for(var u=arguments,l="",f=0;f<arguments.length;f+=1){var p=u[f];p>=0&&f>0&&(l+=" "),l+=e(p)}return l}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n},Le.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Le.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function Ms(t){throw new Error(t)}function Ds(t,e){t||Ms(e)}var q={fail:Ms,argument:Ds,assert:Ds},Fs=32768,Ls=2147483648,mr={},N={},Y={};function ot(t){return function(){return t}}N.BYTE=function(t){return q.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},Y.BYTE=ot(1),N.CHAR=function(t){return[t.charCodeAt(0)]},Y.CHAR=ot(1),N.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e},Y.CHARARRAY=function(t){return typeof t>"u"?0:t.length},N.USHORT=function(t){return[t>>8&255,t&255]},Y.USHORT=ot(2),N.SHORT=function(t){return t>=Fs&&(t=-(2*Fs-t)),[t>>8&255,t&255]},Y.SHORT=ot(2),N.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]},Y.UINT24=ot(3),N.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]},Y.ULONG=ot(4),N.LONG=function(t){return t>=Ls&&(t=-(2*Ls-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]},Y.LONG=ot(4),N.FIXED=N.ULONG,Y.FIXED=Y.ULONG,N.FWORD=N.SHORT,Y.FWORD=Y.SHORT,N.UFWORD=N.USHORT,Y.UFWORD=Y.USHORT,N.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]},Y.LONGDATETIME=ot(8),N.TAG=function(t){return q.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},Y.TAG=ot(4),N.Card8=N.BYTE,Y.Card8=Y.BYTE,N.Card16=N.USHORT,Y.Card16=Y.USHORT,N.OffSize=N.BYTE,Y.OffSize=Y.BYTE,N.SID=N.USHORT,Y.SID=Y.USHORT,N.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?N.NUMBER16(t):N.NUMBER32(t)},Y.NUMBER=function(t){return N.NUMBER(t).length},N.NUMBER16=function(t){return[28,t>>8&255,t&255]},Y.NUMBER16=ot(3),N.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]},Y.NUMBER32=ot(5),N.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,u=e.length;i<u;i+=1){var l=e[i];l==="e"?o+=e[++i]==="-"?"c":"b":l==="."?o+="a":l==="-"?o+="e":o+=l}o+=o.length&1?"f":"ff";for(var f=[30],p=0,v=o.length;p<v;p+=2)f.push(parseInt(o.substr(p,2),16));return f},Y.REAL=function(t){return N.REAL(t).length},N.NAME=N.CHARARRAY,Y.NAME=Y.CHARARRAY,N.STRING=N.CHARARRAY,Y.STRING=Y.CHARARRAY,mr.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)},mr.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)},N.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e},Y.UTF16=function(t){return t.length*2};var Ho={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};mr.MACSTRING=function(t,e,r,n){var o=Ho[n];if(o!==void 0){for(var i="",u=0;u<r;u++){var l=t.getUint8(e+u);l<=127?i+=String.fromCharCode(l):i+=o[l&127]}return i}};var Pn=typeof WeakMap=="function"&&new WeakMap,An,bc=function(t){if(!An){An={};for(var e in Ho)An[e]=new String(e)}var r=An[t];if(r!==void 0){if(Pn){var n=Pn.get(r);if(n!==void 0)return n}var o=Ho[t];if(o!==void 0){for(var i={},u=0;u<o.length;u++)i[o.charCodeAt(u)]=u+128;return Pn&&Pn.set(r,i),i}}};N.MACSTRING=function(t,e){var r=bc(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}},Y.MACSTRING=function(t,e){var r=N.MACSTRING(t,e);return r!==void 0?r.length:0};function zo(t){return t>=-128&&t<=127}function _c(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function Sc(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var u=t[i];if(!zo(u)||u===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var l=e;l<i;++l)r.push(t[l]+256&255);return i}function Tc(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var u=t[i];if(u===0||zo(u)&&i+1<o&&zo(t[i+1]))break;++i,++n}r.push(64|n-1);for(var l=e;l<i;++l){var f=t[l];r.push(f+65536>>8&255,f+256&255)}return i}N.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=_c(t,e,r):n>=-128&&n<=127?e=Sc(t,e,r):e=Tc(t,e,r)}return r},N.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=N.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var u=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,N.BYTE,N.USHORT,N.UINT24,N.ULONG][l],p=0;p<r.length;p+=1){var v=f(r[p]);Array.prototype.push.apply(u,v)}return Array.prototype.concat(N.Card16(t.length),N.OffSize(l),u,n)},Y.INDEX=function(t){return N.INDEX(t).length},N.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),u=t[i];e=e.concat(N.OPERAND(u.value,u.type)),e=e.concat(N.OPERATOR(i))}return e},Y.DICT=function(t){return N.DICT(t).length},N.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},N.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)q.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(N.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(N.NUMBER(t));else if(e==="offset")r=r.concat(N.NUMBER32(t));else if(e==="number")r=r.concat(N.NUMBER(t));else if(e==="real")r=r.concat(N.REAL(t));else throw new Error("Unknown operand type "+e);return r},N.OP=N.BYTE,Y.OP=Y.BYTE;var Rn=typeof WeakMap=="function"&&new WeakMap;N.CHARSTRING=function(t){if(Rn){var e=Rn.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(N[i.type](i.value))}return Rn&&Rn.set(t,r),r},Y.CHARSTRING=function(t){return N.CHARSTRING(t).length},N.OBJECT=function(t){var e=N[t.type];return q.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)},Y.OBJECT=function(t){var e=Y[t.type];return q.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)},N.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var u=t.fields[i],l=N[u.type];q.argument(l!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var f=t[u.name];f===void 0&&(f=u.value);var p=l(f);u.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(p)):e=e.concat(p)}for(var v=0;v<n.length;v+=1){var y=o[v],m=e.length;q.argument(m<65536,"Table "+t.tableName+" too big."),e[y]=m>>8,e[y+1]=m&255,e=e.concat(n[v])}return e},Y.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=Y[o.type];q.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var u=t[o.name];u===void 0&&(u=o.value),e+=i(u),o.type==="TABLE"&&(e+=2)}return e},N.RECORD=N.TABLE,Y.RECORD=Y.TABLE,N.LITERAL=function(t){return t},Y.LITERAL=function(t){return t.length};function Ie(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),u=0;u<i.length;u+=1){var l=i[u],f=r[l];this[l]!==void 0&&(this[l]=f)}}Ie.prototype.encode=function(){return N.TABLE(this)},Ie.prototype.sizeOf=function(){return Y.TABLE(this)};function Wr(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function Wo(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function $r(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function On(t){t.format===1?Ie.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Wr("glyph",t.glyphs))):t.format===2?Ie.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat($r("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):q.assert(!1,"Coverage format must be 1 or 2.")}On.prototype=Object.create(Ie.prototype),On.prototype.constructor=On;function Mn(t){Ie.call(this,"scriptListTable",$r("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return q.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Ie("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Ie("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Wr("featureIndex",o.featureIndexes)))}].concat($r("langSys",n.langSysRecords,function(i,u){var l=i.langSys;return[{name:"langSysTag"+u,type:"TAG",value:i.tag},{name:"langSys"+u,type:"TABLE",value:new Ie("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(Wr("featureIndex",l.featureIndexes)))}]})))}]}))}Mn.prototype=Object.create(Ie.prototype),Mn.prototype.constructor=Mn;function Dn(t){Ie.call(this,"featureListTable",$r("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Ie("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Wr("lookupListIndex",n.lookupListIndexes)))}]}))}Dn.prototype=Object.create(Ie.prototype),Dn.prototype.constructor=Dn;function Fn(t,e){Ie.call(this,"lookupListTable",Wo("lookup",t,function(r){var n=e[r.lookupType];return q.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Ie("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Wo("subtable",r.subtables,n)))}))}Fn.prototype=Object.create(Ie.prototype),Fn.prototype.constructor=Fn;var H={Table:Ie,Record:Ie,Coverage:On,ScriptList:Mn,FeatureList:Dn,LookupList:Fn,ushortList:Wr,tableList:Wo,recordList:$r};function Bs(t,e){return t.getUint8(e)}function Ln(t,e){return t.getUint16(e,!1)}function Ec(t,e){return t.getInt16(e,!1)}function $o(t,e){return t.getUint32(e,!1)}function Us(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function xc(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function kc(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Cc(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function Pc(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Ac={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function C(t,e){this.data=t,this.offset=e,this.relativeOffset=0}C.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},C.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},C.prototype.parseCard8=C.prototype.parseByte,C.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},C.prototype.parseCard16=C.prototype.parseUShort,C.prototype.parseSID=C.prototype.parseUShort,C.prototype.parseOffset16=C.prototype.parseUShort,C.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},C.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},C.prototype.parseULong=function(){var t=$o(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},C.prototype.parseOffset32=C.prototype.parseULong,C.prototype.parseFixed=function(){var t=Us(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},C.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n},C.prototype.parseTag=function(){return this.parseString(4)},C.prototype.parseLongDateTime=function(){var t=$o(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},C.prototype.parseVersion=function(t){var e=Ln(this.data,this.offset+this.relativeOffset),r=Ln(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10},C.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Ac[t]*e},C.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e},C.prototype.parseOffset16List=C.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e},C.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e},C.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e},C.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},C.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},C.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},u=0;u<n.length;u++){var l=n[u],f=e[l];i[l]=f.call(this)}r[o]=i}return r},C.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},u=0;u<n.length;u++){var l=n[u],f=e[l];i[l]=f.call(this)}r[o]=i}return r},C.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r},C.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},C.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r},C.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new C(this.data,this.offset+e).parseStruct(t)},C.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new C(this.data,this.offset+e).parseStruct(t)},C.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var u=e[i];if(u===0){o[i]=void 0;continue}if(this.relativeOffset=u,t){for(var l=this.parseOffset16List(),f=new Array(l.length),p=0;p<l.length;p++)this.relativeOffset=u+l[p],f[p]=t.call(this);o[i]=f}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o},C.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},C.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:C.uShort,end:C.uShort,classId:C.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},C.list=function(t,e){return function(){return this.parseList(t,e)}},C.list32=function(t,e){return function(){return this.parseList32(t,e)}},C.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},C.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},C.pointer=function(t){return function(){return this.parsePointer(t)}},C.pointer32=function(t){return function(){return this.parsePointer32(t)}},C.tag=C.prototype.parseTag,C.byte=C.prototype.parseByte,C.uShort=C.offset16=C.prototype.parseUShort,C.uShortList=C.prototype.parseUShortList,C.uLong=C.offset32=C.prototype.parseULong,C.uLongList=C.prototype.parseULongList,C.struct=C.prototype.parseStruct,C.coverage=C.prototype.parseCoverage,C.classDef=C.prototype.parseClassDef;var Is={reserved:C.uShort,reqFeatureIndex:C.uShort,featureIndexes:C.uShortList};C.prototype.parseScriptList=function(){return this.parsePointer(C.recordList({tag:C.tag,script:C.pointer({defaultLangSys:C.pointer(Is),langSysRecords:C.recordList({tag:C.tag,langSys:C.pointer(Is)})})}))||[]},C.prototype.parseFeatureList=function(){return this.parsePointer(C.recordList({tag:C.tag,feature:C.pointer({featureParams:C.offset16,lookupListIndexes:C.uShortList})}))||[]},C.prototype.parseLookupList=function(t){return this.parsePointer(C.list(C.pointer(function(){var e=this.parseUShort();q.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(C.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},C.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();q.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:C.offset32,featureTableSubstitutionOffset:C.offset32});return r})||[]};var Z={getByte:Bs,getCard8:Bs,getUShort:Ln,getCard16:Ln,getShort:Ec,getULong:$o,getFixed:Us,getTag:xc,getOffset:kc,getBytes:Cc,bytesToString:Pc,Parser:C};function Rc(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),u=e.parseULong(),l=o;l<=i;l+=1)t.glyphIndexMap[l]=u,u++}function Oc(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var u=new Z.Parser(r,n+o+14),l=new Z.Parser(r,n+o+16+i*2),f=new Z.Parser(r,n+o+16+i*4),p=new Z.Parser(r,n+o+16+i*6),v=n+o+16+i*8,y=0;y<i-1;y+=1)for(var m=void 0,S=u.parseUShort(),T=l.parseUShort(),x=f.parseShort(),k=p.parseUShort(),A=T;A<=S;A+=1)k!==0?(v=p.offset+p.relativeOffset-2,v+=k,v+=(A-T)*2,m=Z.getUShort(r,v),m!==0&&(m=m+x&65535)):m=A+x&65535,t.glyphIndexMap[A]=m}function Mc(t,e){var r={};r.version=Z.getUShort(t,e),q.argument(r.version===0,"cmap table version should be 0."),r.numTables=Z.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=Z.getUShort(t,e+4+o*8),u=Z.getUShort(t,e+4+o*8+2);if(i===3&&(u===0||u===1||u===10)||i===0&&(u===0||u===1||u===2||u===3||u===4)){n=Z.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new Z.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)Rc(r,l);else if(r.format===4)Oc(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function Dc(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Fc(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Lc(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new H.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var u=t.get(r),l=0;l<u.unicodes.length;l+=1)Dc(i,u.unicodes[l],r);i.segments=i.segments.sort(function(F,D){return F.start-D.start})}Fc(i);var f=i.segments.length,p=0,v=[],y=[],m=[],S=[],T=[],x=[];for(r=0;r<f;r+=1){var k=i.segments[r];k.end<=65535&&k.start<=65535?(v=v.concat({name:"end_"+r,type:"USHORT",value:k.end}),y=y.concat({name:"start_"+r,type:"USHORT",value:k.start}),m=m.concat({name:"idDelta_"+r,type:"SHORT",value:k.delta}),S=S.concat({name:"idRangeOffset_"+r,type:"USHORT",value:k.offset}),k.glyphId!==void 0&&(T=T.concat({name:"glyph_"+r,type:"USHORT",value:k.glyphId}))):p+=1,!e&&k.glyphIndex!==void 0&&(x=x.concat({name:"cmap12Start_"+r,type:"ULONG",value:k.start}),x=x.concat({name:"cmap12End_"+r,type:"ULONG",value:k.end}),x=x.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:k.glyphIndex}))}if(i.segCountX2=(f-p)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(f-p)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(v),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(y),i.fields=i.fields.concat(m),i.fields=i.fields.concat(S),i.fields=i.fields.concat(T),i.cmap4Length=14+v.length*2+2+y.length*2+m.length*2+S.length*2+T.length*2,!e){var A=16+x.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:A},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:x.length/3}]),i.fields=i.fields.concat(x)}return i}var Bc={parse:Mc,make:Lc},Bn=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Uc=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Ic=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Gs=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Ns(t){this.font=t}Ns.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function Un(t,e){this.encoding=t,this.charset=e}Un.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function Gc(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var Qt={line:Gc};function Nc(t,e){var r=e||new Le;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function tt(t){this.bindConstructorValues(t)}tt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",Nc(this,t.path))},tt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)},tt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},tt.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,u;n||(n={});var l=n.xScale,f=n.yScale;if(n.hinting&&o&&o.hinting&&(u=this.path&&o.hinting.exec(this,r)),u)i=o.hinting.getCommands(u),t=Math.round(t),e=Math.round(e),l=f=1;else{i=this.path.commands;var p=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=p),f===void 0&&(f=p)}for(var v=new Le,y=0;y<i.length;y+=1){var m=i[y];m.type==="M"?v.moveTo(t+m.x*l,e+-m.y*f):m.type==="L"?v.lineTo(t+m.x*l,e+-m.y*f):m.type==="Q"?v.quadraticCurveTo(t+m.x1*l,e+-m.y1*f,t+m.x*l,e+-m.y*f):m.type==="C"?v.curveTo(t+m.x1*l,e+-m.y1*f,t+m.x2*l,e+-m.y2*f,t+m.x*l,e+-m.y*f):m.type==="Z"&&v.closePath()}return v},tt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return q.argument(e.length===0,"There are still points left in the current contour."),t},tt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i},tt.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)},tt.prototype.drawPoints=function(t,e,r,n){function o(y,m,S,T){t.beginPath();for(var x=0;x<y.length;x+=1)t.moveTo(m+y[x].x*T,S+y[x].y*T),t.arc(m+y[x].x*T,S+y[x].y*T,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,u=[],l=[],f=this.path,p=0;p<f.commands.length;p+=1){var v=f.commands[p];v.x!==void 0&&u.push({x:v.x,y:-v.y}),v.x1!==void 0&&l.push({x:v.x1,y:-v.y1}),v.x2!==void 0&&l.push({x:v.x2,y:-v.y2})}t.fillStyle="blue",o(u,e,r,i),t.fillStyle="red",o(l,e,r,i)},tt.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",Qt.line(t,e,-1e4,e,1e4),Qt.line(t,-1e4,r,1e4,r);var i=this.xMin||0,u=this.yMin||0,l=this.xMax||0,f=this.yMax||0,p=this.advanceWidth||0;t.strokeStyle="blue",Qt.line(t,e+i*o,-1e4,e+i*o,1e4),Qt.line(t,e+l*o,-1e4,e+l*o,1e4),Qt.line(t,-1e4,r+-u*o,1e4,r+-u*o),Qt.line(t,-1e4,r+-f*o,1e4,r+-f*o),t.strokeStyle="green",Qt.line(t,e+p*o,-1e4,e+p*o,1e4)};function In(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Yo(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Yo.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},Yo.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function Vc(t,e){return new tt({index:e,font:t})}function Hc(t,e,r,n,o,i){return function(){var u=new tt({index:e,font:t});return u.path=function(){r(u,n,o);var l=i(t.glyphs,u);return l.unitsPerEm=t.unitsPerEm,l},In(u,"xMin","_xMin"),In(u,"xMax","_xMax"),In(u,"yMin","_yMin"),In(u,"yMax","_yMax"),u}}function zc(t,e,r,n){return function(){var o=new tt({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var ft={GlyphSet:Yo,glyphLoader:Vc,ttfGlyphLoader:Hc,cffGlyphLoader:zc};function Vs(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!Vs(t[r],e[r]))return!1;return!0}else return!1}function Xo(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function It(t,e,r){var n=[],o=[],i=Z.getCard16(t,e),u,l;if(i!==0){var f=Z.getByte(t,e+2);u=e+(i+1)*f+2;for(var p=e+3,v=0;v<i+1;v+=1)n.push(Z.getOffset(t,p,f)),p+=f;l=u+n[i]}else l=e+2;for(var y=0;y<n.length-1;y+=1){var m=Z.getBytes(t,u+n[y],u+n[y+1]);r&&(m=r(m)),o.push(m)}return{objects:o,startOffset:e,endOffset:l}}function Wc(t,e){var r=[],n=Z.getCard16(t,e),o,i;if(n!==0){var u=Z.getByte(t,e+2);o=e+(n+1)*u+2;for(var l=e+3,f=0;f<n+1;f+=1)r.push(Z.getOffset(t,l,u)),l+=u;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function $c(t,e,r,n,o){var i=Z.getCard16(r,n),u=0;if(i!==0){var l=Z.getByte(r,n+2);u=n+(i+1)*l+2}var f=Z.getBytes(r,u+e[t],u+e[t+1]);return o&&(f=o(f)),f}function Yc(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,u=o&15;if(i===r||(e+=n[i],u===r))break;e+=n[u]}return parseFloat(e)}function Xc(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return Yc(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function jc(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Hs(t,e,r){e=e!==void 0?e:0;var n=new Z.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var u=n.parseByte();u<=21?(u===12&&(u=1200+n.parseByte()),o.push([u,i]),i=[]):i.push(Xc(n,u))}return jc(o)}function Yr(t,e){return e<=390?e=Bn[e]:e=t[e-391],e}function zs(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var u=e[i];if(Array.isArray(u.type)){var l=[];l.length=u.type.length;for(var f=0;f<u.type.length;f++)o=t[u.op]!==void 0?t[u.op][f]:void 0,o===void 0&&(o=u.value!==void 0&&u.value[f]!==void 0?u.value[f]:null),u.type[f]==="SID"&&(o=Yr(r,o)),l[f]=o;n[u.name]=l}else o=t[u.op],o===void 0&&(o=u.value!==void 0?u.value:null),u.type==="SID"&&(o=Yr(r,o)),n[u.name]=o}return n}function qc(t,e){var r={};return r.formatMajor=Z.getCard8(t,e),r.formatMinor=Z.getCard8(t,e+1),r.size=Z.getCard8(t,e+2),r.offsetSize=Z.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Ws=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],$s=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Zc(t,e){var r=Hs(t,0,t.byteLength);return zs(r,Ws,e)}function Ys(t,e,r,n){var o=Hs(t,e,r);return zs(o,$s,n)}function Xs(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var u=new DataView(new Uint8Array(r[i]).buffer),l=Zc(u,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var f=l.private[0],p=l.private[1];if(f!==0&&p!==0){var v=Ys(t,p+e,f,n);if(l._defaultWidthX=v.defaultWidthX,l._nominalWidthX=v.nominalWidthX,v.subrs!==0){var y=p+v.subrs,m=It(t,y+e);l._subrs=m.objects,l._subrsBias=Xo(l._subrs)}l._privateDict=v}o.push(l)}return o}function Kc(t,e,r,n){var o,i,u=new Z.Parser(t,e);r-=1;var l=[".notdef"],f=u.parseCard8();if(f===0)for(var p=0;p<r;p+=1)o=u.parseSID(),l.push(Yr(n,o));else if(f===1)for(;l.length<=r;){o=u.parseSID(),i=u.parseCard8();for(var v=0;v<=i;v+=1)l.push(Yr(n,o)),o+=1}else if(f===2)for(;l.length<=r;){o=u.parseSID(),i=u.parseCard16();for(var y=0;y<=i;y+=1)l.push(Yr(n,o)),o+=1}else throw new Error("Unknown charset format "+f);return l}function Qc(t,e,r){var n,o={},i=new Z.Parser(t,e),u=i.parseCard8();if(u===0)for(var l=i.parseCard8(),f=0;f<l;f+=1)n=i.parseCard8(),o[n]=f;else if(u===1){var p=i.parseCard8();n=1;for(var v=0;v<p;v+=1)for(var y=i.parseCard8(),m=i.parseCard8(),S=y;S<=y+m;S+=1)o[S]=n,n+=1}else throw new Error("Unknown encoding format "+u);return new Un(o,r)}function js(t,e,r){var n,o,i,u,l=new Le,f=[],p=0,v=!1,y=!1,m=0,S=0,T,x,k,A;if(t.isCIDFont){var F=t.tables.cff.topDict._fdSelect[e.index],D=t.tables.cff.topDict._fdArray[F];T=D._subrs,x=D._subrsBias,k=D._defaultWidthX,A=D._nominalWidthX}else T=t.tables.cff.topDict._subrs,x=t.tables.cff.topDict._subrsBias,k=t.tables.cff.topDict._defaultWidthX,A=t.tables.cff.topDict._nominalWidthX;var X=k;function $(re,he){y&&l.closePath(),l.moveTo(re,he),y=!0}function ie(){var re;re=f.length%2!==0,re&&!v&&(X=f.shift()+A),p+=f.length>>1,f.length=0,v=!0}function oe(re){for(var he,Re,Be,we,pe,J,be,Te,fe,me,Me,Ge,_e=0;_e<re.length;){var Ue=re[_e];switch(_e+=1,Ue){case 1:ie();break;case 3:ie();break;case 4:f.length>1&&!v&&(X=f.shift()+A,v=!0),S+=f.pop(),$(m,S);break;case 5:for(;f.length>0;)m+=f.shift(),S+=f.shift(),l.lineTo(m,S);break;case 6:for(;f.length>0&&(m+=f.shift(),l.lineTo(m,S),f.length!==0);)S+=f.shift(),l.lineTo(m,S);break;case 7:for(;f.length>0&&(S+=f.shift(),l.lineTo(m,S),f.length!==0);)m+=f.shift(),l.lineTo(m,S);break;case 8:for(;f.length>0;)n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+f.shift(),l.curveTo(n,o,i,u,m,S);break;case 10:pe=f.pop()+x,J=T[pe],J&&oe(J);break;case 11:return;case 12:switch(Ue=re[_e],_e+=1,Ue){case 35:n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),be=i+f.shift(),Te=u+f.shift(),fe=be+f.shift(),me=Te+f.shift(),Me=fe+f.shift(),Ge=me+f.shift(),m=Me+f.shift(),S=Ge+f.shift(),f.shift(),l.curveTo(n,o,i,u,be,Te),l.curveTo(fe,me,Me,Ge,m,S);break;case 34:n=m+f.shift(),o=S,i=n+f.shift(),u=o+f.shift(),be=i+f.shift(),Te=u,fe=be+f.shift(),me=u,Me=fe+f.shift(),Ge=S,m=Me+f.shift(),l.curveTo(n,o,i,u,be,Te),l.curveTo(fe,me,Me,Ge,m,S);break;case 36:n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),be=i+f.shift(),Te=u,fe=be+f.shift(),me=u,Me=fe+f.shift(),Ge=me+f.shift(),m=Me+f.shift(),l.curveTo(n,o,i,u,be,Te),l.curveTo(fe,me,Me,Ge,m,S);break;case 37:n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),be=i+f.shift(),Te=u+f.shift(),fe=be+f.shift(),me=Te+f.shift(),Me=fe+f.shift(),Ge=me+f.shift(),Math.abs(Me-m)>Math.abs(Ge-S)?m=Me+f.shift():S=Ge+f.shift(),l.curveTo(n,o,i,u,be,Te),l.curveTo(fe,me,Me,Ge,m,S);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+Ue),f.length=0}break;case 14:f.length>0&&!v&&(X=f.shift()+A,v=!0),y&&(l.closePath(),y=!1);break;case 18:ie();break;case 19:case 20:ie(),_e+=p+7>>3;break;case 21:f.length>2&&!v&&(X=f.shift()+A,v=!0),S+=f.pop(),m+=f.pop(),$(m,S);break;case 22:f.length>1&&!v&&(X=f.shift()+A,v=!0),m+=f.pop(),$(m,S);break;case 23:ie();break;case 24:for(;f.length>2;)n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+f.shift(),l.curveTo(n,o,i,u,m,S);m+=f.shift(),S+=f.shift(),l.lineTo(m,S);break;case 25:for(;f.length>6;)m+=f.shift(),S+=f.shift(),l.lineTo(m,S);n=m+f.shift(),o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+f.shift(),l.curveTo(n,o,i,u,m,S);break;case 26:for(f.length%2&&(m+=f.shift());f.length>0;)n=m,o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i,S=u+f.shift(),l.curveTo(n,o,i,u,m,S);break;case 27:for(f.length%2&&(S+=f.shift());f.length>0;)n=m+f.shift(),o=S,i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u,l.curveTo(n,o,i,u,m,S);break;case 28:he=re[_e],Re=re[_e+1],f.push((he<<24|Re<<16)>>16),_e+=2;break;case 29:pe=f.pop()+t.gsubrsBias,J=t.gsubrs[pe],J&&oe(J);break;case 30:for(;f.length>0&&(n=m,o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,S),f.length!==0);)n=m+f.shift(),o=S,i=n+f.shift(),u=o+f.shift(),S=u+f.shift(),m=i+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,S);break;case 31:for(;f.length>0&&(n=m+f.shift(),o=S,i=n+f.shift(),u=o+f.shift(),S=u+f.shift(),m=i+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,S),f.length!==0);)n=m,o=S+f.shift(),i=n+f.shift(),u=o+f.shift(),m=i+f.shift(),S=u+(f.length===1?f.shift():0),l.curveTo(n,o,i,u,m,S);break;default:Ue<32?console.log("Glyph "+e.index+": unknown operator "+Ue):Ue<247?f.push(Ue-139):Ue<251?(he=re[_e],_e+=1,f.push((Ue-247)*256+he+108)):Ue<255?(he=re[_e],_e+=1,f.push(-(Ue-251)*256-he-108)):(he=re[_e],Re=re[_e+1],Be=re[_e+2],we=re[_e+3],_e+=4,f.push((he<<24|Re<<16|Be<<8|we)/65536))}}}return oe(r),e.advanceWidth=X,l}function Jc(t,e,r,n){var o=[],i,u=new Z.Parser(t,e),l=u.parseCard8();if(l===0)for(var f=0;f<r;f++){if(i=u.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(l===3){var p=u.parseCard16(),v=u.parseCard16();if(v!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+v);for(var y,m=0;m<p;m++){if(i=u.parseCard8(),y=u.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(y>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+y);for(;v<y;v++)o.push(i);v=y}if(y!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+y)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return o}function ef(t,e,r,n){r.tables.cff={};var o=qc(t,e),i=It(t,o.endOffset,Z.bytesToString),u=It(t,i.endOffset),l=It(t,u.endOffset,Z.bytesToString),f=It(t,l.endOffset);r.gsubrs=f.objects,r.gsubrsBias=Xo(r.gsubrs);var p=Xs(t,e,u.objects,l.objects);if(p.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+p.length);var v=p[0];if(r.tables.cff.topDict=v,v._privateDict&&(r.defaultWidthX=v._privateDict.defaultWidthX,r.nominalWidthX=v._privateDict.nominalWidthX),v.ros[0]!==void 0&&v.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var y=v.fdArray,m=v.fdSelect;if(y===0||m===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");y+=e;var S=It(t,y),T=Xs(t,e,S.objects,l.objects);v._fdArray=T,m+=e,v._fdSelect=Jc(t,m,r.numGlyphs,T.length)}var x=e+v.private[1],k=Ys(t,x,v.private[0],l.objects);if(r.defaultWidthX=k.defaultWidthX,r.nominalWidthX=k.nominalWidthX,k.subrs!==0){var A=x+k.subrs,F=It(t,A);r.subrs=F.objects,r.subrsBias=Xo(r.subrs)}else r.subrs=[],r.subrsBias=0;var D;n.lowMemory?(D=Wc(t,e+v.charStrings),r.nGlyphs=D.offsets.length):(D=It(t,e+v.charStrings),r.nGlyphs=D.objects.length);var X=Kc(t,e+v.charset,r.nGlyphs,l.objects);if(v.encoding===0?r.cffEncoding=new Un(Uc,X):v.encoding===1?r.cffEncoding=new Un(Ic,X):r.cffEncoding=Qc(t,e+v.encoding,X),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new ft.GlyphSet(r),n.lowMemory)r._push=function(oe){var re=$c(oe,D.offsets,t,e+v.charStrings);r.glyphs.push(oe,ft.cffGlyphLoader(r,oe,js,re))};else for(var $=0;$<r.nGlyphs;$+=1){var ie=D.objects[$];r.glyphs.push($,ft.cffGlyphLoader(r,$,js,ie))}}function qs(t,e){var r,n=Bn.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Bn.length:(r=Bn.length+e.length,e.push(t)),r}function tf(){return new H.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function rf(t){var e=new H.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function Zs(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],u=e[i.name];u!==void 0&&!Vs(u,i.value)&&(i.type==="SID"&&(u=qs(u,r)),n[i.op]={name:i.name,type:i.type,value:u})}return n}function Ks(t,e){var r=new H.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Zs(Ws,t,e),r}function Qs(t){var e=new H.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function nf(t){var e=new H.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function of(){return new H.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function sf(t,e){for(var r=new H.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=qs(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function af(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var u=void 0,l=void 0,f=r.commands[i];if(f.type==="Q"){var p=.3333333333333333,v=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(p*n+v*f.x1),y1:Math.round(p*o+v*f.y1),x2:Math.round(p*f.x+v*f.x1),y2:Math.round(p*f.y+v*f.y1)}}if(f.type==="M")u=Math.round(f.x-n),l=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="L")u=Math.round(f.x-n),l=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="C"){var y=Math.round(f.x1-n),m=Math.round(f.y1-o),S=Math.round(f.x2-f.x1),T=Math.round(f.y2-f.y1);u=Math.round(f.x-f.x2),l=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:y}),e.push({name:"dy1",type:"NUMBER",value:m}),e.push({name:"dx2",type:"NUMBER",value:S}),e.push({name:"dy2",type:"NUMBER",value:T}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(f.x),o=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function uf(t){for(var e=new H.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=af(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function lf(t,e){var r=new H.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=Zs($s,t,e),r}function cf(t,e){for(var r=new H.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},u=[],l,f=1;f<t.length;f+=1)l=t.get(f),u.push(l.name);var p=[];r.header=tf(),r.nameIndex=rf([e.postScriptName]);var v=Ks(o,p);r.topDictIndex=Qs(v),r.globalSubrIndex=of(),r.charsets=sf(u,p),r.charStringsIndex=uf(t),r.privateDict=lf(i,p),r.stringIndex=nf(p);var y=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=y,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),v=Ks(o,p),r.topDictIndex=Qs(v),r}var ff={parse:ef,make:cf};function hf(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),q.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function pf(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new H.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var df={parse:hf,make:pf};function vf(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function gf(t){return new H.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var mf={parse:vf,make:gf};function yf(t,e,r,n,o){for(var i,u,l=new Z.Parser(t,e),f=0;f<n;f+=1){f<r&&(i=l.parseUShort(),u=l.parseShort());var p=o.get(f);p.advanceWidth=i,p.leftSideBearing=u}}function wf(t,e,r,n,o){t._hmtxTableData={};for(var i,u,l=new Z.Parser(e,r),f=0;f<o;f+=1)f<n&&(i=l.parseUShort(),u=l.parseShort()),t._hmtxTableData[f]={advanceWidth:i,leftSideBearing:u}}function bf(t,e,r,n,o,i,u){u.lowMemory?wf(t,e,r,n,o):yf(e,r,n,o,i)}function _f(t){for(var e=new H.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var Sf={parse:bf,make:_f};function Tf(t){for(var e=new H.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function Ef(t,e){var r=new Z.Parser(t,e),n=r.parseULong();q.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],u=0;u<o;u++){for(var l="",f=e+r.parseUShort(),p=r.parseUShort(),v=f;v<f+p;++v)l+=String.fromCharCode(t.getInt8(v));i.push(l)}return i}var xf={make:Tf,parse:Ef};function kf(t,e){var r={},n=new Z.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function Cf(t){return new H.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Pf={parse:kf,make:Cf},Js=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],ea={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Af={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},ta={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Rf(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return ea[e];case 3:return ta[e]}}var jo="utf-16",Of={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Mf={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function ra(t,e,r){switch(t){case 0:return jo;case 1:return Mf[r]||Of[e];case 3:if(e===1||e===10)return jo;break}}function Df(t,e,r){for(var n={},o=new Z.Parser(t,e),i=o.parseUShort(),u=o.parseUShort(),l=o.offset+o.parseUShort(),f=0;f<u;f++){var p=o.parseUShort(),v=o.parseUShort(),y=o.parseUShort(),m=o.parseUShort(),S=Js[m]||m,T=o.parseUShort(),x=o.parseUShort(),k=Rf(p,y,r),A=ra(p,v,y);if(A!==void 0&&k!==void 0){var F=void 0;if(A===jo?F=mr.UTF16(t,l+x,T):F=mr.MACSTRING(t,l+x,T,A),F){var D=n[S];D===void 0&&(D=n[S]={}),D[k]=F}}}return i===1&&o.parseUShort(),n}function qo(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function na(t,e,r,n,o,i){return new H.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function Ff(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function oa(t,e){var r=Ff(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function Lf(t,e){var r,n=[],o={},i=qo(Js);for(var u in t){var l=i[u];if(l===void 0&&(l=u),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');o[r]=t[u],n.push(r)}for(var f=qo(ea),p=qo(ta),v=[],y=[],m=0;m<n.length;m++){r=n[m];var S=o[r];for(var T in S){var x=S[T],k=1,A=f[T],F=Af[A],D=ra(k,F,A),X=N.MACSTRING(x,D);X===void 0&&(k=0,A=e.indexOf(T),A<0&&(A=e.length,e.push(T)),F=4,X=N.UTF16(x));var $=oa(X,y);v.push(na(k,F,A,r,X.length,$));var ie=p[T];if(ie!==void 0){var oe=N.UTF16(x),re=oa(oe,y);v.push(na(3,1,ie,r,oe.length,re))}}}v.sort(function(Be,we){return Be.platformID-we.platformID||Be.encodingID-we.encodingID||Be.languageID-we.languageID||Be.nameID-we.nameID});for(var he=new H.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:v.length},{name:"stringOffset",type:"USHORT",value:6+v.length*12}]),Re=0;Re<v.length;Re++)he.fields.push({name:"record_"+Re,type:"RECORD",value:v[Re]});return he.fields.push({name:"strings",type:"LITERAL",value:y}),he}var Bf={parse:Df,make:Lf},Zo=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Uf(t){for(var e=0;e<Zo.length;e+=1){var r=Zo[e];if(t>=r.begin&&t<r.end)return e}return-1}function If(t,e){var r={},n=new Z.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Gf(t){return new H.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var ia={parse:If,make:Gf,unicodeRanges:Zo,getUnicodeRange:Uf};function Nf(t,e){var r={},n=new Z.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Gs.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=Gs.length){var u=n.parseChar();r.names.push(n.parseString(u))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function Vf(){return new H.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Hf={parse:Nf,make:Vf},it=new Array(9);it[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(C.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(C.coverage),substitute:this.parseOffset16List()};q.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},it[2]=function(){var e=this.parseUShort();return q.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),sequences:this.parseListOfLists()}},it[3]=function(){var e=this.parseUShort();return q.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),alternateSets:this.parseListOfLists()}},it[4]=function(){var e=this.parseUShort();return q.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var yr={sequenceIndex:C.uShort,lookupListIndex:C.uShort};it[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(C.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(u,yr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(C.coverage),classDef:this.parsePointer(C.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(u,yr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,C.pointer(C.coverage)),lookupRecords:this.parseRecordList(o,yr)}}q.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},it[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(C.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(yr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(C.coverage),backtrackClassDef:this.parsePointer(C.classDef),inputClassDef:this.parsePointer(C.classDef),lookaheadClassDef:this.parsePointer(C.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(yr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(C.pointer(C.coverage)),inputCoverage:this.parseList(C.pointer(C.coverage)),lookaheadCoverage:this.parseList(C.pointer(C.coverage)),lookupRecords:this.parseRecordList(yr)};q.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},it[7]=function(){var e=this.parseUShort();q.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new C(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:it[r].call(n)}},it[8]=function(){var e=this.parseUShort();return q.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),backtrackCoverage:this.parseList(C.pointer(C.coverage)),lookaheadCoverage:this.parseList(C.pointer(C.coverage)),substitutes:this.parseUShortList()}};function zf(t,e){e=e||0;var r=new C(t,e),n=r.parseVersion(1);return q.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(it)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(it),variations:r.parseFeatureVariationsList()}}var wr=new Array(9);wr[1]=function(e){return e.substFormat===1?new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.ushortList("substitute",e.substitute)))},wr[2]=function(e){return q.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("seqSet",e.sequences,function(r){return new H.Table("sequenceSetTable",H.ushortList("sequence",r))})))},wr[3]=function(e){return q.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("altSet",e.alternateSets,function(r){return new H.Table("alternateSetTable",H.ushortList("alternate",r))})))},wr[4]=function(e){return q.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new H.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("ligSet",e.ligatureSets,function(r){return new H.Table("ligatureSetTable",H.tableList("ligature",r,function(n){return new H.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(H.ushortList("component",n.components,n.components.length+1)))}))})))},wr[6]=function(e){if(e.substFormat===1){var r=new H.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new H.Coverage(e.coverage)}].concat(H.tableList("chainRuleSet",e.chainRuleSets,function(i){return new H.Table("chainRuleSetTable",H.tableList("chainRule",i,function(u){var l=H.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(H.ushortList("inputGlyph",u.input,u.input.length+1)).concat(H.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(H.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(f,p){l=l.concat({name:"sequenceIndex"+p,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+p,type:"USHORT",value:f.lookupListIndex})}),new H.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)q.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,u){n.push({name:"backtrackCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,u){n.push({name:"inputCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,u){n.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new H.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,u){n=n.concat({name:"sequenceIndex"+u,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:i.lookupListIndex})});var o=new H.Table("chainContextTable",n);return o}q.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Wf(t){return new H.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new H.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new H.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new H.LookupList(t.lookups,wr)}])}var $f={parse:zf,make:Wf};function Yf(t,e){var r=new Z.Parser(t,e),n=r.parseULong();q.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},u=0;u<o;u++){var l=r.parseTag(),f=r.parseULong(),p=r.parseULong(),v=mr.UTF8(t,e+f,p);i[l]=v}return i}function Xf(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new H.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var u=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+u}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var jf={parse:Yf,make:Xf};function sa(t){return Math.log(t)/Math.log(2)|0}function Ko(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function aa(t,e,r,n){return new H.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function ua(t){var e=new H.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,sa(e.numTables));e.searchRange=16*r,e.entrySelector=sa(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+aa().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<t.length;u+=1){var l=t[u];q.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var f=l.sizeOf(),p=aa(l.tableName,Ko(l.encode()),i,f);for(n.push({name:p.tag+" Table Record",type:"RECORD",value:p}),o.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=f,q.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(v,y){return v.value.tag>y.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function la(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function qf(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function Zf(t){for(var e=[],r=[],n=[],o=[],i=[],u=[],l=[],f,p=0,v=0,y=0,m=0,S=0,T=0;T<t.glyphs.length;T+=1){var x=t.glyphs.get(T),k=x.unicode|0;if(isNaN(x.advanceWidth))throw new Error("Glyph "+x.name+" ("+T+"): advanceWidth is not a number.");(f>k||f===void 0)&&k>0&&(f=k),p<k&&(p=k);var A=ia.getUnicodeRange(k);if(A<32)v|=1<<A;else if(A<64)y|=1<<A-32;else if(A<96)m|=1<<A-64;else if(A<123)S|=1<<A-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(x.name!==".notdef"){var F=x.getMetrics();e.push(F.xMin),r.push(F.yMin),n.push(F.xMax),o.push(F.yMax),u.push(F.leftSideBearing),l.push(F.rightSideBearing),i.push(x.advanceWidth)}}var D={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:qf(i),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,l)};D.ascender=t.ascender,D.descender=t.descender;var X=df.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:D.xMin,yMin:D.yMin,xMax:D.xMax,yMax:D.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),$=mf.make({ascender:D.ascender,descender:D.descender,advanceWidthMax:D.advanceWidthMax,minLeftSideBearing:D.minLeftSideBearing,minRightSideBearing:D.minRightSideBearing,xMaxExtent:D.maxLeftSideBearing+(D.xMax-D.xMin),numberOfHMetrics:t.glyphs.length}),ie=Pf.make(t.glyphs.length),oe=ia.make(Object.assign({xAvgCharWidth:Math.round(D.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:p,ulUnicodeRange1:v,ulUnicodeRange2:y,ulUnicodeRange3:m,ulUnicodeRange4:S,sTypoAscender:D.ascender,sTypoDescender:D.descender,sTypoLineGap:0,usWinAscent:D.yMax,usWinDescent:Math.abs(D.yMin),ulCodePageRange1:1,sxHeight:la(t,"xyvw",{yMax:Math.round(D.ascender/2)}).yMax,sCapHeight:la(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",D).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),re=Sf.make(t.glyphs),he=Bc.make(t.glyphs),Re=t.getEnglishName("fontFamily"),Be=t.getEnglishName("fontSubfamily"),we=Re+" "+Be,pe=t.getEnglishName("postScriptName");pe||(pe=Re.replace(/\s/g,"")+"-"+Be);var J={};for(var be in t.names)J[be]=t.names[be];J.uniqueID||(J.uniqueID={en:t.getEnglishName("manufacturer")+":"+we}),J.postScriptName||(J.postScriptName={en:pe}),J.preferredFamily||(J.preferredFamily=t.names.fontFamily),J.preferredSubfamily||(J.preferredSubfamily=t.names.fontSubfamily);var Te=[],fe=Bf.make(J,Te),me=Te.length>0?xf.make(Te):void 0,Me=Hf.make(),Ge=ff.make(t.glyphs,{version:t.getEnglishName("version"),fullName:we,familyName:Re,weightName:Be,postScriptName:pe,unitsPerEm:t.unitsPerEm,fontBBox:[0,D.yMin,D.ascender,D.advanceWidthMax]}),_e=t.metas&&Object.keys(t.metas).length>0?jf.make(t.metas):void 0,Ue=[X,$,ie,oe,fe,he,Me,Ge,re];me&&Ue.push(me),t.tables.gsub&&Ue.push($f.make(t.tables.gsub)),_e&&Ue.push(_e);for(var en=ua(Ue),vi=en.encode(),Kn=Ko(vi),tn=en.fields,Qn=!1,kt=0;kt<tn.length;kt+=1)if(tn[kt].name==="head table"){tn[kt].value.checkSumAdjustment=2981146554-Kn,Qn=!0;break}if(!Qn)throw new Error("Could not find head table with checkSum to adjust.");return en}var Kf={make:ua,fontToTable:Zf,computeCheckSum:Ko};function Qo(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function ca(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function fa(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var u=r.start;if(u===e)return r;u<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function Xr(t,e){this.font=t,this.tableName=e}Xr.prototype={searchTag:Qo,binSearch:ca,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=Qo(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=Qo(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,u=o.featureIndexes,l=this.font.tables[this.tableName].features,f=0;f<u.length;f++)if(i=l[u[f]],i.tag===r)return i.feature;if(n){var p=l.length;return q.assert(p===0||r>=l[p-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(i),u.push(p),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),u=[];if(i){for(var l,f=i.lookupListIndexes,p=this.font.tables[this.tableName].lookups,v=0;v<f.length;v++)l=p[f[v]],l.lookupType===n&&u.push(l);if(u.length===0&&o){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var y=p.length;return p.push(l),f.push(y),[l]}}return u},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=fa(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=ca(t.glyphs,e);return r>=0?r:-1;case 2:var n=fa(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,u=o.end,l=i;l<=u;l++)e.push(l);return e}};function jr(t){Xr.call(this,t,"gpos")}jr.prototype=Xr.prototype,jr.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},jr.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var u=o[i],l=this.getCoverageIndex(u.coverage,e);if(!(l<0))switch(u.posFormat){case 1:for(var f=u.pairSets[l],p=0;p<f.length;p++){var v=f[p];if(v.secondGlyph===r)return v.value1&&v.value1.xAdvance||0}break;case 2:var y=this.getGlyphClass(u.classDef1,e),m=this.getGlyphClass(u.classDef2,r),S=u.classRecords[y][m];return S.value1&&S.value1.xAdvance||0}}return 0},jr.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function Je(t){Xr.call(this,t,"gsub")}function Qf(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Jo(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}Je.prototype=Xr.prototype,Je.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Je.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++){var f=u[l],p=this.expandCoverage(f.coverage),v=void 0;if(f.substFormat===1){var y=f.deltaGlyphId;for(v=0;v<p.length;v++){var m=p[v];n.push({sub:m,by:m+y})}}else{var S=f.substitute;for(v=0;v<p.length;v++)n.push({sub:p[v],by:S[v]})}}return n},Je.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++){var f=u[l],p=this.expandCoverage(f.coverage),v=void 0;for(v=0;v<p.length;v++){var y=p[v],m=f.sequences[v];n.push({sub:y,by:m})}}return n},Je.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++)for(var f=u[l],p=this.expandCoverage(f.coverage),v=f.alternateSets,y=0;y<p.length;y++)n.push({sub:p[y],by:v[y]});return n},Je.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var u=o[i].subtables,l=0;l<u.length;l++)for(var f=u[l],p=this.expandCoverage(f.coverage),v=f.ligatureSets,y=0;y<p.length;y++)for(var m=p[y],S=v[y],T=0;T<S.length;T++){var x=S[T];n.push({sub:[m].concat(x.components),by:x.ligGlyph})}return n},Je.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=Jo(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});q.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.substitute.splice(l,0,0)),i.substitute[l]=e.by},Je.prototype.addMultiple=function(t,e,r,n){q.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=Jo(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});q.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.sequences.splice(l,0,0)),i.sequences[l]=e.by},Je.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=Jo(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});q.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var u=e.sub,l=this.binSearch(i.coverage.glyphs,u);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,u),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by},Je.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),q.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var u=e.sub[0],l=e.sub.slice(1),f={ligGlyph:e.by,components:l},p=this.binSearch(i.coverage.glyphs,u);if(p>=0){for(var v=i.ligatureSets[p],y=0;y<v.length;y++)if(Qf(v[y].components,l))return;v.push(f)}else p=-1-p,i.coverage.glyphs.splice(p,0,u),i.ligatureSets.splice(p,0,[f])},Je.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}},Je.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function Jf(){return typeof window<"u"}function eh(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function qr(t,e){if(!t)throw e}function ha(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),e&o||(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function pa(t,e,r){var n=new Z.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var u=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)u.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var f=0;f<t.instructionLength;f+=1)t.instructions.push(n.parseByte());var p=u[u.length-1]+1;o=[];for(var v=0;v<p;v+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var y=n.parseByte(),m=0;m<y;m+=1)o.push(i),v+=1;if(q.argument(o.length===p,"Bad flags."),u.length>0){var S=[],T;if(p>0){for(var x=0;x<p;x+=1)i=o[x],T={},T.onCurve=!!(i&1),T.lastPointOfContour=u.indexOf(x)>=0,S.push(T);for(var k=0,A=0;A<p;A+=1)i=o[A],T=S[A],T.x=ha(n,i,k,2,16),k=T.x;for(var F=0,D=0;D<p;D+=1)i=o[D],T=S[D],T.y=ha(n,i,F,4,32),F=T.y}t.points=S}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var X=!0;X;){o=n.parseUShort();var $={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?($.dx=n.parseShort(),$.dy=n.parseShort()):$.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?($.dx=n.parseChar(),$.dy=n.parseChar()):$.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?$.xScale=$.yScale=n.parseF2Dot14():(o&64)>0?($.xScale=n.parseF2Dot14(),$.yScale=n.parseF2Dot14()):(o&128)>0&&($.xScale=n.parseF2Dot14(),$.scale01=n.parseF2Dot14(),$.scale10=n.parseF2Dot14(),$.yScale=n.parseF2Dot14()),t.components.push($),X=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var ie=0;ie<t.instructionLength;ie+=1)t.instructions.push(n.parseByte())}}}function ei(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function th(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return q.argument(r.length===0,"There are still points left in the current contour."),e}function da(t){var e=new Le;if(!t)return e;for(var r=th(t),n=0;n<r.length;++n){var o=r[n],i=null,u=o[o.length-1],l=o[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var f={x:(u.x+l.x)*.5,y:(u.y+l.y)*.5};e.moveTo(f.x,f.y)}for(var p=0;p<o.length;++p)if(i=u,u=l,l=o[(p+1)%o.length],u.onCurve)e.lineTo(u.x,u.y);else{var v=l;i.onCurve||((u.x+i.x)*.5,(u.y+i.y)*.5),l.onCurve||(v={x:(u.x+l.x)*.5,y:(u.y+l.y)*.5}),e.quadraticCurveTo(u.x,u.y,v.x,v.y)}e.closePath()}return e}function va(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=ei(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[n.matchedPoints[0]],l=o.points[n.matchedPoints[1]],f={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=ei([l],f)[0],f.dx=u.x-l.x,f.dy=u.y-l.y,i=ei(o.points,f)}e.points=e.points.concat(i)}}return da(e.points)}function rh(t,e,r,n){for(var o=new ft.GlyphSet(n),i=0;i<r.length-1;i+=1){var u=r[i],l=r[i+1];u!==l?o.push(i,ft.ttfGlyphLoader(n,i,pa,t,e+u,va)):o.push(i,ft.glyphLoader(n,i))}return o}function nh(t,e,r,n){var o=new ft.GlyphSet(n);return n._push=function(i){var u=r[i],l=r[i+1];u!==l?o.push(i,ft.ttfGlyphLoader(n,i,pa,t,e+u,va)):o.push(i,ft.glyphLoader(n,i))},o}function oh(t,e,r,n,o){return o.lowMemory?nh(t,e,r,n):rh(t,e,r,n)}var ih={getPath:da,parse:oh},ga,Jt,ma,ti;function ya(t){this.font=t,this.getCommands=function(e){return ih.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function sh(t){return t}function wa(t){return Math.sign(t)*Math.round(Math.abs(t))}function ah(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function uh(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function lh(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function ch(t){return Math.sign(t)*Math.floor(Math.abs(t))}var ba=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},ht={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,u,l,f,p,v;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,f=e.x-e.xo,p=r.x-r.xo,u=Math.abs(o),l=Math.abs(i),v=u+l,v===0){t.x=t.xo+(f+p)/2;return}t.x=t.xo+(f*l+p*u)/v;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),l=Math.abs(i),v=u+l,v===0){ht.setRelative(t,t,(f+p)/2,n,!0);return}ht.setRelative(t,t,(f*l+p*u)/v,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y;t.x=l+(t.y-f)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},St={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,u,l,f,p,v;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,f=e.y-e.yo,p=r.y-r.yo,u=Math.abs(o),l=Math.abs(i),v=u+l,v===0){t.y=t.yo+(f+p)/2;return}t.y=t.yo+(f*l+p*u)/v;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),l=Math.abs(i),v=u+l,v===0){St.setRelative(t,t,(f+p)/2,n,!0);return}St.setRelative(t,t,(f*l+p*u)/v,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y;t.y=f+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(ht),Object.freeze(St);function Zr(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}Zr.prototype.distance=function(t,e,r,n){return this.x*ht.distance(t,e,r,n)+this.y*St.distance(t,e,r,n)},Zr.prototype.interpolate=function(t,e,r,n){var o,i,u,l,f,p,v;if(u=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),f=Math.abs(u),p=Math.abs(l),v=f+p,v===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*p+i*f)/v,n,!0)},Zr.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,u=o?e.yo:e.y,l=i+r*n.x,f=u+r*n.y,p=n.normalSlope,v=this.slope,y=t.x,m=t.y;t.x=(v*y-p*l+f-m)/(v-p),t.y=v*(t.x-y)+m},Zr.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function Kr(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?ht:t===0&&e===1?St:new Zr(t,e)}function Tt(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Tt.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},Tt.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Qr=Object.freeze(new Tt(0,0)),fh={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Gt(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=ht,this.round=wa}}ya.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){Gt.prototype=fh,o=this._fpgmState=new Gt("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{Jt(o)}catch(p){console.log("Hinting error in FPGM:"+p),this._errorState=3;return}}Gt.prototype=o,n=this._prepState=new Gt("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var u=n.cvt=new Array(i.length),l=e/r.unitsPerEm,f=0;f<i.length;f++)u[f]=i[f]*l;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{Jt(n)}catch(p){this._errorState<2&&console.log("Hinting error in PREP:"+p),this._errorState=2}}if(!(this._errorState>1))try{return ma(t,n)}catch(p){this._errorState<1&&(console.log("Hinting error:"+p),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},ma=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,u,l;if(Gt.prototype=e,!o)l=new Gt("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),ti(t,l,r,n),u=l.gZone;else{var f=e.font;u=[],i=[];for(var p=0;p<o.length;p++){var v=o[p],y=f.glyphs.get(v.glyphIndex);l=new Gt("glyf",y.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+p+"---"),l.step=-1),ti(y,l,r,n);for(var m=Math.round(v.dx*r),S=Math.round(v.dy*n),T=l.gZone,x=l.contours,k=0;k<T.length;k++){var A=T[k];A.xTouched=A.yTouched=!1,A.xo=A.x=A.x+m,A.yo=A.y=A.y+S}var F=u.length;u.push.apply(u,T);for(var D=0;D<x.length;D++)i.push(x[D]+F)}t.instructions&&!l.inhibitGridFit&&(l=new Gt("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=u,l.contours=i,u.push(new Tt(0,0),new Tt(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),Jt(l),u.length-=2)}return u},ti=function(t,e,r,n){for(var o=t.points||[],i=o.length,u=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],f,p=0;p<i;p++)f=o[p],u[p]=new Tt(f.x*r,f.y*n,f.lastPointOfContour,f.onCurve);for(var v,y,m=0;m<i;m++)f=u[m],v||(v=f,l.push(m)),f.lastPointOfContour?(f.nextPointOnContour=v,v.prevPointOnContour=f,v=void 0):(y=u[m+1],f.nextPointOnContour=y,y.prevPointOnContour=f);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var S=0;S<i;S++)console.log(S,u[S].x,u[S].y)}if(u.push(new Tt(0,0),new Tt(Math.round(t.advanceWidth*r),0)),Jt(e),u.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var T=0;T<i;T++)console.log(T,u[T].x,u[T].y)}}},Jt=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=ga[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function Gn(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new Tt(0,0)}function _a(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function Sa(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function Ta(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function Ea(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function xa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SPVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.pv=e.dpv=Kr(l,f)}function ka(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SFVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.fv=Kr(l,f)}function hh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=Kr(n,r)}function ph(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=Kr(n,r)}function dh(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function vh(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function gh(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function mh(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),u=e.pop(),l=t.z0,f=t.z1,p=l[r],v=l[n],y=f[o],m=f[i],S=t.z2[u];exports.DEBUG&&console.log("ISECT[], ",r,n,o,i,u);var T=p.x,x=p.y,k=v.x,A=v.y,F=y.x,D=y.y,X=m.x,$=m.y,ie=(T-k)*(D-$)-(x-A)*(F-X),oe=T*A-x*k,re=F*$-D*X;S.x=(oe*(F-X)-re*(T-k))/ie,S.y=(oe*(D-$)-re*(x-A))/ie}function yh(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function wh(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function bh(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function _h(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||Gn(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Sh(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||Gn(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Th(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||Gn(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Eh(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||Gn(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function xh(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function kh(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=wa}function Ch(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=uh}function Ph(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Ah(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),_a(t,!1)}function Rh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Oh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function Mh(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function ri(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function Dh(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function Fh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function Lh(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function Bh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var u=0;u<n;u++)Jt(t),exports.DEBUG&&console.log(++t.step,u+1<n?"next loopcall":"done loopcall",u);t.ip=o,t.prog=i}function Uh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],Jt(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function Ih(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function Gh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function Nh(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function Ca(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var u=i.distance(n,Qr);t&&(u=e.round(u)),o.setRelative(n,Qr,u,i),o.touch(n),e.rp0=e.rp1=r}function Pa(t,e){var r=e.z2,n=r.length-2,o,i,u;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)o=r[l],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(u=o.nextTouched(t),i===u&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,u,t)))}function Aa(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=e.loop,f=e.z2;l--;){var p=r.pop(),v=f[p],y=u.distance(o,o,!1,!0);i.setRelative(v,v,y,u),i.touch(v),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",p)}e.loop=1}function Ra(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=r.pop(),f=e.z2[e.contours[l]],p=f;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var v=u.distance(o,o,!1,!0);do p!==o&&i.setRelative(p,p,v,u),p=p.nextPointOnContour;while(p!==f)}function Oa(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,u=e.pv,l=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var f;switch(l){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var p,v=u.distance(o,o,!1,!0),y=f.length-2,m=0;m<y;m++)p=f[m],i.setRelative(p,p,v,u)}function Vh(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var u=e.pop(),l=i[u];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",u,o),n.setRelative(l,l,o),n.touch(l)}t.loop=1}function Hh(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],u=t.z1[n],l=t.fv,f=t.dpv,p=t.z2;o--;){var v=e.pop(),y=p[v];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",v,r,"<->",n),l.interpolate(y,i,u,f),l.touch(y)}t.loop=1}function Ma(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],u=e.z0[e.rp0],l=e.fv,f=e.pv;l.setRelative(i,u,n,f),l.touch(i),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function zh(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,u=t.pv,l=t.z1;o--;){var f=e.pop(),p=l[f];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",f),i.setRelative(p,n,0,u),i.touch(p)}t.loop=1}function Wh(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=ah}function Da(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],u=e.fv,l=e.pv,f=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",f,")",o);var p=l.distance(i,Qr);t&&(Math.abs(p-f)<e.cvCutIn&&(p=f),p=e.round(p)),u.setRelative(i,Qr,p,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),u.touch(i),e.rp0=e.rp1=o}function $h(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function Yh(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var u=r[++e]<<8|r[++e];u&32768&&(u=-((u^65535)+1)),n.push(u)}t.ip=e}function Xh(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function jh(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function qh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function Zh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function Fa(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,Qr,t,!1)*64)}function La(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],u=e.z0[o],l=e.dpv.distance(u,i,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",l),e.stack.push(Math.round(l*64))}function Kh(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function Qh(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function Jh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function ep(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function tp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function rp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function np(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function op(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function ip(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function sp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function ap(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(_a(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function up(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function lp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function cp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function fp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function ni(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,u=e.ppem,l=e.deltaBase+(t-1)*16,f=e.deltaShift,p=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var v=0;v<n;v++){var y=r.pop(),m=r.pop(),S=l+((m&240)>>4);if(S===u){var T=(m&15)-8;T>=0&&T++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",y,"by",T*f);var x=p[y];o.setRelative(x,x,T*f,i)}}}function hp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function pp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function dp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function vp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function gp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function mp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function yp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function wp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function bp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function _p(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Nn(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function Sp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function oi(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,u=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var f=r.pop(),p=r.pop(),v=i+((p&240)>>4);if(v===o){var y=(p&15)-8;y>=0&&y++;var m=y*u;exports.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",m),e.cvt[f]+=m}}}function Tp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=ba;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Ep(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=ba;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function xp(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=sh}function kp(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=lh}function Cp(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=ch}function Pp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function Ba(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var l,f;t?(l=i.y-u.y,f=u.x-i.x):(l=u.x-i.x,f=u.y-i.y),e.dpv=Kr(l,f)}function Ap(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Rp(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function Op(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function Mp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function Dp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function Fp(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Nt(t,e){var r=e.stack,n=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function Vt(t,e){var r=e.ip,n=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var u=n[++r]<<8|n[++r];u&32768&&(u=-((u^65535)+1)),o.push(u)}e.ip=r}function V(t,e,r,n,o,i){var u=i.stack,l=t&&u.pop(),f=u.pop(),p=i.rp0,v=i.z0[p],y=i.z1[f],m=i.minDis,S=i.fv,T=i.dpv,x,k,A,F;k=x=T.distance(y,v,!0,!0),A=k>=0?1:-1,k=Math.abs(k),t&&(F=i.cvt[l],n&&Math.abs(k-F)<i.cvCutIn&&(k=F)),r&&k<m&&(k=m),n&&(k=i.round(k)),S.setRelative(y,v,A*k,T),S.touch(y),exports.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?l+"("+i.cvt[l]+","+F+")":"",f,"(d =",x,"->",A*k,")"),i.rp1=i.rp0,i.rp2=f,e&&(i.rp0=f)}ga=[Sa.bind(void 0,St),Sa.bind(void 0,ht),Ta.bind(void 0,St),Ta.bind(void 0,ht),Ea.bind(void 0,St),Ea.bind(void 0,ht),xa.bind(void 0,0),xa.bind(void 0,1),ka.bind(void 0,0),ka.bind(void 0,1),hh,ph,dh,vh,gh,mh,yh,wh,bh,_h,Sh,Th,Eh,xh,kh,Ch,Ph,Ah,Rh,Oh,void 0,void 0,Mh,ri,Dh,Fh,Lh,Ih,Gh,void 0,void 0,void 0,Bh,Uh,Nh,void 0,Ca.bind(void 0,0),Ca.bind(void 0,1),Pa.bind(void 0,St),Pa.bind(void 0,ht),Aa.bind(void 0,0),Aa.bind(void 0,1),Ra.bind(void 0,0),Ra.bind(void 0,1),Oa.bind(void 0,0),Oa.bind(void 0,1),Vh,Hh,Ma.bind(void 0,0),Ma.bind(void 0,1),zh,Wh,Da.bind(void 0,0),Da.bind(void 0,1),$h,Yh,Xh,jh,qh,Zh,Fa.bind(void 0,0),Fa.bind(void 0,1),void 0,La.bind(void 0,0),La.bind(void 0,1),Kh,void 0,Qh,void 0,void 0,Jh,ep,tp,rp,np,op,ip,sp,ap,up,lp,cp,fp,ni.bind(void 0,1),hp,pp,dp,vp,gp,mp,yp,wp,bp,_p,Nn.bind(void 0,0),Nn.bind(void 0,1),Nn.bind(void 0,2),Nn.bind(void 0,3),void 0,void 0,void 0,void 0,Sp,ni.bind(void 0,2),ni.bind(void 0,3),oi.bind(void 0,1),oi.bind(void 0,2),oi.bind(void 0,3),Tp,Ep,void 0,void 0,xp,void 0,kp,Cp,ri,ri,void 0,void 0,void 0,void 0,void 0,Pp,Ba.bind(void 0,0),Ba.bind(void 0,1),Ap,void 0,Rp,Op,Mp,Dp,Fp,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Nt.bind(void 0,1),Nt.bind(void 0,2),Nt.bind(void 0,3),Nt.bind(void 0,4),Nt.bind(void 0,5),Nt.bind(void 0,6),Nt.bind(void 0,7),Nt.bind(void 0,8),Vt.bind(void 0,1),Vt.bind(void 0,2),Vt.bind(void 0,3),Vt.bind(void 0,4),Vt.bind(void 0,5),Vt.bind(void 0,6),Vt.bind(void 0,7),Vt.bind(void 0,8),V.bind(void 0,0,0,0,0,0),V.bind(void 0,0,0,0,0,1),V.bind(void 0,0,0,0,0,2),V.bind(void 0,0,0,0,0,3),V.bind(void 0,0,0,0,1,0),V.bind(void 0,0,0,0,1,1),V.bind(void 0,0,0,0,1,2),V.bind(void 0,0,0,0,1,3),V.bind(void 0,0,0,1,0,0),V.bind(void 0,0,0,1,0,1),V.bind(void 0,0,0,1,0,2),V.bind(void 0,0,0,1,0,3),V.bind(void 0,0,0,1,1,0),V.bind(void 0,0,0,1,1,1),V.bind(void 0,0,0,1,1,2),V.bind(void 0,0,0,1,1,3),V.bind(void 0,0,1,0,0,0),V.bind(void 0,0,1,0,0,1),V.bind(void 0,0,1,0,0,2),V.bind(void 0,0,1,0,0,3),V.bind(void 0,0,1,0,1,0),V.bind(void 0,0,1,0,1,1),V.bind(void 0,0,1,0,1,2),V.bind(void 0,0,1,0,1,3),V.bind(void 0,0,1,1,0,0),V.bind(void 0,0,1,1,0,1),V.bind(void 0,0,1,1,0,2),V.bind(void 0,0,1,1,0,3),V.bind(void 0,0,1,1,1,0),V.bind(void 0,0,1,1,1,1),V.bind(void 0,0,1,1,1,2),V.bind(void 0,0,1,1,1,3),V.bind(void 0,1,0,0,0,0),V.bind(void 0,1,0,0,0,1),V.bind(void 0,1,0,0,0,2),V.bind(void 0,1,0,0,0,3),V.bind(void 0,1,0,0,1,0),V.bind(void 0,1,0,0,1,1),V.bind(void 0,1,0,0,1,2),V.bind(void 0,1,0,0,1,3),V.bind(void 0,1,0,1,0,0),V.bind(void 0,1,0,1,0,1),V.bind(void 0,1,0,1,0,2),V.bind(void 0,1,0,1,0,3),V.bind(void 0,1,0,1,1,0),V.bind(void 0,1,0,1,1,1),V.bind(void 0,1,0,1,1,2),V.bind(void 0,1,0,1,1,3),V.bind(void 0,1,1,0,0,0),V.bind(void 0,1,1,0,0,1),V.bind(void 0,1,1,0,0,2),V.bind(void 0,1,1,0,0,3),V.bind(void 0,1,1,0,1,0),V.bind(void 0,1,1,0,1,1),V.bind(void 0,1,1,0,1,2),V.bind(void 0,1,1,0,1,3),V.bind(void 0,1,1,1,0,0),V.bind(void 0,1,1,1,0,1),V.bind(void 0,1,1,1,0,2),V.bind(void 0,1,1,1,0,3),V.bind(void 0,1,1,1,1,0),V.bind(void 0,1,1,1,1,1),V.bind(void 0,1,1,1,1,2),V.bind(void 0,1,1,1,1,3)];function br(t){this.char=t,this.state={},this.activeState=null}function ii(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function Lp(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function st(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Vn(t){this.eventId=t,this.subscribers=[]}function Bp(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Vn(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Ce(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Bp.call(this,t)}br.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},br.prototype.getState=function(t){return this.state[t]||null},Ce.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},Ce.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])},Ce.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(u){return u instanceof br});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Ce.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof br){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},Ce.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n},Ce.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}},Ce.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof br});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},Ce.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],u=e===null||e.apply(this,i)===!0,l=[n,o];if(u){var f=r.apply(this,l);n.setState(t,f)}}),this.registeredModifiers.push(t)},Vn.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Vn.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},st.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},st.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}},Ce.prototype.rangeToText=function(t){if(t instanceof ii)return this.getRangeTokens(t).map(function(e){return e.char}).join("")},Ce.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},Ce.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null},Ce.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null},Ce.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Vn&&n.subscribers.forEach(function(o){o.apply(r,e||[])})},Ce.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new Lp(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},Ce.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},Ce.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},Ce.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}},Ce.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new st(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Ce.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new ii(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n},Ce.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new ii(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),i&&n.checkEnd(t)){var u=r-i.startIndex+1,l=e.setEndOffset(u,o);e.dispatch("contextEnd",[o,l])}})},Ce.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new st(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new br(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function Ht(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Ua(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function zt(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Hn(t){return/[A-z]/.test(t)}function Up(t){return/\s/.test(t)}function et(t){this.font=t,this.features={}}function er(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function Jr(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function Ip(t,e){var r=Jr(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function Gp(t,e){var r=Jr(t,e.coverage);return r===-1?null:e.substitute[r]}function si(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var u=Jr(i,o);u!==-1&&r.push(u)}return r.length!==t.length?-1:r}function Np(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=si(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&zt(i[0].char);)i.shift();var u=new st(i,0),l=si(e.lookaheadCoverage,u),f=[].concat(t.backtrack);for(f.reverse();f.length&&zt(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var p=new st(f,0),v=si(e.backtrackCoverage,p),y=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&v.length===e.backtrackCoverage.length,m=[];if(y)for(var S=0;S<e.lookupRecords.length;S++)for(var T=e.lookupRecords[S],x=T.lookupListIndex,k=this.getLookupByIndex(x),A=0;A<k.subtables.length;A++){var F=k.subtables[A],D=this.getLookupMethod(k,F),X=this.getSubstitutionType(k,F);if(X==="12")for(var $=0;$<n.length;$++){var ie=t.get($),oe=D(ie);oe&&m.push(oe)}}return m}function Vp(t,e){var r=t.current,n=Jr(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],u=0;u<i.length;u++){o=i[u];for(var l=0;l<o.components.length;l++){var f=t.lookahead[l],p=o.components[l];if(f!==p)break;if(l===o.components.length-1)return o}}return null}function Hp(t,e){var r=Jr(t,e.coverage);return r===-1?null:e.sequences[r]}et.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},et.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var u=0;u<i.length;u++){var l=i[u];if(l.tag===t){var f=l.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},et.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r},et.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},et.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n},et.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return Ip.apply(r,[o,e])};case"12":return function(o){return Gp.apply(r,[o,e])};case"63":return function(o){return Np.apply(r,[o,e])};case"41":return function(o){return Vp.apply(r,[o,e])};case"21":return function(o){return Hp.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},et.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),u=0;u<o.length;u++)for(var l=o[u],f=this.getLookupSubtables(l),p=0;p<f.length;p++){var v=f[p],y=this.getSubstitutionType(l,v),m=this.getLookupMethod(l,v),S=void 0;switch(y){case"11":S=m(e.current),S&&i.splice(r,1,new er({id:11,tag:t.tag,substitution:S}));break;case"12":S=m(e.current),S&&i.splice(r,1,new er({id:12,tag:t.tag,substitution:S}));break;case"63":S=m(e),Array.isArray(S)&&S.length&&i.splice(r,1,new er({id:63,tag:t.tag,substitution:S}));break;case"41":S=m(e),S&&i.splice(r,1,new er({id:41,tag:t.tag,substitution:S}));break;case"21":S=m(e.current),S&&i.splice(r,1,new er({id:21,tag:t.tag,substitution:S}));break}e=new st(i,r),!(Array.isArray(S)&&!S.length)&&(S=null)}return i.length?i:null},et.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r},et.prototype.getLookupSubtables=function(t){return t.subtables||null},et.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null},et.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},et.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function zp(t){var e=t.current,r=t.get(-1);return r===null&&Ht(e)||!Ht(r)&&Ht(e)}function Wp(t){var e=t.get(1);return e===null||!Ht(e)}var $p={startCheck:zp,endCheck:Wp};function Yp(t){var e=t.current,r=t.get(-1);return(Ht(e)||zt(e))&&!Ht(r)}function Xp(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Ht(e)&&!zt(e)):var r=Up(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return Ht(o)||zt(o)}),!n)return!0}break;default:return!1}}var jp={startCheck:Yp,endCheck:Xp};function qp(t,e,r){e[r].setState(t.tag,t.substitution)}function Zp(t,e,r){e[r].setState(t.tag,t.substitution)}function Kp(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function Qp(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var Ia={11:qp,12:Zp,63:Kp,41:Qp};function ai(t,e,r){t instanceof er&&Ia[t.id]&&Ia[t.id](t,e,r)}function Jp(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=Ua(n),i=zt(n);if(!o&&!i)return!0;if(o)return!1}return!1}function ed(t){if(Ua(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=zt(r);if(!n)return!0}return!1}function td(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new st(o.map(function(l){return l.getState("glyphIndex")}),0),u=new st(o.map(function(l){return l.char}),0);o.forEach(function(l,f){if(!zt(l.char)){i.setCurrentIndex(f),u.setCurrentIndex(f);var p=0;Jp(u)&&(p|=1),ed(u)&&(p|=2);var v;switch(p){case 1:v="fina";break;case 2:v="init";break;case 3:v="medi";break}if(n.indexOf(v)!==-1){var y=e.query.lookupFeature({tag:v,script:r,contextParams:i});if(y instanceof Error)return console.info(y.message);y.forEach(function(m,S){m instanceof er&&(ai(m,o,S),i.context[S]=m.substitution)})}}})}}function Ga(t,e){var r=t.map(function(n){return n.activeState.value});return new st(r,e||0)}function rd(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=Ga(n);o.context.forEach(function(i,u){o.setCurrentIndex(u);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});l.length&&(l.forEach(function(f){return ai(f,n,u)}),o=Ga(n))})}function nd(t){var e=t.current,r=t.get(-1);return r===null&&Hn(e)||!Hn(r)&&Hn(e)}function od(t){var e=t.get(1);return e===null||!Hn(e)}var id={startCheck:nd,endCheck:od};function Na(t,e){var r=t.map(function(n){return n.activeState.value});return new st(r,e||0)}function sd(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=Na(n);o.context.forEach(function(i,u){o.setCurrentIndex(u);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});l.length&&(l.forEach(function(f){return ai(f,n,u)}),o=Na(n))})}function at(t){this.baseDir=t||"ltr",this.tokenizer=new Ce,this.featuresTags={}}at.prototype.setText=function(t){this.text=t},at.prototype.contextChecks={latinWordCheck:id,arabicWordCheck:$p,arabicSentenceCheck:jp};function ui(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function ad(){return ui.call(this,"latinWord"),ui.call(this,"arabicWord"),ui.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function ud(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}at.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},at.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new et(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},at.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function li(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function ld(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){li.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){td.call(t,n)})}}function cd(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){li.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){rd.call(t,o)})}}}function fd(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){li.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){sd.call(t,o)})}}}at.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},at.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(ld.call(this),cd.call(this)),this.checkContextReady("latinWord")&&fd.call(this),this.checkContextReady("arabicSentence")&&ud.call(this)},at.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),ad.call(this),this.applyFeaturesToContexts())},at.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},at.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function ge(t){t=t||{},t.tables=t.tables||{},t.empty||(qr(t.familyName,"When creating a new Font object, familyName is required."),qr(t.styleName,"When creating a new Font object, styleName is required."),qr(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),qr(t.ascender,"When creating a new Font object, ascender is required."),qr(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new ft.GlyphSet(this,t.glyphs||[]),this.encoding=new Ns(this),this.position=new jr(this),this.substitution=new Je(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new ya(this)}})}ge.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null},ge.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},ge.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},ge.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})},ge.prototype.stringToGlyphs=function(t,e){var r=this,n=new at,o=function(y){return r.charToGlyphIndex(y.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var u=n.getTextGlyphs(t),l=u.length,f=new Array(l),p=this.glyphs.get(0),v=0;v<l;v+=1)f[v]=this.glyphs.get(u[v])||p;return f},ge.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},ge.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},ge.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},ge.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0},ge.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},ge.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var u=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,o),f;if(o.kerning){var p=o.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(p,o.language)}for(var v=0;v<l.length;v+=1){var y=l[v];if(i.call(this,y,e,r,n,o),y.advanceWidth&&(e+=y.advanceWidth*u),o.kerning&&v<l.length-1){var m=f?this.position.getKerningValue(f,y.index,l[v+1].index):this.getKerningValue(y,l[v+1]);e+=m*u}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e},ge.prototype.getPath=function(t,e,r,n,o){var i=new Le;return this.forEachGlyph(t,e,r,n,o,function(u,l,f,p){var v=u.getPath(l,f,p,o,this);i.extend(v)}),i},ge.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(u,l,f,p){var v=u.getPath(l,f,p,o,this);i.push(v)}),i},ge.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})},ge.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)},ge.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(u,l,f,p){u.drawPoints(t,l,f,p)})},ge.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(u,l,f,p){u.drawMetrics(t,l,f,p)})},ge.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},ge.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},ge.prototype.toTables=function(){return Kf.fontToTable(this)},ge.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},ge.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r},ge.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(Jf())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(i),u.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),u.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),p=eh(n);f.writeFileSync(t,p)}},ge.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},ge.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},ge.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Et=new Array(10);Et[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(C.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(C.coverage),values:this.parseValueRecordList()};q.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Et[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();q.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(C.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(C.pointer(C.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var u=this.parsePointer(C.classDef),l=this.parsePointer(C.classDef),f=this.parseUShort(),p=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:u,classDef2:l,class1Count:f,class2Count:p,classRecords:this.parseList(f,C.list(p,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}},Et[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Et[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Et[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Et[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Et[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Et[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Et[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);const hd={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function pd(t){const{dir:e,xAxis:r}=hd[t];return new Ha([0,0,0],e,r)}function Va(t){const e=new R(t);let r=new R([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new R([0,1,0]),n=r.cross(e)),n.normalize()}class Ha extends Ke{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new R(n):Va(r),i=Ar(e,r,o);super(i)}get position(){return new R(this.wrapped.Location())}get direction(){return new R(this.wrapped.Direction())}get xAxis(){return new R(this.wrapped.XDirection())}get yAxis(){return new R(this.wrapped.YDirection())}autoAxes(){const e=Va(this.direction);this.wrapped.SetXDirection(gt(e))}setPosition(e){return this.wrapped.SetLocation(Qe(e)),this}setXAxis(e){return this.wrapped.SetYDirection(gt(e)),this}setYAxis(e){return this.wrapped.SetYDirection(gt(e)),this}lookAt(e){const r=new R("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const _r=t=>t.IsNull()?[]:ye(t).edges;function dd(t,e,r=!0){const n=I(),o=ve(),i=o(new n.HLRBRep_Algo_1);i.Add_2(t.wrapped,0);const u=o(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(u),i.Update(),i.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),f=[..._r(l.VCompound_1()),..._r(l.Rg1LineVCompound_1()),..._r(l.OutLineVCompound_1())];f.forEach(v=>n.BRepLib.BuildCurves3d_2(v.wrapped));const p=r?[..._r(l.HCompound_1()),..._r(l.Rg1LineHCompound_1()),..._r(l.OutLineHCompound_1())]:[];return p.forEach(v=>n.BRepLib.BuildCurves3d_2(v.wrapped)),{visible:f,hidden:p}}const tr=1e-8,Sr=(t,e)=>ze(t,e,tr*10);function vd(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(p=>({offset:Eo(p,r),original:p})),o=[];let i=null,u=n.at(-1);if(!u)return[];if(o.length===1)return o;const l=p=>{i?p.offset instanceof Ee?o.push(p.offset):Sr(p.offset.firstPoint,p.offset.lastPoint)||o.push(Lr(p.offset.firstPoint,p.offset.lastPoint)):i=p},f=function*(){for(const p of n.slice(0,-1))yield p;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const p of f()){const v=u.offset.lastPoint,y=p.offset.firstPoint;if(Sr(v,y)){l(u),u=p;continue}let m=[];if(u.offset instanceof Ee&&p.offset instanceof Ee){const{intersections:T,commonSegmentsPoints:x}=Fr(u.offset,p.offset,tr/100);m=[...T,...x]}if(m.length>0){let T=m[0];if(m.length>1){const A=u==null?void 0:u.original.lastPoint,F=m.map(D=>fl(D,A));T=m[F.indexOf(Math.min(...F))]}const x=u.offset.splitAt([T],tr)[0],k=p.offset.splitAt([T],tr).at(-1);if(!k)throw new Error("Bug in the splitting algo in offset");l({offset:x,original:u.original}),u={offset:k,original:p.original};continue}const S=Wi(v,y,u.original.lastPoint);l(u),o.push(S),u=p}return l(u),o}function gd(t,e){const r=vd(t,e);if(r.length<2)return null;const n=new Map,o=(p,v)=>{const y=n.get(p)||[];n.set(p,[...y,...v])};if(r.forEach((p,v)=>{r.slice(v+1).forEach((y,m)=>{const{intersections:S,commonSegmentsPoints:T}=Fr(p,y,tr),x=[...S,...T].filter(k=>{const A=Sr(k,p.firstPoint)||Sr(k,p.lastPoint),F=Sr(k,y.firstPoint)||Sr(k,y.lastPoint);return!(A&&F)});x.length&&(o(v,x),o(m+v+1,x))})}),!n.size){const p=new ee(r);return t.intersects(p)?null:p}const u=r.flatMap((p,v)=>{if(!n.has(v))return p;const y=n.get(v)||[];return p.splitAt(y,tr*100)}).filter(p=>!t.curves.find(y=>y.distanceFrom(p)<Math.abs(e)-tr));if(!u.length)return null;const f=qi(u).filter(p=>p.length>1).map(p=>new ee(p)).filter(p=>p.isClosed());return f.length?f.length===1?f[0]:new j(f):null}const za=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=_t(e,t[r]);return e};function zn(t,e){if(t instanceof ee)return gd(t,e);if(t instanceof j)return za(t.blueprints.map(r=>zn(r,e)));if(t instanceof ce){const r=za(t.blueprints.slice(1).map(n=>zn(n,e)));return Bt(zn(t.blueprints[0],e),r)}return null}function Wa(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],u=(f,p)=>{o({firstCurve:f,secondCurve:p,point:f.lastPoint})?i.push(...t(f,p,r)):i.push(f,p)};e.curves.slice(1).forEach(f=>{const p=i.pop();if(!p)throw new Error("Bug in the blueprint filletting algo");u(p,f)});const l=i.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(ze(i[0].firstPoint,l.lastPoint)&&i.length>1){const f=i.pop(),p=i.shift();if(!f||!p)throw new Error("Bug in the blueprint filletting algo");u(f,p)}return new ee(i)}function ci(t,e,r,n){if(e instanceof ee)return Wa(t,e,r,n);if(e instanceof ce)return new ce(e.blueprints.map(o=>Wa(t,o,r,n)));if(e instanceof j){const o=e.blueprints.map(i=>ci(t,i,r,n)).filter(i=>i!==null);return new j(o)}return null}function md(t,e,r){return ci(xo,t,e,r)}function yd(t,e,r){return ci(ko,t,e,r)}function fi(t,e){return t instanceof ee?new ee(dn(t.curves,e)):t instanceof ce?new ce(t.blueprints.map(r=>fi(r,e))):t instanceof j?new j(t.blueprints.map(r=>fi(r,e))):t}class xe{constructor(e=null){this.innerShape=e}clone(){var e;return new xe(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new Dr}stretch(e,r,n){return this.innerShape?new xe(this.innerShape.stretch(e,r,n)):new xe}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new xe(this.innerShape.rotate(e,r)):new xe}translate(e,r=0){return this.innerShape?new xe(this.innerShape.translate(e,r)):new xe}scale(e,r){return this.innerShape?new xe(this.innerShape.scale(e,r)):new xe}mirror(e,r,n){return this.innerShape?new xe(this.innerShape.mirror(e,r,n)):new xe}cut(e){return new xe(Bt(this.innerShape,e.innerShape))}fuse(e){return new xe(_t(this.innerShape,e.innerShape))}intersect(e){return new xe(zr(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new mn);return new xe(md(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new mn);return new xe(yd(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new xe(zn(this.innerShape,e))}approximate(e,r={}){if(e!=="svg")throw new Error("Only 'svg' is supported for now");return new xe(fi(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof ee)){if(this.innerShape instanceof j&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof ee)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}function wd(t,e,r=0){return new xe(ac(t,e,r))}const bd=wd,$a=t=>{const e=bd(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>Jl(o,e)),n=qi(r).map(o=>new ee(o));return n.length===0?new xe:n.length===1?new xe(n[0]):new xe(new j(n))};function xt(t,e="front"){let r;e instanceof Ha?r=e:r=pd(e);const{visible:n,hidden:o}=dd(t,r);return{visible:$a(n),hidden:$a(o)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ya=Symbol("Comlink.proxy"),_d=Symbol("Comlink.endpoint"),Sd=Symbol("Comlink.releaseProxy"),hi=Symbol("Comlink.finalizer"),Wn=Symbol("Comlink.thrown"),Xa=t=>typeof t=="object"&&t!==null||typeof t=="function",Td={canHandle:t=>Xa(t)&&t[Ya],serialize(t){const{port1:e,port2:r}=new MessageChannel;return pi(t,e),[r,[r]]},deserialize(t){return t.start(),Cd(t)}},Ed={canHandle:t=>Xa(t)&&Wn in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},ja=new Map([["proxy",Td],["throw",Ed]]);function xd(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function pi(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!xd(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:u,path:l}=Object.assign({path:[]},o.data),f=(o.data.argumentList||[]).map(rr);let p;try{const v=l.slice(0,-1).reduce((m,S)=>m[S],t),y=l.reduce((m,S)=>m[S],t);switch(u){case"GET":p=y;break;case"SET":v[l.slice(-1)[0]]=rr(o.data.value),p=!0;break;case"APPLY":p=y.apply(v,f);break;case"CONSTRUCT":{const m=new y(...f);p=Md(m)}break;case"ENDPOINT":{const{port1:m,port2:S}=new MessageChannel;pi(t,S),p=Od(m,[m])}break;case"RELEASE":p=void 0;break;default:return}}catch(v){p={value:v,[Wn]:0}}Promise.resolve(p).catch(v=>({value:v,[Wn]:0})).then(v=>{const[y,m]=jn(v);e.postMessage(Object.assign(Object.assign({},y),{id:i}),m),u==="RELEASE"&&(e.removeEventListener("message",n),qa(e),hi in t&&typeof t[hi]=="function"&&t[hi]())}).catch(v=>{const[y,m]=jn({value:new TypeError("Unserializable return value"),[Wn]:0});e.postMessage(Object.assign(Object.assign({},y),{id:i}),m)})}),e.start&&e.start()}function kd(t){return t.constructor.name==="MessagePort"}function qa(t){kd(t)&&t.close()}function Cd(t,e){const r=new Map;return t.addEventListener("message",function(o){const{data:i}=o;if(!i||!i.id)return;const u=r.get(i.id);if(u)try{u(i)}finally{r.delete(i.id)}}),di(t,r,[],e)}function $n(t){if(t)throw new Error("Proxy has been released and is not useable")}function Za(t){return Tr(t,new Map,{type:"RELEASE"}).then(()=>{qa(t)})}const Yn=new WeakMap,Xn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Yn.get(t)||0)-1;Yn.set(t,e),e===0&&Za(t)});function Pd(t,e){const r=(Yn.get(e)||0)+1;Yn.set(e,r),Xn&&Xn.register(t,e,t)}function Ad(t){Xn&&Xn.unregister(t)}function di(t,e,r=[],n=function(){}){let o=!1;const i=new Proxy(n,{get(u,l){if($n(o),l===Sd)return()=>{Ad(i),Za(t),e.clear(),o=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const f=Tr(t,e,{type:"GET",path:r.map(p=>p.toString())}).then(rr);return f.then.bind(f)}return di(t,e,[...r,l])},set(u,l,f){$n(o);const[p,v]=jn(f);return Tr(t,e,{type:"SET",path:[...r,l].map(y=>y.toString()),value:p},v).then(rr)},apply(u,l,f){$n(o);const p=r[r.length-1];if(p===_d)return Tr(t,e,{type:"ENDPOINT"}).then(rr);if(p==="bind")return di(t,e,r.slice(0,-1));const[v,y]=Ka(f);return Tr(t,e,{type:"APPLY",path:r.map(m=>m.toString()),argumentList:v},y).then(rr)},construct(u,l){$n(o);const[f,p]=Ka(l);return Tr(t,e,{type:"CONSTRUCT",path:r.map(v=>v.toString()),argumentList:f},p).then(rr)}});return Pd(i,t),i}function Rd(t){return Array.prototype.concat.apply([],t)}function Ka(t){const e=t.map(jn);return[e.map(r=>r[0]),Rd(e.map(r=>r[1]))]}const Qa=new WeakMap;function Od(t,e){return Qa.set(t,e),t}function Md(t){return Object.assign(t,{[Ya]:!0})}function jn(t){for(const[e,r]of ja)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},Qa.get(t)||[]]}function rr(t){switch(t.type){case"HANDLER":return ja.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Tr(t,e,r,n){return new Promise(o=>{const i=Dd();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function Dd(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Ja(t,e){return typeof t!="number"||isNaN(t)?{valid:!1,message:`Parameter '${e}' must be a number`}:{valid:!0}}function Fd(t,e){return t<=0?{valid:!1,message:`Parameter '${e}' must be positive`}:{valid:!0}}function Ld(t,e,r){return t>=e?{valid:!1,message:`${r} (${t}) must be less than ${e}`}:{valid:!0}}function pt(t,e){const r=Ja(t,e);return r.valid?Fd(t,e):r}function Bd(t,e,r){const n=Ja(t,r);return n.valid?Ld(t,e,r):n}function dt(t,e){return r=>{const n=[];for(const o of e){const i=t(r[o],o);i.valid||n.push(i.message)}return{valid:n.length===0,errors:n}}}function eu(t,e){return r=>{const n=r[t],o=r[e],i=Bd(n,o,t);return i.valid?{valid:!0,errors:[]}:{valid:!1,errors:[i.message]}}}function Ud(t,e){let r=!0;const n=[];if(e.params)for(const o of e.params){const{name:i,validators:u}=o;if(!u)continue;const l=t[i];for(const f of u){const p=f(l,i);if(!p.valid){r=!1,n.push(p.message);break}}}if(e.validators)for(const o of e.validators){const i=o(t);i.valid||(r=!1,n.push(...i.errors))}return{valid:r,errors:n}}function nr({width:t=100,depth:e=100,height:r=100}){if(t===0&&e===0&&r===0)return Ur([0,0,0],[1e-7,1e-7,1e-7]);const n=t/2,o=e/2;return Ur([-n,-o,0],[n,o,r])}const Id={name:"Cuboid",create:nr,params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],validators:[dt(pt,["width","depth","height"])],hasExplosion:!1};function Gd({radius:t=50}){return Bl(t)}const Nd={name:"Sphere",create:Gd,params:[{name:"radius",defaultValue:50}],validators:[dt(pt,["radius"])],hasExplosion:!1};function tu({radius:t=50,height:e=100}){return us(t,e,[0,0,0],[0,0,-1])}const Vd={name:"Cylinder",create:tu,params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],validators:[dt(pt,["radius","height"])],hasExplosion:!1};function Hd({aLength:t=80,bLength:e=50,cLength:r=30}){return Gl(t,e,r)}const zd={name:"Ellipsoid",create:Hd,params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],validators:[dt(pt,["aLength","bLength","cLength"])],hasExplosion:!1},ru=t=>t.boundingBox.center;function nu(t,e,r){return r.map(({position:n,direction:o,orientation:i})=>{const u=t(),l=e(u);let f=u.translate([n[0]-l[0],n[1]-l[1],n[2]-l[2]]);const p=[0,0,1],v=new R(i||o);if(v.Length>0){const y=new R(p).cross(v);if(y.Length>1e-10){const m=new R(p).getAngle(v);f=f.rotate(m,n,y)}else v.dot(new R(p))<0&&(f=f.rotate(180,n,[1,0,0]))}return f})}function ou(t,e,r,n,o,i=0,u=0,l=1){const f=new R([i,u,l]).normalized();return Array.from({length:e*r},(p,v)=>{const y=Math.floor(v/r),S=v%r*n,T=y*o,k=new Xe(new R(t.origin),new R(t.xDirection).normalized(),new R(t.normal).normalized()).toWorldCoords([S,T,0]);return{position:[k.x,k.y,k.z],direction:[t.normal[0],t.normal[1],t.normal[2]],orientation:[f.x,f.y,f.z]}})}function Wd(t,e,r,n=0,o=0,i=1){return ou({origin:t,xDirection:e,normal:(()=>{const u=new R(e),l=new R([0,0,1]),f=Math.abs(u.normalized().dot(l))>.99?new R([1,0,0]):u.cross(l).normalized();return[f.x,f.y,f.z]})()},1,r,r>1?new R(e).Length/(r-1):0,0,n,o,i)}function $d({count:t=5,vectorX:e=0,vectorY:r=50,vectorZ:n=50,originX:o=0,originY:i=0,originZ:u=0,boxWidth:l=10,boxDepth:f=10,boxHeight:p=10,orientationX:v=0,orientationY:y=0,orientationZ:m=1}){return wt(nu(()=>nr({width:l,depth:f,height:p}),ru,Wd([o,i,u],[e,r,n],t,v,y,m)))}const Yd={name:"DiagonalCuboidPattern",create:$d,params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[dt(pt,["count","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function Xd({originX:t=0,originY:e=0,originZ:r=0,directionX:n=1,directionY:o=0,directionZ:i=0,normalX:u=0,normalY:l=0,normalZ:f=1,rowCount:p=3,colCount:v=3,xSpacing:y=30,ySpacing:m=30,boxWidth:S=10,boxDepth:T=10,boxHeight:x=10,orientationX:k=0,orientationY:A=0,orientationZ:F=1}){return wt(nu(()=>nr({width:S,depth:T,height:x}),ru,ou({origin:[t,e,r],xDirection:[n,o,i],normal:[u,l,f]},p,v,y,m,k,A,F)))}const jd={name:"RectangularCuboidGrid",create:Xd,params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[dt(pt,["rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function iu({depth:t=100,flangeXLenght:e=50,flangeYLenght:r=50,thickness:n=5}){const o=Ur([0,-t/2,0],[e,t/2,n]),i=Ur([0,-t/2,0],[n,t/2,r]);return o.fuse(i)}const qd={name:"LProfile",create:iu,params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],validators:[dt(pt,["depth","flangeXLenght","flangeYLenght","thickness"]),eu("thickness","flangeXLenght"),eu("thickness","flangeYLenght")],hasExplosion:!1};function su({bottomRadius:t=50,topRadius:e=25,height:r=100}){return Cs(t,{plane:"XY",origin:[0,0,0]}).loftWith(Cs(e,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}const Zd={name:"Frustum",create:su,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],validators:[dt(pt,["bottomRadius","topRadius","height"])],hasExplosion:!1};function au({bottomRadius:t=50,topRadius:e=25,frustumHeight:r=80,cylinderHeight:n=40}){return su({bottomRadius:t,topRadius:e,height:r}).fuse(us(e,n,[0,0,-r],[0,0,-1]))}const Kd={name:"Drill",create:au,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],validators:[dt(pt,["bottomRadius","topRadius","frustumHeight","cylinderHeight"])],hasExplosion:!1};function uu(t,e){return{main:t,helperSpaces:e}}function Qd(t){return t.main||t}const Q={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},te={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function qn(t){let e;switch(t){case Q.FRONT:e=new R([0,-1,0]);break;case Q.BACK:e=new R([0,1,0]);break;case Q.LEFT:e=new R([-1,0,0]);break;case Q.RIGHT:e=new R([1,0,0]);break;case Q.TOP:e=new R([0,0,1]);break;case Q.BOTTOM:e=new R([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return e}function lu(t,e){const[[r,n,o],[i,u,l]]=t.bounds;let f;switch(e){case te.FRONT_TOP:f=new R([r,n,l]);break;case te.FRONT_BOTTOM:f=new R([r,n,o]);break;case te.BACK_TOP:f=new R([r,u,l]);break;case te.BACK_BOTTOM:f=new R([r,u,o]);break;case te.LEFT_TOP:f=new R([r,n,l]);break;case te.LEFT_BOTTOM:f=new R([r,n,o]);break;case te.RIGHT_TOP:f=new R([i,n,l]);break;case te.RIGHT_BOTTOM:f=new R([i,n,o]);break;case te.FRONT_LEFT:f=new R([r,n,o]);break;case te.FRONT_RIGHT:f=new R([i,n,o]);break;case te.BACK_LEFT:f=new R([r,u,o]);break;case te.BACK_RIGHT:f=new R([i,u,o]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return f}function cu(t,e){const[[r,n,o],[i,u,l]]=t.bounds;let f;switch(e){case te.FRONT_TOP:f=new R([i,n,l]);break;case te.FRONT_BOTTOM:f=new R([i,n,o]);break;case te.BACK_TOP:f=new R([i,u,l]);break;case te.BACK_BOTTOM:f=new R([i,u,o]);break;case te.LEFT_TOP:f=new R([r,u,l]);break;case te.LEFT_BOTTOM:f=new R([r,u,o]);break;case te.RIGHT_TOP:f=new R([i,u,l]);break;case te.RIGHT_BOTTOM:f=new R([i,u,o]);break;case te.FRONT_LEFT:f=new R([r,n,l]);break;case te.FRONT_RIGHT:f=new R([i,n,l]);break;case te.BACK_LEFT:f=new R([r,u,l]);break;case te.BACK_RIGHT:f=new R([i,u,l]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return f}function Jd(t){switch(t){case te.FRONT_LEFT:return[Q.FRONT,Q.LEFT];case te.FRONT_RIGHT:return[Q.FRONT,Q.RIGHT];case te.FRONT_TOP:return[Q.FRONT,Q.TOP];case te.FRONT_BOTTOM:return[Q.FRONT,Q.BOTTOM];case te.BACK_LEFT:return[Q.BACK,Q.LEFT];case te.BACK_RIGHT:return[Q.BACK,Q.RIGHT];case te.BACK_TOP:return[Q.BACK,Q.TOP];case te.BACK_BOTTOM:return[Q.BACK,Q.BOTTOM];case te.LEFT_TOP:return[Q.LEFT,Q.TOP];case te.LEFT_BOTTOM:return[Q.LEFT,Q.BOTTOM];case te.RIGHT_TOP:return[Q.RIGHT,Q.TOP];case te.RIGHT_BOTTOM:return[Q.RIGHT,Q.BOTTOM];default:throw new Error(`Unknown edge identifier: ${t}`)}}function ev(t,e,r=.5,n=.5){const[[o,i,u],[l,f,p]]=t.bounds,v=Math.max(0,Math.min(1,r)),y=Math.max(0,Math.min(1,n));let m;switch(e){case Q.FRONT:m=new R([o+(l-o)*v,i,u+(p-u)*y]);break;case Q.BACK:m=new R([o+(l-o)*v,f,u+(p-u)*y]);break;case Q.LEFT:m=new R([o,i+(f-i)*v,u+(p-u)*y]);break;case Q.RIGHT:m=new R([l,i+(f-i)*v,u+(p-u)*y]);break;case Q.TOP:m=new R([o+(l-o)*v,i+(f-i)*y,p]);break;case Q.BOTTOM:m=new R([o+(l-o)*v,i+(f-i)*y,u]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return m}function tv(t,e,r=.5){const n=Math.max(0,Math.min(1,r)),o=lu(t,e),i=cu(t,e);return new R([o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n,o.z+(i.z-o.z)*n])}function rv(t,e){const{type:r,element:n,params:o={}}=e;switch(r){case"face":return ev(t,n,o.u,o.v);case"edge":return tv(t,n,o.t);case"corner":if(n.includes("START")){const i=n.replace("_START","");return lu(t,i)}else if(n.includes("END")){const i=n.replace("_END","");return cu(t,i)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new R(t.center);default:throw new Error(`Unknown position type: ${r}`)}}function nv(t){const e=t.normalized(),r=Math.abs(e.x),n=Math.abs(e.y),o=Math.abs(e.z);let i;return r<=n&&r<=o?i=new R([0,e.z,-e.y]):n<=r&&n<=o?i=new R([e.z,0,-e.x]):i=new R([e.y,-e.x,0]),i.normalized()}function Zn(t,e,r,n={}){const o=rv(t.boundingBox,e);let i;n.normal?i=new R(n.normal):i=ov(t,e,n);let u;n.xDir?u=new R(n.xDir):u=nv(i);const l=new qt;l.coordSystemChange({origin:o.toTuple(),zDir:i.toTuple(),xDir:u.toTuple()},"reference");const f=ye(l.transform(r.wrapped));return l.delete(),i.delete(),u.delete(),o.delete(),f}function ov(t,e,r={}){const{type:n,element:o}=e;switch(n){case"face":return qn(o);case"edge":if(r.faceForEdge)return qn(r.faceForEdge);{const i=Jd(o);return qn(i[0])}case"corner":return r.faceForCorner?qn(r.faceForCorner):new R([0,0,1]);case"center":default:return new R([0,0,1])}}function or(t,e,r,n=!1){return n?ye(t.wrapped).mirror(e,r):t.mirror(e,r)}function iv({width:t=50,depth:e=100,height:r=200,showHelper:n=!0,explosionFactor:o=0}){const i=()=>{const we=nr({width:t-1,depth:20,height:.5}),pe=we.boundingBox.center,J=Zn(we,{type:"face",element:Q.TOP,params:{u:1.5/(t-1),v:2.25/20}},au({bottomRadius:1.2,topRadius:.8,frustumHeight:.5*.8,cylinderHeight:.5*.2})),be=we.cut(J).cut(or(J,"XZ",pe,!0)).cut(or(J,"YZ",pe,!0)).cut(or(or(J,"XZ",pe,!0),"YZ",pe,!0)),Te=iu({depth:20,flangeXLenght:4.5,flangeYLenght:4.5,thickness:.5}),fe=Te.boundingBox.center,me=Zn(Te,{type:"face",element:Q.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},tu({radius:.800001,height:.5})),Me=Te.cut(me).cut(or(me,"XZ",fe,!0)),Ge=Zn(be,{type:"edge",element:te.LEFT_BOTTOM,params:{t:.5}},Me,{normal:[0,0,-1],xDir:[1,0,0]}),_e=or(Ge,"YZ",pe,!0);return{cuboid:be,lProfile1:Ge,lProfile2:_e}},u=nr({width:t,depth:e,height:r}),l=Math.round(r/17.5)-1;if(l<=0){const we=nr({width:t,depth:e,height:r});return uu(wt([]),n?[we]:[])}const f=r/(l+1),p=l>1?(e-28)/(l-1):0,v=i(),y=v.cuboid.boundingBox.bounds[1][2]-v.cuboid.boundingBox.bounds[0][2],m=[];let S=0,T=-e/2+14,x=f-y;for(let we=0;we<l;we++){const pe=i(),J=o*15;m.push(pe.cuboid.clone().translate([S,T,x])),m.push(pe.lProfile1.clone().translate([S-J,T,x])),m.push(pe.lProfile2.clone().translate([S+J,T,x])),T+=p,x+=f}const k=nr({width:600,depth:20,height:.5}),A=p,F=f,D=Math.sqrt(A*A+F*F),X=D>.001?[0,A/D,F/D]:[1,0,0],ie=Zn(u,{type:"face",element:Q.RIGHT},k,{normal:[-1,0,0],xDir:X}).intersect(u),oe=u.boundingBox.center,re=or(ie,"YZ",oe,!0),he=o*30,Re=o*30;m.push(ie.translate([he,0,0])),m.push(re.translate([-Re,0,0]));const Be=wt(m);return uu(Be,n?[u]:[])}const sv={name:"HelperCuboid",create:iv,params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],validators:[dt(pt,["width","depth","height"])],hasExplosion:!0},av={Cuboid:Id,Sphere:Nd,Cylinder:Vd,Ellipsoid:zd,DiagonalCuboidPattern:Yd,RectangularCuboidGrid:jd,LProfile:qd,Frustum:Zd,Drill:Kd,HelperCuboid:sv};function fu(t,e){const r=av[t];if(!r)throw new Error(`Model "${t}" not found`);const n=Ud(e,r);return n.valid?r.create(e):{error:!0,validationErrors:n.errors}}function uv(t){const e=Qd(t),r=xt(e,"front"),n=xt(e,"top"),o=xt(e,"right");let i=[];return t&&t.main&&Array.isArray(t.helperSpaces)&&(i=[{name:"Main Component",views:{front:xt(t.main,"front"),top:xt(t.main,"top"),right:xt(t.main,"right")}}],t.helperSpaces.forEach((u,l)=>{i.push({name:`Helper Space ${l+1}`,views:{front:xt(u,"front"),top:xt(u,"top"),right:xt(u,"right")}})})),{standard:{frontView:r,topView:n,rightView:o},parts:i}}function lv(t){const e={};for(const[n,o]of Object.entries(t.standard))e[n]={visible:{paths:o.visible.toSVGPaths(),viewBox:o.visible.toSVGViewBox(2)},hidden:{paths:o.hidden.toSVGPaths(),viewBox:o.hidden.toSVGViewBox(2)},combinedViewBox:hu(o.visible.toSVGViewBox(2),o.hidden.toSVGViewBox(2))};const r=[];for(const n of t.parts){const o={};for(const[i,u]of Object.entries(n.views))o[i]={visible:{paths:u.visible.toSVGPaths(),viewBox:u.visible.toSVGViewBox(2)},hidden:{paths:u.hidden.toSVGPaths(),viewBox:u.hidden.toSVGViewBox(2)},combinedViewBox:hu(u.visible.toSVGViewBox(2),u.hidden.toSVGViewBox(2))};r.push({name:n.name,views:o})}return{standard:e,parts:r}}function hu(t,e){const r="0 0 100 100",n=v=>{if(!v)return null;const y=v.split(" ").map(parseFloat);return y.length!==4?null:{x:y[0],y:y[1],width:y[2],height:y[3]}},o=n(t)||n(r),i=n(e)||n(r);if(!o&&!i)return r;if(!o)return e||r;if(!i)return t||r;const u=Math.min(o.x,i.x),l=Math.min(o.y,i.y),f=Math.max(o.x+o.width,i.x+i.width),p=Math.max(o.y+o.height,i.y+i.height);return`${u} ${l} ${f-u} ${p-l}`}let pu=!1;const du=(async()=>{if(pu)return Promise.resolve(!0);const t=await Zu({locateFile:()=>Ku});return pu=!0,Qu(t),!0})();function cv(t,e){return console.time(`[PERF] Total ${t} creation`),du.then(()=>{console.time(`[PERF] ${t} model function`);const r=fu(t,e);if(console.timeEnd(`[PERF] ${t} model function`),r&&r.error)return{error:!0,validationErrors:r.validationErrors};if(r&&r.main&&Array.isArray(r.helperSpaces)){const u=r.main,l=r.helperSpaces,f={tolerance:.1,angularTolerance:15};console.time(`[PERF] ${t} main model generation`);const p=u.mesh(f),v=u.meshEdges(f);console.timeEnd(`[PERF] ${t} main model generation`),console.time(`[PERF] ${t} helper spaces generation`);const y=l.map(m=>({faces:m.mesh(f),edges:m.meshEdges(f)}));return console.timeEnd(`[PERF] ${t} helper spaces generation`),console.timeEnd(`[PERF] Total ${t} creation`),{faces:p,edges:v,helperSpaces:y}}const n={tolerance:.1,angularTolerance:15};console.time(`[PERF] ${t} faces generation`);const o=r.mesh(n);console.timeEnd(`[PERF] ${t} faces generation`),o&&o.triangles&&console.log(`[INFO] ${t} triangles: ${o.triangles.length/3}, vertices: ${o.vertices.length/3}`),console.time(`[PERF] ${t} edges generation`);const i=r.meshEdges(n);return console.timeEnd(`[PERF] ${t} edges generation`),console.timeEnd(`[PERF] Total ${t} creation`),{faces:o,edges:i}})}function fv(t,e){return console.time(`[PERF] Total ${t} projections creation`),du.then(()=>{const r=fu(t,e);if(r&&r.error)return{error:!0,validationErrors:r.validationErrors};console.time(`[PERF] ${t} projections generation`);const n=uv(r);console.timeEnd(`[PERF] ${t} projections generation`),console.time(`[PERF] ${t} projections processing`);const o=lv(n);return console.timeEnd(`[PERF] ${t} projections processing`),console.timeEnd(`[PERF] Total ${t} projections creation`),o})}pi({createMesh:cv,createProjections:fv})})();
