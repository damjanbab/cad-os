var Yf=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var S0=Yf(R=>{var jf=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(s,u){n=s,o=u});var i=Object.assign({},r),a="./this.program",l=(s,u)=>{throw u},c=typeof window=="object",h=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function v(s){return r.locateFile?r.locateFile(s,g):g+s}var w,E,T;function C(s){if(s instanceof Ui)return;H("exiting due to exception: "+s)}var P,M,O;d?(h?g=require("path").dirname(g)+"/":g=__dirname+"/",O=()=>{M||(P=require("fs"),M=require("path"))},w=function(u,f){return O(),u=M.normalize(u),P.readFileSync(u,f?void 0:"utf8")},T=s=>{var u=w(s,!0);return u.buffer||(u=new Uint8Array(u)),u},E=(s,u,f)=>{O(),s=M.normalize(s),P.readFile(s,function(p,m){p?f(p):u(m.buffer)})},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof Ui))throw s}),process.on("unhandledRejection",function(s){throw s}),l=(s,u)=>{if(nn())throw process.exitCode=s,u;C(u),process.exit(s)},r.inspect=function(){return"[Emscripten Module object]"}):(c||h)&&(h?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",w=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.send(null),u.responseText},h&&(T=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),E=(s,u,f)=>{var p=new XMLHttpRequest;p.open("GET",s,!0),p.responseType="arraybuffer",p.onload=()=>{if(p.status==200||p.status==0&&p.response){u(p.response);return}f()},p.onerror=f,p.send(null)});var Y=r.print||console.log.bind(console),H=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(a=r.thisProgram),r.quit&&(l=r.quit);var K=4,j;r.wasmBinary&&(j=r.wasmBinary);var Q=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Dt("no native wasm support detected");var oe,de=!1;function we(s,u){s||Dt(u)}var Te=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function xe(s,u,f){for(var p=u+f,m=u;s[m]&&!(m>=p);)++m;if(m-u>16&&s.buffer&&Te)return Te.decode(s.subarray(u,m));for(var _="";u<m;){var b=s[u++];if(!(b&128)){_+=String.fromCharCode(b);continue}var S=s[u++]&63;if((b&224)==192){_+=String.fromCharCode((b&31)<<6|S);continue}var x=s[u++]&63;if((b&240)==224?b=(b&15)<<12|S<<6|x:b=(b&7)<<18|S<<12|x<<6|s[u++]&63,b<65536)_+=String.fromCharCode(b);else{var k=b-65536;_+=String.fromCharCode(55296|k>>10,56320|k&1023)}}return _}function se(s,u){return s?xe(De,s,u):""}function fe(s,u,f,p){if(!(p>0))return 0;for(var m=f,_=f+p-1,b=0;b<s.length;++b){var S=s.charCodeAt(b);if(S>=55296&&S<=57343){var x=s.charCodeAt(++b);S=65536+((S&1023)<<10)|x&1023}if(S<=127){if(f>=_)break;u[f++]=S}else if(S<=2047){if(f+1>=_)break;u[f++]=192|S>>6,u[f++]=128|S&63}else if(S<=65535){if(f+2>=_)break;u[f++]=224|S>>12,u[f++]=128|S>>6&63,u[f++]=128|S&63}else{if(f+3>=_)break;u[f++]=240|S>>18,u[f++]=128|S>>12&63,u[f++]=128|S>>6&63,u[f++]=128|S&63}}return u[f]=0,f-m}function be(s,u,f){return fe(s,De,u,f)}function ie(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&(p=65536+((p&1023)<<10)|s.charCodeAt(++f)&1023),p<=127?++u:p<=2047?u+=2:p<=65535?u+=3:u+=4}return u}var te=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ue(s,u){for(var f=s,p=f>>1,m=p+u/2;!(p>=m)&&nt[p];)++p;if(f=p<<1,f-s>32&&te)return te.decode(De.subarray(s,f));for(var _="",b=0;!(b>=u/2);++b){var S=ke[s+b*2>>1];if(S==0)break;_+=String.fromCharCode(S)}return _}function Ae(s,u,f){if(f===void 0&&(f=2147483647),f<2)return 0;f-=2;for(var p=u,m=f<s.length*2?f/2:s.length,_=0;_<m;++_){var b=s.charCodeAt(_);ke[u>>1]=b,u+=2}return ke[u>>1]=0,u-p}function ve(s){return s.length*2}function Be(s,u){for(var f=0,p="";!(f>=u/4);){var m=L[s+f*4>>2];if(m==0)break;if(++f,m>=65536){var _=m-65536;p+=String.fromCharCode(55296|_>>10,56320|_&1023)}else p+=String.fromCharCode(m)}return p}function Ot(s,u,f){if(f===void 0&&(f=2147483647),f<4)return 0;for(var p=u,m=p+f-4,_=0;_<s.length;++_){var b=s.charCodeAt(_);if(b>=55296&&b<=57343){var S=s.charCodeAt(++_);b=65536+((b&1023)<<10)|S&1023}if(L[u>>2]=b,u+=4,u+4>m)break}return L[u>>2]=0,u-p}function Ke(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&++f,u+=4}return u}function je(s){var u=ie(s)+1,f=Vt(u);return f&&fe(s,me,f,u),f}function rt(s,u){me.set(s,u)}function Jt(s,u,f){for(var p=0;p<s.length;++p)me[u++>>0]=s.charCodeAt(p);f||(me[u>>0]=0)}var at,me,De,ke,nt,L,he,ut,Wn;function wt(s){at=s,r.HEAP8=me=new Int8Array(s),r.HEAP16=ke=new Int16Array(s),r.HEAP32=L=new Int32Array(s),r.HEAPU8=De=new Uint8Array(s),r.HEAPU16=nt=new Uint16Array(s),r.HEAPU32=he=new Uint32Array(s),r.HEAPF32=ut=new Float32Array(s),r.HEAPF64=Wn=new Float64Array(s)}r.INITIAL_MEMORY;var It,zn=[],$n=[],rn=[];function nn(){return Q}function Xn(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)li(r.preRun.shift());Dr(zn)}function Yn(){!r.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,Dr($n)}function jn(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)ci(r.postRun.shift());Dr(rn)}function li(s){zn.unshift(s)}function Zn(s){$n.unshift(s)}function ci(s){rn.unshift(s)}var _t=0,gr=null;function Fs(s){return s}function mr(s){_t++,r.monitorRunDependencies&&r.monitorRunDependencies(_t)}function Or(s){if(_t--,r.monitorRunDependencies&&r.monitorRunDependencies(_t),_t==0&&gr){var u=gr;gr=null,u()}}function Dt(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",H(s),de=!0,s+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(s);throw o(u),u}var on="data:application/octet-stream;base64,";function qn(s){return s.startsWith(on)}function Kn(s){return s.startsWith("file://")}var ze;ze="replicad_single.wasm",qn(ze)||(ze=v(ze));function er(s){try{if(s==ze&&j)return new Uint8Array(j);if(T)return T(s);throw"both async and sync fetching of the wasm failed"}catch(u){Dt(u)}}function fi(){if(!j&&(c||h)){if(typeof fetch=="function"&&!Kn(ze))return fetch(ze,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+ze+"'";return s.arrayBuffer()}).catch(function(){return er(ze)});if(E)return new Promise(function(s,u){E(ze,function(f){s(new Uint8Array(f))},u)})}return Promise.resolve().then(function(){return er(ze)})}function hi(){var s={a:zf};function u(b,S){var x=b.exports;r.asm=x,oe=r.asm.oa,wt(oe.buffer),It=r.asm.va,Zn(r.asm.pa),Or()}mr();function f(b){u(b.instance)}function p(b){return fi().then(function(S){return WebAssembly.instantiate(S,s)}).then(function(S){return S}).then(b,function(S){H("failed to asynchronously prepare wasm: "+S),Dt(S)})}function m(){return!j&&typeof WebAssembly.instantiateStreaming=="function"&&!qn(ze)&&!Kn(ze)&&!d&&typeof fetch=="function"?fetch(ze,{credentials:"same-origin"}).then(function(b){var S=WebAssembly.instantiateStreaming(b,s);return S.then(f,function(x){return H("wasm streaming compile failed: "+x),H("falling back to ArrayBuffer instantiation"),p(f)})}):p(f)}if(r.instantiateWasm)try{var _=r.instantiateWasm(s,u);return _}catch(b){return H("Module.instantiateWasm callback failed with error: "+b),!1}return m().catch(o),{}}var We,bt;function Qn(){return r.HEAP8.length}function Dr(s){for(;s.length>0;){var u=s.shift();if(typeof u=="function"){u(r);continue}var f=u.func;typeof f=="number"?u.arg===void 0?Br(f)():Br(f)(u.arg):f(u.arg===void 0?null:u.arg)}}var Mr=[];function Br(s){var u=Mr[s];return u||(s>=Mr.length&&(Mr.length=s+1),Mr[s]=u=It.get(s)),u}function Jn(s,u,f,p){Dt("Assertion failed: "+se(s)+", at: "+[u?se(u):"unknown filename",f,p?se(p):"unknown function"])}function eo(s){return Vt(s+24)+24}function pi(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(u){he[this.ptr+4>>2]=u},this.get_type=function(){return he[this.ptr+4>>2]},this.set_destructor=function(u){he[this.ptr+8>>2]=u},this.get_destructor=function(){return he[this.ptr+8>>2]},this.set_refcount=function(u){L[this.ptr>>2]=u},this.set_caught=function(u){u=u?1:0,me[this.ptr+12>>0]=u},this.get_caught=function(){return me[this.ptr+12>>0]!=0},this.set_rethrown=function(u){u=u?1:0,me[this.ptr+13>>0]=u},this.get_rethrown=function(){return me[this.ptr+13>>0]!=0},this.init=function(u,f){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(f),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var u=L[this.ptr>>2];L[this.ptr>>2]=u+1},this.release_ref=function(){var u=L[this.ptr>>2];return L[this.ptr>>2]=u-1,u===1},this.set_adjusted_ptr=function(u){he[this.ptr+16>>2]=u},this.get_adjusted_ptr=function(){return he[this.ptr+16>>2]},this.get_exception_ptr=function(){var u=oa(this.get_type());if(u)return he[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}function di(s,u,f){var p=new pi(s);throw p.init(u,f),s}var ge={isAbs:s=>s.charAt(0)==="/",splitPath:s=>{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return u.exec(s).slice(1)},normalizeArray:(s,u)=>{for(var f=0,p=s.length-1;p>=0;p--){var m=s[p];m==="."?s.splice(p,1):m===".."?(s.splice(p,1),f++):f&&(s.splice(p,1),f--)}if(u)for(;f;f--)s.unshift("..");return s},normalize:s=>{var u=ge.isAbs(s),f=s.substr(-1)==="/";return s=ge.normalizeArray(s.split("/").filter(p=>!!p),!u).join("/"),!s&&!u&&(s="."),s&&f&&(s+="/"),(u?"/":"")+s},dirname:s=>{var u=ge.splitPath(s),f=u[0],p=u[1];return!f&&!p?".":(p&&(p=p.substr(0,p.length-1)),f+p)},basename:s=>{if(s==="/")return"/";s=ge.normalize(s),s=s.replace(/\/$/,"");var u=s.lastIndexOf("/");return u===-1?s:s.substr(u+1)},join:function(){var s=Array.prototype.slice.call(arguments,0);return ge.normalize(s.join("/"))},join2:(s,u)=>ge.normalize(s+"/"+u)};function Fr(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var s=new Uint8Array(1);return function(){return crypto.getRandomValues(s),s[0]}}else if(d)try{var u=require("crypto");return function(){return u.randomBytes(1)[0]}}catch{}return function(){Dt("randomDevice")}}var ct={resolve:function(){for(var s="",u=!1,f=arguments.length-1;f>=-1&&!u;f--){var p=f>=0?arguments[f]:y.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)return"";s=p+"/"+s,u=ge.isAbs(p)}return s=ge.normalizeArray(s.split("/").filter(m=>!!m),!u).join("/"),(u?"/":"")+s||"."},relative:(s,u)=>{s=ct.resolve(s).substr(1),u=ct.resolve(u).substr(1);function f(k){for(var U=0;U<k.length&&k[U]==="";U++);for(var I=k.length-1;I>=0&&k[I]==="";I--);return U>I?[]:k.slice(U,I-U+1)}for(var p=f(s.split("/")),m=f(u.split("/")),_=Math.min(p.length,m.length),b=_,S=0;S<_;S++)if(p[S]!==m[S]){b=S;break}for(var x=[],S=b;S<p.length;S++)x.push("..");return x=x.concat(m.slice(b)),x.join("/")}},Gt={ttys:[],init:function(){},shutdown:function(){},register:function(s,u){Gt.ttys[s]={input:[],output:[],ops:u},y.registerDevice(s,Gt.stream_ops)},stream_ops:{open:function(s){var u=Gt.ttys[s.node.rdev];if(!u)throw new y.ErrnoError(43);s.tty=u,s.seekable=!1},close:function(s){s.tty.ops.flush(s.tty)},flush:function(s){s.tty.ops.flush(s.tty)},read:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.get_char)throw new y.ErrnoError(60);for(var _=0,b=0;b<p;b++){var S;try{S=s.tty.ops.get_char(s.tty)}catch{throw new y.ErrnoError(29)}if(S===void 0&&_===0)throw new y.ErrnoError(6);if(S==null)break;_++,u[f+b]=S}return _&&(s.node.timestamp=Date.now()),_},write:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var _=0;_<p;_++)s.tty.ops.put_char(s.tty,u[f+_])}catch{throw new y.ErrnoError(29)}return p&&(s.node.timestamp=Date.now()),_}},default_tty_ops:{get_char:function(s){if(!s.input.length){var u=null;if(d){var f=256,p=Buffer.alloc(f),m=0;try{m=P.readSync(process.stdin.fd,p,0,f,-1)}catch(_){if(_.toString().includes("EOF"))m=0;else throw _}m>0?u=p.slice(0,m).toString("utf-8"):u=null}else typeof window<"u"&&typeof window.prompt=="function"?(u=window.prompt("Input: "),u!==null&&(u+=`
`)):typeof readline=="function"&&(u=readline(),u!==null&&(u+=`
`));if(!u)return null;s.input=bo(u,!0)}return s.input.shift()},put_char:function(s,u){u===null||u===10?(Y(xe(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&(Y(xe(s.output,0)),s.output=[])}},default_tty1_ops:{put_char:function(s,u){u===null||u===10?(H(xe(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&(H(xe(s.output,0)),s.output=[])}}};function sn(s,u){De.fill(0,s,s+u)}function an(s,u){return Math.ceil(s/u)*u}function Lr(s){s=an(s,65536);var u=na(65536,s);return u?(sn(u,s),u):0}var ee={ops_table:null,mount:function(s){return ee.createNode(null,"/",16895,0)},createNode:function(s,u,f,p){if(y.isBlkdev(f)||y.isFIFO(f))throw new y.ErrnoError(63);ee.ops_table||(ee.ops_table={dir:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,lookup:ee.node_ops.lookup,mknod:ee.node_ops.mknod,rename:ee.node_ops.rename,unlink:ee.node_ops.unlink,rmdir:ee.node_ops.rmdir,readdir:ee.node_ops.readdir,symlink:ee.node_ops.symlink},stream:{llseek:ee.stream_ops.llseek}},file:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:{llseek:ee.stream_ops.llseek,read:ee.stream_ops.read,write:ee.stream_ops.write,allocate:ee.stream_ops.allocate,mmap:ee.stream_ops.mmap,msync:ee.stream_ops.msync}},link:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,readlink:ee.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:y.chrdev_stream_ops}});var m=y.createNode(s,u,f,p);return y.isDir(m.mode)?(m.node_ops=ee.ops_table.dir.node,m.stream_ops=ee.ops_table.dir.stream,m.contents={}):y.isFile(m.mode)?(m.node_ops=ee.ops_table.file.node,m.stream_ops=ee.ops_table.file.stream,m.usedBytes=0,m.contents=null):y.isLink(m.mode)?(m.node_ops=ee.ops_table.link.node,m.stream_ops=ee.ops_table.link.stream):y.isChrdev(m.mode)&&(m.node_ops=ee.ops_table.chrdev.node,m.stream_ops=ee.ops_table.chrdev.stream),m.timestamp=Date.now(),s&&(s.contents[u]=m,s.timestamp=m.timestamp),m},getFileDataAsTypedArray:function(s){return s.contents?s.contents.subarray?s.contents.subarray(0,s.usedBytes):new Uint8Array(s.contents):new Uint8Array(0)},expandFileStorage:function(s,u){var f=s.contents?s.contents.length:0;if(!(f>=u)){var p=1024*1024;u=Math.max(u,f*(f<p?2:1.125)>>>0),f!=0&&(u=Math.max(u,256));var m=s.contents;s.contents=new Uint8Array(u),s.usedBytes>0&&s.contents.set(m.subarray(0,s.usedBytes),0)}},resizeFileStorage:function(s,u){if(s.usedBytes!=u)if(u==0)s.contents=null,s.usedBytes=0;else{var f=s.contents;s.contents=new Uint8Array(u),f&&s.contents.set(f.subarray(0,Math.min(u,s.usedBytes))),s.usedBytes=u}},node_ops:{getattr:function(s){var u={};return u.dev=y.isChrdev(s.mode)?s.id:1,u.ino=s.id,u.mode=s.mode,u.nlink=1,u.uid=0,u.gid=0,u.rdev=s.rdev,y.isDir(s.mode)?u.size=4096:y.isFile(s.mode)?u.size=s.usedBytes:y.isLink(s.mode)?u.size=s.link.length:u.size=0,u.atime=new Date(s.timestamp),u.mtime=new Date(s.timestamp),u.ctime=new Date(s.timestamp),u.blksize=4096,u.blocks=Math.ceil(u.size/u.blksize),u},setattr:function(s,u){u.mode!==void 0&&(s.mode=u.mode),u.timestamp!==void 0&&(s.timestamp=u.timestamp),u.size!==void 0&&ee.resizeFileStorage(s,u.size)},lookup:function(s,u){throw y.genericErrors[44]},mknod:function(s,u,f,p){return ee.createNode(s,u,f,p)},rename:function(s,u,f){if(y.isDir(s.mode)){var p;try{p=y.lookupNode(u,f)}catch{}if(p)for(var m in p.contents)throw new y.ErrnoError(55)}delete s.parent.contents[s.name],s.parent.timestamp=Date.now(),s.name=f,u.contents[f]=s,u.timestamp=s.parent.timestamp,s.parent=u},unlink:function(s,u){delete s.contents[u],s.timestamp=Date.now()},rmdir:function(s,u){var f=y.lookupNode(s,u);for(var p in f.contents)throw new y.ErrnoError(55);delete s.contents[u],s.timestamp=Date.now()},readdir:function(s){var u=[".",".."];for(var f in s.contents)s.contents.hasOwnProperty(f)&&u.push(f);return u},symlink:function(s,u,f){var p=ee.createNode(s,u,41471,0);return p.link=f,p},readlink:function(s){if(!y.isLink(s.mode))throw new y.ErrnoError(28);return s.link}},stream_ops:{read:function(s,u,f,p,m){var _=s.node.contents;if(m>=s.node.usedBytes)return 0;var b=Math.min(s.node.usedBytes-m,p);if(b>8&&_.subarray)u.set(_.subarray(m,m+b),f);else for(var S=0;S<b;S++)u[f+S]=_[m+S];return b},write:function(s,u,f,p,m,_){if(u.buffer===me.buffer&&(_=!1),!p)return 0;var b=s.node;if(b.timestamp=Date.now(),u.subarray&&(!b.contents||b.contents.subarray)){if(_)return b.contents=u.subarray(f,f+p),b.usedBytes=p,p;if(b.usedBytes===0&&m===0)return b.contents=u.slice(f,f+p),b.usedBytes=p,p;if(m+p<=b.usedBytes)return b.contents.set(u.subarray(f,f+p),m),p}if(ee.expandFileStorage(b,m+p),b.contents.subarray&&u.subarray)b.contents.set(u.subarray(f,f+p),m);else for(var S=0;S<p;S++)b.contents[m+S]=u[f+S];return b.usedBytes=Math.max(b.usedBytes,m+p),p},llseek:function(s,u,f){var p=u;if(f===1?p+=s.position:f===2&&y.isFile(s.node.mode)&&(p+=s.node.usedBytes),p<0)throw new y.ErrnoError(28);return p},allocate:function(s,u,f){ee.expandFileStorage(s.node,u+f),s.node.usedBytes=Math.max(s.node.usedBytes,u+f)},mmap:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);var _,b,S=s.node.contents;if(!(m&2)&&S.buffer===at)b=!1,_=S.byteOffset;else{if((f>0||f+u<S.length)&&(S.subarray?S=S.subarray(f,f+u):S=Array.prototype.slice.call(S,f,f+u)),b=!0,_=Lr(u),!_)throw new y.ErrnoError(48);me.set(S,_)}return{ptr:_,allocated:b}},msync:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);return m&2||ee.stream_ops.write(s,u,0,p,f,!1),0}}};function vi(s,u,f,p){var m=p?"":"al "+s;E(s,function(_){we(_,'Loading data file "'+s+'" failed (no arrayBuffer).'),u(new Uint8Array(_)),m&&Or()},function(_){if(f)f();else throw'Loading data file "'+s+'" failed.'}),m&&mr()}var y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(s,u={})=>{if(s=ct.resolve(y.cwd(),s),!s)return{path:"",node:null};var f={follow_mount:!0,recurse_count:0};if(u=Object.assign(f,u),u.recurse_count>8)throw new y.ErrnoError(32);for(var p=ge.normalizeArray(s.split("/").filter(I=>!!I),!1),m=y.root,_="/",b=0;b<p.length;b++){var S=b===p.length-1;if(S&&u.parent)break;if(m=y.lookupNode(m,p[b]),_=ge.join2(_,p[b]),y.isMountpoint(m)&&(!S||S&&u.follow_mount)&&(m=m.mounted.root),!S||u.follow)for(var x=0;y.isLink(m.mode);){var k=y.readlink(_);_=ct.resolve(ge.dirname(_),k);var U=y.lookupPath(_,{recurse_count:u.recurse_count+1});if(m=U.node,x++>40)throw new y.ErrnoError(32)}}return{path:_,node:m}},getPath:s=>{for(var u;;){if(y.isRoot(s)){var f=s.mount.mountpoint;return u?f[f.length-1]!=="/"?f+"/"+u:f+u:f}u=u?s.name+"/"+u:s.name,s=s.parent}},hashName:(s,u)=>{for(var f=0,p=0;p<u.length;p++)f=(f<<5)-f+u.charCodeAt(p)|0;return(s+f>>>0)%y.nameTable.length},hashAddNode:s=>{var u=y.hashName(s.parent.id,s.name);s.name_next=y.nameTable[u],y.nameTable[u]=s},hashRemoveNode:s=>{var u=y.hashName(s.parent.id,s.name);if(y.nameTable[u]===s)y.nameTable[u]=s.name_next;else for(var f=y.nameTable[u];f;){if(f.name_next===s){f.name_next=s.name_next;break}f=f.name_next}},lookupNode:(s,u)=>{var f=y.mayLookup(s);if(f)throw new y.ErrnoError(f,s);for(var p=y.hashName(s.id,u),m=y.nameTable[p];m;m=m.name_next){var _=m.name;if(m.parent.id===s.id&&_===u)return m}return y.lookup(s,u)},createNode:(s,u,f,p)=>{var m=new y.FSNode(s,u,f,p);return y.hashAddNode(m),m},destroyNode:s=>{y.hashRemoveNode(s)},isRoot:s=>s===s.parent,isMountpoint:s=>!!s.mounted,isFile:s=>(s&61440)===32768,isDir:s=>(s&61440)===16384,isLink:s=>(s&61440)===40960,isChrdev:s=>(s&61440)===8192,isBlkdev:s=>(s&61440)===24576,isFIFO:s=>(s&61440)===4096,isSocket:s=>(s&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:s=>{var u=y.flagModes[s];if(typeof u>"u")throw new Error("Unknown file open mode: "+s);return u},flagsToPermissionString:s=>{var u=["r","w","rw"][s&3];return s&512&&(u+="w"),u},nodePermissions:(s,u)=>y.ignorePermissions?0:u.includes("r")&&!(s.mode&292)||u.includes("w")&&!(s.mode&146)||u.includes("x")&&!(s.mode&73)?2:0,mayLookup:s=>{var u=y.nodePermissions(s,"x");return u||(s.node_ops.lookup?0:2)},mayCreate:(s,u)=>{try{var f=y.lookupNode(s,u);return 20}catch{}return y.nodePermissions(s,"wx")},mayDelete:(s,u,f)=>{var p;try{p=y.lookupNode(s,u)}catch(_){return _.errno}var m=y.nodePermissions(s,"wx");if(m)return m;if(f){if(!y.isDir(p.mode))return 54;if(y.isRoot(p)||y.getPath(p)===y.cwd())return 10}else if(y.isDir(p.mode))return 31;return 0},mayOpen:(s,u)=>s?y.isLink(s.mode)?32:y.isDir(s.mode)&&(y.flagsToPermissionString(u)!=="r"||u&512)?31:y.nodePermissions(s,y.flagsToPermissionString(u)):44,MAX_OPEN_FDS:4096,nextfd:(s=0,u=y.MAX_OPEN_FDS)=>{for(var f=s;f<=u;f++)if(!y.streams[f])return f;throw new y.ErrnoError(33)},getStream:s=>y.streams[s],createStream:(s,u,f)=>{y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get:function(){return this.node},set:function(m){this.node=m}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(m){this.shared.flags=m}},position:{get:function(){return this.shared.position},set:function(m){this.shared.position=m}}})),s=Object.assign(new y.FSStream,s);var p=y.nextfd(u,f);return s.fd=p,y.streams[p]=s,s},closeStream:s=>{y.streams[s]=null},chrdev_stream_ops:{open:s=>{var u=y.getDevice(s.node.rdev);s.stream_ops=u.stream_ops,s.stream_ops.open&&s.stream_ops.open(s)},llseek:()=>{throw new y.ErrnoError(70)}},major:s=>s>>8,minor:s=>s&255,makedev:(s,u)=>s<<8|u,registerDevice:(s,u)=>{y.devices[s]={stream_ops:u}},getDevice:s=>y.devices[s],getMounts:s=>{for(var u=[],f=[s];f.length;){var p=f.pop();u.push(p),f.push.apply(f,p.mounts)}return u},syncfs:(s,u)=>{typeof s=="function"&&(u=s,s=!1),y.syncFSRequests++,y.syncFSRequests>1&&H("warning: "+y.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var f=y.getMounts(y.root.mount),p=0;function m(b){return y.syncFSRequests--,u(b)}function _(b){if(b)return _.errored?void 0:(_.errored=!0,m(b));++p>=f.length&&m(null)}f.forEach(b=>{if(!b.type.syncfs)return _(null);b.type.syncfs(b,s,_)})},mount:(s,u,f)=>{var p=f==="/",m=!f,_;if(p&&y.root)throw new y.ErrnoError(10);if(!p&&!m){var b=y.lookupPath(f,{follow_mount:!1});if(f=b.path,_=b.node,y.isMountpoint(_))throw new y.ErrnoError(10);if(!y.isDir(_.mode))throw new y.ErrnoError(54)}var S={type:s,opts:u,mountpoint:f,mounts:[]},x=s.mount(S);return x.mount=S,S.root=x,p?y.root=x:_&&(_.mounted=S,_.mount&&_.mount.mounts.push(S)),x},unmount:s=>{var u=y.lookupPath(s,{follow_mount:!1});if(!y.isMountpoint(u.node))throw new y.ErrnoError(28);var f=u.node,p=f.mounted,m=y.getMounts(p);Object.keys(y.nameTable).forEach(b=>{for(var S=y.nameTable[b];S;){var x=S.name_next;m.includes(S.mount)&&y.destroyNode(S),S=x}}),f.mounted=null;var _=f.mount.mounts.indexOf(p);f.mount.mounts.splice(_,1)},lookup:(s,u)=>s.node_ops.lookup(s,u),mknod:(s,u,f)=>{var p=y.lookupPath(s,{parent:!0}),m=p.node,_=ge.basename(s);if(!_||_==="."||_==="..")throw new y.ErrnoError(28);var b=y.mayCreate(m,_);if(b)throw new y.ErrnoError(b);if(!m.node_ops.mknod)throw new y.ErrnoError(63);return m.node_ops.mknod(m,_,u,f)},create:(s,u)=>(u=u!==void 0?u:438,u&=4095,u|=32768,y.mknod(s,u,0)),mkdir:(s,u)=>(u=u!==void 0?u:511,u&=1023,u|=16384,y.mknod(s,u,0)),mkdirTree:(s,u)=>{for(var f=s.split("/"),p="",m=0;m<f.length;++m)if(f[m]){p+="/"+f[m];try{y.mkdir(p,u)}catch(_){if(_.errno!=20)throw _}}},mkdev:(s,u,f)=>(typeof f>"u"&&(f=u,u=438),u|=8192,y.mknod(s,u,f)),symlink:(s,u)=>{if(!ct.resolve(s))throw new y.ErrnoError(44);var f=y.lookupPath(u,{parent:!0}),p=f.node;if(!p)throw new y.ErrnoError(44);var m=ge.basename(u),_=y.mayCreate(p,m);if(_)throw new y.ErrnoError(_);if(!p.node_ops.symlink)throw new y.ErrnoError(63);return p.node_ops.symlink(p,m,s)},rename:(s,u)=>{var f=ge.dirname(s),p=ge.dirname(u),m=ge.basename(s),_=ge.basename(u),b,S,x;if(b=y.lookupPath(s,{parent:!0}),S=b.node,b=y.lookupPath(u,{parent:!0}),x=b.node,!S||!x)throw new y.ErrnoError(44);if(S.mount!==x.mount)throw new y.ErrnoError(75);var k=y.lookupNode(S,m),U=ct.relative(s,p);if(U.charAt(0)!==".")throw new y.ErrnoError(28);if(U=ct.relative(u,f),U.charAt(0)!==".")throw new y.ErrnoError(55);var I;try{I=y.lookupNode(x,_)}catch{}if(k!==I){var F=y.isDir(k.mode),V=y.mayDelete(S,m,F);if(V)throw new y.ErrnoError(V);if(V=I?y.mayDelete(x,_,F):y.mayCreate(x,_),V)throw new y.ErrnoError(V);if(!S.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(k)||I&&y.isMountpoint(I))throw new y.ErrnoError(10);if(x!==S&&(V=y.nodePermissions(S,"w"),V))throw new y.ErrnoError(V);y.hashRemoveNode(k);try{S.node_ops.rename(k,x,_)}catch(q){throw q}finally{y.hashAddNode(k)}}},rmdir:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node,p=ge.basename(s),m=y.lookupNode(f,p),_=y.mayDelete(f,p,!0);if(_)throw new y.ErrnoError(_);if(!f.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.rmdir(f,p),y.destroyNode(m)},readdir:s=>{var u=y.lookupPath(s,{follow:!0}),f=u.node;if(!f.node_ops.readdir)throw new y.ErrnoError(54);return f.node_ops.readdir(f)},unlink:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node;if(!f)throw new y.ErrnoError(44);var p=ge.basename(s),m=y.lookupNode(f,p),_=y.mayDelete(f,p,!1);if(_)throw new y.ErrnoError(_);if(!f.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.unlink(f,p),y.destroyNode(m)},readlink:s=>{var u=y.lookupPath(s),f=u.node;if(!f)throw new y.ErrnoError(44);if(!f.node_ops.readlink)throw new y.ErrnoError(28);return ct.resolve(y.getPath(f.parent),f.node_ops.readlink(f))},stat:(s,u)=>{var f=y.lookupPath(s,{follow:!u}),p=f.node;if(!p)throw new y.ErrnoError(44);if(!p.node_ops.getattr)throw new y.ErrnoError(63);return p.node_ops.getattr(p)},lstat:s=>y.stat(s,!0),chmod:(s,u,f)=>{var p;if(typeof s=="string"){var m=y.lookupPath(s,{follow:!f});p=m.node}else p=s;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{mode:u&4095|p.mode&-4096,timestamp:Date.now()})},lchmod:(s,u)=>{y.chmod(s,u,!0)},fchmod:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);y.chmod(f.node,u)},chown:(s,u,f,p)=>{var m;if(typeof s=="string"){var _=y.lookupPath(s,{follow:!p});m=_.node}else m=s;if(!m.node_ops.setattr)throw new y.ErrnoError(63);m.node_ops.setattr(m,{timestamp:Date.now()})},lchown:(s,u,f)=>{y.chown(s,u,f,!0)},fchown:(s,u,f)=>{var p=y.getStream(s);if(!p)throw new y.ErrnoError(8);y.chown(p.node,u,f)},truncate:(s,u)=>{if(u<0)throw new y.ErrnoError(28);var f;if(typeof s=="string"){var p=y.lookupPath(s,{follow:!0});f=p.node}else f=s;if(!f.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(f.mode))throw new y.ErrnoError(31);if(!y.isFile(f.mode))throw new y.ErrnoError(28);var m=y.nodePermissions(f,"w");if(m)throw new y.ErrnoError(m);f.node_ops.setattr(f,{size:u,timestamp:Date.now()})},ftruncate:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);if(!(f.flags&2097155))throw new y.ErrnoError(28);y.truncate(f.node,u)},utime:(s,u,f)=>{var p=y.lookupPath(s,{follow:!0}),m=p.node;m.node_ops.setattr(m,{timestamp:Math.max(u,f)})},open:(s,u,f)=>{if(s==="")throw new y.ErrnoError(44);u=typeof u=="string"?y.modeStringToFlags(u):u,f=typeof f>"u"?438:f,u&64?f=f&4095|32768:f=0;var p;if(typeof s=="object")p=s;else{s=ge.normalize(s);try{var m=y.lookupPath(s,{follow:!(u&131072)});p=m.node}catch{}}var _=!1;if(u&64)if(p){if(u&128)throw new y.ErrnoError(20)}else p=y.mknod(s,f,0),_=!0;if(!p)throw new y.ErrnoError(44);if(y.isChrdev(p.mode)&&(u&=-513),u&65536&&!y.isDir(p.mode))throw new y.ErrnoError(54);if(!_){var b=y.mayOpen(p,u);if(b)throw new y.ErrnoError(b)}u&512&&!_&&y.truncate(p,0),u&=-131713;var S=y.createStream({node:p,path:y.getPath(p),flags:u,seekable:!0,position:0,stream_ops:p.stream_ops,ungotten:[],error:!1});return S.stream_ops.open&&S.stream_ops.open(S),r.logReadFiles&&!(u&1)&&(y.readFiles||(y.readFiles={}),s in y.readFiles||(y.readFiles[s]=1)),S},close:s=>{if(y.isClosed(s))throw new y.ErrnoError(8);s.getdents&&(s.getdents=null);try{s.stream_ops.close&&s.stream_ops.close(s)}catch(u){throw u}finally{y.closeStream(s.fd)}s.fd=null},isClosed:s=>s.fd===null,llseek:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(!s.seekable||!s.stream_ops.llseek)throw new y.ErrnoError(70);if(f!=0&&f!=1&&f!=2)throw new y.ErrnoError(28);return s.position=s.stream_ops.llseek(s,u,f),s.ungotten=[],s.position},read:(s,u,f,p,m)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if((s.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.read)throw new y.ErrnoError(28);var _=typeof m<"u";if(!_)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var b=s.stream_ops.read(s,u,f,p,m);return _||(s.position+=b),b},write:(s,u,f,p,m,_)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.write)throw new y.ErrnoError(28);s.seekable&&s.flags&1024&&y.llseek(s,0,2);var b=typeof m<"u";if(!b)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var S=s.stream_ops.write(s,u,f,p,m,_);return b||(s.position+=S),S},allocate:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(u<0||f<=0)throw new y.ErrnoError(28);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(s.node.mode)&&!y.isDir(s.node.mode))throw new y.ErrnoError(43);if(!s.stream_ops.allocate)throw new y.ErrnoError(138);s.stream_ops.allocate(s,u,f)},mmap:(s,u,f,p,m)=>{if(p&2&&!(m&2)&&(s.flags&2097155)!==2)throw new y.ErrnoError(2);if((s.flags&2097155)===1)throw new y.ErrnoError(2);if(!s.stream_ops.mmap)throw new y.ErrnoError(43);return s.stream_ops.mmap(s,u,f,p,m)},msync:(s,u,f,p,m)=>!s||!s.stream_ops.msync?0:s.stream_ops.msync(s,u,f,p,m),munmap:s=>0,ioctl:(s,u,f)=>{if(!s.stream_ops.ioctl)throw new y.ErrnoError(59);return s.stream_ops.ioctl(s,u,f)},readFile:(s,u={})=>{if(u.flags=u.flags||0,u.encoding=u.encoding||"binary",u.encoding!=="utf8"&&u.encoding!=="binary")throw new Error('Invalid encoding type "'+u.encoding+'"');var f,p=y.open(s,u.flags),m=y.stat(s),_=m.size,b=new Uint8Array(_);return y.read(p,b,0,_,0),u.encoding==="utf8"?f=xe(b,0):u.encoding==="binary"&&(f=b),y.close(p),f},writeFile:(s,u,f={})=>{f.flags=f.flags||577;var p=y.open(s,f.flags,f.mode);if(typeof u=="string"){var m=new Uint8Array(ie(u)+1),_=fe(u,m,0,m.length);y.write(p,m,0,_,void 0,f.canOwn)}else if(ArrayBuffer.isView(u))y.write(p,u,0,u.byteLength,void 0,f.canOwn);else throw new Error("Unsupported data type");y.close(p)},cwd:()=>y.currentPath,chdir:s=>{var u=y.lookupPath(s,{follow:!0});if(u.node===null)throw new y.ErrnoError(44);if(!y.isDir(u.node.mode))throw new y.ErrnoError(54);var f=y.nodePermissions(u.node,"x");if(f)throw new y.ErrnoError(f);y.currentPath=u.path},createDefaultDirectories:()=>{y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices:()=>{y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(u,f,p,m,_)=>m}),y.mkdev("/dev/null",y.makedev(1,3)),Gt.register(y.makedev(5,0),Gt.default_tty_ops),Gt.register(y.makedev(6,0),Gt.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var s=Fr();y.createDevice("/dev","random",s),y.createDevice("/dev","urandom",s),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{y.mkdir("/proc");var s=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount:()=>{var u=y.createNode(s,"fd",16895,73);return u.node_ops={lookup:(f,p)=>{var m=+p,_=y.getStream(m);if(!_)throw new y.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>_.path}};return b.parent=b,b}},u}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?y.createDevice("/dev","stdin",r.stdin):y.symlink("/dev/tty","/dev/stdin"),r.stdout?y.createDevice("/dev","stdout",null,r.stdout):y.symlink("/dev/tty","/dev/stdout"),r.stderr?y.createDevice("/dev","stderr",null,r.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError:()=>{y.ErrnoError||(y.ErrnoError=function(u,f){this.node=f,this.setErrno=function(p){this.errno=p},this.setErrno(u),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(s=>{y.genericErrors[s]=new y.ErrnoError(s),y.genericErrors[s].stack="<generic error, no stack>"}))},staticInit:()=>{y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(ee,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:ee}},init:(s,u,f)=>{y.init.initialized=!0,y.ensureErrnoError(),r.stdin=s||r.stdin,r.stdout=u||r.stdout,r.stderr=f||r.stderr,y.createStandardStreams()},quit:()=>{y.init.initialized=!1;for(var s=0;s<y.streams.length;s++){var u=y.streams[s];u&&y.close(u)}},getMode:(s,u)=>{var f=0;return s&&(f|=365),u&&(f|=146),f},findObject:(s,u)=>{var f=y.analyzePath(s,u);return f.exists?f.object:null},analyzePath:(s,u)=>{try{var f=y.lookupPath(s,{follow:!u});s=f.path}catch{}var p={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var f=y.lookupPath(s,{parent:!0});p.parentExists=!0,p.parentPath=f.path,p.parentObject=f.node,p.name=ge.basename(s),f=y.lookupPath(s,{follow:!u}),p.exists=!0,p.path=f.path,p.object=f.node,p.name=f.node.name,p.isRoot=f.path==="/"}catch(m){p.error=m.errno}return p},createPath:(s,u,f,p)=>{s=typeof s=="string"?s:y.getPath(s);for(var m=u.split("/").reverse();m.length;){var _=m.pop();if(_){var b=ge.join2(s,_);try{y.mkdir(b)}catch{}s=b}}return b},createFile:(s,u,f,p,m)=>{var _=ge.join2(typeof s=="string"?s:y.getPath(s),u),b=y.getMode(p,m);return y.create(_,b)},createDataFile:(s,u,f,p,m,_)=>{var b=u;s&&(s=typeof s=="string"?s:y.getPath(s),b=u?ge.join2(s,u):s);var S=y.getMode(p,m),x=y.create(b,S);if(f){if(typeof f=="string"){for(var k=new Array(f.length),U=0,I=f.length;U<I;++U)k[U]=f.charCodeAt(U);f=k}y.chmod(x,S|146);var F=y.open(x,577);y.write(F,f,0,f.length,0,_),y.close(F),y.chmod(x,S)}return x},createDevice:(s,u,f,p)=>{var m=ge.join2(typeof s=="string"?s:y.getPath(s),u),_=y.getMode(!!f,!!p);y.createDevice.major||(y.createDevice.major=64);var b=y.makedev(y.createDevice.major++,0);return y.registerDevice(b,{open:S=>{S.seekable=!1},close:S=>{p&&p.buffer&&p.buffer.length&&p(10)},read:(S,x,k,U,I)=>{for(var F=0,V=0;V<U;V++){var q;try{q=f()}catch{throw new y.ErrnoError(29)}if(q===void 0&&F===0)throw new y.ErrnoError(6);if(q==null)break;F++,x[k+V]=q}return F&&(S.node.timestamp=Date.now()),F},write:(S,x,k,U,I)=>{for(var F=0;F<U;F++)try{p(x[k+F])}catch{throw new y.ErrnoError(29)}return U&&(S.node.timestamp=Date.now()),F}}),y.mkdev(m,_,b)},forceLoadFile:s=>{if(s.isDevice||s.isFolder||s.link||s.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(w)try{s.contents=bo(w(s.url),!0),s.usedBytes=s.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(s,u,f,p,m)=>{function _(){this.lengthKnown=!1,this.chunks=[]}if(_.prototype.get=function(V){if(!(V>this.length-1||V<0)){var q=V%this.chunkSize,Ee=V/this.chunkSize|0;return this.getter(Ee)[q]}},_.prototype.setDataGetter=function(V){this.getter=V},_.prototype.cacheLength=function(){var V=new XMLHttpRequest;if(V.open("HEAD",f,!1),V.send(null),!(V.status>=200&&V.status<300||V.status===304))throw new Error("Couldn't load "+f+". Status: "+V.status);var q=Number(V.getResponseHeader("Content-length")),Ee,Ie=(Ee=V.getResponseHeader("Accept-Ranges"))&&Ee==="bytes",Ne=(Ee=V.getResponseHeader("Content-Encoding"))&&Ee==="gzip",B=1024*1024;Ie||(B=q);var X=(Re,lt)=>{if(Re>lt)throw new Error("invalid range ("+Re+", "+lt+") or no bytes requested!");if(lt>q-1)throw new Error("only "+q+" bytes available! programmer error!");var He=new XMLHttpRequest;if(He.open("GET",f,!1),q!==B&&He.setRequestHeader("Range","bytes="+Re+"-"+lt),He.responseType="arraybuffer",He.overrideMimeType&&He.overrideMimeType("text/plain; charset=x-user-defined"),He.send(null),!(He.status>=200&&He.status<300||He.status===304))throw new Error("Couldn't load "+f+". Status: "+He.status);return He.response!==void 0?new Uint8Array(He.response||[]):bo(He.responseText||"",!0)},Xe=this;Xe.setDataGetter(Re=>{var lt=Re*B,He=(Re+1)*B-1;if(He=Math.min(He,q-1),typeof Xe.chunks[Re]>"u"&&(Xe.chunks[Re]=X(lt,He)),typeof Xe.chunks[Re]>"u")throw new Error("doXHR failed!");return Xe.chunks[Re]}),(Ne||!q)&&(B=q=1,q=this.getter(0).length,B=q,Y("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=q,this._chunkSize=B,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new _;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var S={isDevice:!1,contents:b}}else var S={isDevice:!1,url:f};var x=y.createFile(s,u,S,p,m);S.contents?x.contents=S.contents:S.url&&(x.contents=null,x.url=S.url),Object.defineProperties(x,{usedBytes:{get:function(){return this.contents.length}}});var k={},U=Object.keys(x.stream_ops);U.forEach(F=>{var V=x.stream_ops[F];k[F]=function(){return y.forceLoadFile(x),V.apply(null,arguments)}});function I(F,V,q,Ee,Ie){var Ne=F.node.contents;if(Ie>=Ne.length)return 0;var B=Math.min(Ne.length-Ie,Ee);if(Ne.slice)for(var X=0;X<B;X++)V[q+X]=Ne[Ie+X];else for(var X=0;X<B;X++)V[q+X]=Ne.get(Ie+X);return B}return k.read=(F,V,q,Ee,Ie)=>(y.forceLoadFile(x),I(F,V,q,Ee,Ie)),k.mmap=(F,V,q,Ee,Ie)=>{y.forceLoadFile(x);var Ne=Lr(V);if(!Ne)throw new y.ErrnoError(48);return I(F,me,Ne,V,q),{ptr:Ne,allocated:!0}},x.stream_ops=k,x},createPreloadedFile:(s,u,f,p,m,_,b,S,x,k)=>{var U=u?ct.resolve(ge.join2(s,u)):s;function I(F){function V(q){k&&k(),S||y.createDataFile(s,u,q,p,m,x),_&&_(),Or()}Browser.handledByPreloadPlugin(F,U,V,()=>{b&&b(),Or()})||V(F)}mr(),typeof f=="string"?vi(f,F=>I(F),b):I(f)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(_){return f(_)}m.onupgradeneeded=()=>{Y("creating db");var _=m.result;_.createObjectStore(y.DB_STORE_NAME)},m.onsuccess=()=>{var _=m.result,b=_.transaction([y.DB_STORE_NAME],"readwrite"),S=b.objectStore(y.DB_STORE_NAME),x=0,k=0,U=s.length;function I(){k==0?u():f()}s.forEach(F=>{var V=S.put(y.analyzePath(F).object.contents,F);V.onsuccess=()=>{x++,x+k==U&&I()},V.onerror=()=>{k++,x+k==U&&I()}}),b.onerror=f},m.onerror=f},loadFilesFromDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(_){return f(_)}m.onupgradeneeded=f,m.onsuccess=()=>{var _=m.result;try{var b=_.transaction([y.DB_STORE_NAME],"readonly")}catch(F){f(F);return}var S=b.objectStore(y.DB_STORE_NAME),x=0,k=0,U=s.length;function I(){k==0?u():f()}s.forEach(F=>{var V=S.get(F);V.onsuccess=()=>{y.analyzePath(F).exists&&y.unlink(F),y.createDataFile(ge.dirname(F),ge.basename(F),V.result,!0,!0,!0),x++,x+k==U&&I()},V.onerror=()=>{k++,x+k==U&&I()}}),b.onerror=f},m.onerror=f}},ye={DEFAULT_POLLMASK:5,calculateAt:function(s,u,f){if(ge.isAbs(u))return u;var p;if(s===-100)p=y.cwd();else{var m=y.getStream(s);if(!m)throw new y.ErrnoError(8);p=m.path}if(u.length==0){if(!f)throw new y.ErrnoError(44);return p}return ge.join2(p,u)},doStat:function(s,u,f){try{var p=s(u)}catch(m){if(m&&m.node&&ge.normalize(u)!==ge.normalize(y.getPath(m.node)))return-54;throw m}return L[f>>2]=p.dev,L[f+4>>2]=0,L[f+8>>2]=p.ino,L[f+12>>2]=p.mode,L[f+16>>2]=p.nlink,L[f+20>>2]=p.uid,L[f+24>>2]=p.gid,L[f+28>>2]=p.rdev,L[f+32>>2]=0,bt=[p.size>>>0,(We=p.size,+Math.abs(We)>=1?We>0?(Math.min(+Math.floor(We/4294967296),4294967295)|0)>>>0:~~+Math.ceil((We-+(~~We>>>0))/4294967296)>>>0:0)],L[f+40>>2]=bt[0],L[f+44>>2]=bt[1],L[f+48>>2]=4096,L[f+52>>2]=p.blocks,L[f+56>>2]=p.atime.getTime()/1e3|0,L[f+60>>2]=0,L[f+64>>2]=p.mtime.getTime()/1e3|0,L[f+68>>2]=0,L[f+72>>2]=p.ctime.getTime()/1e3|0,L[f+76>>2]=0,bt=[p.ino>>>0,(We=p.ino,+Math.abs(We)>=1?We>0?(Math.min(+Math.floor(We/4294967296),4294967295)|0)>>>0:~~+Math.ceil((We-+(~~We>>>0))/4294967296)>>>0:0)],L[f+80>>2]=bt[0],L[f+84>>2]=bt[1],0},doMsync:function(s,u,f,p,m){var _=De.slice(s,s+f);y.msync(u,_,m,f,p)},varargs:void 0,get:function(){ye.varargs+=4;var s=L[ye.varargs-4>>2];return s},getStr:function(s){var u=se(s);return u},getStreamFromFD:function(s){var u=y.getStream(s);if(!u)throw new y.ErrnoError(8);return u}};function gi(s,u){try{return s=ye.getStr(s),y.chmod(s,u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function mi(s,u,f,p){try{if(u=ye.getStr(u),u=ye.calculateAt(s,u),f&-8)return-28;var m=y.lookupPath(u,{follow:!0}),_=m.node;if(!_)return-44;var b="";return f&4&&(b+="r"),f&2&&(b+="w"),f&1&&(b+="x"),b&&y.nodePermissions(_,b)?-2:0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function to(s){return L[ea()>>2]=s,s}function ro(s,u,f){ye.varargs=f;try{var p=ye.getStreamFromFD(s);switch(u){case 0:{var m=ye.get();if(m<0)return-28;var _;return _=y.createStream(p,m),_.fd}case 1:case 2:return 0;case 3:return p.flags;case 4:{var m=ye.get();return p.flags|=m,0}case 5:{var m=ye.get(),b=0;return ke[m+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return to(28),-1;default:return-28}}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function no(s,u){try{var f=ye.getStreamFromFD(s);return ye.doStat(y.stat,f.path,u)}catch(p){if(typeof y>"u"||!(p instanceof y.ErrnoError))throw p;return-p.errno}}function oo(s,u,f){ye.varargs=f;try{var p=ye.getStreamFromFD(s);switch(u){case 21509:case 21505:return p.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return p.tty?0:-59;case 21519:{if(!p.tty)return-59;var m=ye.get();return L[m>>2]=0,0}case 21520:return p.tty?-28:-59;case 21531:{var m=ye.get();return y.ioctl(p,u,m)}case 21523:return p.tty?0:-59;case 21524:return p.tty?0:-59;default:Dt("bad ioctl syscall "+u)}}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function io(s,u){try{return s=ye.getStr(s),ye.doStat(y.lstat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function so(s,u,f,p){try{u=ye.getStr(u);var m=p&256,_=p&4096;return p=p&-4353,u=ye.calculateAt(s,u,_),ye.doStat(m?y.lstat:y.stat,u,f)}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return-b.errno}}function yi(s,u,f,p){ye.varargs=p;try{u=ye.getStr(u),u=ye.calculateAt(s,u);var m=p?ye.get():0;return y.open(u,f,m).fd}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function wi(s,u){try{return s=ye.getStr(s),ye.doStat(y.stat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function _i(s,u,f,p,m){}function Ur(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function bi(){for(var s=new Array(256),u=0;u<256;++u)s[u]=String.fromCharCode(u);Ir=s}var Ir=void 0;function G(s){for(var u="",f=s;De[f];)u+=Ir[De[f++]];return u}var Z={},ot={},ao={},Hl=48,Vl=57;function uo(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var u=s.charCodeAt(0);return u>=Hl&&u<=Vl?"_"+s:s}function lo(s,u){return s=uo(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(u)}function Si(s,u){var f=lo(u,function(p){this.name=u,this.message=p;var m=new Error(p).stack;m!==void 0&&(this.stack=this.toString()+`
`+m.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},f}var Gr=void 0;function Se(s){throw new Gr(s)}var Ls=void 0;function co(s){throw new Ls(s)}function yr(s,u,f){s.forEach(function(S){ao[S]=u});function p(S){var x=f(S);x.length!==s.length&&co("Mismatched type converter count");for(var k=0;k<s.length;++k)Mt(s[k],x[k])}var m=new Array(u.length),_=[],b=0;u.forEach((S,x)=>{ot.hasOwnProperty(S)?m[x]=ot[S]:(_.push(S),Z.hasOwnProperty(S)||(Z[S]=[]),Z[S].push(()=>{m[x]=ot[S],++b,b===_.length&&p(m)}))}),_.length===0&&p(m)}function Mt(s,u,f={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");var p=u.name;if(s||Se('type "'+p+'" must have a positive integer typeid pointer'),ot.hasOwnProperty(s)){if(f.ignoreDuplicateRegistrations)return;Se("Cannot register type '"+p+"' twice")}if(ot[s]=u,delete ao[s],Z.hasOwnProperty(s)){var m=Z[s];delete Z[s],m.forEach(_=>_())}}function Wl(s,u,f,p,m){var _=Ur(f);u=G(u),Mt(s,{name:u,fromWireType:function(b){return!!b},toWireType:function(b,S){return S?p:m},argPackAdvance:8,readValueFromPointer:function(b){var S;if(f===1)S=me;else if(f===2)S=ke;else if(f===4)S=L;else throw new TypeError("Unknown boolean type size: "+u);return this.fromWireType(S[b>>_])},destructorFunction:null})}function zl(s){if(!(this instanceof tr)||!(s instanceof tr))return!1;for(var u=this.$$.ptrType.registeredClass,f=this.$$.ptr,p=s.$$.ptrType.registeredClass,m=s.$$.ptr;u.baseClass;)f=u.upcast(f),u=u.baseClass;for(;p.baseClass;)m=p.upcast(m),p=p.baseClass;return u===p&&f===m}function $l(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function Ei(s){function u(f){return f.$$.ptrType.registeredClass.name}Se(u(s)+" instance already deleted")}var Ti=!1;function Us(s){}function Xl(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function Is(s){s.count.value-=1;var u=s.count.value===0;u&&Xl(s)}function Gs(s,u,f){if(u===f)return s;if(f.baseClass===void 0)return null;var p=Gs(s,u,f.baseClass);return p===null?null:f.downcast(p)}var Ns={};function Yl(){return Object.keys(cn).length}function jl(){var s=[];for(var u in cn)cn.hasOwnProperty(u)&&s.push(cn[u]);return s}var un=[];function xi(){for(;un.length;){var s=un.pop();s.$$.deleteScheduled=!1,s.delete()}}var ln=void 0;function Zl(s){ln=s,un.length&&ln&&ln(xi)}function ql(){r.getInheritedInstanceCount=Yl,r.getLiveInheritedInstances=jl,r.flushPendingDeletes=xi,r.setDelayFunction=Zl}var cn={};function Kl(s,u){for(u===void 0&&Se("ptr should not be undefined");s.baseClass;)u=s.upcast(u),s=s.baseClass;return u}function Ql(s,u){return u=Kl(s,u),cn[u]}function fo(s,u){(!u.ptrType||!u.ptr)&&co("makeClassHandle requires ptr and ptrType");var f=!!u.smartPtrType,p=!!u.smartPtr;return f!==p&&co("Both smartPtrType and smartPtr must be specified"),u.count={value:1},fn(Object.create(s,{$$:{value:u}}))}function Jl(s){var u=this.getPointee(s);if(!u)return this.destructor(s),null;var f=Ql(this.registeredClass,u);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=u,f.$$.smartPtr=s,f.clone();var p=f.clone();return this.destructor(s),p}function m(){return this.isSmartPointer?fo(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:s}):fo(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var _=this.registeredClass.getActualType(u),b=Ns[_];if(!b)return m.call(this);var S;this.isConst?S=b.constPointerType:S=b.pointerType;var x=Gs(u,this.registeredClass,S.registeredClass);return x===null?m.call(this):this.isSmartPointer?fo(S.registeredClass.instancePrototype,{ptrType:S,ptr:x,smartPtrType:this,smartPtr:s}):fo(S.registeredClass.instancePrototype,{ptrType:S,ptr:x})}function fn(s){return typeof FinalizationRegistry>"u"?(fn=u=>u,s):(Ti=new FinalizationRegistry(u=>{Is(u.$$)}),fn=u=>{var f=u.$$,p=!!f.smartPtr;if(p){var m={$$:f};Ti.register(u,m,u)}return u},Us=u=>Ti.unregister(u),fn(s))}function ec(){if(this.$$.ptr||Ei(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=fn(Object.create(Object.getPrototypeOf(this),{$$:{value:$l(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function tc(){this.$$.ptr||Ei(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Se("Object already scheduled for deletion"),Us(this),Is(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function rc(){return!this.$$.ptr}function nc(){return this.$$.ptr||Ei(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Se("Object already scheduled for deletion"),un.push(this),un.length===1&&ln&&ln(xi),this.$$.deleteScheduled=!0,this}function oc(){tr.prototype.isAliasOf=zl,tr.prototype.clone=ec,tr.prototype.delete=tc,tr.prototype.isDeleted=rc,tr.prototype.deleteLater=nc}function tr(){}function Ci(s,u,f){if(s[u].overloadTable===void 0){var p=s[u];s[u]=function(){return s[u].overloadTable.hasOwnProperty(arguments.length)||Se("Function '"+f+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[u].overloadTable+")!"),s[u].overloadTable[arguments.length].apply(this,arguments)},s[u].overloadTable=[],s[u].overloadTable[p.argCount]=p}}function Hs(s,u,f){r.hasOwnProperty(s)?((f===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[f]!==void 0)&&Se("Cannot register public name '"+s+"' twice"),Ci(r,s,s),r.hasOwnProperty(f)&&Se("Cannot register multiple overloads of a function with the same number of arguments ("+f+")!"),r[s].overloadTable[f]=u):(r[s]=u,f!==void 0&&(r[s].numArguments=f))}function ic(s,u,f,p,m,_,b,S){this.name=s,this.constructor=u,this.instancePrototype=f,this.rawDestructor=p,this.baseClass=m,this.getActualType=_,this.upcast=b,this.downcast=S,this.pureVirtualFunctions=[]}function Pi(s,u,f){for(;u!==f;)u.upcast||Se("Expected null or instance of "+f.name+", got an instance of "+u.name),s=u.upcast(s),u=u.baseClass;return s}function sc(s,u){if(u===null)return this.isReference&&Se("null is not a valid "+this.name),0;u.$$||Se('Cannot pass "'+Di(u)+'" as a '+this.name),u.$$.ptr||Se("Cannot pass deleted object as a pointer of type "+this.name);var f=u.$$.ptrType.registeredClass,p=Pi(u.$$.ptr,f,this.registeredClass);return p}function ac(s,u){var f;if(u===null)return this.isReference&&Se("null is not a valid "+this.name),this.isSmartPointer?(f=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,f),f):0;u.$$||Se('Cannot pass "'+Di(u)+'" as a '+this.name),u.$$.ptr||Se("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&u.$$.ptrType.isConst&&Se("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);var p=u.$$.ptrType.registeredClass;if(f=Pi(u.$$.ptr,p,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&Se("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?f=u.$$.smartPtr:Se("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:f=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)f=u.$$.smartPtr;else{var m=u.clone();f=this.rawShare(f,$e.toHandle(function(){m.delete()})),s!==null&&s.push(this.rawDestructor,f)}break;default:Se("Unsupporting sharing policy")}return f}function uc(s,u){if(u===null)return this.isReference&&Se("null is not a valid "+this.name),0;u.$$||Se('Cannot pass "'+Di(u)+'" as a '+this.name),u.$$.ptr||Se("Cannot pass deleted object as a pointer of type "+this.name),u.$$.ptrType.isConst&&Se("Cannot convert argument of type "+u.$$.ptrType.name+" to parameter type "+this.name);var f=u.$$.ptrType.registeredClass,p=Pi(u.$$.ptr,f,this.registeredClass);return p}function ho(s){return this.fromWireType(he[s>>2])}function lc(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function cc(s){this.rawDestructor&&this.rawDestructor(s)}function fc(s){s!==null&&s.delete()}function hc(){Nt.prototype.getPointee=lc,Nt.prototype.destructor=cc,Nt.prototype.argPackAdvance=8,Nt.prototype.readValueFromPointer=ho,Nt.prototype.deleteObject=fc,Nt.prototype.fromWireType=Jl}function Nt(s,u,f,p,m,_,b,S,x,k,U){this.name=s,this.registeredClass=u,this.isReference=f,this.isConst=p,this.isSmartPointer=m,this.pointeeType=_,this.sharingPolicy=b,this.rawGetPointee=S,this.rawConstructor=x,this.rawShare=k,this.rawDestructor=U,!m&&u.baseClass===void 0?p?(this.toWireType=sc,this.destructorFunction=null):(this.toWireType=uc,this.destructorFunction=null):this.toWireType=ac}function pc(s,u,f){r.hasOwnProperty(s)||co("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&f!==void 0?r[s].overloadTable[f]=u:(r[s]=u,r[s].argCount=f)}function dc(s,u,f){var p=r["dynCall_"+s];return f&&f.length?p.apply(null,[u].concat(f)):p.call(null,u)}function vc(s,u,f){return s.includes("j")?dc(s,u,f):Br(u).apply(null,f)}function gc(s,u){var f=[];return function(){return f.length=0,Object.assign(f,arguments),vc(s,u,f)}}function wr(s,u){s=G(s);function f(){return s.includes("j")?gc(s,u):Br(u)}var p=f();return typeof p!="function"&&Se("unknown function pointer with signature "+s+": "+u),p}var Vs=void 0;function Ws(s){var u=ta(s),f=G(u);return Wt(u),f}function po(s,u){var f=[],p={};function m(_){if(!p[_]&&!ot[_]){if(ao[_]){ao[_].forEach(m);return}f.push(_),p[_]=!0}}throw u.forEach(m),new Vs(s+": "+f.map(Ws).join([", "]))}function mc(s,u,f,p,m,_,b,S,x,k,U,I,F){U=G(U),_=wr(m,_),S&&(S=wr(b,S)),k&&(k=wr(x,k)),F=wr(I,F);var V=uo(U);Hs(V,function(){po("Cannot construct "+U+" due to unbound types",[p])}),yr([s,u,f],p?[p]:[],function(q){q=q[0];var Ee,Ie;p?(Ee=q.registeredClass,Ie=Ee.instancePrototype):Ie=tr.prototype;var Ne=lo(V,function(){if(Object.getPrototypeOf(this)!==B)throw new Gr("Use 'new' to construct "+U);if(X.constructor_body===void 0)throw new Gr(U+" has no accessible constructor");var He=X.constructor_body[arguments.length];if(He===void 0)throw new Gr("Tried to invoke ctor of "+U+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(X.constructor_body).toString()+") parameters instead!");return He.apply(this,arguments)}),B=Object.create(Ie,{constructor:{value:Ne}});Ne.prototype=B;var X=new ic(U,Ne,B,F,Ee,_,S,k),Xe=new Nt(U,X,!0,!1,!1),Re=new Nt(U+"*",X,!1,!1,!1),lt=new Nt(U+" const*",X,!1,!0,!1);return Ns[s]={pointerType:Re,constPointerType:lt},pc(V,Ne),[Xe,Re,lt]})}function zs(s,u){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var f=lo(s.name||"unknownFunctionName",function(){});f.prototype=s.prototype;var p=new f,m=s.apply(p,u);return m instanceof Object?m:p}function $s(s){for(;s.length;){var u=s.pop(),f=s.pop();f(u)}}function Ai(s,u,f,p,m){var _=u.length;_<2&&Se("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var b=u[1]!==null&&f!==null,S=!1,x=1;x<u.length;++x)if(u[x]!==null&&u[x].destructorFunction===void 0){S=!0;break}for(var k=u[0].name!=="void",U="",I="",x=0;x<_-2;++x)U+=(x!==0?", ":"")+"arg"+x,I+=(x!==0?", ":"")+"arg"+x+"Wired";var F="return function "+uo(s)+"("+U+`) {
if (arguments.length !== `+(_-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(_-2)+` args!');
}
`;S&&(F+=`var destructors = [];
`);var V=S?"destructors":"null",q=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Ee=[Se,p,m,$s,u[0],u[1]];b&&(F+="var thisWired = classParam.toWireType("+V+`, this);
`);for(var x=0;x<_-2;++x)F+="var arg"+x+"Wired = argType"+x+".toWireType("+V+", arg"+x+"); // "+u[x+2].name+`
`,q.push("argType"+x),Ee.push(u[x+2]);if(b&&(I="thisWired"+(I.length>0?", ":"")+I),F+=(k?"var rv = ":"")+"invoker(fn"+(I.length>0?", ":"")+I+`);
`,S)F+=`runDestructors(destructors);
`;else for(var x=b?1:2;x<u.length;++x){var Ie=x===1?"thisWired":"arg"+(x-2)+"Wired";u[x].destructorFunction!==null&&(F+=Ie+"_dtor("+Ie+"); // "+u[x].name+`
`,q.push(Ie+"_dtor"),Ee.push(u[x].destructorFunction))}k&&(F+=`var ret = retType.fromWireType(rv);
return ret;
`),F+=`}
`,q.push(F);var Ne=zs(Function,q).apply(null,Ee);return Ne}function ki(s,u){for(var f=[],p=0;p<s;p++)f.push(L[(u>>2)+p]);return f}function yc(s,u,f,p,m,_,b){var S=ki(f,p);u=G(u),_=wr(m,_),yr([],[s],function(x){x=x[0];var k=x.name+"."+u;function U(){po("Cannot call "+k+" due to unbound types",S)}u.startsWith("@@")&&(u=Symbol[u.substring(2)]);var I=x.registeredClass.constructor;return I[u]===void 0?(U.argCount=f-1,I[u]=U):(Ci(I,u,k),I[u].overloadTable[f-1]=U),yr([],S,function(F){var V=[F[0],null].concat(F.slice(1)),q=Ai(k,V,null,_,b);return I[u].overloadTable===void 0?(q.argCount=f-1,I[u]=q):I[u].overloadTable[f-1]=q,[]}),[]})}function wc(s,u,f,p,m,_){we(u>0);var b=ki(u,f);m=wr(p,m),yr([],[s],function(S){S=S[0];var x="constructor "+S.name;if(S.registeredClass.constructor_body===void 0&&(S.registeredClass.constructor_body=[]),S.registeredClass.constructor_body[u-1]!==void 0)throw new Gr("Cannot register multiple constructors with identical number of parameters ("+(u-1)+") for class '"+S.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return S.registeredClass.constructor_body[u-1]=()=>{po("Cannot construct "+S.name+" due to unbound types",b)},yr([],b,function(k){return k.splice(1,0,null),S.registeredClass.constructor_body[u-1]=Ai(x,k,null,m,_),[]}),[]})}function _c(s,u,f,p,m,_,b,S){var x=ki(f,p);u=G(u),_=wr(m,_),yr([],[s],function(k){k=k[0];var U=k.name+"."+u;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),S&&k.registeredClass.pureVirtualFunctions.push(u);function I(){po("Cannot call "+U+" due to unbound types",x)}var F=k.registeredClass.instancePrototype,V=F[u];return V===void 0||V.overloadTable===void 0&&V.className!==k.name&&V.argCount===f-2?(I.argCount=f-2,I.className=k.name,F[u]=I):(Ci(F,u,U),F[u].overloadTable[f-2]=I),yr([],x,function(q){var Ee=Ai(U,q,k,_,b);return F[u].overloadTable===void 0?(Ee.argCount=f-2,F[u]=Ee):F[u].overloadTable[f-2]=Ee,[]}),[]})}var Ri=[],St=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Oi(s){s>4&&--St[s].refcount===0&&(St[s]=void 0,Ri.push(s))}function bc(){for(var s=0,u=5;u<St.length;++u)St[u]!==void 0&&++s;return s}function Sc(){for(var s=5;s<St.length;++s)if(St[s]!==void 0)return St[s];return null}function Ec(){r.count_emval_handles=bc,r.get_first_emval=Sc}var $e={toValue:s=>(s||Se("Cannot use deleted val. handle = "+s),St[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var u=Ri.length?Ri.pop():St.length;return St[u]={refcount:1,value:s},u}}}};function Tc(s,u){u=G(u),Mt(s,{name:u,fromWireType:function(f){var p=$e.toValue(f);return Oi(f),p},toWireType:function(f,p){return $e.toHandle(p)},argPackAdvance:8,readValueFromPointer:ho,destructorFunction:null})}function xc(s,u,f){switch(u){case 0:return function(p){var m=f?me:De;return this.fromWireType(m[p])};case 1:return function(p){var m=f?ke:nt;return this.fromWireType(m[p>>1])};case 2:return function(p){var m=f?L:he;return this.fromWireType(m[p>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Cc(s,u,f,p){var m=Ur(f);u=G(u);function _(){}_.values={},Mt(s,{name:u,constructor:_,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,S){return S.value},argPackAdvance:8,readValueFromPointer:xc(u,m,p),destructorFunction:null}),Hs(u,_)}function vo(s,u){var f=ot[s];return f===void 0&&Se(u+" has unknown type "+Ws(s)),f}function Pc(s,u,f){var p=vo(s,"enum");u=G(u);var m=p.constructor,_=Object.create(p.constructor.prototype,{value:{value:f},constructor:{value:lo(p.name+"_"+u,function(){})}});m.values[f]=_,m[u]=_}function Di(s){if(s===null)return"null";var u=typeof s;return u==="object"||u==="array"||u==="function"?s.toString():""+s}function Ac(s,u){switch(u){case 2:return function(f){return this.fromWireType(ut[f>>2])};case 3:return function(f){return this.fromWireType(Wn[f>>3])};default:throw new TypeError("Unknown float type: "+s)}}function kc(s,u,f){var p=Ur(f);u=G(u),Mt(s,{name:u,fromWireType:function(m){return m},toWireType:function(m,_){return _},argPackAdvance:8,readValueFromPointer:Ac(u,p),destructorFunction:null})}function Rc(s,u,f){switch(u){case 0:return f?function(m){return me[m]}:function(m){return De[m]};case 1:return f?function(m){return ke[m>>1]}:function(m){return nt[m>>1]};case 2:return f?function(m){return L[m>>2]}:function(m){return he[m>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function Oc(s,u,f,p,m){u=G(u);var _=Ur(f),b=I=>I;if(p===0){var S=32-8*f;b=I=>I<<S>>>S}var x=u.includes("unsigned"),k=(I,F)=>{},U;x?U=function(I,F){return k(F,this.name),F>>>0}:U=function(I,F){return k(F,this.name),F},Mt(s,{name:u,fromWireType:b,toWireType:U,argPackAdvance:8,readValueFromPointer:Rc(u,_,p!==0),destructorFunction:null})}function Dc(s,u,f){var p=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],m=p[u];function _(b){b=b>>2;var S=he,x=S[b],k=S[b+1];return new m(at,k,x)}f=G(f),Mt(s,{name:f,fromWireType:_,argPackAdvance:8,readValueFromPointer:_},{ignoreDuplicateRegistrations:!0})}function Mc(s,u){u=G(u);var f=u==="std::string";Mt(s,{name:u,fromWireType:function(p){var m=he[p>>2],_;if(f)for(var b=p+4,S=0;S<=m;++S){var x=p+4+S;if(S==m||De[x]==0){var k=x-b,U=se(b,k);_===void 0?_=U:(_+=String.fromCharCode(0),_+=U),b=x+1}}else{for(var I=new Array(m),S=0;S<m;++S)I[S]=String.fromCharCode(De[p+4+S]);_=I.join("")}return Wt(p),_},toWireType:function(p,m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));var _,b=typeof m=="string";b||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int8Array||Se("Cannot pass non-string to std::string"),f&&b?_=()=>ie(m):_=()=>m.length;var S=_(),x=Vt(4+S+1);if(he[x>>2]=S,f&&b)be(m,x+4,S+1);else if(b)for(var k=0;k<S;++k){var U=m.charCodeAt(k);U>255&&(Wt(x),Se("String has UTF-16 code units that do not fit in 8 bits")),De[x+4+k]=U}else for(var k=0;k<S;++k)De[x+4+k]=m[k];return p!==null&&p.push(Wt,x),x},argPackAdvance:8,readValueFromPointer:ho,destructorFunction:function(p){Wt(p)}})}function Bc(s,u,f){f=G(f);var p,m,_,b,S;u===2?(p=ue,m=Ae,b=ve,_=()=>nt,S=1):u===4&&(p=Be,m=Ot,b=Ke,_=()=>he,S=2),Mt(s,{name:f,fromWireType:function(x){for(var k=he[x>>2],U=_(),I,F=x+4,V=0;V<=k;++V){var q=x+4+V*u;if(V==k||U[q>>S]==0){var Ee=q-F,Ie=p(F,Ee);I===void 0?I=Ie:(I+=String.fromCharCode(0),I+=Ie),F=q+u}}return Wt(x),I},toWireType:function(x,k){typeof k!="string"&&Se("Cannot pass non-string to C++ string type "+f);var U=b(k),I=Vt(4+U+u);return he[I>>2]=U>>S,m(k,I+4,U+u),x!==null&&x.push(Wt,I),I},argPackAdvance:8,readValueFromPointer:ho,destructorFunction:function(x){Wt(x)}})}function Fc(s,u){u=G(u),Mt(s,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:function(){},toWireType:function(f,p){}})}function Lc(){return Date.now()}var Uc=!0;function Ic(){return Uc}function Gc(s,u,f){s=$e.toValue(s),u=vo(u,"emval::as");var p=[],m=$e.toHandle(p);return L[f>>2]=m,u.toWireType(p,s)}function Nc(s){var u=[];return L[s>>2]=$e.toHandle(u),u}var Hc={};function Mi(s){var u=Hc[s];return u===void 0?G(s):u}var Bi=[];function Vc(s,u,f,p,m){return s=Bi[s],u=$e.toValue(u),f=Mi(f),s(u,f,Nc(p),m)}function Xs(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Wc(s){return s===0?$e.toHandle(Xs()):(s=Mi(s),$e.toHandle(Xs()[s]))}function zc(s){var u=Bi.length;return Bi.push(s),u}function $c(s,u){for(var f=new Array(s),p=0;p<s;++p)f[p]=vo(he[u+p*K>>2],"parameter "+p);return f}var Ys=[];function Xc(s,u){var f=$c(s,u),p=f[0],m=p.name+"_$"+f.slice(1).map(function(q){return q.name}).join("_")+"$",_=Ys[m];if(_!==void 0)return _;for(var b=["retType"],S=[p],x="",k=0;k<s-1;++k)x+=(k!==0?", ":"")+"arg"+k,b.push("argType"+k),S.push(f[1+k]);for(var U=uo("methodCaller_"+m),I="return function "+U+`(handle, name, destructors, args) {
`,F=0,k=0;k<s-1;++k)I+="    var arg"+k+" = argType"+k+".readValueFromPointer(args"+(F?"+"+F:"")+`);
`,F+=f[k+1].argPackAdvance;I+="    var rv = handle[name]("+x+`);
`;for(var k=0;k<s-1;++k)f[k+1].deleteObject&&(I+="    argType"+k+".deleteObject(arg"+k+`);
`);p.isVoid||(I+=`    return retType.toWireType(destructors, rv);
`),I+=`};
`,b.push(I);var V=zs(Function,b).apply(null,S);return _=zc(V),Ys[m]=_,_}function Yc(s,u){return s=$e.toValue(s),u=$e.toValue(u),$e.toHandle(s[u])}function jc(s){s>4&&(St[s].refcount+=1)}function Zc(s){return $e.toHandle(Mi(s))}function qc(s){var u=$e.toValue(s);$s(u),Oi(s)}function Kc(s,u,f){s=$e.toValue(s),u=$e.toValue(u),f=$e.toValue(f),s[u]=f}function Qc(s,u){s=vo(s,"_emval_take_value");var f=s.readValueFromPointer(u);return $e.toHandle(f)}function Jc(s){return s=$e.toValue(s),$e.toHandle(typeof s)}function ef(s,u){var f=new Date(L[s>>2]*1e3);L[u>>2]=f.getSeconds(),L[u+4>>2]=f.getMinutes(),L[u+8>>2]=f.getHours(),L[u+12>>2]=f.getDate(),L[u+16>>2]=f.getMonth(),L[u+20>>2]=f.getFullYear()-1900,L[u+24>>2]=f.getDay();var p=new Date(f.getFullYear(),0,1),m=(f.getTime()-p.getTime())/(1e3*60*60*24)|0;L[u+28>>2]=m,L[u+36>>2]=-(f.getTimezoneOffset()*60);var _=new Date(f.getFullYear(),6,1).getTimezoneOffset(),b=p.getTimezoneOffset(),S=(_!=b&&f.getTimezoneOffset()==Math.min(b,_))|0;L[u+32>>2]=S}function tf(s,u,f,p,m,_){try{var b=y.getStream(m);b&&(f&2&&ye.doMsync(s,b,u,p,_),y.munmap(b))}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function rf(s,u,f){var p=new Date().getFullYear(),m=new Date(p,0,1),_=new Date(p,6,1),b=m.getTimezoneOffset(),S=_.getTimezoneOffset(),x=Math.max(b,S);L[s>>2]=x*60,L[u>>2]=Number(b!=S);function k(q){var Ee=q.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Ee?Ee[1]:"GMT"}var U=k(m),I=k(_),F=je(U),V=je(I);S<b?(he[f>>2]=F,he[f+4>>2]=V):(he[f>>2]=V,he[f+4>>2]=F)}function Fi(s,u,f){Fi.called||(Fi.called=!0,rf(s,u,f))}function nf(){Dt("")}function js(){return 2147483648}function of(){return js()}function sf(s,u,f){De.copyWithin(s,u,u+f)}function af(s){try{return oe.grow(s-at.byteLength+65535>>>16),wt(oe.buffer),1}catch{}}function uf(s){var u=De.length;s=s>>>0;var f=js();if(s>f)return!1;let p=(x,k)=>x+(k-x%k)%k;for(var m=1;m<=4;m*=2){var _=u*(1+.2/m);_=Math.min(_,s+100663296);var b=Math.min(f,p(Math.max(s,_),65536)),S=af(b);if(S)return!0}return!1}var Li={};function lf(){return a||"./this.program"}function hn(){if(!hn.strings){var s=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:s,_:lf()};for(var f in Li)Li[f]===void 0?delete u[f]:u[f]=Li[f];var p=[];for(var f in u)p.push(f+"="+u[f]);hn.strings=p}return hn.strings}function cf(s,u){var f=0;return hn().forEach(function(p,m){var _=u+f;he[s+m*4>>2]=_,Jt(p,_),f+=p.length+1}),0}function ff(s,u){var f=hn();he[s>>2]=f.length;var p=0;return f.forEach(function(m){p+=m.length+1}),he[u>>2]=p,0}function hf(s){$f(s)}function pf(s){try{var u=ye.getStreamFromFD(s);return y.close(u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return f.errno}}function df(s,u,f,p){for(var m=0,_=0;_<f;_++){var b=he[u>>2],S=he[u+4>>2];u+=8;var x=y.read(s,me,b,S,p);if(x<0)return-1;if(m+=x,x<S)break}return m}function vf(s,u,f,p){try{var m=ye.getStreamFromFD(s),_=df(m,u,f);return L[p>>2]=_,0}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return b.errno}}function gf(s,u){return u+2097152>>>0<4194305-!!s?(s>>>0)+u*4294967296:NaN}function mf(s,u,f,p,m){try{var _=gf(u,f);if(isNaN(_))return 61;var b=ye.getStreamFromFD(s);return y.llseek(b,_,p),bt=[b.position>>>0,(We=b.position,+Math.abs(We)>=1?We>0?(Math.min(+Math.floor(We/4294967296),4294967295)|0)>>>0:~~+Math.ceil((We-+(~~We>>>0))/4294967296)>>>0:0)],L[m>>2]=bt[0],L[m+4>>2]=bt[1],b.getdents&&_===0&&p===0&&(b.getdents=null),0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return S.errno}}function yf(s,u,f,p){for(var m=0,_=0;_<f;_++){var b=he[u>>2],S=he[u+4>>2];u+=8;var x=y.write(s,me,b,S,p);if(x<0)return-1;m+=x}return m}function wf(s,u,f,p){try{var m=ye.getStreamFromFD(s),_=yf(m,u,f);return he[p>>2]=_,0}catch(b){if(typeof y>"u"||!(b instanceof y.ErrnoError))throw b;return b.errno}}function Zs(s){for(var u=s.split("."),f=0;f<4;f++){var p=Number(u[f]);if(isNaN(p))return null;u[f]=p}return(u[0]|u[1]<<8|u[2]<<16|u[3]<<24)>>>0}function pn(s){return parseInt(s)}function _f(s){var u,f,p,m,_=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,b=[];if(!_.test(s))return null;if(s==="::")return[0,0,0,0,0,0,0,0];for(s.startsWith("::")?s=s.replace("::","Z:"):s=s.replace("::",":Z:"),s.indexOf(".")>0?(s=s.replace(new RegExp("[.]","g"),":"),u=s.split(":"),u[u.length-4]=pn(u[u.length-4])+pn(u[u.length-3])*256,u[u.length-3]=pn(u[u.length-2])+pn(u[u.length-1])*256,u=u.slice(0,u.length-2)):u=s.split(":"),p=0,m=0,f=0;f<u.length;f++)if(typeof u[f]=="string")if(u[f]==="Z"){for(m=0;m<8-u.length+1;m++)b[f+m]=0;p=m-1}else b[f+p]=ra(parseInt(u[f],16));else b[f+p]=u[f];return[b[1]<<16|b[0],b[3]<<16|b[2],b[5]<<16|b[4],b[7]<<16|b[6]]}var rr={address_map:{id:1,addrs:{},names:{}},lookup_name:function(s){var u=Zs(s);if(u!==null||(u=_f(s),u!==null))return s;var f;if(rr.address_map.addrs[s])f=rr.address_map.addrs[s];else{var p=rr.address_map.id++;we(p<65535,"exceeded max address mappings of 65535"),f="172.29."+(p&255)+"."+(p&65280),rr.address_map.names[f]=s,rr.address_map.addrs[s]=f}return f},lookup_addr:function(s){return rr.address_map.names[s]?rr.address_map.names[s]:null}};function bf(s){var u=Vt(20),f=Vt(s.length+1);be(s,f,s.length+1),he[u>>2]=f;var p=Vt(4);he[p>>2]=0,he[u+4>>2]=p;var m=2;L[u+8>>2]=m,L[u+12>>2]=4;var _=Vt(12);return he[_>>2]=_+8,he[_+4>>2]=0,L[_+8>>2]=Zs(rr.lookup_name(s)),he[u+16>>2]=_,u}function Sf(s){return bf(se(s))}function Ef(s){var u=s.getExtension("ANGLE_instanced_arrays");if(u)return s.vertexAttribDivisor=function(f,p){u.vertexAttribDivisorANGLE(f,p)},s.drawArraysInstanced=function(f,p,m,_){u.drawArraysInstancedANGLE(f,p,m,_)},s.drawElementsInstanced=function(f,p,m,_,b){u.drawElementsInstancedANGLE(f,p,m,_,b)},1}function Tf(s){var u=s.getExtension("OES_vertex_array_object");if(u)return s.createVertexArray=function(){return u.createVertexArrayOES()},s.deleteVertexArray=function(f){u.deleteVertexArrayOES(f)},s.bindVertexArray=function(f){u.bindVertexArrayOES(f)},s.isVertexArray=function(f){return u.isVertexArrayOES(f)},1}function xf(s){var u=s.getExtension("WEBGL_draw_buffers");if(u)return s.drawBuffers=function(f,p){u.drawBuffersWEBGL(f,p)},1}function Cf(s){return!!(s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw"))}var Fe={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(u){Fe.lastError||(Fe.lastError=u)},getNewId:function(s){for(var u=Fe.counter++,f=s.length;f<u;f++)s[f]=null;return u},getSource:function(s,u,f,p){for(var m="",_=0;_<u;++_){var b=p?L[p+_*4>>2]:-1;m+=se(L[f+_*4>>2],b<0?void 0:b)}return m},createContext:function(s,u){if(!s.getContextSafariWebGL2Fixed){let _=function(b,S){var x=s.getContextSafariWebGL2Fixed(b,S);return b=="webgl"==x instanceof WebGLRenderingContext?x:null};var m=_;s.getContextSafariWebGL2Fixed=s.getContext,s.getContext=_}var f=s.getContext("webgl",u);if(!f)return 0;var p=Fe.registerContext(f,u);return p},registerContext:function(s,u){var f=Fe.getNewId(Fe.contexts),p={handle:f,attributes:u,version:u.majorVersion,GLctx:s};return s.canvas&&(s.canvas.GLctxObject=p),Fe.contexts[f]=p,(typeof u.enableExtensionsByDefault>"u"||u.enableExtensionsByDefault)&&Fe.initExtensions(p),f},makeContextCurrent:function(s){return Fe.currentContext=Fe.contexts[s],r.ctx=it=Fe.currentContext&&Fe.currentContext.GLctx,!(s&&!it)},getContext:function(s){return Fe.contexts[s]},deleteContext:function(s){Fe.currentContext===Fe.contexts[s]&&(Fe.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(Fe.contexts[s].GLctx.canvas),Fe.contexts[s]&&Fe.contexts[s].GLctx.canvas&&(Fe.contexts[s].GLctx.canvas.GLctxObject=void 0),Fe.contexts[s]=null},initExtensions:function(s){if(s||(s=Fe.currentContext),!s.initExtensionsDone){s.initExtensionsDone=!0;var u=s.GLctx;Ef(u),Tf(u),xf(u),u.disjointTimerQueryExt=u.getExtension("EXT_disjoint_timer_query"),Cf(u);var f=u.getSupportedExtensions()||[];f.forEach(function(p){!p.includes("lose_context")&&!p.includes("debug")&&u.getExtension(p)})}}};function qs(s){return s.slice(-1)=="]"&&s.lastIndexOf("[")}function Pf(s){var u=s.uniformLocsById,f=s.uniformSizeAndIdsByName,p,m;if(!u)for(s.uniformLocsById=u={},s.uniformArrayNamesById={},p=0;p<it.getProgramParameter(s,35718);++p){var _=it.getActiveUniform(s,p),b=_.name,S=_.size,x=qs(b),k=x>0?b.slice(0,x):b,U=s.uniformIdCounter;for(s.uniformIdCounter+=S,f[k]=[S,U],m=0;m<S;++m)u[U]=m,s.uniformArrayNamesById[U++]=k}}function Af(s,u){if(u=se(u),s=Fe.programs[s]){Pf(s);var f=s.uniformLocsById,p=0,m=u,_=qs(u);_>0&&(p=pn(u.slice(_+1))>>>0,m=u.slice(0,_));var b=s.uniformSizeAndIdsByName[m];if(b&&p<b[0]&&(p+=b[1],f[p]=f[p]||it.getUniformLocation(s,u)))return p}else Fe.recordError(1281);return-1}function nr(s){var u=it.currentProgram;if(u){var f=u.uniformLocsById[s];return typeof f=="number"&&(u.uniformLocsById[s]=f=it.getUniformLocation(u,u.uniformArrayNamesById[s]+(f>0?"["+f+"]":""))),f}else Fe.recordError(1282)}function kf(s,u){it.uniform1f(nr(s),u)}function Rf(s,u){it.uniform1i(nr(s),u)}var go=[];function Of(s,u,f){if(u<=144)for(var p=go[2*u-1],m=0;m<2*u;m+=2)p[m]=ut[f+4*m>>2],p[m+1]=ut[f+(4*m+4)>>2];else var p=ut.subarray(f>>2,f+u*8>>2);it.uniform2fv(nr(s),p)}var mo=[];function Df(s,u,f){if(u<=144)for(var p=mo[2*u-1],m=0;m<2*u;m+=2)p[m]=L[f+4*m>>2],p[m+1]=L[f+(4*m+4)>>2];else var p=L.subarray(f>>2,f+u*8>>2);it.uniform2iv(nr(s),p)}function Mf(s,u,f){if(u<=96)for(var p=go[3*u-1],m=0;m<3*u;m+=3)p[m]=ut[f+4*m>>2],p[m+1]=ut[f+(4*m+4)>>2],p[m+2]=ut[f+(4*m+8)>>2];else var p=ut.subarray(f>>2,f+u*12>>2);it.uniform3fv(nr(s),p)}function Bf(s,u,f){if(u<=96)for(var p=mo[3*u-1],m=0;m<3*u;m+=3)p[m]=L[f+4*m>>2],p[m+1]=L[f+(4*m+4)>>2],p[m+2]=L[f+(4*m+8)>>2];else var p=L.subarray(f>>2,f+u*12>>2);it.uniform3iv(nr(s),p)}function Ff(s,u,f){if(u<=72){var p=go[4*u-1],m=ut;f>>=2;for(var _=0;_<4*u;_+=4){var b=f+_;p[_]=m[b],p[_+1]=m[b+1],p[_+2]=m[b+2],p[_+3]=m[b+3]}}else var p=ut.subarray(f>>2,f+u*16>>2);it.uniform4fv(nr(s),p)}function Lf(s,u,f){if(u<=72)for(var p=mo[4*u-1],m=0;m<4*u;m+=4)p[m]=L[f+4*m>>2],p[m+1]=L[f+(4*m+4)>>2],p[m+2]=L[f+(4*m+8)>>2],p[m+3]=L[f+(4*m+12)>>2];else var p=L.subarray(f>>2,f+u*16>>2);it.uniform4iv(nr(s),p)}function Uf(s){}function yo(s){return s%4===0&&(s%100!==0||s%400===0)}function If(s,u){for(var f=0,p=0;p<=u;f+=s[p++]);return f}var Ks=[31,29,31,30,31,30,31,31,30,31,30,31],Qs=[31,28,31,30,31,30,31,31,30,31,30,31];function Gf(s,u){for(var f=new Date(s.getTime());u>0;){var p=yo(f.getFullYear()),m=f.getMonth(),_=(p?Ks:Qs)[m];if(u>_-f.getDate())u-=_-f.getDate()+1,f.setDate(1),m<11?f.setMonth(m+1):(f.setMonth(0),f.setFullYear(f.getFullYear()+1));else return f.setDate(f.getDate()+u),f}return f}function Nf(s,u,f,p){var m=L[p+40>>2],_={tm_sec:L[p>>2],tm_min:L[p+4>>2],tm_hour:L[p+8>>2],tm_mday:L[p+12>>2],tm_mon:L[p+16>>2],tm_year:L[p+20>>2],tm_wday:L[p+24>>2],tm_yday:L[p+28>>2],tm_isdst:L[p+32>>2],tm_gmtoff:L[p+36>>2],tm_zone:m?se(m):""},b=se(f),S={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var x in S)b=b.replace(new RegExp(x,"g"),S[x]);var k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],U=["January","February","March","April","May","June","July","August","September","October","November","December"];function I(B,X,Xe){for(var Re=typeof B=="number"?B.toString():B||"";Re.length<X;)Re=Xe[0]+Re;return Re}function F(B,X){return I(B,X,"0")}function V(B,X){function Xe(lt){return lt<0?-1:lt>0?1:0}var Re;return(Re=Xe(B.getFullYear()-X.getFullYear()))===0&&(Re=Xe(B.getMonth()-X.getMonth()))===0&&(Re=Xe(B.getDate()-X.getDate())),Re}function q(B){switch(B.getDay()){case 0:return new Date(B.getFullYear()-1,11,29);case 1:return B;case 2:return new Date(B.getFullYear(),0,3);case 3:return new Date(B.getFullYear(),0,2);case 4:return new Date(B.getFullYear(),0,1);case 5:return new Date(B.getFullYear()-1,11,31);case 6:return new Date(B.getFullYear()-1,11,30)}}function Ee(B){var X=Gf(new Date(B.tm_year+1900,0,1),B.tm_yday),Xe=new Date(X.getFullYear(),0,4),Re=new Date(X.getFullYear()+1,0,4),lt=q(Xe),He=q(Re);return V(lt,X)<=0?V(He,X)<=0?X.getFullYear()+1:X.getFullYear():X.getFullYear()-1}var Ie={"%a":function(B){return k[B.tm_wday].substring(0,3)},"%A":function(B){return k[B.tm_wday]},"%b":function(B){return U[B.tm_mon].substring(0,3)},"%B":function(B){return U[B.tm_mon]},"%C":function(B){var X=B.tm_year+1900;return F(X/100|0,2)},"%d":function(B){return F(B.tm_mday,2)},"%e":function(B){return I(B.tm_mday,2," ")},"%g":function(B){return Ee(B).toString().substring(2)},"%G":function(B){return Ee(B)},"%H":function(B){return F(B.tm_hour,2)},"%I":function(B){var X=B.tm_hour;return X==0?X=12:X>12&&(X-=12),F(X,2)},"%j":function(B){return F(B.tm_mday+If(yo(B.tm_year+1900)?Ks:Qs,B.tm_mon-1),3)},"%m":function(B){return F(B.tm_mon+1,2)},"%M":function(B){return F(B.tm_min,2)},"%n":function(){return`
`},"%p":function(B){return B.tm_hour>=0&&B.tm_hour<12?"AM":"PM"},"%S":function(B){return F(B.tm_sec,2)},"%t":function(){return"	"},"%u":function(B){return B.tm_wday||7},"%U":function(B){var X=B.tm_yday+7-B.tm_wday;return F(Math.floor(X/7),2)},"%V":function(B){var X=Math.floor((B.tm_yday+7-(B.tm_wday+6)%7)/7);if((B.tm_wday+371-B.tm_yday-2)%7<=2&&X++,X){if(X==53){var Re=(B.tm_wday+371-B.tm_yday)%7;Re!=4&&(Re!=3||!yo(B.tm_year))&&(X=1)}}else{X=52;var Xe=(B.tm_wday+7-B.tm_yday-1)%7;(Xe==4||Xe==5&&yo(B.tm_year%400-1))&&X++}return F(X,2)},"%w":function(B){return B.tm_wday},"%W":function(B){var X=B.tm_yday+7-(B.tm_wday+6)%7;return F(Math.floor(X/7),2)},"%y":function(B){return(B.tm_year+1900).toString().substring(2)},"%Y":function(B){return B.tm_year+1900},"%z":function(B){var X=B.tm_gmtoff,Xe=X>=0;return X=Math.abs(X)/60,X=X/60*100+X%60,(Xe?"+":"-")+String("0000"+X).slice(-4)},"%Z":function(B){return B.tm_zone},"%%":function(){return"%"}};b=b.replace(/%%/g,"\0\0");for(var x in Ie)b.includes(x)&&(b=b.replace(new RegExp(x,"g"),Ie[x](_)));b=b.replace(/\0\0/g,"%");var Ne=bo(b,!1);return Ne.length>u?0:(rt(Ne,s),Ne.length-1)}function Hf(s,u,f,p){return Nf(s,u,f,p)}var Js=function(s,u,f,p){s||(s=this),this.parent=s,this.mount=s.mount,this.mounted=null,this.id=y.nextInode++,this.name=u,this.mode=f,this.node_ops={},this.stream_ops={},this.rdev=p},wo=365,_o=146;Object.defineProperties(Js.prototype,{read:{get:function(){return(this.mode&wo)===wo},set:function(s){s?this.mode|=wo:this.mode&=~wo}},write:{get:function(){return(this.mode&_o)===_o},set:function(s){s?this.mode|=_o:this.mode&=~_o}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=Js,y.staticInit(),bi(),Gr=r.BindingError=Si(Error,"BindingError"),Ls=r.InternalError=Si(Error,"InternalError"),oc(),ql(),hc(),Vs=r.UnboundTypeError=Si(Error,"UnboundTypeError"),Ec();for(var it,Vf=new Float32Array(288),Ht=0;Ht<288;++Ht)go[Ht]=Vf.subarray(0,Ht+1);for(var Wf=new Int32Array(288),Ht=0;Ht<288;++Ht)mo[Ht]=Wf.subarray(0,Ht+1);function bo(s,u,f){var p=f>0?f:ie(s)+1,m=new Array(p),_=fe(s,m,0,m.length);return u&&(m.length=_),m}var zf={ga:Qn,k:Jn,b:eo,c:di,Q:gi,R:mi,q:ro,K:no,U:oo,I:io,H:so,u:yi,J:wi,z:_i,W:Wl,d:mc,f:yc,e:wc,a:_c,V:Tc,g:Cc,h:Pc,v:kc,j:Oc,i:Dc,w:Mc,r:Bc,X:Fc,N:Lc,M:Ic,m:Gc,ka:Vc,x:Oi,la:Wc,ja:Xc,s:Yc,E:jc,ia:Zc,ma:qc,n:Kc,l:Qc,na:Jc,O:ef,D:tf,P:Fi,t:nf,C:of,L:sf,o:uf,F:cf,G:ff,fa:hf,p:pf,T:vf,y:mf,S:wf,ha:Sf,ea:Af,ca:kf,da:Rf,_:Of,ba:Df,Z:Mf,aa:Bf,Y:Ff,$:Lf,A:Uf,B:Hf};hi(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Vt=r._malloc=function(){return(Vt=r._malloc=r.asm.qa).apply(null,arguments)},Wt=r._free=function(){return(Wt=r._free=r.asm.ra).apply(null,arguments)},ea=r.___errno_location=function(){return(ea=r.___errno_location=r.asm.sa).apply(null,arguments)},ta=r.___getTypeName=function(){return(ta=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var ra=r._htons=function(){return(ra=r._htons=r.asm.wa).apply(null,arguments)},na=r._emscripten_builtin_memalign=function(){return(na=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},oa=r.___cxa_is_pointer_type=function(){return(oa=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=y;var So;function Ui(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}gr=function s(){So||Ii(),So||(gr=s)};function Ii(s){if(_t>0||(Xn(),_t>0))return;function u(){So||(So=!0,r.calledRun=!0,!de&&(Yn(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),jn()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),u()},1)):u()}r.run=Ii;function $f(s,u){Xf(s)}function Xf(s){nn()||(r.onExit&&r.onExit(s),de=!0),l(s,new Ui(s))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Ii(),r.ready}})(),Zf="/cad-os/assets/replicad_single-b4564eab.wasm";const es={library:null},qf=t=>{es.library=t},N=()=>{if(!es.library)throw new Error("oppencascade has not been loaded");return es.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const gn=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class pt{constructor(e){this.oc=N(),e&&gn.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(gn.unregister(this._wrapped),this._wrapped.delete()),gn.register(this,e,e),this._wrapped=e}delete(){var e;gn.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const Oe=()=>{function t(e){return gn.register(t,e),e}return t},Ye=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},mu=2147483647,Tt=Math.PI/180,wn=180/Math.PI,Gi=t=>Math.round(t*1e3)/1e3,Tn=(t,e,r)=>{const n=N(),o=ht(t),i=Zt(e);let a;if(r){const l=Zt(r);a=new n.gp_Ax3_3(o,i,l),l.delete()}else a=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),a},On=(t,e,r)=>{const n=N(),o=ht(t),i=Zt(e);let a;if(r){const l=Zt(r);a=new n.gp_Ax2_2(o,i,l),l.delete()}else a=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),a},_n=(t,e)=>{const r=N(),n=ht(t),o=Zt(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},Kf=(t=[0,0,0])=>{const e=N();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof D)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class D extends pt{constructor(e=[0,0,0]){super(Kf(e))}get repr(){return`x: ${Gi(this.x)}, y: ${Gi(this.y)}, z: ${Gi(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new D(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new D(this.wrapped.Subtracted(e.wrapped))}add(e){return new D(this.wrapped.Added(e.wrapped))}multiply(e){return new D(this.wrapped.Multiplied(e))}normalized(){return new D(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*wn}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),a=this.sub(i);return o.delete(),i.delete(),a}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=_n(r,n);return this.wrapped.Rotate(o,e*Tt),o.delete(),this}}const Qf={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function Jf(t){return t==="X"||t==="Y"||t==="Z"?Qf[t]:t}function ht(t){const e=new D(t),r=e.toPnt();return e.delete(),r}function Zt(t){const e=new D(t),r=e.toDir();return e.delete(),r}class Pr extends pt{constructor(e){const r=N();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new D(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Zt(n),i=ht(r),a=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(a,e*Tt),a.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=Oe();let o,i;if(typeof e=="string"){const l=n(yu(e,r));o=l.origin,i=l.zDir}else e instanceof st?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const a=n(On(o,i));return this.wrapped.SetMirror_3(a),this}scale(e,r){const n=ht(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=Oe(),o=n(e==="reference"?new this.oc.gp_Ax3_1:Tn(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:Tn(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=ht(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class st{constructor(e,r=null,n=[0,0,1]){this.oc=N();const o=new D(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new D(r);else{const a=Tn(e,o);i=new D(a.XDirection()),a.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new D(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new st(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new D(e),r}translate(e,r=0,n=0){const o=new D(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=Jf(r),o=new D(this.zDir).rotate(e,[0,0,0],n),i=new D(this.xDir).rotate(e,[0,0,0],n);return new st(this.origin,i,o)}rotate2DAxes(e){const r=new D(this.xDir).rotate(e,[0,0,0],this.zDir);return new st(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=Tn(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new Pr,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new Pr,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new D(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new D(r);return r.delete(),n}}const eh={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},yu=(t,e=[0,0,0])=>{const r=eh[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new st(n,r.xDir,r.normal)};let th=class extends pt{constructor(e){const r=N();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new D(e).repr} - ${new D(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},a={current:0};return this.wrapped.Get(e,r,n,o,i,a),[[e.current,r.current,n.current],[o.current,i.current,a.current]]}get center(){const[[e,r,n],[o,i,a]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(a-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function hr(t="XY",e=[0,0,0]){return t instanceof st?t.clone():yu(t,e)}function rh(t,e,r=[0,0,0],n=[0,0,1]){const o=new Pr;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function nh(t,e){const r=new Pr;r.translate(e);const n=r.transform(t);return r.delete(),n}function oh(t,e,r){const n=new Pr;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function ih(t,e,r){const n=new Pr;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function Io(t){return Array.isArray(t)&&t.length===2}let Eo=null;const ia=t=>{if(Eo&&!t)return Eo;const r=N().GeomAbs_CurveType;return Eo=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),Eo},Dn=t=>{let e=ia().get(t);if(e||(e=ia(!0).get(t)),!e)throw new Error("unknown type");return e};function sh(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function ah(t){return Array.from(Array(t).keys())}function $r(t){const e=Math.min(...t.map(r=>r.length));return ah(e).map(r=>t.map(n=>n[r]))}function Go(t){return Math.round(t*100)/100}const bn=([t,e])=>`(${Go(t)},${Go(e)})`,sa=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},wu=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${sa(r,e)},${sa(n,e)}]`,[r,n]])).values()),Je=([t,e])=>{const r=N();return new r.gp_Pnt2d_3(t,e)},uh=([t,e])=>{const r=N();return new r.gp_Dir2d_4(t,e)},_u=([t,e])=>{const r=N();return new r.gp_Vec2d_4(t,e)},jr=(t,e)=>{const r=N(),[n,o]=Ye(),i=new r.gp_Ax2d_2(n(Je(t)),n(uh(e)));return o(),i};class Mn extends pt{constructor(e){const r=N();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${bn(e)} - ${bn(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=Oe()(Je(e));return!this.wrapped.IsOut_1(n)}}const tt=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,Zr=([t,e],[r,n])=>[t+r,e+n],ms=([t,e],[r,n])=>[t-r,e-n],ts=([t,e],r)=>[t*r,e*r],Bt=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),lh=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function ch([t,e],[r,n]){return t*n-e*r}const fh=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),hh=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),ar=([t,e])=>{const r=Bt([t,e]);return[t/r,e/r]},ph=(t,e,r=[0,0])=>{const[n,o]=t,[i,a]=r,l=n-i,c=o-a,h=Math.sin(e),d=Math.cos(e),g=l*d-c*h,v=l*h+c*d;return[g+i,v+a]},Wr=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},dh=([t,e])=>{const r=Bt([t,e]),n=Math.atan2(e,t);return[r,n]};class Ge extends pt{constructor(e){const r=N(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=N(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new Mn(r),this._boundingBox}get repr(){return`${this.geomType} ${bn(this.firstPoint)} - ${bn(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=N();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=Dn(e.GetType());return e.delete(),r}clone(){return new Ge(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=N(),n=Oe(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(Je(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,Bt(e,this.firstPoint),Bt(e,this.lastPoint))}distanceFromCurve(e){const r=N(),n=Oe();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return Io(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=N(),o=Oe();let i,a;try{const l=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(Je(e)),this.wrapped));i=l.LowerDistance(),a=l.LowerDistanceParameter()}catch{if(tt(e,this.firstPoint,r))return this.firstParameter;if(tt(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${bn(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return a}tangentAt(e){const r=N(),[n,o]=Ye();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const a=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,a,l);const c=[l.X(),l.Y()];return o(),c}splitAt(e,r=1e-9){const n=N(),o=Oe();let i=e.map(c=>Io(c)?this.parameter(c,r):c);i=Array.from(new Map(i.map(c=>[sh(c,-Math.log10(r)),c])).values()).sort((c,h)=>c-h);const a=this.firstParameter,l=this.lastParameter;return a>l&&i.reverse(),Math.abs(i[0]-a)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-l)<r*100&&(i=i.slice(0,-1)),i.length?$r([[a,...i],[...i,l]]).map(([c,h])=>{try{if(this.geomType==="BEZIER_CURVE"){const g=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return g.Segment(c,h),new Ge(new n.Handle_Geom2d_Curve_2(g))}if(this.geomType==="BSPLINE_CURVE"){const g=o(this.adaptor()).BSpline().get(),v=new n.Geom2d_BSplineCurve_1(g.Poles_2(),g.Knots_2(),g.Multiplicities_2(),g.Degree(),g.IsPeriodic());return v.Segment(c,h,r),new Ge(new n.Handle_Geom2d_Curve_2(v))}const d=new n.Geom2d_TrimmedCurve(this.wrapped,c,h,!0,!0);return new Ge(new n.Handle_Geom2d_Curve_2(d))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const bu=(t,e=1e-4,r="C0",n=200)=>{const o=N(),i=Oe(),a={C0:o.GeomAbs_Shape.GeomAbs_C0,C1:o.GeomAbs_Shape.GeomAbs_C1,C2:o.GeomAbs_Shape.GeomAbs_C2,C3:o.GeomAbs_Shape.GeomAbs_C3},l=i(new o.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,a[r],n,3));return new Ge(l.Curve())},aa=t=>{if(Dn(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=N(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const a=n.NbArcs();if(a)for(let l=1;l<=a;l++){const c=n.Arc(l);yield new Ge(c)}}const i=Array.from(o());return n.delete(),i};function No(t,e={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=Oe();return t.flatMap(n=>{const o=r(n.adaptor()),i=Dn(o.GetType());if(i==="ELLIPSE"||i==="CIRCLE"&&tt(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(i))return n;if(i==="BEZIER_CURVE"){const c=o.Bezier().get().Degree();if([1,2,3].includes(c))return n}if(i==="BSPLINE_CURVE"){const l=aa(o);return No(l,e)}const a=bu(o,e.tolerance,e.continuity,e.maxSegments);return No(aa(r(a.adaptor())),e)})}function*Su(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*vh(t){const e=t.NbSegments();if(!e)return;const r=N();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new Ge(o),i.delete()}}const Bn=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=N(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,a;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from(Su(o)),a=Array.from(vh(o))}catch(h){throw console.error(t,e,h),new Error("Intersections failed between curves")}finally{o.delete()}const l=a.filter(h=>tt(h.firstPoint,h.lastPoint,r)).map(h=>h.firstPoint);l.length&&(i.push(...l),a=a.filter(h=>!tt(h.firstPoint,h.lastPoint,r)));const c=a.flatMap(h=>[h.firstPoint,h.lastPoint]);return{intersections:i,commonSegments:a,commonSegmentsPoints:c}},gh=(t,e=1e-9)=>{const r=N(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from(Su(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},Fn=(t,e)=>{const r=N(),[n,o]=Ye(),i=n(new r.GCE2d_MakeSegment_1(n(Je(t)),n(Je(e)))).Value(),a=new Ge(i);return tt(a.firstPoint,t)||a.reverse(),o(),a},rs=(t,e,r)=>{const n=N(),[o,i]=Ye(),a=o(new n.GCE2d_MakeArcOfCircle_4(o(Je(t)),o(Je(e)),o(Je(r)))).Value();i();const l=new Ge(a);return tt(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},mh=(t,e,r)=>{const n=N(),[o,i]=Ye(),a=o(new n.GCE2d_MakeArcOfCircle_5(o(Je(t)),o(_u(e)),o(Je(r)))).Value();i();const l=new Ge(a);return tt(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},yh=(t,e,r,n,o=[0,0],i,a=!0)=>{const l=N(),[c,h]=Ye(),d=c(new l.gp_Elips2d_2(c(jr(o,i)),t,e,!0)),g=c(new l.GCE2d_MakeArcOfEllipse_1(d,r,n,a)).Value();return h(),new Ge(g)},wh=(t,e,r)=>{const n=N(),[o,i]=Ye(),a=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));a.SetValue(1,o(Je(t))),e.forEach((c,h)=>{a.SetValue(h+2,o(Je(c)))}),a.SetValue(e.length+2,o(Je(r)));const l=new n.Geom2d_BezierCurve_1(a);return i(),new Ge(new n.Handle_Geom2d_Curve_2(l))},Eu=(t,e,r)=>{const n=ts(Zr(t,e),.5),o=Bt(r,t),i=ar(ms(n,r));return rs(t,Zr(ts(i,o),r),e)},_h=(t,e,r)=>{const n=ar(ms(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:Zr(t,i),lastPoint:Zr(e,i)}},ns=(t,e)=>{const r=Oe(),n=t.geomType;if(n==="CIRCLE"){const c=r(r(t.adaptor()).Circle()),h=c.Radius(),d=c.IsDirect()?1:-1,g=e*d,v=h+g;if(v<1e-10){const P=r(c.Location()),M=[P.X(),P.Y()],O=Y=>{const[H,K]=ar(ms(Y,M));return Zr(Y,[g*H,g*K])};return{collapsed:!0,firstPoint:O(t.firstPoint),lastPoint:O(t.lastPoint)}}const w=N(),E=new w.gp_Circ2d_3(c.Axis(),v),T=new w.Geom2d_Circle_1(E),C=new w.Geom2d_TrimmedCurve(new w.Handle_Geom2d_Curve_2(T),t.firstParameter,t.lastParameter,!0,!0);return new Ge(new w.Handle_Geom2d_Curve_2(C))}if(n==="LINE"){const{firstPoint:c,lastPoint:h}=_h(t.firstPoint,t.lastPoint,e);return Fn(c,h)}const o=N(),i=new Ge(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),a=bu(i.adaptor());return gh(a).length?{collapsed:!0,firstPoint:a.firstPoint,lastPoint:a.lastPoint}:a};function Tu(t,e,r){const n=ch(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,a=ns(t,i),l=ns(e,i);if(!(a instanceof Ge)||!(l instanceof Ge))return null;let c;try{const{intersections:w}=Bn(a,l,1e-9);c=w.at(-1)}catch{return null}if(!Io(c))return null;const h=c,d=(w,E)=>{const[T,C]=E.tangentAt(h),P=ar([-C,T]),M=Zr(h,ts(P,i)),O=w.parameter(M,1e-6);return w.splitAt([O])},[g]=d(t,a),[,v]=d(e,l);return{first:g,second:v,center:h}}function os(t,e,r){const n=Tu(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:a}=n;return[o,Eu(o.lastPoint,i.firstPoint,a),i]}function is(t,e,r){const n=Tu(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,Fn(o.lastPoint,i.firstPoint),i]}class bh{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let a=(i<<1)+1;const l=a+1;let c=this.ids[a],h=this.values[a];const d=this.values[l];if(l<this.length&&d<h&&(a=l,c=this.ids[l],h=d),h>=n)break;this.ids[i]=c,this.values[i]=h,i=a}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const ua=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Ni=3;class ys{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==Ni)throw new Error(`Got v${n>>4} data when expected v${Ni}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new ys(i,o,ua[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,a=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),a+=i,this._levelBounds.push(a*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const l=ua.indexOf(this.ArrayType),c=a*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=a*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+c+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Ni<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new bh}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let a=4*i;const l=this._boxes[a++],c=this._boxes[a++],h=this._boxes[a++],d=this._boxes[a++],g=Math.floor(o*((l+h)/2-this.minX)/e),v=Math.floor(o*((c+d)/2-this.minY)/r);n[i]=Eh(g,v)}ss(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,a=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;a<l;){const c=a;let h=1/0,d=1/0,g=-1/0,v=-1/0;for(let w=0;w<this.nodeSize&&a<l;w++)h=Math.min(h,this._boxes[a++]),d=Math.min(d,this._boxes[a++]),g=Math.max(g,this._boxes[a++]),v=Math.max(v,this._boxes[a++]);this._indices[this._pos>>2]=c,this._boxes[this._pos++]=h,this._boxes[this._pos++]=d,this._boxes[this._pos++]=g,this._boxes[this._pos++]=v}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=[],c=[];for(;a!==void 0;){const h=Math.min(a+this.nodeSize*4,ca(a,this._levelBounds));for(let d=a;d<h;d+=4){if(n<this._boxes[d]||o<this._boxes[d+1]||e>this._boxes[d+2]||r>this._boxes[d+3])continue;const g=this._indices[d>>2]|0;a<this.numItems*4?(i===void 0||i(g))&&c.push(g):l.push(g)}a=l.pop()}return c}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=this._queue,c=[],h=o*o;for(;a!==void 0;){const d=Math.min(a+this.nodeSize*4,ca(a,this._levelBounds));for(let g=a;g<d;g+=4){const v=this._indices[g>>2]|0,w=la(e,this._boxes[g],this._boxes[g+2]),E=la(r,this._boxes[g+1],this._boxes[g+3]),T=w*w+E*E;a<this.numItems*4?(i===void 0||i(v))&&l.push((v<<1)+1,T):l.push(v<<1,T)}for(;l.length&&l.peek()&1;)if(l.peekValue()>h||(c.push(l.pop()>>1),c.length===n))return l.clear(),c;a=l.pop()>>1}return l.clear(),c}}function la(t,e,r){return t<e?e-t:t<=r?0:t-r}function ca(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function ss(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const a=t[n+o>>1];let l=n-1,c=o+1;for(;;){do l++;while(t[l]<a);do c--;while(t[c]>a);if(l>=c)break;Sh(t,e,r,l,c)}ss(t,e,r,n,c,i),ss(t,e,r,c+1,o,i)}function Sh(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const a=4*n,l=4*o,c=e[a],h=e[a+1],d=e[a+2],g=e[a+3];e[a]=e[l],e[a+1]=e[l+1],e[a+2]=e[l+2],e[a+3]=e[l+3],e[l]=c,e[l+1]=h,e[l+2]=d,e[l+3]=g;const v=r[n];r[n]=r[o],r[o]=v}function Eh(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),a=r|n>>1,l=r>>1^r,c=o>>1^n&i>>1^o,h=r&o>>1^i>>1^i;r=a,n=l,o=c,i=h,a=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,c^=r&o>>2^n&i>>2,h^=n&o>>2^(r^n)&i>>2,r=a,n=l,o=c,i=h,a=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,c^=r&o>>4^n&i>>4,h^=n&o>>4^(r^n)&i>>4,r=a,n=l,o=c,i=h,c^=r&o>>8^n&i>>8,h^=n&o>>8^(r^n)&i>>8,r=c^c>>1,n=h^h>>1;let d=t^e,g=n|65535^(d|r);return d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,(g<<1|d)>>>0}const xu=(t,e=1e-7)=>{const r=new ys(t.length);t.forEach(i=>{const[a,l]=i.firstPoint;r.add(a-e,l-e,a+e,l+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,a)=>{if(o.has(a))return;const l=[i];let c=a;o.add(a);let h=t.length;for(;;){if(h--<0)throw new Error("Infinite loop detected");const d=l[l.length-1].lastPoint,[g,v]=d,w=r.search(g-e,v-e,g+e,v+e),E=M=>Math.abs((c-M)%t.length),T=w.filter(M=>!o.has(M)).map(M=>[t[M],M,E(M)]).sort(([,,M],[,,O])=>E(M)-E(O));if(T.length===0){n.push(l);break}const[C,P]=T[0];l.push(C),o.add(P),c=P}}),n};function Et(t){return Math.round(t*1e5)/1e5}const Hi=t=>`${Go(t.X())} ${Go(t.Y())}`,Th=(t,e)=>{const r=N(),n=Dn(t.GetType()),[o,i]=e,a=`${Et(o)} ${Et(i)}`;if(n==="LINE")return`L ${a}`;if(n==="BEZIER_CURVE"){const l=t.Bezier().get(),c=l.Degree();if(c===1)return`L ${a}`;if(c===2)return`Q ${Hi(l.Pole(2))} ${a}`;if(c===3){const h=Hi(l.Pole(2)),d=Hi(l.Pole(3));return`C ${h} ${d} ${a}`}}if(n==="CIRCLE"){const l=t.Circle(),c=l.Radius(),h=t.FirstParameter(),g=(t.LastParameter()-h)*wn,v=g!==360?a:`${Et(o)} ${Et(i+1e-4)}`;return`A ${c} ${c} 0 ${Math.abs(g)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${v}`}if(n==="ELLIPSE"){const l=t.Ellipse(),c=l.MajorRadius(),h=l.MinorRadius(),d=t.FirstParameter(),v=(t.LastParameter()-d)*wn,w=v!==360?a:`${Et(o)} ${Et(i+1e-4)}`,E=new r.gp_Dir2d_1,T=180-l.XAxis().Direction().Angle(E)*wn;return E.delete(),`A ${Et(c)} ${Et(h)} ${Et(T)} ${Math.abs(v)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${w}`}throw new Error(`Unsupported curve type: ${n}`)},xh={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},Ho={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class Cu{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Ch extends pt{constructor(){const e=N();super(new e.Message_ProgressRange_1)}}class Vi extends pt{constructor(e){const r=N();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(e.wrapped)}distanceTo(e){this.wrapped.LoadS2(e.wrapped);const r=new Ch;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class Pu extends Cu{when(e){return this.filters.push(e),this}inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new D(xh[e]):n=new D(e);const o=({normal:i})=>{if(!i)return!1;const a=Math.acos(Math.abs(i.dot(n)));return Math.abs(a-Tt*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=zo(r),o=new Vi(n),i=({element:a})=>Math.abs(o.distanceTo(a)-e)<1e-6;return this.filters.push(i),this}containsPoint(e){return this.atDistance(0,e)}withinDistance(e,r=[0,0,0]){const n=zo(r),o=new Vi(n),i=({element:a})=>o.distanceTo(a)-e<1e-6;return this.filters.push(i),this}inBox(e,r){const n=_e(e,r);return this.inShape(n)}inShape(e){const r=new Vi(e),n=({element:o})=>r.distanceTo(o)<1e-6;return this.filters.push(n),this}}class Vo extends Pu{clone(){const e=new Vo;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&Ho[e])return this.atAngleWith(Ho[e],90);if(typeof e!="string"&&e instanceof st)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof st?hr(e):hr(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.startPoint,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class ws extends Pu{clone(){const e=new ws;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&Ho[e])return this.atAngleWith(Ho[e]);if(typeof e!="string"&&e instanceof st)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof st?hr(e):hr(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.center,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const Ph=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},Wi=2*Math.PI,fa=t=>{const e=t%Wi,r=e<0?e+Wi:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-Wi)};class Wo extends Cu{clone(){const e=new Wo;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>tt(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(Bt(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return tt(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,a]=r,l=Math.min(n,i),c=Math.max(n,i),h=Math.min(o,a),d=Math.max(o,a);function g({element:v}){const[w,E]=v.point;return w>=l&&w<=c&&E>=h&&E<=d}return this.filters.push(g),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(fa(fh(o,i))-fa(Tt*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return Ph(e).filter(r=>this.shouldKeep(r))}}const ha=t=>{const e=N();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},Ah=function*(e,r){const n=N(),o=new n.TopExp_Explorer_2(e,ha(r),ha("shape")),i=new Map;for(;o.More();){const a=o.Current(),l=a.HashCode(mu);i.get(l)||(i.set(l,!0),yield a),o.Next()}o.delete()},Au=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class ni extends pt{constructor(e){super(e)}clone(){return new this.constructor(Ar(this.wrapped))}get hashCode(){return this.wrapped.HashCode(mu)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=N(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=Le(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=Le(nh(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Le(rh(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=Le(oh(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=Le(ih(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return Ah(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>Ar(r))}get edges(){return this._listTopo("edge").map(e=>new dr(e))}get faces(){return this._listTopo("face").map(e=>new Jr(e))}get wires(){return this._listTopo("wire").map(e=>new Kt(e))}get boundingBox(){const e=new th;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const a=[];for(const l of this.faces){const c=l.triangulation(o.length/3);if(!c)continue;const{trianglesIndexes:h,vertices:d,verticesNormals:g}=c;a.push({start:n.length,count:h.length,faceId:l.hashCode}),n=n.concat(h),o=o.concat(d),i=i.concat(g)}return{triangles:n,vertices:o,normals:i,faceGroups:a}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=Oe(),i=new Set,a=[],l=[],c=()=>{const d=a.length;let g=null;return[v=>{g?(a.push(...g),g=[v.X(),v.Y(),v.Z()],a.push(...g)):g=[v.X(),v.Y(),v.Z()]},v=>{l.push({start:d/3,count:(a.length-d)/3,edgeId:v}),i.add(v)}]},h=o(new this.oc.TopLoc_Location_1);for(const d of this.faces){const g=o(this.oc.BRep_Tool.Triangulation(d.wrapped,h,0));if(g.IsNull())continue;const v=g.get();for(const w of d.edges){if(o(w),i.has(w.hashCode))continue;const E=o(new this.oc.TopLoc_Location_1),T=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(w.wrapped,g,E)),C=(n=T==null?void 0:T.get())==null?void 0:n.Nodes();if(!C)continue;o(C);const[P,M]=c();for(let O=C.Lower();O<=C.Upper();O++){const Y=o(o(v.Node(C.Value(O))).Transformed(E.Transformation()));P(Y)}M(w.hashCode)}}for(const d of this.edges){o(d);const g=d.hashCode;if(i.has(g))continue;const v=o(new this.oc.BRepAdaptor_Curve_2(d.wrapped)),w=o(new this.oc.GCPnts_TangentialDeflection_2(v,e,r,2,1e-9,1e-7)),[E,T]=c();for(let C=0;C<w.NbPoints();C++){const P=o(w.Value(C+1).Transformed(h.Transformation()));E(P)}T(g)}return{lines:a,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const a=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([a],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class ku extends ni{}class Ru extends ni{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new kh(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(e=0){return this.curve.tangentAt(e)}pointAt(e=0){return this.curve.pointAt(e)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class kh extends pt{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return Dn(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new D(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new D(e)}_mapParameter(e){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*e}pointAt(e=.5){return new D(this.wrapped.Value(this._mapParameter(e)))}tangentAt(e=.5){const r=this._mapParameter(e),n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new D(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class dr extends Ru{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Kt extends Ru{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=Le(o.Shape());if(o.delete(),this.delete(),!(i instanceof Kt))throw new Error("Could not offset with a wire");return i}}class Rh extends pt{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Jr extends ni{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Rh(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:a}=this.UVBounds,l=this._geomAdaptor(),c=new this.oc.gp_Pnt_1,h=e*(o-n)+n,d=r*(a-i)+i;l.D0(h,d,c);const g=new D(c);return l.delete(),c.delete(),g}normalAt(e){let r=0,n=0;const o=Oe();if(e){const h=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),d=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(ht(e)),h,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),g={current:0},v={current:0};d.LowerDistanceParameters(g,v),r=g.current,n=v.current}else{const{uMin:h,uMax:d,vMin:g,vMax:v}=this.UVBounds;r=.5*(h+d),n=.5*(g+v)}const i=o(new this.oc.gp_Pnt_1),a=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,a),new D(a)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new D(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Kt(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=Oe(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),a={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=o.get(),c=l.NbNodes();a.vertices=new Array(c*3);for(let E=1;E<=c;E++){const T=r(r(l.Node(E)).Transformed(i));a.vertices[(E-1)*3+0]=T.X(),a.vertices[(E-1)*3+1]=T.Y(),a.vertices[(E-1)*3+2]=T.Z()}const h=r(new this.oc.TColgp_Array1OfDir_2(1,c)),d=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,d,h),a.verticesNormals=new Array(h.Length()*3);for(let E=h.Lower();E<=h.Upper();E++){const T=r(r(h.Value(E)).Transformed(i));a.verticesNormals[(E-1)*3+0]=T.X(),a.verticesNormals[(E-1)*3+1]=T.Y(),a.verticesNormals[(E-1)*3+2]=T.Z()}const g=this.orientation,v=l.NbTriangles();a.trianglesIndexes=new Array(v*3);let w=0;for(let E=1;E<=v;E++){const T=r(l.Triangle(E));let C=T.Value(1),P=T.Value(2);const M=T.Value(3);if(g==="backward"){const O=C;C=P,P=O}a.trianglesIndexes[w*3+0]=C-1+e,a.trianglesIndexes[w*3+1]=P-1+e,a.trianglesIndexes[w*3+2]=M-1+e,w++}return a}}class oi extends ni{fuse(e,{optimisation:r="none"}={}){const n=Oe(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Le(i.Shape());if(!$t(a))throw new Error("Could not fuse as a 3d shape");return a}cut(e,{optimisation:r="none"}={}){const n=Oe(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Le(i.Shape());if(!$t(a))throw new Error("Could not cut as a 3d shape");return a}intersect(e){const r=Oe(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=Le(o.Shape());if(!$t(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,a;if(typeof e=="number"){a=e;const w=new ws;i=typeof r=="function"?r(w):w}else a=e.thickness,i=e.filter;const l=Oe(),c=i.find(this),h=l(new this.oc.TopTools_ListOfShape_1);c.forEach(w=>{h.Append_1(w.wrapped)});const d=l(new this.oc.Message_ProgressRange_1),g=l(new this.oc.BRepOffsetAPI_MakeThickSolid);g.MakeThickSolidByJoin(this.wrapped,h,-a,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,d);const v=Le(g.Shape());if(!$t(v))throw new Error("Could not shell as a 3d shape");return v}_builderIter(e,r){if(typeof e=="number"){let a=0;for(const l of this._iterTopo("edge"))r(e,Ar(l)),a+=1;return a}let n,o=null;typeof e=="function"?n=e:(n=a=>e.filter.shouldKeep(a)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const a of this._iterTopo("edge")){const l=Ar(a),c=new dr(l),h=n(c);h&&(r(h,l),i+=1),c.delete()}return o&&o(),i}fillet(e,r){const o=Oe()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new Vo)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not fillet, no edge was selected");const l=Le(o.Shape());if(!$t(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const o=Oe()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new Vo)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not chamfer, no edge was selected");const l=Le(o.Shape());if(!$t(l))throw new Error("Could not chamfer as a 3d shape");return l}}class Ou extends oi{}class Rr extends oi{}class Du extends oi{}class Mu extends oi{}function $t(t){return t instanceof Ou||t instanceof Rr||t instanceof Du||t instanceof Mu}function pa(t){return t instanceof Kt}function Ar(t){const e=N(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=Au(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function Le(t){const r=N().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,ku],[r.TopAbs_EDGE,dr],[r.TopAbs_WIRE,Kt],[r.TopAbs_FACE,Jr],[r.TopAbs_SHELL,Ou],[r.TopAbs_SOLID,Rr],[r.TopAbs_COMPSOLID,Du],[r.TopAbs_COMPOUND,Mu]]).get(Au(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(Ar(t))}const Bu=(t,e)=>{const r=N();return new dr(new r.BRepBuilderAPI_MakeEdge_3(ht(t),ht(e)).Edge())},Oh=(t,e=[0,0,0],r=[0,0,1])=>{const n=N(),[o,i]=Ye(),a=o(On(e,r)),l=o(new n.gp_Circ_2(a,t)),c=o(new n.BRepBuilderAPI_MakeEdge_8(l)),h=new dr(c.Edge());return i(),h},Dh=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const a=N(),[l,c]=Ye();let h=2*Math.PI;i&&(h=-2*Math.PI);const d=l(new a.Geom2d_Line_3(l(new a.gp_Pnt2d_3(0,0)),l(new a.gp_Dir2d_4(h,t)))),g=e/t,v=d.Value(0),w=d.Value(g*Math.sqrt((2*Math.PI)**2+t**2)),E=l(new a.GCE2d_MakeSegment_1(v,w)),T=new a.Geom_CylindricalSurface_1(l(Tn(n,o)),r),C=l(new a.BRepBuilderAPI_MakeEdge_30(l(new a.Handle_Geom2d_Curve_2(E.Value().get())),l(new a.Handle_Geom_Surface_2(T)))).Edge(),P=l(new a.BRepBuilderAPI_MakeWire_2(C)).Wire();return a.BRepLib.BuildCurves3d_2(P),c(),new Kt(P)},xn=t=>{const e=N(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(a=>{a instanceof dr&&r.Add_1(a.wrapped),a instanceof Kt&&r.Add_2(a.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const a=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${a.get(o)||"unknown error"}`)}const i=new Kt(r.Wire());return r.delete(),n.delete(),i},Do=(t,e)=>{const r=N(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new Jr(o)},Mh=(t,e)=>{const r=N(),[n,o]=Ye(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new Jr(l)},Sr=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=N(),i=On(r,n),a=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),l=new Rr(a.Shape());return i.delete(),a.delete(),l},Bh=t=>{const e=N(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new Rr(r.Shape());return r.delete(),n};class Fh extends pt{constructor(e,r,n){const o=N(),i=Oe(),a=Math.sqrt(e*r/n),l=e/a,c=r/a,h=new o.gp_GTrsf_1;h.SetAffinity_1(_n([0,0,0],[0,1,0]),l);const d=i(new o.gp_GTrsf_1);d.SetAffinity_1(_n([0,0,0],[0,0,1]),a);const g=i(new o.gp_GTrsf_1);g.SetAffinity_1(_n([0,0,0],[1,0,0]),c),h.Multiply(d),h.Multiply(g),super(h)}applyToPoint(e){const r=N(),o=Oe()(e.XYZ());return this.wrapped.Transforms_1(o),new r.gp_Pnt_2(o)}}function Lh(t){const e=[];for(let r=t.LowerRow();r<=t.UpperRow();r++){const n=[];e.push(n);for(let o=t.LowerCol();o<=t.UpperCol();o++){const i=t.Value(r,o);n.push(i)}}return e}const Uh=(t,e,r)=>{const n=N(),o=Oe(),i=o(new n.gp_Sphere_1);i.SetRadius(1);const a=o(new n.Geom_SphericalSurface_2(i)),l=n.GeomConvert.SurfaceToBSplineSurface(a.UReversed()).get(),c=Lh(l.Poles_2()),h=new Fh(t,e,r);c.forEach((g,v)=>{g.forEach((w,E)=>{const T=h.applyToPoint(w);l.SetPole_1(v+1,E+1,T)})});const d=Le(o(new n.BRepBuilderAPI_MakeShell_2(l.UReversed(),!1)).Shell());return _s([d])},_e=(t,e)=>{const r=N(),n=new r.BRepPrimAPI_MakeBox_4(ht(t),ht(e)),o=new Rr(n.Solid());return n.delete(),o},zo=t=>{const e=N(),r=ht(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new ku(o)},Ft=t=>{const e=N(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),Le(n)},Pe=Ft;function Ih(t){const e=N(),r=Oe(),n=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return t.forEach(({wrapped:o})=>{n.Add(o)}),n.Perform(r(new e.Message_ProgressRange_1)),Le(Ar(n.SewedShape()))}function _s(t){const e=Oe(),r=N(),n=Ih(t),o=Le(e(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(o instanceof Rr))throw new Error("Could not make a solid of faces and shells");return o}const Fu=(t,e)=>{const r=N(),[n,o]=Ye(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(h=>{i.Add(h.wrapped)});const a=n(i.Face()),l=n(new r.ShapeFix_Face_2(a));l.FixOrientation_1();const c=l.Face();return o(),new Jr(c)},Gh=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Nh=t=>{let e;t?Gh(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let a;typeof r=="number"?a=Wr(1,r*Tt):a=r;let l;return typeof i=="number"?l=Wr(1,i*Tt):l=i,{endTangent:a,startFactor:n,endFactor:o,startTangent:l}};function da(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let a=Math.acos(o/i);return t*n-e*r<0&&(a=-a),a}function Hh([t,e],[r,n],o,i,a,l,c){const h=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const d=Math.sin(a),g=Math.cos(a),v=(t-r)/2,w=(e-n)/2,E=(t+r)/2,T=(e+n)/2,C=g*v+d*w,P=g*w-d*v,M=C*C/(o*o)+P*P/(i*i);M>1&&(o=o*Math.sqrt(M),i=i*Math.sqrt(M));const O=o*i,Y=o*P,H=i*C,K=Y*Y+H*H;if(!K)throw Error("start point can not be same as end point");let j=Math.sqrt(Math.abs((O*O-K)/K));l==c&&(j=-j);const Q=j*Y/i,oe=-j*H/o,de=g*Q-d*oe+E,we=d*Q+g*oe+T,Te=(C-Q)/o,xe=(C+Q)/o,se=(P-oe)/i,fe=(P+oe)/i,be=da(1,0,Te,se);let ie=da(Te,se,-xe,-fe);for(;ie>h;)ie-=h;for(;ie<0;)ie+=h;c||(ie-=h);let te=be+ie;for(;te>h;)te-=h;for(;te<0;)te+=h;return{cx:de,cy:we,startAngle:be,deltaAngle:ie,endAngle:te,clockwise:!!c,rx:o,ry:i}}const Lu=(t,e)=>{const r=N(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new Rr(Ar(n.Shape()));return n.delete(),o},Uu=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=N(),i=_n(e,r),a=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*Tt,!1),l=Le(a.Shape());if(i.delete(),a.delete(),!$t(l))throw new Error("Could not revolve to a 3d shape");return l};function Cn(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:a,support:l,forceProfileSpineOthogonality:c}={},h=!1){const d=N(),g=i==="round"?!0:!!c,v=new d.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const T={transformed:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];T&&v.SetTransitionMode(T)}l?v.SetMode_4(l):r&&v.SetMode_1(r),n&&v.SetMode_5(n.wrapped,!1,d.BRepFill_TypeOfContact.BRepFill_NoContact),o?v.SetLaw_1(t.wrapped,o,!!a,g):v.Add_1(t.wrapped,!!a,g);const w=new d.Message_ProgressRange_1;v.Build(w),h||v.MakeSolid();const E=Le(v.Shape());if(!$t(E))throw new Error("Could not sweep to a 3d shape");if(h){const T=Le(v.FirstShape()),C=Le(v.LastShape());if(!pa(T))throw new Error("Could not sweep with one start wire");if(!pa(C))throw new Error("Could not sweep with one end wire");return v.delete(),[E,T,C]}return v.delete(),w.delete(),E}const Iu=(t,{profile:e,endFactor:r=1})=>{let n;const o=N();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function Gu(t,e,r,n,o=!1){const i=new D(e),a=new D(r),l=Bu(i,i.add(a)),c=xn([l]),h=n?Iu(a.Length,n):null;return o?Cn(t,c,{law:h},o):Cn(t,c,{law:h},o)}function Nu(t,e,r,n,o,i=!1){const a=new D(r),l=new D(n),c=Bu(a,a.add(l)),h=xn([c]),d=360/e*l.Length,g=1,v=Dh(d,l.Length,g,r,n),w=o?Iu(l.Length,o):null;return i?Cn(t,h,{auxiliarySpine:v,law:w},i):Cn(t,h,{auxiliarySpine:v,law:w},i)}const Vh=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=N(),[a,l]=Ye(),c=a(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&c.AddVertex(a(zo(r)).wrapped),t.forEach(g=>c.AddWire(g.wrapped)),n&&c.AddVertex(a(zo(n)).wrapped);const h=a(new i.Message_ProgressRange_1);c.Build(h);const d=Le(c.Shape());if(l(),!$t(d))throw new Error("Could not loft to a 3d shape");return d};class qr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new qr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new D(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new D(e)}face(){let e;return this.baseFace?e=Mh(this.baseFace,this.wire):e=Do(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=Do(this.wire),o=Uu(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[a,l]=Ye(),c=a(new D(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const g=Gu(this.wire,i||this.defaultOrigin,c,n);return l(),this.delete(),g}if(o){const g=Nu(this.wire,o,i||this.defaultOrigin,c,n);return l(),this.delete(),g}const h=Do(this.wire),d=Lu(h,c);return l(),this.delete(),d}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),a=e(new st(n,i,o),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const c=Cn(a.wire,this.wire,l);return this.delete(),c}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=Vh(o.map(a=>a.wire),r,n);return o.forEach(a=>a.delete()),i}}const Wh=t=>{const e=N(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new Mn(r)};function zh(t,e){const[r,n]=Ye(),o=r(On(e.origin,e.zDir,e.xDir)),i=N(),a=t.map(l=>{const c=i.GeomLib.To3d(o,l.wrapped);return new dr(new i.BRepBuilderAPI_MakeEdge_24(c).Edge())});return n(),a}const $h=(t,e)=>{const[r,n]=Ye(),o=N(),i=t.map(a=>{const l=r(new o.BRepBuilderAPI_MakeEdge_30(a.wrapped,e));return new dr(l.Edge())});return n(),i},Hu=(t,e)=>{const r=N();return t.map(o=>e?new Ge(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class Ln extends pt{transformCurves(e){return Hu(e,this.wrapped)}}const Vu=(t,e,r=[0,0])=>{const n=N(),o=jr(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new Ln(i)},Xh=t=>{const e=N(),[r,n]=Ye(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(_u(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new Ln(i)},Yh=(t,e=[0,0],r="center")=>{const n=N(),[o,i]=Ye(),a=new n.gp_Trsf2d_1;r==="center"?a.SetMirror_1(o(Je(t))):a.SetMirror_2(o(jr(e,t)));const l=new n.gp_GTrsf2d_2(a);return i(),new Ln(l)},jh=(t,e=[0,0])=>{const r=N(),[n,o]=Ye(),i=new r.gp_Trsf2d_1;i.SetRotation(n(Je(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new Ln(a)},Zh=(t,e=[0,0])=>{const r=N(),[n,o]=Ye(),i=new r.gp_Trsf2d_1;i.SetScale(n(Je(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new Ln(a)};function qh(t,e,r="original"){const[n,o]=Ye(),i=N();let a=n(i.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let c=null;const h=n(jr([0,0],[0,1])),d=n(jr([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const w=n(a.get().Cylinder());w.Direct()||(a=a.get().UReversed());const E=w.Radius();c=Vu(1/E,[0,1]).wrapped}if(r==="bounds"){if(c=n(new i.gp_GTrsf2d_1),c.SetAffinity(h,l.uMax-l.uMin),l.uMin!==0){const E=n(new i.gp_GTrsf2d_1);E.SetTranslationPart(new i.gp_XY_2(0,-l.uMin)),c.Multiply(E)}const w=n(new i.gp_GTrsf2d_1);if(w.SetAffinity(d,l.vMax-l.vMin),c.Multiply(w),l.vMin!==0){const E=n(new i.gp_GTrsf2d_1);E.SetTranslationPart(n(new i.gp_XY_2(0,-l.vMin))),c.Multiply(E)}}const g=Hu(t,c),v=$h(g,a);return o(),v}function Kh(t,e){const r=N(),o=Oe()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),i=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&i.Reverse(),new Ge(new r.Handle_Geom2d_Curve_2(i))}const ii=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},bs=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${ii(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class ce{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new ce(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=Wh(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=Vu(e,r,n).transformCurves(this.curves);return new ce(o)}scale(e,r){const n=r||this.boundingBox.center,o=Zh(e,n).transformCurves(this.curves);return new ce(o)}rotate(e,r){const n=jh(e*Tt,r).transformCurves(this.curves);return new ce(n)}translate(e,r=0){const n=Io(e)?e:[e,r],o=Xh(n).transformCurves(this.curves);return new ce(o)}mirror(e,r=[0,0],n="center"){const o=Yh(e,r,n).transformCurves(this.curves);return new ce(o)}sketchOnPlane(e,r){const n=e instanceof st?hr(e):hr(e,r),o=zh(this.curves,n),i=xn(o);return new qr(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=N(),o=qh(this.curves,e,r),i=xn(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const a=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);a.FixEdgeCurves(),a.delete();const l=new qr(i);if(i.isClosed){const c=l.clone().face();l.defaultOrigin=c.pointOnSurface(.5,.5),l.defaultDirection=c.normalAt(),c.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const c=i.startPoint;l.defaultOrigin=c,l.defaultDirection=e.normalAt(c),l.baseFace=e}return l}toSVGPathD(){const e=Oe(),r=this.clone().mirror([1,0],[0,0],"plane"),o=No(r.curves).flatMap(l=>Th(e(l.adaptor()),l.lastPoint)),[i,a]=r.curves[0].firstPoint;return`M ${Et(i)} ${Et(a)} ${o.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return ii(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return bs(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=N(),n=new r.Geom2dAPI_InterCurveCurve_1,o=Fn(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,l.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return tt(this.firstPoint,this.lastPoint)}intersects(e){const r=N(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class Wu{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?is:os;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=Fn(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*Tt,o=Wr(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*Tt,[o,i]=Wr(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=ar(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(rs(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,a]=this.pointer;return this.threePointsArcTo([i+e,a+r],[i+n,a+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,a]=e,l=[(n+i)/2,(o+a)/2],c=[-(a-o),i-n],h=Math.sqrt(c[0]**2+c[1]**2),d=[l[0]+c[0]/h*r,l[1]+c[1]/h*r];return this.saveCurve(rs(this._convertToUV(this.pointer),this._convertToUV(d),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=Bt(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(mh(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,a=!1){let l=o,c=r,h=n;r<n&&(l=o+90,c=n,h=r);const d=l*Tt,g=Q=>Bt(this._convertToUV(Q)),v=g(Wr(c,d)),w=g(Wr(h,d+Math.PI/2)),E=ar(this._convertToUV(ph([1,0],d))),[,T]=dh(E),{cx:C,cy:P,startAngle:M,endAngle:O,clockwise:Y,rx:H,ry:K}=Hh(this._convertToUV(this.pointer),this._convertToUV(e),v,w,T,i,a),j=yh(H,K,Y?M:O,Y?O:M,[C,P],E);return Y||j.reverse(),this.saveCurve(j),this.pointer=e,this}ellipse(e,r,n,o,i=0,a=!1,l=!1){const[c,h]=this.pointer;return this.ellipseTo([e+c,r+h],n,o,i,a,l)}halfEllipseTo(e,r,n=!1){const o=hh(e,this.pointer),i=Bt(e,this.pointer);return this.ellipseTo(e,i/2,r,o*wn,!0,n)}halfEllipse(e,r,n,o=!1){const[i,a]=this.pointer;return this.halfEllipseTo([i+e,a+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(wh(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:a}=Nh(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,c=Bt(this.pointer,e)*.25;let h;o?h=o:l?h=this._convertFromUV(l.tangentAt(1)):h=[1,0],h=ar(h);const d=[this.pointer[0]+h[0]*i*c,this.pointer[1]+h[1]*i*c];let g;n==="symmetric"?g=[-h[0],-h[1]]:g=n,g=ar(g);const v=[e[0]-g[0]*a*c,e[1]-g[1]*a*c];return this.cubicBezierCurveTo(e,d,v)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?is:os;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){tt(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(tt(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=jr(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new Ge(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class Qh extends Wu{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new ce(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const Jh=t=>{const e=N(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,a)=>{i.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,a===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=Le(r.Shape());if(r.delete(),!(o instanceof Jr))throw new Error("Failed to create a face");return o},ep=(t,e)=>{const r=N(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},va=t=>{let e,r;try{e=Do(t[0]),r=t.slice(1)}catch{e=Jh(t),r=t.slice(1).map(o=>ep(o,e))}return Fu(e,r)},ga=(t,e)=>{const r=[],n=[],o=[];t.forEach(c=>{const[h,d,g]=e(c);r.push(h),n.push(d),o.push(g)});const i=va(n),a=va(o);return _s([i,...r,a])};class ma{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return Ft(e)}face(){const e=this.outerSketch.face();return Fu(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const a=new D(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?ga(this.sketches,h=>Gu(h.wire,i||this.outerSketch.defaultOrigin,a,n,!0)):o?ga(this.sketches,h=>Nu(h.wire,o,i||this.outerSketch.defaultOrigin,a,n,!0)):Lu(this.face(),a)}revolve(e,{origin:r}={}){return Uu(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,a)=>{const l=e.sketches[a];return i.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),_s(n)}}class Ce{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new Ce(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Mn;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new Ce(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new Ce(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new Ce(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new Ce(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new Ce(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new ma(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new ma(n)}toSVGViewBox(e=1){return ii(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return bs(this.toSVGGroup(),this.boundingBox,e)}}class ya{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof qr?r.wire:r.wires);return Ft(e)}faces(){const e=this.sketches.map(r=>r.face());return Ft(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return Ft(n)}revolve(e,r){return Ft(this.sketches.map(n=>n.revolve(e,r)))}}class re{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new re(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Mn;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new re(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new re(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new re(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new re(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new re(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new ya(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new ya(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return ii(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof ce?n.toSVGPath():n.toSVGGroup());return bs(r.join(`
    `),this.boundingBox,e)}}const tp=t=>{const e=t.map((o,i)=>t.slice(i+1).map((a,l)=>[l+i+1,a]).filter(([,a])=>!o.boundingBox.isOut(a.boundingBox)).map(([a])=>a)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let a=n[i];a||(a=[],r.push(a)),a.push(t[i]),o.length&&o.forEach(l=>{n[l]=a})}),r},zu=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((a,l)=>r===l?!1:a.isInside(o));return{blueprint:e,isIn:i}}),rp=(t,e)=>t.flatMap(({blueprint:r})=>Ss(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),np=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=Ss(zu(t.map(({blueprint:o})=>o)));return[r,...n]},Ss=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?rp(e,t):np(r,t)},Un=t=>{const e=tp(t).map(zu);return new re(e.flatMap(Ss).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new Ce(r.map(({blueprint:n})=>n)))))},op=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let i=Math.min(n,t/2),a=Math.min(o,e/2);const l=i&&a;l||(i=0,a=0);const c=i===a,h=new Qh([Math.min(0,-(t/2-i)),-e/2]),d=(g,v)=>{l&&(c?h.tangentArc(g,v):h.ellipse(g,v,i,a,0,!1,!0))};return i<t/2&&h.hLine(t-2*i),d(i,a),a<e/2&&h.vLine(e-2*a),d(-i,a),i<t/2&&h.hLine(-(t-2*i)),d(-i,-a),a<e/2&&h.vLine(-(e-2*a)),d(i,-a),h.close()},Mo=1e-9,et=(t,e)=>tt(t,e,Mo),mn=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},wa=(t,e)=>{const r=t.findIndex(i=>et(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},_a=(t,e)=>{const r=a=>et(e.firstPoint,a.firstPoint)&&et(e.lastPoint,a.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Es(t),n=t.findIndex(r),n===-1))throw console.error(t.map(a=>a.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*ba(t,e,r){const n=a=>!!e.find(l=>et(l,a.lastPoint)),o=a=>!!r.find(l=>et(l.firstPoint,a.firstPoint)&&et(l.lastPoint,a.lastPoint)||et(l.firstPoint,a.lastPoint)&&et(l.lastPoint,a.firstPoint));let i=[];for(const a of t)n(a)?(i.push(a),yield i,i=[]):o(a)?(i.length&&(yield i,i=[]),yield[a]):i.push(a);i.length&&(yield i)}const ip=t=>t[0].firstPoint,zi=t=>t[t.length-1].lastPoint,Es=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),sp=t=>(t.reverse(),t.map(Es));function ap(t,e,r){return t.filter(n=>{const o=e.filter(l=>et(l.firstPoint,n)||et(l.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(l=>r.isInside(mn(l)));return!(i.every(l=>l)||!i.some(l=>l))})}function up(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((v,w)=>{e.curves.forEach((E,T)=>{const{intersections:C,commonSegments:P,commonSegmentsPoints:M}=Bn(v,E,Mo/100);r.push(...C),o[w].push(...C),i[T].push(...C),n.push(...P),r.push(...M),o[w].push(...M),i[T].push(...M)})}),r=wu(r,Mo),!r.length||r.length===1)return null;const a=([v,w])=>w.length?v.splitAt(w,Mo/100):[v];let l=$r([t.curves,o]).flatMap(a),c=$r([e.curves,i]).flatMap(a);const h=n.map(v=>[v.firstPoint,v.lastPoint]);if(r=ap(r,l,e),!r.length&&!n.length)return null;if(n.length){const v=n[0];l=_a(l,v),c=_a(c,v)}else{const v=r[0];l=wa(l,v),c=wa(c,v)}const d=Array.from(ba(l,r,n));let g=Array.from(ba(c,r,n));return(!et(zi(g[0]),zi(d[0]))||n.length>0&&g[0].length!==1)&&(g=sp(g)),$r([d,g]).map(([v,w])=>{const E=ip(v),T=zi(v);return h.find(([C,P])=>et(C,E)&&et(P,T)||et(C,T)&&et(C,E))?[v,"same"]:[v,w]})}const lp=t=>{const e=t.map(a=>a.firstPoint);let r=t.map(a=>a.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=$r([e,r]).map(([a,l],c)=>et(a,l)?null:c).filter(a=>a!==null);if(!n.length)return[t];const o=$r([n.slice(0,-1),n.slice(1)]).map(([a,l])=>t.slice(a,l));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function Ts(t,e,{firstInside:r,secondInside:n}){const o=up(t,e);if(!o){const h=mn(t.curves[0]),d=e.isInside(h),g=mn(e.curves[0]),v=t.isInside(g);return{identical:!1,firstCurveInSecond:d,secondCurveInFirst:v}}if(o.every(([,h])=>h==="same"))return{identical:!0};let i=null,a=null;const l=o.flatMap(([h,d])=>{let g=[],v=0;if(d==="same")return a===1?(a=1,[...h]):a===2||a===0?(a=null,[]):a===null?(i?i=[...i,...h]:i=h,[]):(console.error("weird situation"),[]);const w=mn(h[0]),E=e.isInside(w);(r==="keep"&&E||r==="remove"&&!E)&&(v+=1,g.push(...h));const T=mn(d[0]),C=t.isInside(T);if(n==="keep"&&C||n==="remove"&&!C){let P=d;v===1&&(P=Es(d)),v+=1,g.push(...P)}return a===null&&v===1&&i&&(g=[...i,...g]),v===1&&(a=v,i=null),g}),c=lp(l).filter(h=>h.length).map(h=>new ce(h));return c.length===0?null:c.length===1?c[0]:Un(c)}const si=(t,e)=>{const r=Ts(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof ce||r instanceof re?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new re([t,e])},Pn=(t,e)=>{const r=Ts(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof ce||r instanceof re?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new re([new Ce([t,e])]):t.clone()},xs=(t,e)=>{const r=Ts(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof ce||r instanceof re?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},as=(t,e)=>{if(t instanceof ce&&e instanceof ce){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:a}=Bn(n,o);r.push(...i),r.push(...a)})}),r=wu(r),r.length>1}if(t instanceof Ce||t instanceof re)return t.blueprints.some(r=>as(r,e));if(e instanceof Ce||e instanceof re)return e.blueprints.some(r=>as(t,r));throw new Error("Bug in the generic intersects algorithm")},cp=(t,e)=>{if(t instanceof Ce){if(e instanceof ce)return $o(e,t);if(e instanceof Ce)return Xo(t,e)}if(e instanceof Ce){if(t instanceof ce)return $o(t,e);if(t instanceof Ce)return Xo(t,e)}if(t instanceof ce&&e instanceof ce)return si(t,e);throw new Error("Bug in the generic fuse algorithm")},Sa=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((a,l)=>{const c=i.current,h=o+l+1;if(i.fusedWith.has(h))return;let d=a,g=!1;if(e.has(h)&&(d=e.get(h).current,g=!0),c.boundingBox.isOut(d.boundingBox)||!as(c,d))return;let v;if(c instanceof re||d instanceof re?v=Yt(c,d):v=cp(c,d),!(v instanceof ce||v instanceof Ce)){if(v instanceof re&&v.blueprints.length===2)return;if(v instanceof re&&v.blueprints.length===1)v=v.blueprints[0];else if(!(v instanceof re))throw console.error(v),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(h),i.current=v,g||e.set(h,i)})}),Un(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>Xt(n)))},Xt=t=>t instanceof ce?[t]:t instanceof Ce?t.blueprints:t instanceof re?t.blueprints.flatMap(e=>Xt(e)):[],$o=(t,e)=>{const r=si(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>Pn(o,t));return Un([...Xt(r),...n.flatMap(o=>Xt(o))])};function fp(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const Xo=(t,e)=>{const r=si(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(a=>Pn(a,t.blueprints[0])),o=t.blueprints.slice(1).map(a=>Pn(a,e.blueprints[0])),i=fp(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([a,l])=>Xt(xs(a,l)));return Un([...Xt(r),...n.flatMap(a=>Xt(a)),...o.flatMap(a=>Xt(a)),...i])},Yt=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof re)&&e instanceof re)return Sa([t,...e.blueprints]);if(!(e instanceof re)&&t instanceof re)return Sa([e,...t.blueprints]);if(t instanceof re&&e instanceof re){let r=Yt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=Yt(n,r)}),r}if(t instanceof Ce){if(e instanceof re)return Yt(e,t);if(e instanceof ce)return $o(e,t);if(e instanceof Ce)return Xo(t,e)}if(e instanceof Ce){if(t instanceof re)return Yt(t,e);if(t instanceof ce)return $o(t,e);if(t instanceof Ce)return Xo(t,e)}return t instanceof ce&&e instanceof ce?si(t,e):null},Yo=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof re?r.blueprints:r);return e.length===1?e[0]:new re(e)},ur=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof re)return Yo(t.blueprints.map(n=>ur(n,e)));if(t instanceof Ce){const n=t.blueprints[0];if(e instanceof ce&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=Yt(e,new re(t.blueprints.slice(1)));return Un([n,...Xt(o)])}else{let o=ur(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=ur(o,i)}),o}}if(e instanceof re)return Yo(e.blueprints.map(n=>ur(t,n)));if(e instanceof Ce){let n=Pn(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=Yt(n,xs(o,t))}),n}return Pn(t,e)};function yn(t,e){if(t===null||e===null)return null;if(t instanceof ce&&e instanceof ce)return xs(t,e);if(t instanceof re)return Yo(t.blueprints.map(r=>yn(r,e)));if(t instanceof Ce){const r=t.blueprints[0],n=t.blueprints[1];return ur(yn(r,e),n)}if(e instanceof re)return Yo(e.blueprints.map(r=>yn(t,r)));if(e instanceof Ce){const r=e.blueprints[0],n=e.blueprints[1];return ur(yn(r,t),n)}throw new Error("intersct 2D algorithm error")}const Ea=(t,e={})=>{const r=e.plane instanceof st?hr(e.plane):hr(e.plane,e.origin),n=xn([Oh(t,r.origin,r.zDir)]),o=new qr(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var a=n.charCodeAt(i),l;return a>=55296&&a<=56319&&o>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(a-55296)*1024+l-56320+65536:a}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function $u(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var hp=new $u,pp=new $u,Xu=new Uint8Array(30),Yu=new Uint16Array(30),dp=new Uint8Array(30),vp=new Uint16Array(30);function ju(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function gp(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}gp(hp,pp);ju(Xu,Yu,4,3);ju(dp,vp,2,1);Xu[28]=0;Yu[28]=258;function Nr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function vr(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}vr.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};vr.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))};vr.prototype.addX=function(t){this.addPoint(t,null)};vr.prototype.addY=function(t){this.addPoint(null,t)};vr.prototype.addBezier=function(t,e,r,n,o,i,a,l){var c=[t,e],h=[r,n],d=[o,i],g=[a,l];this.addPoint(t,e),this.addPoint(a,l);for(var v=0;v<=1;v++){var w=6*c[v]-12*h[v]+6*d[v],E=-3*c[v]+9*h[v]-9*d[v]+3*g[v],T=3*h[v]-3*c[v];if(E===0){if(w===0)continue;var C=-T/w;0<C&&C<1&&(v===0&&this.addX(Nr(c[v],h[v],d[v],g[v],C)),v===1&&this.addY(Nr(c[v],h[v],d[v],g[v],C)));continue}var P=Math.pow(w,2)-4*T*E;if(!(P<0)){var M=(-w+Math.sqrt(P))/(2*E);0<M&&M<1&&(v===0&&this.addX(Nr(c[v],h[v],d[v],g[v],M)),v===1&&this.addY(Nr(c[v],h[v],d[v],g[v],M)));var O=(-w-Math.sqrt(P))/(2*E);0<O&&O<1&&(v===0&&this.addX(Nr(c[v],h[v],d[v],g[v],O)),v===1&&this.addY(Nr(c[v],h[v],d[v],g[v],O)))}}};vr.prototype.addQuad=function(t,e,r,n,o,i){var a=t+.6666666666666666*(r-t),l=e+2/3*(n-e),c=a+1/3*(o-t),h=l+1/3*(i-e);this.addBezier(t,e,a,l,c,h,o,i)};function Ze(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Ze.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})};Ze.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})};Ze.prototype.curveTo=Ze.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})};Ze.prototype.quadTo=Ze.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})};Ze.prototype.close=Ze.prototype.closePath=function(){this.commands.push({type:"Z"})};Ze.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof vr){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)};Ze.prototype.getBoundingBox=function(){for(var t=new vr,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var a=this.commands[i];switch(a.type){case"M":t.addPoint(a.x,a.y),e=n=a.x,r=o=a.y;break;case"L":t.addPoint(a.x,a.y),n=a.x,o=a.y;break;case"Q":t.addQuad(n,o,a.x1,a.y1,a.x,a.y),n=a.x,o=a.y;break;case"C":t.addBezier(n,o,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,o=a.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+a.type)}}return t.isEmpty()&&t.addPoint(0,0),t};Ze.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())};Ze.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(t)}function r(){for(var a=arguments,l="",c=0;c<arguments.length;c+=1){var h=a[c];h>=0&&c>0&&(l+=" "),l+=e(h)}return l}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n};Ze.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e};Ze.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function Zu(t){throw new Error(t)}function Ta(t,e){t||Zu(e)}var ne={fail:Zu,argument:Ta,assert:Ta},xa=32768,Ca=2147483648,Kr={},W={},J={};function Pt(t){return function(){return t}}W.BYTE=function(t){return ne.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]};J.BYTE=Pt(1);W.CHAR=function(t){return[t.charCodeAt(0)]};J.CHAR=Pt(1);W.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e};J.CHARARRAY=function(t){return typeof t>"u"?0:t.length};W.USHORT=function(t){return[t>>8&255,t&255]};J.USHORT=Pt(2);W.SHORT=function(t){return t>=xa&&(t=-(2*xa-t)),[t>>8&255,t&255]};J.SHORT=Pt(2);W.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]};J.UINT24=Pt(3);W.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]};J.ULONG=Pt(4);W.LONG=function(t){return t>=Ca&&(t=-(2*Ca-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]};J.LONG=Pt(4);W.FIXED=W.ULONG;J.FIXED=J.ULONG;W.FWORD=W.SHORT;J.FWORD=J.SHORT;W.UFWORD=W.USHORT;J.UFWORD=J.USHORT;W.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]};J.LONGDATETIME=Pt(8);W.TAG=function(t){return ne.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]};J.TAG=Pt(4);W.Card8=W.BYTE;J.Card8=J.BYTE;W.Card16=W.USHORT;J.Card16=J.USHORT;W.OffSize=W.BYTE;J.OffSize=J.BYTE;W.SID=W.USHORT;J.SID=J.USHORT;W.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?W.NUMBER16(t):W.NUMBER32(t)};J.NUMBER=function(t){return W.NUMBER(t).length};W.NUMBER16=function(t){return[28,t>>8&255,t&255]};J.NUMBER16=Pt(3);W.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]};J.NUMBER32=Pt(5);W.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,a=e.length;i<a;i+=1){var l=e[i];l==="e"?o+=e[++i]==="-"?"c":"b":l==="."?o+="a":l==="-"?o+="e":o+=l}o+=o.length&1?"f":"ff";for(var c=[30],h=0,d=o.length;h<d;h+=2)c.push(parseInt(o.substr(h,2),16));return c};J.REAL=function(t){return W.REAL(t).length};W.NAME=W.CHARARRAY;J.NAME=J.CHARARRAY;W.STRING=W.CHARARRAY;J.STRING=J.CHARARRAY;Kr.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)};Kr.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)};W.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e};J.UTF16=function(t){return t.length*2};var us={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};Kr.MACSTRING=function(t,e,r,n){var o=us[n];if(o!==void 0){for(var i="",a=0;a<r;a++){var l=t.getUint8(e+a);l<=127?i+=String.fromCharCode(l):i+=o[l&127]}return i}};var To=typeof WeakMap=="function"&&new WeakMap,xo,mp=function(t){if(!xo){xo={};for(var e in us)xo[e]=new String(e)}var r=xo[t];if(r!==void 0){if(To){var n=To.get(r);if(n!==void 0)return n}var o=us[t];if(o!==void 0){for(var i={},a=0;a<o.length;a++)i[o.charCodeAt(a)]=a+128;return To&&To.set(r,i),i}}};W.MACSTRING=function(t,e){var r=mp(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}};J.MACSTRING=function(t,e){var r=W.MACSTRING(t,e);return r!==void 0?r.length:0};function ls(t){return t>=-128&&t<=127}function yp(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function wp(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(!ls(a)||a===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var l=e;l<i;++l)r.push(t[l]+256&255);return i}function _p(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(a===0||ls(a)&&i+1<o&&ls(t[i+1]))break;++i,++n}r.push(64|n-1);for(var l=e;l<i;++l){var c=t[l];r.push(c+65536>>8&255,c+256&255)}return i}W.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=yp(t,e,r):n>=-128&&n<=127?e=wp(t,e,r):e=_p(t,e,r)}return r};W.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=W.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var a=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,c=[void 0,W.BYTE,W.USHORT,W.UINT24,W.ULONG][l],h=0;h<r.length;h+=1){var d=c(r[h]);Array.prototype.push.apply(a,d)}return Array.prototype.concat(W.Card16(t.length),W.OffSize(l),a,n)};J.INDEX=function(t){return W.INDEX(t).length};W.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),a=t[i];e=e.concat(W.OPERAND(a.value,a.type)),e=e.concat(W.OPERATOR(i))}return e};J.DICT=function(t){return W.DICT(t).length};W.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]};W.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)ne.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(W.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(W.NUMBER(t));else if(e==="offset")r=r.concat(W.NUMBER32(t));else if(e==="number")r=r.concat(W.NUMBER(t));else if(e==="real")r=r.concat(W.REAL(t));else throw new Error("Unknown operand type "+e);return r};W.OP=W.BYTE;J.OP=J.BYTE;var Co=typeof WeakMap=="function"&&new WeakMap;W.CHARSTRING=function(t){if(Co){var e=Co.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(W[i.type](i.value))}return Co&&Co.set(t,r),r};J.CHARSTRING=function(t){return W.CHARSTRING(t).length};W.OBJECT=function(t){var e=W[t.type];return ne.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)};J.OBJECT=function(t){var e=J[t.type];return ne.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)};W.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var a=t.fields[i],l=W[a.type];ne.argument(l!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var c=t[a.name];c===void 0&&(c=a.value);var h=l(c);a.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(h)):e=e.concat(h)}for(var d=0;d<n.length;d+=1){var g=o[d],v=e.length;ne.argument(v<65536,"Table "+t.tableName+" too big."),e[g]=v>>8,e[g+1]=v&255,e=e.concat(n[d])}return e};J.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=J[o.type];ne.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var a=t[o.name];a===void 0&&(a=o.value),e+=i(a),o.type==="TABLE"&&(e+=2)}return e};W.RECORD=W.TABLE;J.RECORD=J.TABLE;W.LITERAL=function(t){return t};J.LITERAL=function(t){return t.length};function qe(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),a=0;a<i.length;a+=1){var l=i[a],c=r[l];this[l]!==void 0&&(this[l]=c)}}qe.prototype.encode=function(){return W.TABLE(this)};qe.prototype.sizeOf=function(){return J.TABLE(this)};function An(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function cs(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function kn(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function jo(t){t.format===1?qe.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(An("glyph",t.glyphs))):t.format===2?qe.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(kn("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):ne.assert(!1,"Coverage format must be 1 or 2.")}jo.prototype=Object.create(qe.prototype);jo.prototype.constructor=jo;function Zo(t){qe.call(this,"scriptListTable",kn("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return ne.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new qe("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new qe("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(An("featureIndex",o.featureIndexes)))}].concat(kn("langSys",n.langSysRecords,function(i,a){var l=i.langSys;return[{name:"langSysTag"+a,type:"TAG",value:i.tag},{name:"langSys"+a,type:"TABLE",value:new qe("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(An("featureIndex",l.featureIndexes)))}]})))}]}))}Zo.prototype=Object.create(qe.prototype);Zo.prototype.constructor=Zo;function qo(t){qe.call(this,"featureListTable",kn("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new qe("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(An("lookupListIndex",n.lookupListIndexes)))}]}))}qo.prototype=Object.create(qe.prototype);qo.prototype.constructor=qo;function Ko(t,e){qe.call(this,"lookupListTable",cs("lookup",t,function(r){var n=e[r.lookupType];return ne.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new qe("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(cs("subtable",r.subtables,n)))}))}Ko.prototype=Object.create(qe.prototype);Ko.prototype.constructor=Ko;var $={Table:qe,Record:qe,Coverage:jo,ScriptList:Zo,FeatureList:qo,LookupList:Ko,ushortList:An,tableList:cs,recordList:kn};function Pa(t,e){return t.getUint8(e)}function Qo(t,e){return t.getUint16(e,!1)}function bp(t,e){return t.getInt16(e,!1)}function Cs(t,e){return t.getUint32(e,!1)}function qu(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function Sp(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function Ep(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Tp(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function xp(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Cp={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function A(t,e){this.data=t,this.offset=e,this.relativeOffset=0}A.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};A.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t};A.prototype.parseCard8=A.prototype.parseByte;A.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};A.prototype.parseCard16=A.prototype.parseUShort;A.prototype.parseSID=A.prototype.parseUShort;A.prototype.parseOffset16=A.prototype.parseUShort;A.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t};A.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t};A.prototype.parseULong=function(){var t=Cs(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};A.prototype.parseOffset32=A.prototype.parseULong;A.prototype.parseFixed=function(){var t=qu(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t};A.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n};A.prototype.parseTag=function(){return this.parseString(4)};A.prototype.parseLongDateTime=function(){var t=Cs(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t};A.prototype.parseVersion=function(t){var e=Qo(this.data,this.offset+this.relativeOffset),r=Qo(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10};A.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Cp[t]*e};A.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e};A.prototype.parseOffset16List=A.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e};A.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e};A.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e};A.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};A.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r};A.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r};A.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r};A.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r};A.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}};A.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r};A.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new A(this.data,this.offset+e).parseStruct(t)};A.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new A(this.data,this.offset+e).parseStruct(t)};A.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var a=e[i];if(a===0){o[i]=void 0;continue}if(this.relativeOffset=a,t){for(var l=this.parseOffset16List(),c=new Array(l.length),h=0;h<l.length;h++)this.relativeOffset=a+l[h],c[h]=t.call(this);o[i]=c}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o};A.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")};A.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:A.uShort,end:A.uShort,classId:A.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")};A.list=function(t,e){return function(){return this.parseList(t,e)}};A.list32=function(t,e){return function(){return this.parseList32(t,e)}};A.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}};A.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}};A.pointer=function(t){return function(){return this.parsePointer(t)}};A.pointer32=function(t){return function(){return this.parsePointer32(t)}};A.tag=A.prototype.parseTag;A.byte=A.prototype.parseByte;A.uShort=A.offset16=A.prototype.parseUShort;A.uShortList=A.prototype.parseUShortList;A.uLong=A.offset32=A.prototype.parseULong;A.uLongList=A.prototype.parseULongList;A.struct=A.prototype.parseStruct;A.coverage=A.prototype.parseCoverage;A.classDef=A.prototype.parseClassDef;var Aa={reserved:A.uShort,reqFeatureIndex:A.uShort,featureIndexes:A.uShortList};A.prototype.parseScriptList=function(){return this.parsePointer(A.recordList({tag:A.tag,script:A.pointer({defaultLangSys:A.pointer(Aa),langSysRecords:A.recordList({tag:A.tag,langSys:A.pointer(Aa)})})}))||[]};A.prototype.parseFeatureList=function(){return this.parsePointer(A.recordList({tag:A.tag,feature:A.pointer({featureParams:A.offset16,lookupListIndexes:A.uShortList})}))||[]};A.prototype.parseLookupList=function(t){return this.parsePointer(A.list(A.pointer(function(){var e=this.parseUShort();ne.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(A.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]};A.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();ne.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:A.offset32,featureTableSubstitutionOffset:A.offset32});return r})||[]};var ae={getByte:Pa,getCard8:Pa,getUShort:Qo,getCard16:Qo,getShort:bp,getULong:Cs,getFixed:qu,getTag:Sp,getOffset:Ep,getBytes:Tp,bytesToString:xp,Parser:A};function Pp(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),a=e.parseULong(),l=o;l<=i;l+=1)t.glyphIndexMap[l]=a,a++}function Ap(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var a=new ae.Parser(r,n+o+14),l=new ae.Parser(r,n+o+16+i*2),c=new ae.Parser(r,n+o+16+i*4),h=new ae.Parser(r,n+o+16+i*6),d=n+o+16+i*8,g=0;g<i-1;g+=1)for(var v=void 0,w=a.parseUShort(),E=l.parseUShort(),T=c.parseShort(),C=h.parseUShort(),P=E;P<=w;P+=1)C!==0?(d=h.offset+h.relativeOffset-2,d+=C,d+=(P-E)*2,v=ae.getUShort(r,d),v!==0&&(v=v+T&65535)):v=P+T&65535,t.glyphIndexMap[P]=v}function kp(t,e){var r={};r.version=ae.getUShort(t,e),ne.argument(r.version===0,"cmap table version should be 0."),r.numTables=ae.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=ae.getUShort(t,e+4+o*8),a=ae.getUShort(t,e+4+o*8+2);if(i===3&&(a===0||a===1||a===10)||i===0&&(a===0||a===1||a===2||a===3||a===4)){n=ae.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new ae.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)Pp(r,l);else if(r.format===4)Ap(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function Rp(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Op(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function Dp(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new $.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var a=t.get(r),l=0;l<a.unicodes.length;l+=1)Rp(i,a.unicodes[l],r);i.segments=i.segments.sort(function(M,O){return M.start-O.start})}Op(i);var c=i.segments.length,h=0,d=[],g=[],v=[],w=[],E=[],T=[];for(r=0;r<c;r+=1){var C=i.segments[r];C.end<=65535&&C.start<=65535?(d=d.concat({name:"end_"+r,type:"USHORT",value:C.end}),g=g.concat({name:"start_"+r,type:"USHORT",value:C.start}),v=v.concat({name:"idDelta_"+r,type:"SHORT",value:C.delta}),w=w.concat({name:"idRangeOffset_"+r,type:"USHORT",value:C.offset}),C.glyphId!==void 0&&(E=E.concat({name:"glyph_"+r,type:"USHORT",value:C.glyphId}))):h+=1,!e&&C.glyphIndex!==void 0&&(T=T.concat({name:"cmap12Start_"+r,type:"ULONG",value:C.start}),T=T.concat({name:"cmap12End_"+r,type:"ULONG",value:C.end}),T=T.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:C.glyphIndex}))}if(i.segCountX2=(c-h)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(c-h)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(d),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(g),i.fields=i.fields.concat(v),i.fields=i.fields.concat(w),i.fields=i.fields.concat(E),i.cmap4Length=14+d.length*2+2+g.length*2+v.length*2+w.length*2+E.length*2,!e){var P=16+T.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:P},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:T.length/3}]),i.fields=i.fields.concat(T)}return i}var Mp={parse:kp,make:Dp},Bo=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Bp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Fp=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],ka=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Ku(t){this.font=t}Ku.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function Jo(t,e){this.encoding=t,this.charset=e}Jo.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function Lp(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var _r={line:Lp};function Up(t,e){var r=e||new Ze;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function yt(t){this.bindConstructorValues(t)}yt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",Up(this,t.path))};yt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)};yt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};yt.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,a;n||(n={});var l=n.xScale,c=n.yScale;if(n.hinting&&o&&o.hinting&&(a=this.path&&o.hinting.exec(this,r)),a)i=o.hinting.getCommands(a),t=Math.round(t),e=Math.round(e),l=c=1;else{i=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=h),c===void 0&&(c=h)}for(var d=new Ze,g=0;g<i.length;g+=1){var v=i[g];v.type==="M"?d.moveTo(t+v.x*l,e+-v.y*c):v.type==="L"?d.lineTo(t+v.x*l,e+-v.y*c):v.type==="Q"?d.quadraticCurveTo(t+v.x1*l,e+-v.y1*c,t+v.x*l,e+-v.y*c):v.type==="C"?d.curveTo(t+v.x1*l,e+-v.y1*c,t+v.x2*l,e+-v.y2*c,t+v.x*l,e+-v.y*c):v.type==="Z"&&d.closePath()}return d};yt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return ne.argument(e.length===0,"There are still points left in the current contour."),t};yt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i};yt.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)};yt.prototype.drawPoints=function(t,e,r,n){function o(g,v,w,E){t.beginPath();for(var T=0;T<g.length;T+=1)t.moveTo(v+g[T].x*E,w+g[T].y*E),t.arc(v+g[T].x*E,w+g[T].y*E,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,a=[],l=[],c=this.path,h=0;h<c.commands.length;h+=1){var d=c.commands[h];d.x!==void 0&&a.push({x:d.x,y:-d.y}),d.x1!==void 0&&l.push({x:d.x1,y:-d.y1}),d.x2!==void 0&&l.push({x:d.x2,y:-d.y2})}t.fillStyle="blue",o(a,e,r,i),t.fillStyle="red",o(l,e,r,i)};yt.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",_r.line(t,e,-1e4,e,1e4),_r.line(t,-1e4,r,1e4,r);var i=this.xMin||0,a=this.yMin||0,l=this.xMax||0,c=this.yMax||0,h=this.advanceWidth||0;t.strokeStyle="blue",_r.line(t,e+i*o,-1e4,e+i*o,1e4),_r.line(t,e+l*o,-1e4,e+l*o,1e4),_r.line(t,-1e4,r+-a*o,1e4,r+-a*o),_r.line(t,-1e4,r+-c*o,1e4,r+-c*o),t.strokeStyle="green",_r.line(t,e+h*o,-1e4,e+h*o,1e4)};function Po(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Ps(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Ps.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]};Ps.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function Ip(t,e){return new yt({index:e,font:t})}function Gp(t,e,r,n,o,i){return function(){var a=new yt({index:e,font:t});return a.path=function(){r(a,n,o);var l=i(t.glyphs,a);return l.unitsPerEm=t.unitsPerEm,l},Po(a,"xMin","_xMin"),Po(a,"xMax","_xMax"),Po(a,"yMin","_yMin"),Po(a,"yMax","_yMax"),a}}function Np(t,e,r,n){return function(){var o=new yt({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var Ut={GlyphSet:Ps,glyphLoader:Ip,ttfGlyphLoader:Gp,cffGlyphLoader:Np};function Qu(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!Qu(t[r],e[r]))return!1;return!0}else return!1}function fs(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function sr(t,e,r){var n=[],o=[],i=ae.getCard16(t,e),a,l;if(i!==0){var c=ae.getByte(t,e+2);a=e+(i+1)*c+2;for(var h=e+3,d=0;d<i+1;d+=1)n.push(ae.getOffset(t,h,c)),h+=c;l=a+n[i]}else l=e+2;for(var g=0;g<n.length-1;g+=1){var v=ae.getBytes(t,a+n[g],a+n[g+1]);r&&(v=r(v)),o.push(v)}return{objects:o,startOffset:e,endOffset:l}}function Hp(t,e){var r=[],n=ae.getCard16(t,e),o,i;if(n!==0){var a=ae.getByte(t,e+2);o=e+(n+1)*a+2;for(var l=e+3,c=0;c<n+1;c+=1)r.push(ae.getOffset(t,l,a)),l+=a;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function Vp(t,e,r,n,o){var i=ae.getCard16(r,n),a=0;if(i!==0){var l=ae.getByte(r,n+2);a=n+(i+1)*l+2}var c=ae.getBytes(r,a+e[t],a+e[t+1]);return o&&(c=o(c)),c}function Wp(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,a=o&15;if(i===r||(e+=n[i],a===r))break;e+=n[a]}return parseFloat(e)}function zp(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return Wp(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function $p(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Ju(t,e,r){e=e!==void 0?e:0;var n=new ae.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var a=n.parseByte();a<=21?(a===12&&(a=1200+n.parseByte()),o.push([a,i]),i=[]):i.push(zp(n,a))}return $p(o)}function Sn(t,e){return e<=390?e=Bo[e]:e=t[e-391],e}function el(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var a=e[i];if(Array.isArray(a.type)){var l=[];l.length=a.type.length;for(var c=0;c<a.type.length;c++)o=t[a.op]!==void 0?t[a.op][c]:void 0,o===void 0&&(o=a.value!==void 0&&a.value[c]!==void 0?a.value[c]:null),a.type[c]==="SID"&&(o=Sn(r,o)),l[c]=o;n[a.name]=l}else o=t[a.op],o===void 0&&(o=a.value!==void 0?a.value:null),a.type==="SID"&&(o=Sn(r,o)),n[a.name]=o}return n}function Xp(t,e){var r={};return r.formatMajor=ae.getCard8(t,e),r.formatMinor=ae.getCard8(t,e+1),r.size=ae.getCard8(t,e+2),r.offsetSize=ae.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var tl=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],rl=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Yp(t,e){var r=Ju(t,0,t.byteLength);return el(r,tl,e)}function nl(t,e,r,n){var o=Ju(t,e,r);return el(o,rl,n)}function Ra(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var a=new DataView(new Uint8Array(r[i]).buffer),l=Yp(a,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var c=l.private[0],h=l.private[1];if(c!==0&&h!==0){var d=nl(t,h+e,c,n);if(l._defaultWidthX=d.defaultWidthX,l._nominalWidthX=d.nominalWidthX,d.subrs!==0){var g=h+d.subrs,v=sr(t,g+e);l._subrs=v.objects,l._subrsBias=fs(l._subrs)}l._privateDict=d}o.push(l)}return o}function jp(t,e,r,n){var o,i,a=new ae.Parser(t,e);r-=1;var l=[".notdef"],c=a.parseCard8();if(c===0)for(var h=0;h<r;h+=1)o=a.parseSID(),l.push(Sn(n,o));else if(c===1)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard8();for(var d=0;d<=i;d+=1)l.push(Sn(n,o)),o+=1}else if(c===2)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard16();for(var g=0;g<=i;g+=1)l.push(Sn(n,o)),o+=1}else throw new Error("Unknown charset format "+c);return l}function Zp(t,e,r){var n,o={},i=new ae.Parser(t,e),a=i.parseCard8();if(a===0)for(var l=i.parseCard8(),c=0;c<l;c+=1)n=i.parseCard8(),o[n]=c;else if(a===1){var h=i.parseCard8();n=1;for(var d=0;d<h;d+=1)for(var g=i.parseCard8(),v=i.parseCard8(),w=g;w<=g+v;w+=1)o[w]=n,n+=1}else throw new Error("Unknown encoding format "+a);return new Jo(o,r)}function Oa(t,e,r){var n,o,i,a,l=new Ze,c=[],h=0,d=!1,g=!1,v=0,w=0,E,T,C,P;if(t.isCIDFont){var M=t.tables.cff.topDict._fdSelect[e.index],O=t.tables.cff.topDict._fdArray[M];E=O._subrs,T=O._subrsBias,C=O._defaultWidthX,P=O._nominalWidthX}else E=t.tables.cff.topDict._subrs,T=t.tables.cff.topDict._subrsBias,C=t.tables.cff.topDict._defaultWidthX,P=t.tables.cff.topDict._nominalWidthX;var Y=C;function H(Q,oe){g&&l.closePath(),l.moveTo(Q,oe),g=!0}function K(){var Q;Q=c.length%2!==0,Q&&!d&&(Y=c.shift()+P),h+=c.length>>1,c.length=0,d=!0}function j(Q){for(var oe,de,we,Te,xe,se,fe,be,ie,te,ue,Ae,ve=0;ve<Q.length;){var Be=Q[ve];switch(ve+=1,Be){case 1:K();break;case 3:K();break;case 4:c.length>1&&!d&&(Y=c.shift()+P,d=!0),w+=c.pop(),H(v,w);break;case 5:for(;c.length>0;)v+=c.shift(),w+=c.shift(),l.lineTo(v,w);break;case 6:for(;c.length>0&&(v+=c.shift(),l.lineTo(v,w),c.length!==0);)w+=c.shift(),l.lineTo(v,w);break;case 7:for(;c.length>0&&(w+=c.shift(),l.lineTo(v,w),c.length!==0);)v+=c.shift(),l.lineTo(v,w);break;case 8:for(;c.length>0;)n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,v,w);break;case 10:xe=c.pop()+T,se=E[xe],se&&j(se);break;case 11:return;case 12:switch(Be=Q[ve],ve+=1,Be){case 35:n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),fe=i+c.shift(),be=a+c.shift(),ie=fe+c.shift(),te=be+c.shift(),ue=ie+c.shift(),Ae=te+c.shift(),v=ue+c.shift(),w=Ae+c.shift(),c.shift(),l.curveTo(n,o,i,a,fe,be),l.curveTo(ie,te,ue,Ae,v,w);break;case 34:n=v+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),fe=i+c.shift(),be=a,ie=fe+c.shift(),te=a,ue=ie+c.shift(),Ae=w,v=ue+c.shift(),l.curveTo(n,o,i,a,fe,be),l.curveTo(ie,te,ue,Ae,v,w);break;case 36:n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),fe=i+c.shift(),be=a,ie=fe+c.shift(),te=a,ue=ie+c.shift(),Ae=te+c.shift(),v=ue+c.shift(),l.curveTo(n,o,i,a,fe,be),l.curveTo(ie,te,ue,Ae,v,w);break;case 37:n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),fe=i+c.shift(),be=a+c.shift(),ie=fe+c.shift(),te=be+c.shift(),ue=ie+c.shift(),Ae=te+c.shift(),Math.abs(ue-v)>Math.abs(Ae-w)?v=ue+c.shift():w=Ae+c.shift(),l.curveTo(n,o,i,a,fe,be),l.curveTo(ie,te,ue,Ae,v,w);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+Be),c.length=0}break;case 14:c.length>0&&!d&&(Y=c.shift()+P,d=!0),g&&(l.closePath(),g=!1);break;case 18:K();break;case 19:case 20:K(),ve+=h+7>>3;break;case 21:c.length>2&&!d&&(Y=c.shift()+P,d=!0),w+=c.pop(),v+=c.pop(),H(v,w);break;case 22:c.length>1&&!d&&(Y=c.shift()+P,d=!0),v+=c.pop(),H(v,w);break;case 23:K();break;case 24:for(;c.length>2;)n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,v,w);v+=c.shift(),w+=c.shift(),l.lineTo(v,w);break;case 25:for(;c.length>6;)v+=c.shift(),w+=c.shift(),l.lineTo(v,w);n=v+c.shift(),o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+c.shift(),l.curveTo(n,o,i,a,v,w);break;case 26:for(c.length%2&&(v+=c.shift());c.length>0;)n=v,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i,w=a+c.shift(),l.curveTo(n,o,i,a,v,w);break;case 27:for(c.length%2&&(w+=c.shift());c.length>0;)n=v+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a,l.curveTo(n,o,i,a,v,w);break;case 28:oe=Q[ve],de=Q[ve+1],c.push((oe<<24|de<<16)>>16),ve+=2;break;case 29:xe=c.pop()+t.gsubrsBias,se=t.gsubrs[xe],se&&j(se);break;case 30:for(;c.length>0&&(n=v,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,w),c.length!==0);)n=v+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),w=a+c.shift(),v=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,w);break;case 31:for(;c.length>0&&(n=v+c.shift(),o=w,i=n+c.shift(),a=o+c.shift(),w=a+c.shift(),v=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,w),c.length!==0);)n=v,o=w+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),w=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,w);break;default:Be<32?console.log("Glyph "+e.index+": unknown operator "+Be):Be<247?c.push(Be-139):Be<251?(oe=Q[ve],ve+=1,c.push((Be-247)*256+oe+108)):Be<255?(oe=Q[ve],ve+=1,c.push(-(Be-251)*256-oe-108)):(oe=Q[ve],de=Q[ve+1],we=Q[ve+2],Te=Q[ve+3],ve+=4,c.push((oe<<24|de<<16|we<<8|Te)/65536))}}}return j(r),e.advanceWidth=Y,l}function qp(t,e,r,n){var o=[],i,a=new ae.Parser(t,e),l=a.parseCard8();if(l===0)for(var c=0;c<r;c++){if(i=a.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(l===3){var h=a.parseCard16(),d=a.parseCard16();if(d!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+d);for(var g,v=0;v<h;v++){if(i=a.parseCard8(),g=a.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(g>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+g);for(;d<g;d++)o.push(i);d=g}if(g!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+g)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return o}function Kp(t,e,r,n){r.tables.cff={};var o=Xp(t,e),i=sr(t,o.endOffset,ae.bytesToString),a=sr(t,i.endOffset),l=sr(t,a.endOffset,ae.bytesToString),c=sr(t,l.endOffset);r.gsubrs=c.objects,r.gsubrsBias=fs(r.gsubrs);var h=Ra(t,e,a.objects,l.objects);if(h.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var d=h[0];if(r.tables.cff.topDict=d,d._privateDict&&(r.defaultWidthX=d._privateDict.defaultWidthX,r.nominalWidthX=d._privateDict.nominalWidthX),d.ros[0]!==void 0&&d.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var g=d.fdArray,v=d.fdSelect;if(g===0||v===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");g+=e;var w=sr(t,g),E=Ra(t,e,w.objects,l.objects);d._fdArray=E,v+=e,d._fdSelect=qp(t,v,r.numGlyphs,E.length)}var T=e+d.private[1],C=nl(t,T,d.private[0],l.objects);if(r.defaultWidthX=C.defaultWidthX,r.nominalWidthX=C.nominalWidthX,C.subrs!==0){var P=T+C.subrs,M=sr(t,P);r.subrs=M.objects,r.subrsBias=fs(r.subrs)}else r.subrs=[],r.subrsBias=0;var O;n.lowMemory?(O=Hp(t,e+d.charStrings),r.nGlyphs=O.offsets.length):(O=sr(t,e+d.charStrings),r.nGlyphs=O.objects.length);var Y=jp(t,e+d.charset,r.nGlyphs,l.objects);if(d.encoding===0?r.cffEncoding=new Jo(Bp,Y):d.encoding===1?r.cffEncoding=new Jo(Fp,Y):r.cffEncoding=Zp(t,e+d.encoding,Y),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Ut.GlyphSet(r),n.lowMemory)r._push=function(j){var Q=Vp(j,O.offsets,t,e+d.charStrings);r.glyphs.push(j,Ut.cffGlyphLoader(r,j,Oa,Q))};else for(var H=0;H<r.nGlyphs;H+=1){var K=O.objects[H];r.glyphs.push(H,Ut.cffGlyphLoader(r,H,Oa,K))}}function ol(t,e){var r,n=Bo.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Bo.length:(r=Bo.length+e.length,e.push(t)),r}function Qp(){return new $.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Jp(t){var e=new $.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function il(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],a=e[i.name];a!==void 0&&!Qu(a,i.value)&&(i.type==="SID"&&(a=ol(a,r)),n[i.op]={name:i.name,type:i.type,value:a})}return n}function Da(t,e){var r=new $.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=il(tl,t,e),r}function Ma(t){var e=new $.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function ed(t){var e=new $.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function td(){return new $.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function rd(t,e){for(var r=new $.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=ol(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function nd(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var a=void 0,l=void 0,c=r.commands[i];if(c.type==="Q"){var h=.3333333333333333,d=2/3;c={type:"C",x:c.x,y:c.y,x1:Math.round(h*n+d*c.x1),y1:Math.round(h*o+d*c.y1),x2:Math.round(h*c.x+d*c.x1),y2:Math.round(h*c.y+d*c.y1)}}if(c.type==="M")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="L")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="C"){var g=Math.round(c.x1-n),v=Math.round(c.y1-o),w=Math.round(c.x2-c.x1),E=Math.round(c.y2-c.y1);a=Math.round(c.x-c.x2),l=Math.round(c.y-c.y2),e.push({name:"dx1",type:"NUMBER",value:g}),e.push({name:"dy1",type:"NUMBER",value:v}),e.push({name:"dx2",type:"NUMBER",value:w}),e.push({name:"dy2",type:"NUMBER",value:E}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),o=Math.round(c.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function od(t){for(var e=new $.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=nd(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function id(t,e){var r=new $.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=il(rl,t,e),r}function sd(t,e){for(var r=new $.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},a=[],l,c=1;c<t.length;c+=1)l=t.get(c),a.push(l.name);var h=[];r.header=Qp(),r.nameIndex=Jp([e.postScriptName]);var d=Da(o,h);r.topDictIndex=Ma(d),r.globalSubrIndex=td(),r.charsets=rd(a,h),r.charStringsIndex=od(t),r.privateDict=id(i,h),r.stringIndex=ed(h);var g=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=g,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),d=Da(o,h),r.topDictIndex=Ma(d),r}var ad={parse:Kp,make:sd};function ud(t,e){var r={},n=new ae.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),ne.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function ld(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new $.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var cd={parse:ud,make:ld};function fd(t,e){var r={},n=new ae.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function hd(t){return new $.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var pd={parse:fd,make:hd};function dd(t,e,r,n,o){for(var i,a,l=new ae.Parser(t,e),c=0;c<n;c+=1){c<r&&(i=l.parseUShort(),a=l.parseShort());var h=o.get(c);h.advanceWidth=i,h.leftSideBearing=a}}function vd(t,e,r,n,o){t._hmtxTableData={};for(var i,a,l=new ae.Parser(e,r),c=0;c<o;c+=1)c<n&&(i=l.parseUShort(),a=l.parseShort()),t._hmtxTableData[c]={advanceWidth:i,leftSideBearing:a}}function gd(t,e,r,n,o,i,a){a.lowMemory?vd(t,e,r,n,o):dd(e,r,n,o,i)}function md(t){for(var e=new $.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var yd={parse:gd,make:md};function wd(t){for(var e=new $.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function _d(t,e){var r=new ae.Parser(t,e),n=r.parseULong();ne.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],a=0;a<o;a++){for(var l="",c=e+r.parseUShort(),h=r.parseUShort(),d=c;d<c+h;++d)l+=String.fromCharCode(t.getInt8(d));i.push(l)}return i}var bd={make:wd,parse:_d};function Sd(t,e){var r={},n=new ae.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function Ed(t){return new $.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Td={parse:Sd,make:Ed},sl=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],al={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},xd={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},ul={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Cd(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return al[e];case 3:return ul[e]}}var hs="utf-16",Pd={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Ad={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function ll(t,e,r){switch(t){case 0:return hs;case 1:return Ad[r]||Pd[e];case 3:if(e===1||e===10)return hs;break}}function kd(t,e,r){for(var n={},o=new ae.Parser(t,e),i=o.parseUShort(),a=o.parseUShort(),l=o.offset+o.parseUShort(),c=0;c<a;c++){var h=o.parseUShort(),d=o.parseUShort(),g=o.parseUShort(),v=o.parseUShort(),w=sl[v]||v,E=o.parseUShort(),T=o.parseUShort(),C=Cd(h,g,r),P=ll(h,d,g);if(P!==void 0&&C!==void 0){var M=void 0;if(P===hs?M=Kr.UTF16(t,l+T,E):M=Kr.MACSTRING(t,l+T,E,P),M){var O=n[w];O===void 0&&(O=n[w]={}),O[C]=M}}}return i===1&&o.parseUShort(),n}function $i(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function Ba(t,e,r,n,o,i){return new $.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function Rd(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function Fa(t,e){var r=Rd(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function Od(t,e){var r,n=[],o={},i=$i(sl);for(var a in t){var l=i[a];if(l===void 0&&(l=a),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');o[r]=t[a],n.push(r)}for(var c=$i(al),h=$i(ul),d=[],g=[],v=0;v<n.length;v++){r=n[v];var w=o[r];for(var E in w){var T=w[E],C=1,P=c[E],M=xd[P],O=ll(C,M,P),Y=W.MACSTRING(T,O);Y===void 0&&(C=0,P=e.indexOf(E),P<0&&(P=e.length,e.push(E)),M=4,Y=W.UTF16(T));var H=Fa(Y,g);d.push(Ba(C,M,P,r,Y.length,H));var K=h[E];if(K!==void 0){var j=W.UTF16(T),Q=Fa(j,g);d.push(Ba(3,1,K,r,j.length,Q))}}}d.sort(function(we,Te){return we.platformID-Te.platformID||we.encodingID-Te.encodingID||we.languageID-Te.languageID||we.nameID-Te.nameID});for(var oe=new $.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:d.length},{name:"stringOffset",type:"USHORT",value:6+d.length*12}]),de=0;de<d.length;de++)oe.fields.push({name:"record_"+de,type:"RECORD",value:d[de]});return oe.fields.push({name:"strings",type:"LITERAL",value:g}),oe}var Dd={parse:kd,make:Od},ps=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Md(t){for(var e=0;e<ps.length;e+=1){var r=ps[e];if(t>=r.begin&&t<r.end)return e}return-1}function Bd(t,e){var r={},n=new ae.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function Fd(t){return new $.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var La={parse:Bd,make:Fd,unicodeRanges:ps,getUnicodeRange:Md};function Ld(t,e){var r={},n=new ae.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=ka.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=ka.length){var a=n.parseChar();r.names.push(n.parseString(a))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function Ud(){return new $.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Id={parse:Ld,make:Ud},xt=new Array(9);xt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(A.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(A.coverage),substitute:this.parseOffset16List()};ne.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};xt[2]=function(){var e=this.parseUShort();return ne.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),sequences:this.parseListOfLists()}};xt[3]=function(){var e=this.parseUShort();return ne.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),alternateSets:this.parseListOfLists()}};xt[4]=function(){var e=this.parseUShort();return ne.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Xr={sequenceIndex:A.uShort,lookupListIndex:A.uShort};xt[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(A.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Xr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(A.coverage),classDef:this.parsePointer(A.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Xr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,A.pointer(A.coverage)),lookupRecords:this.parseRecordList(o,Xr)}}ne.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};xt[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(A.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Xr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(A.coverage),backtrackClassDef:this.parsePointer(A.classDef),inputClassDef:this.parsePointer(A.classDef),lookaheadClassDef:this.parsePointer(A.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Xr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(A.pointer(A.coverage)),inputCoverage:this.parseList(A.pointer(A.coverage)),lookaheadCoverage:this.parseList(A.pointer(A.coverage)),lookupRecords:this.parseRecordList(Xr)};ne.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};xt[7]=function(){var e=this.parseUShort();ne.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new A(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:xt[r].call(n)}};xt[8]=function(){var e=this.parseUShort();return ne.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(A.coverage),backtrackCoverage:this.parseList(A.pointer(A.coverage)),lookaheadCoverage:this.parseList(A.pointer(A.coverage)),substitutes:this.parseUShortList()}};function Gd(t,e){e=e||0;var r=new A(t,e),n=r.parseVersion(1);return ne.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(xt)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(xt),variations:r.parseFeatureVariationsList()}}var en=new Array(9);en[1]=function(e){return e.substFormat===1?new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.ushortList("substitute",e.substitute)))};en[2]=function(e){return ne.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("seqSet",e.sequences,function(r){return new $.Table("sequenceSetTable",$.ushortList("sequence",r))})))};en[3]=function(e){return ne.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("altSet",e.alternateSets,function(r){return new $.Table("alternateSetTable",$.ushortList("alternate",r))})))};en[4]=function(e){return ne.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new $.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("ligSet",e.ligatureSets,function(r){return new $.Table("ligatureSetTable",$.tableList("ligature",r,function(n){return new $.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat($.ushortList("component",n.components,n.components.length+1)))}))})))};en[6]=function(e){if(e.substFormat===1){var r=new $.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new $.Coverage(e.coverage)}].concat($.tableList("chainRuleSet",e.chainRuleSets,function(i){return new $.Table("chainRuleSetTable",$.tableList("chainRule",i,function(a){var l=$.ushortList("backtrackGlyph",a.backtrack,a.backtrack.length).concat($.ushortList("inputGlyph",a.input,a.input.length+1)).concat($.ushortList("lookaheadGlyph",a.lookahead,a.lookahead.length)).concat($.ushortList("substitution",[],a.lookupRecords.length));return a.lookupRecords.forEach(function(c,h){l=l.concat({name:"sequenceIndex"+h,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+h,type:"USHORT",value:c.lookupListIndex})}),new $.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)ne.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,a){n.push({name:"backtrackCoverage"+a,type:"TABLE",value:new $.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,a){n.push({name:"inputCoverage"+a,type:"TABLE",value:new $.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,a){n.push({name:"lookaheadCoverage"+a,type:"TABLE",value:new $.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,a){n=n.concat({name:"sequenceIndex"+a,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+a,type:"USHORT",value:i.lookupListIndex})});var o=new $.Table("chainContextTable",n);return o}ne.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Nd(t){return new $.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new $.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new $.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new $.LookupList(t.lookups,en)}])}var Hd={parse:Gd,make:Nd};function Vd(t,e){var r=new ae.Parser(t,e),n=r.parseULong();ne.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},a=0;a<o;a++){var l=r.parseTag(),c=r.parseULong(),h=r.parseULong(),d=Kr.UTF8(t,e+c,h);i[l]=d}return i}function Wd(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new $.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var a=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+a}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var zd={parse:Vd,make:Wd};function Ua(t){return Math.log(t)/Math.log(2)|0}function As(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function Ia(t,e,r,n){return new $.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function cl(t){var e=new $.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,Ua(e.numTables));e.searchRange=16*r,e.entrySelector=Ua(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+Ia().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<t.length;a+=1){var l=t[a];ne.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var c=l.sizeOf(),h=Ia(l.tableName,As(l.encode()),i,c);for(n.push({name:h.tag+" Table Record",type:"RECORD",value:h}),o.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=c,ne.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(d,g){return d.value.tag>g.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function Ga(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function $d(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function Xd(t){for(var e=[],r=[],n=[],o=[],i=[],a=[],l=[],c,h=0,d=0,g=0,v=0,w=0,E=0;E<t.glyphs.length;E+=1){var T=t.glyphs.get(E),C=T.unicode|0;if(isNaN(T.advanceWidth))throw new Error("Glyph "+T.name+" ("+E+"): advanceWidth is not a number.");(c>C||c===void 0)&&C>0&&(c=C),h<C&&(h=C);var P=La.getUnicodeRange(C);if(P<32)d|=1<<P;else if(P<64)g|=1<<P-32;else if(P<96)v|=1<<P-64;else if(P<123)w|=1<<P-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(T.name!==".notdef"){var M=T.getMetrics();e.push(M.xMin),r.push(M.yMin),n.push(M.xMax),o.push(M.yMax),a.push(M.leftSideBearing),l.push(M.rightSideBearing),i.push(T.advanceWidth)}}var O={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:$d(i),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,l)};O.ascender=t.ascender,O.descender=t.descender;var Y=cd.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:O.xMin,yMin:O.yMin,xMax:O.xMax,yMax:O.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),H=pd.make({ascender:O.ascender,descender:O.descender,advanceWidthMax:O.advanceWidthMax,minLeftSideBearing:O.minLeftSideBearing,minRightSideBearing:O.minRightSideBearing,xMaxExtent:O.maxLeftSideBearing+(O.xMax-O.xMin),numberOfHMetrics:t.glyphs.length}),K=Td.make(t.glyphs.length),j=La.make(Object.assign({xAvgCharWidth:Math.round(O.advanceWidthAvg),usFirstCharIndex:c,usLastCharIndex:h,ulUnicodeRange1:d,ulUnicodeRange2:g,ulUnicodeRange3:v,ulUnicodeRange4:w,sTypoAscender:O.ascender,sTypoDescender:O.descender,sTypoLineGap:0,usWinAscent:O.yMax,usWinDescent:Math.abs(O.yMin),ulCodePageRange1:1,sxHeight:Ga(t,"xyvw",{yMax:Math.round(O.ascender/2)}).yMax,sCapHeight:Ga(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",O).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),Q=yd.make(t.glyphs),oe=Mp.make(t.glyphs),de=t.getEnglishName("fontFamily"),we=t.getEnglishName("fontSubfamily"),Te=de+" "+we,xe=t.getEnglishName("postScriptName");xe||(xe=de.replace(/\s/g,"")+"-"+we);var se={};for(var fe in t.names)se[fe]=t.names[fe];se.uniqueID||(se.uniqueID={en:t.getEnglishName("manufacturer")+":"+Te}),se.postScriptName||(se.postScriptName={en:xe}),se.preferredFamily||(se.preferredFamily=t.names.fontFamily),se.preferredSubfamily||(se.preferredSubfamily=t.names.fontSubfamily);var be=[],ie=Dd.make(se,be),te=be.length>0?bd.make(be):void 0,ue=Id.make(),Ae=ad.make(t.glyphs,{version:t.getEnglishName("version"),fullName:Te,familyName:de,weightName:we,postScriptName:xe,unitsPerEm:t.unitsPerEm,fontBBox:[0,O.yMin,O.ascender,O.advanceWidthMax]}),ve=t.metas&&Object.keys(t.metas).length>0?zd.make(t.metas):void 0,Be=[Y,H,K,j,ie,oe,ue,Ae,Q];te&&Be.push(te),t.tables.gsub&&Be.push(Hd.make(t.tables.gsub)),ve&&Be.push(ve);for(var Ot=cl(Be),Ke=Ot.encode(),je=As(Ke),rt=Ot.fields,Jt=!1,at=0;at<rt.length;at+=1)if(rt[at].name==="head table"){rt[at].value.checkSumAdjustment=2981146554-je,Jt=!0;break}if(!Jt)throw new Error("Could not find head table with checkSum to adjust.");return Ot}var Yd={make:cl,fontToTable:Xd,computeCheckSum:As};function Xi(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function Na(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function Ha(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var a=r.start;if(a===e)return r;a<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function In(t,e){this.font=t,this.tableName=e}In.prototype={searchTag:Xi,binSearch:Na,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=Xi(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=Xi(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,a=o.featureIndexes,l=this.font.tables[this.tableName].features,c=0;c<a.length;c++)if(i=l[a[c]],i.tag===r)return i.feature;if(n){var h=l.length;return ne.assert(h===0||r>=l[h-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(i),a.push(h),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),a=[];if(i){for(var l,c=i.lookupListIndexes,h=this.font.tables[this.tableName].lookups,d=0;d<c.length;d++)l=h[c[d]],l.lookupType===n&&a.push(l);if(a.length===0&&o){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var g=h.length;return h.push(l),c.push(g),[l]}}return a},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=Ha(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=Na(t.glyphs,e);return r>=0?r:-1;case 2:var n=Ha(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,a=o.end,l=i;l<=a;l++)e.push(l);return e}};function Gn(t){In.call(this,t,"gpos")}Gn.prototype=In.prototype;Gn.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)};Gn.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var a=o[i],l=this.getCoverageIndex(a.coverage,e);if(!(l<0))switch(a.posFormat){case 1:for(var c=a.pairSets[l],h=0;h<c.length;h++){var d=c[h];if(d.secondGlyph===r)return d.value1&&d.value1.xAdvance||0}break;case 2:var g=this.getGlyphClass(a.classDef1,e),v=this.getGlyphClass(a.classDef2,r),w=a.classRecords[g][v];return w.value1&&w.value1.xAdvance||0}}return 0};Gn.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function dt(t){In.call(this,t,"gsub")}function jd(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function ks(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}dt.prototype=In.prototype;dt.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};dt.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),d=void 0;if(c.substFormat===1){var g=c.deltaGlyphId;for(d=0;d<h.length;d++){var v=h[d];n.push({sub:v,by:v+g})}}else{var w=c.substitute;for(d=0;d<h.length;d++)n.push({sub:h[d],by:w[d]})}}return n};dt.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),d=void 0;for(d=0;d<h.length;d++){var g=h[d],v=c.sequences[d];n.push({sub:g,by:v})}}return n};dt.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),d=c.alternateSets,g=0;g<h.length;g++)n.push({sub:h[g],by:d[g]});return n};dt.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),d=c.ligatureSets,g=0;g<h.length;g++)for(var v=h[g],w=d[g],E=0;E<w.length;E++){var T=w[E];n.push({sub:[v].concat(T.components),by:T.ligGlyph})}return n};dt.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=ks(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});ne.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.substitute.splice(l,0,0)),i.substitute[l]=e.by};dt.prototype.addMultiple=function(t,e,r,n){ne.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=ks(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});ne.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.sequences.splice(l,0,0)),i.sequences[l]=e.by};dt.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=ks(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});ne.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by};dt.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),ne.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var a=e.sub[0],l=e.sub.slice(1),c={ligGlyph:e.by,components:l},h=this.binSearch(i.coverage.glyphs,a);if(h>=0){for(var d=i.ligatureSets[h],g=0;g<d.length;g++)if(jd(d[g].components,l))return;d.push(c)}else h=-1-h,i.coverage.glyphs.splice(h,0,a),i.ligatureSets.splice(h,0,[c])};dt.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}};dt.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function Zd(){return typeof window<"u"}function qd(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function dn(t,e){if(!t)throw e}function Va(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),e&o||(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function fl(t,e,r){var n=new ae.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var a=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)a.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var c=0;c<t.instructionLength;c+=1)t.instructions.push(n.parseByte());var h=a[a.length-1]+1;o=[];for(var d=0;d<h;d+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var g=n.parseByte(),v=0;v<g;v+=1)o.push(i),d+=1;if(ne.argument(o.length===h,"Bad flags."),a.length>0){var w=[],E;if(h>0){for(var T=0;T<h;T+=1)i=o[T],E={},E.onCurve=!!(i&1),E.lastPointOfContour=a.indexOf(T)>=0,w.push(E);for(var C=0,P=0;P<h;P+=1)i=o[P],E=w[P],E.x=Va(n,i,C,2,16),C=E.x;for(var M=0,O=0;O<h;O+=1)i=o[O],E=w[O],E.y=Va(n,i,M,4,32),M=E.y}t.points=w}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var Y=!0;Y;){o=n.parseUShort();var H={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(H.dx=n.parseShort(),H.dy=n.parseShort()):H.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(H.dx=n.parseChar(),H.dy=n.parseChar()):H.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?H.xScale=H.yScale=n.parseF2Dot14():(o&64)>0?(H.xScale=n.parseF2Dot14(),H.yScale=n.parseF2Dot14()):(o&128)>0&&(H.xScale=n.parseF2Dot14(),H.scale01=n.parseF2Dot14(),H.scale10=n.parseF2Dot14(),H.yScale=n.parseF2Dot14()),t.components.push(H),Y=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var K=0;K<t.instructionLength;K+=1)t.instructions.push(n.parseByte())}}}function Yi(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function Kd(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return ne.argument(r.length===0,"There are still points left in the current contour."),e}function hl(t){var e=new Ze;if(!t)return e;for(var r=Kd(t),n=0;n<r.length;++n){var o=r[n],i=null,a=o[o.length-1],l=o[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var c={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5};e.moveTo(c.x,c.y)}for(var h=0;h<o.length;++h)if(i=a,a=l,l=o[(h+1)%o.length],a.onCurve)e.lineTo(a.x,a.y);else{var d=l;i.onCurve||((a.x+i.x)*.5,(a.y+i.y)*.5),l.onCurve||(d={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5}),e.quadraticCurveTo(a.x,a.y,d.x,d.y)}e.closePath()}return e}function pl(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=Yi(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[n.matchedPoints[0]],l=o.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=Yi([l],c)[0],c.dx=a.x-l.x,c.dy=a.y-l.y,i=Yi(o.points,c)}e.points=e.points.concat(i)}}return hl(e.points)}function Qd(t,e,r,n){for(var o=new Ut.GlyphSet(n),i=0;i<r.length-1;i+=1){var a=r[i],l=r[i+1];a!==l?o.push(i,Ut.ttfGlyphLoader(n,i,fl,t,e+a,pl)):o.push(i,Ut.glyphLoader(n,i))}return o}function Jd(t,e,r,n){var o=new Ut.GlyphSet(n);return n._push=function(i){var a=r[i],l=r[i+1];a!==l?o.push(i,Ut.ttfGlyphLoader(n,i,fl,t,e+a,pl)):o.push(i,Ut.glyphLoader(n,i))},o}function ev(t,e,r,n,o){return o.lowMemory?Jd(t,e,r,n):Qd(t,e,r,n)}var tv={getPath:hl,parse:ev},dl,kr,vl,ds;function gl(t){this.font=t,this.getCommands=function(e){return tv.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function rv(t){return t}function ml(t){return Math.sign(t)*Math.round(Math.abs(t))}function nv(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function ov(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function iv(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function sv(t){return Math.sign(t)*Math.floor(Math.abs(t))}var yl=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},Lt={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,d;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,c=e.x-e.xo,h=r.x-r.xo,a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){t.x=t.xo+(c+h)/2;return}t.x=t.xo+(c*l+h*a)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){Lt.setRelative(t,t,(c+h)/2,n,!0);return}Lt.setRelative(t,t,(c*l+h*a)/d,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.x=l+(t.y-c)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},jt={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,d;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,c=e.y-e.yo,h=r.y-r.yo,a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){t.y=t.yo+(c+h)/2;return}t.y=t.yo+(c*l+h*a)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){jt.setRelative(t,t,(c+h)/2,n,!0);return}jt.setRelative(t,t,(c*l+h*a)/d,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.y=c+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(Lt);Object.freeze(jt);function Nn(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}Nn.prototype.distance=function(t,e,r,n){return this.x*Lt.distance(t,e,r,n)+this.y*jt.distance(t,e,r,n)};Nn.prototype.interpolate=function(t,e,r,n){var o,i,a,l,c,h,d;if(a=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),c=Math.abs(a),h=Math.abs(l),d=c+h,d===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*h+i*c)/d,n,!0)};Nn.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y,h=n.normalSlope,d=this.slope,g=t.x,v=t.y;t.x=(d*g-h*l+c-v)/(d-h),t.y=d*(t.x-g)+v};Nn.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function Hn(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?Lt:t===0&&e===1?jt:new Nn(t,e)}function qt(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}qt.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e};qt.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Rn=Object.freeze(new qt(0,0)),av={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function lr(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Lt,this.round=ml}}gl.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){lr.prototype=av,o=this._fpgmState=new lr("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,R.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{kr(o)}catch(h){console.log("Hinting error in FPGM:"+h),this._errorState=3;return}}lr.prototype=o,n=this._prepState=new lr("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var a=n.cvt=new Array(i.length),l=e/r.unitsPerEm,c=0;c<i.length;c++)a[c]=i[c]*l;else n.cvt=[];R.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{kr(n)}catch(h){this._errorState<2&&console.log("Hinting error in PREP:"+h),this._errorState=2}}if(!(this._errorState>1))try{return vl(t,n)}catch(h){this._errorState<1&&(console.log("Hinting error:"+h),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};vl=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,a,l;if(lr.prototype=e,!o)l=new lr("glyf",t.instructions),R.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),ds(t,l,r,n),a=l.gZone;else{var c=e.font;a=[],i=[];for(var h=0;h<o.length;h++){var d=o[h],g=c.glyphs.get(d.glyphIndex);l=new lr("glyf",g.instructions),R.DEBUG&&(console.log("---EXEC COMP "+h+"---"),l.step=-1),ds(g,l,r,n);for(var v=Math.round(d.dx*r),w=Math.round(d.dy*n),E=l.gZone,T=l.contours,C=0;C<E.length;C++){var P=E[C];P.xTouched=P.yTouched=!1,P.xo=P.x=P.x+v,P.yo=P.y=P.y+w}var M=a.length;a.push.apply(a,E);for(var O=0;O<T.length;O++)i.push(T[O]+M)}t.instructions&&!l.inhibitGridFit&&(l=new lr("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=a,l.contours=i,a.push(new qt(0,0),new qt(Math.round(t.advanceWidth*r),0)),R.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),kr(l),a.length-=2)}return a};ds=function(t,e,r,n){for(var o=t.points||[],i=o.length,a=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],c,h=0;h<i;h++)c=o[h],a[h]=new qt(c.x*r,c.y*n,c.lastPointOfContour,c.onCurve);for(var d,g,v=0;v<i;v++)c=a[v],d||(d=c,l.push(v)),c.lastPointOfContour?(c.nextPointOnContour=d,d.prevPointOnContour=c,d=void 0):(g=a[v+1],c.nextPointOnContour=g,g.prevPointOnContour=c);if(!e.inhibitGridFit){if(R.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var w=0;w<i;w++)console.log(w,a[w].x,a[w].y)}if(a.push(new qt(0,0),new qt(Math.round(t.advanceWidth*r),0)),kr(e),a.length-=2,R.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var E=0;E<i;E++)console.log(E,a[E].x,a[E].y)}}};kr=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(R.DEBUG&&t.step++,n=dl[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function ai(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new qt(0,0)}function wl(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function Wa(t,e){R.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function za(t,e){R.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function $a(t,e){R.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function Xa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log("SPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.pv=e.dpv=Hn(l,c)}function Ya(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log("SFVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.fv=Hn(l,c)}function uv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=Hn(n,r)}function lv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=Hn(n,r)}function cv(t){var e=t.stack,r=t.pv;R.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function fv(t){var e=t.stack,r=t.fv;R.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function hv(t){t.fv=t.pv,R.DEBUG&&console.log(t.step,"SFVTPV[]")}function pv(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),a=e.pop(),l=t.z0,c=t.z1,h=l[r],d=l[n],g=c[o],v=c[i],w=t.z2[a];R.DEBUG&&console.log("ISECT[], ",r,n,o,i,a);var E=h.x,T=h.y,C=d.x,P=d.y,M=g.x,O=g.y,Y=v.x,H=v.y,K=(E-C)*(O-H)-(T-P)*(M-Y),j=E*P-T*C,Q=M*H-O*Y;w.x=(j*(M-Y)-Q*(E-C))/K,w.y=(j*(O-H)-Q*(T-P))/K}function dv(t){t.rp0=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function vv(t){t.rp1=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function gv(t){t.rp2=t.stack.pop(),R.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function mv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||ai(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function yv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||ai(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function wv(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||ai(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function _v(t){var e=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||ai(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function bv(t){t.loop=t.stack.pop(),R.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Sv(t){R.DEBUG&&console.log(t.step,"RTG[]"),t.round=ml}function Ev(t){R.DEBUG&&console.log(t.step,"RTHG[]"),t.round=ov}function Tv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function xv(t){R.DEBUG&&console.log(t.step,"ELSE[]"),wl(t,!1)}function Cv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Pv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function Av(t){var e=t.stack;R.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function ji(t){R.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function kv(t){R.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function Rv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function Ov(t){var e=t.stack;R.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function Dv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var a=0;a<n;a++)kr(t),R.DEBUG&&console.log(++t.step,a+1<n?"next loopcall":"done loopcall",a);t.ip=o,t.prog=i}function Mv(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],kr(t),t.ip=r,t.prog=n,R.DEBUG&&console.log(++t.step,"returning from",e)}function Bv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function Fv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function Lv(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(R.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function ja(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;R.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var a=i.distance(n,Rn);t&&(a=e.round(a)),o.setRelative(n,Rn,a,i),o.touch(n),e.rp0=e.rp1=r}function Za(t,e){var r=e.z2,n=r.length-2,o,i,a;R.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)o=r[l],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(a=o.nextTouched(t),i===a&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,a,t)))}function qa(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=e.loop,c=e.z2;l--;){var h=r.pop(),d=c[h],g=a.distance(o,o,!1,!0);i.setRelative(d,d,g,a),i.touch(d),R.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",h)}e.loop=1}function Ka(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop(),c=e.z2[e.contours[l]],h=c;R.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var d=a.distance(o,o,!1,!0);do h!==o&&i.setRelative(h,h,d,a),h=h.nextPointOnContour;while(h!==c)}function Qa(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop();R.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var c;switch(l){case 0:c=e.tZone;break;case 1:c=e.gZone;break;default:throw new Error("Invalid zone")}for(var h,d=a.distance(o,o,!1,!0),g=c.length-2,v=0;v<g;v++)h=c[v],i.setRelative(h,h,d,a)}function Uv(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var a=e.pop(),l=i[a];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",a,o),n.setRelative(l,l,o),n.touch(l)}t.loop=1}function Iv(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],a=t.z1[n],l=t.fv,c=t.dpv,h=t.z2;o--;){var d=e.pop(),g=h[d];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",d,r,"<->",n),l.interpolate(g,i,a,c),l.touch(g)}t.loop=1}function Ja(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],a=e.z0[e.rp0],l=e.fv,c=e.pv;l.setRelative(i,a,n,c),l.touch(i),R.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function Gv(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,a=t.pv,l=t.z1;o--;){var c=e.pop(),h=l[c];R.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",c),i.setRelative(h,n,0,a),i.touch(h)}t.loop=1}function Nv(t){R.DEBUG&&console.log(t.step,"RTDG[]"),t.round=nv}function eu(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],a=e.fv,l=e.pv,c=e.cvt[n];R.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",c,")",o);var h=l.distance(i,Rn);t&&(Math.abs(h-c)<e.cvCutIn&&(h=c),h=e.round(h)),a.setRelative(i,Rn,h,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),a.touch(i),e.rp0=e.rp1=o}function Hv(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];R.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function Vv(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];R.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var a=r[++e]<<8|r[++e];a&32768&&(a=-((a^65535)+1)),n.push(a)}t.ip=e}function Wv(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();R.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function zv(t){var e=t.stack,r=t.store,n=e.pop();R.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function $v(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function Xv(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function tu(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];R.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,Rn,t,!1)*64)}function ru(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],a=e.z0[o],l=e.dpv.distance(a,i,t,t);R.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",l),e.stack.push(Math.round(l*64))}function Yv(t){R.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function jv(t){R.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function Zv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function qv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function Kv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function Qv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function Jv(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function eg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function tg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function rg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function ng(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"IF[]",e),e||(wl(t,!0),R.DEBUG&&console.log(t.step,"EIF[]"))}function og(t){R.DEBUG&&console.log(t.step,"EIF[]")}function ig(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function sg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function ag(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function Zi(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,a=e.ppem,l=e.deltaBase+(t-1)*16,c=e.deltaShift,h=e.z0;R.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var d=0;d<n;d++){var g=r.pop(),v=r.pop(),w=l+((v&240)>>4);if(w===a){var E=(v&15)-8;E>=0&&E++,R.DEBUG&&console.log(e.step,"DELTAPFIX",g,"by",E*c);var T=h[g];o.setRelative(T,T,E*c,i)}}}function ug(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function lg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function cg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function fg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function hg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function pg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function dg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function vg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function gg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function mg(t){var e=t.stack,r=e.pop();R.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Ao(t,e){var r=e.stack,n=r.pop();R.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function yg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function qi(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,a=e.deltaShift;R.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var c=r.pop(),h=r.pop(),d=i+((h&240)>>4);if(d===o){var g=(h&15)-8;g>=0&&g++;var v=g*a;R.DEBUG&&console.log(e.step,"DELTACFIX",c,"by",v),e.cvt[c]+=v}}}function wg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=yl;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function _g(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=yl;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function bg(t){R.DEBUG&&console.log(t.step,"ROFF[]"),t.round=rv}function Sg(t){R.DEBUG&&console.log(t.step,"RUTG[]"),t.round=iv}function Eg(t){R.DEBUG&&console.log(t.step,"RDTG[]"),t.round=sv}function Tg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function nu(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];R.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.dpv=Hn(l,c)}function xg(t){var e=t.stack,r=e.pop(),n=0;R.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Cg(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();R.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function Pg(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function Ag(t){var e=t.stack,r=e.pop(),n=e.pop();R.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function kg(t){var e=t.stack.pop();R.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function Rg(t){var e=t.stack.pop(),r=t.stack.pop();switch(R.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function or(t,e){var r=e.stack,n=e.prog,o=e.ip;R.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function ir(t,e){var r=e.ip,n=e.prog,o=e.stack;R.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var a=n[++r]<<8|n[++r];a&32768&&(a=-((a^65535)+1)),o.push(a)}e.ip=r}function z(t,e,r,n,o,i){var a=i.stack,l=t&&a.pop(),c=a.pop(),h=i.rp0,d=i.z0[h],g=i.z1[c],v=i.minDis,w=i.fv,E=i.dpv,T,C,P,M;C=T=E.distance(g,d,!0,!0),P=C>=0?1:-1,C=Math.abs(C),t&&(M=i.cvt[l],n&&Math.abs(C-M)<i.cvCutIn&&(C=M)),r&&C<v&&(C=v),n&&(C=i.round(C)),w.setRelative(g,d,P*C,E),w.touch(g),R.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?l+"("+i.cvt[l]+","+M+")":"",c,"(d =",T,"->",P*C,")"),i.rp1=i.rp0,i.rp2=c,e&&(i.rp0=c)}dl=[Wa.bind(void 0,jt),Wa.bind(void 0,Lt),za.bind(void 0,jt),za.bind(void 0,Lt),$a.bind(void 0,jt),$a.bind(void 0,Lt),Xa.bind(void 0,0),Xa.bind(void 0,1),Ya.bind(void 0,0),Ya.bind(void 0,1),uv,lv,cv,fv,hv,pv,dv,vv,gv,mv,yv,wv,_v,bv,Sv,Ev,Tv,xv,Cv,Pv,void 0,void 0,Av,ji,kv,Rv,Ov,Bv,Fv,void 0,void 0,void 0,Dv,Mv,Lv,void 0,ja.bind(void 0,0),ja.bind(void 0,1),Za.bind(void 0,jt),Za.bind(void 0,Lt),qa.bind(void 0,0),qa.bind(void 0,1),Ka.bind(void 0,0),Ka.bind(void 0,1),Qa.bind(void 0,0),Qa.bind(void 0,1),Uv,Iv,Ja.bind(void 0,0),Ja.bind(void 0,1),Gv,Nv,eu.bind(void 0,0),eu.bind(void 0,1),Hv,Vv,Wv,zv,$v,Xv,tu.bind(void 0,0),tu.bind(void 0,1),void 0,ru.bind(void 0,0),ru.bind(void 0,1),Yv,void 0,jv,void 0,void 0,Zv,qv,Kv,Qv,Jv,eg,tg,rg,ng,og,ig,sg,ag,Zi.bind(void 0,1),ug,lg,cg,fg,hg,pg,dg,vg,gg,mg,Ao.bind(void 0,0),Ao.bind(void 0,1),Ao.bind(void 0,2),Ao.bind(void 0,3),void 0,void 0,void 0,void 0,yg,Zi.bind(void 0,2),Zi.bind(void 0,3),qi.bind(void 0,1),qi.bind(void 0,2),qi.bind(void 0,3),wg,_g,void 0,void 0,bg,void 0,Sg,Eg,ji,ji,void 0,void 0,void 0,void 0,void 0,Tg,nu.bind(void 0,0),nu.bind(void 0,1),xg,void 0,Cg,Pg,Ag,kg,Rg,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,or.bind(void 0,1),or.bind(void 0,2),or.bind(void 0,3),or.bind(void 0,4),or.bind(void 0,5),or.bind(void 0,6),or.bind(void 0,7),or.bind(void 0,8),ir.bind(void 0,1),ir.bind(void 0,2),ir.bind(void 0,3),ir.bind(void 0,4),ir.bind(void 0,5),ir.bind(void 0,6),ir.bind(void 0,7),ir.bind(void 0,8),z.bind(void 0,0,0,0,0,0),z.bind(void 0,0,0,0,0,1),z.bind(void 0,0,0,0,0,2),z.bind(void 0,0,0,0,0,3),z.bind(void 0,0,0,0,1,0),z.bind(void 0,0,0,0,1,1),z.bind(void 0,0,0,0,1,2),z.bind(void 0,0,0,0,1,3),z.bind(void 0,0,0,1,0,0),z.bind(void 0,0,0,1,0,1),z.bind(void 0,0,0,1,0,2),z.bind(void 0,0,0,1,0,3),z.bind(void 0,0,0,1,1,0),z.bind(void 0,0,0,1,1,1),z.bind(void 0,0,0,1,1,2),z.bind(void 0,0,0,1,1,3),z.bind(void 0,0,1,0,0,0),z.bind(void 0,0,1,0,0,1),z.bind(void 0,0,1,0,0,2),z.bind(void 0,0,1,0,0,3),z.bind(void 0,0,1,0,1,0),z.bind(void 0,0,1,0,1,1),z.bind(void 0,0,1,0,1,2),z.bind(void 0,0,1,0,1,3),z.bind(void 0,0,1,1,0,0),z.bind(void 0,0,1,1,0,1),z.bind(void 0,0,1,1,0,2),z.bind(void 0,0,1,1,0,3),z.bind(void 0,0,1,1,1,0),z.bind(void 0,0,1,1,1,1),z.bind(void 0,0,1,1,1,2),z.bind(void 0,0,1,1,1,3),z.bind(void 0,1,0,0,0,0),z.bind(void 0,1,0,0,0,1),z.bind(void 0,1,0,0,0,2),z.bind(void 0,1,0,0,0,3),z.bind(void 0,1,0,0,1,0),z.bind(void 0,1,0,0,1,1),z.bind(void 0,1,0,0,1,2),z.bind(void 0,1,0,0,1,3),z.bind(void 0,1,0,1,0,0),z.bind(void 0,1,0,1,0,1),z.bind(void 0,1,0,1,0,2),z.bind(void 0,1,0,1,0,3),z.bind(void 0,1,0,1,1,0),z.bind(void 0,1,0,1,1,1),z.bind(void 0,1,0,1,1,2),z.bind(void 0,1,0,1,1,3),z.bind(void 0,1,1,0,0,0),z.bind(void 0,1,1,0,0,1),z.bind(void 0,1,1,0,0,2),z.bind(void 0,1,1,0,0,3),z.bind(void 0,1,1,0,1,0),z.bind(void 0,1,1,0,1,1),z.bind(void 0,1,1,0,1,2),z.bind(void 0,1,1,0,1,3),z.bind(void 0,1,1,1,0,0),z.bind(void 0,1,1,1,0,1),z.bind(void 0,1,1,1,0,2),z.bind(void 0,1,1,1,0,3),z.bind(void 0,1,1,1,1,0),z.bind(void 0,1,1,1,1,1),z.bind(void 0,1,1,1,1,2),z.bind(void 0,1,1,1,1,3)];function tn(t){this.char=t,this.state={},this.activeState=null}function Rs(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function Og(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function Ct(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function ui(t){this.eventId=t,this.subscribers=[]}function Dg(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new ui(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Ve(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Dg.call(this,t)}tn.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState};tn.prototype.getState=function(t){return this.state[t]||null};Ve.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length};Ve.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])};Ve.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(a){return a instanceof tn});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Ve.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof tn){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}};Ve.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n};Ve.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}};Ve.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof tn});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}};Ve.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],a=e===null||e.apply(this,i)===!0,l=[n,o];if(a){var c=r.apply(this,l);n.setState(t,c)}}),this.registeredModifiers.push(t)};ui.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};ui.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)};Ct.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)};Ct.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}};Ve.prototype.rangeToText=function(t){if(t instanceof Rs)return this.getRangeTokens(t).map(function(e){return e.char}).join("")};Ve.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")};Ve.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null};Ve.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null};Ve.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof ui&&n.subscribers.forEach(function(o){o.apply(r,e||[])})};Ve.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new Og(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n};Ve.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))};Ve.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}};Ve.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}};Ve.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new Ct(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Ve.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new Rs(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n};Ve.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new Rs(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),i&&n.checkEnd(t)){var a=r-i.startIndex+1,l=e.setEndOffset(a,o);e.dispatch("contextEnd",[o,l])}})};Ve.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new Ct(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new tn(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function fr(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function _l(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function pr(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Fo(t){return/[A-z]/.test(t)}function Mg(t){return/\s/.test(t)}function vt(t){this.font=t,this.features={}}function Er(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function Vn(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function Bg(t,e){var r=Vn(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function Fg(t,e){var r=Vn(t,e.coverage);return r===-1?null:e.substitute[r]}function Ki(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var a=Vn(i,o);a!==-1&&r.push(a)}return r.length!==t.length?-1:r}function Lg(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=Ki(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&pr(i[0].char);)i.shift();var a=new Ct(i,0),l=Ki(e.lookaheadCoverage,a),c=[].concat(t.backtrack);for(c.reverse();c.length&&pr(c[0].char);)c.shift();if(c.length<e.backtrackCoverage.length)return[];var h=new Ct(c,0),d=Ki(e.backtrackCoverage,h),g=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&d.length===e.backtrackCoverage.length,v=[];if(g)for(var w=0;w<e.lookupRecords.length;w++)for(var E=e.lookupRecords[w],T=E.lookupListIndex,C=this.getLookupByIndex(T),P=0;P<C.subtables.length;P++){var M=C.subtables[P],O=this.getLookupMethod(C,M),Y=this.getSubstitutionType(C,M);if(Y==="12")for(var H=0;H<n.length;H++){var K=t.get(H),j=O(K);j&&v.push(j)}}return v}function Ug(t,e){var r=t.current,n=Vn(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],a=0;a<i.length;a++){o=i[a];for(var l=0;l<o.components.length;l++){var c=t.lookahead[l],h=o.components[l];if(c!==h)break;if(l===o.components.length-1)return o}}return null}function Ig(t,e){var r=Vn(t,e.coverage);return r===-1?null:e.sequences[r]}vt.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]};vt.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var a=0;a<i.length;a++){var l=i[a];if(l.tag===t){var c=l.langSys;return c.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};vt.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r};vt.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e};vt.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n};vt.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return Bg.apply(r,[o,e])};case"12":return function(o){return Fg.apply(r,[o,e])};case"63":return function(o){return Lg.apply(r,[o,e])};case"41":return function(o){return Ug.apply(r,[o,e])};case"21":return function(o){return Ig.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}};vt.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),a=0;a<o.length;a++)for(var l=o[a],c=this.getLookupSubtables(l),h=0;h<c.length;h++){var d=c[h],g=this.getSubstitutionType(l,d),v=this.getLookupMethod(l,d),w=void 0;switch(g){case"11":w=v(e.current),w&&i.splice(r,1,new Er({id:11,tag:t.tag,substitution:w}));break;case"12":w=v(e.current),w&&i.splice(r,1,new Er({id:12,tag:t.tag,substitution:w}));break;case"63":w=v(e),Array.isArray(w)&&w.length&&i.splice(r,1,new Er({id:63,tag:t.tag,substitution:w}));break;case"41":w=v(e),w&&i.splice(r,1,new Er({id:41,tag:t.tag,substitution:w}));break;case"21":w=v(e.current),w&&i.splice(r,1,new Er({id:21,tag:t.tag,substitution:w}));break}e=new Ct(i,r),!(Array.isArray(w)&&!w.length)&&(w=null)}return i.length?i:null};vt.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r};vt.prototype.getLookupSubtables=function(t){return t.subtables||null};vt.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null};vt.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))};vt.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function Gg(t){var e=t.current,r=t.get(-1);return r===null&&fr(e)||!fr(r)&&fr(e)}function Ng(t){var e=t.get(1);return e===null||!fr(e)}var Hg={startCheck:Gg,endCheck:Ng};function Vg(t){var e=t.current,r=t.get(-1);return(fr(e)||pr(e))&&!fr(r)}function Wg(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!fr(e)&&!pr(e)):var r=Mg(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return fr(o)||pr(o)}),!n)return!0}break;default:return!1}}var zg={startCheck:Vg,endCheck:Wg};function $g(t,e,r){e[r].setState(t.tag,t.substitution)}function Xg(t,e,r){e[r].setState(t.tag,t.substitution)}function Yg(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function jg(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var ou={11:$g,12:Xg,63:Yg,41:jg};function Os(t,e,r){t instanceof Er&&ou[t.id]&&ou[t.id](t,e,r)}function Zg(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=_l(n),i=pr(n);if(!o&&!i)return!0;if(o)return!1}return!1}function qg(t){if(_l(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=pr(r);if(!n)return!0}return!1}function Kg(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new Ct(o.map(function(l){return l.getState("glyphIndex")}),0),a=new Ct(o.map(function(l){return l.char}),0);o.forEach(function(l,c){if(!pr(l.char)){i.setCurrentIndex(c),a.setCurrentIndex(c);var h=0;Zg(a)&&(h|=1),qg(a)&&(h|=2);var d;switch(h){case 1:d="fina";break;case 2:d="init";break;case 3:d="medi";break}if(n.indexOf(d)!==-1){var g=e.query.lookupFeature({tag:d,script:r,contextParams:i});if(g instanceof Error)return console.info(g.message);g.forEach(function(v,w){v instanceof Er&&(Os(v,o,w),i.context[w]=v.substitution)})}}})}}function iu(t,e){var r=t.map(function(n){return n.activeState.value});return new Ct(r,e||0)}function Qg(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=iu(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});l.length&&(l.forEach(function(c){return Os(c,n,a)}),o=iu(n))})}function Jg(t){var e=t.current,r=t.get(-1);return r===null&&Fo(e)||!Fo(r)&&Fo(e)}function em(t){var e=t.get(1);return e===null||!Fo(e)}var tm={startCheck:Jg,endCheck:em};function su(t,e){var r=t.map(function(n){return n.activeState.value});return new Ct(r,e||0)}function rm(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=su(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});l.length&&(l.forEach(function(c){return Os(c,n,a)}),o=su(n))})}function At(t){this.baseDir=t||"ltr",this.tokenizer=new Ve,this.featuresTags={}}At.prototype.setText=function(t){this.text=t};At.prototype.contextChecks={latinWordCheck:tm,arabicWordCheck:Hg,arabicSentenceCheck:zg};function Qi(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function nm(){return Qi.call(this,"latinWord"),Qi.call(this,"arabicWord"),Qi.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function om(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}At.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n};At.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new vt(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}};At.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function Ds(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function im(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Ds.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){Kg.call(t,n)})}}function sm(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){Ds.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){Qg.call(t,o)})}}}function am(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){Ds.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){rm.call(t,o)})}}}At.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)};At.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(im.call(this),sm.call(this)),this.checkContextReady("latinWord")&&am.call(this),this.checkContextReady("arabicSentence")&&om.call(this)};At.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),nm.call(this),this.applyFeaturesToContexts())};At.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()};At.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function Me(t){t=t||{},t.tables=t.tables||{},t.empty||(dn(t.familyName,"When creating a new Font object, familyName is required."),dn(t.styleName,"When creating a new Font object, styleName is required."),dn(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),dn(t.ascender,"When creating a new Font object, ascender is required."),dn(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new Ut.GlyphSet(this,t.glyphs||[]),this.encoding=new Ku(this),this.position=new Gn(this),this.substitution=new dt(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new gl(this)}})}Me.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null};Me.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)};Me.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Me.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})};Me.prototype.stringToGlyphs=function(t,e){var r=this,n=new At,o=function(g){return r.charToGlyphIndex(g.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var a=n.getTextGlyphs(t),l=a.length,c=new Array(l),h=this.glyphs.get(0),d=0;d<l;d+=1)c[d]=this.glyphs.get(a[d])||h;return c};Me.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)};Me.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r};Me.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""};Me.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0};Me.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Me.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var a=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,o),c;if(o.kerning){var h=o.script||this.position.getDefaultScriptName();c=this.position.getKerningTables(h,o.language)}for(var d=0;d<l.length;d+=1){var g=l[d];if(i.call(this,g,e,r,n,o),g.advanceWidth&&(e+=g.advanceWidth*a),o.kerning&&d<l.length-1){var v=c?this.position.getKerningValue(c,g.index,l[d+1].index):this.getKerningValue(g,l[d+1]);e+=v*a}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e};Me.prototype.getPath=function(t,e,r,n,o){var i=new Ze;return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var d=a.getPath(l,c,h,o,this);i.extend(d)}),i};Me.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var d=a.getPath(l,c,h,o,this);i.push(d)}),i};Me.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})};Me.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)};Me.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawPoints(t,l,c,h)})};Me.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawMetrics(t,l,c,h)})};Me.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en};Me.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0};Me.prototype.toTables=function(){return Yd.fontToTable(this)};Me.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Me.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r};Me.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(Zd())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i),a.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),a.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),h=qd(n);c.writeFileSync(t,h)}};Me.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Me.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Me.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Qt=new Array(10);Qt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(A.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(A.coverage),values:this.parseValueRecordList()};ne.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Qt[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();ne.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(A.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(A.pointer(A.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var a=this.parsePointer(A.classDef),l=this.parsePointer(A.classDef),c=this.parseUShort(),h=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:a,classDef2:l,class1Count:c,class2Count:h,classRecords:this.parseList(c,A.list(h,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}};Qt[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Qt[4]=function(){return{error:"GPOS Lookup 4 not supported"}};Qt[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Qt[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Qt[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Qt[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Qt[9]=function(){return{error:"GPOS Lookup 9 not supported"}};new Array(10);const um={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function lm(t){const{dir:e,xAxis:r}=um[t];return new bl([0,0,0],e,r)}function au(t){const e=new D(t);let r=new D([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new D([0,1,0]),n=r.cross(e)),n.normalize()}class bl extends pt{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new D(n):au(r),i=On(e,r,o);super(i)}get position(){return new D(this.wrapped.Location())}get direction(){return new D(this.wrapped.Direction())}get xAxis(){return new D(this.wrapped.XDirection())}get yAxis(){return new D(this.wrapped.YDirection())}autoAxes(){const e=au(this.direction);this.wrapped.SetXDirection(Zt(e))}setPosition(e){return this.wrapped.SetLocation(ht(e)),this}setXAxis(e){return this.wrapped.SetYDirection(Zt(e)),this}setYAxis(e){return this.wrapped.SetYDirection(Zt(e)),this}lookAt(e){const r=new D("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const Hr=t=>t.IsNull()?[]:Le(t).edges;function cm(t,e,r=!0){const n=N(),o=Oe(),i=o(new n.HLRBRep_Algo_1);i.Add_2(t.wrapped,0);const a=o(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(a),i.Update(),i.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),c=[...Hr(l.VCompound_1()),...Hr(l.Rg1LineVCompound_1()),...Hr(l.OutLineVCompound_1())];c.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped));const h=r?[...Hr(l.HCompound_1()),...Hr(l.Rg1LineHCompound_1()),...Hr(l.OutLineHCompound_1())]:[];return h.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped)),{visible:c,hidden:h}}const Cr=1e-8,zr=(t,e)=>tt(t,e,Cr*10);function fm(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(h=>({offset:ns(h,r),original:h})),o=[];let i=null,a=n.at(-1);if(!a)return[];if(o.length===1)return o;const l=h=>{i?h.offset instanceof Ge?o.push(h.offset):zr(h.offset.firstPoint,h.offset.lastPoint)||o.push(Fn(h.offset.firstPoint,h.offset.lastPoint)):i=h},c=function*(){for(const h of n.slice(0,-1))yield h;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const h of c()){const d=a.offset.lastPoint,g=h.offset.firstPoint;if(zr(d,g)){l(a),a=h;continue}let v=[];if(a.offset instanceof Ge&&h.offset instanceof Ge){const{intersections:E,commonSegmentsPoints:T}=Bn(a.offset,h.offset,Cr/100);v=[...E,...T]}if(v.length>0){let E=v[0];if(v.length>1){const P=a==null?void 0:a.original.lastPoint,M=v.map(O=>lh(O,P));E=v[M.indexOf(Math.min(...M))]}const T=a.offset.splitAt([E],Cr)[0],C=h.offset.splitAt([E],Cr).at(-1);if(!C)throw new Error("Bug in the splitting algo in offset");l({offset:T,original:a.original}),a={offset:C,original:h.original};continue}const w=Eu(d,g,a.original.lastPoint);l(a),o.push(w),a=h}return l(a),o}function hm(t,e){const r=fm(t,e);if(r.length<2)return null;const n=new Map,o=(h,d)=>{const g=n.get(h)||[];n.set(h,[...g,...d])};if(r.forEach((h,d)=>{r.slice(d+1).forEach((g,v)=>{const{intersections:w,commonSegmentsPoints:E}=Bn(h,g,Cr),T=[...w,...E].filter(C=>{const P=zr(C,h.firstPoint)||zr(C,h.lastPoint),M=zr(C,g.firstPoint)||zr(C,g.lastPoint);return!(P&&M)});T.length&&(o(d,T),o(v+d+1,T))})}),!n.size){const h=new ce(r);return t.intersects(h)?null:h}const a=r.flatMap((h,d)=>{if(!n.has(d))return h;const g=n.get(d)||[];return h.splitAt(g,Cr*100)}).filter(h=>!t.curves.find(g=>g.distanceFrom(h)<Math.abs(e)-Cr));if(!a.length)return null;const c=xu(a).filter(h=>h.length>1).map(h=>new ce(h)).filter(h=>h.isClosed());return c.length?c.length===1?c[0]:new re(c):null}const uu=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=Yt(e,t[r]);return e};function Lo(t,e){if(t instanceof ce)return hm(t,e);if(t instanceof re)return uu(t.blueprints.map(r=>Lo(r,e)));if(t instanceof Ce){const r=uu(t.blueprints.slice(1).map(n=>Lo(n,e)));return ur(Lo(t.blueprints[0],e),r)}return null}function lu(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],a=(c,h)=>{o({firstCurve:c,secondCurve:h,point:c.lastPoint})?i.push(...t(c,h,r)):i.push(c,h)};e.curves.slice(1).forEach(c=>{const h=i.pop();if(!h)throw new Error("Bug in the blueprint filletting algo");a(h,c)});const l=i.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if(tt(i[0].firstPoint,l.lastPoint)&&i.length>1){const c=i.pop(),h=i.shift();if(!c||!h)throw new Error("Bug in the blueprint filletting algo");a(c,h)}return new ce(i)}function Ms(t,e,r,n){if(e instanceof ce)return lu(t,e,r,n);if(e instanceof Ce)return new Ce(e.blueprints.map(o=>lu(t,o,r,n)));if(e instanceof re){const o=e.blueprints.map(i=>Ms(t,i,r,n)).filter(i=>i!==null);return new re(o)}return null}function pm(t,e,r){return Ms(os,t,e,r)}function dm(t,e,r){return Ms(is,t,e,r)}function vs(t,e){return t instanceof ce?new ce(No(t.curves,e)):t instanceof Ce?new Ce(t.blueprints.map(r=>vs(r,e))):t instanceof re?new re(t.blueprints.map(r=>vs(r,e))):t}class Ue{constructor(e=null){this.innerShape=e}clone(){var e;return new Ue(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new Mn}stretch(e,r,n){return this.innerShape?new Ue(this.innerShape.stretch(e,r,n)):new Ue}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Ue(this.innerShape.rotate(e,r)):new Ue}translate(e,r=0){return this.innerShape?new Ue(this.innerShape.translate(e,r)):new Ue}scale(e,r){return this.innerShape?new Ue(this.innerShape.scale(e,r)):new Ue}mirror(e,r,n){return this.innerShape?new Ue(this.innerShape.mirror(e,r,n)):new Ue}cut(e){return new Ue(ur(this.innerShape,e.innerShape))}fuse(e){return new Ue(Yt(this.innerShape,e.innerShape))}intersect(e){return new Ue(yn(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new Wo);return new Ue(pm(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new Wo);return new Ue(dm(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Ue(Lo(this.innerShape,e))}approximate(e,r={}){if(e!=="svg")throw new Error("Only 'svg' is supported for now");return new Ue(vs(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof ce)){if(this.innerShape instanceof re&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof ce)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class vm extends Wu{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Ue(new ce(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}function gm(t){const e=new vm;return t&&e.movePointerTo(t),e}function mm(t,e,r=0){return new Ue(op(t,e,r))}const ym=mm,cu=t=>{const e=ym(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>Kh(o,e)),n=xu(r).map(o=>new ce(o));return n.length===0?new Ue:n.length===1?new Ue(n[0]):new Ue(new re(n))};function ft(t,e="front"){let r;e instanceof bl?r=e:r=lm(e);const{visible:n,hidden:o}=cm(t,r);return{visible:cu(n),hidden:cu(o)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Sl=Symbol("Comlink.proxy"),wm=Symbol("Comlink.endpoint"),_m=Symbol("Comlink.releaseProxy"),Ji=Symbol("Comlink.finalizer"),Uo=Symbol("Comlink.thrown"),El=t=>typeof t=="object"&&t!==null||typeof t=="function",bm={canHandle:t=>El(t)&&t[Sl],serialize(t){const{port1:e,port2:r}=new MessageChannel;return Bs(t,e),[r,[r]]},deserialize(t){return t.start(),xm(t)}},Sm={canHandle:t=>El(t)&&Uo in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Tl=new Map([["proxy",bm],["throw",Sm]]);function Em(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function Bs(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!Em(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:a,path:l}=Object.assign({path:[]},o.data),c=(o.data.argumentList||[]).map(Tr);let h;try{const d=l.slice(0,-1).reduce((v,w)=>v[w],t),g=l.reduce((v,w)=>v[w],t);switch(a){case"GET":h=g;break;case"SET":d[l.slice(-1)[0]]=Tr(o.data.value),h=!0;break;case"APPLY":h=g.apply(d,c);break;case"CONSTRUCT":{const v=new g(...c);h=Rm(v)}break;case"ENDPOINT":{const{port1:v,port2:w}=new MessageChannel;Bs(t,w),h=km(v,[v])}break;case"RELEASE":h=void 0;break;default:return}}catch(d){h={value:d,[Uo]:0}}Promise.resolve(h).catch(d=>({value:d,[Uo]:0})).then(d=>{const[g,v]=ri(d);e.postMessage(Object.assign(Object.assign({},g),{id:i}),v),a==="RELEASE"&&(e.removeEventListener("message",n),xl(e),Ji in t&&typeof t[Ji]=="function"&&t[Ji]())}).catch(d=>{const[g,v]=ri({value:new TypeError("Unserializable return value"),[Uo]:0});e.postMessage(Object.assign(Object.assign({},g),{id:i}),v)})}),e.start&&e.start()}function Tm(t){return t.constructor.name==="MessagePort"}function xl(t){Tm(t)&&t.close()}function xm(t,e){const r=new Map;return t.addEventListener("message",function(o){const{data:i}=o;if(!i||!i.id)return;const a=r.get(i.id);if(a)try{a(i)}finally{r.delete(i.id)}}),gs(t,r,[],e)}function ko(t){if(t)throw new Error("Proxy has been released and is not useable")}function Cl(t){return Vr(t,new Map,{type:"RELEASE"}).then(()=>{xl(t)})}const ei=new WeakMap,ti="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(ei.get(t)||0)-1;ei.set(t,e),e===0&&Cl(t)});function Cm(t,e){const r=(ei.get(e)||0)+1;ei.set(e,r),ti&&ti.register(t,e,t)}function Pm(t){ti&&ti.unregister(t)}function gs(t,e,r=[],n=function(){}){let o=!1;const i=new Proxy(n,{get(a,l){if(ko(o),l===_m)return()=>{Pm(i),Cl(t),e.clear(),o=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const c=Vr(t,e,{type:"GET",path:r.map(h=>h.toString())}).then(Tr);return c.then.bind(c)}return gs(t,e,[...r,l])},set(a,l,c){ko(o);const[h,d]=ri(c);return Vr(t,e,{type:"SET",path:[...r,l].map(g=>g.toString()),value:h},d).then(Tr)},apply(a,l,c){ko(o);const h=r[r.length-1];if(h===wm)return Vr(t,e,{type:"ENDPOINT"}).then(Tr);if(h==="bind")return gs(t,e,r.slice(0,-1));const[d,g]=fu(c);return Vr(t,e,{type:"APPLY",path:r.map(v=>v.toString()),argumentList:d},g).then(Tr)},construct(a,l){ko(o);const[c,h]=fu(l);return Vr(t,e,{type:"CONSTRUCT",path:r.map(d=>d.toString()),argumentList:c},h).then(Tr)}});return Cm(i,t),i}function Am(t){return Array.prototype.concat.apply([],t)}function fu(t){const e=t.map(ri);return[e.map(r=>r[0]),Am(e.map(r=>r[1]))]}const Pl=new WeakMap;function km(t,e){return Pl.set(t,e),t}function Rm(t){return Object.assign(t,{[Sl]:!0})}function ri(t){for(const[e,r]of Tl)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},Pl.get(t)||[]]}function Tr(t){switch(t.type){case"HANDLER":return Tl.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Vr(t,e,r,n){return new Promise(o=>{const i=Om();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function Om(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Al(t,e){return typeof t!="number"||isNaN(t)?{valid:!1,message:`Parameter '${e}' must be a number`}:{valid:!0}}function Dm(t,e){return t<=0?{valid:!1,message:`Parameter '${e}' must be positive`}:{valid:!0}}function Mm(t,e,r){return t>=e?{valid:!1,message:`${r} (${t}) must be less than ${e}`}:{valid:!0}}function kt(t,e){const r=Al(t,e);return r.valid?Dm(t,e):r}function Bm(t,e,r){const n=Al(t,r);return n.valid?Mm(t,e,r):n}function Rt(t,e){return r=>{const n=[];for(const o of e){const i=t(r[o],o);i.valid||n.push(i.message)}return{valid:n.length===0,errors:n}}}function hu(t,e){return r=>{const n=r[t],o=r[e],i=Bm(n,o,t);return i.valid?{valid:!0,errors:[]}:{valid:!1,errors:[i.message]}}}function Fm(t,e){let r=!0;const n=[];if(e.params)for(const o of e.params){const{name:i,validators:a}=o;if(!a)continue;const l=t[i];for(const c of a){const h=c(l,i);if(!h.valid){r=!1,n.push(h.message);break}}}if(e.validators)for(const o of e.validators){const i=o(t);i.valid||(r=!1,n.push(...i.errors))}return{valid:r,errors:n}}function Yr({width:t=100,depth:e=100,height:r=100}){if(t===0&&e===0&&r===0)return _e([0,0,0],[1e-7,1e-7,1e-7]);const n=t/2,o=e/2;return _e([-n,-o,0],[n,o,r])}const Lm={name:"Cuboid",create:Yr,params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],validators:[Rt(kt,["width","depth","height"])],hasExplosion:!1};function Um({radius:t=50}){return Bh(t)}const Im={name:"Sphere",create:Um,params:[{name:"radius",defaultValue:50}],validators:[Rt(kt,["radius"])],hasExplosion:!1};function kl({radius:t=50,height:e=100}){return Sr(t,e,[0,0,0],[0,0,-1])}const Gm={name:"Cylinder",create:kl,params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],validators:[Rt(kt,["radius","height"])],hasExplosion:!1};function Nm({aLength:t=80,bLength:e=50,cLength:r=30}){return Uh(t,e,r)}const Hm={name:"Ellipsoid",create:Nm,params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],validators:[Rt(kt,["aLength","bLength","cLength"])],hasExplosion:!1},Rl=t=>t.boundingBox.center;function Ol(t,e,r){return r.map(({position:n,direction:o,orientation:i})=>{const a=t(),l=e(a);let c=a.translate([n[0]-l[0],n[1]-l[1],n[2]-l[2]]);const h=[0,0,1],d=new D(i||o);if(d.Length>0){const g=new D(h).cross(d);if(g.Length>1e-10){const v=new D(h).getAngle(d);c=c.rotate(v,n,g)}else d.dot(new D(h))<0&&(c=c.rotate(180,n,[1,0,0]))}return c})}function Dl(t,e,r,n,o,i=0,a=0,l=1){const c=new D([i,a,l]).normalized();return Array.from({length:e*r},(h,d)=>{const g=Math.floor(d/r),w=d%r*n,E=g*o,C=new st(new D(t.origin),new D(t.xDirection).normalized(),new D(t.normal).normalized()).toWorldCoords([w,E,0]);return{position:[C.x,C.y,C.z],direction:[t.normal[0],t.normal[1],t.normal[2]],orientation:[c.x,c.y,c.z]}})}function Vm(t,e,r,n=0,o=0,i=1){return Dl({origin:t,xDirection:e,normal:(()=>{const a=new D(e),l=new D([0,0,1]),c=Math.abs(a.normalized().dot(l))>.99?new D([1,0,0]):a.cross(l).normalized();return[c.x,c.y,c.z]})()},1,r,r>1?new D(e).Length/(r-1):0,0,n,o,i)}function Wm({count:t=5,vectorX:e=0,vectorY:r=50,vectorZ:n=50,originX:o=0,originY:i=0,originZ:a=0,boxWidth:l=10,boxDepth:c=10,boxHeight:h=10,orientationX:d=0,orientationY:g=0,orientationZ:v=1}){return Ft(Ol(()=>Yr({width:l,depth:c,height:h}),Rl,Vm([o,i,a],[e,r,n],t,d,g,v)))}const zm={name:"DiagonalCuboidPattern",create:Wm,params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[Rt(kt,["count","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function $m({originX:t=0,originY:e=0,originZ:r=0,directionX:n=1,directionY:o=0,directionZ:i=0,normalX:a=0,normalY:l=0,normalZ:c=1,rowCount:h=3,colCount:d=3,xSpacing:g=30,ySpacing:v=30,boxWidth:w=10,boxDepth:E=10,boxHeight:T=10,orientationX:C=0,orientationY:P=0,orientationZ:M=1}){return Ft(Ol(()=>Yr({width:w,depth:E,height:T}),Rl,Dl({origin:[t,e,r],xDirection:[n,o,i],normal:[a,l,c]},h,d,g,v,C,P,M)))}const Xm={name:"RectangularCuboidGrid",create:$m,params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[Rt(kt,["rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function Ml({depth:t=100,flangeXLenght:e=50,flangeYLenght:r=50,thickness:n=5}){const o=_e([0,-t/2,0],[e,t/2,n]),i=_e([0,-t/2,0],[n,t/2,r]);return o.fuse(i)}const Ym={name:"LProfile",create:Ml,params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],validators:[Rt(kt,["depth","flangeXLenght","flangeYLenght","thickness"]),hu("thickness","flangeXLenght"),hu("thickness","flangeYLenght")],hasExplosion:!1};function Bl({bottomRadius:t=50,topRadius:e=25,height:r=100}){return Ea(t,{plane:"XY",origin:[0,0,0]}).loftWith(Ea(e,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}const jm={name:"Frustum",create:Bl,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],validators:[Rt(kt,["bottomRadius","topRadius","height"])],hasExplosion:!1};function Fl({bottomRadius:t=50,topRadius:e=25,frustumHeight:r=80,cylinderHeight:n=40}){return Bl({bottomRadius:t,topRadius:e,height:r}).fuse(Sr(e,n,[0,0,-r],[0,0,-1]))}const Zm={name:"Drill",create:Fl,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],validators:[Rt(kt,["bottomRadius","topRadius","frustumHeight","cylinderHeight"])],hasExplosion:!1};function qm(t,e){return{main:t,helperSpaces:e}}function En(t){return t.main||t}const le={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},pe={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function Ro(t){let e;switch(t){case le.FRONT:e=new D([0,-1,0]);break;case le.BACK:e=new D([0,1,0]);break;case le.LEFT:e=new D([-1,0,0]);break;case le.RIGHT:e=new D([1,0,0]);break;case le.TOP:e=new D([0,0,1]);break;case le.BOTTOM:e=new D([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return e}function Ll(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case pe.FRONT_TOP:c=new D([r,n,l]);break;case pe.FRONT_BOTTOM:c=new D([r,n,o]);break;case pe.BACK_TOP:c=new D([r,a,l]);break;case pe.BACK_BOTTOM:c=new D([r,a,o]);break;case pe.LEFT_TOP:c=new D([r,n,l]);break;case pe.LEFT_BOTTOM:c=new D([r,n,o]);break;case pe.RIGHT_TOP:c=new D([i,n,l]);break;case pe.RIGHT_BOTTOM:c=new D([i,n,o]);break;case pe.FRONT_LEFT:c=new D([r,n,o]);break;case pe.FRONT_RIGHT:c=new D([i,n,o]);break;case pe.BACK_LEFT:c=new D([r,a,o]);break;case pe.BACK_RIGHT:c=new D([i,a,o]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function Ul(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case pe.FRONT_TOP:c=new D([i,n,l]);break;case pe.FRONT_BOTTOM:c=new D([i,n,o]);break;case pe.BACK_TOP:c=new D([i,a,l]);break;case pe.BACK_BOTTOM:c=new D([i,a,o]);break;case pe.LEFT_TOP:c=new D([r,a,l]);break;case pe.LEFT_BOTTOM:c=new D([r,a,o]);break;case pe.RIGHT_TOP:c=new D([i,a,l]);break;case pe.RIGHT_BOTTOM:c=new D([i,a,o]);break;case pe.FRONT_LEFT:c=new D([r,n,l]);break;case pe.FRONT_RIGHT:c=new D([i,n,l]);break;case pe.BACK_LEFT:c=new D([r,a,l]);break;case pe.BACK_RIGHT:c=new D([i,a,l]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function Km(t){switch(t){case pe.FRONT_LEFT:return[le.FRONT,le.LEFT];case pe.FRONT_RIGHT:return[le.FRONT,le.RIGHT];case pe.FRONT_TOP:return[le.FRONT,le.TOP];case pe.FRONT_BOTTOM:return[le.FRONT,le.BOTTOM];case pe.BACK_LEFT:return[le.BACK,le.LEFT];case pe.BACK_RIGHT:return[le.BACK,le.RIGHT];case pe.BACK_TOP:return[le.BACK,le.TOP];case pe.BACK_BOTTOM:return[le.BACK,le.BOTTOM];case pe.LEFT_TOP:return[le.LEFT,le.TOP];case pe.LEFT_BOTTOM:return[le.LEFT,le.BOTTOM];case pe.RIGHT_TOP:return[le.RIGHT,le.TOP];case pe.RIGHT_BOTTOM:return[le.RIGHT,le.BOTTOM];default:throw new Error(`Unknown edge identifier: ${t}`)}}function Qm(t,e,r=.5,n=.5){const[[o,i,a],[l,c,h]]=t.bounds,d=Math.max(0,Math.min(1,r)),g=Math.max(0,Math.min(1,n));let v;switch(e){case le.FRONT:v=new D([o+(l-o)*d,i,a+(h-a)*g]);break;case le.BACK:v=new D([o+(l-o)*d,c,a+(h-a)*g]);break;case le.LEFT:v=new D([o,i+(c-i)*d,a+(h-a)*g]);break;case le.RIGHT:v=new D([l,i+(c-i)*d,a+(h-a)*g]);break;case le.TOP:v=new D([o+(l-o)*d,i+(c-i)*g,h]);break;case le.BOTTOM:v=new D([o+(l-o)*d,i+(c-i)*g,a]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return v}function Jm(t,e,r=.5){const n=Math.max(0,Math.min(1,r)),o=Ll(t,e),i=Ul(t,e);return new D([o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n,o.z+(i.z-o.z)*n])}function e0(t,e){const{type:r,element:n,params:o={}}=e;switch(r){case"face":return Qm(t,n,o.u,o.v);case"edge":return Jm(t,n,o.t);case"corner":if(n.includes("START")){const i=n.replace("_START","");return Ll(t,i)}else if(n.includes("END")){const i=n.replace("_END","");return Ul(t,i)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new D(t.center);default:throw new Error(`Unknown position type: ${r}`)}}function t0(t){const e=t.normalized(),r=Math.abs(e.x),n=Math.abs(e.y),o=Math.abs(e.z);let i;return r<=n&&r<=o?i=new D([0,e.z,-e.y]):n<=r&&n<=o?i=new D([e.z,0,-e.x]):i=new D([e.y,-e.x,0]),i.normalized()}function Oo(t,e,r,n={}){const o=e0(t.boundingBox,e);let i;n.normal?i=new D(n.normal):i=r0(t,e,n);let a;n.xDir?a=new D(n.xDir):a=t0(i);const l=new Pr;l.coordSystemChange({origin:o.toTuple(),zDir:i.toTuple(),xDir:a.toTuple()},"reference");const c=Le(l.transform(r.wrapped));return l.delete(),i.delete(),a.delete(),o.delete(),c}function r0(t,e,r={}){const{type:n,element:o}=e;switch(n){case"face":return Ro(o);case"edge":if(r.faceForEdge)return Ro(r.faceForEdge);{const i=Km(o);return Ro(i[0])}case"corner":return r.faceForCorner?Ro(r.faceForCorner):new D([0,0,1]);case"center":default:return new D([0,0,1])}}function br(t,e,r,n=!1){return n?Le(t.wrapped).mirror(e,r):t.mirror(e,r)}const Il=[{id:"ST001",name:"Stringer"},{id:"LP001",name:"L-Profile"},{id:"SS001",name:"Side Stringer"}];function n0({width:t=50,depth:e=100,height:r=200,showHelper:n=!0,explosionFactor:o=0}){const i=Yr({width:t,depth:e,height:r}),a=Math.round(r/17.5)-1;if(a<=0)return qm(Ft([]),n?[i]:[]);const l=r/(a+1),c=a>1?(e-28)/(a-1):0,h=Yr({width:t-1,depth:20,height:.5}),d=h.boundingBox.center,g=Oo(h,{type:"face",element:le.TOP,params:{u:1.5/(t-1),v:2.25/20}},Fl({bottomRadius:1.2,topRadius:.8,frustumHeight:.5*.8,cylinderHeight:.5*.2})),v=h.cut(g).cut(br(g,"XZ",d,!0)).cut(br(g,"YZ",d,!0)).cut(br(br(g,"XZ",d,!0),"YZ",d,!0)),w=v.clone(),E=Ml({depth:20,flangeXLenght:4.5,flangeYLenght:4.5,thickness:.5}),T=E.boundingBox.center,C=Oo(E,{type:"face",element:le.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},kl({radius:.800001,height:.5})),P=E.cut(C).cut(br(C,"XZ",T,!0)),M=P.clone(),O=Oo(v,{type:"edge",element:pe.LEFT_BOTTOM,params:{t:.5}},P,{normal:[0,0,-1],xDir:[1,0,0]}),Y=br(O,"YZ",d,!0),H=[];let K=0,j=-e/2+14,Q=l-(v.boundingBox.bounds[1][2]-v.boundingBox.bounds[0][2]);for(let Ke=0;Ke<a;Ke++){const je=o*15;H.push(v.clone().translate([K,j,Q])),H.push(O.clone().translate([K-je,j,Q])),H.push(Y.clone().translate([K+je,j,Q])),j+=c,Q+=l}const oe=Yr({width:600,depth:20,height:.5}),de=c,we=l,Te=Math.sqrt(de*de+we*we),xe=Te>.001?[0,de/Te,we/Te]:[1,0,0],fe=Oo(i,{type:"face",element:le.RIGHT},oe,{normal:[-1,0,0],xDir:xe}).intersect(i),be=fe.clone(),ie=i.boundingBox.center,te=br(fe,"YZ",ie,!0),ue=o*30,Ae=o*30;H.push(fe.translate([ue,0,0])),H.push(te.translate([-Ae,0,0]));const ve=Ft(H),Be=Il.map(Ke=>{let je=0,rt="Variable";return Ke.id==="ST001"?(je=a,rt=`${t-1}200.5cm`):Ke.id==="LP001"?(je=a*2,rt="4.54.520cm"):Ke.id==="SS001"&&(je=2),{...Ke,quantity:je,dimensions:rt,material:"Steel"}});return{main:ve,helperSpaces:n?[i]:[],componentData:Be,technicalDrawingModels:{ST001:w,LP001:M,SS001:be}}}const o0={name:"Staircase",create:n0,params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],validators:[Rt(kt,["width","depth","height"])],hasExplosion:!0,hasTechnicalDrawingParts:!0,componentDataStructure:Il},i0=[{id:"SB001",name:"Side Board + Tape"},{id:"BD001",name:"Bottom Divider + Tape"},{id:"HB1001",name:"Horizontal Board 1 + Tape"},{id:"HB2001",name:"Horizontal Board 2 + Tape"},{id:"VB001",name:"Vertical Board + Tape"},{id:"SS001",name:"Small Shelf + Tape"},{id:"SSTDH001",name:"Small Shelf (Top Div Holes) + Tape"},{id:"SSBDH001",name:"Small Shelf (Both Div Holes) + Tape"},{id:"SSWDH001",name:"Small Shelf (Bottom Div Holes) + Tape"},{id:"SSD001",name:"Small Shelf Divider + Tape"},{id:"BS001",name:"Big Shelf + Tape"},{id:"HB3001",name:"Horizontal Board 3 + Tape"},{id:"MD001",name:"Middle Door + Tapes"},{id:"SDL001",name:"Side Door Left + Tapes"},{id:"SDR001",name:"Side Door Right + Tapes"}];function s0({width:t,depth:e,board_thickness:r}){let n=[];const o={},l=Math.floor(e/10),c=Math.floor((e-r)/10),h=Math.floor(e/15),d=(e-l*5)/(l+1),g=(e-r-c*5)/(c+1),v=(2*e/3-h*5)/(h+1),w=gm([-2.4,.25]).bulgeArcTo([2.4,.25],-.3).tangentArcTo([2.4,-.25]).bulgeArcTo([-2.4,-.25],-.3).tangentArcTo([-2.4,.25]).close().sketchOnPlane("XZ",-.15).extrude(.3),E=[];for(let G=0;G<l;G++){const Z=w.clone().translate(d+2.5+G*(5+d),-t/2+r/2,50);E.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const T=Pe(E),C=[];for(let G=0;G<c;G++){const Z=w.clone().rotate(90,[0,0,0],[1,0,0]).translate(g+2.5+G*(5+g),-t/2+r,3*r/2);C.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const P=Pe(C),M=_e([0,-t/2,0],[e,-t/2+r,50]).cut(T).cut(P),O=_e([e,-t/2,0],[e+.2,-t/2+r,50]),Y=M.clone(),H=O.clone();o.SB001=Pe([Y,H]),n.push(M),n.push(M.clone().mirror("XZ")),n.push(O),n.push(O.clone().mirror("XZ"));const K=[];for(let G=0;G<c;G++){const Z=w.clone().translate(g+2.5+G*(5+g),t/6,2*r);K.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const j=Pe(K),Q=_e([0,-t/2+r,r],[e-r-.2,t/2-r,2*r]).cut(P).cut(P).cut(P.mirror("XZ")).cut(j).cut(j.clone().mirror("XZ")),oe=_e([e-r-.2,-t/2+r,r],[e-r,t/2-r,2*r]),de=Q.clone(),we=oe.clone();o.HB1001=Pe([de,we]),n.push(Q),n.push(oe);const Te=[];for(let G=0;G<c;G++){const Z=w.clone().translate(g+2.5+G*(5+g),t/6,50);Te.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const xe=Pe(Te),se=_e([0,t/6-r/2,2*r],[e-r-.2,t/6+r/2,50]).cut(j).cut(xe),fe=_e([e-r-.2,t/6-r/2,2*r],[e-r,t/6+r/2,50]),be=se.clone(),ie=fe.clone();o.BD001=Pe([be,ie]),n.push(se),n.push(se.clone().mirror("XZ")),n.push(fe),n.push(fe.clone().mirror("XZ"));const te=[];for(let G=0;G<h;G++){const Z=w.clone().translate(v+2.5+G*(5+v),t/4,50+r);te.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const ue=Pe(te),Ae=_e([0,-t/2,50],[e,t/2,50+r]).cut(T).cut(T.mirror("XZ")).cut(xe).cut(xe.mirror("XZ")).cut(ue).cut(ue.clone().mirror("XZ")),ve=_e([e,-t/2,50],[e+.2,t/2,50+r]),Be=Ae.clone(),Ot=ve.clone();o.HB2001=Pe([Be,Ot]),n.push(Ae),n.push(ve);const Ke=[];for(let G=0;G<h;G++){const Z=w.clone().translate(v+2.5+G*(5+v),t/4,50+6*(r+30));Ke.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const je=Pe(Ke),rt=[];for(let G=0;G<4;G++)for(let Z=0;Z<h;Z++){const ot=w.clone().rotate(90,[0,0,0],[1,0,0]).translate(v+2.5+Z*(5+v),t/4-r/2,50+2.5*r+60+G*(30+r));rt.push(ot),n.push(ot.clone()),n.push(ot.clone().mirror("XZ"))}const Jt=Pe(rt),at=Sr(.4,3,[v/2,t/4+r,50+30+1.5*r],[0,-1,0]),me=[];for(let G=0;G<5;G++)for(let Z=0;Z<h+1;Z++){const ot=at.clone().translate(Z*(v+5),0,G*(30+r));me.push(ot.clone()),n.push(ot.clone()),n.push(ot.clone().mirror("XZ"))}const De=Pe(me),ke=_e([0,t/4-r/2,50+r],[2*e/3,t/4+r/2,50+6*(r+30)]).cut(ue).cut(je).cut(Jt).cut(De.clone()),nt=_e([2*e/3,t/4-r/2,50+r],[2*e/3+.2,t/4+r/2,50+6*(r+30)]),L=ke.clone(),he=nt.clone();o.VB001=Pe([L,he]),n.push(ke),n.push(ke.clone().mirror("XZ")),n.push(nt),n.push(nt.clone().mirror("XZ"));const ut=[];for(let G=0;G<h+1;G++){const Z=at.clone().translateX(G*(v+5));ut.push(Z)}const Wn=Pe(ut),wt=_e([0,t/4+r/2,50+r+30],[2*e/3,t/2,50+2*r+30]).cut(Wn.clone()),It=_e([2*e/3,t/4+r/2,50+r+30],[2*e/3+.2,t/2,50+2*r+30]),zn=wt.clone(),$n=It.clone();o.SS001=Pe([zn,$n]),n.push(wt),n.push(wt.clone().mirror("XZ")),n.push(wt.clone().translateZ(30+r)),n.push(wt.clone().translateZ(30+r).mirror("XZ"));const rn=[];for(let G=0;G<h;G++){const Z=w.clone().translate(v+2.5+G*(v+5),3*t/8-r/4,140+4*r);rn.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const nn=Pe(rn),Xn=[];for(let G=0;G<h;G++){const Z=w.clone().translate(v+2.5+G*(v+5),3*t/8-r/4,50+4*(30+r));Xn.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const Yn=Pe(Xn),jn=[];for(let G=0;G<h;G++){const Z=w.clone().translate(v+2.5+G*(v+5),3*t/8-r/4,170+5*r);jn.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const li=Pe(jn),Zn=[];for(let G=0;G<h;G++){const Z=w.clone().translate(v+2.5+G*(v+5),3*t/8-r/4,50+5*(30+r));Zn.push(Z),n.push(Z.clone()),n.push(Z.clone().mirror("XZ"))}const ci=Pe(Zn),_t=wt.clone().translateZ(2*(30+r)).cut(nn),gr=_t.clone(),Fs=It.clone().translateZ(2*(30+r));o.SSTDH001=Pe([gr,Fs]),n.push(_t),n.push(_t.clone().mirror("XZ"));const mr=wt.clone().translateZ(3*(30+r)).cut(Yn).cut(li),Or=mr.clone(),Dt=It.clone().translateZ(3*(30+r));o.SSBDH001=Pe([Or,Dt]),n.push(mr),n.push(mr.clone().mirror("XZ"));const on=wt.clone().translateZ(4*(30+r)).cut(ci),qn=on.clone(),Kn=It.clone().translateZ(4*(30+r));o.SSWDH001=Pe([qn,Kn]),n.push(on),n.push(on.clone().mirror("XZ"));for(let G=0;G<5;G++)n.push(It.clone().translateZ(G*(r+30))),n.push(It.clone().translateZ(G*(r+30)).mirror("XZ"));const ze=_e([0,3*t/8-3*r/4,50+3*30+4*r],[2*e/3,3*t/8+r/4,50+4*(30+r)]).cut(nn).cut(Yn);n.push(ze),n.push(ze.clone().mirror("XZ")),n.push(ze.clone().translateZ(30+r)),n.push(ze.clone().translateZ(30+r).mirror("XZ"));const er=_e([2*e/3,3*t/8-3*r/4,50+3*30+4*r],[2*e/3+.2,3*t/8+r/4,50+4*(30+r)]),fi=ze.clone(),hi=er.clone();o.SSD001=Pe([fi,hi]),n.push(er),n.push(er.clone().mirror("XZ")),n.push(er.clone().translateZ(r+30)),n.push(er.clone().translateZ(r+30).mirror("XZ"));const We=[];for(let G=0;G<h;G++){const Z=w.clone().rotate(90,[0,0,0],[1,0,0]).translate(v+2.5+G*(5+v),t/4-r/2,50+2.5*r+60);We.push(Z)}const bt=Pe(We),Qn=_e([0,-t/4+r/2,50+2*(30+r)],[2*e/3,t/4-r/2,50+2*30+3*r]).cut(bt),Dr=_e([2*e/3,-t/4+r/2,50+2*(30+r)],[2*e/3+.2,t/4-r/2,50+2*30+3*r]),Mr=Qn.clone(),Br=Dr.clone();o.BS001=Pe([Mr,Br]);for(let G=0;G<4;G++)n.push(Qn.clone().translateZ(G*(30+r))),n.push(Dr.clone().translateZ(G*(30+r)));const Jn=_e([0,-t/2,50+6*(r+30)],[e,t/2,50+7*r+6*30]).cut(je).cut(je.mirror("XZ")),eo=_e([e,-t/2,50+6*(r+30)],[e+.2,t/2,50+7*r+6*30]),pi=Jn.clone(),di=eo.clone();o.HB3001=Pe([pi,di]),n.push(Jn),n.push(eo);const ge=Sr(.3,r,[e,-t/6-r,50-r],[-1,0,0]),Fr=Sr(1.5,r/2,[e-r,-t/2+2*r,50-2*r],[1,0,0]),ct=_e([e-r,-t/2+r+.4,r],[e,-t/6-.3,50-.4]).cut(ge).cut(Fr).cut(Fr.clone().translateZ(-50+6*r));n.push(ct);const Gt=ct.clone().mirror("XZ"),sn=_e([e-r,-t/6-.3,r],[e,-t/6-.1,50-.4]),an=_e([e-r,-t/2+r+.2,r],[e,-t/2+r+.4,50-.4]),Lr=_e([e-r,-t/2+r+.4,50-.4],[e,-t/6-.3,50-.2]),ee=_e([e-r,-t/2+r+.4,r],[e,-t/6-.3,r+.2]),vi=ct.clone(),y=sn.clone(),ye=an.clone(),gi=Lr.clone(),mi=ee.clone(),to=Pe([vi,y,ye,gi,mi]);o.SDL001=to,o.SDR001=to.clone().mirror("XZ"),n.push(Gt);const ro=_e([e-r,-t/6+.3,r],[e,t/6-.3,50-.4]).cut(ge.clone().translateY(2*r).mirror("XZ")).cut(Fr.clone().translateY(t/3)).cut(Fr.clone().translate(0,t/3,-50+6*r)),no=_e([e-r,-t/6+.1,r],[e,-t/6+.3,50-.4]),oo=_e([e-r,t/6-.3,r],[e,t/6-.1,50-.4]),io=_e([e-r,-t/6+.3,50-.4],[e,t/6-.3,50-.2]),so=_e([e-r,-t/6+.3,r],[e,t/6-.3,r+.2]),yi=ro.clone(),wi=no.clone(),_i=oo.clone(),Ur=io.clone(),bi=so.clone();o.MD001=Pe([yi,wi,_i,Ur,bi]),n.push(ro),n.push(no),n.push(oo),n.push(io),n.push(so),n.push(sn),n.push(an),n.push(Lr),n.push(ee),n.push(sn.clone().mirror("XZ")),n.push(an.clone().mirror("XZ")),n.push(Lr.clone().mirror("XZ")),n.push(ee.clone().mirror("XZ"));const Ir=Sr(.5,2,[e,t/6+r,50-r],[1,0,0]).fuse(Sr(1,1,[e+2,t/6+r,50-r],[1,0,0]));return n.push(Ir),n.push(Ir.clone().mirror("XZ")),n.push(Ir.clone().translateY(-2*r)),{main:Pe(n),technicalDrawingModels:o}}const a0={name:"Closet",create:s0,params:[{name:"width",defaultValue:200,description:"Overall width of the closet"},{name:"depth",defaultValue:50,description:"Overall depth of the closet"},{name:"board_thickness",defaultValue:3,description:"Thickness of the boards used"}],validators:[Rt(kt,["width","depth","board_thickness"])],hasExplosion:!1,hasBoM:!0,hasTechnicalDrawingParts:!0,componentDataStructure:i0},u0={Cuboid:Lm,Sphere:Im,Cylinder:Gm,Ellipsoid:Hm,DiagonalCuboidPattern:zm,RectangularCuboidGrid:Xm,LProfile:Ym,Frustum:jm,Drill:Zm,Closet:a0,Staircase:{...o0,hasBoM:!0}};function Gl(t,e){const r=u0[t];if(!r)throw new Error(`Model "${t}" not found`);const n=Fm(e,r);return n.valid?r.create(e):{error:!0,validationErrors:n.errors}}function Qe(t){if(!t||typeof t!="string")return null;const e=t.split(/[\s,]+/).map(parseFloat);if(e.length!==4||e.some(isNaN))return console.warn("Could not parse viewBox string:",t),null;const r=Math.max(0,e[2]),n=Math.max(0,e[3]);return{x:e[0],y:e[1],width:r,height:n}}function l0(t,e){const r="0 0 100 100",n=Qe(t),o=Qe(e);if(!n&&!o)return r;if(!n)return e||r;if(!o)return t||r;const i=Math.min(n.x,o.x),a=Math.min(n.y,o.y),l=Math.max(n.x+n.width,o.x+o.width),c=Math.max(n.y+n.height,o.y+o.height),h=Math.max(0,l-i),d=Math.max(0,c-a);return`${i} ${a} ${h} ${d}`}const mt=1e-6;function cr(t,e,r=mt){return!t||!e?!1:Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))<r}function pu(t,e,r,n=mt){if(!t||!e||!r)return!1;if(Math.abs(t[0]-e[0])<n&&Math.abs(e[0]-r[0])<n||Math.abs(t[1]-e[1])<n&&Math.abs(e[1]-r[1])<n)return!0;const o=Math.abs((e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])),i=Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2);return i<n*n?!0:o/Math.sqrt(i)<n}function c0(t){if(!t||typeof t!="string")return console.error("Invalid input to parsePathData:",t),[];const e=/([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/ig,r=[];let n;for(;(n=e.exec(t))!==null;){const o=n[1],i=n[2].trim(),a=/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g,l=(i.match(a)||[]).map(Number);if(l.some(isNaN)){console.warn(`[svgPathUtils] Skipping command due to invalid parameters: ${n[0]}`);continue}r.push({command:o,values:l})}return r}function f0(t,e,r){e===0&&r===0||t.forEach(n=>{const o=n.command,i=n.values;if(o===o.toUpperCase()&&o!=="Z")for(let a=0;a<i.length;a++)switch(o){case"M":case"L":case"T":i[a]+=a%2===0?e:r;break;case"H":i[a]+=e;break;case"V":i[a]+=r;break;case"C":i[a]+=a%2===0?e:r;break;case"S":case"Q":i[a]+=a%2===0?e:r;break;case"A":a>=5&&(i[a]+=a%2!==0?e:r);break}})}function h0(t){return t.map(e=>{const r=e.values.map(n=>Math.abs(n)>1e6||Math.abs(n)<1e-4&&n!==0?n.toExponential(4):parseFloat(n.toFixed(4))).join(" ");return`${e.command}${r}`}).join("")}let du=!1;const p0=async()=>{if(console.log("[TECH_DRAW_WORKER_INIT] Starting initialization..."),du)return console.log("[TECH_DRAW_WORKER_INIT] Already loaded."),Promise.resolve(!0);try{console.log("[TECH_DRAW_WORKER_INIT] Loading OpenCascade...");const t=await jf({locateFile:()=>Zf});return console.log("[TECH_DRAW_WORKER_INIT] OpenCascade loaded."),du=!0,qf(t),console.log("[TECH_DRAW_WORKER_INIT] OpenCascade set successfully."),!0}catch(t){throw console.error("[TECH_DRAW_WORKER_INIT_ERROR] Failed to initialize OpenCascade:",t),t}},Nl=p0();function d0(t){const e=En(t);if(t&&t.technicalDrawingModels){const n=[],o=[];return Object.entries(t.technicalDrawingModels).forEach(([i,a])=>{try{const l=En(a),c=l.boundingBox.center,h=l.translate([-c[0],-c[1],-c[2]]);o.push(h);const d=t.componentData.find(O=>O.id===i||O.name.toLowerCase().includes(i.toLowerCase())),g=ft(h,"front"),v=ft(h,"bottom"),w=ft(h,"left"),E=Qe(g.visible.toSVGViewBox()),T=Qe(v.visible.toSVGViewBox()),C=Qe(w.visible.toSVGViewBox()),P=Math.max((E==null?void 0:E.width)||0,(T==null?void 0:T.width)||0,(C==null?void 0:C.width)||0),M=Math.max((E==null?void 0:E.height)||0,(T==null?void 0:T.height)||0,(C==null?void 0:C.height)||0);E&&(g.normalizedViewBox=gt(E,P,M)),T&&(v.normalizedViewBox=gt(T,P,M)),C&&(w.normalizedViewBox=gt(C,P,M)),n.push({name:d?d.name:i,views:{front:g,bottom:v,left:w}})}catch(l){console.error(`Error processing model ${i}:`,l)}}),{parts:n}}const r=[];try{const n=En(e),o=n.boundingBox.center,i=n.translate([-o[0],-o[1],-o[2]]);r.push(i);const a=ft(i,"front"),l=ft(i,"bottom"),c=ft(i,"left"),h=Qe(a.visible.toSVGViewBox()),d=Qe(l.visible.toSVGViewBox()),g=Qe(c.visible.toSVGViewBox()),v=Math.max((h==null?void 0:h.width)||0,(d==null?void 0:d.width)||0,(g==null?void 0:g.width)||0),w=Math.max((h==null?void 0:h.height)||0,(d==null?void 0:d.height)||0,(g==null?void 0:g.height)||0);h&&(a.normalizedViewBox=gt(h,v,w)),d&&(l.normalizedViewBox=gt(d,v,w)),g&&(c.normalizedViewBox=gt(g,v,w));let E=[];if(t&&t.main&&Array.isArray(t.helperSpaces)){const T=t.main,C=T.boundingBox.center,P=T.translate([-C[0],-C[1],-C[2]]);r.push(P);const M=ft(P,"front"),O=ft(P,"bottom"),Y=ft(P,"left"),H=Qe(M.visible.toSVGViewBox()),K=Qe(O.visible.toSVGViewBox()),j=Qe(Y.visible.toSVGViewBox()),Q=Math.max((H==null?void 0:H.width)||0,(K==null?void 0:K.width)||0,(j==null?void 0:j.width)||0),oe=Math.max((H==null?void 0:H.height)||0,(K==null?void 0:K.height)||0,(j==null?void 0:j.height)||0);H&&(M.normalizedViewBox=gt(H,Q,oe)),K&&(O.normalizedViewBox=gt(K,Q,oe)),j&&(Y.normalizedViewBox=gt(j,Q,oe)),E=[{name:"Main Component",views:{front:M,bottom:O,left:Y}}],t.helperSpaces.forEach((de,we)=>{const Te=de.boundingBox.center,xe=de.translate([-Te[0],-Te[1],-Te[2]]);r.push(xe);const se=ft(xe,"front"),fe=ft(xe,"bottom"),be=ft(xe,"left"),ie=Qe(se.visible.toSVGViewBox()),te=Qe(fe.visible.toSVGViewBox()),ue=Qe(be.visible.toSVGViewBox()),Ae=Math.max((ie==null?void 0:ie.width)||0,(te==null?void 0:te.width)||0,(ue==null?void 0:ue.width)||0),ve=Math.max((ie==null?void 0:ie.height)||0,(te==null?void 0:te.height)||0,(ue==null?void 0:ue.height)||0);ie&&(se.normalizedViewBox=gt(ie,Ae,ve)),te&&(fe.normalizedViewBox=gt(te,Ae,ve)),ue&&(be.normalizedViewBox=gt(ue,Ae,ve)),E.push({name:`Helper Space ${we+1}`,views:{front:se,bottom:fe,left:be}})})}return{standard:{frontView:a,bottomView:l,left:c},parts:E}}catch(n){return console.error("Error in standard projections:",n),{standard:{},parts:[]}}}function gt(t,e,r){if(!t||typeof t.x!="number"||typeof t.y!="number"||typeof t.width!="number"||typeof t.height!="number")return"0 0 100 100";const n=t.x+t.width/2,o=t.y+t.height/2,i=e>0?e:100,a=r>0?r:100,l=1.3,c=i*l,h=a*l,d=n-c/2,g=o-h/2;return`${d} ${g} ${c} ${h}`}function v0(t){const e={};if(t.standard&&t.standard.frontView){const{frontView:n,bottomView:o,left:i}=t.standard,a=[],l={view:n,name:"front",viewBox:Qe(n.normalizedViewBox||n.visible.toSVGViewBox(5)),visiblePaths:n.visible.toSVGPaths(),hiddenPaths:n.hidden.toSVGPaths()},c=o?{view:o,name:"bottom",viewBox:Qe(o.normalizedViewBox||o.visible.toSVGViewBox(5)),visiblePaths:o.visible.toSVGPaths(),hiddenPaths:o.hidden.toSVGPaths()}:null,h=i?{view:i,name:"left",viewBox:Qe(i.normalizedViewBox||i.visible.toSVGViewBox(5)),visiblePaths:i.visible.toSVGPaths(),hiddenPaths:i.hidden.toSVGPaths()}:null;if(!l.viewBox)return{parts:vu(t.parts)};let d=l.viewBox.x,g=l.viewBox.y,v=l.viewBox.x+l.viewBox.width,w=l.viewBox.y+l.viewBox.height,E={x:0,y:0},T={x:0,y:0};c&&c.viewBox&&(E.x=l.viewBox.x+(l.viewBox.width-c.viewBox.width)/2,E.y=l.viewBox.y+l.viewBox.height+20,d=Math.min(d,E.x),v=Math.max(v,E.x+c.viewBox.width),w=Math.max(w,E.y+c.viewBox.height)),h&&h.viewBox&&(T.x=l.viewBox.x+l.viewBox.width+20,T.y=l.viewBox.y+(l.viewBox.height-h.viewBox.height)/2,g=Math.min(g,T.y),v=Math.max(v,T.x+h.viewBox.width),w=Math.max(w,T.y+h.viewBox.height));const C=v-d,P=w-g,M=`${d} ${g} ${C} ${P}`,O=(Y,H,K,j)=>{if(!Y)return;const Q=`standard_${j}`,oe=Qr(Y.visiblePaths,`${Q}_visible`,H,K),de=Qr(Y.hiddenPaths,`${Q}_hidden`,H,K);oe.forEach(we=>we.originalView=j),de.forEach(we=>we.originalView=j),a.push(...oe,...de)};O(l,0,0,"front"),c&&c.viewBox&&O(c,E.x-c.viewBox.x,E.y-c.viewBox.y,"bottom"),h&&h.viewBox&&O(h,T.x-h.viewBox.x,T.y-h.viewBox.y,"left"),e.standardLayout={combinedViewBox:M,paths:a}}return e.parts=vu(t.parts),t.componentData&&(e.componentData=t.componentData),e}function vu(t=[]){const e=[];for(const r of t)try{const n={};for(const[o,i]of Object.entries(r.views)){if(!i){console.warn(`[WARN] Skipping null/undefined view '${o}' for part '${r.name}'`);continue}const a=i.visible.toSVGPaths(),l=i.hidden.toSVGPaths(),c=`${r.name.replace(/\s+/g,"_")}_${o}`,h=Qr(a,`${c}_visible`,0,0),d=Qr(l,`${c}_hidden`,0,0),g=i.normalizedViewBox||i.visible.toSVGViewBox(5),v=i.normalizedViewBox||i.hidden.toSVGViewBox(5),w=i.normalizedViewBox||l0(g,v);n[o]={visible:{paths:h,viewBox:g},hidden:{paths:d,viewBox:v},combinedViewBox:w}}e.push({name:r.name,views:n})}catch(n){console.error(`[ERROR] Error processing part ${r.name}:`,n)}return e}function g0(t,e){let r,n;if(cr(t.endpoints[1],e.endpoints[0]))r=t.endpoints[0],n=e.endpoints[1];else if(cr(t.endpoints[0],e.endpoints[1]))r=e.endpoints[0],n=t.endpoints[1];else if(cr(t.endpoints[0],e.endpoints[0]))r=t.endpoints[1],n=e.endpoints[1];else if(cr(t.endpoints[1],e.endpoints[1]))r=t.endpoints[0],n=e.endpoints[0];else return console.warn("Cannot determine merge order for segments",t,e),t;const o=(t.length||0)+(e.length||0);return{type:"line",path:`M ${r[0]} ${r[1]} L ${n[0]} ${n[1]}`,length:o,endpoints:[r,n]}}function Qr(t,e="path",r=0,n=0){if(!Array.isArray(t))return console.warn("[WARN] normalizePaths received non-array input:",t),[];const o=[];let i=0;for(const a of t){let l;if(typeof a=="string")l=a;else if(Array.isArray(a)&&a.length>0&&typeof a[0]=="string")l=a[0];else if(a&&typeof a=="object"&&typeof a.d=="string")l=a.d;else{console.warn("[WARN] Skipping path due to unexpected format:",a);continue}if(!l||!l.trim())continue;let c=l;if(r!==0||n!==0)try{const w=c0(l);w.length>0?(f0(w,r,n),c=h0(w)):console.warn(`[WARN] Could not parse path data for transformation: ${l.substring(0,50)}...`)}catch(w){console.error(`[ERROR] Failed to transform path data: ${l.substring(0,50)}...`,w)}const h=m0(c),d={type:"unknown"};h&&(d.type="circle",d.center=h.center,d.radius=h.radius,d.diameter=h.radius*2);const g=y0(c),v=[];if(g.length>0){let w=g[0];for(let E=1;E<g.length;E++){const T=g[E];w&&T&&w.type==="line"&&T.type==="line"&&w.endpoints&&T.endpoints&&(cr(w.endpoints[1],T.endpoints[0])||cr(w.endpoints[0],T.endpoints[1])||cr(w.endpoints[0],T.endpoints[0])||cr(w.endpoints[1],T.endpoints[1]))&&pu(w.endpoints[0],w.endpoints[1],T.endpoints[0])&&pu(w.endpoints[0],w.endpoints[1],T.endpoints[1])?w=g0(w,T):(w&&v.push(w),w=T)}w&&v.push(w),v.forEach((E,T)=>{if(E&&E.path){const C=`${e}_${i}_${T}`;o.push({id:C,groupId:C,data:E.path,type:E.type,geometry:E.geometry})}else console.warn("[WARN] Skipping invalid segment during final ID assignment:",E)})}else if(h){const w=`${e}_${i}_circle`;o.push({id:w,groupId:w,data:c,type:"circle",geometry:d})}else{const w=`${e}_${i}_unknown`;o.push({id:w,groupId:w,data:c,type:"unknown",geometry:{type:"unknown"}}),console.warn(`[WARN] Path could not be decomposed or identified as circle: ${c.substring(0,50)}...`)}i++}return o}function m0(t){const e=/([Aa])\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)\s+([-\d.eE+]+)\s+([01])\s*,?\s*([01])\s+([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/g,r=/M\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/i,n=t.match(r);if(!n)return null;const o=parseFloat(n[1]),i=parseFloat(n[2]),a=[];let l;for(e.lastIndex=0;(l=e.exec(t))!==null;)a.push({rx:parseFloat(l[2]),ry:parseFloat(l[3]),xAxisRotation:parseFloat(l[4]),largeArcFlag:parseInt(l[5]),sweepFlag:parseInt(l[6]),endX:parseFloat(l[7]),endY:parseFloat(l[8]),isRelative:l[1]==="a"});if(a.length===0)return null;const c=Math.abs(a[0].rx),h=Math.abs(a[0].ry);if(c<mt||Math.abs(c-h)>mt*Math.max(c,h)||!a.every(me=>Math.abs(Math.abs(me.rx)-c)<mt&&Math.abs(Math.abs(me.ry)-h)<mt))return null;let d=o,g=i;const v=t.match(/([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/ig);if(!v)return null;for(const me of v){const De=me[0],ke=(me.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(ke.some(isNaN)){console.warn(`Could not parse parameters for command: ${me}`);continue}const nt=gu(De,ke,d,g);d=nt[0],g=nt[1]}if(!(Math.abs(d-o)<mt&&Math.abs(g-i)<mt)||a.length<2)return null;let E=null;d=o,g=i;for(const me of v){const De=me[0],ke=(me.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(ke.some(isNaN))continue;if(De==="A"||De==="a"){if(ke.length<7){console.warn(`Invalid arc command parameters: ${me}`);continue}E={rx:Math.abs(ke[0]),ry:Math.abs(ke[1]),xAxisRotationDeg:ke[2],largeArcFlag:ke[3],sweepFlag:ke[4],endX:De==="a"?d+ke[5]:ke[5],endY:De==="a"?g+ke[6]:ke[6],startX:d,startY:g};break}const nt=gu(De,ke,d,g);d=nt[0],g=nt[1]}if(!E)return null;const{rx:T,ry:C,xAxisRotationDeg:P,largeArcFlag:M,sweepFlag:O,endX:Y,endY:H,startX:K,startY:j}=E,Q=P*Math.PI/180,oe=Math.cos(Q),de=Math.sin(Q),we=oe*(K-Y)/2+de*(j-H)/2,Te=-de*(K-Y)/2+oe*(j-H)/2,xe=T*T,se=C*C,fe=we*we,be=Te*Te;let ie=fe/xe+be/se,te=T,ue=C;if(ie>1){const me=Math.sqrt(ie);te=me*T,ue=me*C}const Ae=te*te,ve=ue*ue;let Be=M===O?-1:1,Ot=Math.max(0,(Ae*ve-Ae*be-ve*fe)/(Ae*be+ve*fe)),Ke=Be*Math.sqrt(Ot);const je=Ke*(te*Te/ue),rt=Ke*-(ue*we/te),Jt=oe*je-de*rt+(K+Y)/2,at=de*je+oe*rt+(j+H)/2;return{center:[Jt,at],radius:te}}function y0(t){const e=[];let r=0,n=0,o=0,i=0;const a=/([MLHVCSQTAZmlhvcsqtaz])([^MLHVCSQTAZmlhvcsqtaz]*)/g;let l;for(;(l=a.exec(t))!==null;){const c=l[1],h=(l[2].match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(h.some(isNaN)){console.warn(`Could not parse parameters for command: ${l[0]}`);continue}let d=[];switch(c){case"M":if(h.length>=2){r=h[0],n=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const v=h[g],w=h[g+1],E=zt(r,n,v,w);E&&e.push(E),r=v,n=w}}break;case"m":if(h.length>=2){r+=h[0],n+=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const v=r+h[g],w=n+h[g+1],E=zt(r,n,v,w);E&&e.push(E),r=v,n=w}}break;case"L":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const v=h[g],w=h[g+1],E=zt(r,n,v,w);E&&e.push(E),r=v,n=w}break;case"l":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const v=r+h[g],w=n+h[g+1],E=zt(r,n,v,w);E&&e.push(E),r=v,n=w}break;case"H":for(let g=0;g<h.length;g++){const v=h[g],w=zt(r,n,v,n);w&&e.push(w),r=v}break;case"h":for(let g=0;g<h.length;g++){const v=r+h[g],w=zt(r,n,v,n);w&&e.push(w),r=v}break;case"V":for(let g=0;g<h.length;g++){const v=h[g],w=zt(r,n,r,v);w&&e.push(w),n=v}break;case"v":for(let g=0;g<h.length;g++){const v=n+h[g],w=zt(r,n,r,v);w&&e.push(w),n=v}break;case"Z":case"z":if(Math.abs(r-o)>mt||Math.abs(n-i)>mt){const g=zt(r,n,o,i);g&&e.push(g)}r=o,n=i;break;case"C":case"c":d=h.length/6;for(let g=0;g<d;++g){const v=h.slice(g*6,(g+1)*6);if(v.length===6){const w=xr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"curve",length:vn(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break;case"S":case"s":d=h.length/4;for(let g=0;g<d;++g){const v=h.slice(g*4,(g+1)*4);if(v.length===4){const w=xr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"curve",length:vn(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break;case"Q":case"q":d=h.length/4;for(let g=0;g<d;++g){const v=h.slice(g*4,(g+1)*4);if(v.length===4){const w=xr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"curve",length:vn(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break;case"T":case"t":d=h.length/2;for(let g=0;g<d;++g){const v=h.slice(g*2,(g+1)*2);if(v.length===2){const w=xr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"curve",length:vn(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break;case"A":case"a":d=h.length/7;for(let g=0;g<d;++g){const v=h.slice(g*7,(g+1)*7);if(v.length===7){const w=xr(c,v,r,n);e.push({type:"arc",path:`M ${r} ${n} ${c} ${v.join(" ")}`,geometry:{type:"arc",length:vn(c,v,r,n),endpoints:[[r,n],w]}}),r=w[0],n=w[1]}}break}}return e}function zt(t,e,r,n){if(Math.abs(t-r)<mt&&Math.abs(e-n)<mt)return null;const o=Math.sqrt(Math.pow(r-t,2)+Math.pow(n-e,2));return{type:"line",path:`M ${t} ${e} L ${r} ${n}`,geometry:{type:"line",length:o,endpoints:[[t,e],[r,n]]}}}function vn(t,e,r,n){const o=xr(t,e,r,n);return Math.sqrt(Math.pow(o[0]-r,2)+Math.pow(o[1]-n,2))}function gu(t,e,r,n){if("CSQTAcsgta".includes(t))return xr(t,e,r,n);let o=r,i=n;const a=t===t.toLowerCase(),l=e.length;switch(t.toUpperCase()){case"M":case"L":l>=2&&(o=e[l-2],i=e[l-1],a&&(o+=r,i+=n));break;case"H":l>=1&&(o=e[l-1],a&&(o+=r),i=n);break;case"V":l>=1&&(o=r,i=e[l-1],a&&(i+=n));break;case"Z":o=r,i=n;break}return[o,i]}function xr(t,e,r,n){const o=t===t.toLowerCase();let i=r,a=n;const l=e.length;switch(t.toUpperCase()){case"C":l>=6&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"S":case"Q":l>=4&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"T":l>=2&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"A":l>=7&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break}return[i,a]}function w0(t){let e=1/0,r=1/0,n=-1/0,o=-1/0,i=!1;const a=(c,h)=>{typeof c=="number"&&typeof h=="number"&&!isNaN(c)&&!isNaN(h)&&(e=Math.min(e,c),r=Math.min(r,h),n=Math.max(n,c),o=Math.max(o,h),i=!0)};for(const c of t){if(!c||!c.geometry)continue;const h=c.geometry;switch(h.type){case"line":h.endpoints&&h.endpoints.length===2&&(a(h.endpoints[0][0],h.endpoints[0][1]),a(h.endpoints[1][0],h.endpoints[1][1]));break;case"circle":h.center&&typeof h.radius=="number"&&(a(h.center[0]-h.radius,h.center[1]-h.radius),a(h.center[0]+h.radius,h.center[1]+h.radius));break;case"arc":case"curve":h.endpoints&&h.endpoints.length===2&&(a(h.endpoints[0][0],h.endpoints[0][1]),a(h.endpoints[1][0],h.endpoints[1][1]));break}}if(!i)return console.warn("[TECH_DRAW_WORKER] Could not determine bounding box from paths geometry."),null;const l=0;return{minX:e-l,minY:r-l,maxX:n+l,maxY:o+l}}async function _0(t,e){console.log(`[TECH_DRAW_WORKER] Generating projections for: ${t}`),console.time(`[PERF_TD] Total ${t} projections creation`),await Nl,console.log(`[TECH_DRAW_WORKER] OpenCascade ready for ${t}`),console.time(`[PERF_TD] Base model creation ${t}`);const r=Gl(t,e);if(console.timeEnd(`[PERF_TD] Base model creation ${t}`),!r||r.error)return console.error(`[TECH_DRAW_WORKER] Base model creation failed for ${t}:`,r==null?void 0:r.validationErrors),console.timeEnd(`[PERF_TD] Total ${t} projections creation`),{error:!0,validationErrors:(r==null?void 0:r.validationErrors)||["Model creation failed."]};console.log(`[TECH_DRAW_WORKER] Base model created for ${t}.`);let n;try{console.time(`[PERF_TD] createOrthographicProjections ${t}`),n=d0(r),console.timeEnd(`[PERF_TD] createOrthographicProjections ${t}`),console.log(`[TECH_DRAW_WORKER] Raw projections generated for ${t}.`)}catch(i){return console.error(`[TECH_DRAW_WORKER] Error during createOrthographicProjections for ${t}:`,i),console.timeEnd(`[PERF_TD] Total ${t} projections creation`),{error:!0,message:`Orthographic projection failed: ${i.message}`}}let o;try{console.time(`[PERF_TD] processProjectionsForRendering ${t}`),o=v0(n),console.timeEnd(`[PERF_TD] processProjectionsForRendering ${t}`),console.log(`[TECH_DRAW_WORKER] Projections processed for rendering for ${t}.`)}catch(i){return console.error(`[TECH_DRAW_WORKER] Error during processProjectionsForRendering for ${t}:`,i),console.timeEnd(`[PERF_TD] Total ${t} projections creation`),{error:!0,message:`Projection processing failed: ${i.message}`}}if(r&&r.componentData){const i=r.componentData.map(a=>({id:a.id,name:a.name,quantity:a.quantity,dimensions:a.dimensions,material:a.material}));o.componentData=i,console.log(`[TECH_DRAW_WORKER] Added component data for ${t}.`)}return console.timeEnd(`[PERF_TD] Total ${t} projections creation`),console.log(`[TECH_DRAW_WORKER] Successfully generated projections for ${t}.`),o}const b0=async(t,e,r,n,o=null)=>{console.log(`[TECH_DRAW_WORKER] Generating single projection: Model='${t}', Part='${o||"Whole"}', View='${r}', Hidden=${n}`),console.time(`[PERF_TD_SINGLE] Total ${t} ${o||"Whole"} ${r} projection`),await Nl,console.time(`[PERF_TD_SINGLE] Base model creation ${t}`);const i=Gl(t,e);if(console.timeEnd(`[PERF_TD_SINGLE] Base model creation ${t}`),!i||i.error)return console.error("[TECH_DRAW_WORKER] Base model creation failed for single projection:",i==null?void 0:i.validationErrors),console.timeEnd(`[PERF_TD_SINGLE] Total ${t} ${o||"Whole"} ${r} projection`),{error:!0,validationErrors:(i==null?void 0:i.validationErrors)||["Model creation failed."]};let a;if(o){if(!i.technicalDrawingModels||!i.technicalDrawingModels[o]){const C=`Part '${o}' not found in technicalDrawingModels for model '${t}'.`;return console.error(`[TECH_DRAW_WORKER] ${C}`),console.timeEnd(`[PERF_TD_SINGLE] Total ${t} ${o} ${r} projection`),{error:!0,message:C}}a=En(i.technicalDrawingModels[o]),console.log(`[TECH_DRAW_WORKER] Projecting specific part: ${o}`)}else a=En(i),console.log("[TECH_DRAW_WORKER] Projecting whole model.");let l;try{console.time(`[PERF_TD_SINGLE] drawProjection ${t} ${o||"Whole"} ${r}`),l=ft(a,r.toLowerCase()),console.timeEnd(`[PERF_TD_SINGLE] drawProjection ${t} ${o||"Whole"} ${r}`)}catch(C){return console.error(`[TECH_DRAW_WORKER] Error during drawProjection for ${t} ${o||"Whole"} ${r}:`,C),console.timeEnd(`[PERF_TD_SINGLE] Total ${t} ${o||"Whole"} ${r} projection`),{error:!0,message:`Drawing projection failed: ${C.message}`}}const c=l.visible.toSVGPaths(),h=n?l.hidden.toSVGPaths():[],d=`single_${o?o.replace(/\s+/g,"_")+"_":""}${r}`;console.time(`[PERF_TD_SINGLE] normalizePaths ${t} ${o||"Whole"} ${r}`);const g=Qr(c,`${d}_visible`,0,0),v=n?Qr(h,`${d}_hidden`,0,0):[];console.timeEnd(`[PERF_TD_SINGLE] normalizePaths ${t} ${o||"Whole"} ${r}`);const w=[...g,...v],E=l.visible.toSVGViewBox(5),T=w0(w);return T?console.log("[TECH_DRAW_WORKER] Calculated geometryBoundingBox:",T):console.warn(`[TECH_DRAW_WORKER] Failed to calculate geometryBoundingBox for ${t} ${o||"Whole"} ${r}. PDF measurements might be incorrect.`),console.timeEnd(`[PERF_TD_SINGLE] Total ${t} ${o||"Whole"} ${r} projection`),console.log(`[TECH_DRAW_WORKER] Successfully generated single projection for ${t} ${o||"Whole"} ${r}.`),{error:!1,paths:w,viewBox:E,geometryBoundingBox:T}};Bs({generateProjections:_0,generateSingleProjection:b0})});export default S0();
