(function(){"use strict";var sl=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(s,u){n=s,o=u});var i=Object.assign({},r),a="./this.program",l=(s,u)=>{throw u},c=typeof window=="object",h=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function v(s){return r.locateFile?r.locateFile(s,g):g+s}var b,T,C;function x(s){if(s instanceof Hi)return;V("exiting due to exception: "+s)}var A,F,M;d?(h?g=require("path").dirname(g)+"/":g=__dirname+"/",M=()=>{F||(A=require("fs"),F=require("path"))},b=function(u,f){return M(),u=F.normalize(u),A.readFileSync(u,f?void 0:"utf8")},C=s=>{var u=b(s,!0);return u.buffer||(u=new Uint8Array(u)),u},T=(s,u,f)=>{M(),s=F.normalize(s),A.readFile(s,function(p,m){p?f(p):u(m.buffer)})},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(s){if(!(s instanceof Hi))throw s}),process.on("unhandledRejection",function(s){throw s}),l=(s,u)=>{if(Ou())throw process.exitCode=s,u;x(u),process.exit(s)},r.inspect=function(){return"[Emscripten Module object]"}):(c||h)&&(h?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",b=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.send(null),u.responseText},h&&(C=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),T=(s,u,f)=>{var p=new XMLHttpRequest;p.open("GET",s,!0),p.responseType="arraybuffer",p.onload=()=>{if(p.status==200||p.status==0&&p.response){u(p.response);return}f()},p.onerror=f,p.send(null)});var $=r.print||console.log.bind(console),V=r.printErr||console.warn.bind(console);Object.assign(r,i),i=null,r.arguments&&r.arguments,r.thisProgram&&(a=r.thisProgram),r.quit&&(l=r.quit);var q=4,X;r.wasmBinary&&(X=r.wasmBinary);var Z=r.noExitRuntime||!0;typeof WebAssembly!="object"&&tr("no native wasm support detected");var se,be=!1;function Se(s,u){s||tr(u)}var _e=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function xe(s,u,f){for(var p=u+f,m=u;s[m]&&!(m>=p);)++m;if(m-u>16&&s.buffer&&_e)return _e.decode(s.subarray(u,m));for(var w="";u<m;){var S=s[u++];if(!(S&128)){w+=String.fromCharCode(S);continue}var _=s[u++]&63;if((S&224)==192){w+=String.fromCharCode((S&31)<<6|_);continue}var E=s[u++]&63;if((S&240)==224?S=(S&15)<<12|_<<6|E:S=(S&7)<<18|_<<12|E<<6|s[u++]&63,S<65536)w+=String.fromCharCode(S);else{var P=S-65536;w+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return w}function re(s,u){return s?xe(Re,s,u):""}function ce(s,u,f,p){if(!(p>0))return 0;for(var m=f,w=f+p-1,S=0;S<s.length;++S){var _=s.charCodeAt(S);if(_>=55296&&_<=57343){var E=s.charCodeAt(++S);_=65536+((_&1023)<<10)|E&1023}if(_<=127){if(f>=w)break;u[f++]=_}else if(_<=2047){if(f+1>=w)break;u[f++]=192|_>>6,u[f++]=128|_&63}else if(_<=65535){if(f+2>=w)break;u[f++]=224|_>>12,u[f++]=128|_>>6&63,u[f++]=128|_&63}else{if(f+3>=w)break;u[f++]=240|_>>18,u[f++]=128|_>>12&63,u[f++]=128|_>>6&63,u[f++]=128|_&63}}return u[f]=0,f-m}function ye(s,u,f){return ce(s,Re,u,f)}function ae(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&(p=65536+((p&1023)<<10)|s.charCodeAt(++f)&1023),p<=127?++u:p<=2047?u+=2:p<=65535?u+=3:u+=4}return u}var te=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function le(s,u){for(var f=s,p=f>>1,m=p+u/2;!(p>=m)&&dt[p];)++p;if(f=p<<1,f-s>32&&te)return te.decode(Re.subarray(s,f));for(var w="",S=0;!(S>=u/2);++S){var _=Oe[s+S*2>>1];if(_==0)break;w+=String.fromCharCode(_)}return w}function we(s,u,f){if(f===void 0&&(f=2147483647),f<2)return 0;f-=2;for(var p=u,m=f<s.length*2?f/2:s.length,w=0;w<m;++w){var S=s.charCodeAt(w);Oe[u>>1]=S,u+=2}return Oe[u>>1]=0,u-p}function fe(s){return s.length*2}function Ce(s,u){for(var f=0,p="";!(f>=u/4);){var m=U[s+f*4>>2];if(m==0)break;if(++f,m>=65536){var w=m-65536;p+=String.fromCharCode(55296|w>>10,56320|w&1023)}else p+=String.fromCharCode(m)}return p}function _t(s,u,f){if(f===void 0&&(f=2147483647),f<4)return 0;for(var p=u,m=p+f-4,w=0;w<s.length;++w){var S=s.charCodeAt(w);if(S>=55296&&S<=57343){var _=s.charCodeAt(++w);S=65536+((S&1023)<<10)|_&1023}if(U[u>>2]=S,u+=4,u+4>m)break}return U[u>>2]=0,u-p}function Lt(s){for(var u=0,f=0;f<s.length;++f){var p=s.charCodeAt(f);p>=55296&&p<=57343&&++f,u+=4}return u}function Tt(s){var u=ae(s)+1,f=Nt(u);return f&&ce(s,ge,f,u),f}function er(s,u){ge.set(s,u)}function Lr(s,u,f){for(var p=0;p<s.length;++p)ge[u++>>0]=s.charCodeAt(p);f||(ge[u>>0]=0)}var pt,ge,Re,Oe,dt,U,ue,vt,xu;function Cu(s){pt=s,r.HEAP8=ge=new Int8Array(s),r.HEAP16=Oe=new Int16Array(s),r.HEAP32=U=new Int32Array(s),r.HEAPU8=Re=new Uint8Array(s),r.HEAPU16=dt=new Uint16Array(s),r.HEAPU32=ue=new Uint32Array(s),r.HEAPF32=vt=new Float32Array(s),r.HEAPF64=xu=new Float64Array(s)}r.INITIAL_MEMORY;var ku,Pu=[],Au=[],Ru=[];function Ou(){return Z}function xv(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Pv(r.preRun.shift());Ci(Pu)}function Cv(){!r.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,Ci(Au)}function kv(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Rv(r.postRun.shift());Ci(Ru)}function Pv(s){Pu.unshift(s)}function Av(s){Au.unshift(s)}function Rv(s){Ru.unshift(s)}var vr=0,dn=null;function a0(s){return s}function xi(s){vr++,r.monitorRunDependencies&&r.monitorRunDependencies(vr)}function uo(s){if(vr--,r.monitorRunDependencies&&r.monitorRunDependencies(vr),vr==0&&dn){var u=dn;dn=null,u()}}function tr(s){r.onAbort&&r.onAbort(s),s="Aborted("+s+")",V(s),be=!0,s+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(s);throw o(u),u}var Ov="data:application/octet-stream;base64,";function Mu(s){return s.startsWith(Ov)}function Du(s){return s.startsWith("file://")}var Ke;Ke="replicad_single.wasm",Mu(Ke)||(Ke=v(Ke));function Fu(s){try{if(s==Ke&&X)return new Uint8Array(X);if(C)return C(s);throw"both async and sync fetching of the wasm failed"}catch(u){tr(u)}}function Mv(){if(!X&&(c||h)){if(typeof fetch=="function"&&!Du(Ke))return fetch(Ke,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+Ke+"'";return s.arrayBuffer()}).catch(function(){return Fu(Ke)});if(T)return new Promise(function(s,u){T(Ke,function(f){s(new Uint8Array(f))},u)})}return Promise.resolve().then(function(){return Fu(Ke)})}function Dv(){var s={a:n0};function u(S,_){var E=S.exports;r.asm=E,se=r.asm.oa,Cu(se.buffer),ku=r.asm.va,Av(r.asm.pa),uo()}xi();function f(S){u(S.instance)}function p(S){return Mv().then(function(_){return WebAssembly.instantiate(_,s)}).then(function(_){return _}).then(S,function(_){V("failed to asynchronously prepare wasm: "+_),tr(_)})}function m(){return!X&&typeof WebAssembly.instantiateStreaming=="function"&&!Mu(Ke)&&!Du(Ke)&&!d&&typeof fetch=="function"?fetch(Ke,{credentials:"same-origin"}).then(function(S){var _=WebAssembly.instantiateStreaming(S,s);return _.then(f,function(E){return V("wasm streaming compile failed: "+E),V("falling back to ArrayBuffer instantiation"),p(f)})}):p(f)}if(r.instantiateWasm)try{var w=r.instantiateWasm(s,u);return w}catch(S){return V("Module.instantiateWasm callback failed with error: "+S),!1}return m().catch(o),{}}var ze,Bt;function Fv(){return r.HEAP8.length}function Ci(s){for(;s.length>0;){var u=s.shift();if(typeof u=="function"){u(r);continue}var f=u.func;typeof f=="number"?u.arg===void 0?co(f)():co(f)(u.arg):f(u.arg===void 0?null:u.arg)}}var lo=[];function co(s){var u=lo[s];return u||(s>=lo.length&&(lo.length=s+1),lo[s]=u=ku.get(s)),u}function Lv(s,u,f,p){tr("Assertion failed: "+re(s)+", at: "+[u?re(u):"unknown filename",f,p?re(p):"unknown function"])}function Bv(s){return Nt(s+24)+24}function Uv(s){this.excPtr=s,this.ptr=s-24,this.set_type=function(u){ue[this.ptr+4>>2]=u},this.get_type=function(){return ue[this.ptr+4>>2]},this.set_destructor=function(u){ue[this.ptr+8>>2]=u},this.get_destructor=function(){return ue[this.ptr+8>>2]},this.set_refcount=function(u){U[this.ptr>>2]=u},this.set_caught=function(u){u=u?1:0,ge[this.ptr+12>>0]=u},this.get_caught=function(){return ge[this.ptr+12>>0]!=0},this.set_rethrown=function(u){u=u?1:0,ge[this.ptr+13>>0]=u},this.get_rethrown=function(){return ge[this.ptr+13>>0]!=0},this.init=function(u,f){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(f),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var u=U[this.ptr>>2];U[this.ptr>>2]=u+1},this.release_ref=function(){var u=U[this.ptr>>2];return U[this.ptr>>2]=u-1,u===1},this.set_adjusted_ptr=function(u){ue[this.ptr+16>>2]=u},this.get_adjusted_ptr=function(){return ue[this.ptr+16>>2]},this.get_exception_ptr=function(){var u=il(this.get_type());if(u)return ue[this.excPtr>>2];var f=this.get_adjusted_ptr();return f!==0?f:this.excPtr}}function Iv(s,u,f){var p=new Uv(s);throw p.init(u,f),s}var he={isAbs:s=>s.charAt(0)==="/",splitPath:s=>{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return u.exec(s).slice(1)},normalizeArray:(s,u)=>{for(var f=0,p=s.length-1;p>=0;p--){var m=s[p];m==="."?s.splice(p,1):m===".."?(s.splice(p,1),f++):f&&(s.splice(p,1),f--)}if(u)for(;f;f--)s.unshift("..");return s},normalize:s=>{var u=he.isAbs(s),f=s.substr(-1)==="/";return s=he.normalizeArray(s.split("/").filter(p=>!!p),!u).join("/"),!s&&!u&&(s="."),s&&f&&(s+="/"),(u?"/":"")+s},dirname:s=>{var u=he.splitPath(s),f=u[0],p=u[1];return!f&&!p?".":(p&&(p=p.substr(0,p.length-1)),f+p)},basename:s=>{if(s==="/")return"/";s=he.normalize(s),s=s.replace(/\/$/,"");var u=s.lastIndexOf("/");return u===-1?s:s.substr(u+1)},join:function(){var s=Array.prototype.slice.call(arguments,0);return he.normalize(s.join("/"))},join2:(s,u)=>he.normalize(s+"/"+u)};function Gv(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var s=new Uint8Array(1);return function(){return crypto.getRandomValues(s),s[0]}}else if(d)try{var u=require("crypto");return function(){return u.randomBytes(1)[0]}}catch{}return function(){tr("randomDevice")}}var Ut={resolve:function(){for(var s="",u=!1,f=arguments.length-1;f>=-1&&!u;f--){var p=f>=0?arguments[f]:y.cwd();if(typeof p!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!p)return"";s=p+"/"+s,u=he.isAbs(p)}return s=he.normalizeArray(s.split("/").filter(m=>!!m),!u).join("/"),(u?"/":"")+s||"."},relative:(s,u)=>{s=Ut.resolve(s).substr(1),u=Ut.resolve(u).substr(1);function f(P){for(var L=0;L<P.length&&P[L]==="";L++);for(var B=P.length-1;B>=0&&P[B]==="";B--);return L>B?[]:P.slice(L,B-L+1)}for(var p=f(s.split("/")),m=f(u.split("/")),w=Math.min(p.length,m.length),S=w,_=0;_<w;_++)if(p[_]!==m[_]){S=_;break}for(var E=[],_=S;_<p.length;_++)E.push("..");return E=E.concat(m.slice(S)),E.join("/")}},gr={ttys:[],init:function(){},shutdown:function(){},register:function(s,u){gr.ttys[s]={input:[],output:[],ops:u},y.registerDevice(s,gr.stream_ops)},stream_ops:{open:function(s){var u=gr.ttys[s.node.rdev];if(!u)throw new y.ErrnoError(43);s.tty=u,s.seekable=!1},close:function(s){s.tty.ops.flush(s.tty)},flush:function(s){s.tty.ops.flush(s.tty)},read:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.get_char)throw new y.ErrnoError(60);for(var w=0,S=0;S<p;S++){var _;try{_=s.tty.ops.get_char(s.tty)}catch{throw new y.ErrnoError(29)}if(_===void 0&&w===0)throw new y.ErrnoError(6);if(_==null)break;w++,u[f+S]=_}return w&&(s.node.timestamp=Date.now()),w},write:function(s,u,f,p,m){if(!s.tty||!s.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var w=0;w<p;w++)s.tty.ops.put_char(s.tty,u[f+w])}catch{throw new y.ErrnoError(29)}return p&&(s.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(s){if(!s.input.length){var u=null;if(d){var f=256,p=Buffer.alloc(f),m=0;try{m=A.readSync(process.stdin.fd,p,0,f,-1)}catch(w){if(w.toString().includes("EOF"))m=0;else throw w}m>0?u=p.slice(0,m).toString("utf-8"):u=null}else typeof window<"u"&&typeof window.prompt=="function"?(u=window.prompt("Input: "),u!==null&&(u+=`
`)):typeof readline=="function"&&(u=readline(),u!==null&&(u+=`
`));if(!u)return null;s.input=Co(u,!0)}return s.input.shift()},put_char:function(s,u){u===null||u===10?($(xe(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&($(xe(s.output,0)),s.output=[])}},default_tty1_ops:{put_char:function(s,u){u===null||u===10?(V(xe(s.output,0)),s.output=[]):u!=0&&s.output.push(u)},flush:function(s){s.output&&s.output.length>0&&(V(xe(s.output,0)),s.output=[])}}};function Nv(s,u){Re.fill(0,s,s+u)}function Vv(s,u){return Math.ceil(s/u)*u}function Lu(s){s=Vv(s,65536);var u=ol(65536,s);return u?(Nv(u,s),u):0}var ee={ops_table:null,mount:function(s){return ee.createNode(null,"/",16895,0)},createNode:function(s,u,f,p){if(y.isBlkdev(f)||y.isFIFO(f))throw new y.ErrnoError(63);ee.ops_table||(ee.ops_table={dir:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,lookup:ee.node_ops.lookup,mknod:ee.node_ops.mknod,rename:ee.node_ops.rename,unlink:ee.node_ops.unlink,rmdir:ee.node_ops.rmdir,readdir:ee.node_ops.readdir,symlink:ee.node_ops.symlink},stream:{llseek:ee.stream_ops.llseek}},file:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:{llseek:ee.stream_ops.llseek,read:ee.stream_ops.read,write:ee.stream_ops.write,allocate:ee.stream_ops.allocate,mmap:ee.stream_ops.mmap,msync:ee.stream_ops.msync}},link:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,readlink:ee.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:y.chrdev_stream_ops}});var m=y.createNode(s,u,f,p);return y.isDir(m.mode)?(m.node_ops=ee.ops_table.dir.node,m.stream_ops=ee.ops_table.dir.stream,m.contents={}):y.isFile(m.mode)?(m.node_ops=ee.ops_table.file.node,m.stream_ops=ee.ops_table.file.stream,m.usedBytes=0,m.contents=null):y.isLink(m.mode)?(m.node_ops=ee.ops_table.link.node,m.stream_ops=ee.ops_table.link.stream):y.isChrdev(m.mode)&&(m.node_ops=ee.ops_table.chrdev.node,m.stream_ops=ee.ops_table.chrdev.stream),m.timestamp=Date.now(),s&&(s.contents[u]=m,s.timestamp=m.timestamp),m},getFileDataAsTypedArray:function(s){return s.contents?s.contents.subarray?s.contents.subarray(0,s.usedBytes):new Uint8Array(s.contents):new Uint8Array(0)},expandFileStorage:function(s,u){var f=s.contents?s.contents.length:0;if(!(f>=u)){var p=1024*1024;u=Math.max(u,f*(f<p?2:1.125)>>>0),f!=0&&(u=Math.max(u,256));var m=s.contents;s.contents=new Uint8Array(u),s.usedBytes>0&&s.contents.set(m.subarray(0,s.usedBytes),0)}},resizeFileStorage:function(s,u){if(s.usedBytes!=u)if(u==0)s.contents=null,s.usedBytes=0;else{var f=s.contents;s.contents=new Uint8Array(u),f&&s.contents.set(f.subarray(0,Math.min(u,s.usedBytes))),s.usedBytes=u}},node_ops:{getattr:function(s){var u={};return u.dev=y.isChrdev(s.mode)?s.id:1,u.ino=s.id,u.mode=s.mode,u.nlink=1,u.uid=0,u.gid=0,u.rdev=s.rdev,y.isDir(s.mode)?u.size=4096:y.isFile(s.mode)?u.size=s.usedBytes:y.isLink(s.mode)?u.size=s.link.length:u.size=0,u.atime=new Date(s.timestamp),u.mtime=new Date(s.timestamp),u.ctime=new Date(s.timestamp),u.blksize=4096,u.blocks=Math.ceil(u.size/u.blksize),u},setattr:function(s,u){u.mode!==void 0&&(s.mode=u.mode),u.timestamp!==void 0&&(s.timestamp=u.timestamp),u.size!==void 0&&ee.resizeFileStorage(s,u.size)},lookup:function(s,u){throw y.genericErrors[44]},mknod:function(s,u,f,p){return ee.createNode(s,u,f,p)},rename:function(s,u,f){if(y.isDir(s.mode)){var p;try{p=y.lookupNode(u,f)}catch{}if(p)for(var m in p.contents)throw new y.ErrnoError(55)}delete s.parent.contents[s.name],s.parent.timestamp=Date.now(),s.name=f,u.contents[f]=s,u.timestamp=s.parent.timestamp,s.parent=u},unlink:function(s,u){delete s.contents[u],s.timestamp=Date.now()},rmdir:function(s,u){var f=y.lookupNode(s,u);for(var p in f.contents)throw new y.ErrnoError(55);delete s.contents[u],s.timestamp=Date.now()},readdir:function(s){var u=[".",".."];for(var f in s.contents)s.contents.hasOwnProperty(f)&&u.push(f);return u},symlink:function(s,u,f){var p=ee.createNode(s,u,41471,0);return p.link=f,p},readlink:function(s){if(!y.isLink(s.mode))throw new y.ErrnoError(28);return s.link}},stream_ops:{read:function(s,u,f,p,m){var w=s.node.contents;if(m>=s.node.usedBytes)return 0;var S=Math.min(s.node.usedBytes-m,p);if(S>8&&w.subarray)u.set(w.subarray(m,m+S),f);else for(var _=0;_<S;_++)u[f+_]=w[m+_];return S},write:function(s,u,f,p,m,w){if(u.buffer===ge.buffer&&(w=!1),!p)return 0;var S=s.node;if(S.timestamp=Date.now(),u.subarray&&(!S.contents||S.contents.subarray)){if(w)return S.contents=u.subarray(f,f+p),S.usedBytes=p,p;if(S.usedBytes===0&&m===0)return S.contents=u.slice(f,f+p),S.usedBytes=p,p;if(m+p<=S.usedBytes)return S.contents.set(u.subarray(f,f+p),m),p}if(ee.expandFileStorage(S,m+p),S.contents.subarray&&u.subarray)S.contents.set(u.subarray(f,f+p),m);else for(var _=0;_<p;_++)S.contents[m+_]=u[f+_];return S.usedBytes=Math.max(S.usedBytes,m+p),p},llseek:function(s,u,f){var p=u;if(f===1?p+=s.position:f===2&&y.isFile(s.node.mode)&&(p+=s.node.usedBytes),p<0)throw new y.ErrnoError(28);return p},allocate:function(s,u,f){ee.expandFileStorage(s.node,u+f),s.node.usedBytes=Math.max(s.node.usedBytes,u+f)},mmap:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);var w,S,_=s.node.contents;if(!(m&2)&&_.buffer===pt)S=!1,w=_.byteOffset;else{if((f>0||f+u<_.length)&&(_.subarray?_=_.subarray(f,f+u):_=Array.prototype.slice.call(_,f,f+u)),S=!0,w=Lu(u),!w)throw new y.ErrnoError(48);ge.set(_,w)}return{ptr:w,allocated:S}},msync:function(s,u,f,p,m){if(!y.isFile(s.node.mode))throw new y.ErrnoError(43);return m&2||ee.stream_ops.write(s,u,0,p,f,!1),0}}};function Hv(s,u,f,p){var m=p?"":"al "+s;T(s,function(w){Se(w,'Loading data file "'+s+'" failed (no arrayBuffer).'),u(new Uint8Array(w)),m&&uo()},function(w){if(f)f();else throw'Loading data file "'+s+'" failed.'}),m&&xi()}var y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(s,u={})=>{if(s=Ut.resolve(y.cwd(),s),!s)return{path:"",node:null};var f={follow_mount:!0,recurse_count:0};if(u=Object.assign(f,u),u.recurse_count>8)throw new y.ErrnoError(32);for(var p=he.normalizeArray(s.split("/").filter(B=>!!B),!1),m=y.root,w="/",S=0;S<p.length;S++){var _=S===p.length-1;if(_&&u.parent)break;if(m=y.lookupNode(m,p[S]),w=he.join2(w,p[S]),y.isMountpoint(m)&&(!_||_&&u.follow_mount)&&(m=m.mounted.root),!_||u.follow)for(var E=0;y.isLink(m.mode);){var P=y.readlink(w);w=Ut.resolve(he.dirname(w),P);var L=y.lookupPath(w,{recurse_count:u.recurse_count+1});if(m=L.node,E++>40)throw new y.ErrnoError(32)}}return{path:w,node:m}},getPath:s=>{for(var u;;){if(y.isRoot(s)){var f=s.mount.mountpoint;return u?f[f.length-1]!=="/"?f+"/"+u:f+u:f}u=u?s.name+"/"+u:s.name,s=s.parent}},hashName:(s,u)=>{for(var f=0,p=0;p<u.length;p++)f=(f<<5)-f+u.charCodeAt(p)|0;return(s+f>>>0)%y.nameTable.length},hashAddNode:s=>{var u=y.hashName(s.parent.id,s.name);s.name_next=y.nameTable[u],y.nameTable[u]=s},hashRemoveNode:s=>{var u=y.hashName(s.parent.id,s.name);if(y.nameTable[u]===s)y.nameTable[u]=s.name_next;else for(var f=y.nameTable[u];f;){if(f.name_next===s){f.name_next=s.name_next;break}f=f.name_next}},lookupNode:(s,u)=>{var f=y.mayLookup(s);if(f)throw new y.ErrnoError(f,s);for(var p=y.hashName(s.id,u),m=y.nameTable[p];m;m=m.name_next){var w=m.name;if(m.parent.id===s.id&&w===u)return m}return y.lookup(s,u)},createNode:(s,u,f,p)=>{var m=new y.FSNode(s,u,f,p);return y.hashAddNode(m),m},destroyNode:s=>{y.hashRemoveNode(s)},isRoot:s=>s===s.parent,isMountpoint:s=>!!s.mounted,isFile:s=>(s&61440)===32768,isDir:s=>(s&61440)===16384,isLink:s=>(s&61440)===40960,isChrdev:s=>(s&61440)===8192,isBlkdev:s=>(s&61440)===24576,isFIFO:s=>(s&61440)===4096,isSocket:s=>(s&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:s=>{var u=y.flagModes[s];if(typeof u>"u")throw new Error("Unknown file open mode: "+s);return u},flagsToPermissionString:s=>{var u=["r","w","rw"][s&3];return s&512&&(u+="w"),u},nodePermissions:(s,u)=>y.ignorePermissions?0:u.includes("r")&&!(s.mode&292)||u.includes("w")&&!(s.mode&146)||u.includes("x")&&!(s.mode&73)?2:0,mayLookup:s=>{var u=y.nodePermissions(s,"x");return u||(s.node_ops.lookup?0:2)},mayCreate:(s,u)=>{try{var f=y.lookupNode(s,u);return 20}catch{}return y.nodePermissions(s,"wx")},mayDelete:(s,u,f)=>{var p;try{p=y.lookupNode(s,u)}catch(w){return w.errno}var m=y.nodePermissions(s,"wx");if(m)return m;if(f){if(!y.isDir(p.mode))return 54;if(y.isRoot(p)||y.getPath(p)===y.cwd())return 10}else if(y.isDir(p.mode))return 31;return 0},mayOpen:(s,u)=>s?y.isLink(s.mode)?32:y.isDir(s.mode)&&(y.flagsToPermissionString(u)!=="r"||u&512)?31:y.nodePermissions(s,y.flagsToPermissionString(u)):44,MAX_OPEN_FDS:4096,nextfd:(s=0,u=y.MAX_OPEN_FDS)=>{for(var f=s;f<=u;f++)if(!y.streams[f])return f;throw new y.ErrnoError(33)},getStream:s=>y.streams[s],createStream:(s,u,f)=>{y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get:function(){return this.node},set:function(m){this.node=m}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(m){this.shared.flags=m}},position:{get:function(){return this.shared.position},set:function(m){this.shared.position=m}}})),s=Object.assign(new y.FSStream,s);var p=y.nextfd(u,f);return s.fd=p,y.streams[p]=s,s},closeStream:s=>{y.streams[s]=null},chrdev_stream_ops:{open:s=>{var u=y.getDevice(s.node.rdev);s.stream_ops=u.stream_ops,s.stream_ops.open&&s.stream_ops.open(s)},llseek:()=>{throw new y.ErrnoError(70)}},major:s=>s>>8,minor:s=>s&255,makedev:(s,u)=>s<<8|u,registerDevice:(s,u)=>{y.devices[s]={stream_ops:u}},getDevice:s=>y.devices[s],getMounts:s=>{for(var u=[],f=[s];f.length;){var p=f.pop();u.push(p),f.push.apply(f,p.mounts)}return u},syncfs:(s,u)=>{typeof s=="function"&&(u=s,s=!1),y.syncFSRequests++,y.syncFSRequests>1&&V("warning: "+y.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var f=y.getMounts(y.root.mount),p=0;function m(S){return y.syncFSRequests--,u(S)}function w(S){if(S)return w.errored?void 0:(w.errored=!0,m(S));++p>=f.length&&m(null)}f.forEach(S=>{if(!S.type.syncfs)return w(null);S.type.syncfs(S,s,w)})},mount:(s,u,f)=>{var p=f==="/",m=!f,w;if(p&&y.root)throw new y.ErrnoError(10);if(!p&&!m){var S=y.lookupPath(f,{follow_mount:!1});if(f=S.path,w=S.node,y.isMountpoint(w))throw new y.ErrnoError(10);if(!y.isDir(w.mode))throw new y.ErrnoError(54)}var _={type:s,opts:u,mountpoint:f,mounts:[]},E=s.mount(_);return E.mount=_,_.root=E,p?y.root=E:w&&(w.mounted=_,w.mount&&w.mount.mounts.push(_)),E},unmount:s=>{var u=y.lookupPath(s,{follow_mount:!1});if(!y.isMountpoint(u.node))throw new y.ErrnoError(28);var f=u.node,p=f.mounted,m=y.getMounts(p);Object.keys(y.nameTable).forEach(S=>{for(var _=y.nameTable[S];_;){var E=_.name_next;m.includes(_.mount)&&y.destroyNode(_),_=E}}),f.mounted=null;var w=f.mount.mounts.indexOf(p);f.mount.mounts.splice(w,1)},lookup:(s,u)=>s.node_ops.lookup(s,u),mknod:(s,u,f)=>{var p=y.lookupPath(s,{parent:!0}),m=p.node,w=he.basename(s);if(!w||w==="."||w==="..")throw new y.ErrnoError(28);var S=y.mayCreate(m,w);if(S)throw new y.ErrnoError(S);if(!m.node_ops.mknod)throw new y.ErrnoError(63);return m.node_ops.mknod(m,w,u,f)},create:(s,u)=>(u=u!==void 0?u:438,u&=4095,u|=32768,y.mknod(s,u,0)),mkdir:(s,u)=>(u=u!==void 0?u:511,u&=1023,u|=16384,y.mknod(s,u,0)),mkdirTree:(s,u)=>{for(var f=s.split("/"),p="",m=0;m<f.length;++m)if(f[m]){p+="/"+f[m];try{y.mkdir(p,u)}catch(w){if(w.errno!=20)throw w}}},mkdev:(s,u,f)=>(typeof f>"u"&&(f=u,u=438),u|=8192,y.mknod(s,u,f)),symlink:(s,u)=>{if(!Ut.resolve(s))throw new y.ErrnoError(44);var f=y.lookupPath(u,{parent:!0}),p=f.node;if(!p)throw new y.ErrnoError(44);var m=he.basename(u),w=y.mayCreate(p,m);if(w)throw new y.ErrnoError(w);if(!p.node_ops.symlink)throw new y.ErrnoError(63);return p.node_ops.symlink(p,m,s)},rename:(s,u)=>{var f=he.dirname(s),p=he.dirname(u),m=he.basename(s),w=he.basename(u),S,_,E;if(S=y.lookupPath(s,{parent:!0}),_=S.node,S=y.lookupPath(u,{parent:!0}),E=S.node,!_||!E)throw new y.ErrnoError(44);if(_.mount!==E.mount)throw new y.ErrnoError(75);var P=y.lookupNode(_,m),L=Ut.relative(s,p);if(L.charAt(0)!==".")throw new y.ErrnoError(28);if(L=Ut.relative(u,f),L.charAt(0)!==".")throw new y.ErrnoError(55);var B;try{B=y.lookupNode(E,w)}catch{}if(P!==B){var D=y.isDir(P.mode),G=y.mayDelete(_,m,D);if(G)throw new y.ErrnoError(G);if(G=B?y.mayDelete(E,w,D):y.mayCreate(E,w),G)throw new y.ErrnoError(G);if(!_.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(P)||B&&y.isMountpoint(B))throw new y.ErrnoError(10);if(E!==_&&(G=y.nodePermissions(_,"w"),G))throw new y.ErrnoError(G);y.hashRemoveNode(P);try{_.node_ops.rename(P,E,w)}catch(Y){throw Y}finally{y.hashAddNode(P)}}},rmdir:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node,p=he.basename(s),m=y.lookupNode(f,p),w=y.mayDelete(f,p,!0);if(w)throw new y.ErrnoError(w);if(!f.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.rmdir(f,p),y.destroyNode(m)},readdir:s=>{var u=y.lookupPath(s,{follow:!0}),f=u.node;if(!f.node_ops.readdir)throw new y.ErrnoError(54);return f.node_ops.readdir(f)},unlink:s=>{var u=y.lookupPath(s,{parent:!0}),f=u.node;if(!f)throw new y.ErrnoError(44);var p=he.basename(s),m=y.lookupNode(f,p),w=y.mayDelete(f,p,!1);if(w)throw new y.ErrnoError(w);if(!f.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(m))throw new y.ErrnoError(10);f.node_ops.unlink(f,p),y.destroyNode(m)},readlink:s=>{var u=y.lookupPath(s),f=u.node;if(!f)throw new y.ErrnoError(44);if(!f.node_ops.readlink)throw new y.ErrnoError(28);return Ut.resolve(y.getPath(f.parent),f.node_ops.readlink(f))},stat:(s,u)=>{var f=y.lookupPath(s,{follow:!u}),p=f.node;if(!p)throw new y.ErrnoError(44);if(!p.node_ops.getattr)throw new y.ErrnoError(63);return p.node_ops.getattr(p)},lstat:s=>y.stat(s,!0),chmod:(s,u,f)=>{var p;if(typeof s=="string"){var m=y.lookupPath(s,{follow:!f});p=m.node}else p=s;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{mode:u&4095|p.mode&-4096,timestamp:Date.now()})},lchmod:(s,u)=>{y.chmod(s,u,!0)},fchmod:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);y.chmod(f.node,u)},chown:(s,u,f,p)=>{var m;if(typeof s=="string"){var w=y.lookupPath(s,{follow:!p});m=w.node}else m=s;if(!m.node_ops.setattr)throw new y.ErrnoError(63);m.node_ops.setattr(m,{timestamp:Date.now()})},lchown:(s,u,f)=>{y.chown(s,u,f,!0)},fchown:(s,u,f)=>{var p=y.getStream(s);if(!p)throw new y.ErrnoError(8);y.chown(p.node,u,f)},truncate:(s,u)=>{if(u<0)throw new y.ErrnoError(28);var f;if(typeof s=="string"){var p=y.lookupPath(s,{follow:!0});f=p.node}else f=s;if(!f.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(f.mode))throw new y.ErrnoError(31);if(!y.isFile(f.mode))throw new y.ErrnoError(28);var m=y.nodePermissions(f,"w");if(m)throw new y.ErrnoError(m);f.node_ops.setattr(f,{size:u,timestamp:Date.now()})},ftruncate:(s,u)=>{var f=y.getStream(s);if(!f)throw new y.ErrnoError(8);if(!(f.flags&2097155))throw new y.ErrnoError(28);y.truncate(f.node,u)},utime:(s,u,f)=>{var p=y.lookupPath(s,{follow:!0}),m=p.node;m.node_ops.setattr(m,{timestamp:Math.max(u,f)})},open:(s,u,f)=>{if(s==="")throw new y.ErrnoError(44);u=typeof u=="string"?y.modeStringToFlags(u):u,f=typeof f>"u"?438:f,u&64?f=f&4095|32768:f=0;var p;if(typeof s=="object")p=s;else{s=he.normalize(s);try{var m=y.lookupPath(s,{follow:!(u&131072)});p=m.node}catch{}}var w=!1;if(u&64)if(p){if(u&128)throw new y.ErrnoError(20)}else p=y.mknod(s,f,0),w=!0;if(!p)throw new y.ErrnoError(44);if(y.isChrdev(p.mode)&&(u&=-513),u&65536&&!y.isDir(p.mode))throw new y.ErrnoError(54);if(!w){var S=y.mayOpen(p,u);if(S)throw new y.ErrnoError(S)}u&512&&!w&&y.truncate(p,0),u&=-131713;var _=y.createStream({node:p,path:y.getPath(p),flags:u,seekable:!0,position:0,stream_ops:p.stream_ops,ungotten:[],error:!1});return _.stream_ops.open&&_.stream_ops.open(_),r.logReadFiles&&!(u&1)&&(y.readFiles||(y.readFiles={}),s in y.readFiles||(y.readFiles[s]=1)),_},close:s=>{if(y.isClosed(s))throw new y.ErrnoError(8);s.getdents&&(s.getdents=null);try{s.stream_ops.close&&s.stream_ops.close(s)}catch(u){throw u}finally{y.closeStream(s.fd)}s.fd=null},isClosed:s=>s.fd===null,llseek:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(!s.seekable||!s.stream_ops.llseek)throw new y.ErrnoError(70);if(f!=0&&f!=1&&f!=2)throw new y.ErrnoError(28);return s.position=s.stream_ops.llseek(s,u,f),s.ungotten=[],s.position},read:(s,u,f,p,m)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if((s.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.read)throw new y.ErrnoError(28);var w=typeof m<"u";if(!w)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var S=s.stream_ops.read(s,u,f,p,m);return w||(s.position+=S),S},write:(s,u,f,p,m,w)=>{if(p<0||m<0)throw new y.ErrnoError(28);if(y.isClosed(s))throw new y.ErrnoError(8);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(s.node.mode))throw new y.ErrnoError(31);if(!s.stream_ops.write)throw new y.ErrnoError(28);s.seekable&&s.flags&1024&&y.llseek(s,0,2);var S=typeof m<"u";if(!S)m=s.position;else if(!s.seekable)throw new y.ErrnoError(70);var _=s.stream_ops.write(s,u,f,p,m,w);return S||(s.position+=_),_},allocate:(s,u,f)=>{if(y.isClosed(s))throw new y.ErrnoError(8);if(u<0||f<=0)throw new y.ErrnoError(28);if(!(s.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(s.node.mode)&&!y.isDir(s.node.mode))throw new y.ErrnoError(43);if(!s.stream_ops.allocate)throw new y.ErrnoError(138);s.stream_ops.allocate(s,u,f)},mmap:(s,u,f,p,m)=>{if(p&2&&!(m&2)&&(s.flags&2097155)!==2)throw new y.ErrnoError(2);if((s.flags&2097155)===1)throw new y.ErrnoError(2);if(!s.stream_ops.mmap)throw new y.ErrnoError(43);return s.stream_ops.mmap(s,u,f,p,m)},msync:(s,u,f,p,m)=>!s||!s.stream_ops.msync?0:s.stream_ops.msync(s,u,f,p,m),munmap:s=>0,ioctl:(s,u,f)=>{if(!s.stream_ops.ioctl)throw new y.ErrnoError(59);return s.stream_ops.ioctl(s,u,f)},readFile:(s,u={})=>{if(u.flags=u.flags||0,u.encoding=u.encoding||"binary",u.encoding!=="utf8"&&u.encoding!=="binary")throw new Error('Invalid encoding type "'+u.encoding+'"');var f,p=y.open(s,u.flags),m=y.stat(s),w=m.size,S=new Uint8Array(w);return y.read(p,S,0,w,0),u.encoding==="utf8"?f=xe(S,0):u.encoding==="binary"&&(f=S),y.close(p),f},writeFile:(s,u,f={})=>{f.flags=f.flags||577;var p=y.open(s,f.flags,f.mode);if(typeof u=="string"){var m=new Uint8Array(ae(u)+1),w=ce(u,m,0,m.length);y.write(p,m,0,w,void 0,f.canOwn)}else if(ArrayBuffer.isView(u))y.write(p,u,0,u.byteLength,void 0,f.canOwn);else throw new Error("Unsupported data type");y.close(p)},cwd:()=>y.currentPath,chdir:s=>{var u=y.lookupPath(s,{follow:!0});if(u.node===null)throw new y.ErrnoError(44);if(!y.isDir(u.node.mode))throw new y.ErrnoError(54);var f=y.nodePermissions(u.node,"x");if(f)throw new y.ErrnoError(f);y.currentPath=u.path},createDefaultDirectories:()=>{y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices:()=>{y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(u,f,p,m,w)=>m}),y.mkdev("/dev/null",y.makedev(1,3)),gr.register(y.makedev(5,0),gr.default_tty_ops),gr.register(y.makedev(6,0),gr.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var s=Gv();y.createDevice("/dev","random",s),y.createDevice("/dev","urandom",s),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{y.mkdir("/proc");var s=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount:()=>{var u=y.createNode(s,"fd",16895,73);return u.node_ops={lookup:(f,p)=>{var m=+p,w=y.getStream(m);if(!w)throw new y.ErrnoError(8);var S={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return S.parent=S,S}},u}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?y.createDevice("/dev","stdin",r.stdin):y.symlink("/dev/tty","/dev/stdin"),r.stdout?y.createDevice("/dev","stdout",null,r.stdout):y.symlink("/dev/tty","/dev/stdout"),r.stderr?y.createDevice("/dev","stderr",null,r.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError:()=>{y.ErrnoError||(y.ErrnoError=function(u,f){this.node=f,this.setErrno=function(p){this.errno=p},this.setErrno(u),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(s=>{y.genericErrors[s]=new y.ErrnoError(s),y.genericErrors[s].stack="<generic error, no stack>"}))},staticInit:()=>{y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(ee,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:ee}},init:(s,u,f)=>{y.init.initialized=!0,y.ensureErrnoError(),r.stdin=s||r.stdin,r.stdout=u||r.stdout,r.stderr=f||r.stderr,y.createStandardStreams()},quit:()=>{y.init.initialized=!1;for(var s=0;s<y.streams.length;s++){var u=y.streams[s];u&&y.close(u)}},getMode:(s,u)=>{var f=0;return s&&(f|=365),u&&(f|=146),f},findObject:(s,u)=>{var f=y.analyzePath(s,u);return f.exists?f.object:null},analyzePath:(s,u)=>{try{var f=y.lookupPath(s,{follow:!u});s=f.path}catch{}var p={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var f=y.lookupPath(s,{parent:!0});p.parentExists=!0,p.parentPath=f.path,p.parentObject=f.node,p.name=he.basename(s),f=y.lookupPath(s,{follow:!u}),p.exists=!0,p.path=f.path,p.object=f.node,p.name=f.node.name,p.isRoot=f.path==="/"}catch(m){p.error=m.errno}return p},createPath:(s,u,f,p)=>{s=typeof s=="string"?s:y.getPath(s);for(var m=u.split("/").reverse();m.length;){var w=m.pop();if(w){var S=he.join2(s,w);try{y.mkdir(S)}catch{}s=S}}return S},createFile:(s,u,f,p,m)=>{var w=he.join2(typeof s=="string"?s:y.getPath(s),u),S=y.getMode(p,m);return y.create(w,S)},createDataFile:(s,u,f,p,m,w)=>{var S=u;s&&(s=typeof s=="string"?s:y.getPath(s),S=u?he.join2(s,u):s);var _=y.getMode(p,m),E=y.create(S,_);if(f){if(typeof f=="string"){for(var P=new Array(f.length),L=0,B=f.length;L<B;++L)P[L]=f.charCodeAt(L);f=P}y.chmod(E,_|146);var D=y.open(E,577);y.write(D,f,0,f.length,0,w),y.close(D),y.chmod(E,_)}return E},createDevice:(s,u,f,p)=>{var m=he.join2(typeof s=="string"?s:y.getPath(s),u),w=y.getMode(!!f,!!p);y.createDevice.major||(y.createDevice.major=64);var S=y.makedev(y.createDevice.major++,0);return y.registerDevice(S,{open:_=>{_.seekable=!1},close:_=>{p&&p.buffer&&p.buffer.length&&p(10)},read:(_,E,P,L,B)=>{for(var D=0,G=0;G<L;G++){var Y;try{Y=f()}catch{throw new y.ErrnoError(29)}if(Y===void 0&&D===0)throw new y.ErrnoError(6);if(Y==null)break;D++,E[P+G]=Y}return D&&(_.node.timestamp=Date.now()),D},write:(_,E,P,L,B)=>{for(var D=0;D<L;D++)try{p(E[P+D])}catch{throw new y.ErrnoError(29)}return L&&(_.node.timestamp=Date.now()),D}}),y.mkdev(m,w,S)},forceLoadFile:s=>{if(s.isDevice||s.isFolder||s.link||s.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(b)try{s.contents=Co(b(s.url),!0),s.usedBytes=s.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(s,u,f,p,m)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(G){if(!(G>this.length-1||G<0)){var Y=G%this.chunkSize,ve=G/this.chunkSize|0;return this.getter(ve)[Y]}},w.prototype.setDataGetter=function(G){this.getter=G},w.prototype.cacheLength=function(){var G=new XMLHttpRequest;if(G.open("HEAD",f,!1),G.send(null),!(G.status>=200&&G.status<300||G.status===304))throw new Error("Couldn't load "+f+". Status: "+G.status);var Y=Number(G.getResponseHeader("Content-length")),ve,Fe=(ve=G.getResponseHeader("Accept-Ranges"))&&ve==="bytes",Be=(ve=G.getResponseHeader("Content-Encoding"))&&ve==="gzip",O=1024*1024;Fe||(O=Y);var W=(Te,Qe)=>{if(Te>Qe)throw new Error("invalid range ("+Te+", "+Qe+") or no bytes requested!");if(Qe>Y-1)throw new Error("only "+Y+" bytes available! programmer error!");var Ue=new XMLHttpRequest;if(Ue.open("GET",f,!1),Y!==O&&Ue.setRequestHeader("Range","bytes="+Te+"-"+Qe),Ue.responseType="arraybuffer",Ue.overrideMimeType&&Ue.overrideMimeType("text/plain; charset=x-user-defined"),Ue.send(null),!(Ue.status>=200&&Ue.status<300||Ue.status===304))throw new Error("Couldn't load "+f+". Status: "+Ue.status);return Ue.response!==void 0?new Uint8Array(Ue.response||[]):Co(Ue.responseText||"",!0)},Ne=this;Ne.setDataGetter(Te=>{var Qe=Te*O,Ue=(Te+1)*O-1;if(Ue=Math.min(Ue,Y-1),typeof Ne.chunks[Te]>"u"&&(Ne.chunks[Te]=W(Qe,Ue)),typeof Ne.chunks[Te]>"u")throw new Error("doXHR failed!");return Ne.chunks[Te]}),(Be||!Y)&&(O=Y=1,Y=this.getter(0).length,O=Y,$("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Y,this._chunkSize=O,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var S=new w;Object.defineProperties(S,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var _={isDevice:!1,contents:S}}else var _={isDevice:!1,url:f};var E=y.createFile(s,u,_,p,m);_.contents?E.contents=_.contents:_.url&&(E.contents=null,E.url=_.url),Object.defineProperties(E,{usedBytes:{get:function(){return this.contents.length}}});var P={},L=Object.keys(E.stream_ops);L.forEach(D=>{var G=E.stream_ops[D];P[D]=function(){return y.forceLoadFile(E),G.apply(null,arguments)}});function B(D,G,Y,ve,Fe){var Be=D.node.contents;if(Fe>=Be.length)return 0;var O=Math.min(Be.length-Fe,ve);if(Be.slice)for(var W=0;W<O;W++)G[Y+W]=Be[Fe+W];else for(var W=0;W<O;W++)G[Y+W]=Be.get(Fe+W);return O}return P.read=(D,G,Y,ve,Fe)=>(y.forceLoadFile(E),B(D,G,Y,ve,Fe)),P.mmap=(D,G,Y,ve,Fe)=>{y.forceLoadFile(E);var Be=Lu(G);if(!Be)throw new y.ErrnoError(48);return B(D,ge,Be,G,Y),{ptr:Be,allocated:!0}},E.stream_ops=P,E},createPreloadedFile:(s,u,f,p,m,w,S,_,E,P)=>{var L=u?Ut.resolve(he.join2(s,u)):s;function B(D){function G(Y){P&&P(),_||y.createDataFile(s,u,Y,p,m,E),w&&w(),uo()}Browser.handledByPreloadPlugin(D,L,G,()=>{S&&S(),uo()})||G(D)}xi(),typeof f=="string"?Hv(f,D=>B(D),S):B(f)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(w){return f(w)}m.onupgradeneeded=()=>{$("creating db");var w=m.result;w.createObjectStore(y.DB_STORE_NAME)},m.onsuccess=()=>{var w=m.result,S=w.transaction([y.DB_STORE_NAME],"readwrite"),_=S.objectStore(y.DB_STORE_NAME),E=0,P=0,L=s.length;function B(){P==0?u():f()}s.forEach(D=>{var G=_.put(y.analyzePath(D).object.contents,D);G.onsuccess=()=>{E++,E+P==L&&B()},G.onerror=()=>{P++,E+P==L&&B()}}),S.onerror=f},m.onerror=f},loadFilesFromDB:(s,u,f)=>{u=u||(()=>{}),f=f||(()=>{});var p=y.indexedDB();try{var m=p.open(y.DB_NAME(),y.DB_VERSION)}catch(w){return f(w)}m.onupgradeneeded=f,m.onsuccess=()=>{var w=m.result;try{var S=w.transaction([y.DB_STORE_NAME],"readonly")}catch(D){f(D);return}var _=S.objectStore(y.DB_STORE_NAME),E=0,P=0,L=s.length;function B(){P==0?u():f()}s.forEach(D=>{var G=_.get(D);G.onsuccess=()=>{y.analyzePath(D).exists&&y.unlink(D),y.createDataFile(he.dirname(D),he.basename(D),G.result,!0,!0,!0),E++,E+P==L&&B()},G.onerror=()=>{P++,E+P==L&&B()}}),S.onerror=f},m.onerror=f}},pe={DEFAULT_POLLMASK:5,calculateAt:function(s,u,f){if(he.isAbs(u))return u;var p;if(s===-100)p=y.cwd();else{var m=y.getStream(s);if(!m)throw new y.ErrnoError(8);p=m.path}if(u.length==0){if(!f)throw new y.ErrnoError(44);return p}return he.join2(p,u)},doStat:function(s,u,f){try{var p=s(u)}catch(m){if(m&&m.node&&he.normalize(u)!==he.normalize(y.getPath(m.node)))return-54;throw m}return U[f>>2]=p.dev,U[f+4>>2]=0,U[f+8>>2]=p.ino,U[f+12>>2]=p.mode,U[f+16>>2]=p.nlink,U[f+20>>2]=p.uid,U[f+24>>2]=p.gid,U[f+28>>2]=p.rdev,U[f+32>>2]=0,Bt=[p.size>>>0,(ze=p.size,+Math.abs(ze)>=1?ze>0?(Math.min(+Math.floor(ze/4294967296),4294967295)|0)>>>0:~~+Math.ceil((ze-+(~~ze>>>0))/4294967296)>>>0:0)],U[f+40>>2]=Bt[0],U[f+44>>2]=Bt[1],U[f+48>>2]=4096,U[f+52>>2]=p.blocks,U[f+56>>2]=p.atime.getTime()/1e3|0,U[f+60>>2]=0,U[f+64>>2]=p.mtime.getTime()/1e3|0,U[f+68>>2]=0,U[f+72>>2]=p.ctime.getTime()/1e3|0,U[f+76>>2]=0,Bt=[p.ino>>>0,(ze=p.ino,+Math.abs(ze)>=1?ze>0?(Math.min(+Math.floor(ze/4294967296),4294967295)|0)>>>0:~~+Math.ceil((ze-+(~~ze>>>0))/4294967296)>>>0:0)],U[f+80>>2]=Bt[0],U[f+84>>2]=Bt[1],0},doMsync:function(s,u,f,p,m){var w=Re.slice(s,s+f);y.msync(u,w,m,f,p)},varargs:void 0,get:function(){pe.varargs+=4;var s=U[pe.varargs-4>>2];return s},getStr:function(s){var u=re(s);return u},getStreamFromFD:function(s){var u=y.getStream(s);if(!u)throw new y.ErrnoError(8);return u}};function zv(s,u){try{return s=pe.getStr(s),y.chmod(s,u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Wv(s,u,f,p){try{if(u=pe.getStr(u),u=pe.calculateAt(s,u),f&-8)return-28;var m=y.lookupPath(u,{follow:!0}),w=m.node;if(!w)return-44;var S="";return f&4&&(S+="r"),f&2&&(S+="w"),f&1&&(S+="x"),S&&y.nodePermissions(w,S)?-2:0}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function $v(s){return U[tl()>>2]=s,s}function Yv(s,u,f){pe.varargs=f;try{var p=pe.getStreamFromFD(s);switch(u){case 0:{var m=pe.get();if(m<0)return-28;var w;return w=y.createStream(p,m),w.fd}case 1:case 2:return 0;case 3:return p.flags;case 4:{var m=pe.get();return p.flags|=m,0}case 5:{var m=pe.get(),S=0;return Oe[m+S>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return $v(28),-1;default:return-28}}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function Xv(s,u){try{var f=pe.getStreamFromFD(s);return pe.doStat(y.stat,f.path,u)}catch(p){if(typeof y>"u"||!(p instanceof y.ErrnoError))throw p;return-p.errno}}function jv(s,u,f){pe.varargs=f;try{var p=pe.getStreamFromFD(s);switch(u){case 21509:case 21505:return p.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return p.tty?0:-59;case 21519:{if(!p.tty)return-59;var m=pe.get();return U[m>>2]=0,0}case 21520:return p.tty?-28:-59;case 21531:{var m=pe.get();return y.ioctl(p,u,m)}case 21523:return p.tty?0:-59;case 21524:return p.tty?0:-59;default:tr("bad ioctl syscall "+u)}}catch(w){if(typeof y>"u"||!(w instanceof y.ErrnoError))throw w;return-w.errno}}function qv(s,u){try{return s=pe.getStr(s),pe.doStat(y.lstat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Zv(s,u,f,p){try{u=pe.getStr(u);var m=p&256,w=p&4096;return p=p&-4353,u=pe.calculateAt(s,u,w),pe.doStat(m?y.lstat:y.stat,u,f)}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return-S.errno}}function Kv(s,u,f,p){pe.varargs=p;try{u=pe.getStr(u),u=pe.calculateAt(s,u);var m=p?pe.get():0;return y.open(u,f,m).fd}catch(w){if(typeof y>"u"||!(w instanceof y.ErrnoError))throw w;return-w.errno}}function Qv(s,u){try{return s=pe.getStr(s),pe.doStat(y.stat,s,u)}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return-f.errno}}function Jv(s,u,f,p,m){}function fo(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}function eg(){for(var s=new Array(256),u=0;u<256;++u)s[u]=String.fromCharCode(u);Bu=s}var Bu=void 0;function Xe(s){for(var u="",f=s;Re[f];)u+=Bu[Re[f++]];return u}var Br={},mr={},ho={},tg=48,rg=57;function po(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var u=s.charCodeAt(0);return u>=tg&&u<=rg?"_"+s:s}function vo(s,u){return s=po(s),new Function("body","return function "+s+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(u)}function ki(s,u){var f=vo(u,function(p){this.name=u,this.message=p;var m=new Error(p).stack;m!==void 0&&(this.stack=this.toString()+`
`+m.replace(/^Error(:[^\n]*)?\n/,""))});return f.prototype=Object.create(s.prototype),f.prototype.constructor=f,f.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},f}var Ur=void 0;function de(s){throw new Ur(s)}var Uu=void 0;function go(s){throw new Uu(s)}function yr(s,u,f){s.forEach(function(_){ho[_]=u});function p(_){var E=f(_);E.length!==s.length&&go("Mismatched type converter count");for(var P=0;P<s.length;++P)Et(s[P],E[P])}var m=new Array(u.length),w=[],S=0;u.forEach((_,E)=>{mr.hasOwnProperty(_)?m[E]=mr[_]:(w.push(_),Br.hasOwnProperty(_)||(Br[_]=[]),Br[_].push(()=>{m[E]=mr[_],++S,S===w.length&&p(m)}))}),w.length===0&&p(m)}function Et(s,u,f={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");var p=u.name;if(s||de('type "'+p+'" must have a positive integer typeid pointer'),mr.hasOwnProperty(s)){if(f.ignoreDuplicateRegistrations)return;de("Cannot register type '"+p+"' twice")}if(mr[s]=u,delete ho[s],Br.hasOwnProperty(s)){var m=Br[s];delete Br[s],m.forEach(w=>w())}}function ng(s,u,f,p,m){var w=fo(f);u=Xe(u),Et(s,{name:u,fromWireType:function(S){return!!S},toWireType:function(S,_){return _?p:m},argPackAdvance:8,readValueFromPointer:function(S){var _;if(f===1)_=ge;else if(f===2)_=Oe;else if(f===4)_=U;else throw new TypeError("Unknown boolean type size: "+u);return this.fromWireType(_[S>>w])},destructorFunction:null})}function og(s){if(!(this instanceof rr)||!(s instanceof rr))return!1;for(var u=this.$$.ptrType.registeredClass,f=this.$$.ptr,p=s.$$.ptrType.registeredClass,m=s.$$.ptr;u.baseClass;)f=u.upcast(f),u=u.baseClass;for(;p.baseClass;)m=p.upcast(m),p=p.baseClass;return u===p&&f===m}function ig(s){return{count:s.count,deleteScheduled:s.deleteScheduled,preservePointerOnDelete:s.preservePointerOnDelete,ptr:s.ptr,ptrType:s.ptrType,smartPtr:s.smartPtr,smartPtrType:s.smartPtrType}}function Pi(s){function u(f){return f.$$.ptrType.registeredClass.name}de(u(s)+" instance already deleted")}var Ai=!1;function Iu(s){}function sg(s){s.smartPtr?s.smartPtrType.rawDestructor(s.smartPtr):s.ptrType.registeredClass.rawDestructor(s.ptr)}function Gu(s){s.count.value-=1;var u=s.count.value===0;u&&sg(s)}function Nu(s,u,f){if(u===f)return s;if(f.baseClass===void 0)return null;var p=Nu(s,u,f.baseClass);return p===null?null:f.downcast(p)}var Vu={};function ag(){return Object.keys(mn).length}function ug(){var s=[];for(var u in mn)mn.hasOwnProperty(u)&&s.push(mn[u]);return s}var vn=[];function Ri(){for(;vn.length;){var s=vn.pop();s.$$.deleteScheduled=!1,s.delete()}}var gn=void 0;function lg(s){gn=s,vn.length&&gn&&gn(Ri)}function cg(){r.getInheritedInstanceCount=ag,r.getLiveInheritedInstances=ug,r.flushPendingDeletes=Ri,r.setDelayFunction=lg}var mn={};function fg(s,u){for(u===void 0&&de("ptr should not be undefined");s.baseClass;)u=s.upcast(u),s=s.baseClass;return u}function hg(s,u){return u=fg(s,u),mn[u]}function mo(s,u){(!u.ptrType||!u.ptr)&&go("makeClassHandle requires ptr and ptrType");var f=!!u.smartPtrType,p=!!u.smartPtr;return f!==p&&go("Both smartPtrType and smartPtr must be specified"),u.count={value:1},yn(Object.create(s,{$$:{value:u}}))}function pg(s){var u=this.getPointee(s);if(!u)return this.destructor(s),null;var f=hg(this.registeredClass,u);if(f!==void 0){if(f.$$.count.value===0)return f.$$.ptr=u,f.$$.smartPtr=s,f.clone();var p=f.clone();return this.destructor(s),p}function m(){return this.isSmartPointer?mo(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:s}):mo(this.registeredClass.instancePrototype,{ptrType:this,ptr:s})}var w=this.registeredClass.getActualType(u),S=Vu[w];if(!S)return m.call(this);var _;this.isConst?_=S.constPointerType:_=S.pointerType;var E=Nu(u,this.registeredClass,_.registeredClass);return E===null?m.call(this):this.isSmartPointer?mo(_.registeredClass.instancePrototype,{ptrType:_,ptr:E,smartPtrType:this,smartPtr:s}):mo(_.registeredClass.instancePrototype,{ptrType:_,ptr:E})}function yn(s){return typeof FinalizationRegistry>"u"?(yn=u=>u,s):(Ai=new FinalizationRegistry(u=>{Gu(u.$$)}),yn=u=>{var f=u.$$,p=!!f.smartPtr;if(p){var m={$$:f};Ai.register(u,m,u)}return u},Iu=u=>Ai.unregister(u),yn(s))}function dg(){if(this.$$.ptr||Pi(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var s=yn(Object.create(Object.getPrototypeOf(this),{$$:{value:ig(this.$$)}}));return s.$$.count.value+=1,s.$$.deleteScheduled=!1,s}function vg(){this.$$.ptr||Pi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&de("Object already scheduled for deletion"),Iu(this),Gu(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function gg(){return!this.$$.ptr}function mg(){return this.$$.ptr||Pi(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&de("Object already scheduled for deletion"),vn.push(this),vn.length===1&&gn&&gn(Ri),this.$$.deleteScheduled=!0,this}function yg(){rr.prototype.isAliasOf=og,rr.prototype.clone=dg,rr.prototype.delete=vg,rr.prototype.isDeleted=gg,rr.prototype.deleteLater=mg}function rr(){}function Oi(s,u,f){if(s[u].overloadTable===void 0){var p=s[u];s[u]=function(){return s[u].overloadTable.hasOwnProperty(arguments.length)||de("Function '"+f+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[u].overloadTable+")!"),s[u].overloadTable[arguments.length].apply(this,arguments)},s[u].overloadTable=[],s[u].overloadTable[p.argCount]=p}}function Hu(s,u,f){r.hasOwnProperty(s)?((f===void 0||r[s].overloadTable!==void 0&&r[s].overloadTable[f]!==void 0)&&de("Cannot register public name '"+s+"' twice"),Oi(r,s,s),r.hasOwnProperty(f)&&de("Cannot register multiple overloads of a function with the same number of arguments ("+f+")!"),r[s].overloadTable[f]=u):(r[s]=u,f!==void 0&&(r[s].numArguments=f))}function wg(s,u,f,p,m,w,S,_){this.name=s,this.constructor=u,this.instancePrototype=f,this.rawDestructor=p,this.baseClass=m,this.getActualType=w,this.upcast=S,this.downcast=_,this.pureVirtualFunctions=[]}function Mi(s,u,f){for(;u!==f;)u.upcast||de("Expected null or instance of "+f.name+", got an instance of "+u.name),s=u.upcast(s),u=u.baseClass;return s}function bg(s,u){if(u===null)return this.isReference&&de("null is not a valid "+this.name),0;u.$$||de('Cannot pass "'+Ui(u)+'" as a '+this.name),u.$$.ptr||de("Cannot pass deleted object as a pointer of type "+this.name);var f=u.$$.ptrType.registeredClass,p=Mi(u.$$.ptr,f,this.registeredClass);return p}function Sg(s,u){var f;if(u===null)return this.isReference&&de("null is not a valid "+this.name),this.isSmartPointer?(f=this.rawConstructor(),s!==null&&s.push(this.rawDestructor,f),f):0;u.$$||de('Cannot pass "'+Ui(u)+'" as a '+this.name),u.$$.ptr||de("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&u.$$.ptrType.isConst&&de("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);var p=u.$$.ptrType.registeredClass;if(f=Mi(u.$$.ptr,p,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&de("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?f=u.$$.smartPtr:de("Cannot convert argument of type "+(u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:f=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)f=u.$$.smartPtr;else{var m=u.clone();f=this.rawShare(f,Ge.toHandle(function(){m.delete()})),s!==null&&s.push(this.rawDestructor,f)}break;default:de("Unsupporting sharing policy")}return f}function _g(s,u){if(u===null)return this.isReference&&de("null is not a valid "+this.name),0;u.$$||de('Cannot pass "'+Ui(u)+'" as a '+this.name),u.$$.ptr||de("Cannot pass deleted object as a pointer of type "+this.name),u.$$.ptrType.isConst&&de("Cannot convert argument of type "+u.$$.ptrType.name+" to parameter type "+this.name);var f=u.$$.ptrType.registeredClass,p=Mi(u.$$.ptr,f,this.registeredClass);return p}function yo(s){return this.fromWireType(ue[s>>2])}function Tg(s){return this.rawGetPointee&&(s=this.rawGetPointee(s)),s}function Eg(s){this.rawDestructor&&this.rawDestructor(s)}function xg(s){s!==null&&s.delete()}function Cg(){It.prototype.getPointee=Tg,It.prototype.destructor=Eg,It.prototype.argPackAdvance=8,It.prototype.readValueFromPointer=yo,It.prototype.deleteObject=xg,It.prototype.fromWireType=pg}function It(s,u,f,p,m,w,S,_,E,P,L){this.name=s,this.registeredClass=u,this.isReference=f,this.isConst=p,this.isSmartPointer=m,this.pointeeType=w,this.sharingPolicy=S,this.rawGetPointee=_,this.rawConstructor=E,this.rawShare=P,this.rawDestructor=L,!m&&u.baseClass===void 0?p?(this.toWireType=bg,this.destructorFunction=null):(this.toWireType=_g,this.destructorFunction=null):this.toWireType=Sg}function kg(s,u,f){r.hasOwnProperty(s)||go("Replacing nonexistant public symbol"),r[s].overloadTable!==void 0&&f!==void 0?r[s].overloadTable[f]=u:(r[s]=u,r[s].argCount=f)}function Pg(s,u,f){var p=r["dynCall_"+s];return f&&f.length?p.apply(null,[u].concat(f)):p.call(null,u)}function Ag(s,u,f){return s.includes("j")?Pg(s,u,f):co(u).apply(null,f)}function Rg(s,u){var f=[];return function(){return f.length=0,Object.assign(f,arguments),Ag(s,u,f)}}function wr(s,u){s=Xe(s);function f(){return s.includes("j")?Rg(s,u):co(u)}var p=f();return typeof p!="function"&&de("unknown function pointer with signature "+s+": "+u),p}var zu=void 0;function Wu(s){var u=rl(s),f=Xe(u);return Vt(u),f}function wo(s,u){var f=[],p={};function m(w){if(!p[w]&&!mr[w]){if(ho[w]){ho[w].forEach(m);return}f.push(w),p[w]=!0}}throw u.forEach(m),new zu(s+": "+f.map(Wu).join([", "]))}function Og(s,u,f,p,m,w,S,_,E,P,L,B,D){L=Xe(L),w=wr(m,w),_&&(_=wr(S,_)),P&&(P=wr(E,P)),D=wr(B,D);var G=po(L);Hu(G,function(){wo("Cannot construct "+L+" due to unbound types",[p])}),yr([s,u,f],p?[p]:[],function(Y){Y=Y[0];var ve,Fe;p?(ve=Y.registeredClass,Fe=ve.instancePrototype):Fe=rr.prototype;var Be=vo(G,function(){if(Object.getPrototypeOf(this)!==O)throw new Ur("Use 'new' to construct "+L);if(W.constructor_body===void 0)throw new Ur(L+" has no accessible constructor");var Ue=W.constructor_body[arguments.length];if(Ue===void 0)throw new Ur("Tried to invoke ctor of "+L+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(W.constructor_body).toString()+") parameters instead!");return Ue.apply(this,arguments)}),O=Object.create(Fe,{constructor:{value:Be}});Be.prototype=O;var W=new wg(L,Be,O,D,ve,w,_,P),Ne=new It(L,W,!0,!1,!1),Te=new It(L+"*",W,!1,!1,!1),Qe=new It(L+" const*",W,!1,!0,!1);return Vu[s]={pointerType:Te,constPointerType:Qe},kg(G,Be),[Ne,Te,Qe]})}function $u(s,u){if(!(s instanceof Function))throw new TypeError("new_ called with constructor type "+typeof s+" which is not a function");var f=vo(s.name||"unknownFunctionName",function(){});f.prototype=s.prototype;var p=new f,m=s.apply(p,u);return m instanceof Object?m:p}function Yu(s){for(;s.length;){var u=s.pop(),f=s.pop();f(u)}}function Di(s,u,f,p,m){var w=u.length;w<2&&de("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var S=u[1]!==null&&f!==null,_=!1,E=1;E<u.length;++E)if(u[E]!==null&&u[E].destructorFunction===void 0){_=!0;break}for(var P=u[0].name!=="void",L="",B="",E=0;E<w-2;++E)L+=(E!==0?", ":"")+"arg"+E,B+=(E!==0?", ":"")+"arg"+E+"Wired";var D="return function "+po(s)+"("+L+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+s+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;_&&(D+=`var destructors = [];
`);var G=_?"destructors":"null",Y=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ve=[de,p,m,Yu,u[0],u[1]];S&&(D+="var thisWired = classParam.toWireType("+G+`, this);
`);for(var E=0;E<w-2;++E)D+="var arg"+E+"Wired = argType"+E+".toWireType("+G+", arg"+E+"); // "+u[E+2].name+`
`,Y.push("argType"+E),ve.push(u[E+2]);if(S&&(B="thisWired"+(B.length>0?", ":"")+B),D+=(P?"var rv = ":"")+"invoker(fn"+(B.length>0?", ":"")+B+`);
`,_)D+=`runDestructors(destructors);
`;else for(var E=S?1:2;E<u.length;++E){var Fe=E===1?"thisWired":"arg"+(E-2)+"Wired";u[E].destructorFunction!==null&&(D+=Fe+"_dtor("+Fe+"); // "+u[E].name+`
`,Y.push(Fe+"_dtor"),ve.push(u[E].destructorFunction))}P&&(D+=`var ret = retType.fromWireType(rv);
return ret;
`),D+=`}
`,Y.push(D);var Be=$u(Function,Y).apply(null,ve);return Be}function Fi(s,u){for(var f=[],p=0;p<s;p++)f.push(U[(u>>2)+p]);return f}function Mg(s,u,f,p,m,w,S){var _=Fi(f,p);u=Xe(u),w=wr(m,w),yr([],[s],function(E){E=E[0];var P=E.name+"."+u;function L(){wo("Cannot call "+P+" due to unbound types",_)}u.startsWith("@@")&&(u=Symbol[u.substring(2)]);var B=E.registeredClass.constructor;return B[u]===void 0?(L.argCount=f-1,B[u]=L):(Oi(B,u,P),B[u].overloadTable[f-1]=L),yr([],_,function(D){var G=[D[0],null].concat(D.slice(1)),Y=Di(P,G,null,w,S);return B[u].overloadTable===void 0?(Y.argCount=f-1,B[u]=Y):B[u].overloadTable[f-1]=Y,[]}),[]})}function Dg(s,u,f,p,m,w){Se(u>0);var S=Fi(u,f);m=wr(p,m),yr([],[s],function(_){_=_[0];var E="constructor "+_.name;if(_.registeredClass.constructor_body===void 0&&(_.registeredClass.constructor_body=[]),_.registeredClass.constructor_body[u-1]!==void 0)throw new Ur("Cannot register multiple constructors with identical number of parameters ("+(u-1)+") for class '"+_.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return _.registeredClass.constructor_body[u-1]=()=>{wo("Cannot construct "+_.name+" due to unbound types",S)},yr([],S,function(P){return P.splice(1,0,null),_.registeredClass.constructor_body[u-1]=Di(E,P,null,m,w),[]}),[]})}function Fg(s,u,f,p,m,w,S,_){var E=Fi(f,p);u=Xe(u),w=wr(m,w),yr([],[s],function(P){P=P[0];var L=P.name+"."+u;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),_&&P.registeredClass.pureVirtualFunctions.push(u);function B(){wo("Cannot call "+L+" due to unbound types",E)}var D=P.registeredClass.instancePrototype,G=D[u];return G===void 0||G.overloadTable===void 0&&G.className!==P.name&&G.argCount===f-2?(B.argCount=f-2,B.className=P.name,D[u]=B):(Oi(D,u,L),D[u].overloadTable[f-2]=B),yr([],E,function(Y){var ve=Di(L,Y,P,w,S);return D[u].overloadTable===void 0?(ve.argCount=f-2,D[u]=ve):D[u].overloadTable[f-2]=ve,[]}),[]})}var Li=[],gt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Bi(s){s>4&&--gt[s].refcount===0&&(gt[s]=void 0,Li.push(s))}function Lg(){for(var s=0,u=5;u<gt.length;++u)gt[u]!==void 0&&++s;return s}function Bg(){for(var s=5;s<gt.length;++s)if(gt[s]!==void 0)return gt[s];return null}function Ug(){r.count_emval_handles=Lg,r.get_first_emval=Bg}var Ge={toValue:s=>(s||de("Cannot use deleted val. handle = "+s),gt[s].value),toHandle:s=>{switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var u=Li.length?Li.pop():gt.length;return gt[u]={refcount:1,value:s},u}}}};function Ig(s,u){u=Xe(u),Et(s,{name:u,fromWireType:function(f){var p=Ge.toValue(f);return Bi(f),p},toWireType:function(f,p){return Ge.toHandle(p)},argPackAdvance:8,readValueFromPointer:yo,destructorFunction:null})}function Gg(s,u,f){switch(u){case 0:return function(p){var m=f?ge:Re;return this.fromWireType(m[p])};case 1:return function(p){var m=f?Oe:dt;return this.fromWireType(m[p>>1])};case 2:return function(p){var m=f?U:ue;return this.fromWireType(m[p>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Ng(s,u,f,p){var m=fo(f);u=Xe(u);function w(){}w.values={},Et(s,{name:u,constructor:w,fromWireType:function(S){return this.constructor.values[S]},toWireType:function(S,_){return _.value},argPackAdvance:8,readValueFromPointer:Gg(u,m,p),destructorFunction:null}),Hu(u,w)}function bo(s,u){var f=mr[s];return f===void 0&&de(u+" has unknown type "+Wu(s)),f}function Vg(s,u,f){var p=bo(s,"enum");u=Xe(u);var m=p.constructor,w=Object.create(p.constructor.prototype,{value:{value:f},constructor:{value:vo(p.name+"_"+u,function(){})}});m.values[f]=w,m[u]=w}function Ui(s){if(s===null)return"null";var u=typeof s;return u==="object"||u==="array"||u==="function"?s.toString():""+s}function Hg(s,u){switch(u){case 2:return function(f){return this.fromWireType(vt[f>>2])};case 3:return function(f){return this.fromWireType(xu[f>>3])};default:throw new TypeError("Unknown float type: "+s)}}function zg(s,u,f){var p=fo(f);u=Xe(u),Et(s,{name:u,fromWireType:function(m){return m},toWireType:function(m,w){return w},argPackAdvance:8,readValueFromPointer:Hg(u,p),destructorFunction:null})}function Wg(s,u,f){switch(u){case 0:return f?function(m){return ge[m]}:function(m){return Re[m]};case 1:return f?function(m){return Oe[m>>1]}:function(m){return dt[m>>1]};case 2:return f?function(m){return U[m>>2]}:function(m){return ue[m>>2]};default:throw new TypeError("Unknown integer type: "+s)}}function $g(s,u,f,p,m){u=Xe(u);var w=fo(f),S=B=>B;if(p===0){var _=32-8*f;S=B=>B<<_>>>_}var E=u.includes("unsigned"),P=(B,D)=>{},L;E?L=function(B,D){return P(D,this.name),D>>>0}:L=function(B,D){return P(D,this.name),D},Et(s,{name:u,fromWireType:S,toWireType:L,argPackAdvance:8,readValueFromPointer:Wg(u,w,p!==0),destructorFunction:null})}function Yg(s,u,f){var p=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],m=p[u];function w(S){S=S>>2;var _=ue,E=_[S],P=_[S+1];return new m(pt,P,E)}f=Xe(f),Et(s,{name:f,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function Xg(s,u){u=Xe(u);var f=u==="std::string";Et(s,{name:u,fromWireType:function(p){var m=ue[p>>2],w;if(f)for(var S=p+4,_=0;_<=m;++_){var E=p+4+_;if(_==m||Re[E]==0){var P=E-S,L=re(S,P);w===void 0?w=L:(w+=String.fromCharCode(0),w+=L),S=E+1}}else{for(var B=new Array(m),_=0;_<m;++_)B[_]=String.fromCharCode(Re[p+4+_]);w=B.join("")}return Vt(p),w},toWireType:function(p,m){m instanceof ArrayBuffer&&(m=new Uint8Array(m));var w,S=typeof m=="string";S||m instanceof Uint8Array||m instanceof Uint8ClampedArray||m instanceof Int8Array||de("Cannot pass non-string to std::string"),f&&S?w=()=>ae(m):w=()=>m.length;var _=w(),E=Nt(4+_+1);if(ue[E>>2]=_,f&&S)ye(m,E+4,_+1);else if(S)for(var P=0;P<_;++P){var L=m.charCodeAt(P);L>255&&(Vt(E),de("String has UTF-16 code units that do not fit in 8 bits")),Re[E+4+P]=L}else for(var P=0;P<_;++P)Re[E+4+P]=m[P];return p!==null&&p.push(Vt,E),E},argPackAdvance:8,readValueFromPointer:yo,destructorFunction:function(p){Vt(p)}})}function jg(s,u,f){f=Xe(f);var p,m,w,S,_;u===2?(p=le,m=we,S=fe,w=()=>dt,_=1):u===4&&(p=Ce,m=_t,S=Lt,w=()=>ue,_=2),Et(s,{name:f,fromWireType:function(E){for(var P=ue[E>>2],L=w(),B,D=E+4,G=0;G<=P;++G){var Y=E+4+G*u;if(G==P||L[Y>>_]==0){var ve=Y-D,Fe=p(D,ve);B===void 0?B=Fe:(B+=String.fromCharCode(0),B+=Fe),D=Y+u}}return Vt(E),B},toWireType:function(E,P){typeof P!="string"&&de("Cannot pass non-string to C++ string type "+f);var L=S(P),B=Nt(4+L+u);return ue[B>>2]=L>>_,m(P,B+4,L+u),E!==null&&E.push(Vt,B),B},argPackAdvance:8,readValueFromPointer:yo,destructorFunction:function(E){Vt(E)}})}function qg(s,u){u=Xe(u),Et(s,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:function(){},toWireType:function(f,p){}})}function Zg(){return Date.now()}var Kg=!0;function Qg(){return Kg}function Jg(s,u,f){s=Ge.toValue(s),u=bo(u,"emval::as");var p=[],m=Ge.toHandle(p);return U[f>>2]=m,u.toWireType(p,s)}function em(s){var u=[];return U[s>>2]=Ge.toHandle(u),u}var tm={};function Ii(s){var u=tm[s];return u===void 0?Xe(s):u}var Gi=[];function rm(s,u,f,p,m){return s=Gi[s],u=Ge.toValue(u),f=Ii(f),s(u,f,em(p),m)}function Xu(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function nm(s){return s===0?Ge.toHandle(Xu()):(s=Ii(s),Ge.toHandle(Xu()[s]))}function om(s){var u=Gi.length;return Gi.push(s),u}function im(s,u){for(var f=new Array(s),p=0;p<s;++p)f[p]=bo(ue[u+p*q>>2],"parameter "+p);return f}var ju=[];function sm(s,u){var f=im(s,u),p=f[0],m=p.name+"_$"+f.slice(1).map(function(Y){return Y.name}).join("_")+"$",w=ju[m];if(w!==void 0)return w;for(var S=["retType"],_=[p],E="",P=0;P<s-1;++P)E+=(P!==0?", ":"")+"arg"+P,S.push("argType"+P),_.push(f[1+P]);for(var L=po("methodCaller_"+m),B="return function "+L+`(handle, name, destructors, args) {
`,D=0,P=0;P<s-1;++P)B+="    var arg"+P+" = argType"+P+".readValueFromPointer(args"+(D?"+"+D:"")+`);
`,D+=f[P+1].argPackAdvance;B+="    var rv = handle[name]("+E+`);
`;for(var P=0;P<s-1;++P)f[P+1].deleteObject&&(B+="    argType"+P+".deleteObject(arg"+P+`);
`);p.isVoid||(B+=`    return retType.toWireType(destructors, rv);
`),B+=`};
`,S.push(B);var G=$u(Function,S).apply(null,_);return w=om(G),ju[m]=w,w}function am(s,u){return s=Ge.toValue(s),u=Ge.toValue(u),Ge.toHandle(s[u])}function um(s){s>4&&(gt[s].refcount+=1)}function lm(s){return Ge.toHandle(Ii(s))}function cm(s){var u=Ge.toValue(s);Yu(u),Bi(s)}function fm(s,u,f){s=Ge.toValue(s),u=Ge.toValue(u),f=Ge.toValue(f),s[u]=f}function hm(s,u){s=bo(s,"_emval_take_value");var f=s.readValueFromPointer(u);return Ge.toHandle(f)}function pm(s){return s=Ge.toValue(s),Ge.toHandle(typeof s)}function dm(s,u){var f=new Date(U[s>>2]*1e3);U[u>>2]=f.getSeconds(),U[u+4>>2]=f.getMinutes(),U[u+8>>2]=f.getHours(),U[u+12>>2]=f.getDate(),U[u+16>>2]=f.getMonth(),U[u+20>>2]=f.getFullYear()-1900,U[u+24>>2]=f.getDay();var p=new Date(f.getFullYear(),0,1),m=(f.getTime()-p.getTime())/(1e3*60*60*24)|0;U[u+28>>2]=m,U[u+36>>2]=-(f.getTimezoneOffset()*60);var w=new Date(f.getFullYear(),6,1).getTimezoneOffset(),S=p.getTimezoneOffset(),_=(w!=S&&f.getTimezoneOffset()==Math.min(S,w))|0;U[u+32>>2]=_}function vm(s,u,f,p,m,w){try{var S=y.getStream(m);S&&(f&2&&pe.doMsync(s,S,u,p,w),y.munmap(S))}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return-_.errno}}function gm(s,u,f){var p=new Date().getFullYear(),m=new Date(p,0,1),w=new Date(p,6,1),S=m.getTimezoneOffset(),_=w.getTimezoneOffset(),E=Math.max(S,_);U[s>>2]=E*60,U[u>>2]=Number(S!=_);function P(Y){var ve=Y.toTimeString().match(/\(([A-Za-z ]+)\)$/);return ve?ve[1]:"GMT"}var L=P(m),B=P(w),D=Tt(L),G=Tt(B);_<S?(ue[f>>2]=D,ue[f+4>>2]=G):(ue[f>>2]=G,ue[f+4>>2]=D)}function Ni(s,u,f){Ni.called||(Ni.called=!0,gm(s,u,f))}function mm(){tr("")}function qu(){return 2147483648}function ym(){return qu()}function wm(s,u,f){Re.copyWithin(s,u,u+f)}function bm(s){try{return se.grow(s-pt.byteLength+65535>>>16),Cu(se.buffer),1}catch{}}function Sm(s){var u=Re.length;s=s>>>0;var f=qu();if(s>f)return!1;let p=(E,P)=>E+(P-E%P)%P;for(var m=1;m<=4;m*=2){var w=u*(1+.2/m);w=Math.min(w,s+100663296);var S=Math.min(f,p(Math.max(s,w),65536)),_=bm(S);if(_)return!0}return!1}var Vi={};function _m(){return a||"./this.program"}function wn(){if(!wn.strings){var s=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:s,_:_m()};for(var f in Vi)Vi[f]===void 0?delete u[f]:u[f]=Vi[f];var p=[];for(var f in u)p.push(f+"="+u[f]);wn.strings=p}return wn.strings}function Tm(s,u){var f=0;return wn().forEach(function(p,m){var w=u+f;ue[s+m*4>>2]=w,Lr(p,w),f+=p.length+1}),0}function Em(s,u){var f=wn();ue[s>>2]=f.length;var p=0;return f.forEach(function(m){p+=m.length+1}),ue[u>>2]=p,0}function xm(s){o0(s)}function Cm(s){try{var u=pe.getStreamFromFD(s);return y.close(u),0}catch(f){if(typeof y>"u"||!(f instanceof y.ErrnoError))throw f;return f.errno}}function km(s,u,f,p){for(var m=0,w=0;w<f;w++){var S=ue[u>>2],_=ue[u+4>>2];u+=8;var E=y.read(s,ge,S,_,p);if(E<0)return-1;if(m+=E,E<_)break}return m}function Pm(s,u,f,p){try{var m=pe.getStreamFromFD(s),w=km(m,u,f);return U[p>>2]=w,0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return S.errno}}function Am(s,u){return u+2097152>>>0<4194305-!!s?(s>>>0)+u*4294967296:NaN}function Rm(s,u,f,p,m){try{var w=Am(u,f);if(isNaN(w))return 61;var S=pe.getStreamFromFD(s);return y.llseek(S,w,p),Bt=[S.position>>>0,(ze=S.position,+Math.abs(ze)>=1?ze>0?(Math.min(+Math.floor(ze/4294967296),4294967295)|0)>>>0:~~+Math.ceil((ze-+(~~ze>>>0))/4294967296)>>>0:0)],U[m>>2]=Bt[0],U[m+4>>2]=Bt[1],S.getdents&&w===0&&p===0&&(S.getdents=null),0}catch(_){if(typeof y>"u"||!(_ instanceof y.ErrnoError))throw _;return _.errno}}function Om(s,u,f,p){for(var m=0,w=0;w<f;w++){var S=ue[u>>2],_=ue[u+4>>2];u+=8;var E=y.write(s,ge,S,_,p);if(E<0)return-1;m+=E}return m}function Mm(s,u,f,p){try{var m=pe.getStreamFromFD(s),w=Om(m,u,f);return ue[p>>2]=w,0}catch(S){if(typeof y>"u"||!(S instanceof y.ErrnoError))throw S;return S.errno}}function Zu(s){for(var u=s.split("."),f=0;f<4;f++){var p=Number(u[f]);if(isNaN(p))return null;u[f]=p}return(u[0]|u[1]<<8|u[2]<<16|u[3]<<24)>>>0}function bn(s){return parseInt(s)}function Dm(s){var u,f,p,m,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,S=[];if(!w.test(s))return null;if(s==="::")return[0,0,0,0,0,0,0,0];for(s.startsWith("::")?s=s.replace("::","Z:"):s=s.replace("::",":Z:"),s.indexOf(".")>0?(s=s.replace(new RegExp("[.]","g"),":"),u=s.split(":"),u[u.length-4]=bn(u[u.length-4])+bn(u[u.length-3])*256,u[u.length-3]=bn(u[u.length-2])+bn(u[u.length-1])*256,u=u.slice(0,u.length-2)):u=s.split(":"),p=0,m=0,f=0;f<u.length;f++)if(typeof u[f]=="string")if(u[f]==="Z"){for(m=0;m<8-u.length+1;m++)S[f+m]=0;p=m-1}else S[f+p]=nl(parseInt(u[f],16));else S[f+p]=u[f];return[S[1]<<16|S[0],S[3]<<16|S[2],S[5]<<16|S[4],S[7]<<16|S[6]]}var nr={address_map:{id:1,addrs:{},names:{}},lookup_name:function(s){var u=Zu(s);if(u!==null||(u=Dm(s),u!==null))return s;var f;if(nr.address_map.addrs[s])f=nr.address_map.addrs[s];else{var p=nr.address_map.id++;Se(p<65535,"exceeded max address mappings of 65535"),f="172.29."+(p&255)+"."+(p&65280),nr.address_map.names[f]=s,nr.address_map.addrs[s]=f}return f},lookup_addr:function(s){return nr.address_map.names[s]?nr.address_map.names[s]:null}};function Fm(s){var u=Nt(20),f=Nt(s.length+1);ye(s,f,s.length+1),ue[u>>2]=f;var p=Nt(4);ue[p>>2]=0,ue[u+4>>2]=p;var m=2;U[u+8>>2]=m,U[u+12>>2]=4;var w=Nt(12);return ue[w>>2]=w+8,ue[w+4>>2]=0,U[w+8>>2]=Zu(nr.lookup_name(s)),ue[u+16>>2]=w,u}function Lm(s){return Fm(re(s))}function Bm(s){var u=s.getExtension("ANGLE_instanced_arrays");if(u)return s.vertexAttribDivisor=function(f,p){u.vertexAttribDivisorANGLE(f,p)},s.drawArraysInstanced=function(f,p,m,w){u.drawArraysInstancedANGLE(f,p,m,w)},s.drawElementsInstanced=function(f,p,m,w,S){u.drawElementsInstancedANGLE(f,p,m,w,S)},1}function Um(s){var u=s.getExtension("OES_vertex_array_object");if(u)return s.createVertexArray=function(){return u.createVertexArrayOES()},s.deleteVertexArray=function(f){u.deleteVertexArrayOES(f)},s.bindVertexArray=function(f){u.bindVertexArrayOES(f)},s.isVertexArray=function(f){return u.isVertexArrayOES(f)},1}function Im(s){var u=s.getExtension("WEBGL_draw_buffers");if(u)return s.drawBuffers=function(f,p){u.drawBuffersWEBGL(f,p)},1}function Gm(s){return!!(s.multiDrawWebgl=s.getExtension("WEBGL_multi_draw"))}var Ae={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(u){Ae.lastError||(Ae.lastError=u)},getNewId:function(s){for(var u=Ae.counter++,f=s.length;f<u;f++)s[f]=null;return u},getSource:function(s,u,f,p){for(var m="",w=0;w<u;++w){var S=p?U[p+w*4>>2]:-1;m+=re(U[f+w*4>>2],S<0?void 0:S)}return m},createContext:function(s,u){if(!s.getContextSafariWebGL2Fixed){let m=function(w,S){var _=s.getContextSafariWebGL2Fixed(w,S);return w=="webgl"==_ instanceof WebGLRenderingContext?_:null};s.getContextSafariWebGL2Fixed=s.getContext,s.getContext=m}var f=s.getContext("webgl",u);if(!f)return 0;var p=Ae.registerContext(f,u);return p},registerContext:function(s,u){var f=Ae.getNewId(Ae.contexts),p={handle:f,attributes:u,version:u.majorVersion,GLctx:s};return s.canvas&&(s.canvas.GLctxObject=p),Ae.contexts[f]=p,(typeof u.enableExtensionsByDefault>"u"||u.enableExtensionsByDefault)&&Ae.initExtensions(p),f},makeContextCurrent:function(s){return Ae.currentContext=Ae.contexts[s],r.ctx=qe=Ae.currentContext&&Ae.currentContext.GLctx,!(s&&!qe)},getContext:function(s){return Ae.contexts[s]},deleteContext:function(s){Ae.currentContext===Ae.contexts[s]&&(Ae.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(Ae.contexts[s].GLctx.canvas),Ae.contexts[s]&&Ae.contexts[s].GLctx.canvas&&(Ae.contexts[s].GLctx.canvas.GLctxObject=void 0),Ae.contexts[s]=null},initExtensions:function(s){if(s||(s=Ae.currentContext),!s.initExtensionsDone){s.initExtensionsDone=!0;var u=s.GLctx;Bm(u),Um(u),Im(u),u.disjointTimerQueryExt=u.getExtension("EXT_disjoint_timer_query"),Gm(u);var f=u.getSupportedExtensions()||[];f.forEach(function(p){!p.includes("lose_context")&&!p.includes("debug")&&u.getExtension(p)})}}};function Ku(s){return s.slice(-1)=="]"&&s.lastIndexOf("[")}function Nm(s){var u=s.uniformLocsById,f=s.uniformSizeAndIdsByName,p,m;if(!u)for(s.uniformLocsById=u={},s.uniformArrayNamesById={},p=0;p<qe.getProgramParameter(s,35718);++p){var w=qe.getActiveUniform(s,p),S=w.name,_=w.size,E=Ku(S),P=E>0?S.slice(0,E):S,L=s.uniformIdCounter;for(s.uniformIdCounter+=_,f[P]=[_,L],m=0;m<_;++m)u[L]=m,s.uniformArrayNamesById[L++]=P}}function Vm(s,u){if(u=re(u),s=Ae.programs[s]){Nm(s);var f=s.uniformLocsById,p=0,m=u,w=Ku(u);w>0&&(p=bn(u.slice(w+1))>>>0,m=u.slice(0,w));var S=s.uniformSizeAndIdsByName[m];if(S&&p<S[0]&&(p+=S[1],f[p]=f[p]||qe.getUniformLocation(s,u)))return p}else Ae.recordError(1281);return-1}function or(s){var u=qe.currentProgram;if(u){var f=u.uniformLocsById[s];return typeof f=="number"&&(u.uniformLocsById[s]=f=qe.getUniformLocation(u,u.uniformArrayNamesById[s]+(f>0?"["+f+"]":""))),f}else Ae.recordError(1282)}function Hm(s,u){qe.uniform1f(or(s),u)}function zm(s,u){qe.uniform1i(or(s),u)}var So=[];function Wm(s,u,f){if(u<=144)for(var p=So[2*u-1],m=0;m<2*u;m+=2)p[m]=vt[f+4*m>>2],p[m+1]=vt[f+(4*m+4)>>2];else var p=vt.subarray(f>>2,f+u*8>>2);qe.uniform2fv(or(s),p)}var _o=[];function $m(s,u,f){if(u<=144)for(var p=_o[2*u-1],m=0;m<2*u;m+=2)p[m]=U[f+4*m>>2],p[m+1]=U[f+(4*m+4)>>2];else var p=U.subarray(f>>2,f+u*8>>2);qe.uniform2iv(or(s),p)}function Ym(s,u,f){if(u<=96)for(var p=So[3*u-1],m=0;m<3*u;m+=3)p[m]=vt[f+4*m>>2],p[m+1]=vt[f+(4*m+4)>>2],p[m+2]=vt[f+(4*m+8)>>2];else var p=vt.subarray(f>>2,f+u*12>>2);qe.uniform3fv(or(s),p)}function Xm(s,u,f){if(u<=96)for(var p=_o[3*u-1],m=0;m<3*u;m+=3)p[m]=U[f+4*m>>2],p[m+1]=U[f+(4*m+4)>>2],p[m+2]=U[f+(4*m+8)>>2];else var p=U.subarray(f>>2,f+u*12>>2);qe.uniform3iv(or(s),p)}function jm(s,u,f){if(u<=72){var p=So[4*u-1],m=vt;f>>=2;for(var w=0;w<4*u;w+=4){var S=f+w;p[w]=m[S],p[w+1]=m[S+1],p[w+2]=m[S+2],p[w+3]=m[S+3]}}else var p=vt.subarray(f>>2,f+u*16>>2);qe.uniform4fv(or(s),p)}function qm(s,u,f){if(u<=72)for(var p=_o[4*u-1],m=0;m<4*u;m+=4)p[m]=U[f+4*m>>2],p[m+1]=U[f+(4*m+4)>>2],p[m+2]=U[f+(4*m+8)>>2],p[m+3]=U[f+(4*m+12)>>2];else var p=U.subarray(f>>2,f+u*16>>2);qe.uniform4iv(or(s),p)}function Zm(s){}function To(s){return s%4===0&&(s%100!==0||s%400===0)}function Km(s,u){for(var f=0,p=0;p<=u;f+=s[p++]);return f}var Qu=[31,29,31,30,31,30,31,31,30,31,30,31],Ju=[31,28,31,30,31,30,31,31,30,31,30,31];function Qm(s,u){for(var f=new Date(s.getTime());u>0;){var p=To(f.getFullYear()),m=f.getMonth(),w=(p?Qu:Ju)[m];if(u>w-f.getDate())u-=w-f.getDate()+1,f.setDate(1),m<11?f.setMonth(m+1):(f.setMonth(0),f.setFullYear(f.getFullYear()+1));else return f.setDate(f.getDate()+u),f}return f}function Jm(s,u,f,p){var m=U[p+40>>2],w={tm_sec:U[p>>2],tm_min:U[p+4>>2],tm_hour:U[p+8>>2],tm_mday:U[p+12>>2],tm_mon:U[p+16>>2],tm_year:U[p+20>>2],tm_wday:U[p+24>>2],tm_yday:U[p+28>>2],tm_isdst:U[p+32>>2],tm_gmtoff:U[p+36>>2],tm_zone:m?re(m):""},S=re(f),_={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var E in _)S=S.replace(new RegExp(E,"g"),_[E]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],L=["January","February","March","April","May","June","July","August","September","October","November","December"];function B(O,W,Ne){for(var Te=typeof O=="number"?O.toString():O||"";Te.length<W;)Te=Ne[0]+Te;return Te}function D(O,W){return B(O,W,"0")}function G(O,W){function Ne(Qe){return Qe<0?-1:Qe>0?1:0}var Te;return(Te=Ne(O.getFullYear()-W.getFullYear()))===0&&(Te=Ne(O.getMonth()-W.getMonth()))===0&&(Te=Ne(O.getDate()-W.getDate())),Te}function Y(O){switch(O.getDay()){case 0:return new Date(O.getFullYear()-1,11,29);case 1:return O;case 2:return new Date(O.getFullYear(),0,3);case 3:return new Date(O.getFullYear(),0,2);case 4:return new Date(O.getFullYear(),0,1);case 5:return new Date(O.getFullYear()-1,11,31);case 6:return new Date(O.getFullYear()-1,11,30)}}function ve(O){var W=Qm(new Date(O.tm_year+1900,0,1),O.tm_yday),Ne=new Date(W.getFullYear(),0,4),Te=new Date(W.getFullYear()+1,0,4),Qe=Y(Ne),Ue=Y(Te);return G(Qe,W)<=0?G(Ue,W)<=0?W.getFullYear()+1:W.getFullYear():W.getFullYear()-1}var Fe={"%a":function(O){return P[O.tm_wday].substring(0,3)},"%A":function(O){return P[O.tm_wday]},"%b":function(O){return L[O.tm_mon].substring(0,3)},"%B":function(O){return L[O.tm_mon]},"%C":function(O){var W=O.tm_year+1900;return D(W/100|0,2)},"%d":function(O){return D(O.tm_mday,2)},"%e":function(O){return B(O.tm_mday,2," ")},"%g":function(O){return ve(O).toString().substring(2)},"%G":function(O){return ve(O)},"%H":function(O){return D(O.tm_hour,2)},"%I":function(O){var W=O.tm_hour;return W==0?W=12:W>12&&(W-=12),D(W,2)},"%j":function(O){return D(O.tm_mday+Km(To(O.tm_year+1900)?Qu:Ju,O.tm_mon-1),3)},"%m":function(O){return D(O.tm_mon+1,2)},"%M":function(O){return D(O.tm_min,2)},"%n":function(){return`
`},"%p":function(O){return O.tm_hour>=0&&O.tm_hour<12?"AM":"PM"},"%S":function(O){return D(O.tm_sec,2)},"%t":function(){return"	"},"%u":function(O){return O.tm_wday||7},"%U":function(O){var W=O.tm_yday+7-O.tm_wday;return D(Math.floor(W/7),2)},"%V":function(O){var W=Math.floor((O.tm_yday+7-(O.tm_wday+6)%7)/7);if((O.tm_wday+371-O.tm_yday-2)%7<=2&&W++,W){if(W==53){var Te=(O.tm_wday+371-O.tm_yday)%7;Te!=4&&(Te!=3||!To(O.tm_year))&&(W=1)}}else{W=52;var Ne=(O.tm_wday+7-O.tm_yday-1)%7;(Ne==4||Ne==5&&To(O.tm_year%400-1))&&W++}return D(W,2)},"%w":function(O){return O.tm_wday},"%W":function(O){var W=O.tm_yday+7-(O.tm_wday+6)%7;return D(Math.floor(W/7),2)},"%y":function(O){return(O.tm_year+1900).toString().substring(2)},"%Y":function(O){return O.tm_year+1900},"%z":function(O){var W=O.tm_gmtoff,Ne=W>=0;return W=Math.abs(W)/60,W=W/60*100+W%60,(Ne?"+":"-")+String("0000"+W).slice(-4)},"%Z":function(O){return O.tm_zone},"%%":function(){return"%"}};S=S.replace(/%%/g,"\0\0");for(var E in Fe)S.includes(E)&&(S=S.replace(new RegExp(E,"g"),Fe[E](w)));S=S.replace(/\0\0/g,"%");var Be=Co(S,!1);return Be.length>u?0:(er(Be,s),Be.length-1)}function e0(s,u,f,p){return Jm(s,u,f,p)}var el=function(s,u,f,p){s||(s=this),this.parent=s,this.mount=s.mount,this.mounted=null,this.id=y.nextInode++,this.name=u,this.mode=f,this.node_ops={},this.stream_ops={},this.rdev=p},Eo=365,xo=146;Object.defineProperties(el.prototype,{read:{get:function(){return(this.mode&Eo)===Eo},set:function(s){s?this.mode|=Eo:this.mode&=~Eo}},write:{get:function(){return(this.mode&xo)===xo},set:function(s){s?this.mode|=xo:this.mode&=~xo}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=el,y.staticInit(),eg(),Ur=r.BindingError=ki(Error,"BindingError"),Uu=r.InternalError=ki(Error,"InternalError"),yg(),cg(),Cg(),zu=r.UnboundTypeError=ki(Error,"UnboundTypeError"),Ug();for(var qe,t0=new Float32Array(288),Gt=0;Gt<288;++Gt)So[Gt]=t0.subarray(0,Gt+1);for(var r0=new Int32Array(288),Gt=0;Gt<288;++Gt)_o[Gt]=r0.subarray(0,Gt+1);function Co(s,u,f){var p=f>0?f:ae(s)+1,m=new Array(p),w=ce(s,m,0,m.length);return u&&(m.length=w),m}var n0={ga:Fv,k:Lv,b:Bv,c:Iv,Q:zv,R:Wv,q:Yv,K:Xv,U:jv,I:qv,H:Zv,u:Kv,J:Qv,z:Jv,W:ng,d:Og,f:Mg,e:Dg,a:Fg,V:Ig,g:Ng,h:Vg,v:zg,j:$g,i:Yg,w:Xg,r:jg,X:qg,N:Zg,M:Qg,m:Jg,ka:rm,x:Bi,la:nm,ja:sm,s:am,E:um,ia:lm,ma:cm,n:fm,l:hm,na:pm,O:dm,D:vm,P:Ni,t:mm,C:ym,L:wm,o:Sm,F:Tm,G:Em,fa:xm,p:Cm,T:Pm,y:Rm,S:Mm,ha:Lm,ea:Vm,ca:Hm,da:zm,_:Wm,ba:$m,Z:Ym,aa:Xm,Y:jm,$:qm,A:Zm,B:e0};Dv(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var Nt=r._malloc=function(){return(Nt=r._malloc=r.asm.qa).apply(null,arguments)},Vt=r._free=function(){return(Vt=r._free=r.asm.ra).apply(null,arguments)},tl=r.___errno_location=function(){return(tl=r.___errno_location=r.asm.sa).apply(null,arguments)},rl=r.___getTypeName=function(){return(rl=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var nl=r._htons=function(){return(nl=r._htons=r.asm.wa).apply(null,arguments)},ol=r._emscripten_builtin_memalign=function(){return(ol=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},il=r.___cxa_is_pointer_type=function(){return(il=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Aa).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Ea).apply(null,arguments)},r.FS=y;var ko;function Hi(s){this.name="ExitStatus",this.message="Program terminated with exit("+s+")",this.status=s}dn=function s(){ko||zi(),ko||(dn=s)};function zi(s){if(vr>0||(xv(),vr>0))return;function u(){ko||(ko=!0,r.calledRun=!0,!be&&(Cv(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),kv()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),u()},1)):u()}r.run=zi;function o0(s,u){i0(s)}function i0(s){Ou()||(r.onExit&&r.onExit(s),be=!0),l(s,new Hi(s))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return zi(),r.ready}})(),al="/cad-os/assets/replicad_single-b4564eab.wasm";const Po={library:null},ul=t=>{Po.library=t},I=()=>{if(!Po.library)throw new Error("oppencascade has not been loaded");return Po.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const Ir=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class Je{constructor(e){this.oc=I(),e&&Ir.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(Ir.unregister(this._wrapped),this._wrapped.delete()),Ir.register(this,e,e),this._wrapped=e}delete(){var e;Ir.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const Ee=()=>{function t(e){return Ir.register(t,e),e}return t},Ie=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},Wi=2147483647,at=Math.PI/180,Gr=180/Math.PI,Ao=t=>Math.round(t*1e3)/1e3,Nr=(t,e,r)=>{const n=I(),o=et(t),i=xt(e);let a;if(r){const l=xt(r);a=new n.gp_Ax3_3(o,i,l),l.delete()}else a=new n.gp_Ax3_4(o,i);return o.delete(),i.delete(),a},Vr=(t,e,r)=>{const n=I(),o=et(t),i=xt(e);let a;if(r){const l=xt(r);a=new n.gp_Ax2_2(o,i,l),l.delete()}else a=new n.gp_Ax2_3(o,i);return o.delete(),i.delete(),a},Hr=(t,e)=>{const r=I(),n=et(t),o=xt(e),i=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),i},ll=(t=[0,0,0])=>{const e=I();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof R)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class R extends Je{constructor(e=[0,0,0]){super(ll(e))}get repr(){return`x: ${Ao(this.x)}, y: ${Ao(this.y)}, z: ${Ao(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new R(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new R(this.wrapped.Subtracted(e.wrapped))}add(e){return new R(this.wrapped.Added(e.wrapped))}multiply(e){return new R(this.wrapped.Multiplied(e))}normalized(){return new R(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*Gr}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),i=n.multiply(o.dot(n)/n.Length**2),a=this.sub(i);return o.delete(),i.delete(),a}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Hr(r,n);return this.wrapped.Rotate(o,e*at),o.delete(),this}}const cl={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function fl(t){return t==="X"||t==="Y"||t==="Z"?cl[t]:t}function et(t){const e=new R(t),r=e.toPnt();return e.delete(),r}function xt(t){const e=new R(t),r=e.toDir();return e.delete(),r}class ir extends Je{constructor(e){const r=I();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new R(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=xt(n),i=et(r),a=new this.oc.gp_Ax1_2(i,o);return this.wrapped.SetRotation_1(a,e*at),a.delete(),o.delete(),i.delete(),this}mirror(e="YZ",r){const n=Ee();let o,i;if(typeof e=="string"){const l=n($i(e,r));o=l.origin,i=l.zDir}else e instanceof je?(o=r||e.origin,i=e.zDir):(o=r||[0,0,0],i=e);const a=n(Vr(o,i));return this.wrapped.SetMirror_3(a),this}scale(e,r){const n=et(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=Ee(),o=n(e==="reference"?new this.oc.gp_Ax3_1:Nr(e.origin,e.zDir,e.xDir)),i=n(r==="reference"?new this.oc.gp_Ax3_1:Nr(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,i),this}transformPoint(e){const r=et(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class je{constructor(e,r=null,n=[0,0,1]){this.oc=I();const o=new R(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let i;if(r)i=new R(r);else{const a=Nr(e,o);i=new R(a.XDirection()),a.delete()}if(i.Length===0)throw new Error("xDir should be non null");this.xDir=i.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new R(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new je(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new R(e),r}translate(e,r=0,n=0){const o=new R(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=fl(r),o=new R(this.zDir).rotate(e,[0,0,0],n),i=new R(this.xDir).rotate(e,[0,0,0],n);return new je(this.origin,i,o)}rotate2DAxes(e){const r=new R(this.xDir).rotate(e,[0,0,0],this.zDir);return new je(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=Nr(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new ir,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new ir,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new R(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new R(r);return r.delete(),n}}const hl={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},$i=(t,e=[0,0,0])=>{const r=hl[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new je(n,r.xDir,r.normal)};let pl=class extends Je{constructor(e){const r=I();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new R(e).repr} - ${new R(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},i={current:0},a={current:0};return this.wrapped.Get(e,r,n,o,i,a),[[e.current,r.current,n.current],[o.current,i.current,a.current]]}get center(){const[[e,r,n],[o,i,a]]=this.bounds;return[e+(o-e)/2,r+(i-r)/2,n+(a-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function Ht(t="XY",e=[0,0,0]){return t instanceof je?t.clone():$i(t,e)}function dl(t,e,r=[0,0,0],n=[0,0,1]){const o=new ir;o.rotate(e,r,n);const i=o.transform(t);return o.delete(),i}function vl(t,e){const r=new ir;r.translate(e);const n=r.transform(t);return r.delete(),n}function gl(t,e,r){const n=new ir;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function ml(t,e,r){const n=new ir;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function Sn(t){return Array.isArray(t)&&t.length===2}let _n=null;const Yi=t=>{if(_n&&!t)return _n;const r=I().GeomAbs_CurveType;return _n=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),_n},zr=t=>{let e=Yi().get(t);if(e||(e=Yi(!0).get(t)),!e)throw new Error("unknown type");return e};function yl(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function wl(t){return Array.from(Array(t).keys())}function br(t){const e=Math.min(...t.map(r=>r.length));return wl(e).map(r=>t.map(n=>n[r]))}function Tn(t){return Math.round(t*100)/100}const Wr=([t,e])=>`(${Tn(t)},${Tn(e)})`,Xi=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},ji=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${Xi(r,e)},${Xi(n,e)}]`,[r,n]])).values()),We=([t,e])=>{const r=I();return new r.gp_Pnt2d_3(t,e)},bl=([t,e])=>{const r=I();return new r.gp_Dir2d_4(t,e)},qi=([t,e])=>{const r=I();return new r.gp_Vec2d_4(t,e)},Sr=(t,e)=>{const r=I(),[n,o]=Ie(),i=new r.gp_Ax2d_2(n(We(t)),n(bl(e)));return o(),i};class $r extends Je{constructor(e){const r=I();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${Wr(e)} - ${Wr(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],i=n[1]-r[1];return[n[0]+o/100*e,n[1]+i/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=Ee()(We(e));return!this.wrapped.IsOut_1(n)}}const $e=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,_r=([t,e],[r,n])=>[t+r,e+n],Ro=([t,e],[r,n])=>[t-r,e-n],Oo=([t,e],r)=>[t*r,e*r],mt=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),Sl=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function _l([t,e],[r,n]){return t*n-e*r}const Tl=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),El=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),zt=([t,e])=>{const r=mt([t,e]);return[t/r,e/r]},xl=(t,e,r=[0,0])=>{const[n,o]=t,[i,a]=r,l=n-i,c=o-a,h=Math.sin(e),d=Math.cos(e),g=l*d-c*h,v=l*h+c*d;return[g+i,v+a]},Tr=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},Cl=([t,e])=>{const r=mt([t,e]),n=Math.atan2(e,t);return[r,n]};class Me extends Je{constructor(e){const r=I(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=I(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new $r(r),this._boundingBox}get repr(){return`${this.geomType} ${Wr(this.firstPoint)} - ${Wr(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=I();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=zr(e.GetType());return e.delete(),r}clone(){return new Me(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=I(),n=Ee(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(We(e)),this.wrapped));let i=1/0;try{i=o.LowerDistance()}catch{i=1/0}return Math.min(i,mt(e,this.firstPoint),mt(e,this.lastPoint))}distanceFromCurve(e){const r=I(),n=Ee();let o=1/0;const i=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=i.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return Sn(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=I(),o=Ee();let i,a;try{const l=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(We(e)),this.wrapped));i=l.LowerDistance(),a=l.LowerDistanceParameter()}catch{if($e(e,this.firstPoint,r))return this.firstParameter;if($e(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(i>r)throw new Error(`Point ${Wr(e)} not on curve ${this.repr}, ${i.toFixed(9)}`);return a}tangentAt(e){const r=I(),[n,o]=Ie();let i;Array.isArray(e)?i=this.parameter(e):i=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const a=n(new r.gp_Pnt2d_1),l=n(new r.gp_Vec2d_1);this.innerCurve.D1(i,a,l);const c=[l.X(),l.Y()];return o(),c}splitAt(e,r=1e-9){const n=I(),o=Ee();let i=e.map(c=>Sn(c)?this.parameter(c,r):c);i=Array.from(new Map(i.map(c=>[yl(c,-Math.log10(r)),c])).values()).sort((c,h)=>c-h);const a=this.firstParameter,l=this.lastParameter;return a>l&&i.reverse(),Math.abs(i[0]-a)<r*100&&(i=i.slice(1)),i.length?(Math.abs(i[i.length-1]-l)<r*100&&(i=i.slice(0,-1)),i.length?br([[a,...i],[...i,l]]).map(([c,h])=>{try{if(this.geomType==="BEZIER_CURVE"){const g=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return g.Segment(c,h),new Me(new n.Handle_Geom2d_Curve_2(g))}if(this.geomType==="BSPLINE_CURVE"){const g=o(this.adaptor()).BSpline().get(),v=new n.Geom2d_BSplineCurve_1(g.Poles_2(),g.Knots_2(),g.Multiplicities_2(),g.Degree(),g.IsPeriodic());return v.Segment(c,h,r),new Me(new n.Handle_Geom2d_Curve_2(v))}const d=new n.Geom2d_TrimmedCurve(this.wrapped,c,h,!0,!0);return new Me(new n.Handle_Geom2d_Curve_2(d))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const Zi=(t,e=1e-4,r="C0",n=200)=>{const o=I(),i=Ee(),a={C0:o.GeomAbs_Shape.GeomAbs_C0,C1:o.GeomAbs_Shape.GeomAbs_C1,C2:o.GeomAbs_Shape.GeomAbs_C2,C3:o.GeomAbs_Shape.GeomAbs_C3},l=i(new o.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,a[r],n,3));return new Me(l.Curve())},Ki=t=>{if(zr(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=I(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const a=n.NbArcs();if(a)for(let l=1;l<=a;l++){const c=n.Arc(l);yield new Me(c)}}const i=Array.from(o());return n.delete(),i};function En(t,e={tolerance:1e-4,continuity:"C0",maxSegments:300}){const r=Ee();return t.flatMap(n=>{const o=r(n.adaptor()),i=zr(o.GetType());if(i==="ELLIPSE"||i==="CIRCLE"&&$e(n.firstPoint,n.lastPoint))return n.splitAt([.5]);if(["LINE","ELLIPSE","CIRCLE"].includes(i))return n;if(i==="BEZIER_CURVE"){const c=o.Bezier().get().Degree();if([1,2,3].includes(c))return n}if(i==="BSPLINE_CURVE"){const l=Ki(o);return En(l,e)}const a=Zi(o,e.tolerance,e.continuity,e.maxSegments);return En(Ki(r(a.adaptor())),e)})}function*Qi(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*kl(t){const e=t.NbSegments();if(!e)return;const r=I();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,i=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,i)}catch{continue}yield new Me(o),i.delete()}}const Yr=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=I(),o=new n.Geom2dAPI_InterCurveCurve_1;let i,a;try{o.Init_1(t.wrapped,e.wrapped,r),i=Array.from(Qi(o)),a=Array.from(kl(o))}catch(h){throw console.error(t,e,h),new Error("Intersections failed between curves")}finally{o.delete()}const l=a.filter(h=>$e(h.firstPoint,h.lastPoint,r)).map(h=>h.firstPoint);l.length&&(i.push(...l),a=a.filter(h=>!$e(h.firstPoint,h.lastPoint,r)));const c=a.flatMap(h=>[h.firstPoint,h.lastPoint]);return{intersections:i,commonSegments:a,commonSegmentsPoints:c}},Pl=(t,e=1e-9)=>{const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from(Qi(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},Xr=(t,e)=>{const r=I(),[n,o]=Ie(),i=n(new r.GCE2d_MakeSegment_1(n(We(t)),n(We(e)))).Value(),a=new Me(i);return $e(a.firstPoint,t)||a.reverse(),o(),a},Mo=(t,e,r)=>{const n=I(),[o,i]=Ie(),a=o(new n.GCE2d_MakeArcOfCircle_4(o(We(t)),o(We(e)),o(We(r)))).Value();i();const l=new Me(a);return $e(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},Al=(t,e,r)=>{const n=I(),[o,i]=Ie(),a=o(new n.GCE2d_MakeArcOfCircle_5(o(We(t)),o(qi(e)),o(We(r)))).Value();i();const l=new Me(a);return $e(l.firstPoint,t)||l.wrapped.get().SetTrim(l.lastParameter,l.firstParameter,!0,!0),l},Rl=(t,e,r,n,o=[0,0],i,a=!0)=>{const l=I(),[c,h]=Ie(),d=c(new l.gp_Elips2d_2(c(Sr(o,i)),t,e,!0)),g=c(new l.GCE2d_MakeArcOfEllipse_1(d,r,n,a)).Value();return h(),new Me(g)},Ol=(t,e,r)=>{const n=I(),[o,i]=Ie(),a=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));a.SetValue(1,o(We(t))),e.forEach((c,h)=>{a.SetValue(h+2,o(We(c)))}),a.SetValue(e.length+2,o(We(r)));const l=new n.Geom2d_BezierCurve_1(a);return i(),new Me(new n.Handle_Geom2d_Curve_2(l))},Ji=(t,e,r)=>{const n=Oo(_r(t,e),.5),o=mt(r,t),i=zt(Ro(n,r));return Mo(t,_r(Oo(i,o),r),e)},Ml=(t,e,r)=>{const n=zt(Ro(e,t)),o=[n[1],-n[0]],i=[o[0]*r,o[1]*r];return{firstPoint:_r(t,i),lastPoint:_r(e,i)}},Do=(t,e)=>{const r=Ee(),n=t.geomType;if(n==="CIRCLE"){const c=r(r(t.adaptor()).Circle()),h=c.Radius(),d=c.IsDirect()?1:-1,g=e*d,v=h+g;if(v<1e-10){const A=r(c.Location()),F=[A.X(),A.Y()],M=$=>{const[V,q]=zt(Ro($,F));return _r($,[g*V,g*q])};return{collapsed:!0,firstPoint:M(t.firstPoint),lastPoint:M(t.lastPoint)}}const b=I(),T=new b.gp_Circ2d_3(c.Axis(),v),C=new b.Geom2d_Circle_1(T),x=new b.Geom2d_TrimmedCurve(new b.Handle_Geom2d_Curve_2(C),t.firstParameter,t.lastParameter,!0,!0);return new Me(new b.Handle_Geom2d_Curve_2(x))}if(n==="LINE"){const{firstPoint:c,lastPoint:h}=Ml(t.firstPoint,t.lastPoint,e);return Xr(c,h)}const o=I(),i=new Me(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),a=Zi(i.adaptor());return Pl(a).length?{collapsed:!0,firstPoint:a.firstPoint,lastPoint:a.lastPoint}:a};function es(t,e,r){const n=_l(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,i=Math.abs(r)*o,a=Do(t,i),l=Do(e,i);if(!(a instanceof Me)||!(l instanceof Me))return null;let c;try{const{intersections:b}=Yr(a,l,1e-9);c=b.at(-1)}catch{return null}if(!Sn(c))return null;const h=c,d=(b,T)=>{const[C,x]=T.tangentAt(h),A=zt([-x,C]),F=_r(h,Oo(A,i)),M=b.parameter(F,1e-6);return b.splitAt([M])},[g]=d(t,a),[,v]=d(e,l);return{first:g,second:v,center:h}}function Fo(t,e,r){const n=es(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:i,center:a}=n;return[o,Ji(o.lastPoint,i.firstPoint,a),i]}function Lo(t,e,r){const n=es(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:i}=n;return[o,Xr(o.lastPoint,i.firstPoint),i]}class Dl{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,i=this.values[o];if(r>=i)break;this.ids[n]=this.ids[o],this.values[n]=i,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let i=0;for(;i<o;){let a=(i<<1)+1;const l=a+1;let c=this.ids[a],h=this.values[a];const d=this.values[l];if(l<this.length&&d<h&&(a=l,c=this.ids[l],h=d),h>=n)break;this.ids[i]=c,this.values[i]=h,i=a}this.ids[i]=r,this.values[i]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const ts=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Bo=3;class Uo{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==Bo)throw new Error(`Got v${n>>4} data when expected v${Bo}.`);const[o]=new Uint16Array(e,2,1),[i]=new Uint32Array(e,4,1);return new Uo(i,o,ts[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let i=e,a=i;this._levelBounds=[i*4];do i=Math.ceil(i/this.nodeSize),a+=i,this._levelBounds.push(a*4);while(i!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=a<16384?Uint16Array:Uint32Array;const l=ts.indexOf(this.ArrayType),c=a*4*this.ArrayType.BYTES_PER_ELEMENT;if(l<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=a*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+c+a*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,a*4),this._indices=new this.IndexArrayType(this.data,8+c,a),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Bo<<4)+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new Dl}add(e,r,n,o){const i=this._pos>>2;return this._indices[i]=i,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),i}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=(1<<16)-1;for(let i=0;i<this.numItems;i++){let a=4*i;const l=this._boxes[a++],c=this._boxes[a++],h=this._boxes[a++],d=this._boxes[a++],g=Math.floor(o*((l+h)/2-this.minX)/e),v=Math.floor(o*((c+d)/2-this.minY)/r);n[i]=Ll(g,v)}Io(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,a=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;a<l;){const c=a;let h=1/0,d=1/0,g=-1/0,v=-1/0;for(let b=0;b<this.nodeSize&&a<l;b++)h=Math.min(h,this._boxes[a++]),d=Math.min(d,this._boxes[a++]),g=Math.max(g,this._boxes[a++]),v=Math.max(v,this._boxes[a++]);this._indices[this._pos>>2]=c,this._boxes[this._pos++]=h,this._boxes[this._pos++]=d,this._boxes[this._pos++]=g,this._boxes[this._pos++]=v}}}search(e,r,n,o,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=[],c=[];for(;a!==void 0;){const h=Math.min(a+this.nodeSize*4,ns(a,this._levelBounds));for(let d=a;d<h;d+=4){if(n<this._boxes[d]||o<this._boxes[d+1]||e>this._boxes[d+2]||r>this._boxes[d+3])continue;const g=this._indices[d>>2]|0;a<this.numItems*4?(i===void 0||i(g))&&c.push(g):l.push(g)}a=l.pop()}return c}neighbors(e,r,n=1/0,o=1/0,i){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let a=this._boxes.length-4;const l=this._queue,c=[],h=o*o;for(;a!==void 0;){const d=Math.min(a+this.nodeSize*4,ns(a,this._levelBounds));for(let g=a;g<d;g+=4){const v=this._indices[g>>2]|0,b=rs(e,this._boxes[g],this._boxes[g+2]),T=rs(r,this._boxes[g+1],this._boxes[g+3]),C=b*b+T*T;a<this.numItems*4?(i===void 0||i(v))&&l.push((v<<1)+1,C):l.push(v<<1,C)}for(;l.length&&l.peek()&1;)if(l.peekValue()>h||(c.push(l.pop()>>1),c.length===n))return l.clear(),c;a=l.pop()>>1}return l.clear(),c}}function rs(t,e,r){return t<e?e-t:t<=r?0:t-r}function ns(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function Io(t,e,r,n,o,i){if(Math.floor(n/i)>=Math.floor(o/i))return;const a=t[n+o>>1];let l=n-1,c=o+1;for(;;){do l++;while(t[l]<a);do c--;while(t[c]>a);if(l>=c)break;Fl(t,e,r,l,c)}Io(t,e,r,n,c,i),Io(t,e,r,c+1,o,i)}function Fl(t,e,r,n,o){const i=t[n];t[n]=t[o],t[o]=i;const a=4*n,l=4*o,c=e[a],h=e[a+1],d=e[a+2],g=e[a+3];e[a]=e[l],e[a+1]=e[l+1],e[a+2]=e[l+2],e[a+3]=e[l+3],e[l]=c,e[l+1]=h,e[l+2]=d,e[l+3]=g;const v=r[n];r[n]=r[o],r[o]=v}function Ll(t,e){let r=t^e,n=65535^r,o=65535^(t|e),i=t&(e^65535),a=r|n>>1,l=r>>1^r,c=o>>1^n&i>>1^o,h=r&o>>1^i>>1^i;r=a,n=l,o=c,i=h,a=r&r>>2^n&n>>2,l=r&n>>2^n&(r^n)>>2,c^=r&o>>2^n&i>>2,h^=n&o>>2^(r^n)&i>>2,r=a,n=l,o=c,i=h,a=r&r>>4^n&n>>4,l=r&n>>4^n&(r^n)>>4,c^=r&o>>4^n&i>>4,h^=n&o>>4^(r^n)&i>>4,r=a,n=l,o=c,i=h,c^=r&o>>8^n&i>>8,h^=n&o>>8^(r^n)&i>>8,r=c^c>>1,n=h^h>>1;let d=t^e,g=n|65535^(d|r);return d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,(g<<1|d)>>>0}const os=(t,e=1e-7)=>{const r=new Uo(t.length);t.forEach(i=>{const[a,l]=i.firstPoint;r.add(a-e,l-e,a+e,l+e)}),r.finish();const n=[],o=new Set;return t.forEach((i,a)=>{if(o.has(a))return;const l=[i];let c=a;o.add(a);let h=t.length;for(;;){if(h--<0)throw new Error("Infinite loop detected");const d=l[l.length-1].lastPoint,[g,v]=d,b=r.search(g-e,v-e,g+e,v+e),T=F=>Math.abs((c-F)%t.length),C=b.filter(F=>!o.has(F)).map(F=>[t[F],F,T(F)]).sort(([,,F],[,,M])=>T(F)-T(M));if(C.length===0){n.push(l);break}const[x,A]=C[0];l.push(x),o.add(A),c=A}}),n};function ut(t){return Math.round(t*1e5)/1e5}const Go=t=>`${Tn(t.X())} ${Tn(t.Y())}`,Bl=(t,e)=>{const r=I(),n=zr(t.GetType()),[o,i]=e,a=`${ut(o)} ${ut(i)}`;if(n==="LINE")return`L ${a}`;if(n==="BEZIER_CURVE"){const l=t.Bezier().get(),c=l.Degree();if(c===1)return`L ${a}`;if(c===2)return`Q ${Go(l.Pole(2))} ${a}`;if(c===3){const h=Go(l.Pole(2)),d=Go(l.Pole(3));return`C ${h} ${d} ${a}`}}if(n==="CIRCLE"){const l=t.Circle(),c=l.Radius(),h=t.FirstParameter(),g=(t.LastParameter()-h)*Gr,v=g!==360?a:`${ut(o)} ${ut(i+1e-4)}`;return`A ${c} ${c} 0 ${Math.abs(g)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${v}`}if(n==="ELLIPSE"){const l=t.Ellipse(),c=l.MajorRadius(),h=l.MinorRadius(),d=t.FirstParameter(),v=(t.LastParameter()-d)*Gr,b=v!==360?a:`${ut(o)} ${ut(i+1e-4)}`,T=new r.gp_Dir2d_1,C=180-l.XAxis().Direction().Angle(T)*Gr;return T.delete(),`A ${ut(c)} ${ut(h)} ${ut(C)} ${Math.abs(v)>180?"1":"0"} ${l.IsDirect()?"1":"0"} ${b}`}throw new Error(`Unsupported curve type: ${n}`)},Ul={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},xn={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class is{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const i=new this.constructor;return o(i),i}),n=({element:o})=>r.some(i=>i.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Il extends Je{constructor(){const e=I();super(new e.Message_ProgressRange_1)}}class No extends Je{constructor(e){const r=I();super(new r.BRepExtrema_DistShapeShape_1),this.wrapped.LoadS1(e.wrapped)}distanceTo(e){this.wrapped.LoadS2(e.wrapped);const r=new Il;return this.wrapped.Perform(r.wrapped),this.wrapped.Value()}}class ss extends is{when(e){return this.filters.push(e),this}inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new R(Ul[e]):n=new R(e);const o=({normal:i})=>{if(!i)return!1;const a=Math.acos(Math.abs(i.dot(n)));return Math.abs(a-at*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=On(r),o=new No(n),i=({element:a})=>Math.abs(o.distanceTo(a)-e)<1e-6;return this.filters.push(i),this}containsPoint(e){return this.atDistance(0,e)}withinDistance(e,r=[0,0,0]){const n=On(r),o=new No(n),i=({element:a})=>o.distanceTo(a)-e<1e-6;return this.filters.push(i),this}inBox(e,r){const n=qr(e,r);return this.inShape(n)}inShape(e){const r=new No(e),n=({element:o})=>r.distanceTo(o)<1e-6;return this.filters.push(n),this}}class Cn extends ss{clone(){const e=new Cn;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&xn[e])return this.atAngleWith(xn[e],90);if(typeof e!="string"&&e instanceof je)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof je?Ht(e):Ht(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.startPoint,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class Vo extends ss{clone(){const e=new Vo;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&xn[e])return this.atAngleWith(xn[e]);if(typeof e!="string"&&e instanceof je)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof je?Ht(e):Ht(e,r);this.parallelTo(n);const o=({element:i})=>{const a=i.center,l=a.projectToPlane(n);return a.equals(l)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const Gl=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},Ho=2*Math.PI,as=t=>{const e=t%Ho,r=e<0?e+Ho:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-Ho)};class kn extends is{clone(){const e=new kn;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>$e(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(mt(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return $e(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[i,a]=r,l=Math.min(n,i),c=Math.max(n,i),h=Math.min(o,a),d=Math.max(o,a);function g({element:v}){const[b,T]=v.point;return b>=l&&b<=c&&T>=h&&T<=d}return this.filters.push(g),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),i=n.secondCurve.tangentAt(0);return Math.abs(as(Tl(o,i))-as(at*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return Gl(e).filter(r=>this.shouldKeep(r))}}const us=t=>{const e=I();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},Nl=function*(e,r){const n=I(),o=new n.TopExp_Explorer_2(e,us(r),us("shape")),i=new Map;for(;o.More();){const a=o.Current(),l=a.HashCode(Wi);i.get(l)||(i.set(l,!0),yield a),o.Next()}o.delete()},ls=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class Pn extends Je{constructor(e){super(e)}clone(){return new this.constructor(ar(this.wrapped))}get hashCode(){return this.wrapped.HashCode(Wi)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=I(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=Pe(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,i=Pe(vl(this.wrapped,o));if(this.delete(),this.constructor!==i.constructor)throw new Error("unexpected types mismatch");return i}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Pe(dl(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=Pe(gl(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=Pe(ml(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return Nl(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>ar(r))}get edges(){return this._listTopo("edge").map(e=>new Wt(e))}get faces(){return this._listTopo("face").map(e=>new Er(e))}get wires(){return this._listTopo("wire").map(e=>new Ct(e))}get boundingBox(){const e=new pl;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],i=[];const a=[];for(const l of this.faces){const c=l.triangulation(o.length/3);if(!c)continue;const{trianglesIndexes:h,vertices:d,verticesNormals:g}=c;a.push({start:n.length,count:h.length,faceId:l.hashCode}),n=n.concat(h),o=o.concat(d),i=i.concat(g)}return{triangles:n,vertices:o,normals:i,faceGroups:a}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=Ee(),i=new Set,a=[],l=[],c=()=>{const d=a.length;let g=null;return[v=>{g?(a.push(...g),g=[v.X(),v.Y(),v.Z()],a.push(...g)):g=[v.X(),v.Y(),v.Z()]},v=>{l.push({start:d/3,count:(a.length-d)/3,edgeId:v}),i.add(v)}]},h=o(new this.oc.TopLoc_Location_1);for(const d of this.faces){const g=o(this.oc.BRep_Tool.Triangulation(d.wrapped,h,0));if(g.IsNull())continue;const v=g.get();for(const b of d.edges){if(o(b),i.has(b.hashCode))continue;const T=o(new this.oc.TopLoc_Location_1),C=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(b.wrapped,g,T)),x=(n=C==null?void 0:C.get())==null?void 0:n.Nodes();if(!x)continue;o(x);const[A,F]=c();for(let M=x.Lower();M<=x.Upper();M++){const $=o(o(v.Node(x.Value(M))).Transformed(T.Transformation()));A($)}F(b.hashCode)}}for(const d of this.edges){o(d);const g=d.hashCode;if(i.has(g))continue;const v=o(new this.oc.BRepAdaptor_Curve_2(d.wrapped)),b=o(new this.oc.GCPnts_TangentialDeflection_2(v,e,r,2,1e-9,1e-7)),[T,C]=c();for(let x=0;x<b.NbPoints();x++){const A=o(b.Value(x+1).Transformed(h.Transformation()));T(A)}C(g)}return{lines:a,edgeGroups:l}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const i=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([i],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const a=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([a],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class cs extends Pn{}class fs extends Pn{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new Vl(this._geomAdaptor())}get startPoint(){return this.curve.startPoint}get endPoint(){return this.curve.endPoint}tangentAt(e=0){return this.curve.tangentAt(e)}pointAt(e=0){return this.curve.pointAt(e)}get isClosed(){return this.curve.isClosed}get isPeriodic(){return this.curve.isPeriodic}get period(){return this.curve.period}get geomType(){return this.curve.curveType}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class Vl extends Je{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return zr(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new R(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new R(e)}_mapParameter(e){const r=this.wrapped.FirstParameter(),n=this.wrapped.LastParameter();return r+(n-r)*e}pointAt(e=.5){return new R(this.wrapped.Value(this._mapParameter(e)))}tangentAt(e=.5){const r=this._mapParameter(e),n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const i=new R(o);return n.delete(),o.delete(),i}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Wt extends fs{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class Ct extends fs{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const i=Pe(o.Shape());if(o.delete(),this.delete(),!(i instanceof Ct))throw new Error("Could not offset with a wire");return i}}class Hl extends Je{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class Er extends Pn{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new Hl(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:i,vMax:a}=this.UVBounds,l=this._geomAdaptor(),c=new this.oc.gp_Pnt_1,h=e*(o-n)+n,d=r*(a-i)+i;l.D0(h,d,c);const g=new R(c);return l.delete(),c.delete(),g}normalAt(e){let r=0,n=0;const o=Ee();if(e){const h=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),d=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(et(e)),h,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),g={current:0},v={current:0};d.LowerDistanceParameters(g,v),r=g.current,n=v.current}else{const{uMin:h,uMax:d,vMin:g,vMax:v}=this.UVBounds;r=.5*(h+d),n=.5*(g+v)}const i=o(new this.oc.gp_Pnt_1),a=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,i,a),new R(a)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new R(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new Ct(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=Ee(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const i=r(n.Transformation()),a={vertices:[],trianglesIndexes:[],verticesNormals:[]},l=o.get(),c=l.NbNodes();a.vertices=new Array(c*3);for(let T=1;T<=c;T++){const C=r(r(l.Node(T)).Transformed(i));a.vertices[(T-1)*3+0]=C.X(),a.vertices[(T-1)*3+1]=C.Y(),a.vertices[(T-1)*3+2]=C.Z()}const h=r(new this.oc.TColgp_Array1OfDir_2(1,c)),d=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,d,h),a.verticesNormals=new Array(h.Length()*3);for(let T=h.Lower();T<=h.Upper();T++){const C=r(r(h.Value(T)).Transformed(i));a.verticesNormals[(T-1)*3+0]=C.X(),a.verticesNormals[(T-1)*3+1]=C.Y(),a.verticesNormals[(T-1)*3+2]=C.Z()}const g=this.orientation,v=l.NbTriangles();a.trianglesIndexes=new Array(v*3);let b=0;for(let T=1;T<=v;T++){const C=r(l.Triangle(T));let x=C.Value(1),A=C.Value(2);const F=C.Value(3);if(g==="backward"){const M=x;x=A,A=M}a.trianglesIndexes[b*3+0]=x-1+e,a.trianglesIndexes[b*3+1]=A-1+e,a.trianglesIndexes[b*3+2]=F-1+e,b++}return a}}class An extends Pn{fuse(e,{optimisation:r="none"}={}){const n=Ee(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Pe(i.Shape());if(!kt(a))throw new Error("Could not fuse as a 3d shape");return a}cut(e,{optimisation:r="none"}={}){const n=Ee(),o=n(new this.oc.Message_ProgressRange_1),i=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&i.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),i.Build(o),i.SimplifyResult(!0,!0,.001);const a=Pe(i.Shape());if(!kt(a))throw new Error("Could not cut as a 3d shape");return a}intersect(e){const r=Ee(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const i=Pe(o.Shape());if(!kt(i))throw new Error("Could not intersect as a 3d shape");return i}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let i,a;if(typeof e=="number"){a=e;const b=new Vo;i=typeof r=="function"?r(b):b}else a=e.thickness,i=e.filter;const l=Ee(),c=i.find(this),h=l(new this.oc.TopTools_ListOfShape_1);c.forEach(b=>{h.Append_1(b.wrapped)});const d=l(new this.oc.Message_ProgressRange_1),g=l(new this.oc.BRepOffsetAPI_MakeThickSolid);g.MakeThickSolidByJoin(this.wrapped,h,-a,o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,d);const v=Pe(g.Shape());if(!kt(v))throw new Error("Could not shell as a 3d shape");return v}_builderIter(e,r){if(typeof e=="number"){let a=0;for(const l of this._iterTopo("edge"))r(e,ar(l)),a+=1;return a}let n,o=null;typeof e=="function"?n=e:(n=a=>e.filter.shouldKeep(a)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let i=0;for(const a of this._iterTopo("edge")){const l=ar(a),c=new Wt(l),h=n(c);h&&(r(h,l),i+=1),c.delete()}return o&&o(),i}fillet(e,r){const o=Ee()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new Cn)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not fillet, no edge was selected");const l=Pe(o.Shape());if(!kt(l))throw new Error("Could not fillet as a 3d shape");return l}chamfer(e,r){const o=Ee()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let i=e;if(typeof e=="number"&&r&&(i={radius:e,filter:r(new Cn)}),!this._builderIter(i,(c,h)=>o.Add_2(c,h)))throw new Error("Could not chamfer, no edge was selected");const l=Pe(o.Shape());if(!kt(l))throw new Error("Could not chamfer as a 3d shape");return l}}class hs extends An{}class sr extends An{}class ps extends An{}class ds extends An{}function kt(t){return t instanceof hs||t instanceof sr||t instanceof ps||t instanceof ds}function vs(t){return t instanceof Ct}function ar(t){const e=I(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=ls(t),i=n.get(o);if(!i)throw new Error("Could not find a wrapper for this shape type");return i(t)}function Pe(t){const r=I().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,cs],[r.TopAbs_EDGE,Wt],[r.TopAbs_WIRE,Ct],[r.TopAbs_FACE,Er],[r.TopAbs_SHELL,hs],[r.TopAbs_SOLID,sr],[r.TopAbs_COMPSOLID,ps],[r.TopAbs_COMPOUND,ds]]).get(ls(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(ar(t))}const gs=(t,e)=>{const r=I();return new Wt(new r.BRepBuilderAPI_MakeEdge_3(et(t),et(e)).Edge())},zl=(t,e=[0,0,0],r=[0,0,1])=>{const n=I(),[o,i]=Ie(),a=o(Vr(e,r)),l=o(new n.gp_Circ_2(a,t)),c=o(new n.BRepBuilderAPI_MakeEdge_8(l)),h=new Wt(c.Edge());return i(),h},Wl=(t,e,r,n=[0,0,0],o=[0,0,1],i=!1)=>{const a=I(),[l,c]=Ie();let h=2*Math.PI;i&&(h=-2*Math.PI);const d=l(new a.Geom2d_Line_3(l(new a.gp_Pnt2d_3(0,0)),l(new a.gp_Dir2d_4(h,t)))),g=e/t,v=d.Value(0),b=d.Value(g*Math.sqrt((2*Math.PI)**2+t**2)),T=l(new a.GCE2d_MakeSegment_1(v,b)),C=new a.Geom_CylindricalSurface_1(l(Nr(n,o)),r),x=l(new a.BRepBuilderAPI_MakeEdge_30(l(new a.Handle_Geom2d_Curve_2(T.Value().get())),l(new a.Handle_Geom_Surface_2(C)))).Edge(),A=l(new a.BRepBuilderAPI_MakeWire_2(x)).Wire();return a.BRepLib.BuildCurves3d_2(A),c(),new Ct(A)},jr=t=>{const e=I(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(a=>{a instanceof Wt&&r.Add_1(a.wrapped),a instanceof Ct&&r.Add_2(a.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const a=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${a.get(o)||"unknown error"}`)}const i=new Ct(r.Wire());return r.delete(),n.delete(),i},Rn=(t,e)=>{const r=I(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(i=>{n.Add(i.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new Er(o)},$l=(t,e)=>{const r=I(),[n,o]=Ie(),i=n(r.BRep_Tool.Surface_2(t.wrapped)),l=n(new r.BRepBuilderAPI_MakeFace_21(i,e.wrapped,!0)).Face();return o(),new Er(l)},ms=(t,e,r=[0,0,0],n=[0,0,1])=>{const o=I(),i=Vr(r,n),a=new o.BRepPrimAPI_MakeCylinder_3(i,t,e),l=new sr(a.Shape());return i.delete(),a.delete(),l},Yl=t=>{const e=I(),r=new e.BRepPrimAPI_MakeSphere_1(t),n=new sr(r.Shape());return r.delete(),n};class Xl extends Je{constructor(e,r,n){const o=I(),i=Ee(),a=Math.sqrt(e*r/n),l=e/a,c=r/a,h=new o.gp_GTrsf_1;h.SetAffinity_1(Hr([0,0,0],[0,1,0]),l);const d=i(new o.gp_GTrsf_1);d.SetAffinity_1(Hr([0,0,0],[0,0,1]),a);const g=i(new o.gp_GTrsf_1);g.SetAffinity_1(Hr([0,0,0],[1,0,0]),c),h.Multiply(d),h.Multiply(g),super(h)}applyToPoint(e){const r=I(),o=Ee()(e.XYZ());return this.wrapped.Transforms_1(o),new r.gp_Pnt_2(o)}}function jl(t){const e=[];for(let r=t.LowerRow();r<=t.UpperRow();r++){const n=[];e.push(n);for(let o=t.LowerCol();o<=t.UpperCol();o++){const i=t.Value(r,o);n.push(i)}}return e}const ql=(t,e,r)=>{const n=I(),o=Ee(),i=o(new n.gp_Sphere_1);i.SetRadius(1);const a=o(new n.Geom_SphericalSurface_2(i)),l=n.GeomConvert.SurfaceToBSplineSurface(a.UReversed()).get(),c=jl(l.Poles_2()),h=new Xl(t,e,r);c.forEach((g,v)=>{g.forEach((b,T)=>{const C=h.applyToPoint(b);l.SetPole_1(v+1,T+1,C)})});const d=Pe(o(new n.BRepBuilderAPI_MakeShell_2(l.UReversed(),!1)).Shell());return zo([d])},qr=(t,e)=>{const r=I(),n=new r.BRepPrimAPI_MakeBox_4(et(t),et(e)),o=new sr(n.Solid());return n.delete(),o},On=t=>{const e=I(),r=et(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new cs(o)},Pt=t=>{const e=I(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(i=>{r.Add(n,i.wrapped),i.delete()}),Pe(n)};function Zl(t){const e=I(),r=Ee(),n=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));return t.forEach(({wrapped:o})=>{n.Add(o)}),n.Perform(r(new e.Message_ProgressRange_1)),Pe(ar(n.SewedShape()))}function zo(t){const e=Ee(),r=I(),n=Zl(t),o=Pe(e(new r.ShapeFix_Solid_1).SolidFromShell(n.wrapped));if(!(o instanceof sr))throw new Error("Could not make a solid of faces and shells");return o}const ys=(t,e)=>{const r=I(),[n,o]=Ie(),i=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(h=>{i.Add(h.wrapped)});const a=n(i.Face()),l=n(new r.ShapeFix_Face_2(a));l.FixOrientation_1();const c=l.Face();return o(),new Er(c)},Kl=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,Ql=t=>{let e;t?Kl(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:i}=e;let a;typeof r=="number"?a=Tr(1,r*at):a=r;let l;return typeof i=="number"?l=Tr(1,i*at):l=i,{endTangent:a,startFactor:n,endFactor:o,startTangent:l}};function ws(t,e,r,n){const o=t*r+e*n,i=Math.sqrt((t*t+e*e)*(r*r+n*n));let a=Math.acos(o/i);return t*n-e*r<0&&(a=-a),a}function Jl([t,e],[r,n],o,i,a,l,c){const h=Math.PI*2;if(o<0&&(o=-o),i<0&&(i=-i),o==0||i==0)throw Error("rx and ry can not be 0");const d=Math.sin(a),g=Math.cos(a),v=(t-r)/2,b=(e-n)/2,T=(t+r)/2,C=(e+n)/2,x=g*v+d*b,A=g*b-d*v,F=x*x/(o*o)+A*A/(i*i);F>1&&(o=o*Math.sqrt(F),i=i*Math.sqrt(F));const M=o*i,$=o*A,V=i*x,q=$*$+V*V;if(!q)throw Error("start point can not be same as end point");let X=Math.sqrt(Math.abs((M*M-q)/q));l==c&&(X=-X);const Z=X*$/i,se=-X*V/o,be=g*Z-d*se+T,Se=d*Z+g*se+C,_e=(x-Z)/o,xe=(x+Z)/o,re=(A-se)/i,ce=(A+se)/i,ye=ws(1,0,_e,re);let ae=ws(_e,re,-xe,-ce);for(;ae>h;)ae-=h;for(;ae<0;)ae+=h;c||(ae-=h);let te=ye+ae;for(;te>h;)te-=h;for(;te<0;)te+=h;return{cx:be,cy:Se,startAngle:ye,deltaAngle:ae,endAngle:te,clockwise:!!c,rx:o,ry:i}}const bs=(t,e)=>{const r=I(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new sr(ar(n.Shape()));return n.delete(),o},Ss=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=I(),i=Hr(e,r),a=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,i,n*at,!1),l=Pe(a.Shape());if(i.delete(),a.delete(),!kt(l))throw new Error("Could not revolve to a 3d shape");return l};function Zr(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:i="right",withContact:a,support:l,forceProfileSpineOthogonality:c}={},h=!1){const d=I(),g=i==="round"?!0:!!c,v=new d.BRepOffsetAPI_MakePipeShell(e.wrapped);if(i){const C={transformed:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:d.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[i];C&&v.SetTransitionMode(C)}l?v.SetMode_4(l):r&&v.SetMode_1(r),n&&v.SetMode_5(n.wrapped,!1,d.BRepFill_TypeOfContact.BRepFill_NoContact),o?v.SetLaw_1(t.wrapped,o,!!a,g):v.Add_1(t.wrapped,!!a,g);const b=new d.Message_ProgressRange_1;v.Build(b),h||v.MakeSolid();const T=Pe(v.Shape());if(!kt(T))throw new Error("Could not sweep to a 3d shape");if(h){const C=Pe(v.FirstShape()),x=Pe(v.LastShape());if(!vs(C))throw new Error("Could not sweep with one start wire");if(!vs(x))throw new Error("Could not sweep with one end wire");return v.delete(),[T,C,x]}return v.delete(),b.delete(),T}const _s=(t,{profile:e,endFactor:r=1})=>{let n;const o=I();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function Ts(t,e,r,n,o=!1){const i=new R(e),a=new R(r),l=gs(i,i.add(a)),c=jr([l]),h=n?_s(a.Length,n):null;return o?Zr(t,c,{law:h},o):Zr(t,c,{law:h},o)}function Es(t,e,r,n,o,i=!1){const a=new R(r),l=new R(n),c=gs(a,a.add(l)),h=jr([c]),d=360/e*l.Length,g=1,v=Wl(d,l.Length,g,r,n),b=o?_s(l.Length,o):null;return i?Zr(t,h,{auxiliarySpine:v,law:b},i):Zr(t,h,{auxiliarySpine:v,law:b},i)}const ec=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const i=I(),[a,l]=Ie(),c=a(new i.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&c.AddVertex(a(On(r)).wrapped),t.forEach(g=>c.AddWire(g.wrapped)),n&&c.AddVertex(a(On(n)).wrapped);const h=a(new i.Message_ProgressRange_1);c.Build(h);const d=Pe(c.Shape());if(l(),!kt(d))throw new Error("Could not loft to a 3d shape");return d};class xr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new xr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new R(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new R(e)}face(){let e;return this.baseFace?e=$l(this.baseFace,this.wire):e=Rn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=Rn(this.wire),o=Ss(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const[a,l]=Ie(),c=a(new R(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const g=Ts(this.wire,i||this.defaultOrigin,c,n);return l(),this.delete(),g}if(o){const g=Es(this.wire,o,i||this.defaultOrigin,c,n);return l(),this.delete(),g}const h=Rn(this.wire),d=bs(h,c);return l(),this.delete(),d}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),i=o.cross(this.defaultDirection).multiply(-1),a=e(new je(n,i,o),n),l={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(l.support=this.baseFace.wrapped);const c=Zr(a.wire,this.wire,l);return this.delete(),c}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],i=ec(o.map(a=>a.wire),r,n);return o.forEach(a=>a.delete()),i}}const tc=t=>{const e=I(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new $r(r)};function rc(t,e){const[r,n]=Ie(),o=r(Vr(e.origin,e.zDir,e.xDir)),i=I(),a=t.map(l=>{const c=i.GeomLib.To3d(o,l.wrapped);return new Wt(new i.BRepBuilderAPI_MakeEdge_24(c).Edge())});return n(),a}const nc=(t,e)=>{const[r,n]=Ie(),o=I(),i=t.map(a=>{const l=r(new o.BRepBuilderAPI_MakeEdge_30(a.wrapped,e));return new Wt(l.Edge())});return n(),i},xs=(t,e)=>{const r=I();return t.map(o=>e?new Me(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class Kr extends Je{transformCurves(e){return xs(e,this.wrapped)}}const Cs=(t,e,r=[0,0])=>{const n=I(),o=Sr(r,e),i=new n.gp_GTrsf2d_1;return i.SetAffinity(o,t),o.delete(),new Kr(i)},oc=t=>{const e=I(),[r,n]=Ie(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(qi(t)));const i=new e.gp_GTrsf2d_2(o);return n(),new Kr(i)},ic=(t,e=[0,0],r="center")=>{const n=I(),[o,i]=Ie(),a=new n.gp_Trsf2d_1;r==="center"?a.SetMirror_1(o(We(t))):a.SetMirror_2(o(Sr(e,t)));const l=new n.gp_GTrsf2d_2(a);return i(),new Kr(l)},sc=(t,e=[0,0])=>{const r=I(),[n,o]=Ie(),i=new r.gp_Trsf2d_1;i.SetRotation(n(We(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new Kr(a)},ac=(t,e=[0,0])=>{const r=I(),[n,o]=Ie(),i=new r.gp_Trsf2d_1;i.SetScale(n(We(e)),t);const a=new r.gp_GTrsf2d_2(i);return o(),new Kr(a)};function uc(t,e,r="original"){const[n,o]=Ie(),i=I();let a=n(i.BRep_Tool.Surface_2(e.wrapped));const l=e.UVBounds;let c=null;const h=n(Sr([0,0],[0,1])),d=n(Sr([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const b=n(a.get().Cylinder());b.Direct()||(a=a.get().UReversed());const T=b.Radius();c=Cs(1/T,[0,1]).wrapped}if(r==="bounds"){if(c=n(new i.gp_GTrsf2d_1),c.SetAffinity(h,l.uMax-l.uMin),l.uMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(new i.gp_XY_2(0,-l.uMin)),c.Multiply(T)}const b=n(new i.gp_GTrsf2d_1);if(b.SetAffinity(d,l.vMax-l.vMin),c.Multiply(b),l.vMin!==0){const T=n(new i.gp_GTrsf2d_1);T.SetTranslationPart(n(new i.gp_XY_2(0,-l.vMin))),c.Multiply(T)}}const g=xs(t,c),v=nc(g,a);return o(),v}function lc(t,e){const r=I(),o=Ee()(new r.BRepAdaptor_Curve2d_2(t.wrapped,e.wrapped)),i=new r.Geom2d_TrimmedCurve(o.Curve(),o.FirstParameter(),o.LastParameter(),!0,!0);return t.orientation==="backward"&&i.Reverse(),new Me(new r.Handle_Geom2d_Curve_2(i))}const Mn=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},Wo=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${Mn(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class oe{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new oe(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=tc(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const i=e[(o+1)%e.length];return(i[0]-n[0])*(i[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=Cs(e,r,n).transformCurves(this.curves);return new oe(o)}scale(e,r){const n=r||this.boundingBox.center,o=ac(e,n).transformCurves(this.curves);return new oe(o)}rotate(e,r){const n=sc(e*at,r).transformCurves(this.curves);return new oe(n)}translate(e,r=0){const n=Sn(e)?e:[e,r],o=oc(n).transformCurves(this.curves);return new oe(o)}mirror(e,r=[0,0],n="center"){const o=ic(e,r,n).transformCurves(this.curves);return new oe(o)}sketchOnPlane(e,r){const n=e instanceof je?Ht(e):Ht(e,r),o=rc(this.curves,n),i=jr(o);return new xr(i,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=I(),o=uc(this.curves,e,r),i=jr(o);n.BRepLib.BuildCurves3d_2(i.wrapped);const a=new n.ShapeFix_Wire_2(i.wrapped,e.wrapped,1e-9);a.FixEdgeCurves(),a.delete();const l=new xr(i);if(i.isClosed){const c=l.clone().face();l.defaultOrigin=c.pointOnSurface(.5,.5),l.defaultDirection=c.normalAt(),c.orientation!==e.orientation&&(l.defaultDirection=l.defaultDirection.multiply(-1)),l.baseFace=e}else{const c=i.startPoint;l.defaultOrigin=c,l.defaultDirection=e.normalAt(c),l.baseFace=e}return l}toSVGPathD(){const e=Ee(),r=this.clone().mirror([1,0],[0,0],"plane"),o=En(r.curves).flatMap(l=>Bl(e(l.adaptor()),l.lastPoint)),[i,a]=r.curves[0].firstPoint;return`M ${ut(i)} ${ut(a)} ${o.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return Mn(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return Wo(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1,o=Xr(e,this.boundingBox.outsidePoint());let i=0;return this.curves.find(l=>l.isOnCurve(e))?!1:(this.curves.forEach(l=>{l.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,l.wrapped,1e-9),i+=n.NbPoints())}),n.delete(),!!(i%2))}isClosed(){return $e(this.firstPoint,this.lastPoint)}intersects(e){const r=I(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const i of e.curves)if(!o.boundingBox.isOut(i.boundingBox)&&(n.Init_1(o.wrapped,i.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class cc{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?Lo:Fo;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=Xr(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*at,o=Tr(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*at,[o,i]=Tr(e,n);return this.line(o,i)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=zt(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(Mo(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[i,a]=this.pointer;return this.threePointsArcTo([i+e,a+r],[i+n,a+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[i,a]=e,l=[(n+i)/2,(o+a)/2],c=[-(a-o),i-n],h=Math.sqrt(c[0]**2+c[1]**2),d=[l[0]+c[0]/h*r,l[1]+c[1]/h*r];return this.saveCurve(Mo(this._convertToUV(this.pointer),this._convertToUV(d),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=mt(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(Al(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,i=!1,a=!1){let l=o,c=r,h=n;r<n&&(l=o+90,c=n,h=r);const d=l*at,g=Z=>mt(this._convertToUV(Z)),v=g(Tr(c,d)),b=g(Tr(h,d+Math.PI/2)),T=zt(this._convertToUV(xl([1,0],d))),[,C]=Cl(T),{cx:x,cy:A,startAngle:F,endAngle:M,clockwise:$,rx:V,ry:q}=Jl(this._convertToUV(this.pointer),this._convertToUV(e),v,b,C,i,a),X=Rl(V,q,$?F:M,$?M:F,[x,A],T);return $||X.reverse(),this.saveCurve(X),this.pointer=e,this}ellipse(e,r,n,o,i=0,a=!1,l=!1){const[c,h]=this.pointer;return this.ellipseTo([e+c,r+h],n,o,i,a,l)}halfEllipseTo(e,r,n=!1){const o=El(e,this.pointer),i=mt(e,this.pointer);return this.ellipseTo(e,i/2,r,o*Gr,!0,n)}halfEllipse(e,r,n,o=!1){const[i,a]=this.pointer;return this.halfEllipseTo([i+e,a+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(Ol(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:i,endFactor:a}=Ql(r),l=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,c=mt(this.pointer,e)*.25;let h;o?h=o:l?h=this._convertFromUV(l.tangentAt(1)):h=[1,0],h=zt(h);const d=[this.pointer[0]+h[0]*i*c,this.pointer[1]+h[1]*i*c];let g;n==="symmetric"?g=[-h[0],-h[1]]:g=n,g=zt(g);const v=[e[0]-g[0]*a*c,e[1]-g[1]*a*c];return this.cubicBezierCurveTo(e,d,v)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const i=r==="chamfer"?Lo:Fo;this.pendingCurves.push(...i(n,o,e))}_closeSketch(){$e(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if($e(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=Sr(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new Me(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}class fc extends cc{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new oe(this.pendingCurves)}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}const hc=t=>{const e=I(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((i,a)=>{i.edges.forEach(l=>{r.Add_1(l.wrapped,e.GeomAbs_Shape.GeomAbs_C0,a===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=Pe(r.Shape());if(r.delete(),!(o instanceof Er))throw new Error("Failed to create a face");return o},pc=(t,e)=>{const r=I(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},ks=t=>{let e,r;try{e=Rn(t[0]),r=t.slice(1)}catch{e=hc(t),r=t.slice(1).map(o=>pc(o,e))}return ys(e,r)},Ps=(t,e)=>{const r=[],n=[],o=[];t.forEach(c=>{const[h,d,g]=e(c);r.push(h),n.push(d),o.push(g)});const i=ks(n),a=ks(o);return zo([i,...r,a])};class As{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return Pt(e)}face(){const e=this.outerSketch.face();return ys(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:i}={}){const a=new R(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?Ps(this.sketches,h=>Ts(h.wire,i||this.outerSketch.defaultOrigin,a,n,!0)):o?Ps(this.sketches,h=>Es(h.wire,o,i||this.outerSketch.defaultOrigin,a,n,!0)):bs(this.face(),a)}revolve(e,{origin:r}={}){return Ss(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((i,a)=>{const l=e.sketches[a];return i.clone().loftWith(l.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),zo(n)}}class me{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new me(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new $r;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new me(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new me(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new me(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new me(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new me(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new As(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new As(n)}toSVGViewBox(e=1){return Mn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return Wo(this.toSVGGroup(),this.boundingBox,e)}}class Rs{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof xr?r.wire:r.wires);return Pt(e)}faces(){const e=this.sketches.map(r=>r.face());return Pt(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return Pt(n)}revolve(e,r){return Pt(this.sketches.map(n=>n.revolve(e,r)))}}class K{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new K(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new $r;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new K(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new K(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new K(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new K(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new K(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new Rs(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new Rs(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return Mn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof oe?n.toSVGPath():n.toSVGGroup());return Wo(r.join(`
    `),this.boundingBox,e)}}const dc=t=>{const e=t.map((o,i)=>t.slice(i+1).map((a,l)=>[l+i+1,a]).filter(([,a])=>!o.boundingBox.isOut(a.boundingBox)).map(([a])=>a)),r=[],n=Array(e.length);return e.forEach((o,i)=>{let a=n[i];a||(a=[],r.push(a)),a.push(t[i]),o.length&&o.forEach(l=>{n[l]=a})}),r},Os=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),i=t.filter((a,l)=>r===l?!1:a.isInside(o));return{blueprint:e,isIn:i}}),vc=(t,e)=>t.flatMap(({blueprint:r})=>$o(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),gc=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=$o(Os(t.map(({blueprint:o})=>o)));return[r,...n]},$o=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?vc(e,t):gc(r,t)},Qr=t=>{const e=dc(t).map(Os);return new K(e.flatMap($o).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new me(r.map(({blueprint:n})=>n)))))},mc=(t,e,r=0)=>{const{rx:n=0,ry:o=0}=typeof r=="number"?{ry:r,rx:r}:r;let i=Math.min(n,t/2),a=Math.min(o,e/2);const l=i&&a;l||(i=0,a=0);const c=i===a,h=new fc([Math.min(0,-(t/2-i)),-e/2]),d=(g,v)=>{l&&(c?h.tangentArc(g,v):h.ellipse(g,v,i,a,0,!1,!0))};return i<t/2&&h.hLine(t-2*i),d(i,a),a<e/2&&h.vLine(e-2*a),d(-i,a),i<t/2&&h.hLine(-(t-2*i)),d(-i,-a),a<e/2&&h.vLine(-(e-2*a)),d(i,-a),h.close()},Dn=1e-9,Ye=(t,e)=>$e(t,e,Dn),Jr=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},Ms=(t,e)=>{const r=t.findIndex(i=>Ye(e,i.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},Ds=(t,e)=>{const r=a=>Ye(e.firstPoint,a.firstPoint)&&Ye(e.lastPoint,a.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Xo(t),n=t.findIndex(r),n===-1))throw console.error(t.map(a=>a.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*Fs(t,e,r){const n=a=>!!e.find(l=>Ye(l,a.lastPoint)),o=a=>!!r.find(l=>Ye(l.firstPoint,a.firstPoint)&&Ye(l.lastPoint,a.lastPoint)||Ye(l.firstPoint,a.lastPoint)&&Ye(l.lastPoint,a.firstPoint));let i=[];for(const a of t)n(a)?(i.push(a),yield i,i=[]):o(a)?(i.length&&(yield i,i=[]),yield[a]):i.push(a);i.length&&(yield i)}const yc=t=>t[0].firstPoint,Yo=t=>t[t.length-1].lastPoint,Xo=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),wc=t=>(t.reverse(),t.map(Xo));function bc(t,e,r){return t.filter(n=>{const o=e.filter(l=>Ye(l.firstPoint,n)||Ye(l.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const i=o.map(l=>r.isInside(Jr(l)));return!(i.every(l=>l)||!i.some(l=>l))})}function Sc(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),i=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((v,b)=>{e.curves.forEach((T,C)=>{const{intersections:x,commonSegments:A,commonSegmentsPoints:F}=Yr(v,T,Dn/100);r.push(...x),o[b].push(...x),i[C].push(...x),n.push(...A),r.push(...F),o[b].push(...F),i[C].push(...F)})}),r=ji(r,Dn),!r.length||r.length===1)return null;const a=([v,b])=>b.length?v.splitAt(b,Dn/100):[v];let l=br([t.curves,o]).flatMap(a),c=br([e.curves,i]).flatMap(a);const h=n.map(v=>[v.firstPoint,v.lastPoint]);if(r=bc(r,l,e),!r.length&&!n.length)return null;if(n.length){const v=n[0];l=Ds(l,v),c=Ds(c,v)}else{const v=r[0];l=Ms(l,v),c=Ms(c,v)}const d=Array.from(Fs(l,r,n));let g=Array.from(Fs(c,r,n));return(!Ye(Yo(g[0]),Yo(d[0]))||n.length>0&&g[0].length!==1)&&(g=wc(g)),br([d,g]).map(([v,b])=>{const T=yc(v),C=Yo(v);return h.find(([x,A])=>Ye(x,T)&&Ye(A,C)||Ye(x,C)&&Ye(x,T))?[v,"same"]:[v,b]})}const _c=t=>{const e=t.map(a=>a.firstPoint);let r=t.map(a=>a.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=br([e,r]).map(([a,l],c)=>Ye(a,l)?null:c).filter(a=>a!==null);if(!n.length)return[t];const o=br([n.slice(0,-1),n.slice(1)]).map(([a,l])=>t.slice(a,l));let i=t.slice(n[n.length-1]);return n[0]!==0&&(i=i.concat(t.slice(0,n[0]))),o.push(i),o};function jo(t,e,{firstInside:r,secondInside:n}){const o=Sc(t,e);if(!o){const h=Jr(t.curves[0]),d=e.isInside(h),g=Jr(e.curves[0]),v=t.isInside(g);return{identical:!1,firstCurveInSecond:d,secondCurveInFirst:v}}if(o.every(([,h])=>h==="same"))return{identical:!0};let i=null,a=null;const l=o.flatMap(([h,d])=>{let g=[],v=0;if(d==="same")return a===1?(a=1,[...h]):a===2||a===0?(a=null,[]):a===null?(i?i=[...i,...h]:i=h,[]):(console.error("weird situation"),[]);const b=Jr(h[0]),T=e.isInside(b);(r==="keep"&&T||r==="remove"&&!T)&&(v+=1,g.push(...h));const C=Jr(d[0]),x=t.isInside(C);if(n==="keep"&&x||n==="remove"&&!x){let A=d;v===1&&(A=Xo(d)),v+=1,g.push(...A)}return a===null&&v===1&&i&&(g=[...i,...g]),v===1&&(a=v,i=null),g}),c=_c(l).filter(h=>h.length).map(h=>new oe(h));return c.length===0?null:c.length===1?c[0]:Qr(c)}const Fn=(t,e)=>{const r=jo(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof oe||r instanceof K?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new K([t,e])},en=(t,e)=>{const r=jo(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof oe||r instanceof K?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new K([new me([t,e])]):t.clone()},qo=(t,e)=>{const r=jo(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof oe||r instanceof K?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},Zo=(t,e)=>{if(t instanceof oe&&e instanceof oe){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:i,commonSegmentsPoints:a}=Yr(n,o);r.push(...i),r.push(...a)})}),r=ji(r),r.length>1}if(t instanceof me||t instanceof K)return t.blueprints.some(r=>Zo(r,e));if(e instanceof me||e instanceof K)return e.blueprints.some(r=>Zo(t,r));throw new Error("Bug in the generic intersects algorithm")},Tc=(t,e)=>{if(t instanceof me){if(e instanceof oe)return Ln(e,t);if(e instanceof me)return Bn(t,e)}if(e instanceof me){if(t instanceof oe)return Ln(t,e);if(t instanceof me)return Bn(t,e)}if(t instanceof oe&&e instanceof oe)return Fn(t,e);throw new Error("Bug in the generic fuse algorithm")},Ls=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let i;e.has(o)?i=e.get(o):(i={current:n,fusedWith:new Set([o])},r.push(i)),t.slice(o+1).forEach((a,l)=>{const c=i.current,h=o+l+1;if(i.fusedWith.has(h))return;let d=a,g=!1;if(e.has(h)&&(d=e.get(h).current,g=!0),c.boundingBox.isOut(d.boundingBox)||!Zo(c,d))return;let v;if(c instanceof K||d instanceof K?v=Rt(c,d):v=Tc(c,d),!(v instanceof oe||v instanceof me)){if(v instanceof K&&v.blueprints.length===2)return;if(v instanceof K&&v.blueprints.length===1)v=v.blueprints[0];else if(!(v instanceof K))throw console.error(v),new Error("Bug in blueprint fusing algorigthm")}i.fusedWith.add(h),i.current=v,g||e.set(h,i)})}),Qr(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>At(n)))},At=t=>t instanceof oe?[t]:t instanceof me?t.blueprints:t instanceof K?t.blueprints.flatMap(e=>At(e)):[],Ln=(t,e)=>{const r=Fn(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>en(o,t));return Qr([...At(r),...n.flatMap(o=>At(o))])};function Ec(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const Bn=(t,e)=>{const r=Fn(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(a=>en(a,t.blueprints[0])),o=t.blueprints.slice(1).map(a=>en(a,e.blueprints[0])),i=Ec(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([a,l])=>At(qo(a,l)));return Qr([...At(r),...n.flatMap(a=>At(a)),...o.flatMap(a=>At(a)),...i])},Rt=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof K)&&e instanceof K)return Ls([t,...e.blueprints]);if(!(e instanceof K)&&t instanceof K)return Ls([e,...t.blueprints]);if(t instanceof K&&e instanceof K){let r=Rt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=Rt(n,r)}),r}if(t instanceof me){if(e instanceof K)return Rt(e,t);if(e instanceof oe)return Ln(e,t);if(e instanceof me)return Bn(t,e)}if(e instanceof me){if(t instanceof K)return Rt(t,e);if(t instanceof oe)return Ln(t,e);if(t instanceof me)return Bn(t,e)}return t instanceof oe&&e instanceof oe?Fn(t,e):null},Un=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof K?r.blueprints:r);return e.length===1?e[0]:new K(e)},$t=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof K)return Un(t.blueprints.map(n=>$t(n,e)));if(t instanceof me){const n=t.blueprints[0];if(e instanceof oe&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=Rt(e,new K(t.blueprints.slice(1)));return Qr([n,...At(o)])}else{let o=$t(t.blueprints[0],e);return t.blueprints.slice(1).forEach(i=>{o=$t(o,i)}),o}}if(e instanceof K)return Un(e.blueprints.map(n=>$t(t,n)));if(e instanceof me){let n=en(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=Rt(n,qo(o,t))}),n}return en(t,e)};function tn(t,e){if(t===null||e===null)return null;if(t instanceof oe&&e instanceof oe)return qo(t,e);if(t instanceof K)return Un(t.blueprints.map(r=>tn(r,e)));if(t instanceof me){const r=t.blueprints[0],n=t.blueprints[1];return $t(tn(r,e),n)}if(e instanceof K)return Un(e.blueprints.map(r=>tn(t,r)));if(e instanceof me){const r=e.blueprints[0],n=e.blueprints[1];return $t(tn(r,t),n)}throw new Error("intersct 2D algorithm error")}const Bs=(t,e={})=>{const r=e.plane instanceof je?Ht(e.plane):Ht(e.plane,e.origin),n=jr([zl(t,r.origin,r.zDir)]),o=new xr(n,{defaultOrigin:r.origin,defaultDirection:r.zDir});return r.delete(),o};/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,i=r?Number(r):0;if(i!=i&&(i=0),!(i<0||i>=o)){var a=n.charCodeAt(i),l;return a>=55296&&a<=56319&&o>i+1&&(l=n.charCodeAt(i+1),l>=56320&&l<=57343)?(a-55296)*1024+l-56320+65536:a}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function Us(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var xc=new Us,Cc=new Us,Is=new Uint8Array(30),Gs=new Uint16Array(30),kc=new Uint8Array(30),Pc=new Uint16Array(30);function Ns(t,e,r,n){var o,i;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(i=n,o=0;o<30;++o)e[o]=i,i+=1<<t[o]}function Ac(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}Ac(xc,Cc),Ns(Is,Gs,4,3),Ns(kc,Pc,2,1),Is[28]=0,Gs[28]=258;function Cr(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function Yt(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Yt.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Yt.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},Yt.prototype.addX=function(t){this.addPoint(t,null)},Yt.prototype.addY=function(t){this.addPoint(null,t)},Yt.prototype.addBezier=function(t,e,r,n,o,i,a,l){var c=[t,e],h=[r,n],d=[o,i],g=[a,l];this.addPoint(t,e),this.addPoint(a,l);for(var v=0;v<=1;v++){var b=6*c[v]-12*h[v]+6*d[v],T=-3*c[v]+9*h[v]-9*d[v]+3*g[v],C=3*h[v]-3*c[v];if(T===0){if(b===0)continue;var x=-C/b;0<x&&x<1&&(v===0&&this.addX(Cr(c[v],h[v],d[v],g[v],x)),v===1&&this.addY(Cr(c[v],h[v],d[v],g[v],x)));continue}var A=Math.pow(b,2)-4*C*T;if(!(A<0)){var F=(-b+Math.sqrt(A))/(2*T);0<F&&F<1&&(v===0&&this.addX(Cr(c[v],h[v],d[v],g[v],F)),v===1&&this.addY(Cr(c[v],h[v],d[v],g[v],F)));var M=(-b-Math.sqrt(A))/(2*T);0<M&&M<1&&(v===0&&this.addX(Cr(c[v],h[v],d[v],g[v],M)),v===1&&this.addY(Cr(c[v],h[v],d[v],g[v],M)))}}},Yt.prototype.addQuad=function(t,e,r,n,o,i){var a=t+.6666666666666666*(r-t),l=e+2/3*(n-e),c=a+1/3*(o-t),h=l+1/3*(i-e);this.addBezier(t,e,a,l,c,h,o,i)};function Ve(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Ve.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},Ve.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},Ve.prototype.curveTo=Ve.prototype.bezierCurveTo=function(t,e,r,n,o,i){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:i})},Ve.prototype.quadTo=Ve.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})},Ve.prototype.close=Ve.prototype.closePath=function(){this.commands.push({type:"Z"})},Ve.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof Yt){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)},Ve.prototype.getBoundingBox=function(){for(var t=new Yt,e=0,r=0,n=0,o=0,i=0;i<this.commands.length;i++){var a=this.commands[i];switch(a.type){case"M":t.addPoint(a.x,a.y),e=n=a.x,r=o=a.y;break;case"L":t.addPoint(a.x,a.y),n=a.x,o=a.y;break;case"Q":t.addQuad(n,o,a.x1,a.y1,a.x,a.y),n=a.x,o=a.y;break;case"C":t.addBezier(n,o,a.x1,a.y1,a.x2,a.y2,a.x,a.y),n=a.x,o=a.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+a.type)}}return t.isEmpty()&&t.addPoint(0,0),t},Ve.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},Ve.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(t)}function r(){for(var a=arguments,l="",c=0;c<arguments.length;c+=1){var h=a[c];h>=0&&c>0&&(l+=" "),l+=e(h)}return l}for(var n="",o=0;o<this.commands.length;o+=1){var i=this.commands[o];i.type==="M"?n+="M"+r(i.x,i.y):i.type==="L"?n+="L"+r(i.x,i.y):i.type==="C"?n+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?n+="Q"+r(i.x1,i.y1,i.x,i.y):i.type==="Z"&&(n+="Z")}return n},Ve.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Ve.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function Vs(t){throw new Error(t)}function Hs(t,e){t||Vs(e)}var Q={fail:Vs,argument:Hs,assert:Hs},zs=32768,Ws=2147483648,kr={},N={},j={};function lt(t){return function(){return t}}N.BYTE=function(t){return Q.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},j.BYTE=lt(1),N.CHAR=function(t){return[t.charCodeAt(0)]},j.CHAR=lt(1),N.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e},j.CHARARRAY=function(t){return typeof t>"u"?0:t.length},N.USHORT=function(t){return[t>>8&255,t&255]},j.USHORT=lt(2),N.SHORT=function(t){return t>=zs&&(t=-(2*zs-t)),[t>>8&255,t&255]},j.SHORT=lt(2),N.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]},j.UINT24=lt(3),N.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]},j.ULONG=lt(4),N.LONG=function(t){return t>=Ws&&(t=-(2*Ws-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]},j.LONG=lt(4),N.FIXED=N.ULONG,j.FIXED=j.ULONG,N.FWORD=N.SHORT,j.FWORD=j.SHORT,N.UFWORD=N.USHORT,j.UFWORD=j.USHORT,N.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]},j.LONGDATETIME=lt(8),N.TAG=function(t){return Q.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},j.TAG=lt(4),N.Card8=N.BYTE,j.Card8=j.BYTE,N.Card16=N.USHORT,j.Card16=j.USHORT,N.OffSize=N.BYTE,j.OffSize=j.BYTE,N.SID=N.USHORT,j.SID=j.USHORT,N.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?N.NUMBER16(t):N.NUMBER32(t)},j.NUMBER=function(t){return N.NUMBER(t).length},N.NUMBER16=function(t){return[28,t>>8&255,t&255]},j.NUMBER16=lt(3),N.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]},j.NUMBER32=lt(5),N.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",i=0,a=e.length;i<a;i+=1){var l=e[i];l==="e"?o+=e[++i]==="-"?"c":"b":l==="."?o+="a":l==="-"?o+="e":o+=l}o+=o.length&1?"f":"ff";for(var c=[30],h=0,d=o.length;h<d;h+=2)c.push(parseInt(o.substr(h,2),16));return c},j.REAL=function(t){return N.REAL(t).length},N.NAME=N.CHARARRAY,j.NAME=j.CHARARRAY,N.STRING=N.CHARARRAY,j.STRING=j.CHARARRAY,kr.UTF8=function(t,e,r){for(var n=[],o=r,i=0;i<o;i++,e+=1)n[i]=t.getUint8(e);return String.fromCharCode.apply(null,n)},kr.UTF16=function(t,e,r){for(var n=[],o=r/2,i=0;i<o;i++,e+=2)n[i]=t.getUint16(e);return String.fromCharCode.apply(null,n)},N.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e},j.UTF16=function(t){return t.length*2};var Ko={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};kr.MACSTRING=function(t,e,r,n){var o=Ko[n];if(o!==void 0){for(var i="",a=0;a<r;a++){var l=t.getUint8(e+a);l<=127?i+=String.fromCharCode(l):i+=o[l&127]}return i}};var In=typeof WeakMap=="function"&&new WeakMap,Gn,Rc=function(t){if(!Gn){Gn={};for(var e in Ko)Gn[e]=new String(e)}var r=Gn[t];if(r!==void 0){if(In){var n=In.get(r);if(n!==void 0)return n}var o=Ko[t];if(o!==void 0){for(var i={},a=0;a<o.length;a++)i[o.charCodeAt(a)]=a+128;return In&&In.set(r,i),i}}};N.MACSTRING=function(t,e){var r=Rc(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=128&&(i=r[i],i===void 0))return;n[o]=i}return n}},j.MACSTRING=function(t,e){var r=N.MACSTRING(t,e);return r!==void 0?r.length:0};function Qo(t){return t>=-128&&t<=127}function Oc(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function Mc(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(!Qo(a)||a===0&&i+1<o&&t[i+1]===0)break;++i,++n}r.push(n-1);for(var l=e;l<i;++l)r.push(t[l]+256&255);return i}function Dc(t,e,r){for(var n=0,o=t.length,i=e;i<o&&n<64;){var a=t[i];if(a===0||Qo(a)&&i+1<o&&Qo(t[i+1]))break;++i,++n}r.push(64|n-1);for(var l=e;l<i;++l){var c=t[l];r.push(c+65536>>8&255,c+256&255)}return i}N.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=Oc(t,e,r):n>=-128&&n<=127?e=Mc(t,e,r):e=Dc(t,e,r)}return r},N.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var i=N.OBJECT(t[o]);Array.prototype.push.apply(n,i),e+=i.length,r.push(e)}if(n.length===0)return[0,0];for(var a=[],l=1+Math.floor(Math.log(e)/Math.log(2))/8|0,c=[void 0,N.BYTE,N.USHORT,N.UINT24,N.ULONG][l],h=0;h<r.length;h+=1){var d=c(r[h]);Array.prototype.push.apply(a,d)}return Array.prototype.concat(N.Card16(t.length),N.OffSize(l),a,n)},j.INDEX=function(t){return N.INDEX(t).length},N.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var i=parseInt(r[o],0),a=t[i];e=e.concat(N.OPERAND(a.value,a.type)),e=e.concat(N.OPERATOR(i))}return e},j.DICT=function(t){return N.DICT(t).length},N.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},N.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)Q.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(N.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(N.NUMBER(t));else if(e==="offset")r=r.concat(N.NUMBER32(t));else if(e==="number")r=r.concat(N.NUMBER(t));else if(e==="real")r=r.concat(N.REAL(t));else throw new Error("Unknown operand type "+e);return r},N.OP=N.BYTE,j.OP=j.BYTE;var Nn=typeof WeakMap=="function"&&new WeakMap;N.CHARSTRING=function(t){if(Nn){var e=Nn.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var i=t[o];r=r.concat(N[i.type](i.value))}return Nn&&Nn.set(t,r),r},j.CHARSTRING=function(t){return N.CHARSTRING(t).length},N.OBJECT=function(t){var e=N[t.type];return Q.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)},j.OBJECT=function(t){var e=j[t.type];return Q.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)},N.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],i=0;i<r;i+=1){var a=t.fields[i],l=N[a.type];Q.argument(l!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var c=t[a.name];c===void 0&&(c=a.value);var h=l(c);a.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(h)):e=e.concat(h)}for(var d=0;d<n.length;d+=1){var g=o[d],v=e.length;Q.argument(v<65536,"Table "+t.tableName+" too big."),e[g]=v>>8,e[g+1]=v&255,e=e.concat(n[d])}return e},j.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],i=j[o.type];Q.argument(i!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var a=t[o.name];a===void 0&&(a=o.value),e+=i(a),o.type==="TABLE"&&(e+=2)}return e},N.RECORD=N.TABLE,j.RECORD=j.TABLE,N.LITERAL=function(t){return t},j.LITERAL=function(t){return t.length};function He(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var i=Object.keys(r),a=0;a<i.length;a+=1){var l=i[a],c=r[l];this[l]!==void 0&&(this[l]=c)}}He.prototype.encode=function(){return N.TABLE(this)},He.prototype.sizeOf=function(){return j.TABLE(this)};function rn(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function Jo(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o[i+1]={name:t+i,type:"TABLE",value:r(e[i],i)};return o}function nn(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var i=0;i<n;i++)o=o.concat(r(e[i],i));return o}function Vn(t){t.format===1?He.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(rn("glyph",t.glyphs))):t.format===2?He.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(nn("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):Q.assert(!1,"Coverage format must be 1 or 2.")}Vn.prototype=Object.create(He.prototype),Vn.prototype.constructor=Vn;function Hn(t){He.call(this,"scriptListTable",nn("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return Q.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new He("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new He("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(rn("featureIndex",o.featureIndexes)))}].concat(nn("langSys",n.langSysRecords,function(i,a){var l=i.langSys;return[{name:"langSysTag"+a,type:"TAG",value:i.tag},{name:"langSys"+a,type:"TABLE",value:new He("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:l.reqFeatureIndex}].concat(rn("featureIndex",l.featureIndexes)))}]})))}]}))}Hn.prototype=Object.create(He.prototype),Hn.prototype.constructor=Hn;function zn(t){He.call(this,"featureListTable",nn("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new He("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(rn("lookupListIndex",n.lookupListIndexes)))}]}))}zn.prototype=Object.create(He.prototype),zn.prototype.constructor=zn;function Wn(t,e){He.call(this,"lookupListTable",Jo("lookup",t,function(r){var n=e[r.lookupType];return Q.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new He("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Jo("subtable",r.subtables,n)))}))}Wn.prototype=Object.create(He.prototype),Wn.prototype.constructor=Wn;var z={Table:He,Record:He,Coverage:Vn,ScriptList:Hn,FeatureList:zn,LookupList:Wn,ushortList:rn,tableList:Jo,recordList:nn};function $s(t,e){return t.getUint8(e)}function $n(t,e){return t.getUint16(e,!1)}function Fc(t,e){return t.getInt16(e,!1)}function ei(t,e){return t.getUint32(e,!1)}function Ys(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function Lc(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function Bc(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Uc(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function Ic(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Gc={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function k(t,e){this.data=t,this.offset=e,this.relativeOffset=0}k.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},k.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},k.prototype.parseCard8=k.prototype.parseByte,k.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},k.prototype.parseCard16=k.prototype.parseUShort,k.prototype.parseSID=k.prototype.parseUShort,k.prototype.parseOffset16=k.prototype.parseUShort,k.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},k.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},k.prototype.parseULong=function(){var t=ei(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},k.prototype.parseOffset32=k.prototype.parseULong,k.prototype.parseFixed=function(){var t=Ys(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},k.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n},k.prototype.parseTag=function(){return this.parseString(4)},k.prototype.parseLongDateTime=function(){var t=ei(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},k.prototype.parseVersion=function(t){var e=$n(this.data,this.offset+this.relativeOffset),r=$n(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10},k.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Gc[t]*e},k.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e},k.prototype.parseOffset16List=k.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e},k.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e},k.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e},k.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},k.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},k.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r},k.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var i={},a=0;a<n.length;a++){var l=n[a],c=e[l];i[l]=c.call(this)}r[o]=i}return r},k.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],i=t[o];r[o]=i.call(this)}return r},k.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},k.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r},k.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new k(this.data,this.offset+e).parseStruct(t)},k.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new k(this.data,this.offset+e).parseStruct(t)},k.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),i=0;i<r;i++){var a=e[i];if(a===0){o[i]=void 0;continue}if(this.relativeOffset=a,t){for(var l=this.parseOffset16List(),c=new Array(l.length),h=0;h<l.length;h++)this.relativeOffset=a+l[h],c[h]=t.call(this);o[i]=c}else o[i]=this.parseUShortList()}return this.relativeOffset=n,o},k.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},k.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:k.uShort,end:k.uShort,classId:k.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},k.list=function(t,e){return function(){return this.parseList(t,e)}},k.list32=function(t,e){return function(){return this.parseList32(t,e)}},k.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},k.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},k.pointer=function(t){return function(){return this.parsePointer(t)}},k.pointer32=function(t){return function(){return this.parsePointer32(t)}},k.tag=k.prototype.parseTag,k.byte=k.prototype.parseByte,k.uShort=k.offset16=k.prototype.parseUShort,k.uShortList=k.prototype.parseUShortList,k.uLong=k.offset32=k.prototype.parseULong,k.uLongList=k.prototype.parseULongList,k.struct=k.prototype.parseStruct,k.coverage=k.prototype.parseCoverage,k.classDef=k.prototype.parseClassDef;var Xs={reserved:k.uShort,reqFeatureIndex:k.uShort,featureIndexes:k.uShortList};k.prototype.parseScriptList=function(){return this.parsePointer(k.recordList({tag:k.tag,script:k.pointer({defaultLangSys:k.pointer(Xs),langSysRecords:k.recordList({tag:k.tag,langSys:k.pointer(Xs)})})}))||[]},k.prototype.parseFeatureList=function(){return this.parsePointer(k.recordList({tag:k.tag,feature:k.pointer({featureParams:k.offset16,lookupListIndexes:k.uShortList})}))||[]},k.prototype.parseLookupList=function(t){return this.parsePointer(k.list(k.pointer(function(){var e=this.parseUShort();Q.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(k.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},k.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();Q.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:k.offset32,featureTableSubstitutionOffset:k.offset32});return r})||[]};var J={getByte:$s,getCard8:$s,getUShort:$n,getCard16:$n,getShort:Fc,getULong:ei,getFixed:Ys,getTag:Lc,getOffset:Bc,getBytes:Uc,bytesToString:Ic,Parser:k};function Nc(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),i=e.parseULong(),a=e.parseULong(),l=o;l<=i;l+=1)t.glyphIndexMap[l]=a,a++}function Vc(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var i;t.segCount=i=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var a=new J.Parser(r,n+o+14),l=new J.Parser(r,n+o+16+i*2),c=new J.Parser(r,n+o+16+i*4),h=new J.Parser(r,n+o+16+i*6),d=n+o+16+i*8,g=0;g<i-1;g+=1)for(var v=void 0,b=a.parseUShort(),T=l.parseUShort(),C=c.parseShort(),x=h.parseUShort(),A=T;A<=b;A+=1)x!==0?(d=h.offset+h.relativeOffset-2,d+=x,d+=(A-T)*2,v=J.getUShort(r,d),v!==0&&(v=v+C&65535)):v=A+C&65535,t.glyphIndexMap[A]=v}function Hc(t,e){var r={};r.version=J.getUShort(t,e),Q.argument(r.version===0,"cmap table version should be 0."),r.numTables=J.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var i=J.getUShort(t,e+4+o*8),a=J.getUShort(t,e+4+o*8+2);if(i===3&&(a===0||a===1||a===10)||i===0&&(a===0||a===1||a===2||a===3||a===4)){n=J.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var l=new J.Parser(t,e+n);if(r.format=l.parseUShort(),r.format===12)Nc(r,l);else if(r.format===4)Vc(r,l,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function zc(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function Wc(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function $c(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new z.Table("cmap",o);for(i.segments=[],r=0;r<t.length;r+=1){for(var a=t.get(r),l=0;l<a.unicodes.length;l+=1)zc(i,a.unicodes[l],r);i.segments=i.segments.sort(function(F,M){return F.start-M.start})}Wc(i);var c=i.segments.length,h=0,d=[],g=[],v=[],b=[],T=[],C=[];for(r=0;r<c;r+=1){var x=i.segments[r];x.end<=65535&&x.start<=65535?(d=d.concat({name:"end_"+r,type:"USHORT",value:x.end}),g=g.concat({name:"start_"+r,type:"USHORT",value:x.start}),v=v.concat({name:"idDelta_"+r,type:"SHORT",value:x.delta}),b=b.concat({name:"idRangeOffset_"+r,type:"USHORT",value:x.offset}),x.glyphId!==void 0&&(T=T.concat({name:"glyph_"+r,type:"USHORT",value:x.glyphId}))):h+=1,!e&&x.glyphIndex!==void 0&&(C=C.concat({name:"cmap12Start_"+r,type:"ULONG",value:x.start}),C=C.concat({name:"cmap12End_"+r,type:"ULONG",value:x.end}),C=C.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:x.glyphIndex}))}if(i.segCountX2=(c-h)*2,i.searchRange=Math.pow(2,Math.floor(Math.log(c-h)/Math.log(2)))*2,i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(d),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(g),i.fields=i.fields.concat(v),i.fields=i.fields.concat(b),i.fields=i.fields.concat(T),i.cmap4Length=14+d.length*2+2+g.length*2+v.length*2+b.length*2+T.length*2,!e){var A=16+C.length*4;i.cmap12Offset=12+2*2+4+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:A},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:C.length/3}]),i.fields=i.fields.concat(C)}return i}var Yc={parse:Hc,make:$c},Yn=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Xc=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],jc=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],js=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function qs(t){this.font=t}qs.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),i=0;i<o.unicodes.length;i+=1)if(o.unicodes[i]===e)return n}return null};function Xn(t,e){this.encoding=t,this.charset=e}Xn.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function qc(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var ur={line:qc};function Zc(t,e){var r=e||new Ve;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function nt(t){this.bindConstructorValues(t)}nt.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",Zc(this,t.path))},nt.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)},nt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},nt.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var i,a;n||(n={});var l=n.xScale,c=n.yScale;if(n.hinting&&o&&o.hinting&&(a=this.path&&o.hinting.exec(this,r)),a)i=o.hinting.getCommands(a),t=Math.round(t),e=Math.round(e),l=c=1;else{i=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*r;l===void 0&&(l=h),c===void 0&&(c=h)}for(var d=new Ve,g=0;g<i.length;g+=1){var v=i[g];v.type==="M"?d.moveTo(t+v.x*l,e+-v.y*c):v.type==="L"?d.lineTo(t+v.x*l,e+-v.y*c):v.type==="Q"?d.quadraticCurveTo(t+v.x1*l,e+-v.y1*c,t+v.x*l,e+-v.y*c):v.type==="C"?d.curveTo(t+v.x1*l,e+-v.y1*c,t+v.x2*l,e+-v.y2*c,t+v.x*l,e+-v.y*c):v.type==="Z"&&d.closePath()}return d},nt.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return Q.argument(e.length===0,"There are still points left in the current contour."),t},nt.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var i={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i},nt.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)},nt.prototype.drawPoints=function(t,e,r,n){function o(g,v,b,T){t.beginPath();for(var C=0;C<g.length;C+=1)t.moveTo(v+g[C].x*T,b+g[C].y*T),t.arc(v+g[C].x*T,b+g[C].y*T,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var i=1/this.path.unitsPerEm*n,a=[],l=[],c=this.path,h=0;h<c.commands.length;h+=1){var d=c.commands[h];d.x!==void 0&&a.push({x:d.x,y:-d.y}),d.x1!==void 0&&l.push({x:d.x1,y:-d.y1}),d.x2!==void 0&&l.push({x:d.x2,y:-d.y2})}t.fillStyle="blue",o(a,e,r,i),t.fillStyle="red",o(l,e,r,i)},nt.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",ur.line(t,e,-1e4,e,1e4),ur.line(t,-1e4,r,1e4,r);var i=this.xMin||0,a=this.yMin||0,l=this.xMax||0,c=this.yMax||0,h=this.advanceWidth||0;t.strokeStyle="blue",ur.line(t,e+i*o,-1e4,e+i*o,1e4),ur.line(t,e+l*o,-1e4,e+l*o,1e4),ur.line(t,-1e4,r+-a*o,1e4,r+-a*o),ur.line(t,-1e4,r+-c*o,1e4,r+-c*o),t.strokeStyle="green",ur.line(t,e+h*o,-1e4,e+h*o,1e4)};function jn(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function ti(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}ti.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},ti.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function Kc(t,e){return new nt({index:e,font:t})}function Qc(t,e,r,n,o,i){return function(){var a=new nt({index:e,font:t});return a.path=function(){r(a,n,o);var l=i(t.glyphs,a);return l.unitsPerEm=t.unitsPerEm,l},jn(a,"xMin","_xMin"),jn(a,"xMax","_xMax"),jn(a,"yMin","_yMin"),jn(a,"yMax","_yMax"),a}}function Jc(t,e,r,n){return function(){var o=new nt({index:e,font:t});return o.path=function(){var i=r(t,o,n);return i.unitsPerEm=t.unitsPerEm,i},o}}var yt={GlyphSet:ti,glyphLoader:Kc,ttfGlyphLoader:Qc,cffGlyphLoader:Jc};function Zs(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!Zs(t[r],e[r]))return!1;return!0}else return!1}function ri(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Xt(t,e,r){var n=[],o=[],i=J.getCard16(t,e),a,l;if(i!==0){var c=J.getByte(t,e+2);a=e+(i+1)*c+2;for(var h=e+3,d=0;d<i+1;d+=1)n.push(J.getOffset(t,h,c)),h+=c;l=a+n[i]}else l=e+2;for(var g=0;g<n.length-1;g+=1){var v=J.getBytes(t,a+n[g],a+n[g+1]);r&&(v=r(v)),o.push(v)}return{objects:o,startOffset:e,endOffset:l}}function ef(t,e){var r=[],n=J.getCard16(t,e),o,i;if(n!==0){var a=J.getByte(t,e+2);o=e+(n+1)*a+2;for(var l=e+3,c=0;c<n+1;c+=1)r.push(J.getOffset(t,l,a)),l+=a;i=o+r[n]}else i=e+2;return{offsets:r,startOffset:e,endOffset:i}}function tf(t,e,r,n,o){var i=J.getCard16(r,n),a=0;if(i!==0){var l=J.getByte(r,n+2);a=n+(i+1)*l+2}var c=J.getBytes(r,a+e[t],a+e[t+1]);return o&&(c=o(c)),c}function rf(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),i=o>>4,a=o&15;if(i===r||(e+=n[i],a===r))break;e+=n[a]}return parseFloat(e)}function nf(t,e){var r,n,o,i;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),i=t.parseByte(),r<<24|n<<16|o<<8|i;if(e===30)return rf(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function of(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],i=void 0;if(o.length===1?i=o[0]:i=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=i}return e}function Ks(t,e,r){e=e!==void 0?e:0;var n=new J.Parser(t,e),o=[],i=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var a=n.parseByte();a<=21?(a===12&&(a=1200+n.parseByte()),o.push([a,i]),i=[]):i.push(nf(n,a))}return of(o)}function on(t,e){return e<=390?e=Yn[e]:e=t[e-391],e}function Qs(t,e,r){for(var n={},o,i=0;i<e.length;i+=1){var a=e[i];if(Array.isArray(a.type)){var l=[];l.length=a.type.length;for(var c=0;c<a.type.length;c++)o=t[a.op]!==void 0?t[a.op][c]:void 0,o===void 0&&(o=a.value!==void 0&&a.value[c]!==void 0?a.value[c]:null),a.type[c]==="SID"&&(o=on(r,o)),l[c]=o;n[a.name]=l}else o=t[a.op],o===void 0&&(o=a.value!==void 0?a.value:null),a.type==="SID"&&(o=on(r,o)),n[a.name]=o}return n}function sf(t,e){var r={};return r.formatMajor=J.getCard8(t,e),r.formatMinor=J.getCard8(t,e+1),r.size=J.getCard8(t,e+2),r.offsetSize=J.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Js=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],ea=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function af(t,e){var r=Ks(t,0,t.byteLength);return Qs(r,Js,e)}function ta(t,e,r,n){var o=Ks(t,e,r);return Qs(o,ea,n)}function ra(t,e,r,n){for(var o=[],i=0;i<r.length;i+=1){var a=new DataView(new Uint8Array(r[i]).buffer),l=af(a,n);l._subrs=[],l._subrsBias=0,l._defaultWidthX=0,l._nominalWidthX=0;var c=l.private[0],h=l.private[1];if(c!==0&&h!==0){var d=ta(t,h+e,c,n);if(l._defaultWidthX=d.defaultWidthX,l._nominalWidthX=d.nominalWidthX,d.subrs!==0){var g=h+d.subrs,v=Xt(t,g+e);l._subrs=v.objects,l._subrsBias=ri(l._subrs)}l._privateDict=d}o.push(l)}return o}function uf(t,e,r,n){var o,i,a=new J.Parser(t,e);r-=1;var l=[".notdef"],c=a.parseCard8();if(c===0)for(var h=0;h<r;h+=1)o=a.parseSID(),l.push(on(n,o));else if(c===1)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard8();for(var d=0;d<=i;d+=1)l.push(on(n,o)),o+=1}else if(c===2)for(;l.length<=r;){o=a.parseSID(),i=a.parseCard16();for(var g=0;g<=i;g+=1)l.push(on(n,o)),o+=1}else throw new Error("Unknown charset format "+c);return l}function lf(t,e,r){var n,o={},i=new J.Parser(t,e),a=i.parseCard8();if(a===0)for(var l=i.parseCard8(),c=0;c<l;c+=1)n=i.parseCard8(),o[n]=c;else if(a===1){var h=i.parseCard8();n=1;for(var d=0;d<h;d+=1)for(var g=i.parseCard8(),v=i.parseCard8(),b=g;b<=g+v;b+=1)o[b]=n,n+=1}else throw new Error("Unknown encoding format "+a);return new Xn(o,r)}function na(t,e,r){var n,o,i,a,l=new Ve,c=[],h=0,d=!1,g=!1,v=0,b=0,T,C,x,A;if(t.isCIDFont){var F=t.tables.cff.topDict._fdSelect[e.index],M=t.tables.cff.topDict._fdArray[F];T=M._subrs,C=M._subrsBias,x=M._defaultWidthX,A=M._nominalWidthX}else T=t.tables.cff.topDict._subrs,C=t.tables.cff.topDict._subrsBias,x=t.tables.cff.topDict._defaultWidthX,A=t.tables.cff.topDict._nominalWidthX;var $=x;function V(Z,se){g&&l.closePath(),l.moveTo(Z,se),g=!0}function q(){var Z;Z=c.length%2!==0,Z&&!d&&($=c.shift()+A),h+=c.length>>1,c.length=0,d=!0}function X(Z){for(var se,be,Se,_e,xe,re,ce,ye,ae,te,le,we,fe=0;fe<Z.length;){var Ce=Z[fe];switch(fe+=1,Ce){case 1:q();break;case 3:q();break;case 4:c.length>1&&!d&&($=c.shift()+A,d=!0),b+=c.pop(),V(v,b);break;case 5:for(;c.length>0;)v+=c.shift(),b+=c.shift(),l.lineTo(v,b);break;case 6:for(;c.length>0&&(v+=c.shift(),l.lineTo(v,b),c.length!==0);)b+=c.shift(),l.lineTo(v,b);break;case 7:for(;c.length>0&&(b+=c.shift(),l.lineTo(v,b),c.length!==0);)v+=c.shift(),l.lineTo(v,b);break;case 8:for(;c.length>0;)n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+c.shift(),l.curveTo(n,o,i,a,v,b);break;case 10:xe=c.pop()+C,re=T[xe],re&&X(re);break;case 11:return;case 12:switch(Ce=Z[fe],fe+=1,Ce){case 35:n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),ce=i+c.shift(),ye=a+c.shift(),ae=ce+c.shift(),te=ye+c.shift(),le=ae+c.shift(),we=te+c.shift(),v=le+c.shift(),b=we+c.shift(),c.shift(),l.curveTo(n,o,i,a,ce,ye),l.curveTo(ae,te,le,we,v,b);break;case 34:n=v+c.shift(),o=b,i=n+c.shift(),a=o+c.shift(),ce=i+c.shift(),ye=a,ae=ce+c.shift(),te=a,le=ae+c.shift(),we=b,v=le+c.shift(),l.curveTo(n,o,i,a,ce,ye),l.curveTo(ae,te,le,we,v,b);break;case 36:n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),ce=i+c.shift(),ye=a,ae=ce+c.shift(),te=a,le=ae+c.shift(),we=te+c.shift(),v=le+c.shift(),l.curveTo(n,o,i,a,ce,ye),l.curveTo(ae,te,le,we,v,b);break;case 37:n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),ce=i+c.shift(),ye=a+c.shift(),ae=ce+c.shift(),te=ye+c.shift(),le=ae+c.shift(),we=te+c.shift(),Math.abs(le-v)>Math.abs(we-b)?v=le+c.shift():b=we+c.shift(),l.curveTo(n,o,i,a,ce,ye),l.curveTo(ae,te,le,we,v,b);break;default:console.log("Glyph "+e.index+": unknown operator "+1200+Ce),c.length=0}break;case 14:c.length>0&&!d&&($=c.shift()+A,d=!0),g&&(l.closePath(),g=!1);break;case 18:q();break;case 19:case 20:q(),fe+=h+7>>3;break;case 21:c.length>2&&!d&&($=c.shift()+A,d=!0),b+=c.pop(),v+=c.pop(),V(v,b);break;case 22:c.length>1&&!d&&($=c.shift()+A,d=!0),v+=c.pop(),V(v,b);break;case 23:q();break;case 24:for(;c.length>2;)n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+c.shift(),l.curveTo(n,o,i,a,v,b);v+=c.shift(),b+=c.shift(),l.lineTo(v,b);break;case 25:for(;c.length>6;)v+=c.shift(),b+=c.shift(),l.lineTo(v,b);n=v+c.shift(),o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+c.shift(),l.curveTo(n,o,i,a,v,b);break;case 26:for(c.length%2&&(v+=c.shift());c.length>0;)n=v,o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i,b=a+c.shift(),l.curveTo(n,o,i,a,v,b);break;case 27:for(c.length%2&&(b+=c.shift());c.length>0;)n=v+c.shift(),o=b,i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a,l.curveTo(n,o,i,a,v,b);break;case 28:se=Z[fe],be=Z[fe+1],c.push((se<<24|be<<16)>>16),fe+=2;break;case 29:xe=c.pop()+t.gsubrsBias,re=t.gsubrs[xe],re&&X(re);break;case 30:for(;c.length>0&&(n=v,o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,b),c.length!==0);)n=v+c.shift(),o=b,i=n+c.shift(),a=o+c.shift(),b=a+c.shift(),v=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,b);break;case 31:for(;c.length>0&&(n=v+c.shift(),o=b,i=n+c.shift(),a=o+c.shift(),b=a+c.shift(),v=i+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,b),c.length!==0);)n=v,o=b+c.shift(),i=n+c.shift(),a=o+c.shift(),v=i+c.shift(),b=a+(c.length===1?c.shift():0),l.curveTo(n,o,i,a,v,b);break;default:Ce<32?console.log("Glyph "+e.index+": unknown operator "+Ce):Ce<247?c.push(Ce-139):Ce<251?(se=Z[fe],fe+=1,c.push((Ce-247)*256+se+108)):Ce<255?(se=Z[fe],fe+=1,c.push(-(Ce-251)*256-se-108)):(se=Z[fe],be=Z[fe+1],Se=Z[fe+2],_e=Z[fe+3],fe+=4,c.push((se<<24|be<<16|Se<<8|_e)/65536))}}}return X(r),e.advanceWidth=$,l}function cf(t,e,r,n){var o=[],i,a=new J.Parser(t,e),l=a.parseCard8();if(l===0)for(var c=0;c<r;c++){if(i=a.parseCard8(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");o.push(i)}else if(l===3){var h=a.parseCard16(),d=a.parseCard16();if(d!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+d);for(var g,v=0;v<h;v++){if(i=a.parseCard8(),g=a.parseCard16(),i>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+n+")");if(g>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+g);for(;d<g;d++)o.push(i);d=g}if(g!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+g)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+l);return o}function ff(t,e,r,n){r.tables.cff={};var o=sf(t,e),i=Xt(t,o.endOffset,J.bytesToString),a=Xt(t,i.endOffset),l=Xt(t,a.endOffset,J.bytesToString),c=Xt(t,l.endOffset);r.gsubrs=c.objects,r.gsubrsBias=ri(r.gsubrs);var h=ra(t,e,a.objects,l.objects);if(h.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var d=h[0];if(r.tables.cff.topDict=d,d._privateDict&&(r.defaultWidthX=d._privateDict.defaultWidthX,r.nominalWidthX=d._privateDict.nominalWidthX),d.ros[0]!==void 0&&d.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var g=d.fdArray,v=d.fdSelect;if(g===0||v===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");g+=e;var b=Xt(t,g),T=ra(t,e,b.objects,l.objects);d._fdArray=T,v+=e,d._fdSelect=cf(t,v,r.numGlyphs,T.length)}var C=e+d.private[1],x=ta(t,C,d.private[0],l.objects);if(r.defaultWidthX=x.defaultWidthX,r.nominalWidthX=x.nominalWidthX,x.subrs!==0){var A=C+x.subrs,F=Xt(t,A);r.subrs=F.objects,r.subrsBias=ri(r.subrs)}else r.subrs=[],r.subrsBias=0;var M;n.lowMemory?(M=ef(t,e+d.charStrings),r.nGlyphs=M.offsets.length):(M=Xt(t,e+d.charStrings),r.nGlyphs=M.objects.length);var $=uf(t,e+d.charset,r.nGlyphs,l.objects);if(d.encoding===0?r.cffEncoding=new Xn(Xc,$):d.encoding===1?r.cffEncoding=new Xn(jc,$):r.cffEncoding=lf(t,e+d.encoding,$),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new yt.GlyphSet(r),n.lowMemory)r._push=function(X){var Z=tf(X,M.offsets,t,e+d.charStrings);r.glyphs.push(X,yt.cffGlyphLoader(r,X,na,Z))};else for(var V=0;V<r.nGlyphs;V+=1){var q=M.objects[V];r.glyphs.push(V,yt.cffGlyphLoader(r,V,na,q))}}function oa(t,e){var r,n=Yn.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Yn.length:(r=Yn.length+e.length,e.push(t)),r}function hf(){return new z.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function pf(t){var e=new z.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function ia(t,e,r){for(var n={},o=0;o<t.length;o+=1){var i=t[o],a=e[i.name];a!==void 0&&!Zs(a,i.value)&&(i.type==="SID"&&(a=oa(a,r)),n[i.op]={name:i.name,type:i.type,value:a})}return n}function sa(t,e){var r=new z.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ia(Js,t,e),r}function aa(t){var e=new z.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function df(t){var e=new z.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function vf(){return new z.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function gf(t,e){for(var r=new z.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],i=oa(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:i})}return r}function mf(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,i=0;i<r.commands.length;i+=1){var a=void 0,l=void 0,c=r.commands[i];if(c.type==="Q"){var h=.3333333333333333,d=2/3;c={type:"C",x:c.x,y:c.y,x1:Math.round(h*n+d*c.x1),y1:Math.round(h*o+d*c.y1),x2:Math.round(h*c.x+d*c.x1),y2:Math.round(h*c.y+d*c.y1)}}if(c.type==="M")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="L")a=Math.round(c.x-n),l=Math.round(c.y-o),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),o=Math.round(c.y);else if(c.type==="C"){var g=Math.round(c.x1-n),v=Math.round(c.y1-o),b=Math.round(c.x2-c.x1),T=Math.round(c.y2-c.y1);a=Math.round(c.x-c.x2),l=Math.round(c.y-c.y2),e.push({name:"dx1",type:"NUMBER",value:g}),e.push({name:"dy1",type:"NUMBER",value:v}),e.push({name:"dx2",type:"NUMBER",value:b}),e.push({name:"dy2",type:"NUMBER",value:T}),e.push({name:"dx",type:"NUMBER",value:a}),e.push({name:"dy",type:"NUMBER",value:l}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),o=Math.round(c.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function yf(t){for(var e=new z.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=mf(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function wf(t,e){var r=new z.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ia(ea,t,e),r}function bf(t,e){for(var r=new z.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i={},a=[],l,c=1;c<t.length;c+=1)l=t.get(c),a.push(l.name);var h=[];r.header=hf(),r.nameIndex=pf([e.postScriptName]);var d=sa(o,h);r.topDictIndex=aa(d),r.globalSubrIndex=vf(),r.charsets=gf(a,h),r.charStringsIndex=yf(t),r.privateDict=wf(i,h),r.stringIndex=df(h);var g=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=g,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),d=sa(o,h),r.topDictIndex=aa(d),r}var Sf={parse:ff,make:bf};function _f(t,e){var r={},n=new J.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),Q.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function Tf(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new z.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var Ef={parse:_f,make:Tf};function xf(t,e){var r={},n=new J.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function Cf(t){return new z.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var kf={parse:xf,make:Cf};function Pf(t,e,r,n,o){for(var i,a,l=new J.Parser(t,e),c=0;c<n;c+=1){c<r&&(i=l.parseUShort(),a=l.parseShort());var h=o.get(c);h.advanceWidth=i,h.leftSideBearing=a}}function Af(t,e,r,n,o){t._hmtxTableData={};for(var i,a,l=new J.Parser(e,r),c=0;c<o;c+=1)c<n&&(i=l.parseUShort(),a=l.parseShort()),t._hmtxTableData[c]={advanceWidth:i,leftSideBearing:a}}function Rf(t,e,r,n,o,i,a){a.lowMemory?Af(t,e,r,n,o):Pf(e,r,n,o,i)}function Of(t){for(var e=new z.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,i=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return e}var Mf={parse:Rf,make:Of};function Df(t){for(var e=new z.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var i=r.indexOf(t[o]);i<0&&(i=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+i}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function Ff(t,e){var r=new J.Parser(t,e),n=r.parseULong();Q.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),i=[],a=0;a<o;a++){for(var l="",c=e+r.parseUShort(),h=r.parseUShort(),d=c;d<c+h;++d)l+=String.fromCharCode(t.getInt8(d));i.push(l)}return i}var Lf={make:Df,parse:Ff};function Bf(t,e){var r={},n=new J.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function Uf(t){return new z.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var If={parse:Bf,make:Uf},ua=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],la={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Gf={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},ca={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Nf(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return la[e];case 3:return ca[e]}}var ni="utf-16",Vf={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Hf={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function fa(t,e,r){switch(t){case 0:return ni;case 1:return Hf[r]||Vf[e];case 3:if(e===1||e===10)return ni;break}}function zf(t,e,r){for(var n={},o=new J.Parser(t,e),i=o.parseUShort(),a=o.parseUShort(),l=o.offset+o.parseUShort(),c=0;c<a;c++){var h=o.parseUShort(),d=o.parseUShort(),g=o.parseUShort(),v=o.parseUShort(),b=ua[v]||v,T=o.parseUShort(),C=o.parseUShort(),x=Nf(h,g,r),A=fa(h,d,g);if(A!==void 0&&x!==void 0){var F=void 0;if(A===ni?F=kr.UTF16(t,l+C,T):F=kr.MACSTRING(t,l+C,T,A),F){var M=n[b];M===void 0&&(M=n[b]={}),M[x]=F}}}return i===1&&o.parseUShort(),n}function oi(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function ha(t,e,r,n,o,i){return new z.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:i}])}function Wf(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var i=0;i<r;i++)if(e[o+i]!==t[i])continue e;return o}return-1}function pa(t,e){var r=Wf(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function $f(t,e){var r,n=[],o={},i=oi(ua);for(var a in t){var l=i[a];if(l===void 0&&(l=a),r=parseInt(l),isNaN(r))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');o[r]=t[a],n.push(r)}for(var c=oi(la),h=oi(ca),d=[],g=[],v=0;v<n.length;v++){r=n[v];var b=o[r];for(var T in b){var C=b[T],x=1,A=c[T],F=Gf[A],M=fa(x,F,A),$=N.MACSTRING(C,M);$===void 0&&(x=0,A=e.indexOf(T),A<0&&(A=e.length,e.push(T)),F=4,$=N.UTF16(C));var V=pa($,g);d.push(ha(x,F,A,r,$.length,V));var q=h[T];if(q!==void 0){var X=N.UTF16(C),Z=pa(X,g);d.push(ha(3,1,q,r,X.length,Z))}}}d.sort(function(Se,_e){return Se.platformID-_e.platformID||Se.encodingID-_e.encodingID||Se.languageID-_e.languageID||Se.nameID-_e.nameID});for(var se=new z.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:d.length},{name:"stringOffset",type:"USHORT",value:6+d.length*12}]),be=0;be<d.length;be++)se.fields.push({name:"record_"+be,type:"RECORD",value:d[be]});return se.fields.push({name:"strings",type:"LITERAL",value:g}),se}var Yf={parse:zf,make:$f},ii=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Xf(t){for(var e=0;e<ii.length;e+=1){var r=ii[e];if(t>=r.begin&&t<r.end)return e}return-1}function jf(t,e){var r={},n=new J.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function qf(t){return new z.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var da={parse:jf,make:qf,unicodeRanges:ii,getUnicodeRange:Xf};function Zf(t,e){var r={},n=new J.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=js.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var i=0;i<r.numberOfGlyphs;i++)if(r.glyphNameIndex[i]>=js.length){var a=n.parseChar();r.names.push(n.parseString(a))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var l=0;l<r.numberOfGlyphs;l++)r.offset[l]=n.parseChar();break}return r}function Kf(){return new z.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var Qf={parse:Zf,make:Kf},ct=new Array(9);ct[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(k.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(k.coverage),substitute:this.parseOffset16List()};Q.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},ct[2]=function(){var e=this.parseUShort();return Q.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),sequences:this.parseListOfLists()}},ct[3]=function(){var e=this.parseUShort();return Q.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),alternateSets:this.parseListOfLists()}},ct[4]=function(){var e=this.parseUShort();return Q.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var Pr={sequenceIndex:k.uShort,lookupListIndex:k.uShort};ct[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(k.coverage),ruleSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{input:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Pr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(k.coverage),classDef:this.parsePointer(k.classDef),classSets:this.parseListOfLists(function(){var i=this.parseUShort(),a=this.parseUShort();return{classes:this.parseUShortList(i-1),lookupRecords:this.parseRecordList(a,Pr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,k.pointer(k.coverage)),lookupRecords:this.parseRecordList(o,Pr)}}Q.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},ct[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(k.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Pr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(k.coverage),backtrackClassDef:this.parsePointer(k.classDef),inputClassDef:this.parsePointer(k.classDef),lookaheadClassDef:this.parsePointer(k.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Pr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(k.pointer(k.coverage)),inputCoverage:this.parseList(k.pointer(k.coverage)),lookaheadCoverage:this.parseList(k.pointer(k.coverage)),lookupRecords:this.parseRecordList(Pr)};Q.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},ct[7]=function(){var e=this.parseUShort();Q.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new k(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:ct[r].call(n)}},ct[8]=function(){var e=this.parseUShort();return Q.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(k.coverage),backtrackCoverage:this.parseList(k.pointer(k.coverage)),lookaheadCoverage:this.parseList(k.pointer(k.coverage)),substitutes:this.parseUShortList()}};function Jf(t,e){e=e||0;var r=new k(t,e),n=r.parseVersion(1);return Q.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(ct)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(ct),variations:r.parseFeatureVariationsList()}}var Ar=new Array(9);Ar[1]=function(e){return e.substFormat===1?new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.ushortList("substitute",e.substitute)))},Ar[2]=function(e){return Q.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("seqSet",e.sequences,function(r){return new z.Table("sequenceSetTable",z.ushortList("sequence",r))})))},Ar[3]=function(e){return Q.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("altSet",e.alternateSets,function(r){return new z.Table("alternateSetTable",z.ushortList("alternate",r))})))},Ar[4]=function(e){return Q.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("ligSet",e.ligatureSets,function(r){return new z.Table("ligatureSetTable",z.tableList("ligature",r,function(n){return new z.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(z.ushortList("component",n.components,n.components.length+1)))}))})))},Ar[6]=function(e){if(e.substFormat===1){var r=new z.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("chainRuleSet",e.chainRuleSets,function(i){return new z.Table("chainRuleSetTable",z.tableList("chainRule",i,function(a){var l=z.ushortList("backtrackGlyph",a.backtrack,a.backtrack.length).concat(z.ushortList("inputGlyph",a.input,a.input.length+1)).concat(z.ushortList("lookaheadGlyph",a.lookahead,a.lookahead.length)).concat(z.ushortList("substitution",[],a.lookupRecords.length));return a.lookupRecords.forEach(function(c,h){l=l.concat({name:"sequenceIndex"+h,type:"USHORT",value:c.sequenceIndex}).concat({name:"lookupListIndex"+h,type:"USHORT",value:c.lookupListIndex})}),new z.Table("chainRuleTable",l)}))})));return r}else if(e.substFormat===2)Q.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(i,a){n.push({name:"backtrackCoverage"+a,type:"TABLE",value:new z.Coverage(i)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(i,a){n.push({name:"inputCoverage"+a,type:"TABLE",value:new z.Coverage(i)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(i,a){n.push({name:"lookaheadCoverage"+a,type:"TABLE",value:new z.Coverage(i)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(i,a){n=n.concat({name:"sequenceIndex"+a,type:"USHORT",value:i.sequenceIndex}).concat({name:"lookupListIndex"+a,type:"USHORT",value:i.lookupListIndex})});var o=new z.Table("chainContextTable",n);return o}Q.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function eh(t){return new z.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new z.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new z.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new z.LookupList(t.lookups,Ar)}])}var th={parse:Jf,make:eh};function rh(t,e){var r=new J.Parser(t,e),n=r.parseULong();Q.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),i={},a=0;a<o;a++){var l=r.parseTag(),c=r.parseULong(),h=r.parseULong(),d=kr.UTF8(t,e+c,h);i[l]=d}return i}function nh(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new z.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var i in t){var a=r.length;r+=t[i],o.fields.push({name:"tag "+i,type:"TAG",value:i}),o.fields.push({name:"offset "+i,type:"ULONG",value:n+a}),o.fields.push({name:"length "+i,type:"ULONG",value:t[i].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var oh={parse:rh,make:nh};function va(t){return Math.log(t)/Math.log(2)|0}function si(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function ga(t,e,r,n){return new z.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function ma(t){var e=new z.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,va(e.numTables));e.searchRange=16*r,e.entrySelector=va(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],i=e.sizeOf()+ga().sizeOf()*e.numTables;i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<t.length;a+=1){var l=t[a];Q.argument(l.tableName.length===4,"Table name"+l.tableName+" is invalid.");var c=l.sizeOf(),h=ga(l.tableName,si(l.encode()),i,c);for(n.push({name:h.tag+" Table Record",type:"RECORD",value:h}),o.push({name:l.tableName+" table",type:"RECORD",value:l}),i+=c,Q.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(d,g){return d.value.tag>g.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function ya(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var i=t.glyphs.get(o);return i.getMetrics()}}return r}function ih(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function sh(t){for(var e=[],r=[],n=[],o=[],i=[],a=[],l=[],c,h=0,d=0,g=0,v=0,b=0,T=0;T<t.glyphs.length;T+=1){var C=t.glyphs.get(T),x=C.unicode|0;if(isNaN(C.advanceWidth))throw new Error("Glyph "+C.name+" ("+T+"): advanceWidth is not a number.");(c>x||c===void 0)&&x>0&&(c=x),h<x&&(h=x);var A=da.getUnicodeRange(x);if(A<32)d|=1<<A;else if(A<64)g|=1<<A-32;else if(A<96)v|=1<<A-64;else if(A<123)b|=1<<A-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(C.name!==".notdef"){var F=C.getMetrics();e.push(F.xMin),r.push(F.yMin),n.push(F.xMax),o.push(F.yMax),a.push(F.leftSideBearing),l.push(F.rightSideBearing),i.push(C.advanceWidth)}}var M={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:ih(i),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,l)};M.ascender=t.ascender,M.descender=t.descender;var $=Ef.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:M.xMin,yMin:M.yMin,xMax:M.xMax,yMax:M.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),V=kf.make({ascender:M.ascender,descender:M.descender,advanceWidthMax:M.advanceWidthMax,minLeftSideBearing:M.minLeftSideBearing,minRightSideBearing:M.minRightSideBearing,xMaxExtent:M.maxLeftSideBearing+(M.xMax-M.xMin),numberOfHMetrics:t.glyphs.length}),q=If.make(t.glyphs.length),X=da.make(Object.assign({xAvgCharWidth:Math.round(M.advanceWidthAvg),usFirstCharIndex:c,usLastCharIndex:h,ulUnicodeRange1:d,ulUnicodeRange2:g,ulUnicodeRange3:v,ulUnicodeRange4:b,sTypoAscender:M.ascender,sTypoDescender:M.descender,sTypoLineGap:0,usWinAscent:M.yMax,usWinDescent:Math.abs(M.yMin),ulCodePageRange1:1,sxHeight:ya(t,"xyvw",{yMax:Math.round(M.ascender/2)}).yMax,sCapHeight:ya(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",M).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),Z=Mf.make(t.glyphs),se=Yc.make(t.glyphs),be=t.getEnglishName("fontFamily"),Se=t.getEnglishName("fontSubfamily"),_e=be+" "+Se,xe=t.getEnglishName("postScriptName");xe||(xe=be.replace(/\s/g,"")+"-"+Se);var re={};for(var ce in t.names)re[ce]=t.names[ce];re.uniqueID||(re.uniqueID={en:t.getEnglishName("manufacturer")+":"+_e}),re.postScriptName||(re.postScriptName={en:xe}),re.preferredFamily||(re.preferredFamily=t.names.fontFamily),re.preferredSubfamily||(re.preferredSubfamily=t.names.fontSubfamily);var ye=[],ae=Yf.make(re,ye),te=ye.length>0?Lf.make(ye):void 0,le=Qf.make(),we=Sf.make(t.glyphs,{version:t.getEnglishName("version"),fullName:_e,familyName:be,weightName:Se,postScriptName:xe,unitsPerEm:t.unitsPerEm,fontBBox:[0,M.yMin,M.ascender,M.advanceWidthMax]}),fe=t.metas&&Object.keys(t.metas).length>0?oh.make(t.metas):void 0,Ce=[$,V,q,X,ae,se,le,we,Z];te&&Ce.push(te),t.tables.gsub&&Ce.push(th.make(t.tables.gsub)),fe&&Ce.push(fe);for(var _t=ma(Ce),Lt=_t.encode(),Tt=si(Lt),er=_t.fields,Lr=!1,pt=0;pt<er.length;pt+=1)if(er[pt].name==="head table"){er[pt].value.checkSumAdjustment=2981146554-Tt,Lr=!0;break}if(!Lr)throw new Error("Could not find head table with checkSum to adjust.");return _t}var ah={make:ma,fontToTable:sh,computeCheckSum:si};function ai(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o].tag;if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function wa(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,i=t[o];if(i===e)return o;i<e?r=o+1:n=o-1}return-r-1}function ba(t,e){for(var r,n=0,o=t.length-1;n<=o;){var i=n+o>>>1;r=t[i];var a=r.start;if(a===e)return r;a<e?n=i+1:o=i-1}if(n>0)return r=t[n-1],e>r.end?0:r}function sn(t,e){this.font=t,this.tableName=e}sn.prototype={searchTag:ai,binSearch:wa,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=ai(r.scripts,t);if(o>=0)return n[o].script;if(e){var i={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,i),i.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=ai(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var i={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,i),i.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var i,a=o.featureIndexes,l=this.font.tables[this.tableName].features,c=0;c<a.length;c++)if(i=l[a[c]],i.tag===r)return i.feature;if(n){var h=l.length;return Q.assert(h===0||r>=l[h-1].tag,"Features must be added in alphabetical order."),i={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(i),a.push(h),i.feature}}},getLookupTables:function(t,e,r,n,o){var i=this.getFeatureTable(t,e,r,o),a=[];if(i){for(var l,c=i.lookupListIndexes,h=this.font.tables[this.tableName].lookups,d=0;d<c.length;d++)l=h[c[d]],l.lookupType===n&&a.push(l);if(a.length===0&&o){l={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var g=h.length;return h.push(l),c.push(g),[l]}}return a},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=ba(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=wa(t.glyphs,e);return r>=0?r:-1;case 2:var n=ba(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],i=o.start,a=o.end,l=i;l<=a;l++)e.push(l);return e}};function an(t){sn.call(this,t,"gpos")}an.prototype=sn.prototype,an.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},an.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,i=0;i<o.length;i++){var a=o[i],l=this.getCoverageIndex(a.coverage,e);if(!(l<0))switch(a.posFormat){case 1:for(var c=a.pairSets[l],h=0;h<c.length;h++){var d=c[h];if(d.secondGlyph===r)return d.value1&&d.value1.xAdvance||0}break;case 2:var g=this.getGlyphClass(a.classDef1,e),v=this.getGlyphClass(a.classDef2,r),b=a.classRecords[g][v];return b.value1&&b.value1.xAdvance||0}}return 0},an.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function tt(t){sn.call(this,t,"gsub")}function uh(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function ui(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var i=n[o];if(i.substFormat===e)return i}if(r)return n.push(r),r}tt.prototype=sn.prototype,tt.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},tt.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),d=void 0;if(c.substFormat===1){var g=c.deltaGlyphId;for(d=0;d<h.length;d++){var v=h[d];n.push({sub:v,by:v+g})}}else{var b=c.substitute;for(d=0;d<h.length;d++)n.push({sub:h[d],by:b[d]})}}return n},tt.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++){var c=a[l],h=this.expandCoverage(c.coverage),d=void 0;for(d=0;d<h.length;d++){var g=h[d],v=c.sequences[d];n.push({sub:g,by:v})}}return n},tt.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),d=c.alternateSets,g=0;g<h.length;g++)n.push({sub:h[g],by:d[g]});return n},tt.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),i=0;i<o.length;i++)for(var a=o[i].subtables,l=0;l<a.length;l++)for(var c=a[l],h=this.expandCoverage(c.coverage),d=c.ligatureSets,g=0;g<h.length;g++)for(var v=h[g],b=d[g],T=0;T<b.length;T++){var C=b[T];n.push({sub:[v].concat(C.components),by:C.ligGlyph})}return n},tt.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],i=ui(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});Q.assert(i.coverage.format===1,"Single: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.substitute.splice(l,0,0)),i.substitute[l]=e.by},tt.prototype.addMultiple=function(t,e,r,n){Q.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],i=ui(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});Q.assert(i.coverage.format===1,"Multiple: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.sequences.splice(l,0,0)),i.sequences[l]=e.by},tt.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],i=ui(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});Q.assert(i.coverage.format===1,"Alternate: unable to modify coverage table format "+i.coverage.format);var a=e.sub,l=this.binSearch(i.coverage.glyphs,a);l<0&&(l=-1-l,i.coverage.glyphs.splice(l,0,a),i.alternateSets.splice(l,0,0)),i.alternateSets[l]=e.by},tt.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],i=o.subtables[0];i||(i={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=i),Q.assert(i.coverage.format===1,"Ligature: unable to modify coverage table format "+i.coverage.format);var a=e.sub[0],l=e.sub.slice(1),c={ligGlyph:e.by,components:l},h=this.binSearch(i.coverage.glyphs,a);if(h>=0){for(var d=i.ligatureSets[h],g=0;g<d.length;g++)if(uh(d[g].components,l))return;d.push(c)}else h=-1-h,i.coverage.glyphs.splice(h,0,a),i.ligatureSets.splice(h,0,[c])},tt.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}},tt.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function lh(){return typeof window<"u"}function ch(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function un(t,e){if(!t)throw e}function Sa(t,e,r,n,o){var i;return(e&n)>0?(i=t.parseByte(),e&o||(i=-i),i=r+i):(e&o)>0?i=r:i=r+t.parseShort(),i}function _a(t,e,r){var n=new J.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,i;if(t.numberOfContours>0){for(var a=t.endPointIndices=[],l=0;l<t.numberOfContours;l+=1)a.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var c=0;c<t.instructionLength;c+=1)t.instructions.push(n.parseByte());var h=a[a.length-1]+1;o=[];for(var d=0;d<h;d+=1)if(i=n.parseByte(),o.push(i),(i&8)>0)for(var g=n.parseByte(),v=0;v<g;v+=1)o.push(i),d+=1;if(Q.argument(o.length===h,"Bad flags."),a.length>0){var b=[],T;if(h>0){for(var C=0;C<h;C+=1)i=o[C],T={},T.onCurve=!!(i&1),T.lastPointOfContour=a.indexOf(C)>=0,b.push(T);for(var x=0,A=0;A<h;A+=1)i=o[A],T=b[A],T.x=Sa(n,i,x,2,16),x=T.x;for(var F=0,M=0;M<h;M+=1)i=o[M],T=b[M],T.y=Sa(n,i,F,4,32),F=T.y}t.points=b}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var $=!0;$;){o=n.parseUShort();var V={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(V.dx=n.parseShort(),V.dy=n.parseShort()):V.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(V.dx=n.parseChar(),V.dy=n.parseChar()):V.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?V.xScale=V.yScale=n.parseF2Dot14():(o&64)>0?(V.xScale=n.parseF2Dot14(),V.yScale=n.parseF2Dot14()):(o&128)>0&&(V.xScale=n.parseF2Dot14(),V.scale01=n.parseF2Dot14(),V.scale10=n.parseF2Dot14(),V.yScale=n.parseF2Dot14()),t.components.push(V),$=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var q=0;q<t.instructionLength;q+=1)t.instructions.push(n.parseByte())}}}function li(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(i)}return r}function fh(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return Q.argument(r.length===0,"There are still points left in the current contour."),e}function Ta(t){var e=new Ve;if(!t)return e;for(var r=fh(t),n=0;n<r.length;++n){var o=r[n],i=null,a=o[o.length-1],l=o[0];if(a.onCurve)e.moveTo(a.x,a.y);else if(l.onCurve)e.moveTo(l.x,l.y);else{var c={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5};e.moveTo(c.x,c.y)}for(var h=0;h<o.length;++h)if(i=a,a=l,l=o[(h+1)%o.length],a.onCurve)e.lineTo(a.x,a.y);else{var d=l;i.onCurve||((a.x+i.x)*.5,(a.y+i.y)*.5),l.onCurve||(d={x:(a.x+l.x)*.5,y:(a.y+l.y)*.5}),e.quadraticCurveTo(a.x,a.y,d.x,d.y)}e.closePath()}return e}function Ea(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var i=void 0;if(n.matchedPoints===void 0)i=li(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var a=e.points[n.matchedPoints[0]],l=o.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};l=li([l],c)[0],c.dx=a.x-l.x,c.dy=a.y-l.y,i=li(o.points,c)}e.points=e.points.concat(i)}}return Ta(e.points)}function hh(t,e,r,n){for(var o=new yt.GlyphSet(n),i=0;i<r.length-1;i+=1){var a=r[i],l=r[i+1];a!==l?o.push(i,yt.ttfGlyphLoader(n,i,_a,t,e+a,Ea)):o.push(i,yt.glyphLoader(n,i))}return o}function ph(t,e,r,n){var o=new yt.GlyphSet(n);return n._push=function(i){var a=r[i],l=r[i+1];a!==l?o.push(i,yt.ttfGlyphLoader(n,i,_a,t,e+a,Ea)):o.push(i,yt.glyphLoader(n,i))},o}function dh(t,e,r,n,o){return o.lowMemory?ph(t,e,r,n):hh(t,e,r,n)}var vh={getPath:Ta,parse:dh},xa,lr,Ca,ci;function ka(t){this.font=t,this.getCommands=function(e){return vh.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function gh(t){return t}function Pa(t){return Math.sign(t)*Math.round(Math.abs(t))}function mh(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function yh(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function wh(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function bh(t){return Math.sign(t)*Math.floor(Math.abs(t))}var Aa=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},wt={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,d;if(!n||n===this){if(o=t.xo-e.xo,i=t.xo-r.xo,c=e.x-e.xo,h=r.x-r.xo,a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){t.x=t.xo+(c+h)/2;return}t.x=t.xo+(c*l+h*a)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){wt.setRelative(t,t,(c+h)/2,n,!0);return}wt.setRelative(t,t,(c*l+h*a)/d,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.x=l+(t.y-c)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},Ot={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,i,a,l,c,h,d;if(!n||n===this){if(o=t.yo-e.yo,i=t.yo-r.yo,c=e.y-e.yo,h=r.y-r.yo,a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){t.y=t.yo+(c+h)/2;return}t.y=t.yo+(c*l+h*a)/d;return}if(o=n.distance(t,e,!0,!0),i=n.distance(t,r,!0,!0),c=n.distance(e,e,!1,!0),h=n.distance(r,r,!1,!0),a=Math.abs(o),l=Math.abs(i),d=a+l,d===0){Ot.setRelative(t,t,(c+h)/2,n,!0);return}Ot.setRelative(t,t,(c*l+h*a)/d,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y;t.y=c+n.normalSlope*(t.x-l)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(wt),Object.freeze(Ot);function ln(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}ln.prototype.distance=function(t,e,r,n){return this.x*wt.distance(t,e,r,n)+this.y*Ot.distance(t,e,r,n)},ln.prototype.interpolate=function(t,e,r,n){var o,i,a,l,c,h,d;if(a=n.distance(t,e,!0,!0),l=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),i=n.distance(r,r,!1,!0),c=Math.abs(a),h=Math.abs(l),d=c+h,d===0){this.setRelative(t,t,(o+i)/2,n,!0);return}this.setRelative(t,t,(o*h+i*c)/d,n,!0)},ln.prototype.setRelative=function(t,e,r,n,o){n=n||this;var i=o?e.xo:e.x,a=o?e.yo:e.y,l=i+r*n.x,c=a+r*n.y,h=n.normalSlope,d=this.slope,g=t.x,v=t.y;t.x=(d*g-h*l+c-v)/(d-h),t.y=d*(t.x-g)+v},ln.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function cn(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?wt:t===0&&e===1?Ot:new ln(t,e)}function Mt(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Mt.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},Mt.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var fn=Object.freeze(new Mt(0,0)),Sh={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function jt(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=wt,this.round=Pa}}ka.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){jt.prototype=Sh,o=this._fpgmState=new jt("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{lr(o)}catch(h){console.log("Hinting error in FPGM:"+h),this._errorState=3;return}}jt.prototype=o,n=this._prepState=new jt("prep",r.tables.prep),n.ppem=e;var i=r.tables.cvt;if(i)for(var a=n.cvt=new Array(i.length),l=e/r.unitsPerEm,c=0;c<i.length;c++)a[c]=i[c]*l;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{lr(n)}catch(h){this._errorState<2&&console.log("Hinting error in PREP:"+h),this._errorState=2}}if(!(this._errorState>1))try{return Ca(t,n)}catch(h){this._errorState<1&&(console.log("Hinting error:"+h),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},Ca=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,i,a,l;if(jt.prototype=e,!o)l=new jt("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),l.step=-1),ci(t,l,r,n),a=l.gZone;else{var c=e.font;a=[],i=[];for(var h=0;h<o.length;h++){var d=o[h],g=c.glyphs.get(d.glyphIndex);l=new jt("glyf",g.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+h+"---"),l.step=-1),ci(g,l,r,n);for(var v=Math.round(d.dx*r),b=Math.round(d.dy*n),T=l.gZone,C=l.contours,x=0;x<T.length;x++){var A=T[x];A.xTouched=A.yTouched=!1,A.xo=A.x=A.x+v,A.yo=A.y=A.y+b}var F=a.length;a.push.apply(a,T);for(var M=0;M<C.length;M++)i.push(C[M]+F)}t.instructions&&!l.inhibitGridFit&&(l=new jt("glyf",t.instructions),l.gZone=l.z0=l.z1=l.z2=a,l.contours=i,a.push(new Mt(0,0),new Mt(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),l.step=-1),lr(l),a.length-=2)}return a},ci=function(t,e,r,n){for(var o=t.points||[],i=o.length,a=e.gZone=e.z0=e.z1=e.z2=[],l=e.contours=[],c,h=0;h<i;h++)c=o[h],a[h]=new Mt(c.x*r,c.y*n,c.lastPointOfContour,c.onCurve);for(var d,g,v=0;v<i;v++)c=a[v],d||(d=c,l.push(v)),c.lastPointOfContour?(c.nextPointOnContour=d,d.prevPointOnContour=c,d=void 0):(g=a[v+1],c.nextPointOnContour=g,g.prevPointOnContour=c);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var b=0;b<i;b++)console.log(b,a[b].x,a[b].y)}if(a.push(new Mt(0,0),new Mt(Math.round(t.advanceWidth*r),0)),lr(e),a.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var T=0;T<i;T++)console.log(T,a[T].x,a[T].y)}}},lr=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=xa[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function qn(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new Mt(0,0)}function Ra(t,e){var r=t.prog,n=t.ip,o=1,i;do if(i=r[++n],i===88)o++;else if(i===89)o--;else if(i===64)n+=r[n+1]+1;else if(i===65)n+=2*r[n+1]+1;else if(i>=176&&i<=183)n+=i-176+1;else if(i>=184&&i<=191)n+=(i-184+1)*2;else if(e&&o===1&&i===27)break;while(o>0);t.ip=n}function Oa(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function Ma(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function Da(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function Fa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];exports.DEBUG&&console.log("SPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.pv=e.dpv=cn(l,c)}function La(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];exports.DEBUG&&console.log("SFVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.fv=cn(l,c)}function _h(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=cn(n,r)}function Th(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=cn(n,r)}function Eh(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function xh(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Ch(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function kh(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),i=e.pop(),a=e.pop(),l=t.z0,c=t.z1,h=l[r],d=l[n],g=c[o],v=c[i],b=t.z2[a];exports.DEBUG&&console.log("ISECT[], ",r,n,o,i,a);var T=h.x,C=h.y,x=d.x,A=d.y,F=g.x,M=g.y,$=v.x,V=v.y,q=(T-x)*(M-V)-(C-A)*(F-$),X=T*A-C*x,Z=F*V-M*$;b.x=(X*(F-$)-Z*(T-x))/q,b.y=(X*(M-V)-Z*(C-A))/q}function Ph(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function Ah(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Rh(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Oh(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||qn(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Mh(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||qn(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Dh(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||qn(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Fh(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||qn(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Lh(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function Bh(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=Pa}function Uh(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=yh}function Ih(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Gh(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),Ra(t,!1)}function Nh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function Vh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function Hh(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function fi(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function zh(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function Wh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function $h(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function Yh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,i=t.prog;t.prog=t.funcs[r];for(var a=0;a<n;a++)lr(t),exports.DEBUG&&console.log(++t.step,a+1<n?"next loopcall":"done loopcall",a);t.ip=o,t.prog=i}function Xh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],lr(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function jh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function qh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function Zh(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),i=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(i+1,n)}function Ba(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,i=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var a=i.distance(n,fn);t&&(a=e.round(a)),o.setRelative(n,fn,a,i),o.touch(n),e.rp0=e.rp1=r}function Ua(t,e){var r=e.z2,n=r.length-2,o,i,a;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var l=0;l<n;l++)o=r[l],!t.touched(o)&&(i=o.prevTouched(t),i!==o&&(a=o.nextTouched(t),i===a&&t.setRelative(o,o,t.distance(i,i,!1,!0),t,!0),t.interpolate(o,i,a,t)))}function Ia(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=e.loop,c=e.z2;l--;){var h=r.pop(),d=c[h],g=a.distance(o,o,!1,!0);i.setRelative(d,d,g,a),i.touch(d),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-l)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",h)}e.loop=1}function Ga(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop(),c=e.z2[e.contours[l]],h=c;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",l);var d=a.distance(o,o,!1,!0);do h!==o&&i.setRelative(h,h,d,a),h=h.nextPointOnContour;while(h!==c)}function Na(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],i=e.fv,a=e.pv,l=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",l);var c;switch(l){case 0:c=e.tZone;break;case 1:c=e.gZone;break;default:throw new Error("Invalid zone")}for(var h,d=a.distance(o,o,!1,!0),g=c.length-2,v=0;v<g;v++)h=c[v],i.setRelative(h,h,d,a)}function Kh(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,i=t.z2;r--;){var a=e.pop(),l=i[a];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",a,o),n.setRelative(l,l,o),n.touch(l)}t.loop=1}function Qh(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,i=t.z0[r],a=t.z1[n],l=t.fv,c=t.dpv,h=t.z2;o--;){var d=e.pop(),g=h[d];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",d,r,"<->",n),l.interpolate(g,i,a,c),l.touch(g)}t.loop=1}function Va(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),i=e.z1[o],a=e.z0[e.rp0],l=e.fv,c=e.pv;l.setRelative(i,a,n,c),l.touch(i),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function Jh(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,i=t.fv,a=t.pv,l=t.z1;o--;){var c=e.pop(),h=l[c];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",c),i.setRelative(h,n,0,a),i.touch(h)}t.loop=1}function ep(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=mh}function Ha(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z0[o],a=e.fv,l=e.pv,c=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",c,")",o);var h=l.distance(i,fn);t&&(Math.abs(h-c)<e.cvCutIn&&(h=c),h=e.round(h)),a.setRelative(i,fn,h,l),e.zp0===0&&(i.xo=i.x,i.yo=i.y),a.touch(i),e.rp0=e.rp1=o}function tp(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var i=0;i<o;i++)n.push(e[++r]);t.ip=r}function rp(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var i=0;i<o;i++){var a=r[++e]<<8|r[++e];a&32768&&(a=-((a^65535)+1)),n.push(a)}t.ip=e}function np(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function op(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function ip(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function sp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function za(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,fn,t,!1)*64)}function Wa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z1[n],a=e.z0[o],l=e.dpv.distance(a,i,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",l),e.stack.push(Math.round(l*64))}function ap(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function up(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function lp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function cp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function fp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function hp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function pp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function dp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function vp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function gp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function mp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(Ra(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function yp(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function wp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function bp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function Sp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function hi(t,e){var r=e.stack,n=r.pop(),o=e.fv,i=e.pv,a=e.ppem,l=e.deltaBase+(t-1)*16,c=e.deltaShift,h=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var d=0;d<n;d++){var g=r.pop(),v=r.pop(),b=l+((v&240)>>4);if(b===a){var T=(v&15)-8;T>=0&&T++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",g,"by",T*c);var C=h[g];o.setRelative(C,C,T*c,i)}}}function _p(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function Tp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function Ep(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function xp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function Cp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function kp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function Pp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function Ap(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function Rp(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function Op(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Zn(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function Mp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function pi(t,e){var r=e.stack,n=r.pop(),o=e.ppem,i=e.deltaBase+(t-1)*16,a=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var l=0;l<n;l++){var c=r.pop(),h=r.pop(),d=i+((h&240)>>4);if(d===o){var g=(h&15)-8;g>=0&&g++;var v=g*a;exports.DEBUG&&console.log(e.step,"DELTACFIX",c,"by",v),e.cvt[c]+=v}}}function Dp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=Aa;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Fp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=Aa;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function Lp(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=gh}function Bp(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=wh}function Up(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=bh}function Ip(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function $a(t,e){var r=e.stack,n=r.pop(),o=r.pop(),i=e.z2[n],a=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var l,c;t?(l=i.y-a.y,c=a.x-i.x):(l=a.x-i.x,c=a.y-i.y),e.dpv=cn(l,c)}function Gp(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Np(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function Vp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function Hp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function zp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function Wp(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function qt(t,e){var r=e.stack,n=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var i=0;i<t;i++)r.push(n[++o]);e.ip=o}function Zt(t,e){var r=e.ip,n=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var i=0;i<t;i++){var a=n[++r]<<8|n[++r];a&32768&&(a=-((a^65535)+1)),o.push(a)}e.ip=r}function H(t,e,r,n,o,i){var a=i.stack,l=t&&a.pop(),c=a.pop(),h=i.rp0,d=i.z0[h],g=i.z1[c],v=i.minDis,b=i.fv,T=i.dpv,C,x,A,F;x=C=T.distance(g,d,!0,!0),A=x>=0?1:-1,x=Math.abs(x),t&&(F=i.cvt[l],n&&Math.abs(x-F)<i.cvCutIn&&(x=F)),r&&x<v&&(x=v),n&&(x=i.round(x)),b.setRelative(g,d,A*x,T),b.touch(g),exports.DEBUG&&console.log(i.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?l+"("+i.cvt[l]+","+F+")":"",c,"(d =",C,"->",A*x,")"),i.rp1=i.rp0,i.rp2=c,e&&(i.rp0=c)}xa=[Oa.bind(void 0,Ot),Oa.bind(void 0,wt),Ma.bind(void 0,Ot),Ma.bind(void 0,wt),Da.bind(void 0,Ot),Da.bind(void 0,wt),Fa.bind(void 0,0),Fa.bind(void 0,1),La.bind(void 0,0),La.bind(void 0,1),_h,Th,Eh,xh,Ch,kh,Ph,Ah,Rh,Oh,Mh,Dh,Fh,Lh,Bh,Uh,Ih,Gh,Nh,Vh,void 0,void 0,Hh,fi,zh,Wh,$h,jh,qh,void 0,void 0,void 0,Yh,Xh,Zh,void 0,Ba.bind(void 0,0),Ba.bind(void 0,1),Ua.bind(void 0,Ot),Ua.bind(void 0,wt),Ia.bind(void 0,0),Ia.bind(void 0,1),Ga.bind(void 0,0),Ga.bind(void 0,1),Na.bind(void 0,0),Na.bind(void 0,1),Kh,Qh,Va.bind(void 0,0),Va.bind(void 0,1),Jh,ep,Ha.bind(void 0,0),Ha.bind(void 0,1),tp,rp,np,op,ip,sp,za.bind(void 0,0),za.bind(void 0,1),void 0,Wa.bind(void 0,0),Wa.bind(void 0,1),ap,void 0,up,void 0,void 0,lp,cp,fp,hp,pp,dp,vp,gp,mp,yp,wp,bp,Sp,hi.bind(void 0,1),_p,Tp,Ep,xp,Cp,kp,Pp,Ap,Rp,Op,Zn.bind(void 0,0),Zn.bind(void 0,1),Zn.bind(void 0,2),Zn.bind(void 0,3),void 0,void 0,void 0,void 0,Mp,hi.bind(void 0,2),hi.bind(void 0,3),pi.bind(void 0,1),pi.bind(void 0,2),pi.bind(void 0,3),Dp,Fp,void 0,void 0,Lp,void 0,Bp,Up,fi,fi,void 0,void 0,void 0,void 0,void 0,Ip,$a.bind(void 0,0),$a.bind(void 0,1),Gp,void 0,Np,Vp,Hp,zp,Wp,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,qt.bind(void 0,1),qt.bind(void 0,2),qt.bind(void 0,3),qt.bind(void 0,4),qt.bind(void 0,5),qt.bind(void 0,6),qt.bind(void 0,7),qt.bind(void 0,8),Zt.bind(void 0,1),Zt.bind(void 0,2),Zt.bind(void 0,3),Zt.bind(void 0,4),Zt.bind(void 0,5),Zt.bind(void 0,6),Zt.bind(void 0,7),Zt.bind(void 0,8),H.bind(void 0,0,0,0,0,0),H.bind(void 0,0,0,0,0,1),H.bind(void 0,0,0,0,0,2),H.bind(void 0,0,0,0,0,3),H.bind(void 0,0,0,0,1,0),H.bind(void 0,0,0,0,1,1),H.bind(void 0,0,0,0,1,2),H.bind(void 0,0,0,0,1,3),H.bind(void 0,0,0,1,0,0),H.bind(void 0,0,0,1,0,1),H.bind(void 0,0,0,1,0,2),H.bind(void 0,0,0,1,0,3),H.bind(void 0,0,0,1,1,0),H.bind(void 0,0,0,1,1,1),H.bind(void 0,0,0,1,1,2),H.bind(void 0,0,0,1,1,3),H.bind(void 0,0,1,0,0,0),H.bind(void 0,0,1,0,0,1),H.bind(void 0,0,1,0,0,2),H.bind(void 0,0,1,0,0,3),H.bind(void 0,0,1,0,1,0),H.bind(void 0,0,1,0,1,1),H.bind(void 0,0,1,0,1,2),H.bind(void 0,0,1,0,1,3),H.bind(void 0,0,1,1,0,0),H.bind(void 0,0,1,1,0,1),H.bind(void 0,0,1,1,0,2),H.bind(void 0,0,1,1,0,3),H.bind(void 0,0,1,1,1,0),H.bind(void 0,0,1,1,1,1),H.bind(void 0,0,1,1,1,2),H.bind(void 0,0,1,1,1,3),H.bind(void 0,1,0,0,0,0),H.bind(void 0,1,0,0,0,1),H.bind(void 0,1,0,0,0,2),H.bind(void 0,1,0,0,0,3),H.bind(void 0,1,0,0,1,0),H.bind(void 0,1,0,0,1,1),H.bind(void 0,1,0,0,1,2),H.bind(void 0,1,0,0,1,3),H.bind(void 0,1,0,1,0,0),H.bind(void 0,1,0,1,0,1),H.bind(void 0,1,0,1,0,2),H.bind(void 0,1,0,1,0,3),H.bind(void 0,1,0,1,1,0),H.bind(void 0,1,0,1,1,1),H.bind(void 0,1,0,1,1,2),H.bind(void 0,1,0,1,1,3),H.bind(void 0,1,1,0,0,0),H.bind(void 0,1,1,0,0,1),H.bind(void 0,1,1,0,0,2),H.bind(void 0,1,1,0,0,3),H.bind(void 0,1,1,0,1,0),H.bind(void 0,1,1,0,1,1),H.bind(void 0,1,1,0,1,2),H.bind(void 0,1,1,0,1,3),H.bind(void 0,1,1,1,0,0),H.bind(void 0,1,1,1,0,1),H.bind(void 0,1,1,1,0,2),H.bind(void 0,1,1,1,0,3),H.bind(void 0,1,1,1,1,0),H.bind(void 0,1,1,1,1,1),H.bind(void 0,1,1,1,1,2),H.bind(void 0,1,1,1,1,3)];function Rr(t){this.char=t,this.state={},this.activeState=null}function di(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function $p(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function ft(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Kn(t){this.eventId=t,this.subscribers=[]}function Yp(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Kn(o)})}),t&&r.forEach(function(o){var i=t[o];typeof i=="function"&&e.events[o].subscribe(i)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Le(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Yp.call(this,t)}Rr.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},Rr.prototype.getState=function(t){return this.state[t]||null},Le.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},Le.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(i){return e[i[0]].apply(e,i.slice(1).concat(r))}),o=function(i){return typeof i=="object"&&i.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(i){return!o(i)})])},Le.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(a){return a instanceof Rr});if(!isNaN(t)&&this.inboundIndex(t)&&o){var i=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[i,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Le.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof Rr){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},Le.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n},Le.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}},Le.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof Rr});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},Le.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var i=[n,o],a=e===null||e.apply(this,i)===!0,l=[n,o];if(a){var c=r.apply(this,l);n.setState(t,c)}}),this.registeredModifiers.push(t)},Kn.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Kn.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},ft.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},ft.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}},Le.prototype.rangeToText=function(t){if(t instanceof di)return this.getRangeTokens(t).map(function(e){return e.char}).join("")},Le.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},Le.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null},Le.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null},Le.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Kn&&n.subscribers.forEach(function(o){o.apply(r,e||[])})},Le.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new $p(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},Le.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},Le.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},Le.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}},Le.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new ft(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Le.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new di(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n},Le.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,i=e.getContext(o).openRange;if(!i&&n.checkStart(t)&&(i=new di(r,null,o),e.getContext(o).openRange=i,e.dispatch("contextStart",[o,r])),i&&n.checkEnd(t)){var a=r-i.startIndex+1,l=e.setEndOffset(a,o);e.dispatch("contextEnd",[o,l])}})},Le.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new ft(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var i=new Rr(n);this.tokens.push(i),this.dispatch("newToken",[i,o])}return this.dispatch("end",[this.tokens]),this.tokens};function Kt(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Ya(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function Qt(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Qn(t){return/[A-z]/.test(t)}function Xp(t){return/\s/.test(t)}function rt(t){this.font=t,this.features={}}function cr(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function hn(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var i=t-o.start;return o.index+i}}break;default:return-1}return-1}function jp(t,e){var r=hn(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function qp(t,e){var r=hn(t,e.coverage);return r===-1?null:e.substitute[r]}function vi(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],i=e.current;i=Array.isArray(i)?i[0]:i;var a=hn(i,o);a!==-1&&r.push(a)}return r.length!==t.length?-1:r}function Zp(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=vi(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var i=t.lookahead.slice(o);i.length&&Qt(i[0].char);)i.shift();var a=new ft(i,0),l=vi(e.lookaheadCoverage,a),c=[].concat(t.backtrack);for(c.reverse();c.length&&Qt(c[0].char);)c.shift();if(c.length<e.backtrackCoverage.length)return[];var h=new ft(c,0),d=vi(e.backtrackCoverage,h),g=n.length===e.inputCoverage.length&&l.length===e.lookaheadCoverage.length&&d.length===e.backtrackCoverage.length,v=[];if(g)for(var b=0;b<e.lookupRecords.length;b++)for(var T=e.lookupRecords[b],C=T.lookupListIndex,x=this.getLookupByIndex(C),A=0;A<x.subtables.length;A++){var F=x.subtables[A],M=this.getLookupMethod(x,F),$=this.getSubstitutionType(x,F);if($==="12")for(var V=0;V<n.length;V++){var q=t.get(V),X=M(q);X&&v.push(X)}}return v}function Kp(t,e){var r=t.current,n=hn(r,e.coverage);if(n===-1)return null;for(var o,i=e.ligatureSets[n],a=0;a<i.length;a++){o=i[a];for(var l=0;l<o.components.length;l++){var c=t.lookahead[l],h=o.components[l];if(c!==h)break;if(l===o.components.length-1)return o}}return null}function Qp(t,e){var r=hn(t,e.coverage);return r===-1?null:e.sequences[r]}rt.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},rt.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var i=o.langSysRecords;if(i)for(var a=0;a<i.length;a++){var l=i[a];if(l.tag===t){var c=l.langSys;return c.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},rt.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,i=t[n].feature;r[o]=i}this.features[e].tags=r},rt.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},rt.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n},rt.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return jp.apply(r,[o,e])};case"12":return function(o){return qp.apply(r,[o,e])};case"63":return function(o){return Zp.apply(r,[o,e])};case"41":return function(o){return Kp.apply(r,[o,e])};case"21":return function(o){return Qp.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},rt.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),i=[].concat(e.context),a=0;a<o.length;a++)for(var l=o[a],c=this.getLookupSubtables(l),h=0;h<c.length;h++){var d=c[h],g=this.getSubstitutionType(l,d),v=this.getLookupMethod(l,d),b=void 0;switch(g){case"11":b=v(e.current),b&&i.splice(r,1,new cr({id:11,tag:t.tag,substitution:b}));break;case"12":b=v(e.current),b&&i.splice(r,1,new cr({id:12,tag:t.tag,substitution:b}));break;case"63":b=v(e),Array.isArray(b)&&b.length&&i.splice(r,1,new cr({id:63,tag:t.tag,substitution:b}));break;case"41":b=v(e),b&&i.splice(r,1,new cr({id:41,tag:t.tag,substitution:b}));break;case"21":b=v(e.current),b&&i.splice(r,1,new cr({id:21,tag:t.tag,substitution:b}));break}e=new ft(i,r),!(Array.isArray(b)&&!b.length)&&(b=null)}return i.length?i:null},rt.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r},rt.prototype.getLookupSubtables=function(t){return t.subtables||null},rt.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null},rt.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},rt.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function Jp(t){var e=t.current,r=t.get(-1);return r===null&&Kt(e)||!Kt(r)&&Kt(e)}function ed(t){var e=t.get(1);return e===null||!Kt(e)}var td={startCheck:Jp,endCheck:ed};function rd(t){var e=t.current,r=t.get(-1);return(Kt(e)||Qt(e))&&!Kt(r)}function nd(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Kt(e)&&!Qt(e)):var r=Xp(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return Kt(o)||Qt(o)}),!n)return!0}break;default:return!1}}var od={startCheck:rd,endCheck:nd};function id(t,e,r){e[r].setState(t.tag,t.substitution)}function sd(t,e,r){e[r].setState(t.tag,t.substitution)}function ad(t,e,r){t.substitution.forEach(function(n,o){var i=e[r+o];i.setState(t.tag,n)})}function ud(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,i=0;i<o;i++)n=e[r+i+1],n.setState("deleted",!0)}var Xa={11:id,12:sd,63:ad,41:ud};function gi(t,e,r){t instanceof cr&&Xa[t.id]&&Xa[t.id](t,e,r)}function ld(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=Ya(n),i=Qt(n);if(!o&&!i)return!0;if(o)return!1}return!1}function cd(t){if(Ya(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=Qt(r);if(!n)return!0}return!1}function fd(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var i=new ft(o.map(function(l){return l.getState("glyphIndex")}),0),a=new ft(o.map(function(l){return l.char}),0);o.forEach(function(l,c){if(!Qt(l.char)){i.setCurrentIndex(c),a.setCurrentIndex(c);var h=0;ld(a)&&(h|=1),cd(a)&&(h|=2);var d;switch(h){case 1:d="fina";break;case 2:d="init";break;case 3:d="medi";break}if(n.indexOf(d)!==-1){var g=e.query.lookupFeature({tag:d,script:r,contextParams:i});if(g instanceof Error)return console.info(g.message);g.forEach(function(v,b){v instanceof cr&&(gi(v,o,b),i.context[b]=v.substitution)})}}})}}function ja(t,e){var r=t.map(function(n){return n.activeState.value});return new ft(r,e||0)}function hd(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=ja(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});l.length&&(l.forEach(function(c){return gi(c,n,a)}),o=ja(n))})}function pd(t){var e=t.current,r=t.get(-1);return r===null&&Qn(e)||!Qn(r)&&Qn(e)}function dd(t){var e=t.get(1);return e===null||!Qn(e)}var vd={startCheck:pd,endCheck:dd};function qa(t,e){var r=t.map(function(n){return n.activeState.value});return new ft(r,e||0)}function gd(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=qa(n);o.context.forEach(function(i,a){o.setCurrentIndex(a);var l=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});l.length&&(l.forEach(function(c){return gi(c,n,a)}),o=qa(n))})}function ht(t){this.baseDir=t||"ltr",this.tokenizer=new Le,this.featuresTags={}}ht.prototype.setText=function(t){this.text=t},ht.prototype.contextChecks={latinWordCheck:vd,arabicWordCheck:td,arabicSentenceCheck:od};function mi(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function md(){return mi.call(this,"latinWord"),mi.call(this,"arabicWord"),mi.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function yd(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}ht.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},ht.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new rt(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},ht.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function yi(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function wd(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){yi.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){fd.call(t,n)})}}function bd(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){yi.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){hd.call(t,o)})}}}function Sd(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){yi.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){gd.call(t,o)})}}}ht.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},ht.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(wd.call(this),bd.call(this)),this.checkContextReady("latinWord")&&Sd.call(this),this.checkContextReady("arabicSentence")&&yd.call(this)},ht.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),md.call(this),this.applyFeaturesToContexts())},ht.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},ht.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function ke(t){t=t||{},t.tables=t.tables||{},t.empty||(un(t.familyName,"When creating a new Font object, familyName is required."),un(t.styleName,"When creating a new Font object, styleName is required."),un(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),un(t.ascender,"When creating a new Font object, ascender is required."),un(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new yt.GlyphSet(this,t.glyphs||[]),this.encoding=new qs(this),this.position=new an(this),this.substitution=new tt(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new ka(this)}})}ke.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null},ke.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},ke.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},ke.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})},ke.prototype.stringToGlyphs=function(t,e){var r=this,n=new ht,o=function(g){return r.charToGlyphIndex(g.char)};n.registerModifier("glyphIndex",null,o);var i=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,i);for(var a=n.getTextGlyphs(t),l=a.length,c=new Array(l),h=this.glyphs.get(0),d=0;d<l;d+=1)c[d]=this.glyphs.get(a[d])||h;return c},ke.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},ke.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},ke.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},ke.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0},ke.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},ke.prototype.forEachGlyph=function(t,e,r,n,o,i){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var a=1/this.unitsPerEm*n,l=this.stringToGlyphs(t,o),c;if(o.kerning){var h=o.script||this.position.getDefaultScriptName();c=this.position.getKerningTables(h,o.language)}for(var d=0;d<l.length;d+=1){var g=l[d];if(i.call(this,g,e,r,n,o),g.advanceWidth&&(e+=g.advanceWidth*a),o.kerning&&d<l.length-1){var v=c?this.position.getKerningValue(c,g.index,l[d+1].index):this.getKerningValue(g,l[d+1]);e+=v*a}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e},ke.prototype.getPath=function(t,e,r,n,o){var i=new Ve;return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var d=a.getPath(l,c,h,o,this);i.extend(d)}),i},ke.prototype.getPaths=function(t,e,r,n,o){var i=[];return this.forEachGlyph(t,e,r,n,o,function(a,l,c,h){var d=a.getPath(l,c,h,o,this);i.push(d)}),i},ke.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})},ke.prototype.draw=function(t,e,r,n,o,i){this.getPath(e,r,n,o,i).draw(t)},ke.prototype.drawPoints=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawPoints(t,l,c,h)})},ke.prototype.drawMetrics=function(t,e,r,n,o,i){this.forEachGlyph(e,r,n,o,i,function(a,l,c,h){a.drawMetrics(t,l,c,h)})},ke.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},ke.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},ke.prototype.toTables=function(){return ah.fontToTable(this)},ke.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},ke.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r},ke.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(lh())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),i=new Blob([o],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i),a.download=t;var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!1),a.dispatchEvent(l)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),h=ch(n);c.writeFileSync(t,h)}},ke.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},ke.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},ke.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Dt=new Array(10);Dt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(k.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(k.coverage),values:this.parseValueRecordList()};Q.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Dt[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();Q.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(k.coverage),o=this.parseUShort(),i=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,pairSets:this.parseList(k.pointer(k.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}})))};if(r===2){var a=this.parsePointer(k.classDef),l=this.parsePointer(k.classDef),c=this.parseUShort(),h=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:i,classDef1:a,classDef2:l,class1Count:c,class2Count:h,classRecords:this.parseList(c,k.list(h,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(i)}}))}}},Dt[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Dt[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Dt[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Dt[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Dt[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Dt[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Dt[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);const _d={XY:{dir:[0,0,1],xAxis:[1,0,0]},XZ:{dir:[0,-1,0],xAxis:[1,0,0]},YZ:{dir:[1,0,0],xAxis:[0,1,0]},YX:{dir:[0,0,-1],xAxis:[0,1,0]},ZX:{dir:[0,1,0],xAxis:[0,0,1]},ZY:{dir:[-1,0,0],xAxis:[0,0,1]},front:{dir:[0,-1,0],xAxis:[1,0,0]},back:{dir:[0,1,0],xAxis:[-1,0,0]},right:{dir:[-1,0,0],xAxis:[0,-1,0]},left:{dir:[1,0,0],xAxis:[0,1,0]},bottom:{dir:[0,0,1],xAxis:[1,0,0]},top:{dir:[0,0,-1],xAxis:[1,0,0]}};function Td(t){const{dir:e,xAxis:r}=_d[t];return new Ka([0,0,0],e,r)}function Za(t){const e=new R(t);let r=new R([0,0,1]),n=r.cross(e);return n.Length===0&&(r=new R([0,1,0]),n=r.cross(e)),n.normalize()}class Ka extends Je{constructor(e=[0,0,0],r=[0,0,1],n){const o=n?new R(n):Za(r),i=Vr(e,r,o);super(i)}get position(){return new R(this.wrapped.Location())}get direction(){return new R(this.wrapped.Direction())}get xAxis(){return new R(this.wrapped.XDirection())}get yAxis(){return new R(this.wrapped.YDirection())}autoAxes(){const e=Za(this.direction);this.wrapped.SetXDirection(xt(e))}setPosition(e){return this.wrapped.SetLocation(et(e)),this}setXAxis(e){return this.wrapped.SetYDirection(xt(e)),this}setYAxis(e){return this.wrapped.SetYDirection(xt(e)),this}lookAt(e){const r=new R("boundingBox"in e?e.boundingBox.center:e),n=this.position.sub(r).normalized();return this.wrapped.SetDirection(n.toDir()),this.autoAxes(),this}}const Or=t=>t.IsNull()?[]:Pe(t).edges;function Ed(t,e,r=!0){const n=I(),o=Ee(),i=o(new n.HLRBRep_Algo_1);i.Add_2(t.wrapped,0);const a=o(new n.HLRAlgo_Projector_2(e.wrapped));i.Projector_1(a),i.Update(),i.Hide_1();const l=new n.HLRBRep_HLRToShape(new n.Handle_HLRBRep_Algo_2(i)),c=[...Or(l.VCompound_1()),...Or(l.Rg1LineVCompound_1()),...Or(l.OutLineVCompound_1())];c.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped));const h=r?[...Or(l.HCompound_1()),...Or(l.Rg1LineHCompound_1()),...Or(l.OutLineHCompound_1())]:[];return h.forEach(d=>n.BRepLib.BuildCurves3d_2(d.wrapped)),{visible:c,hidden:h}}const fr=1e-8,Mr=(t,e)=>$e(t,e,fr*10);function xd(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(h=>({offset:Do(h,r),original:h})),o=[];let i=null,a=n.at(-1);if(!a)return[];if(o.length===1)return o;const l=h=>{i?h.offset instanceof Me?o.push(h.offset):Mr(h.offset.firstPoint,h.offset.lastPoint)||o.push(Xr(h.offset.firstPoint,h.offset.lastPoint)):i=h},c=function*(){for(const h of n.slice(0,-1))yield h;if(!i)throw new Error("Bug in the offset algorithm");yield i};for(const h of c()){const d=a.offset.lastPoint,g=h.offset.firstPoint;if(Mr(d,g)){l(a),a=h;continue}let v=[];if(a.offset instanceof Me&&h.offset instanceof Me){const{intersections:T,commonSegmentsPoints:C}=Yr(a.offset,h.offset,fr/100);v=[...T,...C]}if(v.length>0){let T=v[0];if(v.length>1){const A=a==null?void 0:a.original.lastPoint,F=v.map(M=>Sl(M,A));T=v[F.indexOf(Math.min(...F))]}const C=a.offset.splitAt([T],fr)[0],x=h.offset.splitAt([T],fr).at(-1);if(!x)throw new Error("Bug in the splitting algo in offset");l({offset:C,original:a.original}),a={offset:x,original:h.original};continue}const b=Ji(d,g,a.original.lastPoint);l(a),o.push(b),a=h}return l(a),o}function Cd(t,e){const r=xd(t,e);if(r.length<2)return null;const n=new Map,o=(h,d)=>{const g=n.get(h)||[];n.set(h,[...g,...d])};if(r.forEach((h,d)=>{r.slice(d+1).forEach((g,v)=>{const{intersections:b,commonSegmentsPoints:T}=Yr(h,g,fr),C=[...b,...T].filter(x=>{const A=Mr(x,h.firstPoint)||Mr(x,h.lastPoint),F=Mr(x,g.firstPoint)||Mr(x,g.lastPoint);return!(A&&F)});C.length&&(o(d,C),o(v+d+1,C))})}),!n.size){const h=new oe(r);return t.intersects(h)?null:h}const a=r.flatMap((h,d)=>{if(!n.has(d))return h;const g=n.get(d)||[];return h.splitAt(g,fr*100)}).filter(h=>!t.curves.find(g=>g.distanceFrom(h)<Math.abs(e)-fr));if(!a.length)return null;const c=os(a).filter(h=>h.length>1).map(h=>new oe(h)).filter(h=>h.isClosed());return c.length?c.length===1?c[0]:new K(c):null}const Qa=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=Rt(e,t[r]);return e};function Jn(t,e){if(t instanceof oe)return Cd(t,e);if(t instanceof K)return Qa(t.blueprints.map(r=>Jn(r,e)));if(t instanceof me){const r=Qa(t.blueprints.slice(1).map(n=>Jn(n,e)));return $t(Jn(t.blueprints[0],e),r)}return null}function Ja(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const i=[e.curves[0]],a=(c,h)=>{o({firstCurve:c,secondCurve:h,point:c.lastPoint})?i.push(...t(c,h,r)):i.push(c,h)};e.curves.slice(1).forEach(c=>{const h=i.pop();if(!h)throw new Error("Bug in the blueprint filletting algo");a(h,c)});const l=i.at(-1);if(!l)throw new Error("Bug in the blueprint corner algo");if($e(i[0].firstPoint,l.lastPoint)&&i.length>1){const c=i.pop(),h=i.shift();if(!c||!h)throw new Error("Bug in the blueprint filletting algo");a(c,h)}return new oe(i)}function wi(t,e,r,n){if(e instanceof oe)return Ja(t,e,r,n);if(e instanceof me)return new me(e.blueprints.map(o=>Ja(t,o,r,n)));if(e instanceof K){const o=e.blueprints.map(i=>wi(t,i,r,n)).filter(i=>i!==null);return new K(o)}return null}function kd(t,e,r){return wi(Fo,t,e,r)}function Pd(t,e,r){return wi(Lo,t,e,r)}function bi(t,e){return t instanceof oe?new oe(En(t.curves,e)):t instanceof me?new me(t.blueprints.map(r=>bi(r,e))):t instanceof K?new K(t.blueprints.map(r=>bi(r,e))):t}class De{constructor(e=null){this.innerShape=e}clone(){var e;return new De(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new $r}stretch(e,r,n){return this.innerShape?new De(this.innerShape.stretch(e,r,n)):new De}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new De(this.innerShape.rotate(e,r)):new De}translate(e,r=0){return this.innerShape?new De(this.innerShape.translate(e,r)):new De}scale(e,r){return this.innerShape?new De(this.innerShape.scale(e,r)):new De}mirror(e,r,n){return this.innerShape?new De(this.innerShape.mirror(e,r,n)):new De}cut(e){return new De($t(this.innerShape,e.innerShape))}fuse(e){return new De(Rt(this.innerShape,e.innerShape))}intersect(e){return new De(tn(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new kn);return new De(kd(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new kn);return new De(Pd(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new De(Jn(this.innerShape,e))}approximate(e,r={}){if(e!=="svg")throw new Error("Only 'svg' is supported for now");return new De(bi(this.innerShape,r))}get blueprint(){if(!(this.innerShape instanceof oe)){if(this.innerShape instanceof K&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof oe)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}function Ad(t,e,r=0){return new De(mc(t,e,r))}const Rd=Ad,eu=t=>{const e=Rd(1e3,1e3).sketchOnPlane().face(),r=t.map(o=>lc(o,e)),n=os(r).map(o=>new oe(o));return n.length===0?new De:n.length===1?new De(n[0]):new De(new K(n))};function ot(t,e="front"){let r;e instanceof Ka?r=e:r=Td(e);const{visible:n,hidden:o}=Ed(t,r);return{visible:eu(n),hidden:eu(o)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const tu=Symbol("Comlink.proxy"),Od=Symbol("Comlink.endpoint"),Md=Symbol("Comlink.releaseProxy"),Si=Symbol("Comlink.finalizer"),eo=Symbol("Comlink.thrown"),ru=t=>typeof t=="object"&&t!==null||typeof t=="function",Dd={canHandle:t=>ru(t)&&t[tu],serialize(t){const{port1:e,port2:r}=new MessageChannel;return _i(t,e),[r,[r]]},deserialize(t){return t.start(),Ud(t)}},Fd={canHandle:t=>ru(t)&&eo in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},nu=new Map([["proxy",Dd],["throw",Fd]]);function Ld(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function _i(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!Ld(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:i,type:a,path:l}=Object.assign({path:[]},o.data),c=(o.data.argumentList||[]).map(hr);let h;try{const d=l.slice(0,-1).reduce((v,b)=>v[b],t),g=l.reduce((v,b)=>v[b],t);switch(a){case"GET":h=g;break;case"SET":d[l.slice(-1)[0]]=hr(o.data.value),h=!0;break;case"APPLY":h=g.apply(d,c);break;case"CONSTRUCT":{const v=new g(...c);h=Hd(v)}break;case"ENDPOINT":{const{port1:v,port2:b}=new MessageChannel;_i(t,b),h=Vd(v,[v])}break;case"RELEASE":h=void 0;break;default:return}}catch(d){h={value:d,[eo]:0}}Promise.resolve(h).catch(d=>({value:d,[eo]:0})).then(d=>{const[g,v]=oo(d);e.postMessage(Object.assign(Object.assign({},g),{id:i}),v),a==="RELEASE"&&(e.removeEventListener("message",n),ou(e),Si in t&&typeof t[Si]=="function"&&t[Si]())}).catch(d=>{const[g,v]=oo({value:new TypeError("Unserializable return value"),[eo]:0});e.postMessage(Object.assign(Object.assign({},g),{id:i}),v)})}),e.start&&e.start()}function Bd(t){return t.constructor.name==="MessagePort"}function ou(t){Bd(t)&&t.close()}function Ud(t,e){const r=new Map;return t.addEventListener("message",function(o){const{data:i}=o;if(!i||!i.id)return;const a=r.get(i.id);if(a)try{a(i)}finally{r.delete(i.id)}}),Ti(t,r,[],e)}function to(t){if(t)throw new Error("Proxy has been released and is not useable")}function iu(t){return Dr(t,new Map,{type:"RELEASE"}).then(()=>{ou(t)})}const ro=new WeakMap,no="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(ro.get(t)||0)-1;ro.set(t,e),e===0&&iu(t)});function Id(t,e){const r=(ro.get(e)||0)+1;ro.set(e,r),no&&no.register(t,e,t)}function Gd(t){no&&no.unregister(t)}function Ti(t,e,r=[],n=function(){}){let o=!1;const i=new Proxy(n,{get(a,l){if(to(o),l===Md)return()=>{Gd(i),iu(t),e.clear(),o=!0};if(l==="then"){if(r.length===0)return{then:()=>i};const c=Dr(t,e,{type:"GET",path:r.map(h=>h.toString())}).then(hr);return c.then.bind(c)}return Ti(t,e,[...r,l])},set(a,l,c){to(o);const[h,d]=oo(c);return Dr(t,e,{type:"SET",path:[...r,l].map(g=>g.toString()),value:h},d).then(hr)},apply(a,l,c){to(o);const h=r[r.length-1];if(h===Od)return Dr(t,e,{type:"ENDPOINT"}).then(hr);if(h==="bind")return Ti(t,e,r.slice(0,-1));const[d,g]=su(c);return Dr(t,e,{type:"APPLY",path:r.map(v=>v.toString()),argumentList:d},g).then(hr)},construct(a,l){to(o);const[c,h]=su(l);return Dr(t,e,{type:"CONSTRUCT",path:r.map(d=>d.toString()),argumentList:c},h).then(hr)}});return Id(i,t),i}function Nd(t){return Array.prototype.concat.apply([],t)}function su(t){const e=t.map(oo);return[e.map(r=>r[0]),Nd(e.map(r=>r[1]))]}const au=new WeakMap;function Vd(t,e){return au.set(t,e),t}function Hd(t){return Object.assign(t,{[tu]:!0})}function oo(t){for(const[e,r]of nu)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},au.get(t)||[]]}function hr(t){switch(t.type){case"HANDLER":return nu.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Dr(t,e,r,n){return new Promise(o=>{const i=zd();e.set(i,o),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function zd(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function uu(t,e){return typeof t!="number"||isNaN(t)?{valid:!1,message:`Parameter '${e}' must be a number`}:{valid:!0}}function Wd(t,e){return t<=0?{valid:!1,message:`Parameter '${e}' must be positive`}:{valid:!0}}function $d(t,e,r){return t>=e?{valid:!1,message:`${r} (${t}) must be less than ${e}`}:{valid:!0}}function bt(t,e){const r=uu(t,e);return r.valid?Wd(t,e):r}function Yd(t,e,r){const n=uu(t,r);return n.valid?$d(t,e,r):n}function St(t,e){return r=>{const n=[];for(const o of e){const i=t(r[o],o);i.valid||n.push(i.message)}return{valid:n.length===0,errors:n}}}function lu(t,e){return r=>{const n=r[t],o=r[e],i=Yd(n,o,t);return i.valid?{valid:!0,errors:[]}:{valid:!1,errors:[i.message]}}}function Xd(t,e){let r=!0;const n=[];if(e.params)for(const o of e.params){const{name:i,validators:a}=o;if(!a)continue;const l=t[i];for(const c of a){const h=c(l,i);if(!h.valid){r=!1,n.push(h.message);break}}}if(e.validators)for(const o of e.validators){const i=o(t);i.valid||(r=!1,n.push(...i.errors))}return{valid:r,errors:n}}function Fr({width:t=100,depth:e=100,height:r=100}){if(t===0&&e===0&&r===0)return qr([0,0,0],[1e-7,1e-7,1e-7]);const n=t/2,o=e/2;return qr([-n,-o,0],[n,o,r])}const jd={name:"Cuboid",create:Fr,params:[{name:"width",defaultValue:100},{name:"depth",defaultValue:100},{name:"height",defaultValue:100}],validators:[St(bt,["width","depth","height"])],hasExplosion:!1};function qd({radius:t=50}){return Yl(t)}const Zd={name:"Sphere",create:qd,params:[{name:"radius",defaultValue:50}],validators:[St(bt,["radius"])],hasExplosion:!1};function cu({radius:t=50,height:e=100}){return ms(t,e,[0,0,0],[0,0,-1])}const Kd={name:"Cylinder",create:cu,params:[{name:"radius",defaultValue:50},{name:"height",defaultValue:100}],validators:[St(bt,["radius","height"])],hasExplosion:!1};function Qd({aLength:t=80,bLength:e=50,cLength:r=30}){return ql(t,e,r)}const Jd={name:"Ellipsoid",create:Qd,params:[{name:"aLength",defaultValue:80},{name:"bLength",defaultValue:50},{name:"cLength",defaultValue:30}],validators:[St(bt,["aLength","bLength","cLength"])],hasExplosion:!1},fu=t=>t.boundingBox.center;function hu(t,e,r){return r.map(({position:n,direction:o,orientation:i})=>{const a=t(),l=e(a);let c=a.translate([n[0]-l[0],n[1]-l[1],n[2]-l[2]]);const h=[0,0,1],d=new R(i||o);if(d.Length>0){const g=new R(h).cross(d);if(g.Length>1e-10){const v=new R(h).getAngle(d);c=c.rotate(v,n,g)}else d.dot(new R(h))<0&&(c=c.rotate(180,n,[1,0,0]))}return c})}function pu(t,e,r,n,o,i=0,a=0,l=1){const c=new R([i,a,l]).normalized();return Array.from({length:e*r},(h,d)=>{const g=Math.floor(d/r),b=d%r*n,T=g*o,x=new je(new R(t.origin),new R(t.xDirection).normalized(),new R(t.normal).normalized()).toWorldCoords([b,T,0]);return{position:[x.x,x.y,x.z],direction:[t.normal[0],t.normal[1],t.normal[2]],orientation:[c.x,c.y,c.z]}})}function ev(t,e,r,n=0,o=0,i=1){return pu({origin:t,xDirection:e,normal:(()=>{const a=new R(e),l=new R([0,0,1]),c=Math.abs(a.normalized().dot(l))>.99?new R([1,0,0]):a.cross(l).normalized();return[c.x,c.y,c.z]})()},1,r,r>1?new R(e).Length/(r-1):0,0,n,o,i)}function tv({count:t=5,vectorX:e=0,vectorY:r=50,vectorZ:n=50,originX:o=0,originY:i=0,originZ:a=0,boxWidth:l=10,boxDepth:c=10,boxHeight:h=10,orientationX:d=0,orientationY:g=0,orientationZ:v=1}){return Pt(hu(()=>Fr({width:l,depth:c,height:h}),fu,ev([o,i,a],[e,r,n],t,d,g,v)))}const rv={name:"DiagonalCuboidPattern",create:tv,params:[{name:"count",defaultValue:5},{name:"vectorX",defaultValue:0},{name:"vectorY",defaultValue:50},{name:"vectorZ",defaultValue:50},{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[St(bt,["count","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function nv({originX:t=0,originY:e=0,originZ:r=0,directionX:n=1,directionY:o=0,directionZ:i=0,normalX:a=0,normalY:l=0,normalZ:c=1,rowCount:h=3,colCount:d=3,xSpacing:g=30,ySpacing:v=30,boxWidth:b=10,boxDepth:T=10,boxHeight:C=10,orientationX:x=0,orientationY:A=0,orientationZ:F=1}){return Pt(hu(()=>Fr({width:b,depth:T,height:C}),fu,pu({origin:[t,e,r],xDirection:[n,o,i],normal:[a,l,c]},h,d,g,v,x,A,F)))}const ov={name:"RectangularCuboidGrid",create:nv,params:[{name:"originX",defaultValue:0},{name:"originY",defaultValue:0},{name:"originZ",defaultValue:0},{name:"directionX",defaultValue:1},{name:"directionY",defaultValue:0},{name:"directionZ",defaultValue:0},{name:"normalX",defaultValue:0},{name:"normalY",defaultValue:0},{name:"normalZ",defaultValue:1},{name:"rowCount",defaultValue:3},{name:"colCount",defaultValue:3},{name:"xSpacing",defaultValue:30},{name:"ySpacing",defaultValue:30},{name:"boxWidth",defaultValue:10},{name:"boxDepth",defaultValue:10},{name:"boxHeight",defaultValue:10},{name:"orientationX",defaultValue:0},{name:"orientationY",defaultValue:0},{name:"orientationZ",defaultValue:1}],validators:[St(bt,["rowCount","colCount","xSpacing","ySpacing","boxWidth","boxDepth","boxHeight"])],hasExplosion:!1};function du({depth:t=100,flangeXLenght:e=50,flangeYLenght:r=50,thickness:n=5}){const o=qr([0,-t/2,0],[e,t/2,n]),i=qr([0,-t/2,0],[n,t/2,r]);return o.fuse(i)}const iv={name:"LProfile",create:du,params:[{name:"depth",defaultValue:100},{name:"flangeXLenght",defaultValue:50},{name:"flangeYLenght",defaultValue:50},{name:"thickness",defaultValue:5}],validators:[St(bt,["depth","flangeXLenght","flangeYLenght","thickness"]),lu("thickness","flangeXLenght"),lu("thickness","flangeYLenght")],hasExplosion:!1};function vu({bottomRadius:t=50,topRadius:e=25,height:r=100}){return Bs(t,{plane:"XY",origin:[0,0,0]}).loftWith(Bs(e,{plane:"XY",origin:[0,0,-r]}),{ruled:!0})}const sv={name:"Frustum",create:vu,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"height",defaultValue:100}],validators:[St(bt,["bottomRadius","topRadius","height"])],hasExplosion:!1};function gu({bottomRadius:t=50,topRadius:e=25,frustumHeight:r=80,cylinderHeight:n=40}){return vu({bottomRadius:t,topRadius:e,height:r}).fuse(ms(e,n,[0,0,-r],[0,0,-1]))}const av={name:"Drill",create:gu,params:[{name:"bottomRadius",defaultValue:50},{name:"topRadius",defaultValue:25},{name:"frustumHeight",defaultValue:80},{name:"cylinderHeight",defaultValue:40}],validators:[St(bt,["bottomRadius","topRadius","frustumHeight","cylinderHeight"])],hasExplosion:!1};function uv(t,e){return{main:t,helperSpaces:e}}function Ei(t){return t.main||t}const ne={FRONT:"front",BACK:"back",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},ie={FRONT_LEFT:"front_left",FRONT_RIGHT:"front_right",FRONT_TOP:"front_top",FRONT_BOTTOM:"front_bottom",BACK_LEFT:"back_left",BACK_RIGHT:"back_right",BACK_TOP:"back_top",BACK_BOTTOM:"back_bottom",LEFT_TOP:"left_top",LEFT_BOTTOM:"left_bottom",RIGHT_TOP:"right_top",RIGHT_BOTTOM:"right_bottom"};function io(t){let e;switch(t){case ne.FRONT:e=new R([0,-1,0]);break;case ne.BACK:e=new R([0,1,0]);break;case ne.LEFT:e=new R([-1,0,0]);break;case ne.RIGHT:e=new R([1,0,0]);break;case ne.TOP:e=new R([0,0,1]);break;case ne.BOTTOM:e=new R([0,0,-1]);break;default:throw new Error(`Unknown face identifier: ${t}`)}return e}function mu(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case ie.FRONT_TOP:c=new R([r,n,l]);break;case ie.FRONT_BOTTOM:c=new R([r,n,o]);break;case ie.BACK_TOP:c=new R([r,a,l]);break;case ie.BACK_BOTTOM:c=new R([r,a,o]);break;case ie.LEFT_TOP:c=new R([r,n,l]);break;case ie.LEFT_BOTTOM:c=new R([r,n,o]);break;case ie.RIGHT_TOP:c=new R([i,n,l]);break;case ie.RIGHT_BOTTOM:c=new R([i,n,o]);break;case ie.FRONT_LEFT:c=new R([r,n,o]);break;case ie.FRONT_RIGHT:c=new R([i,n,o]);break;case ie.BACK_LEFT:c=new R([r,a,o]);break;case ie.BACK_RIGHT:c=new R([i,a,o]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function yu(t,e){const[[r,n,o],[i,a,l]]=t.bounds;let c;switch(e){case ie.FRONT_TOP:c=new R([i,n,l]);break;case ie.FRONT_BOTTOM:c=new R([i,n,o]);break;case ie.BACK_TOP:c=new R([i,a,l]);break;case ie.BACK_BOTTOM:c=new R([i,a,o]);break;case ie.LEFT_TOP:c=new R([r,a,l]);break;case ie.LEFT_BOTTOM:c=new R([r,a,o]);break;case ie.RIGHT_TOP:c=new R([i,a,l]);break;case ie.RIGHT_BOTTOM:c=new R([i,a,o]);break;case ie.FRONT_LEFT:c=new R([r,n,l]);break;case ie.FRONT_RIGHT:c=new R([i,n,l]);break;case ie.BACK_LEFT:c=new R([r,a,l]);break;case ie.BACK_RIGHT:c=new R([i,a,l]);break;default:throw new Error(`Unknown edge identifier: ${e}`)}return c}function lv(t){switch(t){case ie.FRONT_LEFT:return[ne.FRONT,ne.LEFT];case ie.FRONT_RIGHT:return[ne.FRONT,ne.RIGHT];case ie.FRONT_TOP:return[ne.FRONT,ne.TOP];case ie.FRONT_BOTTOM:return[ne.FRONT,ne.BOTTOM];case ie.BACK_LEFT:return[ne.BACK,ne.LEFT];case ie.BACK_RIGHT:return[ne.BACK,ne.RIGHT];case ie.BACK_TOP:return[ne.BACK,ne.TOP];case ie.BACK_BOTTOM:return[ne.BACK,ne.BOTTOM];case ie.LEFT_TOP:return[ne.LEFT,ne.TOP];case ie.LEFT_BOTTOM:return[ne.LEFT,ne.BOTTOM];case ie.RIGHT_TOP:return[ne.RIGHT,ne.TOP];case ie.RIGHT_BOTTOM:return[ne.RIGHT,ne.BOTTOM];default:throw new Error(`Unknown edge identifier: ${t}`)}}function cv(t,e,r=.5,n=.5){const[[o,i,a],[l,c,h]]=t.bounds,d=Math.max(0,Math.min(1,r)),g=Math.max(0,Math.min(1,n));let v;switch(e){case ne.FRONT:v=new R([o+(l-o)*d,i,a+(h-a)*g]);break;case ne.BACK:v=new R([o+(l-o)*d,c,a+(h-a)*g]);break;case ne.LEFT:v=new R([o,i+(c-i)*d,a+(h-a)*g]);break;case ne.RIGHT:v=new R([l,i+(c-i)*d,a+(h-a)*g]);break;case ne.TOP:v=new R([o+(l-o)*d,i+(c-i)*g,h]);break;case ne.BOTTOM:v=new R([o+(l-o)*d,i+(c-i)*g,a]);break;default:throw new Error(`Unknown face identifier: ${e}`)}return v}function fv(t,e,r=.5){const n=Math.max(0,Math.min(1,r)),o=mu(t,e),i=yu(t,e);return new R([o.x+(i.x-o.x)*n,o.y+(i.y-o.y)*n,o.z+(i.z-o.z)*n])}function hv(t,e){const{type:r,element:n,params:o={}}=e;switch(r){case"face":return cv(t,n,o.u,o.v);case"edge":return fv(t,n,o.t);case"corner":if(n.includes("START")){const i=n.replace("_START","");return mu(t,i)}else if(n.includes("END")){const i=n.replace("_END","");return yu(t,i)}else throw new Error(`Invalid corner identifier: ${n}`);case"center":return new R(t.center);default:throw new Error(`Unknown position type: ${r}`)}}function pv(t){const e=t.normalized(),r=Math.abs(e.x),n=Math.abs(e.y),o=Math.abs(e.z);let i;return r<=n&&r<=o?i=new R([0,e.z,-e.y]):n<=r&&n<=o?i=new R([e.z,0,-e.x]):i=new R([e.y,-e.x,0]),i.normalized()}function so(t,e,r,n={}){const o=hv(t.boundingBox,e);let i;n.normal?i=new R(n.normal):i=dv(t,e,n);let a;n.xDir?a=new R(n.xDir):a=pv(i);const l=new ir;l.coordSystemChange({origin:o.toTuple(),zDir:i.toTuple(),xDir:a.toTuple()},"reference");const c=Pe(l.transform(r.wrapped));return l.delete(),i.delete(),a.delete(),o.delete(),c}function dv(t,e,r={}){const{type:n,element:o}=e;switch(n){case"face":return io(o);case"edge":if(r.faceForEdge)return io(r.faceForEdge);{const i=lv(o);return io(i[0])}case"corner":return r.faceForCorner?io(r.faceForCorner):new R([0,0,1]);case"center":default:return new R([0,0,1])}}function pr(t,e,r,n=!1){return n?Pe(t.wrapped).mirror(e,r):t.mirror(e,r)}function vv({width:t=50,depth:e=100,height:r=200,showHelper:n=!0,explosionFactor:o=0}){const i=Fr({width:t,depth:e,height:r}),a=Math.round(r/17.5)-1;if(a<=0)return uv(Pt([]),n?[i]:[]);const l=r/(a+1),c=a>1?(e-28)/(a-1):0,h=Fr({width:t-1,depth:20,height:.5}),d=h.boundingBox.center,g=so(h,{type:"face",element:ne.TOP,params:{u:1.5/(t-1),v:2.25/20}},gu({bottomRadius:1.2,topRadius:.8,frustumHeight:.5*.8,cylinderHeight:.5*.2})),v=h.cut(g).cut(pr(g,"XZ",d,!0)).cut(pr(g,"YZ",d,!0)).cut(pr(pr(g,"XZ",d,!0),"YZ",d,!0)),b=v.clone(),T=du({depth:20,flangeXLenght:4.5,flangeYLenght:4.5,thickness:.5}),C=T.boundingBox.center,x=so(T,{type:"face",element:ne.BOTTOM,params:{u:1.5/4.5,v:2.25/20}},cu({radius:.800001,height:.5})),A=T.cut(x).cut(pr(x,"XZ",C,!0)),F=A.clone(),M=so(v,{type:"edge",element:ie.LEFT_BOTTOM,params:{t:.5}},A,{normal:[0,0,-1],xDir:[1,0,0]}),$=pr(M,"YZ",d,!0),V=[];let q=0,X=-e/2+14,Z=l-(v.boundingBox.bounds[1][2]-v.boundingBox.bounds[0][2]);for(let Lt=0;Lt<a;Lt++){const Tt=o*15;V.push(v.clone().translate([q,X,Z])),V.push(M.clone().translate([q-Tt,X,Z])),V.push($.clone().translate([q+Tt,X,Z])),X+=c,Z+=l}const se=Fr({width:600,depth:20,height:.5}),be=c,Se=l,_e=Math.sqrt(be*be+Se*Se),xe=_e>.001?[0,be/_e,Se/_e]:[1,0,0],ce=so(i,{type:"face",element:ne.RIGHT},se,{normal:[-1,0,0],xDir:xe}).intersect(i),ye=ce.clone(),ae=i.boundingBox.center,te=pr(ce,"YZ",ae,!0),le=o*30,we=o*30;V.push(ce.translate([le,0,0])),V.push(te.translate([-we,0,0]));const fe=Pt(V),Ce=[{id:"ST001",name:"Stringer",quantity:a,dimensions:`${t-1}200.5cm`,material:"Steel"},{id:"LP001",name:"L-Profile",quantity:a*2,dimensions:"4.54.520cm",material:"Steel"},{id:"SS001",name:"Side Stringer",quantity:2,dimensions:"Variable",material:"Steel"}];return{main:fe,helperSpaces:n?[i]:[],componentData:Ce,technicalDrawingModels:{ST001:b,LP001:F,SS001:ye}}}const gv={name:"Staircase",create:vv,params:[{name:"width",defaultValue:50},{name:"depth",defaultValue:100},{name:"height",defaultValue:200},{name:"showHelper",defaultValue:!0},{name:"explosionFactor",defaultValue:0}],validators:[St(bt,["width","depth","height"])],hasExplosion:!0},mv={Cuboid:jd,Sphere:Zd,Cylinder:Kd,Ellipsoid:Jd,DiagonalCuboidPattern:rv,RectangularCuboidGrid:ov,LProfile:iv,Frustum:sv,Drill:av,Staircase:{...gv,hasBoM:!0,requiresPassword:!0}};function wu(t,e){const r=mv[t];if(!r)throw new Error(`Model "${t}" not found`);const n=Xd(e,r);return n.valid?r.create(e):{error:!0,validationErrors:n.errors}}function Ze(t){if(!t||typeof t!="string")return null;const e=t.split(/[\s,]+/).map(parseFloat);if(e.length!==4||e.some(isNaN))return console.warn("Could not parse viewBox string:",t),null;const r=Math.max(0,e[2]),n=Math.max(0,e[3]);return{x:e[0],y:e[1],width:r,height:n}}function bu(t,e){const r="0 0 100 100",n=Ze(t),o=Ze(e);if(!n&&!o)return r;if(!n)return e||r;if(!o)return t||r;const i=Math.min(n.x,o.x),a=Math.min(n.y,o.y),l=Math.max(n.x+n.width,o.x+o.width),c=Math.max(n.y+n.height,o.y+o.height),h=Math.max(0,l-i),d=Math.max(0,c-a);return`${i} ${a} ${h} ${d}`}const it=1e-6;function Jt(t,e,r=it){return!t||!e?!1:Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))<r}function Su(t,e,r,n=it){if(!t||!e||!r)return!1;if(Math.abs(t[0]-e[0])<n&&Math.abs(e[0]-r[0])<n||Math.abs(t[1]-e[1])<n&&Math.abs(e[1]-r[1])<n)return!0;const o=Math.abs((e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])),i=Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2);return i<n*n?!0:o/Math.sqrt(i)<n}function yv(t){const e=Ei(t);if(t&&t.technicalDrawingModels){const n=[],o=[];return Object.entries(t.technicalDrawingModels).forEach(([i,a])=>{try{const l=Ei(a),c=l.boundingBox.center;console.log(`Model ${i} original center:`,c);const h=l.translate([-c[0],-c[1],-c[2]]);console.log(`Model ${i} new center:`,h.boundingBox.center),o.push(h);const d=t.componentData.find($=>$.id===i||$.name.toLowerCase().includes(i.toLowerCase())),g=ot(h,"front"),v=ot(h,"top"),b=ot(h,"right");console.log(`${i} front view bounds:`,g.visible.toSVGViewBox()),console.log(`${i} top view bounds:`,v.visible.toSVGViewBox()),console.log(`${i} right view bounds:`,b.visible.toSVGViewBox());const T=Ze(g.visible.toSVGViewBox()),C=Ze(v.visible.toSVGViewBox()),x=Ze(b.visible.toSVGViewBox()),A=Math.max((T==null?void 0:T.width)||0,(C==null?void 0:C.width)||0,(x==null?void 0:x.width)||0),F=Math.max((T==null?void 0:T.height)||0,(C==null?void 0:C.height)||0,(x==null?void 0:x.height)||0);T&&(g.normalizedViewBox=st(T,A,F)),C&&(v.normalizedViewBox=st(C,A,F)),x&&(b.normalizedViewBox=st(x,A,F));const M={front:g,top:v,right:b};n.push({name:d?d.name:i,views:M})}catch(l){console.error(`Error processing model ${i}:`,l)}}),console.log("All projections completed with",o.length,"centered models"),{parts:n}}const r=[];try{const n=Ei(e),o=n.boundingBox.center;console.log("Main model original center:",o);const i=n.translate([-o[0],-o[1],-o[2]]);console.log("Main model new center:",i.boundingBox.center),r.push(i);const a=ot(i,"front"),l=ot(i,"top"),c=ot(i,"right");console.log("Standard front view bounds:",a.visible.toSVGViewBox()),console.log("Standard top view bounds:",l.visible.toSVGViewBox()),console.log("Standard right view bounds:",c.visible.toSVGViewBox());const h=Ze(a.visible.toSVGViewBox()),d=Ze(l.visible.toSVGViewBox()),g=Ze(c.visible.toSVGViewBox()),v=Math.max((h==null?void 0:h.width)||0,(d==null?void 0:d.width)||0,(g==null?void 0:g.width)||0),b=Math.max((h==null?void 0:h.height)||0,(d==null?void 0:d.height)||0,(g==null?void 0:g.height)||0);h&&(a.normalizedViewBox=st(h,v,b)),d&&(l.normalizedViewBox=st(d,v,b)),g&&(c.normalizedViewBox=st(g,v,b));let T=[];if(t&&t.main&&Array.isArray(t.helperSpaces)){const C=t.main,x=C.boundingBox.center;console.log("Component main original center:",x);const A=C.translate([-x[0],-x[1],-x[2]]);console.log("Component main new center:",A.boundingBox.center),r.push(A);const F=ot(A,"front"),M=ot(A,"top"),$=ot(A,"right"),V=Ze(F.visible.toSVGViewBox()),q=Ze(M.visible.toSVGViewBox()),X=Ze($.visible.toSVGViewBox()),Z=Math.max((V==null?void 0:V.width)||0,(q==null?void 0:q.width)||0,(X==null?void 0:X.width)||0),se=Math.max((V==null?void 0:V.height)||0,(q==null?void 0:q.height)||0,(X==null?void 0:X.height)||0);V&&(F.normalizedViewBox=st(V,Z,se)),q&&(M.normalizedViewBox=st(q,Z,se)),X&&($.normalizedViewBox=st(X,Z,se)),T=[{name:"Main Component",views:{front:F,top:M,right:$}}],t.helperSpaces.forEach((Se,_e)=>{const xe=Se.boundingBox.center;console.log(`Helper space ${_e} original center:`,xe);const re=Se.translate([-xe[0],-xe[1],-xe[2]]);console.log(`Helper space ${_e} new center:`,re.boundingBox.center),r.push(re);const ce=ot(re,"front"),ye=ot(re,"top"),ae=ot(re,"right"),te=Ze(ce.visible.toSVGViewBox()),le=Ze(ye.visible.toSVGViewBox()),we=Ze(ae.visible.toSVGViewBox()),fe=Math.max((te==null?void 0:te.width)||0,(le==null?void 0:le.width)||0,(we==null?void 0:we.width)||0),Ce=Math.max((te==null?void 0:te.height)||0,(le==null?void 0:le.height)||0,(we==null?void 0:we.height)||0);te&&(ce.normalizedViewBox=st(te,fe,Ce)),le&&(ye.normalizedViewBox=st(le,fe,Ce)),we&&(ae.normalizedViewBox=st(we,fe,Ce));const _t={front:ce,top:ye,right:ae};T.push({name:`Helper Space ${_e+1}`,views:_t})})}return console.log("All standard projections completed with",r.length,"centered models"),{standard:{frontView:a,topView:l,rightView:c},parts:T}}catch(n){return console.error("Error in standard projections:",n),{standard:{},parts:[]}}}function st(t,e,r){if(!t||typeof t.x!="number"||typeof t.y!="number"||typeof t.width!="number"||typeof t.height!="number")return console.warn("Invalid viewBox provided to createNormalizedViewBox:",t),"0 0 100 100";const n=t.x+t.width/2,o=t.y+t.height/2,i=e>0?e:100,a=r>0?r:100,l=1.3,c=i*l,h=a*l,d=n-c/2,g=o-h/2;return`${d} ${g} ${c} ${h}`}function wv(t){const e={};if(t.standard)for(const[n,o]of Object.entries(t.standard))try{const i=o.visible.toSVGPaths(),a=o.hidden.toSVGPaths(),l=o.normalizedViewBox||o.visible.toSVGViewBox(5),c=o.normalizedViewBox||o.hidden.toSVGViewBox(5),h=o.normalizedViewBox||bu(l,c);console.log(`Processed ${n} viewBox:`,h);const g=`standard_${n.replace("View","").toLowerCase()}`,v=ao(i,`${g}_visible`),b=ao(a,`${g}_hidden`);e[n]={visible:{paths:v,viewBox:l},hidden:{paths:b,viewBox:c},combinedViewBox:h}}catch(i){console.error(`Error processing view ${n}:`,i)}const r=[];for(const n of t.parts||[])try{const o={};for(const[i,a]of Object.entries(n.views)){const l=a.visible.toSVGPaths(),c=a.hidden.toSVGPaths(),h=`${n.name.replace(/\s+/g,"_")}_${i}`,d=ao(l,`${h}_visible`),g=ao(c,`${h}_hidden`),v=a.normalizedViewBox||a.visible.toSVGViewBox(5),b=a.normalizedViewBox||a.hidden.toSVGViewBox(5),T=a.normalizedViewBox||bu(v,b);console.log(`Processed ${n.name} ${i} viewBox:`,T),o[i]={visible:{paths:d,viewBox:v},hidden:{paths:g,viewBox:b},combinedViewBox:T}}r.push({name:n.name,views:o})}catch(o){console.error(`Error processing part ${n.name}:`,o)}return{standard:Object.keys(e).length>0?e:void 0,parts:r}}function bv(t,e){let r,n;if(Jt(t.endpoints[1],e.endpoints[0]))r=t.endpoints[0],n=e.endpoints[1];else if(Jt(t.endpoints[0],e.endpoints[1]))r=e.endpoints[0],n=t.endpoints[1];else if(Jt(t.endpoints[0],e.endpoints[0]))r=t.endpoints[1],n=e.endpoints[1];else if(Jt(t.endpoints[1],e.endpoints[1]))r=t.endpoints[0],n=e.endpoints[0];else return console.warn("Cannot determine merge order for segments",t,e),t;const o=(t.length||0)+(e.length||0);return{type:"line",path:`M ${r[0]} ${r[1]} L ${n[0]} ${n[1]}`,length:o,endpoints:[r,n]}}function ao(t,e="path"){if(!Array.isArray(t))return[];const r=[];let n=0;for(let o=0;o<t.length;o++){const i=t[o];let a;if(typeof i=="string"?a=i:Array.isArray(i)?i.every(d=>typeof d=="string")?a=i.join(" "):i.length>0&&typeof i[0]=="string"?a=i[0]:a="":i&&typeof i=="object"&&typeof i.d=="string"?a=i.d:a=String(i),!a.trim())continue;const l=Sv(a);if(l){const d=`${e}_${n}_circle`;r.push({id:d,groupId:d,data:a,type:"circle",geometry:{type:"circle",center:l.center,radius:l.radius,diameter:l.radius*2}}),n++;continue}const c=_v(a),h=[];if(c.length>0){let d=c[0];for(let g=1;g<c.length;g++){const v=c[g];d&&v&&d.type==="line"&&v.type==="line"&&d.endpoints&&v.endpoints&&(Jt(d.endpoints[1],v.endpoints[0])||Jt(d.endpoints[0],v.endpoints[1])||Jt(d.endpoints[0],v.endpoints[0])||Jt(d.endpoints[1],v.endpoints[1]))&&Su(d.endpoints[0],d.endpoints[1],v.endpoints[0])&&Su(d.endpoints[0],d.endpoints[1],v.endpoints[1])?d=bv(d,v):(d&&h.push(d),d=v)}d&&h.push(d),h.forEach((g,v)=>{if(g&&g.path){const b=`${e}_${n}_${v}`;r.push({id:b,groupId:b,data:g.path,type:g.type,geometry:{type:g.type,length:g.length,endpoints:g.endpoints,center:g.type==="circle"?g.center:void 0,radius:g.type==="circle"?g.radius:void 0,diameter:g.type==="circle"?g.radius*2:void 0}})}else console.warn("Skipping invalid segment during final ID assignment:",g)})}else{const d=`${e}_${n}_unknown`;r.push({id:d,groupId:d,data:a,type:"unknown",geometry:{type:"unknown"}})}n++}return r}function Sv(t){const e=/([Aa])\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)\s+([-\d.eE+]+)\s+([01])\s*,?\s*([01])\s+([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/g,r=/M\s*([-\d.eE+]+)\s*,?\s*([-\d.eE+]+)/i,n=t.match(r);if(!n)return null;const o=parseFloat(n[1]),i=parseFloat(n[2]),a=[];let l;for(e.lastIndex=0;(l=e.exec(t))!==null;)a.push({rx:parseFloat(l[2]),ry:parseFloat(l[3]),xAxisRotation:parseFloat(l[4]),largeArcFlag:parseInt(l[5]),sweepFlag:parseInt(l[6]),endX:parseFloat(l[7]),endY:parseFloat(l[8]),isRelative:l[1]==="a"});if(a.length===0)return null;const c=Math.abs(a[0].rx),h=Math.abs(a[0].ry);if(c<it||Math.abs(c-h)>it*Math.max(c,h)||!a.every(ge=>Math.abs(Math.abs(ge.rx)-c)<it&&Math.abs(Math.abs(ge.ry)-h)<it))return null;let d=o,g=i;const v=t.match(/([MLHVCSQTAZ])([^MLHVCSQTAZ]*)/ig);if(!v)return null;for(const ge of v){const Re=ge[0],Oe=(ge.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(Oe.some(isNaN)){console.warn(`Could not parse parameters for command: ${ge}`);continue}const dt=_u(Re,Oe,d,g);d=dt[0],g=dt[1]}if(!(Math.abs(d-o)<it&&Math.abs(g-i)<it)||a.length<2)return null;let T=null;d=o,g=i;for(const ge of v){const Re=ge[0],Oe=(ge.slice(1).match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(Oe.some(isNaN))continue;if(Re==="A"||Re==="a"){if(Oe.length<7){console.warn(`Invalid arc command parameters: ${ge}`);continue}T={rx:Math.abs(Oe[0]),ry:Math.abs(Oe[1]),xAxisRotationDeg:Oe[2],largeArcFlag:Oe[3],sweepFlag:Oe[4],endX:Re==="a"?d+Oe[5]:Oe[5],endY:Re==="a"?g+Oe[6]:Oe[6],startX:d,startY:g};break}const dt=_u(Re,Oe,d,g);d=dt[0],g=dt[1]}if(!T)return null;const{rx:C,ry:x,xAxisRotationDeg:A,largeArcFlag:F,sweepFlag:M,endX:$,endY:V,startX:q,startY:X}=T,Z=A*Math.PI/180,se=Math.cos(Z),be=Math.sin(Z),Se=se*(q-$)/2+be*(X-V)/2,_e=-be*(q-$)/2+se*(X-V)/2,xe=C*C,re=x*x,ce=Se*Se,ye=_e*_e;let ae=ce/xe+ye/re,te=C,le=x;if(ae>1){const ge=Math.sqrt(ae);te=ge*C,le=ge*x}const we=te*te,fe=le*le;let Ce=F===M?-1:1,_t=Math.max(0,(we*fe-we*ye-fe*ce)/(we*ye+fe*ce)),Lt=Ce*Math.sqrt(_t);const Tt=Lt*(te*_e/le),er=Lt*-(le*Se/te),Lr=se*Tt-be*er+(q+$)/2,pt=be*Tt+se*er+(X+V)/2;return{center:[Lr,pt],radius:te}}function _v(t){const e=[];let r=0,n=0,o=0,i=0;const a=/([MLHVCSQTAZmlhvcsqtaz])([^MLHVCSQTAZmlhvcsqtaz]*)/g;let l;for(;(l=a.exec(t))!==null;){const c=l[1],h=(l[2].match(/[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?/g)||[]).map(Number);if(h.some(isNaN)){console.warn(`Could not parse parameters for command: ${l[0]}`);continue}let d=[];switch(c){case"M":if(h.length>=2){r=h[0],n=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const v=h[g],b=h[g+1],T=Ft(r,n,v,b);T&&e.push(T),r=v,n=b}}break;case"m":if(h.length>=2){r+=h[0],n+=h[1],o=r,i=n;for(let g=2;g<h.length;g+=2)if(g+1<h.length){const v=r+h[g],b=n+h[g+1],T=Ft(r,n,v,b);T&&e.push(T),r=v,n=b}}break;case"L":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const v=h[g],b=h[g+1],T=Ft(r,n,v,b);T&&e.push(T),r=v,n=b}break;case"l":for(let g=0;g<h.length;g+=2)if(g+1<h.length){const v=r+h[g],b=n+h[g+1],T=Ft(r,n,v,b);T&&e.push(T),r=v,n=b}break;case"H":for(let g=0;g<h.length;g++){const v=h[g],b=Ft(r,n,v,n);b&&e.push(b),r=v}break;case"h":for(let g=0;g<h.length;g++){const v=r+h[g],b=Ft(r,n,v,n);b&&e.push(b),r=v}break;case"V":for(let g=0;g<h.length;g++){const v=h[g],b=Ft(r,n,r,v);b&&e.push(b),n=v}break;case"v":for(let g=0;g<h.length;g++){const v=n+h[g],b=Ft(r,n,r,v);b&&e.push(b),n=v}break;case"Z":case"z":if(Math.abs(r-o)>it||Math.abs(n-i)>it){const g=Ft(r,n,o,i);g&&e.push(g)}r=o,n=i;break;case"C":case"c":d=h.length/6;for(let g=0;g<d;++g){const v=h.slice(g*6,(g+1)*6);if(v.length===6){const b=dr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:pn(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break;case"S":case"s":d=h.length/4;for(let g=0;g<d;++g){const v=h.slice(g*4,(g+1)*4);if(v.length===4){const b=dr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:pn(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break;case"Q":case"q":d=h.length/4;for(let g=0;g<d;++g){const v=h.slice(g*4,(g+1)*4);if(v.length===4){const b=dr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:pn(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break;case"T":case"t":d=h.length/2;for(let g=0;g<d;++g){const v=h.slice(g*2,(g+1)*2);if(v.length===2){const b=dr(c,v,r,n);e.push({type:"curve",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:pn(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break;case"A":case"a":d=h.length/7;for(let g=0;g<d;++g){const v=h.slice(g*7,(g+1)*7);if(v.length===7){const b=dr(c,v,r,n);e.push({type:"arc",path:`M ${r} ${n} ${c} ${v.join(" ")}`,length:pn(c,v,r,n),endpoints:[[r,n],b]}),r=b[0],n=b[1]}}break}}return e}function Ft(t,e,r,n){if(Math.abs(t-r)<it&&Math.abs(e-n)<it)return null;const o=Math.sqrt(Math.pow(r-t,2)+Math.pow(n-e,2));return{type:"line",path:`M ${t} ${e} L ${r} ${n}`,length:o,endpoints:[[t,e],[r,n]]}}function pn(t,e,r,n){const o=dr(t,e,r,n);return Math.sqrt(Math.pow(o[0]-r,2)+Math.pow(o[1]-n,2))}function _u(t,e,r,n){if("CSQTAcsgta".includes(t))return dr(t,e,r,n);let o=r,i=n;const a=t===t.toLowerCase(),l=e.length;switch(t.toUpperCase()){case"M":case"L":l>=2&&(o=e[l-2],i=e[l-1],a&&(o+=r,i+=n));break;case"H":l>=1&&(o=e[l-1],a&&(o+=r),i=n);break;case"V":l>=1&&(o=r,i=e[l-1],a&&(i+=n));break;case"Z":o=r,i=n;break}return[o,i]}function dr(t,e,r,n){const o=t===t.toLowerCase();let i=r,a=n;const l=e.length;switch(t.toUpperCase()){case"C":l>=6&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"S":case"Q":l>=4&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"T":l>=2&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break;case"A":l>=7&&(i=e[l-2],a=e[l-1],o&&(i+=r,a+=n));break}return[i,a]}let Tu=!1;const Eu=(async()=>{if(Tu)return Promise.resolve(!0);const t=await sl({locateFile:()=>al});return Tu=!0,ul(t),!0})();function Tv(t,e){return console.log(`[LOG] createProjections called for model: ${t}`),console.time(`[PERF] Total ${t} projections creation`),Eu.then(()=>{const r=wu(t,e);if(r&&r.error)return{error:!0,validationErrors:r.validationErrors};console.time(`[PERF] ${t} projections generation`);const n=yv(r);console.timeEnd(`[PERF] ${t} projections generation`),console.time(`[PERF] ${t} projections processing`);const o=wv(n);if(console.timeEnd(`[PERF] ${t} projections processing`),console.timeEnd(`[PERF] Total ${t} projections creation`),r&&r.componentData){const i=r.componentData.map(a=>({id:a.id,name:a.name,quantity:a.quantity,dimensions:a.dimensions,material:a.material}));o.componentData=i}return o})}function Ev(t,e,r="standard"){return console.time(`[PERF] Total ${t} creation (Quality: ${r})`),Eu.then(()=>{console.time(`[PERF] ${t} model function`);const n=wu(t,e);if(console.timeEnd(`[PERF] ${t} model function`),n&&n.error)return{error:!0,validationErrors:n.validationErrors};if(n&&n.main&&Array.isArray(n.helperSpaces)){const l=n.main,c=n.helperSpaces,h=r==="high"?{tolerance:.01,angularTolerance:1}:{tolerance:.1,angularTolerance:15};console.log(`[INFO] Using mesh options for ${r} quality:`,h),console.time(`[PERF] ${t} main model generation (Quality: ${r})`);const d=l.mesh(h),g=l.meshEdges(h);console.timeEnd(`[PERF] ${t} main model generation (Quality: ${r})`),console.time(`[PERF] ${t} helper spaces generation (Quality: ${r})`);const v=c.map(b=>({faces:b.mesh(h),edges:b.meshEdges(h)}));return console.timeEnd(`[PERF] ${t} helper spaces generation (Quality: ${r})`),console.timeEnd(`[PERF] Total ${t} creation (Quality: ${r})`),{faces:d,edges:g,helperSpaces:v,componentData:n.componentData}}const o=r==="high"?{tolerance:.01,angularTolerance:1}:{tolerance:.1,angularTolerance:15};console.log(`[INFO] Using mesh options for ${r} quality:`,o),console.time(`[PERF] ${t} faces generation (Quality: ${r})`);const i=n.mesh(o);console.timeEnd(`[PERF] ${t} faces generation (Quality: ${r})`),i&&i.triangles&&console.log(`[INFO] ${t} (Quality: ${r}) triangles: ${i.triangles.length/3}, vertices: ${i.vertices.length/3}`),console.time(`[PERF] ${t} edges generation (Quality: ${r})`);const a=n.meshEdges(o);return console.timeEnd(`[PERF] ${t} edges generation (Quality: ${r})`),console.timeEnd(`[PERF] Total ${t} creation (Quality: ${r})`),{faces:i,edges:a,componentData:n.componentData}})}_i({createMesh:Ev,createProjections:Tv})})();
